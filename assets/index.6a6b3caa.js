var g,I=Object.defineProperty,C=Object.defineProperties,A=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,d=(g,C,A)=>C in g?I(g,C,{enumerable:!0,configurable:!0,writable:!0,value:A}):g[C]=A,Z=(g,I)=>{for(var C in I||(I={}))i.call(I,C)&&d(g,C,I[C]);if(l)for(var C of l(I))c.call(I,C)&&d(g,C,I[C]);return g},e=(g,I)=>C(g,A(I));import{c as m,r as o,g as b,m as a,a as s,B as t,l as n,i as V,b as y,d as X,e as G,w as B,f as W,h,j as p,k as H,n as u,v as Y,o as K,p as R,q as r,R as J,s as w,t as S,u as F,x as k,y as v,z as N,A as f,C as z,O as x,D as U,E as M,F as L,G as T,H as D,I as Q,J as O,P,K as j,T as E,L as q,M as _,N as $,Q as gg,W as Ig,S as Cg,U as Ag,V as lg,X as ig,Y as cg,Z as dg,_ as Zg,$ as eg,a0 as mg,a1 as og,a2 as bg,a3 as ag,a4 as sg,a5 as tg,a6 as ng,a7 as Vg,a8 as yg,a9 as Xg,aa as Gg,ab as Bg}from"./vendor.5c6d3ccf.js";!function(){const g=document.createElement("link").relList;if(!(g&&g.supports&&g.supports("modulepreload"))){for(const g of document.querySelectorAll('link[rel="modulepreload"]'))I(g);new MutationObserver((g=>{for(const C of g)if("childList"===C.type)for(const g of C.addedNodes)"LINK"===g.tagName&&"modulepreload"===g.rel&&I(g)})).observe(document,{childList:!0,subtree:!0})}function I(g){if(g.ep)return;g.ep=!0;const I=function(g){const I={};return g.integrity&&(I.integrity=g.integrity),g.referrerpolicy&&(I.referrerPolicy=g.referrerpolicy),"use-credentials"===g.crossorigin?I.credentials="include":"anonymous"===g.crossorigin?I.credentials="omit":I.credentials="same-origin",I}(g);fetch(g.href,I)}}();var Wg={$ref:"#/definitions/GoslingSpec",$schema:"http://json-schema.org/draft-07/schema#",definitions:{Aggregate:{enum:["max","min","mean","bin","count"],type:"string"},Assembly:{enum:["hg38","hg19","hg18","hg17","hg16","mm10","mm9","unknown"],type:"string"},AxisPosition:{enum:["none","top","bottom","left","right"],type:"string"},BAMData:{additionalProperties:!1,description:"Binary Alignment Map (BAM) is the comprehensive raw data of genome sequencing; it consists of the lossless, compressed binary representation of the Sequence Alignment Map-files.",properties:{extractJunction:{description:"Determine whether to extract exon-to-exon junctions. __Default__: `false`",type:"boolean"},indexUrl:{description:"URL link to the index file of the BAM file",type:"string"},junctionMinCoverage:{description:"Determine the threshold of coverage when extracting exon-to-exon junctions. __Default__: `1`",type:"number"},loadMates:{description:"Load mates that are located in the same chromosome. __Default__: `false`",type:"boolean"},maxInsertSize:{description:"Determines the threshold of insert sizes for determining the structural variants. __Default__: `5000`",type:"number"},type:{const:"bam",type:"string"},url:{description:"URL link to the BAM data file",type:"string"}},required:["type","url","indexUrl"],type:"object"},BEDDBData:{additionalProperties:!1,description:"Regular BED or similar files can be pre-aggregated for the scalable data exploration. Find our more about this format at [HiGlass Docs](https://docs.higlass.io/data_preparation.html#bed-files).",properties:{exonIntervalFields:{description:"experimental",items:[{additionalProperties:!1,properties:{index:{type:"number"},name:{type:"string"}},required:["index","name"],type:"object"},{additionalProperties:!1,properties:{index:{type:"number"},name:{type:"string"}},required:["index","name"],type:"object"}],maxItems:2,minItems:2,type:"array"},genomicFields:{description:"Specify the name of genomic data fields.",items:{additionalProperties:!1,properties:{index:{type:"number"},name:{type:"string"}},required:["index","name"],type:"object"},type:"array"},type:{const:"beddb",type:"string"},url:{description:"Specify the URL address of the data file.",type:"string"},valueFields:{description:"Specify the column indexes, field names, and field types.",items:{additionalProperties:!1,properties:{index:{type:"number"},name:{type:"string"},type:{enum:["nominal","quantitative"],type:"string"}},required:["index","name","type"],type:"object"},type:"array"}},required:["type","url","genomicFields"],type:"object"},BIGWIGData:{additionalProperties:!1,properties:{binSize:{description:"Binning the genomic interval in tiles (unit size: 256).",type:"number"},column:{description:"Assign a field name of the middle position of genomic intervals.",type:"string"},end:{description:"Assign a field name of the end position of genomic intervals.",type:"string"},start:{description:"Assign a field name of the start position of genomic intervals.",type:"string"},type:{const:"bigwig",type:"string"},url:{description:"Specify the URL address of the data file.",type:"string"},value:{description:"Assign a field name of quantitative values.",type:"string"}},required:["type","url","column","value"],type:"object"},CSVData:{additionalProperties:!1,description:'Any small enough tabular data files, such as tsv, csv, BED, BEDPE, and GFF, can be loaded using "csv" data specification.',properties:{chromosomeField:{description:"Specify the name of chromosome data fields.",type:"string"},chromosomePrefix:{description:"experimental",type:"string"},genomicFields:{description:"Specify the name of genomic data fields.",items:{type:"string"},type:"array"},genomicFieldsToConvert:{description:"experimental",items:{additionalProperties:!1,properties:{chromosomeField:{type:"string"},genomicFields:{items:{type:"string"},type:"array"}},required:["chromosomeField","genomicFields"],type:"object"},type:"array"},headerNames:{description:"Specify the names of data fields if a CSV file is headerless.",items:{type:"string"},type:"array"},longToWideId:{description:"experimental",type:"string"},quantitativeFields:{description:"Specify the name of quantitative data fields.",items:{type:"string"},type:"array"},sampleLength:{description:"Specify the number of rows loaded from the URL.\n\n__Default:__ `1000`",type:"number"},separator:{description:"Specify file separator, __Default:__ ','",type:"string"},type:{const:"csv",type:"string"},url:{description:"Specify the URL address of the data file.",type:"string"}},required:["type","url"],type:"object"},Channel:{anyOf:[{$ref:"#/definitions/ChannelDeep"},{$ref:"#/definitions/ChannelValue"}]},ChannelDeep:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/Y"},{$ref:"#/definitions/Row"},{$ref:"#/definitions/Color"},{$ref:"#/definitions/Size"},{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/Text"}]},ChannelValue:{additionalProperties:!1,properties:{value:{description:"Assign a constant value for a visual channel.",type:["number","string"]}},required:["value"],type:"object"},Chromosome:{enum:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","X","Y","M","chr1","chr2","chr3","chr4","chr5","chr6","chr7","chr8","chr9","chr10","chr11","chr12","chr13","chr14","chr15","chr16","chr17","chr18","chr19","chr20","chr21","chr22","chrX","chrY","chrM"],type:"string"},Color:{additionalProperties:!1,properties:{domain:{$ref:"#/definitions/ValueExtent",description:"Values of the data"},field:{description:"Name of the data field",type:"string"},legend:{description:"Whether to display legend. __Default__: `false`",type:"boolean"},range:{$ref:"#/definitions/Range",description:"Determine the colors that should be bound to data value. Default properties are determined considering the field type."},type:{description:"Specify the data type",enum:["quantitative","nominal"],type:"string"}},type:"object"},CoverageTransform:{additionalProperties:!1,description:"Aggregate rows and calculate coverage",properties:{endField:{type:"string"},groupField:{description:"The name of a nominal field to group rows by in prior to piling-up",type:"string"},newField:{type:"string"},startField:{type:"string"},type:{const:"coverage",type:"string"}},required:["type","startField","endField"],type:"object"},DataDeep:{anyOf:[{$ref:"#/definitions/JSONData"},{$ref:"#/definitions/CSVData"},{$ref:"#/definitions/BIGWIGData"},{$ref:"#/definitions/MultivecData"},{$ref:"#/definitions/BEDDBData"},{$ref:"#/definitions/VectorData"},{$ref:"#/definitions/MatrixData"},{$ref:"#/definitions/BAMData"}]},DataTrack:{additionalProperties:!1,description:"Partial specification of `BasicSingleTrack` to use default visual encoding predefined by data type.",properties:{_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},data:{$ref:"#/definitions/DataDeep"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overriden by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},width:{description:"Specify the track width in pixels.",type:"number"},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}]},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["data","height","width"],type:"object"},DataTransform:{anyOf:[{$ref:"#/definitions/FilterTransform"},{$ref:"#/definitions/StrConcatTransform"},{$ref:"#/definitions/StrReplaceTransform"},{$ref:"#/definitions/LogTransform"},{$ref:"#/definitions/DisplaceTransform"},{$ref:"#/definitions/ExonSplitTransform"},{$ref:"#/definitions/GenomicLengthTransform"},{$ref:"#/definitions/CoverageTransform"},{$ref:"#/definitions/JSONParseTransform"}]},Datum:{additionalProperties:{type:["number","string"]},description:"Values in the form of JSON.",type:"object"},DisplaceTransform:{additionalProperties:!1,properties:{boundingBox:{additionalProperties:!1,properties:{endField:{description:"The name of a quantitative field that represents the end position.",type:"string"},groupField:{description:"The name of a nominal field to group rows by in prior to piling-up.",type:"string"},isPaddingBP:{description:"Whether to consider `padding` as the bp length.",type:"boolean"},padding:{description:"The padding around visual lements. Either px or bp",type:"number"},startField:{description:"The name of a quantitative field that represents the start position.",type:"string"}},required:["startField","endField"],type:"object"},maxRows:{description:"Specify maximum rows to be generated (default has no limit).",type:"number"},method:{$ref:"#/definitions/DisplacementType",description:"A string that specifies the type of diseplancement."},newField:{type:"string"},type:{const:"displace",type:"string"}},required:["type","boundingBox","method","newField"],type:"object"},Displacement:{additionalProperties:!1,properties:{padding:{type:"number"},type:{$ref:"#/definitions/DisplacementType"}},required:["type"],type:"object"},DisplacementType:{enum:["pile","spread"],type:"string"},DomainChr:{additionalProperties:!1,properties:{chromosome:{$ref:"#/definitions/Chromosome"}},required:["chromosome"],type:"object"},DomainChrInterval:{additionalProperties:!1,properties:{chromosome:{$ref:"#/definitions/Chromosome",description:"If specified, only showing a certain interval in a chromosome."},interval:{items:[{type:"number"},{type:"number"}],maxItems:2,minItems:2,type:"array"}},required:["chromosome","interval"],type:"object"},DomainGene:{additionalProperties:!1,properties:{gene:{anyOf:[{type:"string"},{items:[{type:"string"},{type:"string"}],maxItems:2,minItems:2,type:"array"}]}},required:["gene"],type:"object"},DomainInterval:{additionalProperties:!1,properties:{interval:{items:[{type:"number"},{type:"number"}],maxItems:2,minItems:2,type:"array"}},required:["interval"],type:"object"},ExonSplitTransform:{additionalProperties:!1,properties:{fields:{items:{additionalProperties:!1,properties:{chrField:{type:"string"},field:{type:"string"},newField:{type:"string"},type:{$ref:"#/definitions/FieldType"}},required:["field","type","newField","chrField"],type:"object"},type:"array"},flag:{additionalProperties:!1,properties:{field:{type:"string"},value:{type:["number","string"]}},required:["field","value"],type:"object"},separator:{type:"string"},type:{const:"exonSplit",type:"string"}},required:["type","separator","flag","fields"],type:"object"},FieldType:{enum:["genomic","nominal","quantitative"],type:"string"},FilterTransform:{anyOf:[{$ref:"#/definitions/OneOfFilter"},{$ref:"#/definitions/RangeFilter"},{$ref:"#/definitions/IncludeFilter"}]},FlatTracks:{additionalProperties:!1,properties:{assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overriden by the style of children elements (e.g., view, track)."},tracks:{items:{$ref:"#/definitions/Track"},type:"array"},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}]},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["tracks"],type:"object"},GenomicDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"},{$ref:"#/definitions/DomainGene"}]},GenomicLengthTransform:{additionalProperties:!1,description:"Calculate genomic length using two genomic fields",properties:{endField:{type:"string"},newField:{type:"string"},startField:{type:"string"},type:{const:"genomicLength",type:"string"}},required:["type","startField","endField","newField"],type:"object"},GoslingSpec:{anyOf:[{$ref:"#/definitions/RootSpecWithSingleView"},{$ref:"#/definitions/RootSpecWithMultipleViews"}]},IncludeFilter:{additionalProperties:!1,properties:{field:{description:"A filter is applied based on the values of the specified data field",type:"string"},include:{description:"Check whether the value includes a substring.",type:"string"},not:{description:'when `{"not": true}`, apply a NOT logical operation to the filter.\n\n__Default:__ `false`',type:"boolean"},type:{const:"filter",type:"string"}},required:["field","include","type"],type:"object"},JSONData:{additionalProperties:!1,description:"The JSON data format allows users to include data directly in the Gosling's JSON specification.",properties:{chromosomeField:{description:"Specify the name of chromosome data fields.",type:"string"},genomicFields:{description:"Specify the name of genomic data fields.",items:{type:"string"},type:"array"},genomicFieldsToConvert:{description:"experimental",items:{additionalProperties:!1,properties:{chromosomeField:{type:"string"},genomicFields:{items:{type:"string"},type:"array"}},required:["chromosomeField","genomicFields"],type:"object"},type:"array"},quantitativeFields:{description:"Specify the name of quantitative data fields.",items:{type:"string"},type:"array"},sampleLength:{description:"Specify the number of rows loaded from the URL.\n\n__Default:__ `1000`",type:"number"},type:{const:"json",description:"Define data type.",type:"string"},values:{description:"Values in the form of JSON.",items:{$ref:"#/definitions/Datum"},type:"array"}},required:["type","values"],type:"object"},JSONParseTransform:{additionalProperties:!1,description:"Parse JSON Object Array and append vertically",properties:{baseGenomicField:{description:"Base genomic position when parsing relative position.",type:"string"},field:{description:"The field that contains the JSON object array.",type:"string"},genomicField:{description:"Relative genomic position to parse.",type:"string"},genomicLengthField:{description:"Length of genomic interval.",type:"string"},type:{const:"subjson",type:"string"}},required:["type","field","baseGenomicField","genomicField","genomicLengthField"],type:"object"},Layout:{enum:["linear","circular"],type:"string"},LogBase:{anyOf:[{type:"number"},{const:"e",type:"string"}]},LogTransform:{additionalProperties:!1,properties:{base:{$ref:"#/definitions/LogBase",description:"If not specified, 10 is used."},field:{type:"string"},newField:{description:"If specified, store transformed values in a new field.",type:"string"},type:{const:"log",type:"string"}},required:["type","field"],type:"object"},LogicalOperation:{enum:["less-than","lt","LT","greater-than","gt","GT","less-than-or-equal-to","ltet","LTET","greater-than-or-equal-to","gtet","GTET"],type:"string"},Mark:{enum:["point","line","area","bar","rect","text","withinLink","betweenLink","rule","triangleLeft","triangleRight","triangleBottom","brush","header"],type:"string"},MatrixData:{additionalProperties:!1,properties:{type:{const:"matrix",type:"string"},url:{type:"string"}},required:["type","url"],type:"object"},MultipleViews:{additionalProperties:!1,properties:{arrangement:{description:"Specify how multiple views are arranged.",enum:["parallel","serial","horizontal","vertical"],type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overriden by the style of children elements (e.g., view, track)."},views:{description:"An array of view specifications",items:{anyOf:[{$ref:"#/definitions/SingleView"},{$ref:"#/definitions/MultipleViews"}]},type:"array"},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}]},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["views"],type:"object"},MultivecData:{additionalProperties:!1,description:'Two-dimensional quantitative values, one axis for genomic coordinate and the other for different samples, can be converted into HiGlass\' `"multivec"` data. For example, multiple BigWig files can be converted into a single multivec file. You can also convert sequence data (FASTA) into this format where rows will be different nucleotide bases (e.g., A, T, G, C) and quantitative values represent the frequency. Find out more about this format at [HiGlass Docs](https://docs.higlass.io/data_preparation.html#multivec-files).',properties:{binSize:{description:"Binning the genomic interval in tiles (unit size: 256).",type:"number"},categories:{description:"assign names of individual samples.",items:{type:"string"},type:"array"},column:{description:"Assign a field name of the middle position of genomic intervals.",type:"string"},end:{description:"Assign a field name of the end position of genomic intervals.",type:"string"},row:{description:"Assign a field name of samples.",type:"string"},start:{description:"Assign a field name of the start position of genomic intervals.",type:"string"},type:{const:"multivec",type:"string"},url:{description:"Specify the URL address of the data file.",type:"string"},value:{description:"Assign a field name of quantitative values.",type:"string"}},required:["type","url","column","row","value"],type:"object"},OneOfFilter:{additionalProperties:!1,properties:{field:{description:"A filter is applied based on the values of the specified data field",type:"string"},not:{description:'when `{"not": true}`, apply a NOT logical operation to the filter.\n\n__Default:__ `false`',type:"boolean"},oneOf:{anyOf:[{items:{type:"string"},type:"array"},{items:{type:"number"},type:"array"}],description:"Check whether the value is an element in the provided list."},type:{const:"filter",type:"string"}},required:["field","oneOf","type"],type:"object"},Opacity:{additionalProperties:!1,properties:{domain:{$ref:"#/definitions/ValueExtent",description:"Values of the data"},field:{description:"Name of the data field",type:"string"},range:{$ref:"#/definitions/ValueExtent",description:"Ranges of visual channel values"},type:{description:"Specify the data type",enum:["quantitative","nominal"],type:"string"}},type:"object"},Orientation:{enum:["horizontal","vertical"],type:"string"},OverlaidTrack:{additionalProperties:!1,description:"Superposing multiple tracks.",properties:{_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},flipY:{type:"boolean"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlay:{items:{additionalProperties:!1,properties:{_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},flipY:{type:"boolean"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overriden by the style of children elements (e.g., view, track)."},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}]},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},type:"object"},type:"array"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overriden by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},width:{description:"Specify the track width in pixels.",type:"number"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}]},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["height","overlay","width"],type:"object"},OverlaidTracks:{additionalProperties:!1,properties:{_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},alignment:{const:"overlay",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},flipY:{type:"boolean"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overriden by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},tracks:{items:{$ref:"#/definitions/PartialTrack"},type:"array"},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},width:{description:"Specify the track width in pixels.",type:"number"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}]},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["alignment","tracks","width","height"],type:"object"},PREDEFINED_COLORS:{enum:["viridis","grey","spectral","warm","cividis","bupu","rdbu"],type:"string"},PartialTrack:{additionalProperties:!1,properties:{_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},displacement:{$ref:"#/definitions/Displacement"},encoding:{additionalProperties:{$ref:"#/definitions/Channel"},type:"object"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},flipY:{type:"boolean"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlay:{items:{additionalProperties:!1,properties:{_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},flipY:{type:"boolean"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overriden by the style of children elements (e.g., view, track)."},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}]},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},type:"object"},type:"array"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overriden by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},template:{type:"string"},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},width:{description:"Specify the track width in pixels.",type:"number"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}]},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},type:"object"},Range:{anyOf:[{$ref:"#/definitions/ValueExtent"},{$ref:"#/definitions/PREDEFINED_COLORS"}]},RangeFilter:{additionalProperties:!1,properties:{field:{description:"A filter is applied based on the values of the specified data field",type:"string"},inRange:{description:"Check whether the value is in a number range.",items:{type:"number"},type:"array"},not:{description:'when `{"not": true}`, apply a NOT logical operation to the filter.\n\n__Default:__ `false`',type:"boolean"},type:{const:"filter",type:"string"}},required:["field","inRange","type"],type:"object"},RootSpecWithMultipleViews:{additionalProperties:!1,properties:{arrangement:{description:"Specify how multiple views are arranged.",enum:["parallel","serial","horizontal","vertical"],type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},description:{type:"string"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overriden by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},title:{type:"string"},views:{description:"An array of view specifications",items:{anyOf:[{$ref:"#/definitions/SingleView"},{$ref:"#/definitions/MultipleViews"}]},type:"array"},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}]},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["views"],type:"object"},RootSpecWithSingleView:{anyOf:[{additionalProperties:!1,properties:{_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},alignment:{const:"overlay",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},description:{type:"string"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},flipY:{type:"boolean"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overriden by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},tracks:{items:{$ref:"#/definitions/PartialTrack"},type:"array"},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},width:{description:"Specify the track width in pixels.",type:"number"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}]},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["alignment","height","tracks","width"],type:"object"},{additionalProperties:!1,properties:{_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},alignment:{const:"stack",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},description:{type:"string"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},flipY:{type:"boolean"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overriden by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},tracks:{items:{anyOf:[{$ref:"#/definitions/PartialTrack"},{$ref:"#/definitions/OverlaidTracks"}]},type:"array"},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},width:{description:"Specify the track width in pixels.",type:"number"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}]},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["tracks"],type:"object"},{additionalProperties:!1,properties:{assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},description:{type:"string"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overriden by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},title:{type:"string"},tracks:{items:{$ref:"#/definitions/Track"},type:"array"},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}]},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["tracks"],type:"object"}]},Row:{additionalProperties:!1,properties:{domain:{$ref:"#/definitions/ValueExtent",description:"Values of the data"},field:{description:"Name of the data field",type:"string"},grid:{description:"Whether to display grid. __Default__: `false`",type:"boolean"},legend:{description:"Whether to display legend. __Default__: `false`",type:"boolean"},padding:{description:"Determines the size of inner white spaces on the top and bottom of individiual rows. __Default__: `0`",type:"number"},range:{$ref:"#/definitions/ValueExtent",description:"Determine the start and end position of rendering area of this track along vertical axis. __Default__: `[0, height]`"},type:{const:"nominal",description:"Specify the data type",type:"string"}},type:"object"},SingleTrack:{additionalProperties:!1,properties:{_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},flipY:{type:"boolean"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overriden by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},width:{description:"Specify the track width in pixels.",type:"number"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}]},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["data","height","mark","width"],type:"object"},SingleView:{anyOf:[{$ref:"#/definitions/OverlaidTracks"},{$ref:"#/definitions/StackedTracks"},{$ref:"#/definitions/FlatTracks"}]},Size:{additionalProperties:!1,properties:{domain:{$ref:"#/definitions/ValueExtent",description:"Values of the data"},field:{description:"Name of the data field",type:"string"},legend:{description:"not supported: Whether to display legend. __Default__: `false`",type:"boolean"},range:{$ref:"#/definitions/ValueExtent",description:"Ranges of visual channel values"},type:{description:"Specify the data type",enum:["quantitative","nominal"],type:"string"}},type:"object"},SizeVisibilityCondition:{additionalProperties:!1,properties:{conditionPadding:{description:"Specify the buffer size (in pixel) of width or height when calculating the visibility.\n\n__Default__: `0`",type:"number"},measure:{description:"Specify which aspect of the `target` will be compared to the `threshold`.",enum:["width","height"],type:"string"},operation:{$ref:"#/definitions/LogicalOperation",description:'A string that pecifies the logical operation to conduct between `threshold` and the `measure` of `target`. Support\n\n- greater than : "greater-than", "gt", "GT"\n\n- less than : "less-than", "lt", "LT"\n\n- greater than or equal to : "greater-than-or-equal-to", "gtet", "GTET"\n\n- less than or equal to : "less-than-or-equal-to", "ltet", "LTET"'},target:{description:"Target specifies the object that you want to compare with the threshold.",enum:["track","mark"],type:"string"},threshold:{anyOf:[{type:"number"},{const:"|xe-x|",type:"string"}],description:'Specify the threshold as one of:\n\n- A number representing a fixed threshold in the unit of pixels;\n\n- `"|xe-x|"`, using the distance between `xe` and `x` as threshold'},transitionPadding:{description:"Specify the buffer size (in pixel) of width or height for smooth transition.\n\n__Default__: `0`",type:"number"}},required:["measure","operation","target","threshold"],type:"object"},StackedTracks:{additionalProperties:!1,properties:{_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},alignment:{const:"stack",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},flipY:{type:"boolean"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overriden by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},tracks:{items:{anyOf:[{$ref:"#/definitions/PartialTrack"},{$ref:"#/definitions/OverlaidTracks"}]},type:"array"},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},width:{description:"Specify the track width in pixels.",type:"number"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}]},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["tracks"],type:"object"},StrConcatTransform:{additionalProperties:!1,properties:{fields:{items:{type:"string"},type:"array"},newField:{type:"string"},separator:{type:"string"},type:{const:"concat",type:"string"}},required:["type","fields","newField","separator"],type:"object"},StrReplaceTransform:{additionalProperties:!1,properties:{field:{type:"string"},newField:{type:"string"},replace:{items:{additionalProperties:!1,properties:{from:{type:"string"},to:{type:"string"}},required:["from","to"],type:"object"},type:"array"},type:{const:"replace",type:"string"}},required:["type","field","newField","replace"],type:"object"},Stroke:{additionalProperties:!1,properties:{domain:{$ref:"#/definitions/ValueExtent",description:"Values of the data"},field:{description:"Name of the data field",type:"string"},range:{$ref:"#/definitions/Range",description:"Ranges of visual channel values"},type:{description:"Specify the data type",enum:["quantitative","nominal"],type:"string"}},type:"object"},StrokeWidth:{additionalProperties:!1,properties:{domain:{$ref:"#/definitions/ValueExtent",description:"Values of the data"},field:{description:"Name of the data field",type:"string"},range:{$ref:"#/definitions/ValueExtent",description:"Ranges of visual channel values"},type:{description:"Specify the data type",enum:["quantitative","nominal"],type:"string"}},type:"object"},Style:{additionalProperties:!1,properties:{align:{description:"Specify the alignment of marks. This property is currently only supported for `triangle` marks.",enum:["left","right"],type:"string"},background:{type:"string"},backgroundOpacity:{type:"number"},bazierLink:{description:"Specify whether to use bazier curves for the `link` marks.",type:"boolean"},curve:{description:"Specify the curve of `rule` marks.",enum:["top","bottom","left","right"],type:"string"},dashed:{description:"Specify the pattern of dashes and gaps for `rule` marks.",items:[{type:"number"},{type:"number"}],maxItems:2,minItems:2,type:"array"},dx:{description:"Offset the position of marks in x direction. This property is currently only supported for `text` marks",type:"number"},dy:{description:"Offset the position of marks in y direction. This property is currently only supported for `text` marks.",type:"number"},enableSmoothPath:{description:"Whether to enable smooth paths when drawing curves.\n\n__Default__: `false`",type:"boolean"},flatWithinLink:{description:"Specify whether to use a flat within-links, such as the one in Sashimi plots. __Default__: `false`",type:"boolean"},inlineLegend:{description:"Specify whether to show legend in a single horizontal line?",type:"boolean"},legendTitle:{description:"If defined, show legend title on the top or left",type:"string"},linePattern:{additionalProperties:!1,description:"Specify the pattern of dashes and gaps for `rule` marks.",properties:{size:{type:"number"},type:{enum:["triangleLeft","triangleRight"],type:"string"}},required:["type","size"],type:"object"},linkConnectionType:{description:'Specify the connetion type of `betweenLink` marks.\n\n__Default__: `"corner"`',enum:["straight","curve","corner"],type:"string"},outline:{type:"string"},outlineWidth:{type:"number"},textAnchor:{description:"Specify the alignment of `text` marks to a given point.",enum:["start","middle","end"],type:"string"},textFontSize:{description:"Specify the font size of `text` marks. Can also be specified using the `size` channel option of `text` marks.",type:"number"},textFontWeight:{description:"Specify the font weight of `text` marks.",enum:["bold","normal"],type:"string"},textStroke:{description:"Specify the stroke of `text` marks. Can also be specified using the `stroke` channel option of `text` marks.",type:"string"},textStrokeWidth:{description:"Specify the stroke width of `text` marks. Can also be specified using the `strokeWidth` channel option of `text` marks.",type:"number"}},type:"object"},TemplateTrack:{additionalProperties:!1,description:"Template specification that will be internally converted into `SingleTrack` for rendering.",properties:{_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},data:{$ref:"#/definitions/DataDeep"},encoding:{additionalProperties:{$ref:"#/definitions/Channel"},type:"object"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overriden by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},template:{type:"string"},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},width:{description:"Specify the track width in pixels.",type:"number"},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}]},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["data","height","template","width"],type:"object"},Text:{additionalProperties:!1,properties:{domain:{description:"Values of the data",items:{type:"string"},type:"array"},field:{description:"Name of the data field",type:"string"},range:{description:"Ranges of visual channel values",items:{type:"string"},type:"array"},type:{description:"Specify the data type",enum:["quantitative","nominal"],type:"string"}},type:"object"},Tooltip:{additionalProperties:!1,properties:{alt:{type:"string"},field:{type:"string"},format:{type:"string"},type:{$ref:"#/definitions/FieldType"}},required:["field","type"],type:"object"},Track:{anyOf:[{$ref:"#/definitions/SingleTrack"},{$ref:"#/definitions/OverlaidTrack"},{$ref:"#/definitions/DataTrack"},{$ref:"#/definitions/TemplateTrack"}]},ValueExtent:{anyOf:[{items:{type:"string"},type:"array"},{items:{type:"number"},type:"array"}]},VectorData:{additionalProperties:!1,description:'One-dimensional quantitative values along genomic position (e.g., bigwig) can be converted into HiGlass\' `"vector"` format data. Find out more about this format at [HiGlass Docs](https://docs.higlass.io/data_preparation.html#bigwig-files).',properties:{binSize:{description:"Binning the genomic interval in tiles (unit size: 256).",type:"number"},column:{description:"Assign a field name of the middle position of genomic intervals.",type:"string"},end:{description:"Assign a field name of the end position of genomic intervals.",type:"string"},start:{description:"Assign a field name of the start position of genomic intervals.",type:"string"},type:{const:"vector",type:"string"},url:{description:"Specify the URL address of the data file.",type:"string"},value:{description:"Assign a field name of quantitative values.",type:"string"}},required:["type","url","column","value"],type:"object"},VisibilityCondition:{anyOf:[{$ref:"#/definitions/SizeVisibilityCondition"},{$ref:"#/definitions/ZoomLevelVisibilityCondition"}]},X:{additionalProperties:!1,properties:{aggregate:{$ref:"#/definitions/Aggregate",description:"Specify how to aggregate data. __Default__: `undefined`"},axis:{$ref:"#/definitions/AxisPosition",description:"Specify where should the axis be put"},domain:{$ref:"#/definitions/GenomicDomain",description:"Values of the data"},field:{description:"Name of the data field.",type:"string"},grid:{description:"Whether to display grid. __Default__: `false`",type:"boolean"},legend:{description:"Whether to display legend. __Default__: `false`",type:"boolean"},linkingId:{description:"Users need to assign a unique linkingId for [linking views](/docs/user-interaction#linking-views) and [Brushing and Linking](/docs/user-interaction#brushing-and-linking)",type:"string"},range:{$ref:"#/definitions/ValueExtent",description:"Values of the visual channel."},type:{const:"genomic",description:"Specify the data type.",type:"string"}},type:"object"},Y:{additionalProperties:!1,properties:{aggregate:{$ref:"#/definitions/Aggregate",description:"Specify how to aggregate data. __Default__: `undefined`"},axis:{$ref:"#/definitions/AxisPosition",description:"Specify where should the axis be put"},baseline:{description:"Custom baseline of the y-axis. __Default__: `0`",type:["string","number"]},domain:{$ref:"#/definitions/ValueExtent",description:"Values of the data"},field:{description:"Name of the data field.",type:"string"},flip:{description:"Whether to flip the y-axis. This is done by inverting the `range` property. __Default__: `false`",type:"boolean"},grid:{description:"Whether to display grid. __Default__: `false`",type:"boolean"},legend:{description:"Whether to display legend. __Default__: `false`",type:"boolean"},linkingId:{description:"Users need to assign a unique linkingId for [linking views](/docs/user-interaction#linking-views) and [Brushing and Linking](/docs/user-interaction#brushing-and-linking)",type:"string"},range:{$ref:"#/definitions/ValueExtent",description:"Values of the visual channel."},type:{description:"Specify the data type.",enum:["quantitative","nominal","genomic"],type:"string"},zeroBaseline:{description:"Specify whether to use zero baseline. __Default__: `true`",type:"boolean"}},type:"object"},ZoomLevelVisibilityCondition:{additionalProperties:!1,properties:{conditionPadding:{description:"Specify the buffer size (in pixel) of width or height when calculating the visibility.\n\n__Default__: `0`",type:"number"},measure:{const:"zoomLevel",description:"Specify which aspect of the `target` will be compared to the `threshold`.",type:"string"},operation:{$ref:"#/definitions/LogicalOperation",description:'A string that pecifies the logical operation to conduct between `threshold` and the `measure` of `target`. Support\n\n- greater than : "greater-than", "gt", "GT"\n\n- less than : "less-than", "lt", "LT"\n\n- greater than or equal to : "greater-than-or-equal-to", "gtet", "GTET"\n\n- less than or equal to : "less-than-or-equal-to", "ltet", "LTET"'},target:{description:"Target specifies the object that you want to compare with the threshold.",enum:["track","mark"],type:"string"},threshold:{description:"Set a threshold in the unit of base pairs (bp)",type:"number"},transitionPadding:{description:"Specify the buffer size (in pixel) of width or height for smooth transition.\n\n__Default__: `0`",type:"number"}},required:["measure","operation","target","threshold"],type:"object"},ZoomLimits:{items:[{type:["number","null"]},{type:["number","null"]}],maxItems:2,minItems:2,type:"array"}}};const hg=g=>{let I=m(g);I||(I=m("gray"));return o([I.rgb().r/255,I.rgb().g/255,I.rgb().b/255])};function pg(g,I,C,A,l){const i=Math.max(Math.min(I,g),0),c=null!=l?l:0,d=(A-C)/360*Math.PI*2-2*c;return-(C/360*Math.PI*2+i/I*d)-Math.PI/2-c}function Hg(g,I,C,A,l,i,c){return{x:A+C*Math.cos(pg(g,I,i,c)),y:l+C*Math.sin(pg(g,I,i,c))}}function ug(g,I,C,A){return C<=g?Math.atan((I-A)/(g-C)):Math.atan((I-A)/(g-C))-Math.PI}const Yg={fontSize:"12px",fontFamily:"sans-serif",fontWeight:"normal",fill:"black",background:"white",lineJoin:"round",stroke:"#ffffff",strokeThickness:0};function Kg(g,I,C){!function(g,I,C){var A,l,i,c,d;const Z=I.spec();if(!Dg(Z.y)||!0!==Z.y.grid)return;const[e,m]=g.position,[o,b]=g.dimensions,a=e,s=e+o,t="circular"===I.spec().layout,n=null!=(A=Z.innerRadius)?A:220,V=null!=(l=Z.outerRadius)?l:300,y=null!=(i=Z.startAngle)?i:0,X=null!=(c=Z.endAngle)?c:360,G=V-n,B=o/2,W=b/2,h=null!=(d=I.getChannelDomainArray("row"))?d:["___SINGLE_ROW___"],p=b/h.length,H=I.getChannelScale("y"),u=I.getChannelDomainArray("y");if(!H||!u)return;if(t&&p/b*G<=20||!t&&p<=20)return;const Y=g.pBackground,K=C.axis.gridStrokeWidth;h.forEach((g=>{const A=I.encodedValue("row",g),l=t?p/b*G:p,i=Math.max(Math.ceil(l/40),1);let c=H.ticks(i).filter((g=>u[0]<=g&&g<=u[1]));1===c.length&&(c=H.ticks(i+1).filter((g=>u[0]<=g&&g<=u[1]))),t?c.forEach((g=>{const I=H(g),l=V-(A+p-I)/b*G,i=l+K/2,c=l-K/2,d=Hg(0,o,c,B,W,y,X),Z=pg(0,o,y,X),a=pg(o,o,y,X);Y.lineStyle(K,hg("black"),0,.5),Y.beginFill(hg(C.axis.gridColor),1),Y.moveTo(e+d.x,m+d.y),Y.arc(e+B,m+W,c,Z,a,!0),Y.arc(e+B,m+W,i,a,Z,!1),Y.closePath()})):(Y.lineStyle(K,hg(C.axis.gridColor),1,.5),c.forEach((g=>{var I;const l=m+A+p-H(g);if("solid"===C.axis.gridStrokeType)Y.moveTo(a,l),Y.lineTo(s,l);else if("dashed"===C.axis.gridStrokeType){const[g,A]=null!=(I=C.axis.gridStrokeDash)?I:[1,1];for(let I=a;I<s;I+=g+A)Y.moveTo(I,l),Y.lineTo(I+g,l)}})))}))}(g,I,C),function(g,I,C){var A,l,i,c;const d=I.spec();if(!Dg(d.row)||!0!==d.row.grid)return;const[Z,e]=g.position,[m,o]=g.dimensions,b="circular"===I.spec().layout,a=null!=(A=d.innerRadius)?A:220,s=null!=(l=d.outerRadius)?l:300,t=null!=(i=d.startAngle)?i:0,n=null!=(c=d.endAngle)?c:360,V=s-a,y=m/2,X=o/2,G=I.getChannelDomainArray("row");if(!G)return;const B=o/G.length;if(b&&V<=20||!b&&B<=20)return;const W=g.pBackground,h=C.axis.gridStrokeWidth;G.forEach((g=>{const A=I.encodedValue("row",g);if(b){const g=s-(A+B/2)/o*V,I=g+h/2,l=g-h/2,i=Hg(0,m,l,y,X,t,n),c=pg(0,m,t,n),d=pg(m,m,t,n);W.lineStyle(h,hg("black"),0,.5),W.beginFill(hg(C.axis.gridColor),1),W.moveTo(Z+i.x,e+i.y),W.arc(Z+y,e+X,l,c,d,!0),W.arc(Z+y,e+X,I,d,c,!1),W.closePath()}else{W.lineStyle(h,hg(C.axis.gridColor),1,.5);const g=e+A+B/2;W.moveTo(Z,g),W.lineTo(Z+m,g)}}))}(g,I,C)}const Rg={color:"black",size:10,fontFamily:"Arial",fontWeight:"normal",stroke:"#ffffff",strokeThickness:0};function rg(g=Rg){var I,C,A,l,i,c;return{fontSize:`${null!=(I=g.size)?I:Rg.size}px`,fontFamily:null!=(C=g.fontFamily)?C:Rg.fontFamily,fontWeight:null!=(A=g.fontWeight)?A:Rg.fontWeight,fill:null!=(l=g.color)?l:Rg.color,background:"white",lineJoin:"round",stroke:null!=(i=g.stroke)?i:Rg.stroke,strokeThickness:null!=(c=g.strokeThickness)?c:Rg.strokeThickness}}function Jg(g,I,C,A,l){const i=A.spec();if(Dg(i.color)&&i.color.legend)switch(i.color.type){case"nominal":!function(g,I,C,A,l){var i,c,d,m,o;const b=A.spec();if(!Dg(b.color)||"nominal"!==b.color.type||!b.color.legend)return;const a=null!=(i=A.getChannelDomainArray("color"))?i:["___SINGLE_COLOR___"];if(0===a.length)return;const s=I.pBorder,t=10,n=4;let V=n,y=0;const X=[],G=rg({color:l.legend.labelColor,size:l.legend.labelFontSize,fontWeight:l.legend.labelFontWeight,fontFamily:l.legend.labelFontFamily});if(null==(c=b.style)?void 0:c.inlineLegend)a.map((g=>g)).reverse().forEach((C=>{if(y>I.dimensions[0])return;const l=A.encodedValue("color",C),i=new g.libraries.PIXI.Text(C,G);i.anchor.x=1,i.anchor.y=0,i.position.x=I.position[0]+I.dimensions[0]-y-t,i.position.y=I.position[1]+n,s.addChild(i);const c=new g.libraries.PIXI.TextStyle(G),d=g.libraries.PIXI.TextMetrics.measureText(C,c);V<d.height+3*n&&(V=d.height+3*n),X.push({x:I.position[0]+I.dimensions[0]-d.width-y-2*t,y:I.position[1]+n+d.height/2,color:l}),y+=d.width+3*t}));else{if(null==(d=b.style)?void 0:d.legendTitle){const C=new g.libraries.PIXI.Text(null==(m=b.style)?void 0:m.legendTitle,e(Z({},G),{fontWeight:"bold"}));C.anchor.x=1,C.anchor.y=0,C.position.x=I.position[0]+I.dimensions[0]-t,C.position.y=I.position[1]+V;const A=new g.libraries.PIXI.TextStyle(e(Z({},G),{fontWeight:"bold"})),l=g.libraries.PIXI.TextMetrics.measureText(null==(o=b.style)?void 0:o.legendTitle,A);s.addChild(C),V+=l.height+2*n}a.forEach((C=>{if(V>I.dimensions[1])return;const l=A.encodedValue("color",C),i=new g.libraries.PIXI.Text(C,G);i.anchor.x=1,i.anchor.y=0,i.position.x=I.position[0]+I.dimensions[0]-t,i.position.y=I.position[1]+V,s.addChild(i);const c=new g.libraries.PIXI.TextStyle(G),d=g.libraries.PIXI.TextMetrics.measureText(C,c);y<d.width+3*t&&(y=d.width+3*t),X.push({x:I.position[0]+I.dimensions[0]-d.width-2*t,y:I.position[1]+V+d.height/2,color:l}),V+=d.height+2*n}))}s.beginFill(hg(l.legend.background),l.legend.backgroundOpacity),s.lineStyle(1,hg(l.legend.backgroundStroke),l.legend.backgroundOpacity,0),s.drawRect(I.position[0]+I.dimensions[0]-y-1,I.position[1]+1,y,V-n),X.forEach((g=>{s.lineStyle(1,hg("black"),0,0),s.beginFill(hg(g.color),1),s.drawCircle(g.x,g.y,4)}))}(g,I,0,A,l);break;case"quantitative":!function(g,I,C,A,l){const i=A.spec();if(!Dg(i.color)||"quantitative"!==i.color.type||!i.color.legend)return;const[c,d]=I.position,[Z,e]=I.dimensions,m=80,o=e-2>110?110:Math.max(e-2,38),b={top:10,left:55,width:20,height:o-20},a=c+Z-m-1,s=d+1,t=A.getChannelScale("color"),n=A.getChannelDomainArray("color");if(!t||!n)return;const V=I.pBorder;V.beginFill(hg(l.legend.background),l.legend.backgroundOpacity),V.lineStyle(1,hg(l.legend.backgroundStroke),l.legend.backgroundOpacity,0),V.drawRect(a,s,m,o);const[y,X]=n,G=X-y;[...Array(b.height).keys()].forEach((g=>{const I=(b.height-g)/b.height*G+y;V.beginFill(hg(t(I)),1),V.lineStyle(1,hg(l.legend.backgroundStroke),0,.5),V.drawRect(a+b.left,s+b.top+g,b.width,1)}));const B=Math.max(Math.ceil(b.height/30),2);let W=t.ticks(B).filter((g=>n[0]<=g&&g<=n[1]));1===W.length&&(W=t.ticks(B+1).filter((g=>n[0]<=g&&g<=n[1])));const h=1;V.lineStyle(h,hg(l.legend.tickColor),1,.5);const p=rg({color:l.legend.labelColor,size:l.legend.labelFontSize,fontWeight:l.legend.labelFontWeight,fontFamily:l.legend.labelFontFamily}),H=a+b.left;W.forEach((I=>{let C=s+b.top+b.height-(I-y)/G*b.height;C===s+b.top?C+=h/2:C===s+b.top+b.height&&(C-=h/2),V.moveTo(H-3,C),V.lineTo(H,C);const A=new g.libraries.PIXI.Text(I,p);A.anchor.x=1,A.anchor.y=.5,A.position.x=H-6,A.position.y=C,V.addChild(A)}))}(g,I,0,A,l)}}const wg=["x","xe","x1","x1e","y","ye","y1","y1e","color","size","row","stroke","strokeWidth","opacity","text"];function Sg(g,I,C,A){if(!g||!I||!C)return;if("brush"===A.spec().mark)return;if(["x","x1","x1e","xe"].forEach((g=>{A.setChannelScale(g,I._xScale)})),Mg(A.spec())){const g=I._yScale.copy();g.range([g.range()[1],g.range()[0]]),["y","y1","y1e","ye"].forEach((I=>{A.setChannelScale(I,g)}))}const[l,i]=I.dimensions;switch(A.spec().mark){case"point":!function(g,I,C){var A,l,i,c,d;const Z=C.spec();if(!Z.width||!Z.height)return void console.warn("Size of a track is not properly determined, so visual mark cannot be rendered");const e=C.data(),[m,o]=g.dimensions,b=C.getChannelScale("x").invert(m)-C.getChannelScale("x").invert(0),a="circular"===Z.layout,s=null!=(A=Z.innerRadius)?A:220,t=null!=(l=Z.outerRadius)?l:300,n=null!=(i=Z.startAngle)?i:0,V=null!=(c=Z.endAngle)?c:360,y=t-s,X=m/2,G=o/2,B=null!=(d=C.getChannelDomainArray("row"))?d:["___SINGLE_ROW___"],W=o/B.length;B.forEach((A=>{const l=C.encodedValue("row",A);e.filter((g=>!Pg(g,Z.row)||Pg(g,Z.row)===A)).forEach((A=>{const i=C.encodedPIXIProperty("x-center",A),c=C.encodedPIXIProperty("y-center",A),d=C.encodedPIXIProperty("color",A),Z=C.encodedPIXIProperty("p-size",A),e=C.encodedPIXIProperty("strokeWidth",A),s=C.encodedPIXIProperty("stroke",A),B=C.encodedPIXIProperty("opacity",A),h=C.markVisibility(A,{width:Z,zoomLevel:b}),p=Math.min(h,B);if(!(Z<=.1||0===p||i+Z<0||i-Z>m))if(I.lineStyle(e,hg(s),p,1),a){const g=Hg(i,m,t-(l+W-c)/o*y,X,G,n,V);I.beginFill(hg(d),p),I.drawCircle(g.x,g.y,Z)}else if(I.beginFill(hg(d),p),I.drawCircle(i,l+W-c,Z),null==g?void 0:g.tooltips){const I=l+W-c;g.tooltips.push({datum:A,isMouseOver:(g,C)=>Math.sqrt(Math.abs(g-i)*Math.abs(g-i)+Math.abs(C-I)*Math.abs(C-I))<Z+1,markInfo:{x:i,y:l+W-c,width:Z,height:Z,type:"point"}})}}))}))}(I,C.graphics,A);break;case"bar":!function(g,I,C){var A,l,i,c,d,Z,e;const m=C.spec();if(!m.width||!m.height)return void console.warn("Size of a track is not properly determined, so visual mark cannot be rendered");const o=C.data(),[a,s]=g.dimensions,t=g.tilesetInfo.tile_size,{tileX:n,tileWidth:V}=g.getTilePosAndDimensions(I.gos.zoomLevel,I.gos.tilePos,t),y=C.getChannelScale("x").invert(a)-C.getChannelScale("x").invert(0),X="circular"===m.layout,G=null!=(A=m.innerRadius)?A:220,B=null!=(l=m.outerRadius)?l:300,W=null!=(i=m.startAngle)?i:0,h=null!=(c=m.endAngle)?c:360,p=B-G,H=a/2,u=s/2,Y=C.getChannelScale("x"),K=Y(n+V/t)-Y(n),R=null!=(d=C.getChannelDomainArray("row"))?d:["___SINGLE_ROW___"],r=s/R.length,J=Dg(m.y)?null==(Z=m.y)?void 0:Z.baseline:void 0,w=null!=(e=C.encodedValue("y",J))?e:0,S=I.graphics;if(Og(m)){const I=C.getGenomicChannel();if(!I||!I.field)return void console.warn("Genomic field is not provided in the specification");const A=b(o,(g=>g[I.field]));[...A.keys()].forEach((I=>{var l;let i=0;null==(l=A.get(I))||l.forEach((I=>{const A=C.encodedPIXIProperty("color",I),l=C.encodedPIXIProperty("stroke",I),c=C.encodedPIXIProperty("strokeWidth",I),d=C.encodedPIXIProperty("opacity",I),Z=C.encodedPIXIProperty("y",I),e=C.encodedPIXIProperty("width",I,{tileUnitWidth:K}),o=C.encodedPIXIProperty("x-start",I,{markWidth:e}),b=o+e,t=C.markVisibility(I,{width:e,zoomLevel:y}),n=Math.min(t,d);if(!(0===n||e<=0||Z<=0)){if(S.lineStyle(c,hg(l),n,0),X){const g=B-(r-i)/s*p,I=B-(r-Z-i)/s*p,C=Hg(o,a,I,H,u,W,h),l=pg(o,a,W,h),c=pg(o+e,a,W,h);S.beginFill(hg(A),n),S.moveTo(C.x,C.y),S.arc(H,u,I,l,c,!0),S.arc(H,u,g,c,l,!1),S.closePath()}else{const C=r-Z-i,l=Z;S.beginFill(hg(A),n),S.drawRect(o,r-Z-i,e,Z),m.tooltip&&g.tooltips.push({datum:I,isMouseOver:(g,I)=>o-1<g&&g<b+1&&C-1<I&&I<C+l+1,markInfo:{x:o,y:C,width:e,height:l,type:"bar"}})}i+=Z}}))}))}else R.forEach((I=>{const A=C.encodedValue("row",I);o.filter((g=>{const C=Pg(g,m.row);return!C||C===I})).forEach((I=>{const l=C.encodedPIXIProperty("color",I),i=C.encodedPIXIProperty("stroke",I),c=C.encodedPIXIProperty("strokeWidth",I),d=C.encodedPIXIProperty("opacity");let Z=C.encodedPIXIProperty("y",I),e=C.encodedPIXIProperty("ye",I);void 0!==e&&([Z,e]=[Z,e].sort());const o=C.encodedPIXIProperty("width",I,{tileUnitWidth:K}),b=C.encodedPIXIProperty("x-start",I,{markWidth:o}),t=b+o;let n,V;void 0===e?(n=A+r-w-Z,V=A+r-w):(n=A+r-e,V=A+r-Z);const G=C.markVisibility(I,{width:o,zoomLevel:y}),Y=Math.min(G,d);if(0!==Y&&0!==o&&0!==Z)if(S.lineStyle(c,hg(i),Y,0),X){const g=B-n/s*p,I=B-V/s*p,C=Hg(b,a,I,H,u,W,h),A=pg(b,a,W,h),i=pg(b+o,a,W,h);S.beginFill(hg(l),Y),S.moveTo(C.x,C.y),S.arc(H,u,I,A,i,!0),S.arc(H,u,g,i,A,!1),S.closePath()}else if(S.beginFill(hg(l),Y),S.drawRect(b,n,o,V-n),m.tooltip){const C=V-n;g.tooltips.push({datum:I,isMouseOver:(g,I)=>b-1<g&&g<t+1&&n-1<I&&I<V+1,markInfo:{x:b,y:n,width:o,height:C,type:"bar"}})}}))}))}(I,C,A);break;case"line":!function(g,I,C,A,l){var i,c,d,Z,e,m;const o=I.spec();if(!o.width||!o.height)return void console.warn("Size of a track is not properly determined, so visual mark cannot be rendered");const b=I.data(),a="circular"===o.layout,s=null!=(i=o.innerRadius)?i:220,t=null!=(c=o.outerRadius)?c:300,n=null!=(d=o.startAngle)?d:0,V=null!=(Z=o.endAngle)?Z:360,y=t-s,X=A/2,G=l/2,B=null!=(e=I.getChannelDomainArray("row"))?e:["___SINGLE_ROW___"],W=l/B.length,h=null!=(m=I.getChannelDomainArray("color"))?m:["___SINGLE_COLOR___"];B.forEach((i=>{const c=I.encodedValue("row",i);h.forEach((d=>{b.filter((g=>!(Pg(g,o.row)&&Pg(g,o.row)!==i||Pg(g,o.color)&&Pg(g,o.color)!==d))).sort(((g,I)=>Pg(g,o.x)-Pg(I,o.x))).forEach(((i,d)=>{const Z=I.encodedPIXIProperty("x",i),e=I.encodedPIXIProperty("y",i),m=I.encodedPIXIProperty("size",i),b=I.encodedPIXIProperty("color",i),s=I.encodedPIXIProperty("opacity",i);if(g.lineStyle(m,hg(b),s,.5),a){const I=Hg(Z,A,t-(c+W-e)/l*y,X,G,n,V);0===d?g.moveTo(I.x,I.y):g.lineTo(I.x,I.y)}else 0===d?g.moveTo(Z,c+W-e):g.lineTo(Z,c+W-e),o.tooltip&&C.push({datum:i,isMouseOver:(g,I)=>Z-1<g&&g<Z+1&&c-1<I&&I<c+W+1,markInfo:{x:Z,y:e,width:1,height:e,type:"line"}})}))}))}))}(C.graphics,A,I.tooltips,l,i);break;case"area":!function(g,I,C,A){var l,i,c,d,Z,e;const m=A.spec(),o=A.data(),t=I.dimensions[0],n=I.dimensions[1],V=I.tilesetInfo.tile_size,{tileX:y}=I.getTilePosAndDimensions(C.gos.zoomLevel,C.gos.tilePos,V),X="circular"===m.layout,G=null!=(l=m.innerRadius)?l:220,B=null!=(i=m.outerRadius)?i:300,W=null!=(c=m.startAngle)?c:0,h=null!=(d=m.endAngle)?d:360,p=B-G,H=t/2,u=n/2,Y=A.getChannelScale("x"),K=null!=(Z=A.getChannelDomainArray("row"))?Z:["___SINGLE_ROW___"],R=n/K.length,r=null!=(e=A.getChannelDomainArray("color"))?e:["___SINGLE_COLOR___"],J=A.encodedPIXIProperty("opacity"),w=A.encodedPIXIProperty("strokeWidth"),S=A.encodedPIXIProperty("stroke"),F=C.graphics;if(Og(m)){const g=A.getGenomicChannel();if(!g||!g.field)return void console.warn("Genomic field is not provided in the specification");const C=b(o,(I=>I[g.field])),l=[...C.keys()];F.lineStyle(w,hg(S),J,1);const i={};r.forEach((g=>{const c=[],d=[];l.forEach(((l,Z,e)=>{var o,b;null==(b=null==(o=C.get(l))?void 0:o.filter((I=>Pg(I,m.color)===g)))||b.forEach((g=>{const C=Y(+l),o=a([A.encodedPIXIProperty("y",g),0]);if(X){if(0===Z){const g=Hg(C,t,B-R/n*p,H,u,W,h);c.push([g.x,g.y]),d.push([g.x,g.y])}void 0===i[l]&&(i[l]=0);const g=B-(R-o-i[l])/n*p,I=Hg(C,t,g,H,u,W,h);c.push([I.x,I.y]);const A=B-(R-i[l])/n*p,m=Hg(C,t,A,H,u,W,h);if(d.push([m.x,m.y]),Z===e.length-1){const g=Hg(C,t,B-R/n*p,H,u,W,h);c.push([g.x,g.y]),d.push([g.x,g.y])}}else if(0===Z&&(c.push([C,R]),d.push([C,R])),void 0===i[l]&&(i[l]=0),c.push([C,R-o-i[l]]),d.push([C,R-i[l]]),Z===e.length-1&&(c.push([C,R]),d.push([C,R])),m.tooltip){const A=R-o-i[l],c=R-i[l];I.tooltips.push({datum:g,isMouseOver:(g,I)=>C-1<g&&g<C+1&&A-1<I&&I<c+1,markInfo:{x:C,y:A,width:1,height:o,type:"area"}})}i[l]+=o}))}));const Z=A.encodedValue("color",g);F.beginFill(hg(Z),J),F.drawPolygon([...c.reduce(((g,I)=>g.concat(I))),...d.reverse().reduce(((g,I)=>g.concat(I)))]),F.endFill()}))}else K.forEach((g=>{const C=A.encodedValue("row",g);F.lineStyle(w,hg(S),J,0),r.forEach((l=>{const i=[],c=[],d=B-(C+R)/n*p;o.filter((I=>!(void 0!==Pg(I,m.row)&&Pg(I,m.row)!==g||void 0!==Pg(I,m.color)&&Pg(I,m.color)!==l))).sort(((g,I)=>A.encodedPIXIProperty("x",g)-A.encodedPIXIProperty("x",I))).forEach(((g,l,Z)=>{const e=s([a([A.encodedPIXIProperty("y",g),0]),R]),o=A.encodedPIXIProperty("x",g);if(X){const g=Hg(o,t,d,H,u,W,h);i.push([g.x,g.y]),0===l&&c.push(g.x,g.y);const I=Hg(o,t,B-(C+R-e)/n*p,H,u,W,h);if(c.push(I.x,I.y),l===Z.length-1){const g=Hg(o,t,B-(C+R)/n*p,H,u,W,h);c.push(g.x,g.y)}}else{if(0===l&&c.push(o,C+R),c.push(o,C+R-e),l===Z.length-1){const g=Y(y);c.push(o,C+R),c.push(g,C+R)}m.tooltip&&I.tooltips.push({datum:g,isMouseOver:(g,I)=>o-1<g&&g<o+1&&C-1<I&&I<C+R+1,markInfo:{x:o,y:e,width:1,height:e,type:"area"}})}})),X&&0!==i.length&&c.push(...i.reverse().reduce(((g,I)=>g.concat(I))));const Z=A.encodedValue("color",l);F.beginFill(hg(Z),J),F.drawPolygon(c),F.endFill()}))}))}(0,I,C,A);break;case"rect":!function(g,I,C,A){var l,i,c,d,Z,e;const m=A.spec(),o=A.data(),[b,a]=I.dimensions,s=I.tilesetInfo.tile_size,{tileX:t,tileWidth:n}=I.getTilePosAndDimensions(C.gos.zoomLevel,C.gos.tilePos,s),V="circular"===m.layout,y=null!=(l=m.innerRadius)?l:220,X=null!=(i=m.outerRadius)?i:300,G=null!=(c=m.startAngle)?c:0,B=null!=(d=m.endAngle)?d:360,W=X-y,h=b/2,p=a/2,H=I._xScale,u=H(t+n/s)-H(t),Y=null!=(Z=A.getChannelDomainArray("row"))?Z:["___SINGLE_ROW___"],K=a/Y.length,R=Dg(m.row)&&m.row.padding?m.row.padding:0,r=null!=(e=A.getChannelDomainArray("y"))?e:["___SINGLE_Y_POSITION___"],J=K/r.length-2*R,w=C.graphics;o.forEach((g=>{var C;const l=A.encodedPIXIProperty("row",g)+R,i=A.encodedPIXIProperty("x",g),c=A.encodedPIXIProperty("color",g),d=A.encodedPIXIProperty("stroke",g),Z=A.encodedPIXIProperty("strokeWidth",g),e=A.encodedPIXIProperty("opacity",g),o=A.encodedPIXIProperty("width",g,{markWidth:u}),s=A.encodedPIXIProperty("height",g,{markHeight:J}),t=A.encodedPIXIProperty("y",g),n=A.markVisibility(g,{width:o,zoomLevel:I._xScale.invert(b)-I._xScale.invert(0)}),y=Math.min(n,e);if(0===y||0===s||o<=1e-4)return;const H=i,Y=i+o,r=null!=(C=A.visualPropertyByChannel("size",g))?C:void 0;if(w.lineStyle(Z,hg(d),y,.5),V){if(Y<0||b<H)return;let g=X-(l+K-t-s/2)/a*W,I=X-(l+K-t+s/2)/a*W;if(r){const C=X-(l+t)/a*W;g=C-r/2,I=C+r/2}const C=Hg(H,b,I,h,p,G,B),A=pg(H,b,G,B),i=pg(Y,b,G,B);w.beginFill(hg("none"===c?"white":c),"none"===c?0:y),w.moveTo(C.x,C.y),w.arc(h,p,I,A,i,!0),w.arc(h,p,g,i,A,!1),w.closePath()}else w.beginFill(hg("none"===c?"white":c),"none"===c?0:y),w.drawRect(H,l+K-t-s/2,Y-H,s),m.tooltip&&I.tooltips.push({datum:g,isMouseOver:(g,I)=>H-1<g&&g<Y+1&&l+K-t-s/2-1<I&&I<l+K-t+s/2+1,markInfo:{x:H,y:l+K-t-s/2,width:Y-H,height:s,type:"rect"}})}))}(0,I,C,A);break;case"triangleLeft":case"triangleRight":case"triangleBottom":!function(g,I,C,A){var l,i,c,d,Z,e,m;const o=I.spec();if(!o.width||!o.height)return void console.warn("Size of a track is not properly determined, so visual mark cannot be rendered");const b=I.data(),a=I.getChannelScale("x").invert(C)-I.getChannelScale("x").invert(0),s="circular"===o.layout,t=null!=(l=o.innerRadius)?l:220,n=null!=(i=o.outerRadius)?i:300,V=null!=(c=o.startAngle)?c:0,y=null!=(d=o.endAngle)?d:360,X=n-t,G=C/2,B=A/2,W=null!=(Z=I.getChannelDomainArray("row"))?Z:["___SINGLE_ROW___"],h=A/W.length,p=null!=(e=I.getChannelDomainArray("y"))?e:["___SINGLE_Y___"],H=null!=(m=I.encodedValue("size"))?m:s?X/W.length/p.length:h/p.length;W.forEach((l=>{const i=I.encodedValue("row",l);b.filter((g=>!Pg(g,o.row)||Pg(g,o.row)===l)).forEach((l=>{var c,d,Z;const e=I.encodedPIXIProperty("x",l),m=I.encodedPIXIProperty("xe",l),b=null!=(c=I.encodedPIXIProperty("size",l))?c:void 0===m?H:m-e,t=I.encodedPIXIProperty("y",l),W=I.encodedPIXIProperty("strokeWidth",l),p=I.encodedPIXIProperty("stroke",l),u=I.encodedPIXIProperty("color",l),Y=I.encodedPIXIProperty("opacity",l);if(s){let c=e||m-b,Z=m||e+b,s=(c+Z)/2;const K=n-(i+h-t)/A*X,R=K-H/2,r=K+H/2;"right"!==(null==(d=o.style)?void 0:d.align)||m||(c-=b,Z-=b,s-=b);let J=[];if("triangleLeft"===o.mark){const g=Hg(Z,C,R,G,B,V,y),I=Hg(c,C,K,G,B,V,y),A=Hg(Z,C,r,G,B,V,y),l=Hg(Z,C,R,G,B,V,y);J=[g.x,g.y,I.x,I.y,A.x,A.y,l.x,l.y]}else if("triangleRight"===o.mark){const g=Hg(c,C,R,G,B,V,y),I=Hg(Z,C,K,G,B,V,y),A=Hg(c,C,r,G,B,V,y),l=Hg(c,C,R,G,B,V,y);J=[g.x,g.y,I.x,I.y,A.x,A.y,l.x,l.y]}else if("triangleBottom"===o.mark){c=s-b/2,Z=s+b/2;const g=Hg(c,C,r,G,B,V,y),I=Hg(Z,C,r,G,B,V,y),A=Hg(s,C,R,G,B,V,y),l=Hg(c,C,r,G,B,V,y);J=[g.x,g.y,I.x,I.y,A.x,A.y,l.x,l.y]}const w=I.markVisibility(l,{width:Z-c,zoomLevel:a}),S=Math.min(w,Y);g.lineStyle(W,hg(p),Z-c>2?S:0,0),g.beginFill(hg(u),S),g.drawPolygon(J),g.endFill()}else{let C=e||m-b,A=m||e+b,c=C+(A-C)/2;const d=i+h-t,s=i+h-t-H/2,n=i+h-t+H/2;"right"!==(null==(Z=o.style)?void 0:Z.align)||m||(C-=b,A-=b,c-=b);const V={triangleLeft:[A,s,C,d,A,n,A,s],triangleRight:[C,s,A,d,C,n,C,s],triangleBottom:[C,s,A,s,c,n,C,s]}[o.mark],y=I.markVisibility(l,{width:A-C,zoomLevel:a}),X=Math.min(y,Y);g.lineStyle(W,hg(p),A-C>2?X:0,.5),g.beginFill(hg(u),X),g.drawPolygon(V),g.endFill()}}))}))}(C.graphics,A,l,i);break;case"text":!function(g,I,C,A){var l,i,c,d,m,o,a,s,t;const n=A.spec(),V=A.data(),[y,X]=I.dimensions,G="circular"===n.layout,B=null!=(l=n.innerRadius)?l:220,W=null!=(i=n.outerRadius)?i:300,h=null!=(c=n.startAngle)?c:0,p=null!=(d=n.endAngle)?d:360,H=W-B,u=y/2,Y=X/2,K=null!=(m=A.getChannelDomainArray("row"))?m:["___SINGLE_ROW___"],R=X/K.length,r=null!=(a=null==(o=n.style)?void 0:o.dx)?a:0,J=null!=(t=null==(s=n.style)?void 0:s.dy)?t:0;if(Og(n)){if(G)return;const l=C.graphics,i=A.getGenomicChannel();if(!i||!i.field)return void console.warn("Genomic field is not provided in the specification");const c=b(V,(g=>g[i.field]));[...c.keys()].forEach((C=>{var i;let d=0;null==(i=c.get(C))||i.forEach((C=>{var i,c,m,o,b,a,s,t;const V=A.encodedPIXIProperty("text",C),X=A.encodedPIXIProperty("color",C),G=A.encodedPIXIProperty("x",C)+r,B=A.encodedPIXIProperty("xe",C)+r,W=A.encodedPIXIProperty("x-center",C)+r,h=A.encodedPIXIProperty("y",C)+J,p=A.encodedPIXIProperty("size",C),H=A.encodedPIXIProperty("stroke",C),u=A.encodedPIXIProperty("strokeWidth",C),Y=A.encodedPIXIProperty("opacity",C);if(W<0||W>y)return;if(I.textsBeingUsed>1e3)return;const K=e(Z({},Yg),{fontSize:null!=p?p:(null==(i=n.style)?void 0:i.textFontSize)?`${null==(c=n.style)?void 0:c.textFontSize}px`:Yg.fontSize,stroke:null!=(o=null!=H?H:null==(m=n.style)?void 0:m.textStroke)?o:Yg.stroke,strokeThickness:null!=(a=null!=u?u:null==(b=n.style)?void 0:b.textStrokeWidth)?a:Yg.strokeThickness,fontWeight:null!=(t=null==(s=n.style)?void 0:s.textFontWeight)?t:Yg.fontWeight}),w=new g.libraries.PIXI.TextStyle(K);let S;I.textGraphics.length>I.textsBeingUsed?(S=I.textGraphics[I.textsBeingUsed],S.style.fill=X,S.visible=!0,S.text=V,S.alpha=1):(S=new g.libraries.PIXI.Text(V,e(Z({},K),{fill:X})),I.textGraphics.push(S));const F=g.libraries.PIXI.TextMetrics.measureText(V,w);I.textsBeingUsed++;const k=A.markVisibility(C,e(Z({},F),{zoomLevel:I._xScale.invert(y)-I._xScale.invert(0)})),v=Math.min(k,Y);if(!V||0===v)return I.textsBeingUsed--,void(S.visible=!1);S.alpha=v,S.resolution=8,S.updateText(),S.texture.baseTexture.scaleMode=g.libraries.PIXI.SCALE_MODES.LINEAR;const N=new g.libraries.PIXI.Sprite(S.texture);N.x=G,N.y=R-h-d,N.width=B-G,N.height=h,l.addChild(N),d+=h}))}))}else K.forEach((l=>{const i=C.graphics,c=A.encodedValue("row",l);V.filter((g=>!Pg(g,n.row)||Pg(g,n.row)===l)).forEach((C=>{var l,d,m,o,b,a,s,t,V,B;const K=A.encodedPIXIProperty("text",C),w=A.encodedPIXIProperty("color",C),S=A.encodedPIXIProperty("x-center",C)+r,F=A.encodedPIXIProperty("y",C)+J,k=A.encodedPIXIProperty("size",C),v=A.encodedPIXIProperty("stroke",C),N=A.encodedPIXIProperty("strokeWidth",C),f=A.encodedPIXIProperty("opacity",C);if(S<0||S>y)return;if(I.textsBeingUsed>1e3)return;const z=e(Z({},Yg),{fontSize:null!=k?k:(null==(l=n.style)?void 0:l.textFontSize)?`${null==(d=n.style)?void 0:d.textFontSize}px`:Yg.fontSize,stroke:null!=(o=null!=v?v:null==(m=n.style)?void 0:m.textStroke)?o:Yg.stroke,strokeThickness:null!=(a=null!=N?N:null==(b=n.style)?void 0:b.textStrokeWidth)?a:Yg.strokeThickness,fontWeight:null!=(t=null==(s=n.style)?void 0:s.textFontWeight)?t:Yg.fontWeight}),x=new g.libraries.PIXI.TextStyle(z);let U;I.textGraphics.length>I.textsBeingUsed?(U=I.textGraphics[I.textsBeingUsed],U.style.fill=w,U.visible=!0,U.text=K,U.alpha=1):(U=new g.libraries.PIXI.Text(K,e(Z({},z),{fill:w})),I.textGraphics.push(U));const M=g.libraries.PIXI.TextMetrics.measureText(K,x);I.textsBeingUsed++;const L=A.markVisibility(C,e(Z({},M),{zoomLevel:I._xScale.invert(y)-I._xScale.invert(0)})),T=Math.min(L,f);if(!K||0===T)return I.textsBeingUsed--,void(U.visible=!1);if(U.alpha=T,U.anchor.x=(null==(V=n.style)?void 0:V.textAnchor)&&"middle"!==(null==(B=n.style)?void 0:B.textAnchor)?"start"===n.style.textAnchor?0:1:.5,U.anchor.y=.5,G){const I=W-(c+R-F)/X*H,C=Hg(S,y,I,u,Y,h,p);U.x=C.x,U.y=C.y,U.resolution=4;const A=new g.libraries.PIXI.TextStyle(x),l=g.libraries.PIXI.TextMetrics.measureText(U.text,A).width/(2*I*Math.PI)*y;let[d,Z]=[S-l/2,S+l/2];if(d<0){const g=-d;d=0,Z+=g}else if(Z>y){const g=Z-y;Z=y,d-=g}const e=[];for(let i=Z;i>=d;i-=l/10){const C=Hg(i,y,I,u,Y,h,p);e.push(new g.libraries.PIXI.Point(C.x,C.y))}U.updateText();const m=new g.libraries.PIXI.SimpleRope(U.texture,e);m.alpha=T,i.addChild(m)}else U.position.x=S,U.position.y=c+R-F,i.addChild(U)}))}))}(g,I,C,A);break;case"rule":!function(g,I,C,A){var l,i,c,d,Z,e,m,o;const b=A.spec(),a=A.data(),[s,t]=I.dimensions,n="circular"===b.layout,V=null!=(l=b.innerRadius)?l:220,y=null!=(i=b.outerRadius)?i:300,X=null!=(c=b.startAngle)?c:0,G=null!=(d=b.endAngle)?d:360,B=y-V,W=s/2,h=t/2,p=null!=(Z=A.getChannelDomainArray("row"))?Z:["___SINGLE_ROW___"],H=t/p.length,u=null==(e=b.style)?void 0:e.dashed,Y=null==(m=b.style)?void 0:m.linePattern,K=null==(o=b.style)?void 0:o.curve,R=C.graphics;p.forEach((g=>{const C=A.encodedValue("row",g);a.filter((I=>!Pg(I,b.row)||Pg(I,b.row)===g)).forEach((g=>{const l=A.encodedPIXIProperty("x",g),i=A.encodedPIXIProperty("xe",g),c=A.encodedPIXIProperty("y",g),d=A.encodedPIXIProperty("color",g),Z=A.encodedPIXIProperty("strokeWidth",g),e=A.encodedPIXIProperty("opacity",g),m=A.markVisibility(g,{width:i-l,zoomLevel:I._xScale.invert(s)-I._xScale.invert(0)}),o=Math.min(m,e);if(R.lineStyle(Z,hg(d),o,.5),n){if(0===Z)return;R.lineStyle(Z,hg(d),0,.5);const g=y-(C+c)/t*B,I=g+Z/2,A=g-Z/2,e=Hg(l,s,A,W,h,X,G),m=pg(l,s,X,G),b=pg(i,s,X,G);R.beginFill(hg(d),o),R.moveTo(e.x,e.y),R.arc(W,h,A,m,b,!0),R.arc(W,h,I,b,m,!1),R.closePath()}else if(u){const[g,I]=u;let A=l;do{R.moveTo(A,C+H-c),R.lineTo(A+g,C+H-c),A+=g+I}while(A<i)}else if(void 0===K)R.moveTo(l,C+H-c),R.lineTo(i,C+H-c);else if("top"===K){const g=2,I=l+(i-l)/2;R.moveTo(l,C+H-c+g/2),R.lineTo(I,C+H-c-g/2),R.moveTo(I,C+H-c-g/2),R.lineTo(i,C+H-c+g/2)}if(Y&&void 0===K&&!n){const{type:g,size:I}=Y;let A=Math.max(l,0);R.lineStyle(0);const Z=2*I;let e=0;for(;A<Math.min(i,s)&&e<100;){const l=A,i=A+I,m=C+H-c,b=m-I/2,a=m+I/2;R.beginFill(hg(d),o),R.drawPolygon("triangleLeft"===g?[i,b,l,m,i,a,i,b]:[l,b,i,m,l,a,l,b]),R.endFill(),A+=I+Z,e++}}}))}))}(0,I,C,A);break;case"betweenLink":case"withinLink":!function(g,I,C){var A,l,i,c,d;const Z=C.spec();if(!Z.width||!Z.height)return void console.warn("Size of a track is not properly determined, so visual mark cannot be rendered");const e=C.data(),[m,o]=I.dimensions,b="circular"===Z.layout,a=null!=(A=Z.innerRadius)?A:220,s=null!=(l=Z.outerRadius)?l:300,n=null!=(i=Z.startAngle)?i:0,V=null!=(c=Z.endAngle)?c:360,y=s-a,X=m/2,G=o/2,B=null!=(d=C.getChannelDomainArray("row"))?d:["___SINGLE_ROW___"],W=o/B.length;B.forEach((A=>{const l=C.encodedValue("row",A);e.filter((g=>!Pg(g,Z.row)||Pg(g,Z.row)===A)).forEach((A=>{var i,c,d,e,a;let B=C.encodedPIXIProperty("x",A),h=C.encodedPIXIProperty("xe",A);const p=C.encodedPIXIProperty("x1",A),H=C.encodedPIXIProperty("x1e",A),u=C.encodedPIXIProperty("y",A),Y=C.encodedPIXIProperty("stroke",A),K=C.encodedPIXIProperty("strokeWidth",A),R=C.encodedPIXIProperty("color",A),r=C.encodedPIXIProperty("opacity",A),J=void 0!==h&&void 0!==H&&Math.abs(B-h)>.1&&Math.abs(p-H)>.1;if(!J&&void 0===h&&!Mg(Z)){if(void 0===p&&void 0===H)return;h=void 0!==p?p:H}!J&&Math.abs(B-h)<=.1&&Math.abs(p-H)<=.1&&(B=(B+h)/2,h=(p+H)/2),g.lineStyle(K,hg(Y),r,.5);const w=Dg(Z.y)&&Z.y.flip||Z.flipY,S=l+(w?0:W);if(J){g.beginFill(hg("none"===R?"white":R),"none"===R?0:r);let[I,C,A,c]=[B,h,p,H];if("betweenLink"===Z.mark?([I,C]=[I,C].sort(((g,I)=>g-I)),[A,c]=[A,c].sort(((g,I)=>g-I))):[I,C,A,c]=[I,C,A,c].sort(((g,I)=>g-I)),I>m||c<0||Math.abs(c-I)<.5)return;if(b){if(I<0||c>m)return;const i=s-l/o*y,d=Hg(I,m,i,X,G,n,V),Z=Hg(C,m,i,X,G,n,V),e=Hg(A,m,i,X,G,n,V),b=Hg(c,m,i,X,G,n,V);g.moveTo(d.x,d.y),g.bezierCurveTo(X,G,X,G,b.x,b.y),g.arc(X,G,s,ug(b.x,b.y,X,G),ug(e.x,e.y,X,G),!1),g.bezierCurveTo(X,G,X,G,Z.x,Z.y),g.arc(X,G,s,ug(Z.x,Z.y,X,G),ug(d.x,d.y,X,G),!1),g.endFill()}else{if("betweenLink"===Z.mark)return g.moveTo(I,l),g.lineTo(C,l),g.lineTo(c,l+W),g.lineTo(A,l+W),g.lineTo(I,l),void g.closePath();g.moveTo(I,S),null==(i=Z.style)||i.bazierLink,g.arc((I+c)/2,S,(c-I)/2,-Math.PI,Math.PI,!1),g.arc((C+A)/2,S,(A-C)/2,Math.PI,-Math.PI,!0),g.closePath()}}else{if(Mg(Z)&&"betweenLink"===Z.mark)return void("curve"===(null==(c=Z.style)?void 0:c.linkConnectionType)?(g.moveTo(B,0),g.bezierCurveTo(B/5*4,(l+W-u)/2,B/2,(l+W-u)/5*4,0,l+W-u)):"straight"===(null==(d=Z.style)?void 0:d.linkConnectionType)?(g.moveTo(B,0),g.lineTo(0,l+W-u)):(g.moveTo(B,0),g.lineTo(B,l+W-u),g.lineTo(0,l+W-u)));if("betweenLink"===Z.mark&&b){let I,C;for(let A=0;A<=1;A+=.02){const l=g=>Math.log(g/(1-g)),i=g=>s-1/(1+Math.exp(l(g)))*y+3,c=(g,I,C)=>((C-I)*g+I)/m,d=X+i(A)*Math.cos(2*-c(A,B,h)*Math.PI-Math.PI/2),Z=G+i(A)*Math.sin(2*-c(A,B,h)*Math.PI-Math.PI/2);I&&C&&(g.lineStyle(K,hg(Y),r,.5),g.moveTo(I,C),g.lineTo(d,Z)),I=d,C=Z}return}if("betweenLink"===Z.mark)return g.moveTo(h,l+W),void g.lineTo(B,l);if(h-B<=.1)return;const C=(B+h)/2;if(g.beginFill(hg("white"),0),b){if(B<0||h>m)return;const I=s-l/o*y,C=Hg(B,m,I,X,G,n,V),A=Hg(h,m,I,X,G,n,V);g.moveTo(C.x,C.y),g.bezierCurveTo(C.x,C.y,m/2,o/2,A.x,A.y)}else if(g.moveTo(B,S),null==(e=Z.style)?void 0:e.bazierLink){const C=B,l=S,i=B+(h-B)/3,c=S+Math.min(W,(h-B)/2)*(w?1:-1),d=B+(h-B)/3*2,e=S+Math.min(W,(h-B)/2)*(w?1:-1),m=h,o=S;g.bezierCurveTo(i,c,d,e,m,o);const b=new t(C,l,i,c,d,e,m,o).getLUT(1e3);Z.tooltip&&I.tooltips.push({datum:A,isMouseOver:(g,I)=>-1!==b.findIndex((C=>Math.sqrt((C.x-g)**2+(C.y-I)**2)<5)),markInfo:{}})}else if(null==(a=Z.style)?void 0:a.flatWithinLink){const I=h-B,C=Math.min(10,I/2),A=l+W-u;w?(g.moveTo(B,S),g.lineTo(B,A-C),g.arc(B+C,A-C,C,-Math.PI,Math.PI/2,!0),g.lineTo(h-C,A),g.arc(h-C,A-C,C,Math.PI/2,0,!0),g.lineTo(h,S)):(g.moveTo(B,S),g.lineTo(B,A+C),g.arc(B+C,A+C,C,-Math.PI,-Math.PI/2),g.lineTo(h-C,A),g.arc(h-C,A+C,C,-Math.PI/2,0),g.lineTo(h,S))}else{if(h<0||B>m)return;g.arc(C,S,(h-B)/2,-Math.PI,Math.PI),g.closePath()}}}))}))}(C.graphics,I,A);break;default:console.warn("Unsupported mark type")}}function Fg(g,I,C,A,l){if(!g||!I||!C)return;if("brush"===A.spec().mark)return;I.pBackground.clear(),I.pBackground.removeChildren(),I.pBorder.clear(),I.pBorder.removeChildren();const i="circular"===A.spec().layout;["x","x1","x1e","xe"].forEach((g=>{A.setChannelScale(g,I._xScale)})),i?function(g,I,C,A,l){var i,c,d,Z,e,m,o,b,a,s,t,n;const V=A.spec(),[y,X]=I.position,[G,B]=I.dimensions,W=null!=(i=V.innerRadius)?i:220,h=null!=(c=V.outerRadius)?c:300,p=null!=(d=V.startAngle)?d:0,H=null!=(Z=V.endAngle)?Z:360,u=y+G/2,Y=X+B/2,K=Hg(0,G,W,u,Y,p,H),R=pg(0,G,p,H),r=pg(G,G,p,H),J=I.pBackground;"circular"===V.layout&&"withinLink"===V.mark||(J.lineStyle((null==(e=V.style)?void 0:e.outlineWidth)?(null==(m=V.style)?void 0:m.outlineWidth)/2.5:0,hg(null!=(b=null==(o=V.style)?void 0:o.outline)?b:"#DBDBDB"),1,1),J.beginFill(hg(null!=(s=null==(a=A.spec().style)?void 0:a.background)?s:l.track.background),null!=(n=null==(t=A.spec().style)?void 0:t.backgroundOpacity)?n:l.track.background&&"transparent"!==l.track.background?1:0),J.moveTo(K.x,K.y),J.arc(u,Y,W,R,r,!0),J.arc(u,Y,h,r,R,!1),J.closePath()),Dg(V.x)&&"top"===V.x.axis&&(J.lineStyle(.5,hg("black"),0,.5),J.beginFill(hg("white"),0),J.moveTo(K.x,K.y),J.arc(u,Y,h-.5,R,r,!0),J.arc(u,Y,h,r,R,!1),J.closePath()),J.lineStyle(.5,hg("black"),0,.5),J.beginFill(hg("white"),0),J.moveTo(u,Y),J.arc(u,Y,h+3,R,r,!1),J.closePath(),J.lineStyle(1,hg("#DBDBDB"),0,0),J.beginFill(hg("white"),0),J.drawCircle(u,Y,W-1)}(0,I,0,A,l):(function(g,I,C,A,l){var i,c,d,Z,e,m;const[o,b]=I.position,[a,s]=I.dimensions,t=I.pBackground;if((null==(i=A.spec().style)?void 0:i.background)||l.track.background&&"transparent"!==l.track.background){t.clear();const g=null!=(d=null==(c=A.spec().style)?void 0:c.background)?d:l.track.background,I=V(null==(Z=A.spec().style)?void 0:Z.backgroundOpacity)?1:null==(e=A.spec().style)?void 0:e.backgroundOpacity;t.lineStyle(1,hg("white"),0,0),t.beginFill(hg(g),I),t.drawRect(o,b,a,s)}if(l.track.alternatingBackground&&"transparent"!==l.track.alternatingBackground){const g=A.spec();if(!Dg(g.row)||"nominal"!==g.row.type)return;const C=null!=(m=A.getChannelDomainArray("row"))?m:["___SINGLE_ROW___"];if(0===C.length)return;C.forEach(((g,i)=>{var c,d,Z,e;if(i%2==0)return;const m=A.encodedValue("row",g),o=null!=(d=null==(c=A.spec().style)?void 0:c.background)?d:l.track.alternatingBackground,b=V(null==(Z=A.spec().style)?void 0:Z.backgroundOpacity)?1:null==(e=A.spec().style)?void 0:e.backgroundOpacity;t.lineStyle(1,hg("white"),0,0),t.beginFill(hg(o),b),t.drawRect(I.position[0],I.position[1]+m,a,s/C.length)}))}}(0,I,0,A,l),function(g,I,C,A){var l,i,c,d;const Z=I.pBorder,[e,m]=I.position,[o,b]=I.dimensions;Z.lineStyle(null!=(i=null==(l=C.spec().style)?void 0:l.outlineWidth)?i:1,hg(null!=(d=null==(c=C.spec().style)?void 0:c.outline)?d:A.track.outline),1,.5),Z.beginFill(hg("white"),0),Z.drawRect(e,m,o,b);const a=C.spec().x;Z.lineStyle(1,hg(A.axis.baselineColor),1,.5),Dg(a)&&"top"===a.axis?(Z.moveTo(e,m),Z.lineTo(e+o,m)):Dg(a)&&"bottom"===a.axis&&(Z.moveTo(e,m+b),Z.lineTo(e+o,m+b))}(0,I,A,l)),Kg(I,A,l)}function kg(g,I,C,A,l){if(!g||!I||!C)return;if("brush"===A.spec().mark)return;const i="circular"===A.spec().layout;["x","x1","x1e","xe"].forEach((g=>{A.setChannelScale(g,I._xScale)})),i?(function(g,I,C,A,l){var i,c,d,Z,e;const m=A.spec(),o="circular"===m.layout,b=A.getChannelDomainArray("y"),a=A.getChannelRangeArray("y");if(!o)return;if(!A.isShowYAxis()||!b||!a)return;const[s,t]=[m.width,m.height],V=null!=(i=m.innerRadius)?i:220,y=null!=(c=m.outerRadius)?c:300,X=y-V,G=null!=(d=m.startAngle)?d:0,B=null!=(Z=m.endAngle)?Z:360,W=s/2,h=t/2,p=null!=(e=A.getChannelDomainArray("row"))?e:["___SINGLE_ROW___"],H=t/p.length;if(H/t*X<=20)return;const u=A.spec().y,Y=!Dg(u)||!("axis"in u)||"right"!==u.axis,K=n().domain(b).range(a),R=C.graphics;p.forEach((I=>{const C=A.encodedValue("row",I),i=y-C/t*X,c=Hg(Y?0:s,s,y-(C+H)/t*X,W,h,G,B),d=Hg(Y?0:s,s,i,W,h,G,B);R.lineStyle(1,hg(l.axis.baselineColor),1,.5),R.moveTo(c.x,c.y),R.lineTo(d.x,d.y);const Z=g=>6*s/2/Math.PI/g,e=g=>8*s/2/Math.PI/g,m=H/t*X,o=Math.max(Math.ceil(m/40),1);let a=K.ticks(o).filter((g=>b[0]<=g&&g<=b[1]));1===a.length&&(a=K.ticks(o+1).filter((g=>b[0]<=g&&g<=b[1]))),R.lineStyle(1,hg(l.axis.tickColor),1,.5),a.forEach((g=>{const I=K(g),A=y-(C+H-I)/t*X,l=Y?0:s-Z(A),i=Y?Z(A):s,c=Hg(l,s,A,W,h,G,B),d=pg(l,s,G,B),e=pg(i,s,G,B);R.moveTo(c.x,c.y),R.arc(W,h,A,d,e,!0),R.arc(W,h,A,e,d,!1),R.closePath()}));{const g=Y?0:s-e(V),I=Y?e(V):s,C=pg(g,s,G,B),A=pg(I,s,G,B);R.moveTo(c.x,c.y),R.arc(W,h,V,C,A,!0),R.arc(W,h,V,A,C,!1),R.closePath()}{const g=Y?0:s-e(y),I=Y?e(y):s,C=pg(g,s,G,B),A=pg(I,s,G,B);R.moveTo(d.x,d.y),R.arc(W,h,y,C,A,!0),R.arc(W,h,y,A,C,!1),R.closePath()}a.forEach((I=>{const A=K(I),i=y-(C+H-A)/t*X,c=Hg(2*Z(i),s,i,W,h,G,B),d=rg({color:l.axis.labelColor,size:l.axis.labelFontSize,fontFamily:l.axis.labelFontFamily,fontWeight:l.axis.labelFontWeight}),e=new g.libraries.PIXI.Text(I,d);e.anchor.x=Y?1:0,e.anchor.y=.5,e.position.x=c.x,e.position.y=c.y,e.resolution=4;const m=new g.libraries.PIXI.TextStyle(d),o=g.libraries.PIXI.TextMetrics.measureText(e.text,m).width/(2*i*Math.PI)*s*360/(B-G),b=Y?2*Z(i):s-2*Z(i)-o,a=[];for(let C=Y?2*Z(i)+o:s-2*Z(i);C>=b;C-=o/10){const I=Hg(C,s,i,W,h,G,B);a.push(new g.libraries.PIXI.Point(I.x,I.y))}e.updateText();const n=new g.libraries.PIXI.SimpleRope(e.texture,a);R.addChild(n)}))}))}(g,0,C,A,l),function(g,I,C,A,l){var i,c,d;const Z=A.spec(),{title:e}=Z;if("circular"!==Z.layout)return;if(!e)return;const[m,o]=I.dimensions,b=null!=(i=Z.outerRadius)?i:300,a=null!=(c=Z.startAngle)?c:0,s=null!=(d=Z.endAngle)?d:360,t=m/2,n=o/2,V=C.graphics,y=b-1,X=Hg(1,m,y,t,n,a,s),G=rg({color:l.track.titleColor,size:12,fontFamily:l.axis.labelFontFamily,fontWeight:l.axis.labelFontWeight}),B=new g.libraries.PIXI.Text(e,G);B.anchor.x=1,B.anchor.y=.5,B.position.x=X.x,B.position.y=X.y,B.resolution=4;const W=new g.libraries.PIXI.TextStyle(G),h=g.libraries.PIXI.TextMetrics.measureText(B.text,W),p=h.width/(2*y*Math.PI)*m*360/(s-a),H=1+p,u=[];for(let r=H;r>=1;r-=p/10){const I=Hg(r,m,y-h.height/2,t,n,a,s);u.push(new g.libraries.PIXI.Point(I.x,I.y))}const Y=pg(1,m,a,s),K=pg(H+1,m,a,s);V.lineStyle(1,hg("red"),0,.5),V.beginFill(hg(l.track.titleBackground),.5),V.moveTo(X.x,X.y),V.arc(t,n,y-h.height,Y,K,!0),V.arc(t,n,y,K,Y,!1),V.closePath(),B.updateText();const R=new g.libraries.PIXI.SimpleRope(B.texture,u);V.addChild(R)}(g,I,C,A,l)):(function(g,I,C,A,l){var i;const c="circular"===A.spec().layout,d=A.getChannelDomainArray("y"),Z=A.getChannelRangeArray("y");if(c)return;if(!A.isShowYAxis()||!d||!Z)return;const[e,m]=I.dimensions,[o,b]=I.position,a=null!=(i=A.getChannelDomainArray("row"))?i:["___SINGLE_ROW___"],s=m/a.length;if(s<=20)return;const t=A.spec().y,V=!Dg(t)||!("axis"in t)||"right"!==t.axis,y=n().domain(d).range(Z),X=I.pBorder;a.forEach((I=>{const C=A.encodedValue("row",I),i=V?o:o+e,c=b+C;X.lineStyle(1,hg(l.axis.baselineColor),1,.5),X.moveTo(i,c),X.lineTo(i,c+s);const Z=Math.max(Math.ceil(s/40),1);let m=y.ticks(Z).filter((g=>d[0]<=g&&g<=d[1]));1===m.length&&(m=y.ticks(Z+1).filter((g=>d[0]<=g&&g<=d[1]))),X.lineStyle(1,hg(l.axis.tickColor),1,.5);let a=V?i+6:i-6;m.forEach((g=>{const I=y(g);X.moveTo(i,c+s-I),X.lineTo(a,c+s-I)})),a=V?i+8:i-8,X.moveTo(i,c),X.lineTo(a,c),X.moveTo(i,c+s),X.lineTo(a,c+s);const t=rg({color:l.axis.labelColor,size:l.axis.labelFontSize,fontFamily:l.axis.labelFontFamily,fontWeight:l.axis.labelFontWeight});m.forEach((I=>{const C=y(I);a=V?i+12:i-12;const A=new g.libraries.PIXI.Text(I,t);A.anchor.x=V?0:1,A.anchor.y=0===C?.9:.5,A.position.x=a,A.position.y=c+s-C,X.addChild(A)}))}))}(g,I,0,A,l),function(g,I,C,A,l){var i;const c=A.spec();if(!Dg(c.row)||"nominal"!==c.row.type||!c.row.legend)return;const d=null!=(i=A.getChannelDomainArray("row"))?i:["___SINGLE_ROW___"];if(0===d.length)return;const Z=I.pBorder,e=rg({color:l.legend.labelColor,size:l.legend.labelFontSize,fontWeight:l.legend.labelFontWeight,fontFamily:l.legend.labelFontFamily});d.forEach((C=>{const i=A.encodedValue("row",C),c=new g.libraries.PIXI.Text(C,e);c.anchor.x=0,c.anchor.y=0,c.position.x=I.position[0]+4,c.position.y=I.position[1]+i+2,Z.addChild(c);const d=new g.libraries.PIXI.TextStyle(e),m=g.libraries.PIXI.TextMetrics.measureText(C,d);Z.beginFill(hg(l.legend.background),l.legend.backgroundOpacity),Z.lineStyle(1,hg(l.legend.backgroundStroke),0,0),Z.drawRect(I.position[0]+1,I.position[1]+i+1,m.width+8,m.height+4)}))}(g,I,0,A,l)),Jg(g,I,0,A,l)}const vg={viridis:X,grey:G,warm:B,spectral:W,cividis:h,bupu:p,rdbu:H};function Ng(g){return!("alignment"in g)&&!g.tracks.find((g=>"overlay"===g.alignment||"tracks"in g))}function fg(g){return!Ug(g)&&"data"in g&&!("mark"in g)}function zg(g){return"object"==typeof g}function xg(g){return!("overlay"in g)}function Ug(g){return"overlay"in g}function Mg(g){return xg(g)&&Dg(g.x)&&"genomic"===g.x.type&&Dg(g.y)&&"genomic"===g.y.type}function Lg(g){return null!==g&&"object"==typeof g&&"value"in g}function Tg(g){return void 0!==g&&("vector"===g.type||"beddb"===g.type||"multivec"===g.type||"bigwig"===g.type||"matrix"===g.type||"bam"===g.type)}function Dg(g){return"object"==typeof g&&!("value"in g)}function Qg(g){return y(g)}function Og(g){return("bar"===g.mark||"area"===g.mark||"text"===g.mark)&&Dg(g.color)&&"nominal"===g.color.type&&(!g.row||Lg(g.row))&&Dg(g.y)&&"quantitative"===g.y.type&&!Dg(g.ye)}function Pg(g,I){if(Dg(I)&&I.field)return g[null==I?void 0:I.field]}function jg(g,I){const C=[];return wg.forEach((A=>{const l=g[A];Dg(l)&&l.type===I&&C.push(A)})),C}function Eg(g){if((xg(g)||Ug(g))&&Dg(g.x)&&g.x.axis&&"none"!==g.x.axis)return!0;if(Ug(g)){let I=!1;return g.overlay.forEach((g=>{I||Dg(g.x)&&g.x.axis&&"none"!==g.x.axis&&(I=!0)})),I}return!1}function qg(g){if(fg(g))return[];if(!Ug(g))return[g];if(0===g.overlay.length)return[e(Z({},g),{superpose:void 0})];const I=JSON.parse(JSON.stringify(g));delete I.overlay;const C=[];let A;g.overlay.forEach(((g,A)=>{const l=u(JSON.parse(JSON.stringify(I)),g);l.title&&0!==A&&delete l.title,C.push(l)})),C.forEach((g=>{Dg(g.x)&&g.x.axis&&!A&&(A=g.x.axis)}));return C.map((g=>e(Z({},g),{x:e(Z({},g.x),{axis:A})})))}function _g(g){if(0===g.length)return!1;const I=g.filter((g=>g));if(I.length!==g.length)return!1;const C=Object.keys(I[0]).sort();let A=!0;return C.forEach((g=>{1===Array.from(new Set(I.map((I=>JSON.stringify(I[g]))))).length||(A=!1)})),A}function $g(g,I){const C=g?JSON.parse(JSON.stringify(g)):{};return I?u(C,I):C}function gI(g,I){"tracks"in g?g.tracks.forEach(((g,C,A)=>{I(g,C,A),gI(g,I)})):"views"in g&&g.views.forEach((g=>gI(g,I)))}function II(g,I){"tracks"in g?g.tracks.forEach((g=>{I(g),II(g,I)})):"views"in g&&g.views.forEach((g=>{I(g),II(g,I)}))}function CI(g,I){"tracks"in g||(I(g),g.views.forEach((g=>{CI(g,I)})))}function AI(g){if(Ng(g)){const I=JSON.parse(JSON.stringify(g));return delete I.tracks,g.tracks.filter((g=>!g._invalidTrack)).map((g=>u(JSON.parse(JSON.stringify(I)),g)))}const I=[];var C;return Ng(C=g)||function(g){return"alignment"in g&&"overlay"===g.alignment}(C)?I.push(e(Z({},g),{overlay:[...g.tracks.filter((g=>!g._invalidTrack))],tracks:void 0,alignment:void 0})):g.tracks.filter((g=>!g._invalidTrack)).map((C=>{if("alignment"in C)I.push(e(Z({},C),{overlay:[...C.tracks],tracks:void 0,alignment:void 0}));else{const A=JSON.parse(JSON.stringify(g));delete A.tracks;const l=u(JSON.parse(JSON.stringify(A)),C);I.push(l)}})),JSON.parse(JSON.stringify(I))}function lI(g,I){if(I?(void 0===g.assembly&&(g.assembly=I.assembly),void 0===g.layout&&(g.layout=I.layout),void 0===g.orientation&&(g.orientation=I.orientation),void 0===g.static&&(g.static=void 0!==I.static&&I.static),void 0===g.zoomLimits&&(g.zoomLimits=I.zoomLimits),void 0===g.xDomain&&(g.xDomain=I.xDomain),void 0===g.linkingId&&(g.linkingId=I.linkingId),void 0===g.centerRadius&&(g.centerRadius=I.centerRadius),void 0!==g.spacing||"tracks"in g||(g.spacing=I.spacing),void 0===g.xOffset&&(g.xOffset=I.xOffset),void 0===g.yOffset&&(g.yOffset=I.yOffset),"views"in g&&"arrangement"in I&&void 0===g.arrangement&&(g.arrangement=I.arrangement),g.style=$g(I.style,g.style)):(void 0===g.assembly&&(g.assembly="hg38"),void 0===g.layout&&(g.layout="linear"),void 0===g.orientation&&(g.orientation="horizontal"),void 0===g.static&&(g.static=!1),void 0===g.zoomLimits&&(g.zoomLimits=[1,null]),void 0===g.centerRadius&&(g.centerRadius=.3),void 0===g.spacing&&(g.spacing=10),"views"in g&&void 0===g.arrangement&&(g.arrangement="vertical"),void 0===g.xOffset&&(g.xOffset=0),void 0===g.yOffset&&(g.yOffset=0)),"tracks"in g){let I=AI(g);I=function(g){return[].concat(...g.map((g=>{if(fg(g)||!Ug(g)||g.overlay.length<=1)return[g];if(0===g.overlay.filter((g=>g.data)).length)return[g];if(_g([g.data,...g.overlay.map((g=>g.data))]))return[g];const I=JSON.parse(JSON.stringify(g));delete I.overlay;const C=[],A=JSON.parse(JSON.stringify(I));return A.overlay=[],g.overlay.forEach((g=>{if(A.data||(A.data=g.data),!g.data||_g([A.data,g.data]))return void A.overlay.push(g);const l=u(JSON.parse(JSON.stringify(I)),g);C.push(l)})),(A.overlay.length>0?[A,...C]:C).map(((g,I,C)=>{const A=0!==I,l=xg(g)&&Dg(g.y)&&!g.y.axis&&A?e(Z({},g.y),{axis:1===I?"right":"none"}):xg(g)?g.y:void 0;return g.title&&I!==C.length-1&&1!==C.length&&delete g.title,e(Z({},g),{overlayOnPreviousTrack:A,y:l})}))})))}(I);const C=Y();I.forEach(((A,l,i)=>{var c,d,Z;if(A.width||(A.width=360),A.height||(A.height=180),"displacement"in A)if("pile"===(null==(c=A.displacement)?void 0:c.type)&&void 0===A.row&&Dg(A.x)&&A.x.field&&Dg(A.xe)&&A.xe.field){const g=Y(),I={type:"displace",newField:g,boundingBox:{startField:A.x.field,endField:A.xe.field,padding:A.displacement.padding},method:"pile"};A.dataTransform||(A.dataTransform=[]),A.dataTransform=[...A.dataTransform,I],A.row={field:g,type:"nominal"}}else null==(d=A.displacement)||d.type;if(A.layout&&(A.layout=void 0),A.zoomLimits&&(A.zoomLimits=void 0),A.assembly||(A.assembly=g.assembly),A.layout||(A.layout=g.layout),A.orientation||(A.orientation=g.orientation),void 0===A.static&&(A.static=void 0!==g.static&&g.static),A.zoomLimits||(A.zoomLimits=g.zoomLimits),A.style=$g(g.style,A.style),Ug(A)&&A.overlay.forEach((g=>{g.style=$g(A.style,g.style)})),"circular"!==A.layout&&!Mg(A)||"vertical"!==A.orientation||(A.orientation="horizontal"),Mg(A)&&(A.layout="linear"),(xg(A)||Ug(A))&&Dg(A.x)&&!A.x.domain?A.x.domain=g.xDomain:Ug(A)&&A.overlay.forEach((I=>{Dg(I.x)&&!I.x.domain&&(I.x.domain=g.xDomain)})),(xg(A)||Ug(A))&&Dg(A.x)&&!A.x.linkingId)A.x.linkingId=null!=(Z=g.linkingId)?Z:C;else if(Ug(A)){let I=!1;A.overlay.forEach((A=>{var l;I||Dg(A.x)&&!A.x.linkingId&&(A.x.linkingId=null!=(l=g.linkingId)?l:C,I=!0)}))}0===l&&(A.overlayOnPreviousTrack=!1),(0===l||0!==l&&1===I.slice(0,l).filter((g=>!g.overlayOnPreviousTrack)).length&&!0===A.overlayOnPreviousTrack)&&((xg(A)||Ug(A))&&Dg(A.x)&&!A.x.axis?"vertical"===A.orientation?A.x.axis="left":A.x.axis="top":Ug(A)&&A.overlay.forEach((g=>{Dg(g.x)&&!g.x.axis&&("vertical"===A.orientation?g.x.axis="left":g.x.axis="top")}))),(xg(A)||Ug(A))&&Dg(A.x)&&A.x.axis&&"none"!==A.x.axis?"vertical"===A.orientation?"top"===A.x.axis?A.x.axis="left":"bottom"===A.x.axis&&(A.x.axis="right"):"left"===A.x.axis?A.x.axis="top":"right"===A.x.axis&&(A.x.axis="bottom"):Ug(A)&&A.overlay.forEach((g=>{Dg(g.x)&&g.x.axis&&"none"!==g.x.axis&&("vertical"===A.orientation?"top"===g.x.axis?g.x.axis="left":"bottom"===g.x.axis&&(g.x.axis="right"):"left"===g.x.axis?g.x.axis="top":"right"===g.x.axis&&(g.x.axis="bottom"))})),0!==l&&(l===i.length-1&&i.slice(0,l+1).filter((g=>g.overlayOnPreviousTrack)).length<l||l!==i.length-1&&i.slice(l+1).filter((g=>g.overlayOnPreviousTrack)).length===i.length-l-1&&i.slice(0,l+1).filter((g=>g.overlayOnPreviousTrack)).length<l)&&(xg(A)&&"withinLink"===A.mark&&void 0===A.flipY?A.flipY=!0:Ug(A)&&("withinLink"===A.mark&&void 0===A.flipY&&(A.flipY=!0),A.overlay.forEach((g=>{"withinLink"===g.mark&&void 0===g.flipY&&(g.flipY=!0)})))),A.overlayOnPreviousTrack&&i[l-1]&&(A.width=i[l-1].width,A.height=i[l-1].height,A.layout=i[l-1].layout,A.assembly=i[l-1].assembly)})),g.tracks=I}else g.views.forEach((I=>{lI(I,g)}))}const iI=[{name:"gene",channels:[{name:"startPosition",type:"genomic",required:!0},{name:"endPosition",type:"genomic",required:!0},{name:"strandColor",type:"nominal",required:!0},{name:"strandRow",type:"nominal",required:!0},{name:"opacity",type:"value",required:!1},{name:"geneHeight",type:"value",required:!1},{name:"geneLabel",type:"nominal",required:!0},{name:"geneLabelColor",type:"nominal",required:!0},{name:"geneLabelFontSize",type:"value",required:!1},{name:"geneLabelStroke",type:"value",required:!1},{name:"geneLabelStrokeThickness",type:"value",required:!1},{name:"geneLabelOpacity",type:"value",required:!1},{name:"type",type:"nominal",required:!0}],mapping:[{dataTransform:[{type:"filter",base:"type",oneOf:["gene"]},{type:"filter",base:"strandColor",oneOf:["-"]}],mark:"triangleLeft",x:{base:"startPosition",type:"genomic"},size:{base:"geneHeight",value:12},row:{base:"strandRow",type:"nominal",domain:["+","-"]},color:{base:"strandColor",type:"nominal",domain:["+","-"],range:["blue","red"]},opacity:{base:"opacity",value:.4},style:{align:"right"}},{dataTransform:[{type:"filter",base:"type",oneOf:["gene"]},{type:"filter",base:"strandColor",oneOf:["+"]}],mark:"triangleRight",x:{base:"endPosition",type:"genomic"},size:{base:"geneHeight",value:12},row:{base:"strandRow",type:"nominal",domain:["+","-"]},color:{base:"strandColor",type:"nominal",domain:["+","-"],range:["blue","red"]},opacity:{base:"opacity",value:.4},style:{align:"left"}},{dataTransform:[{type:"filter",base:"type",oneOf:["exon"]}],mark:"rect",x:{base:"startPosition",type:"genomic"},xe:{base:"endPosition",type:"genomic"},size:{base:"geneHeight",value:12},row:{base:"strandRow",type:"nominal",domain:["+","-"]},color:{base:"strandColor",type:"nominal",domain:["+","-"],range:["blue","red"]},opacity:{base:"opacity",value:.4}},{dataTransform:[{type:"filter",base:"type",oneOf:["gene"]},{type:"filter",base:"strandColor",oneOf:["+"]}],mark:"rect",x:{base:"startPosition",type:"genomic"},xe:{base:"endPosition",type:"genomic"},row:{base:"strandRow",type:"nominal",domain:["+","-"]},color:{base:"strandColor",type:"nominal",domain:["+","-"],range:["blue","red"]},opacity:{base:"opacity",value:.4},size:{value:3}},{dataTransform:[{type:"filter",base:"type",oneOf:["gene"]},{type:"filter",base:"strandColor",oneOf:["-"]}],mark:"rect",x:{base:"startPosition",type:"genomic"},xe:{base:"endPosition",type:"genomic"},row:{base:"strandRow",type:"nominal",domain:["+","-"]},color:{base:"strandColor",type:"nominal",domain:["+","-"],range:["blue","red"]},opacity:{base:"opacity",value:.4},size:{value:3}},{dataTransform:[{type:"filter",base:"type",oneOf:["gene"]}],mark:"text",text:{base:"geneLabel",type:"nominal"},x:{base:"startPosition",type:"genomic"},xe:{base:"endPosition",type:"genomic"},row:{base:"strandRow",type:"nominal",domain:["+","-"]},color:{base:"geneLabelColor",type:"nominal",domain:["+","-"],range:["blue","red"]},opacity:{base:"opacity",value:1},size:{base:"geneLabelFontSize",value:18},stroke:{base:"geneLabelStroke",value:"white"},strokeWidth:{base:"geneLabelStrokeThickness",value:2},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}]}]},{name:"ideogram",channels:[{name:"startPosition",type:"genomic",required:!0},{name:"endPosition",type:"genomic",required:!0},{name:"chrHeight",type:"value",required:!1},{name:"name",type:"nominal",required:!0},{name:"stainBackgroundColor",type:"nominal",required:!0},{name:"stainLabelColor",type:"nominal",required:!0},{name:"stainStroke",type:"value",required:!1},{name:"stainStrokeWidth",type:"value",required:!1}],mapping:[{mark:"rect",dataTransform:[{type:"filter",base:"stainBackgroundColor",oneOf:["acen"],not:!0}],color:{base:"stainBackgroundColor",type:"nominal",domain:["gneg","gpos25","gpos50","gpos75","gpos100","gvar","acen"],range:["white","lightgray","gray","gray","black","#7B9CC8","#DC4542"]},size:{base:"chrHeight",value:18},x:{base:"startPosition",type:"genomic"},xe:{base:"endPosition",type:"genomic"},stroke:{base:"stainStroke",value:"gray"},strokeWidth:{base:"stainStrokeWidth",value:.3}},{mark:"triangleRight",dataTransform:[{type:"filter",base:"stainBackgroundColor",oneOf:["acen"]},{type:"filter",base:"name",include:"q"}],color:{base:"stainBackgroundColor",type:"nominal",domain:["gneg","gpos25","gpos50","gpos75","gpos100","gvar","acen"],range:["white","lightgray","gray","gray","black","#7B9CC8","#DC4542"]},size:{base:"chrHeight",value:18},x:{base:"startPosition",type:"genomic"},xe:{base:"endPosition",type:"genomic"},stroke:{base:"stainStroke",value:"gray"},strokeWidth:{base:"stainStrokeWidth",value:.3}},{mark:"triangleLeft",dataTransform:[{type:"filter",base:"stainBackgroundColor",oneOf:["acen"]},{type:"filter",base:"name",include:"p"}],color:{base:"stainBackgroundColor",type:"nominal",domain:["gneg","gpos25","gpos50","gpos75","gpos100","gvar","acen"],range:["white","lightgray","gray","gray","black","#7B9CC8","#DC4542"]},size:{base:"chrHeight",value:18},x:{base:"startPosition",type:"genomic"},xe:{base:"endPosition",type:"genomic"},stroke:{base:"stainStroke",value:"gray"},strokeWidth:{base:"stainStrokeWidth",value:.3}},{mark:"text",dataTransform:[{type:"filter",base:"stainLabelColor",oneOf:["acen"],not:!0}],color:{base:"stainLabelColor",type:"nominal",domain:["gneg","gpos25","gpos50","gpos75","gpos100","gvar"],range:["black","black","black","black","white","black"]},text:{base:"name",type:"nominal"},x:{base:"startPosition",type:"genomic"},xe:{base:"endPosition",type:"genomic"},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}]}]},{name:"sequence",channels:[{name:"startPosition",type:"genomic",required:!0},{name:"endPosition",type:"genomic",required:!0},{name:"barLength",type:"quantitative",required:!0},{name:"baseBackground",type:"nominal",required:!0},{name:"baseLabelColor",type:"nominal",required:!0},{name:"baseLabelFontSize",type:"value",required:!1}],mapping:[{mark:"bar",x:{base:"startPosition",type:"genomic"},xe:{base:"endPosition",type:"genomic"},y:{base:"barLength",type:"quantitative",axis:"none"},color:{base:"baseBackground",type:"nominal",domain:["A","T","G","C"]}},{dataTransform:[{type:"filter",base:"barLength",oneOf:[0],not:!0}],mark:"text",x:{base:"startPosition",type:"genomic"},xe:{base:"endPosition",type:"genomic"},color:{base:"baseLabelColor",type:"nominal",domain:["A","T","G","C"],range:["white"]},text:{base:"baseBackground",type:"nominal"},size:{base:"baseLabelFontSize",value:18},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:30,target:"mark"},{operation:"LT",measure:"zoomLevel",threshold:10,target:"track"}]}]}];const cI={chr1:248956422,chr2:242193529,chr3:198295559,chr4:190214555,chr5:181538259,chr6:170805979,chr7:159345973,chr8:145138636,chr9:138394717,chr10:133797422,chr11:135086622,chr12:133275309,chr13:114364328,chr14:107043718,chr15:101991189,chr16:90338345,chr17:83257441,chr18:80373285,chr19:58617616,chr20:64444167,chr21:46709983,chr22:50818468,chrX:156040895,chrY:57227415},dI={chr1:249250621,chr2:243199373,chr3:198022430,chr4:191154276,chr5:180915260,chr6:171115067,chr7:159138663,chr8:146364022,chr9:141213431,chr10:135534747,chr11:135006516,chr12:133851895,chr13:115169878,chr14:107349540,chr15:102531392,chr16:90354753,chr17:81195210,chr18:78077248,chr19:59128983,chr20:63025520,chr21:48129895,chr22:51304566,chrX:155270560,chrY:59373566,chrM:16571},ZI={chr1:247249719,chr2:242951149,chr3:199501827,chr4:191273063,chr5:180857866,chr6:170899992,chr7:158821424,chr8:146274826,chr9:140273252,chr10:135374737,chr11:134452384,chr12:132349534,chr13:114142980,chr14:106368585,chr15:100338915,chr16:88827254,chr17:78774742,chr18:76117153,chr19:63811651,chr20:62435964,chr21:46944323,chr22:49691432,chrX:154913754,chrY:57772954,chrM:16571},eI={chr1:245522847,chr2:243018229,chr3:199505740,chr4:191411218,chr5:180857866,chr6:170975699,chr7:158628139,chr8:146274826,chr9:138429268,chr10:135413628,chr11:134452384,chr12:132449811,chr13:114142980,chr14:106368585,chr15:100338915,chr16:88827254,chr17:78774742,chr18:76117153,chr19:63811651,chr20:62435964,chr21:46944323,chr22:49554710,chrX:154824264,chrY:57701691,chrM:16571},mI={chr1:246127941,chr2:243615958,chr3:199344050,chr4:191731959,chr5:181034922,chr6:170914576,chr7:158545518,chr8:146308819,chr9:136372045,chr10:135037215,chr11:134482954,chr12:132078379,chr13:113042980,chr14:105311216,chr15:100256656,chr16:90041932,chr17:81860266,chr18:76115139,chr19:63811651,chr20:63741868,chr21:46976097,chr22:49396972,chrX:153692391,chrY:50286555,chrM:16571},oI={chr1:195471971,chr2:182113224,chr3:160039680,chr4:156508116,chr5:151834684,chr6:149736546,chr7:145441459,chr8:129401213,chr9:124595110,chr10:130694993,chr11:122082543,chr12:120129022,chr13:120421639,chr14:124902244,chr15:104043685,chr16:98207768,chr17:94987271,chr18:90702639,chr19:61431566,chrX:171031299,chrY:91744698,chrM:16299},bI={chr1:197195432,chr2:181748087,chr3:159599783,chr4:155630120,chr5:152537259,chr6:149517037,chr7:152524553,chr8:131738871,chr9:124076172,chr10:129993255,chr11:121843856,chr12:121257530,chr13:120284312,chr14:125194864,chr15:103494974,chr16:98319150,chr17:95272651,chr18:90772031,chr19:61342430,chrX:166650296,chrY:15902555,chrM:16299};function aI(g,I){const C=Object.entries(sI(I).interval).find((I=>{const[,[C,A]]=I;return C<=g&&g<A}));if(!C)return`${g}`;const A=K(",")(g-C[1][0]);return`${C[0]}:${A}`}function sI(g){return g&&g in nI?nI[g]:nI.hg38}const tI=g=>`https://s3.amazonaws.com/gosling-lang.org/data/${g}.chrom.sizes`,nI=Object.freeze({hg38:{size:cI,interval:VI(cI),total:yI(cI),path:tI("hg38")},hg19:{size:dI,interval:VI(dI),total:yI(dI),path:tI("hg19")},hg18:{size:ZI,interval:VI(ZI),total:yI(ZI),path:tI("hg18")},hg17:{size:eI,interval:VI(eI),total:yI(eI),path:tI("hg17")},hg16:{size:mI,interval:VI(mI),total:yI(mI),path:tI("hg16")},mm10:{size:oI,interval:VI(oI),total:yI(oI),path:tI("mm10")},mm9:{size:bI,interval:VI(bI),total:yI(bI),path:tI("mm9")},unknown:{size:{chr:Number.MAX_VALUE},interval:{chr:[0,Number.MAX_VALUE]},total:Number.MAX_VALUE,path:tI("hg38")}});function VI(g){const I={};return Object.keys(g).reduce(((C,A)=>(I[A]=[C,C+g[A]],C+g[A])),0),I}function yI(g){return Object.values(g).reduce(((g,I)=>g+I),0)}function XI(g,...I){if(!new.target)throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');const{absToChr:C,colorToHex:A,pixiTextToSvg:l,showMousePosition:i,svgLine:c}=g.utils;class d extends g.tracks.PixiTrack{constructor(I){super(...I);const[C,l]=I,{dataConfig:c,animate:d,chromInfoPath:e,isShowGlobalMousePosition:m}=C;this.searchField=null,this.chromInfo=null,this.dataConfig=c,this.allTexts=[],this.pTicksCircular=new g.libraries.PIXI.Graphics,this.pTicks=new g.libraries.PIXI.Graphics,this.pMain.addChild(this.pTicks),this.pMain.addChild(this.pTicksCircular),this.gTicks={},this.tickTexts={},this.options=l,this.isShowGlobalMousePosition=m,this.textFontSize=12,this.textFontFamily="sans-serif",this.textFontWeight="normal",this.textFontColor="#808080",this.textStrokeColor="#ffffff",this.pixiTextConfig=rg({size:+this.options.fontSize||this.textFontSize,fontFamily:this.options.fontFamily||this.textFontFamily,fontWeight:this.options.fontWeight||this.textFontWeight,color:this.options.color||this.textFontColor,stroke:this.options.stroke||this.textStrokeColor,strokeThickness:2}),this.stroke=A(this.pixiTextConfig.stroke),this.tickWidth=200,this.tickHeight=6,this.tickTextSeparation=2,this.tickColor=this.options.tickColor?A(this.options.tickColor):7829367,this.animate=d,this.pubSubs=[],this.options.showMousePosition&&!this.hideMousePosition&&(this.hideMousePosition=i(this,this.is2d,this.isShowGlobalMousePosition()));let o=e;e||(o=`${c.server}/chrom-sizes/?id=${c.tilesetUid}`);const b=this.options.assembly,a={},s=Z({},sI(b).size),t=[];Object.keys(sI(b).size).forEach((g=>{a[g]={chr:g,pos:sI(b).size[g]}})),Object.keys(sI(b).interval).forEach((g=>{t.push({chr:g,pos:sI(b).interval[g][0]})})),this.chromInfo={chrPositions:a,chromLengths:s,cumPositions:t},this.rerender(this.options,!0),this.draw(),this.animate()}initBoundsTicks(){this.pTicks&&(this.pMain.removeChild(this.pTicks),this.pTicks=null),this.gBoundTicks||(this.gBoundTicks=new g.libraries.PIXI.Graphics,this.leftBoundTick=new g.libraries.PIXI.Text("",this.pixiTextConfig),this.rightBoundTick=new g.libraries.PIXI.Text("",this.pixiTextConfig),this.gBoundTicks.addChild(this.leftBoundTick),this.gBoundTicks.addChild(this.rightBoundTick),this.pMain.addChild(this.gBoundTicks)),this.texts=[]}initChromLabels(){this.chromInfo&&(this.gBoundTicks&&(this.pMain.removeChild(this.gBoundTicks),this.gBoundTicks=null),this.pTicks||(this.pTicks=new g.libraries.PIXI.Graphics,this.pMain.addChild(this.pTicks)),this.texts=[],this.pTicks.removeChildren(),this.chromInfo.cumPositions.forEach((I=>{const C=I.chr;this.gTicks[C]=new g.libraries.PIXI.Graphics,this.tickTexts[C]||(this.tickTexts[C]=[]);const A=new g.libraries.PIXI.Text(C,this.pixiTextConfig);A.hashValue=Math.random(),this.pTicks.addChild(A),this.pTicks.addChild(this.gTicks[C]),this.texts.push(A)})))}rerender(g,I){const C=JSON.stringify(g);(I||C!==this.prevOptions)&&(this.prevOptions=C,this.options=g,this.pixiTextConfig.fontSize=+this.options.fontSize?+this.options.fontSize+"px":this.pixiTextConfig.fontSize,this.pixiTextConfig.fill=this.options.color||this.pixiTextConfig.fill,this.pixiTextConfig.stroke=this.options.stroke||this.pixiTextConfig.stroke,this.stroke=A(this.pixiTextConfig.stroke),this.tickColor=this.options.tickColor?A(this.options.tickColor):7829367,"ends"===this.options.tickPositions&&"circular"!==this.options.layout?this.initBoundsTicks():this.initChromLabels(),super.rerender(g,I),this.options.showMousePosition&&!this.hideMousePosition&&(this.hideMousePosition=i(this,this.is2d,this.isShowGlobalMousePosition())),!this.options.showMousePosition&&this.hideMousePosition&&(this.hideMousePosition(),this.hideMousePosition=void 0))}formatTick(g){if(isNaN(g))return"null";const I=this._xScale.domain(),C=I[1]-I[0],A=R(g,C),l=K(","),i=r(`,.${A}`,C);let c=l;return"si"===this.options.tickFormat?c=i:"plain"===this.options.tickFormat?c=l:"ends"===this.options.tickPositions&&(c=i),c(g)}drawBoundsTicks(g,I){const C=this.gBoundTicks;C.clear(),C.lineStyle(1,0);const A=this.options.reverseOrientation?0:this.dimensions[1],l=this.options.reverseOrientation?this.tickHeight:this.dimensions[1]-this.tickHeight;C.moveTo(1,A),C.lineTo(1,l),C.moveTo(this.dimensions[0]-1,A),C.lineTo(this.dimensions[0]-1,l),this.leftBoundTick.x=0,this.leftBoundTick.y=this.options.reverseOrientation?l+this.tickTextSeparation:l-this.tickTextSeparation,this.leftBoundTick.text="unknown"===this.options.assembly?`${this.formatTick(g[1])}`:`${g[0]}: ${this.formatTick(g[1])}`,this.leftBoundTick.anchor.y=this.options.reverseOrientation?0:1,this.rightBoundTick.x=this.dimensions[0],this.rightBoundTick.text="unknown"===this.options.assembly?`${this.formatTick(I[1])}`:`${I[0]}: ${this.formatTick(I[1])}`,this.rightBoundTick.y=this.options.reverseOrientation?l+this.tickTextSeparation:l-this.tickTextSeparation,this.rightBoundTick.anchor.y=this.options.reverseOrientation?0:1,this.rightBoundTick.anchor.x=1,this.flipText&&(this.leftBoundTick.scale.x=-1,this.leftBoundTick.anchor.x=1,this.rightBoundTick.scale.x=-1,this.rightBoundTick.anchor.x=0),this.leftBoundTick.tickLine=[1,this.dimensions[1],1,this.dimensions[1]-this.tickHeight],this.rightBoundTick.tickLine=[this.dimensions[0]-1,this.dimensions[1],this.dimensions[0]-1,this.dimensions[1]-this.tickHeight],this.tickTexts={},this.tickTexts.all=[this.leftBoundTick,this.rightBoundTick]}drawTicks(I){const C=this.gTicks[I.chr];C.visible=!0,C.clear();const A=+this.chromInfo.chromLengths[I.chr],l=Math.max(this._xScale(I.pos),0),i=Math.min(this._xScale(I.pos+A),this.dimensions[0]),c=(i-l)/this.tickWidth,d=n().domain([Math.max(1,this._xScale.invert(0)-I.pos),Math.min(A,this._xScale.invert(this.dimensions[0])-I.pos)]).range([l,i]).ticks(c).filter((g=>Number.isInteger(g))),Z=this.tickTexts[I.chr],e=this.tickHeight;let m=e+this.tickTextSeparation;for(this.options.reverseOrientation&&(m=this.dimensions[1]-m);Z.length<d.length;){const C=new g.libraries.PIXI.Text("",this.pixiTextConfig);Z.push(C),this.gTicks[I.chr].addChild(C)}for(;Z.length>d.length;){const g=Z.pop();this.gTicks[I.chr].removeChild(g)}let o=0;for(;o<d.length;){Z[o].visible=!0,Z[o].anchor.x=.5,Z[o].anchor.y="circular"===this.options.layout||this.options.reverseOrientation?0:1,this.flipText&&(Z[o].scale.x=-1);const g="unknown"===this.options.assembly?"":`${I.chr}: `;Z[o].text=0===d[o]?`${g}1`:`${g}${this.formatTick(d[o])}`;const A=this._xScale(I.pos+d[o]);if("circular"===this.options.layout){const g=this.addCurvedText(Z[o],A+0);this.pTicksCircular.addChild(g)}else{Z[o].x=A+0,Z[o].y=this.dimensions[1]-m,Z[o].tickLine=[A-1,this.dimensions[1],A-1,this.dimensions[1]-e-1];const g=this.options.reverseOrientation?0:this.dimensions[1],I=this.options.reverseOrientation?e:this.dimensions[1]-e;C.lineStyle(1,this.tickColor),C.moveTo(A,g),C.lineTo(A,I)}o+=1}for("circular"===this.options.layout&&(o=0);o<Z.length;)Z[o].visible=!1,o+=1;return d.length}addCurvedText(I,C){const{innerRadius:A,outerRadius:l,startAngle:i,endAngle:c,width:d,height:Z}=this.options,e=(l+A)/2,m=Hg(C,d,e,d/2,Z/2,i,c);I.x=m.x,I.y=m.y,I.resolution=4;const o=new g.libraries.PIXI.TextStyle(this.pixiTextConfig),b=g.libraries.PIXI.TextMetrics.measureText(I.text,o),a=b.width/(2*e*Math.PI)*d*360/(c-i);let[s,t]=[C-a/2,C+a/2];if(s<0){const g=-s;s=0,t+=g}else if(t>d){const g=t-d;t=d,s-=g}const n=[],V=A+b.height/2+3;for(let y=t;y>=s;y-=a/10){const I=Hg(y,d,V,d/2,Z/2,i,c);n.push(new g.libraries.PIXI.Point(I.x,I.y))}I.updateText();return new g.libraries.PIXI.SimpleRope(I.texture,n)}draw(){if(this.allTexts=[],!this.texts)return;const g=C(this._xScale.domain()[0],this.chromInfo),I=C(this._xScale.domain()[1],this.chromInfo);if(!g||!I)return void console.warn("Empty chromInfo:",this.dataConfig,this.chromInfo);if("ends"===this.options.tickPositions&&"circular"!==this.options.layout){if(!this.gBoundTicks)return;return this.gBoundTicks.visible=!0,void this.drawBoundsTicks(g,I)}if(!this.pTicks)return;const A="circular"===this.options.layout;for(let C=0;C<this.texts.length;C++)this.texts[C].visible=!1,this.gTicks[this.chromInfo.cumPositions[C].chr].visible=!1;let l=this.tickHeight+this.tickTextSeparation;this.options.reverseOrientation&&(l=this.dimensions[1]-l),Object.keys(this.chromInfo.chrPositions).forEach((g=>{this.tickTexts[g]&&this.tickTexts[g].forEach((g=>{g.visible=!1}))})),this.pTicksCircular.removeChildren();for(let C=g[3];C<=I[3];C++){const g=this.chromInfo.cumPositions[C],I=g.pos+this.chromInfo.chromLengths[g.chr]/2,i=this._xScale(I),c=this.texts[C];let d;c.anchor.x=.5,c.anchor.y=A?.5:this.options.reverseOrientation?0:1,A?(d=this.addCurvedText(c,i),this.pTicksCircular.addChild(d)):(c.x=i,c.y=this.dimensions[1]-l),c.updateTransform(),this.flipText&&(c.scale.x=-1);const Z=this.drawTicks(g);A?Z>0&&this.pTicksCircular.removeChild(d):c.visible=Z<=0,this.allTexts.push({importance:c.hashValue,text:c,rope:d})}this.hideOverlaps(this.allTexts)}hideOverlaps(g){const I=new J;g.sort(((g,I)=>I.importance-g.importance)).forEach((({text:g,rope:C})=>{g.updateTransform();const A=g.getBounds(),l={minX:A.x-5,minY:A.y-5,maxX:A.x+A.width+10,maxY:A.y+A.height+10};I.collides(l)?(g.visible=!1,"circular"===this.options.layout&&C&&this.pTicksCircular.removeChild(C)):I.insert(l)}))}setPosition(g){super.setPosition(g),[this.pMain.position.x,this.pMain.position.y]=this.position}zoomed(g,I){0===[...g.domain(),...I.domain()].filter((g=>isNaN(g))).length&&(this.xScale(g),this.yScale(I),this.draw())}exportSVG(){let g=null,I=null;super.exportSVG?[I,g]=super.exportSVG():(I=document.createElement("g"),g=I),I.setAttribute("class","chromosome-labels");const C=document.createElement("g");return g.appendChild(C),C.setAttribute("transform",`translate(${this.position[0]},${this.position[1]})`),this.allTexts.filter((g=>g.text.visible)).forEach((g=>{const I=l(g.text);C.appendChild(I)})),Object.values(this.tickTexts).forEach((g=>{g.filter((g=>g.visible)).forEach((g=>{let I=l(g);C.appendChild(I),I=c(g.x,this.options.reverseOrientation?0:this.dimensions[1],g.x,this.options.reverseOrientation?this.tickHeight:this.dimensions[1]-this.tickHeight,1,this.tickColor);const A=document.createElement("line");A.setAttribute("x1",g.tickLine[0]),A.setAttribute("y1",g.tickLine[1]),A.setAttribute("x2",g.tickLine[2]),A.setAttribute("y2",g.tickLine[3]),A.setAttribute("style","stroke: grey"),C.appendChild(I),C.appendChild(A)}))})),[I,g]}}return new d(I)}function GI(g,...I){if(!new.target)throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');class C extends g.tracks.SVGTrack{constructor(g){var I,C;super(...g);const[A,l]=g,{registerViewportChanged:i,removeViewportChanged:c,setDomainsCallback:d}=A;this.uid=w(),this.options=l,this.hasFromView=!A.projectionXDomain,this.removeViewportChanged=c,this.setDomainsCallback=d,this.viewportXDomain=this.hasFromView?null:A.projectionXDomain,this.viewportYDomain=this.hasFromView?null:[0,0],this.prevExtent=[0,0],this.RR=.02;const Z=[0,1.7*Math.PI];this.circularBrushData=this.getBrushData(Z),this.brush=S().innerRadius(null!=(I=this.options.innerRadius)?I:100).outerRadius(null!=(C=this.options.outerRadius)?C:200),this.gBrush=this.gMain.append("g").attr("id",`brush-${this.uid}`).selectAll(".brush").data(this.circularBrushData).enter().append("path").attr("class","brush").attr("d",this.brush).attr("fill",this.options.projectionFillColor).attr("stroke",this.options.projectionStrokeColor).attr("fill-opacity",(g=>"brush"===g.type?this.options.projectionFillOpacity:0)).attr("stroke-opacity",(g=>"brush"===g.type?this.options.projectionStrokeOpacity:0)).attr("stroke-width",this.options.strokeWidth).style("pointer-events","all").style("cursor",(g=>g.cursor)).call(this.dragged()),i(this.uid,this.viewportChanged.bind(this)),this.draw()}getBrushData(g){return[{type:"brush",startAngle:g[0],endAngle:g[1],cursor:"grab"},{type:"start",startAngle:g[0],endAngle:g[0]+this.RR,cursor:"move"},{type:"end",startAngle:g[1]-this.RR,endAngle:g[1],cursor:"move"}]}cropExtent(g){let[I,C]=g,A=0;for(;(I>2*Math.PI||C>2*Math.PI||I<0||C<0)&&!(A++>10);)I>2*Math.PI||C>2*Math.PI?(I-=2*Math.PI,C-=2*Math.PI):(I<0||C<0)&&(I+=2*Math.PI,C+=2*Math.PI);return[I,C].sort(((g,I)=>g-I))}updateBrush(g){let[I,C]=g;I<=0&&C<=0||I>=2*Math.PI-0&&C>=2*Math.PI-0?this.gBrush.attr("visibility","hidden"):(I<0&&(I=0),I>2*Math.PI-0&&(I=2*Math.PI-0),C<0&&(C=0),C>2*Math.PI-0&&(C=2*Math.PI-0),this.circularBrushData=this.getBrushData(g),this.gBrush.data(this.circularBrushData).attr("d",this.brush).attr("visibility","visible"))}dragged(){return g.libraries.d3Drag.drag().on("start",(()=>{this.startEvent=g.libraries.d3Selection.event.sourceEvent,this.prevExtent=[this.circularBrushData[0].startAngle-this.RR,this.circularBrushData[0].endAngle+this.RR]})).on("drag",(I=>{const[C,A]=this.position,[l,i]=this.dimensions,c=g.libraries.d3Selection.event.sourceEvent,d=this.startEvent.layerX-C,Z=this.startEvent.layerY-A,e=c.layerX-C,m=c.layerY-A,o=Math.atan2(d-l/2,Z-i/2)-Math.atan2(e-l/2,m-i/2);let[b,a]=this.prevExtent;if("brush"===I.type){if(b+=o,a+=o,b<0||2*Math.PI-0<a){const g=0-b,I=a-(2*Math.PI-0);g>I?(a+=g,b+=g):(b-=I,a-=I)}}else"start"===I.type?b+=o:"end"===I.type&&(a+=o);if([b,a]=this.cropExtent([b,a]),!this._xScale||!this._yScale)return;const s=(this.options.endAngle-this.options.startAngle)/360,t=b-this.options.startAngle/360*Math.PI*2,n=a-this.options.startAngle/360*Math.PI*2,V=[this._xScale.invert(l-l*n/(2*Math.PI*s)),this._xScale.invert(l-l*t/(2*Math.PI*s))],y=this.viewportYDomain;this.hasFromView||(this.viewportXDomain=V),this.setDomainsCallback(V,y),this.updateBrush([b,a])}))}draw(){if(!this._xScale||!this.yScale)return;if(!this.viewportXDomain||!this.viewportYDomain)return;const g=this._xScale(this.viewportXDomain[0]),I=this._xScale(this.viewportXDomain[1]),[C]=this.dimensions;let A=pg(g,C,this.options.startAngle,this.options.endAngle)+Math.PI/2,l=pg(I,C,this.options.startAngle,this.options.endAngle)+Math.PI/2;[l,A]=this.cropExtent([l,A]),this.updateBrush([l,A])}viewportChanged(g,I){const C=g.domain(),A=I.domain();this.viewportXDomain=C,this.viewportYDomain=A,this.draw()}remove(){this.removeViewportChanged(this.uid),super.remove()}rerender(){}zoomed(g,I){this.xScale(g),this.yScale(I),this.draw()}setPosition(g){super.setPosition(g),this.draw()}setDimensions(g){super.setDimensions(g),this.gBrush.attr("transform",`translate(${g[0]/2},${g[1]/2})`),this.draw()}}return new C(I)}XI.config={type:"axis-track",datatype:["multivec","epilogos"],local:!1,orientation:"1d-horizontal",thumbnail:(new DOMParser).parseFromString('<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 5640 5420" preserveAspectRatio="xMidYMid meet"> <g id="layer101" fill="#000000" stroke="none"> <path d="M0 2710 l0 -2710 2820 0 2820 0 0 2710 0 2710 -2820 0 -2820 0 0 -2710z"/> </g> <g id="layer102" fill="#750075" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> <path d="M4340 2710 l0 -2510 560 0 560 0 0 2510 0 2510 -560 0 -560 0 0 -2510z"/> <path d="M200 1870 l0 -1670 630 0 630 0 0 1670 0 1670 -630 0 -630 0 0 -1670z"/> <path d="M1660 1810 l0 -1610 570 0 570 0 0 1610 0 1610 -570 0 -570 0 0 -1610z"/> <path d="M3000 840 l0 -640 570 0 570 0 0 640 0 640 -570 0 -570 0 0 -640z"/> </g> <g id="layer103" fill="#ffff04" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> </g> </svg>',"text/xml").documentElement,availableOptions:["innerRadius","outerRadius","startAngle","endAngle","width","height","layout","labelPosition","labelColor","labelTextOpacity","labelBackgroundOpacity","trackBorderWidth","trackBorderColor","trackType","tickPositions","scaledHeight","backgroundColor"],defaultOptions:{innerRadius:340,outerRadius:310,startAngle:0,endAngle:360,width:700,height:700,layout:"linear",labelPosition:"none",labelColor:"black",labelTextOpacity:.4,trackBorderWidth:0,trackBorderColor:"black",tickPositions:"even",backgroundColor:"transparent"}};function BI(g,I){const{field:C,not:A}=g;let l=Array.from(I);if("oneOf"in g){const{oneOf:I}=g;l=l.filter((g=>A?-1===I.indexOf(g[C]):-1!==I.indexOf(g[C])))}else if(function(g){return"inRange"in g}(g)){const{inRange:I}=g;l=l.filter((g=>A?!(I[0]<=g[C]&&g[C]<=I[1]):I[0]<=g[C]&&g[C]<=I[1]))}else if(function(g){return"include"in g}(g)){const{include:I}=g;l=l.filter((g=>A?`${g[C]}`.includes(I):!`${g[C]}`.includes(I)))}return l}function WI(g,I){if(0===function(g){const I=[];return wg.forEach((C=>{const A=g[C];Dg(A)&&"aggregate"in A&&I.push(C)})),I}(g).length)return I;const C=jg(g,"nominal");if(1!==C.length)return console.warn("Currently, we only support aggregating datasets with single nominal field."),I;const A=g[C[0]];if(!Dg(A))return I;const l=A.field;if(!l)return I;const i=[...jg(g,"quantitative"),...jg(g,"genomic")],c=[],d=Array.from(new Set(I.map((g=>g[l]))));let Z=!1;return d.forEach((C=>{const A={};A[l]=C,i.forEach((i=>{const c=g[i];if(!Dg(c))return void(Z=!0);const{field:d}=c;d&&"aggregate"in c?A[d]="max"===c.aggregate?Math.max(...I.filter((g=>g[l]===C)).map((g=>+g[d]))):Math.min(...I.filter((g=>g[l]===C)).map((g=>+g[d]))):Z=!0})),c.push(A)})),Z?I:c}function hI(g,...I){if(!new.target)throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');return new class{constructor(g){const[I]=g;if(this.dataConfig=I,this.tilesetInfoLoading=!1,this.assembly=this.dataConfig.assembly,this.filter=this.dataConfig.filter,!I.url)return void console.error("Please provide the `url` of the data");const C=sI(this.assembly).size,A=[],l={};let i=0;Object.keys(sI(this.assembly).size).forEach(((g,I)=>{const C={id:I,chr:g,pos:i};A.push(C),l[g]=C,i+=sI(this.assembly).size[g]})),this.chromSizes={chrToAbs:(g,I)=>this.chromSizes.chrPositions[g].pos+I,cumPositions:A,chrPositions:l,totalLength:i,chromLengths:C},I.data?this.values=I.data:this.dataPromise=this.fetchCSV()}fetchCSV(){var g;const{url:I,chromosomeField:C,genomicFields:A,quantitativeFields:l,headerNames:i,chromosomePrefix:c,longToWideId:d,genomicFieldsToConvert:Z}=this.dataConfig,e=null!=(g=this.dataConfig.separator)?g:",";return fetch(I).then((g=>g.ok?g.text():Promise.reject(g.status))).then((g=>{const I=i?`${i.join(e)}\n${g}`:g;return F(e).parse(I,(g=>{let I=!0;if(Z?Z.forEach((C=>{const A=C.chromosomeField;C.genomicFields.forEach((C=>{try{if("unknown"!==this.assembly){const I=c?g[A].replace(c,"chr"):g[A].includes("chr")?g[A]:`chr${g[A]}`;g[C]=sI(this.assembly).interval[I][0]+ +g[C]}}catch(l){I=!1}}))})):A.forEach((A=>{if(g[C])try{const I=c?g[C].replace(c,"chr"):g[C].includes("chr")?g[C]:`chr${g[C]}`;g[A]=sI(this.assembly).interval[I][0]+ +g[A]}catch(l){I=!1}})),I)return null==l||l.forEach((I=>{g[I]=+g[I]})),g}))})).then((g=>{var I;if(d&&(null==(I=g[0])?void 0:I[d])){const I=Object.keys(g[0]),C={};g.forEach((g=>{C[g[d]]?I.forEach((I=>{C[g[d]][`${I}_2`]=g[I]})):C[g[d]]=JSON.parse(JSON.stringify(g))})),this.values=Object.keys(C).map((g=>C[g]))}else this.values=g})).catch((g=>{console.error("[Gosling Data Fetcher] Error fetching data",g)}))}generateTilesetInfo(g){this.tilesetInfoLoading=!1;const I=this.chromSizes.totalLength,C={tile_size:1024,max_zoom:Math.ceil(Math.log(I/1024)/Math.log(2)),max_width:I,min_pos:[0,0],max_pos:[I,I]};return g&&g(C),C}tilesetInfo(g){if(this.dataPromise)return this.tilesetInfoLoading=!0,this.dataPromise.then((()=>this.generateTilesetInfo(g))).catch((g=>{this.tilesetInfoLoading=!1,console.error("[Gosling Data Fetcher] Error parsing data:",g)}))}fetchTilesDebounced(g,I){const C={},A=[],l=[];for(const i of I){const g=i.split("."),I=parseInt(g[0],10),C=parseInt(g[1],10),c=parseInt(g[2],10);Number.isNaN(C)||Number.isNaN(I)?console.warn("[Gosling Data Fetcher] Invalid tile zoom or position:",I,C,c):(A.push(i),l.push(this.tile(I,C,c)))}return Promise.all(l).then((I=>{I.forEach(((g,I)=>{const l=A[I];C[l]=g,C[l].tilePositionId=l})),g(C)})),C}tile(g,I,C){var A;return null==(A=this.tilesetInfo())?void 0:A.then((A=>{var l,i;const c=+A.max_width/2**+g,d=A.min_pos[0]+I*c,Z=A.min_pos[0]+(I+1)*c;let e=this.values.filter((g=>{if(this.dataConfig.genomicFields)return this.dataConfig.genomicFields.find((I=>d<g[I]&&g[I]<=Z));{const I=[];return this.dataConfig.genomicFieldsToConvert.forEach((g=>I.push(...g.genomicFields))),I.find((I=>d<g[I]&&g[I]<=Z))}}));null==(l=this.filter)||l.forEach((g=>{e=BI(g,e)}));const m=null!=(i=this.dataConfig.sampleLength)?i:1e3;return{tabularData:e.length>m?k(e,m):e,server:null,tilePos:[I,C],zoomLevel:g}}))}}(I)}function pI(g,...I){if(!new.target)throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');return new class{constructor(g){const[I]=g;if(this.dataConfig=I,this.tilesetInfoLoading=!1,this.assembly=this.dataConfig.assembly,!I.values)return void console.error("Please provide `values` of the raw data");const C=sI(this.assembly).size,A=[],l={};let i=0;Object.keys(sI(this.assembly).size).forEach(((g,I)=>{const C={id:I,chr:g,pos:i};A.push(C),l[g]=C,i+=sI(this.assembly).size[g]})),this.chromSizes={chrToAbs:(g,I)=>this.chromSizes.chrPositions[g].pos+I,cumPositions:A,chrPositions:l,totalLength:i,chromLengths:C},this.values=I.values.map((g=>{var I;let C=!0;if(this.dataConfig.genomicFields.forEach((I=>{if(g[this.dataConfig.chromosomeField])try{const C=g[this.dataConfig.chromosomeField].includes("chr")?g[this.dataConfig.chromosomeField]:`chr${g[this.dataConfig.chromosomeField]}`;g[I]=sI(this.assembly).interval[C][0]+ +g[I]}catch(A){C=!1}})),C)return null==(I=this.dataConfig.quantitativeFields)||I.forEach((I=>{g[I]=+g[I]})),g}))}tilesetInfo(g){this.tilesetInfoLoading=!1;const I=this.chromSizes.totalLength,C={tile_size:1024,max_zoom:Math.ceil(Math.log(I/1024)/Math.log(2)),max_width:I,min_pos:[0],max_pos:[I]};return g&&g(C),C}fetchTilesDebounced(g,I){const C={},A=[],l=[];for(const i of I){const g=i.split("."),I=parseInt(g[0],10),C=parseInt(g[1],10);Number.isNaN(C)||Number.isNaN(I)?console.warn("[Gosling Data Fetcher] Invalid tile zoom or position:",I,C):(A.push(i),l.push(this.tile(I,C)))}return Promise.all(l).then((I=>{I.forEach(((g,I)=>{const l=A[I];C[l]=g,C[l].tilePositionId=l})),g(C)})),C}tile(g,I){var C;const A=this.tilesetInfo(),l=+A.max_width/2**+g,i=A.min_pos[0]+I*l,c=A.min_pos[0]+(I+1)*l,d=this.values.filter((g=>this.dataConfig.genomicFields.find((I=>i<g[I]&&g[I]<=c)))),Z=null!=(C=this.dataConfig.sampleLength)?C:1e3;return{tabularData:d.length>Z?k(d,Z):d,server:null,tilePos:[I],zoomLevel:g}}}(I)}function HI(g,...I){if(!new.target)throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');return new class{constructor(g){g.chromSizesUrl="https://aveit.s3.amazonaws.com/higlass/data/sequence/hg38.chrom.sizes",this.dataConfig=g,this.bwFileHeader=null,this.bwFile=null,this.TILE_SIZE=1024,this.errorTxt="",this.dataPromises=[];const I=sI(this.assembly).size,C=[],A={};let l=0;Object.keys(sI(this.assembly).size).forEach(((g,I)=>{const i={id:I,chr:g,pos:l};C.push(i),A[g]=i,l+=sI(this.assembly).size[g]})),this.chromSizes={chrToAbs:(g,I)=>this.chromSizes.chrPositions[g].pos+I,cumPositions:C,chrPositions:A,totalLength:l,chromLengths:I},this.dataPromises.push(this.loadBBI(g))}loadBBI(g){return g.url?(this.bwFile=new v.BigWig({filehandle:new N.RemoteFile(g.url)}),this.bwFile.getHeader().then((g=>{this.bwFileHeader=g}))):(console.error('Please enter a "url" field to the data config'),null)}tilesetInfo(g){return this.tilesetInfoLoading=!0,Promise.all(this.dataPromises).then((()=>{this.tilesetInfoLoading=!1;let I={};const C=this.chromSizes.totalLength;return I={tile_size:this.TILE_SIZE,max_zoom:Math.ceil(Math.log(C/this.TILE_SIZE)/Math.log(2)),max_width:2**Math.ceil(Math.log(C)/Math.log(2)),min_pos:[0],max_pos:[C]},g&&g(I),I})).catch((I=>{this.tilesetInfoLoading=!1,console.error(I),g&&g({error:`Error parsing bigwig: ${I}`})}))}fetchTilesDebounced(g,I){const C={},A=[],l=[];for(const i of I){const g=i.split("."),I=parseInt(g[0],10),C=parseInt(g[1],10);Number.isNaN(C)||Number.isNaN(I)?console.warn("Invalid tile zoom or position:",I,C):(A.push(i),l.push(this.tile(I,C)))}return Promise.all(l).then((I=>{for(let g=0;g<I.length;g++){const l=A[g];C[l]=I[g],C[l].tilePositionId=l}g(C)})),C}tile(I,C){return this.tilesetInfo().then((A=>{const l=+A.max_width/2**+I,i=[],c={tilePos:[C],tileId:`bigwig.${I}.${C}`,zoomLevel:I},d=A.min_pos[0]+C*l;let Z=d;const e=A.min_pos[0]+(C+1)*l,m=this.determineScale(Z,e),o=(e-Z)/this.TILE_SIZE,b=[];for(let g=0;g<this.TILE_SIZE;g++)b.push(Z+g*o);const{chromLengths:a,cumPositions:s}=this.chromSizes;return s.forEach((I=>{const C=I.chr,A=I.pos,l=I.pos+a[C];let c,d;if(A<=Z&&Z<l){if(!(e>l))return c=Math.floor(Z-A),d=Math.ceil(e-A),void i.push(this.bwFile.getFeatures(C,c,d,{scale:1/m}).then((I=>(I.forEach((I=>{I.startAbs=g.utils.chrToAbs(C,I.start,this.chromSizes),I.endAbs=g.utils.chrToAbs(C,I.end,this.chromSizes)})),I))));c=Z-A,d=l-A,i.push(this.bwFile.getFeatures(C,c,d,{scale:1/m}).then((I=>(I.forEach((I=>{I.startAbs=g.utils.chrToAbs(C,I.start,this.chromSizes),I.endAbs=g.utils.chrToAbs(C,I.end,this.chromSizes)})),I)))),Z=l}})),Promise.all(i).then((I=>{const C=I.flat();for(var A=[],l=0;l<this.TILE_SIZE;l++)A.push(null);b.forEach(((g,I)=>{if(g<d||g>e)return;const l=C.filter((I=>g>=I.startAbs&&g<I.endAbs)).map((g=>g.score));A[I]=l.length>0?l[0]:null})),c.min_value=Math.min(...A),c.max_value=Math.max(...A);const i=new g.utils.DenseDataExtrema1D(A);return c.dense=A,c.denseDataExtrema=i,c.minNonZero=i.minNonZeroInTile,c.maxNonZero=i.maxNonZeroInTile,c}))}))}determineScale(g,I){const C=[1],A=I-g;let l;return this.bwFileHeader.zoomLevels.forEach((g=>{C.push(g.reductionLevel)})),C.forEach((g=>{if(l)return;A/g<=20*this.TILE_SIZE&&(l=g)})),l||C.slice(-1)[0]}}(...I)}function uI(g){return YI(Wg,g)}function YI(g,I,C=!1){const A=new f({extendRefs:!0}).compile(g),l=A(I);let i="",c="";return A.errors&&(c=JSON.stringify(A.errors,null,2),C||console.warn(c),i="⚠️ Some properties are incorrectly used."),{state:l?"success":"warn",message:i,details:c}}function KI(g){let I=!0;const C=[];return qg(g).forEach((g=>{RI(g)||"brush"===g.mark||(C.push("genomic type is not encoded to either a x- or y- axis"),I=!1);const A=g.color;"line"===g.mark&&Dg(A)&&"quantitative"===A.type&&(C.push("`line` mark cannot be used with `quantitative` value"),I=!1)})),{valid:I,errorMessages:C}}function RI(g){let I;return["x","y","xe","ye","x1","y1","x1e","y1e"].reverse().forEach((C=>{const A=g[C];Dg(A)&&"genomic"===A.type&&(I=A)})),I}function rI(g){let I;return["x","xe","y","ye","x1","y1","x1e","y1e"].reverse().forEach((C=>{const A=g[C];Dg(A)&&"genomic"===A.type&&(I=C)})),I}GI.config={type:"brush-track",datatype:["projection"],local:!1,projection:!0,orientation:"2d",thumbnail:(new DOMParser).parseFromString('<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 5640 5420" preserveAspectRatio="xMidYMid meet"> <g id="layer101" fill="#000000" stroke="none"> <path d="M0 2710 l0 -2710 2820 0 2820 0 0 2710 0 2710 -2820 0 -2820 0 0 -2710z"/> </g> <g id="layer102" fill="#750075" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> <path d="M4340 2710 l0 -2510 560 0 560 0 0 2510 0 2510 -560 0 -560 0 0 -2510z"/> <path d="M200 1870 l0 -1670 630 0 630 0 0 1670 0 1670 -630 0 -630 0 0 -1670z"/> <path d="M1660 1810 l0 -1610 570 0 570 0 0 1610 0 1610 -570 0 -570 0 0 -1610z"/> <path d="M3000 840 l0 -640 570 0 570 0 0 640 0 640 -570 0 -570 0 0 -640z"/> </g> <g id="layer103" fill="#ffff04" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> </g> </svg>',"text/xml").documentElement,availableOptions:["innerRadius","outerRadius","startAngle","endAngle","axisPositionHorizontal","projectionFillColor","projectionStrokeColor","projectionFillOpacity","projectionStrokeOpacity","strokeWidth"],defaultOptions:{innerRadius:100,outerRadius:200,startAngle:0,endAngle:360,axisPositionHorizontal:"left",projectionFillColor:"#777",projectionStrokeColor:"#777",projectionFillOpacity:.3,projectionStrokeOpacity:.7,strokeWidth:1}},hI.config={type:"csv"},pI.config={type:"json"},HI.config={type:"bigwig"};var JI={$ref:"#/definitions/HiGlassSpec",$schema:"http://json-schema.org/draft-07/schema#",definitions:{Assembly:{enum:["hg38","hg19","hg18","hg17","hg16","mm10","mm9","unknown"],type:"string"},CombinedTrack:{additionalProperties:!1,properties:{contents:{items:{$ref:"#/definitions/Track"},type:"array"},height:{type:"number"},options:{},position:{type:"string"},type:{const:"combined",type:"string"},uid:{type:"string"},width:{type:"number"}},required:["type","contents"],type:"object"},Data:{additionalProperties:!1,properties:{assembly:{$ref:"#/definitions/Assembly"},children:{items:{},type:"array"},filter:{items:{$ref:"#/definitions/FilterTransform"},type:"array"},quantitativeFields:{items:{type:"string"},type:"array"},tiles:{},tilesetInfo:{},type:{type:"string"},url:{type:"string"}},type:"object"},EnumTrack:{additionalProperties:!1,properties:{chromInfoPath:{type:"string"},data:{$ref:"#/definitions/Data"},fromViewUid:{type:["null","string"]},height:{type:"number"},options:{},server:{type:"string"},tilesetUid:{type:"string"},type:{$ref:"#/definitions/EnumTrackType"},uid:{type:"string"},width:{type:"number"},x:{type:"number"},y:{type:"number"}},required:["type"],type:"object"},EnumTrackType:{enum:["heatmap","2d-annotations","2d-chromosome-annotations","2d-chromosome-grid","2d-chromosome-labels","2d-rectangle-domains","2d-tiles","arrowhead-domains","bedlike","cross-rule","dummy","horizontal-1d-annotations","horizontal-1d-heatmap","horizontal-1d-tiles","horizontal-1d-value-interval","horizontal-2d-rectangle-domains","horizontal-bar","horizontal-chromosome-grid","horizontal-chromosome-labels","horizontal-divergent-bar","horizontal-gene-annotations","horizontal-heatmap","horizontal-line","horizontal-multivec","horizontal-point","horizontal-rule","horizontal-vector-heatmap","image-tiles","left-axis","left-stacked-interval","mapbox-tiles","osm-2d-tile-ids","osm-tiles","raster-tiles","simple-svg","square-markers","top-axis","top-stacked-interval","vertical-1d-annotations","vertical-1d-heatmap","vertical-1d-tiles","vertical-1d-value-interval","vertical-2d-rectangle-domains","vertical-bar","vertical-bedlike","vertical-chromosome-grid","vertical-chromosome-labels","vertical-gene-annotations","vertical-heatmap","vertical-line","vertical-multivec","vertical-point","vertical-rule","vertical-vector-heatmap","viewport-projection-center","viewport-projection-horizontal","viewport-projection-vertical","gosling-track","gosling-2d-track","axis-track","text"],type:"string"},FilterTransform:{anyOf:[{$ref:"#/definitions/OneOfFilter"},{$ref:"#/definitions/RangeFilter"},{$ref:"#/definitions/IncludeFilter"}]},GenericLocks:{additionalProperties:!1,properties:{locksByViewUid:{$ref:"#/definitions/LocksByViewUid"},locksDict:{}},required:["locksByViewUid","locksDict"],type:"object"},GenomePositionSearchBox:{additionalProperties:!1,properties:{autocompleteId:{type:"string"},autocompleteServer:{type:"string"},chromInfoId:{type:"string"},chromInfoServer:{type:"string"},visible:{type:"boolean"}},required:["chromInfoId","chromInfoServer"],type:"object"},HeatmapTrack:{additionalProperties:!1,properties:{data:{$ref:"#/definitions/Data"},height:{type:"number"},options:{},position:{type:"string"},server:{type:"string"},tilesetUid:{type:"string"},type:{const:"heatmap",type:"string"},uid:{type:"string"},width:{type:"number"}},required:["type"],type:"object"},HiGlassSpec:{additionalProperties:!1,properties:{chromInfoPath:{type:"string"},compactLayout:{type:"boolean"},editable:{type:"boolean"},exportViewUrl:{type:"string"},locationLocks:{$ref:"#/definitions/GenericLocks"},trackSourceServers:{items:{type:"string"},type:"array"},tracksEditable:{type:"boolean"},valueScaleLocks:{$ref:"#/definitions/ValueScaleLocks"},viewEditable:{type:"boolean"},views:{items:{$ref:"#/definitions/View"},type:"array"},zoomFixed:{type:"boolean"},zoomLocks:{$ref:"#/definitions/GenericLocks"}},required:["views","zoomLocks","locationLocks"],type:"object"},IncludeFilter:{additionalProperties:!1,properties:{field:{description:"A filter is applied based on the values of the specified data field",type:"string"},include:{description:"Check whether the value includes a substring.",type:"string"},not:{description:'when `{"not": true}`, apply a NOT logical operation to the filter.\n\n__Default:__ `false`',type:"boolean"},type:{const:"filter",type:"string"}},required:["field","include","type"],type:"object"},IndependentViewportProjectionTrack:{additionalProperties:!1,properties:{fromViewUid:{type:"null"},options:{},projectionXDomain:{items:{type:"number"},type:"array"},projectionYDomain:{items:{type:"number"},type:"array"},transforms:{items:{},type:"array"},type:{enum:["viewport-projection-horizontal","viewport-projection-vertical","viewport-projection-center"],type:"string"},uid:{type:"string"},width:{type:"number"},x:{type:"number"},y:{type:"number"}},required:["type"],type:"object"},Layout:{additionalProperties:!1,properties:{h:{type:"number"},w:{type:"number"},x:{type:"number"},y:{type:"number"}},required:["h","w","x","y"],type:"object"},LocksByViewUid:{additionalProperties:{type:"string"},type:"object"},OneOfFilter:{additionalProperties:!1,properties:{field:{description:"A filter is applied based on the values of the specified data field",type:"string"},not:{description:'when `{"not": true}`, apply a NOT logical operation to the filter.\n\n__Default:__ `false`',type:"boolean"},oneOf:{anyOf:[{items:{type:"string"},type:"array"},{items:{type:"number"},type:"array"}],description:"Check whether the value is an element in the provided list."},type:{const:"filter",type:"string"}},required:["field","oneOf","type"],type:"object"},Overlay:{additionalProperties:!1,properties:{chromInfoPath:{type:"string"},includes:{items:{},type:"array"},options:{$ref:"#/definitions/OverlayOptions"},type:{type:"string"},uid:{type:"string"}},type:"object"},OverlayOptions:{additionalProperties:!1,properties:{extent:{items:{},type:"array"},fill:{type:"string"},fillOpacity:{type:"number"},minWidth:{type:"number"},outline:{type:"string"},outlineOpacity:{type:"number"},outlinePos:{anyOf:[{items:{},type:"array"},{type:"string"}]},outlineWidth:{type:"number"},stroke:{type:"string"},strokeOpacity:{type:"number"},strokePos:{anyOf:[{items:{},type:"array"},{type:"string"}]},strokeWidth:{type:"number"}},type:"object"},RangeFilter:{additionalProperties:!1,properties:{field:{description:"A filter is applied based on the values of the specified data field",type:"string"},inRange:{description:"Check whether the value is in a number range.",items:{type:"number"},type:"array"},not:{description:'when `{"not": true}`, apply a NOT logical operation to the filter.\n\n__Default:__ `false`',type:"boolean"},type:{const:"filter",type:"string"}},required:["field","inRange","type"],type:"object"},Track:{anyOf:[{$ref:"#/definitions/HeatmapTrack"},{$ref:"#/definitions/CombinedTrack"},{$ref:"#/definitions/IndependentViewportProjectionTrack"},{$ref:"#/definitions/EnumTrack"}]},Tracks:{additionalProperties:!1,properties:{bottom:{items:{$ref:"#/definitions/Track"},type:"array"},center:{items:{$ref:"#/definitions/Track"},type:"array"},gallery:{items:{$ref:"#/definitions/Track"},type:"array"},left:{items:{$ref:"#/definitions/Track"},type:"array"},right:{items:{$ref:"#/definitions/Track"},type:"array"},top:{items:{$ref:"#/definitions/Track"},type:"array"},whole:{items:{$ref:"#/definitions/Track"},type:"array"}},required:["top","left","center","right","bottom","gallery","whole"],type:"object"},ValueScaleLocks:{additionalProperties:!1,properties:{locksByViewUid:{$ref:"#/definitions/LocksByViewUid"},locksDict:{}},required:["locksByViewUid"],type:"object"},View:{additionalProperties:!1,properties:{autocompleteSource:{type:"string"},chromInfoPath:{type:"string"},genomePositionSearchBox:{$ref:"#/definitions/GenomePositionSearchBox"},genomePositionSearchBoxVisible:{type:"boolean"},initialXDomain:{items:{type:"number"},type:"array"},initialYDomain:{items:{type:"number"},type:"array"},layout:{$ref:"#/definitions/Layout"},overlays:{items:{$ref:"#/definitions/Overlay"},type:"array"},selectionView:{type:"boolean"},tracks:{$ref:"#/definitions/Tracks"},uid:{type:"string"},zoomFixed:{type:"boolean"},zoomLimits:{items:[{type:["number","null"]},{type:["number","null"]}],maxItems:2,minItems:2,type:"array"}},required:["tracks","layout"],type:"object"}}};function wI(g,I){if("chromosome"in g&&(g.chromosome.includes("chr")&&(g.chromosome=g.chromosome.replace("chr","")),Object.keys(sI().interval).find((I=>I===`chr${g.chromosome}`))||(g.chromosome="1")),function(g){return"chromosome"in g&&!("interval"in g)}(g))return[sI(I).interval[`chr${g.chromosome}`][0]+1,sI(I).interval[`chr${g.chromosome}`][1]];if(function(g){return!("chromosome"in g)&&"interval"in g}(g))return g.interval;if(function(g){return"chromosome"in g&&"interval"in g}(g)){const C=sI(I).interval[`chr${g.chromosome}`][0],[A,l]=g.interval;return[C+A,C+l]}}const SI={compactLayout:!1,trackSourceServers:["https://server.gosling-lang.org/api/v1/"],views:[{genomePositionSearchBoxVisible:!1,genomePositionSearchBox:{autocompleteServer:"https://higlass.io/api/v1",autocompleteId:"P0PLbQMwTYGy-5uPIQid7A",chromInfoServer:"https://higlass.io/api/v1",chromInfoId:"hg38"},layout:{x:0,y:0,w:6.4,h:600},tracks:{top:[],left:[{type:"combined",width:130,height:600,contents:[{type:"gosling-track",server:"https://server.gosling-lang.org/api/v1/",tilesetUid:"cistrome-multivec",width:130,height:600,options:{showMousePosition:!0,mousePositionColor:"#000000",fontSize:24,labelPosition:"none",labelShowResolution:!1,labelColor:"black",labelBackgroundColor:"white",labelTextOpacity:1,labelLeftMargin:1,labelTopMargin:1,labelRightMargin:0,labelBottomMargin:0,backgroundColor:"transparent",spec:{spacing:10,orientation:"vertical",assembly:"hg38",layout:"linear",static:!1,xDomain:{interval:[0,1e9]},centerRadius:.3,xOffset:0,yOffset:0,style:{outlineWidth:.5},data:{url:"https://server.gosling-lang.org/api/v1/tileset_info/?d=cistrome-multivec",type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"],binSize:4},mark:"rect",x:{field:"start",type:"genomic",axis:"left",domain:{interval:[0,1e9]},linkingId:"7f94b74e-25ec-4e67-8c75-3dc0f1b0d6bd"},xe:{field:"end",type:"genomic"},row:{field:"sample",type:"nominal",legend:!0},color:{field:"peak",type:"quantitative",legend:!0},tooltip:[{field:"start",type:"genomic",alt:"Start Position"},{field:"end",type:"genomic",alt:"End Position"},{field:"peak",type:"quantitative",alt:"Value",format:".2"},{field:"sample",type:"nominal",alt:"Sample"}],width:160,height:600,overlayOnPreviousTrack:!1},theme:{base:"light",root:{background:"white",titleColor:"black",titleBackgroundColor:"transparent",titleFontSize:18,titleFontFamily:"Arial",titleAlign:"left",titleFontWeight:"bold",subtitleColor:"gray",subtitleBackgroundColor:"transparent",subtitleFontSize:16,subtitleFontFamily:"Arial",subtitleFontWeight:"normal",subtitleAlign:"left",mousePositionColor:"#000000"},track:{background:"transparent",alternatingBackground:"transparent",titleColor:"black",titleBackground:"white",titleFontSize:24,titleAlign:"left",outline:"black",outlineWidth:1},legend:{position:"top",background:"white",backgroundOpacity:.7,labelColor:"black",labelFontSize:12,labelFontWeight:"normal",labelFontFamily:"Arial",backgroundStroke:"#DBDBDB",tickColor:"black"},axis:{tickColor:"black",labelColor:"black",labelFontSize:12,labelFontWeight:"normal",labelFontFamily:"Arial",baselineColor:"black",gridColor:"#E3E3E3",gridStrokeWidth:1,gridStrokeType:"solid",gridStrokeDash:[4,4]},markCommon:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},point:{color:"#E79F00",size:3,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},rect:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},triangle:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},area:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},line:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},bar:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},rule:{color:"#E79F00",size:1,stroke:"black",strokeWidth:1,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},link:{color:"#E79F00",size:1,stroke:"black",strokeWidth:1,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},text:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6],textAnchor:"middle",textFontWeight:"normal"},brush:{color:"gray",size:1,stroke:"black",strokeWidth:1,opacity:.3,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]}}}}]},{uid:"15483511-f6fb-11eb-914b-976b6ecda162",type:"axis-track",chromInfoPath:"https://s3.amazonaws.com/gosling-lang.org/data/hg38.chrom.sizes",options:{layout:"linear",outerRadius:null,width:160,height:600,theme:{base:"light",root:{background:"white",titleColor:"black",titleBackgroundColor:"transparent",titleFontSize:18,titleFontFamily:"Arial",titleAlign:"left",titleFontWeight:"bold",subtitleColor:"gray",subtitleBackgroundColor:"transparent",subtitleFontSize:16,subtitleFontFamily:"Arial",subtitleFontWeight:"normal",subtitleAlign:"left",mousePositionColor:"#000000"},track:{background:"transparent",alternatingBackground:"transparent",titleColor:"black",titleBackground:"white",titleFontSize:24,titleAlign:"left",outline:"black",outlineWidth:1},legend:{position:"top",background:"white",backgroundOpacity:.7,labelColor:"black",labelFontSize:12,labelFontWeight:"normal",labelFontFamily:"Arial",backgroundStroke:"#DBDBDB",tickColor:"black"},axis:{tickColor:"black",labelColor:"black",labelFontSize:12,labelFontWeight:"normal",labelFontFamily:"Arial",baselineColor:"black",gridColor:"#E3E3E3",gridStrokeWidth:1,gridStrokeType:"solid",gridStrokeDash:[4,4]},markCommon:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},point:{color:"#E79F00",size:3,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},rect:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},triangle:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},area:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},line:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},bar:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},rule:{color:"#E79F00",size:1,stroke:"black",strokeWidth:1,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},link:{color:"#E79F00",size:1,stroke:"black",strokeWidth:1,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},text:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6],textAnchor:"middle",textFontWeight:"normal"},brush:{color:"gray",size:1,stroke:"black",strokeWidth:1,opacity:.3,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]}},assembly:"hg38",stroke:"transparent",color:"black",fontSize:12,fontFamily:"Arial",fontWeight:"normal",tickColor:"black",tickFormat:"plain",tickPositions:"even",reverseOrientation:!1},width:30}],center:[],right:[],bottom:[],gallery:[],whole:[]},initialXDomain:[0,1e9],initialYDomain:[0,1e9],zoomFixed:!1,zoomLimits:[1,null],uid:"15483510-f6fb-11eb-914b-976b6ecda162",chromInfoPath:"https://s3.amazonaws.com/gosling-lang.org/data/hg38.chrom.sizes"},{genomePositionSearchBoxVisible:!1,genomePositionSearchBox:{autocompleteServer:"https://higlass.io/api/v1",autocompleteId:"P0PLbQMwTYGy-5uPIQid7A",chromInfoServer:"https://higlass.io/api/v1",chromInfoId:"hg38"},layout:{x:6.8,y:0,w:5.2,h:600},tracks:{top:[],left:[{type:"combined",width:130,height:600,contents:[{type:"gosling-track",server:"https://server.gosling-lang.org/api/v1/",tilesetUid:"cistrome-multivec",width:130,height:600,options:{showMousePosition:!0,mousePositionColor:"#000000",fontSize:24,labelPosition:"none",labelShowResolution:!1,labelColor:"black",labelBackgroundColor:"white",labelTextOpacity:1,labelLeftMargin:1,labelTopMargin:1,labelRightMargin:0,labelBottomMargin:0,backgroundColor:"transparent",spec:{spacing:10,orientation:"vertical",assembly:"hg38",layout:"linear",static:!1,xDomain:{interval:[0,1e9]},centerRadius:.3,xOffset:0,yOffset:0,style:{outlineWidth:.5},data:{url:"https://server.gosling-lang.org/api/v1/tileset_info/?d=cistrome-multivec",type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"],binSize:4},mark:"rect",x:{field:"start",type:"genomic",domain:{interval:[0,1e9]},linkingId:"7f94b74e-25ec-4e67-8c75-3dc0f1b0d6bd"},xe:{field:"end",type:"genomic"},row:{field:"sample",type:"nominal",legend:!0},color:{field:"peak",type:"quantitative",legend:!0},tooltip:[{field:"start",type:"genomic",alt:"Start Position"},{field:"end",type:"genomic",alt:"End Position"},{field:"peak",type:"quantitative",alt:"Value",format:".2"},{field:"sample",type:"nominal",alt:"Sample"}],width:130,height:600},theme:{base:"light",root:{background:"white",titleColor:"black",titleBackgroundColor:"transparent",titleFontSize:18,titleFontFamily:"Arial",titleAlign:"left",titleFontWeight:"bold",subtitleColor:"gray",subtitleBackgroundColor:"transparent",subtitleFontSize:16,subtitleFontFamily:"Arial",subtitleFontWeight:"normal",subtitleAlign:"left",mousePositionColor:"#000000"},track:{background:"transparent",alternatingBackground:"transparent",titleColor:"black",titleBackground:"white",titleFontSize:24,titleAlign:"left",outline:"black",outlineWidth:1},legend:{position:"top",background:"white",backgroundOpacity:.7,labelColor:"black",labelFontSize:12,labelFontWeight:"normal",labelFontFamily:"Arial",backgroundStroke:"#DBDBDB",tickColor:"black"},axis:{tickColor:"black",labelColor:"black",labelFontSize:12,labelFontWeight:"normal",labelFontFamily:"Arial",baselineColor:"black",gridColor:"#E3E3E3",gridStrokeWidth:1,gridStrokeType:"solid",gridStrokeDash:[4,4]},markCommon:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},point:{color:"#E79F00",size:3,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},rect:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},triangle:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},area:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},line:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},bar:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},rule:{color:"#E79F00",size:1,stroke:"black",strokeWidth:1,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},link:{color:"#E79F00",size:1,stroke:"black",strokeWidth:1,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},text:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6],textAnchor:"middle",textFontWeight:"normal"},brush:{color:"gray",size:1,stroke:"black",strokeWidth:1,opacity:.3,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]}}}}]}],center:[],right:[],bottom:[],gallery:[],whole:[]},initialXDomain:[0,1e9],initialYDomain:[0,1e9],zoomFixed:!1,zoomLimits:[1,null],uid:"154b1b40-f6fb-11eb-914b-976b6ecda162"}],zoomLocks:{locksByViewUid:{},locksDict:{}},locationLocks:{locksByViewUid:{},locksDict:{}},editable:!1,chromInfoPath:"https://s3.amazonaws.com/gosling-lang.org/data/hg38.chrom.sizes"};class FI{constructor(){this.assembly="hg38",this.hg={compactLayout:!1,trackSourceServers:[],views:[],zoomLocks:{locksByViewUid:{},locksDict:{}},locationLocks:{locksByViewUid:{},locksDict:{}}},this.setEditable(!1)}spec(){return this.hg}setViewOrientation(g){return this.orientation=g,this}addDefaultView(g,I){return this.hg.views.push(JSON.parse(JSON.stringify(e(Z({},(g=>({genomePositionSearchBoxVisible:!1,genomePositionSearchBox:{autocompleteServer:"https://higlass.io/api/v1",autocompleteId:"P0PLbQMwTYGy-5uPIQid7A",chromInfoServer:"https://higlass.io/api/v1",chromInfoId:null!=g?g:"hg38"},layout:{w:12,h:12,x:0,y:0},tracks:{top:[],left:[],center:[],right:[],bottom:[],gallery:[],whole:[]},initialXDomain:[0,sI(g).total],initialYDomain:[0,sI(g).total],zoomFixed:!1}))(I)),{uid:g})))),this}setAssembly(g){return this.assembly=g,this.setChromInfoPath(sI(this.assembly).path),this}getAssembly(){return this.assembly}setTextTrack(g,I,C,A="black",l=14,i="normal",c="left",d="transparent",Z="Arial"){var e;return this.getLastView()&&(null==(e=this.getLastView().tracks.top)||e.push({type:"text",width:g,height:I,options:{backgroundColor:d,textColor:A,fontSize:l,fontWeight:i,fontFamily:Z,offsetY:0,align:c,text:C}})),this}addBrush(g,I,C,A,l){var i,c,d,Z,e,m;if(A)return null==(m=this.getView(I))||m.tracks.whole.push({type:"circular"===g?"brush-track":"viewport-projection-horizontal",uid:Y(),fromViewUid:A,options:{projectionFillColor:null!=(i=null==l?void 0:l.color)?i:C.brush.color,projectionStrokeColor:null!=(c=null==l?void 0:l.stroke)?c:C.brush.stroke,projectionFillOpacity:null!=(d=null==l?void 0:l.opacity)?d:C.brush.opacity,projectionStrokeOpacity:null!=(Z=null==l?void 0:l.opacity)?Z:C.brush.opacity,strokeWidth:null!=(e=null==l?void 0:l.strokeWidth)?e:C.brush.strokeWidth,startAngle:null==l?void 0:l.startAngle,endAngle:null==l?void 0:l.endAngle,innerRadius:null==l?void 0:l.innerRadius,outerRadius:null==l?void 0:l.outerRadius}}),this}getLastView(){return this.hg.views[this.hg.views.length-1]}getMainTrackPosition(){return"vertical"===this.orientation?"left":"center"}getLastVisView(){const g=this.hg.views.filter((g=>{var I,C;return"combined"===(null==(C=null==(I=g.tracks[this.getMainTrackPosition()])?void 0:I[0])?void 0:C.type)}));return g[g.length-1]}getView(g){return this.hg.views.find((I=>I.uid===g))}validateSpec(g=!1){return"success"===YI(JI,this.spec(),g).state}setDomain(g,I){return g&&(this.getLastView().initialXDomain=wI(g,this.getAssembly())),I&&(this.getLastView().initialYDomain=wI(I,this.getAssembly())),this}adjustDomain(g="horizontal",I,C){if("vertical"!==g)return this;const A=this.getLastView().initialXDomain;if(!A)return this;const[l,i]=A,c=i-l,d=(l+i)/2;return this.getLastView().initialXDomain=[d-c/I/2/C*I,d+c/I/2/C*I],this}setZoomFixed(g){return this.getLastView().zoomFixed=g,this}setZoomLimits(g){return this.getLastView().zoomLimits=g,this}setLayout(g){return this.getLastView().layout=g,this}setEditable(g){return this.hg.editable=g,this}setChromInfoPath(g){return this.getLastView()&&(this.getLastView().chromInfoPath=g),this.hg.chromInfoPath=g,this}addTrackSourceServers(g){var I,C;return g&&-1===(null==(I=this.hg.trackSourceServers)?void 0:I.indexOf(g))&&(null==(C=this.hg.trackSourceServers)||C.push(g)),this}setMainTrack(g){var I;return this.getLastView()?(this.getLastView().tracks[this.getMainTrackPosition()]=[{type:"combined",uid:`${null!=(I=g.uid)?I:Y()}-${this.getMainTrackPosition()}-combined`,width:g.width-1,height:g.height,contents:[g]}],this):this}addTrackToCombined(g){var I;return this.getLastVisView()?(null==(I=this.getLastVisView().tracks[this.getMainTrackPosition()][0])||I.contents.push(g),this):this}setAxisTrack(g,I="regular",C){var A;if(!this.hg.views)return this;const l="left"===g||"right"===g?"width":"height",i={uid:null!=(A=C.id)?A:w(),type:"axis-track",chromInfoPath:this.hg.chromInfoPath,options:e(Z({},C),{assembly:this.getAssembly(),stroke:"transparent",color:C.theme.axis.labelColor,fontSize:C.theme.axis.labelFontSize,fontFamily:C.theme.axis.labelFontFamily,fontWeight:C.theme.axis.labelFontWeight,tickColor:C.theme.axis.tickColor,tickFormat:"narrower"===I?"si":"plain",tickPositions:"regular"===I?"even":"ends",reverseOrientation:"bottom"===g||"right"===g})};if("circular"===C.layout)this.addTrackToCombined(e(Z({},i),{options:e(Z({},i.options),{layout:"circular"})}));else{const I=e(Z({},i),{[l]:30});if("left"===g){if(0!==this.getLastView().tracks.left.filter((g=>"axis-track"===g.type)).length)return this;this.getLastView().tracks.left=(c=this.getLastView().tracks.left,d=0,m=I,c||(c=[]),[...c.slice(0,d),m,...c.slice(d)])}else if("right"===g){if(0!==this.getLastView().tracks.left.filter((g=>"axis-track"===g.type)).length)return this;this.getLastView().tracks.left.push(I)}else{if(0!==this.getLastView().tracks[g].filter((g=>"axis-track"===g.type)).length)return this;this.getLastView().tracks[g].push(I)}}var c,d,m;return this}setExampleHiglassViewConfig(){this.hg=SI}}function kI(g,I,C,A){const l=A&&0!==A?A:void 0;let i=0;switch(I){case"less-than":case"LT":case"lt":i=C>g?l?(C-g)/l:1:0;break;case"less-than-or-equal-to":case"LTET":case"ltet":i=C>=g?l?(C-g)/l:1:0;break;case"greater-than":case"GT":case"gt":i=C<g?l?(g-C)/l:1:0;break;case"greater-than-or-equal-to":case"GTET":case"gtet":i=C<=g?l?(g-C)/l:1:0}return Math.max(Math.min(1,i),0)}const vI={NOMINAL_COLOR:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],NOMINAL_COLOR_EXTENDED:["#d60000","#018700","#b500ff","#05acc6","#97ff00","#ffa52f","#ff8ec8","#79525e","#00fdcf","#afa5ff","#93ac83","#9a6900","#366962","#d3008c","#fdf490","#c86e66","#9ee2ff","#00c846","#a877ac","#b8ba01","#f4bfb1","#ff28fd","#f2cdff","#009e7c","#ff6200","#56642a","#953f1f","#90318e","#ff3464","#a0e491","#8c9ab1","#829026","#ae083f","#77c6ba","#bc9157","#e48eff","#72b8ff","#c6a5c1","#ff9070","#d3c37c","#bceddb","#6b8567","#916e56","#f9ff00","#bac1df","#ac567c","#ffcd03","#ff49b1","#c15603","#5d8c90","#c144bc","#00753f","#ba6efd","#00d493","#00ff75","#49a150","#cc9790","#00ebed","#db7e01","#f77589","#b89500","#c84248","#00cff9","#755726","#85d401","#ebffd4","#a77b87","#db72c8","#cae256","#8abf5d","#a1216b","#855b89","#89bacf","#ffbad6","#b6cfaa","#97414d","#67aa00","#fde1b1","#ff3628","#80793d","#d6e8ff","#a795c6","#7ea59a","#d182a3","#54823b","#e6a872","#9cffff","#da5480","#05b3aa","#ffaaf6","#d1afef","#da015d","#ac1a13","#60b385","#d442fd","#acaa59","#fb9ca7","#b3723b","#f26952","#aed1d4","#9affc3","#dbb333","#eb01c3","#9900c4","#cfff9e","#a55949","#3b6d01","#008579","#959167","#89dbb3","#6d7400","#aa5dca","#07ef00","#804f3d","#d88052","#ffc862","#b8009e","#99acdd","#904f00","#8c4470","#4f6e52","#ff8734","#c68ecd","#d4e29e","#b1826d","#9cfb75","#56dd77","#f90087","#a1cdff","#13cad1","#118e54","#d154a5","#00dfc3","#a3832f","#77975b","#baaa80","#70a3af","#d6fbff","#e8013a","#d84621","#ff82ed","#b63862","#b6cd72","#97626b","#897490","#00a316","#00f4a1","#bf90f2","#89e4d8","#a34d95","#6e5d00","#8cc68e","#95aa2a","#c672dd","#b33b01","#d69a36","#dfacb6","#009aa0","#599000","#97bca8","#ac8ca8","#dad4ff","#547c72","#00ba69","#ffc38e","#b800d4","#dfcf5b","#629a7b","#bfedbc","#c1bdfd","#80d3dd","#e2857e","#f9eb4d","#bf6d82","#caff4f","#ef72aa","#ed67ff","#9946ae","#6d6942","#e25660","#dd662d","#9cdb5d","#e29ccf","#b87500","#c6002d","#dfbcda","#59b5df","#ff59da","#38c1a1","#9e698c","#acaac8","#95622f","#b55662","#2b7e60","#b1e400","#eda590","#95fde2","#ff548e","#bd6ea1","#aa3b36","#d8cf00","#aa80cd","#a08052","#e100e8","#c35b3d","#b53a85","#8c7700","#dbbc95","#529e93","#afbc82","#91b5b6","#a75423","#ffd4ef","#79ae6b","#5db54b","#80fb9a","#48ffef","#979548","#9387a7","#31d400","#6ee956","#b6d4eb","#705470","#f2db8a","#aad4c1","#7ecdf2","#89ba00","#64b6ba","#ffb500","#c38285","#caaa5e","#647748","#59e2ff","#df4dcd","#e9ff79","#bc66b8","#c395a5","#64c674","#d19570","#70cf4f","#aa6e66","#9c60a5","#00b800","#e299b3","#bc006b","#b3e8ef","#cdbfe4","#77a342","#856277","#568e5b","#9eafc4","#e82fa0","#247c2a","#826723","#bfbc4d","#ddd3a5"],QUANTITATIVE_COLOR:"viridis",SIZE:3,SIZE_RANGE:[2,6]};var NI,fI;function zI(g="light"){if("string"==typeof g)return z(g)?x(g):"dark"===g||"light"===g?MI[g]:MI.light;{let I=JSON.parse(JSON.stringify(MI.light));return z(g.base)?I=x(g.base):"light"!==g.base&&"dark"!==g.base||(I=JSON.parse(JSON.stringify(MI[g.base]))),Object.keys(I).forEach((C=>{g[C]&&"base"!==C&&(I[C]=u(JSON.parse(JSON.stringify(I[C])),JSON.parse(JSON.stringify(g[C]))))})),I}}(fI=NI||(NI={})).light="light",fI.dark="dark";const xI={color:vI.NOMINAL_COLOR[0],size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:vI.NOMINAL_COLOR,quantitativeSizeRange:[2,6]},UI=e(Z({},xI),{stroke:"white"}),MI={light:{base:"light",root:{background:"white",titleColor:"black",titleBackgroundColor:"transparent",titleFontSize:18,titleFontFamily:"Arial",titleAlign:"left",titleFontWeight:"bold",subtitleColor:"gray",subtitleBackgroundColor:"transparent",subtitleFontSize:16,subtitleFontFamily:"Arial",subtitleFontWeight:"normal",subtitleAlign:"left",showMousePosition:!0,mousePositionColor:"#000000"},track:{background:"transparent",alternatingBackground:"transparent",titleColor:"black",titleBackground:"white",titleFontSize:24,titleAlign:"left",outline:"black",outlineWidth:1},legend:{position:"top",background:"white",backgroundOpacity:.7,labelColor:"black",labelFontSize:12,labelFontWeight:"normal",labelFontFamily:"Arial",backgroundStroke:"#DBDBDB",tickColor:"black"},axis:{tickColor:"black",labelColor:"black",labelFontSize:12,labelFontWeight:"normal",labelFontFamily:"Arial",baselineColor:"black",gridColor:"#E3E3E3",gridStrokeWidth:1,gridStrokeType:"solid",gridStrokeDash:[4,4]},markCommon:Z({},xI),point:e(Z({},xI),{size:3}),rect:Z({},xI),triangle:Z({},xI),area:Z({},xI),line:Z({},xI),bar:Z({},xI),rule:e(Z({},xI),{strokeWidth:1}),link:e(Z({},xI),{strokeWidth:1}),text:e(Z({},xI),{textAnchor:"middle",textFontWeight:"normal"}),brush:e(Z({},xI),{color:"gray",opacity:.3,stroke:"black",strokeWidth:1})},dark:{base:"dark",root:{background:"black",titleColor:"white",titleBackgroundColor:"transparent",titleFontSize:18,titleFontFamily:"Arial",titleAlign:"middle",titleFontWeight:"bold",subtitleColor:"lightgray",subtitleBackgroundColor:"transparent",subtitleFontSize:16,subtitleFontFamily:"Arial",subtitleAlign:"middle",subtitleFontWeight:"normal",showMousePosition:!0,mousePositionColor:"#FFFFFF"},track:{background:"transparent",alternatingBackground:"transparent",titleColor:"white",titleBackground:"black",titleFontSize:18,titleAlign:"left",outline:"white",outlineWidth:1},legend:{position:"right",background:"black",backgroundOpacity:.7,labelColor:"white",labelFontSize:12,labelFontWeight:"normal",labelFontFamily:"Arial",backgroundStroke:"#DBDBDB",tickColor:"white"},axis:{tickColor:"white",labelColor:"white",labelFontSize:10,labelFontWeight:"normal",labelFontFamily:"Arial",baselineColor:"white",gridColor:"gray",gridStrokeWidth:1,gridStrokeType:"solid",gridStrokeDash:[4,4]},markCommon:Z({},UI),point:e(Z({},UI),{size:3}),rect:Z({},UI),triangle:Z({},UI),area:Z({},UI),line:Z({},UI),bar:Z({},UI),rule:e(Z({},UI),{strokeWidth:1}),link:e(Z({},UI),{strokeWidth:1}),text:e(Z({},UI),{textAnchor:"middle",textFontWeight:"normal"}),brush:e(Z({},UI),{color:"lightgray",opacity:.3,stroke:"white",strokeWidth:1})}};class LI{constructor(g,I,C){this.id=w(),this.theme=null!=C?C:zI(),this.dataOriginal=JSON.parse(JSON.stringify(I)),this.dataAggregated=JSON.parse(JSON.stringify(I)),this.specOriginal=JSON.parse(JSON.stringify(g)),this.specComplete=JSON.parse(JSON.stringify(g)),this.channelScales={};const A=this.validateSpec();A.valid?(this.generateCompleteSpec(this.specComplete),this.flipRanges(this.specComplete),this.generateScales(),this.dataAggregated=WI(this.spec(),this.dataAggregated)):console.warn("Gosling specification is not valid!",A.errorMessages)}getId(){return this.id}getRenderingId(){var g;return null!=(g=this.spec()._renderingId)?g:this.getId()}originalSpec(){return this.specOriginal}spec(){return this.specComplete}data(){return this.dataAggregated}generateCompleteSpec(g){if(!g.width||!g.height)return void console.warn("Size of track is not determined yet.");if("vertical"===g.orientation){const I=g.width;g.width=g.height,g.height=I}const I=this.getGenomicChannelKey();let C=!1;"x"===I&&(C=Dg(g.x)&&void 0!==g.x.axis&&"none"!==g.x.axis),"y"===I&&(C=Dg(g.y)&&void 0!==g.y.axis&&"none"!==g.y.axis),"circular"!==g.layout?Dg(g.x)&&void 0!==g.x.axis&&"none"!==g.x.axis&&(g.height-=30):"x"===I&&C&&Dg(g.x)&&"top"===g.x.axis?g.outerRadius=g.outerRadius-30:"x"===I&&C&&Dg(g.x)&&"bottom"===g.x.axis&&(g.innerRadius=g.innerRadius+30),wg.forEach((I=>{const C=g[I];Dg(C)&&!("zeroBaseline"in C)&&"quantitative"===C.type&&(C.zeroBaseline=!0)})),this.addScaleMaterials(g)}flipRanges(g){Dg(g.y)&&g.y.flip&&Array.isArray(g.y.range)&&(g.y.range=g.y.range.reverse())}getGenomicChannelKey(){return rI(this.spec())}getGenomicChannel(){return RI(this.spec())}setChannelDomain(g,I,C){const A=this.originalSpec()[g];if(!C&&Dg(A)&&void 0!==A.domain)return;const l=this.specComplete[g];Dg(l)&&(l.domain=I)}setChannelRange(g,I){const C=this.specComplete[g];Dg(C)&&(C.range=I)}updateChannelValue(){if(void 0===this.originalSpec().y){const g=this.spec().y,I=this.getChannelDomainArray("row");g&&Lg(g)&&I&&(g.value=this.spec().height/I.length/2)}}encodedValue(g,I){if("text"===g&&void 0!==I)return`${+I?~~I:I}`;const C=this.spec()[g],A=Dg(C)?C.type:Lg(C)?"constant":void 0;if(A){if("constant"===A)return this.channelScales[g]();if(void 0!==I&&"function"==typeof this.channelScales[g])switch(g){case"x":case"y":case"x1":case"y1":case"xe":case"ye":case"x1e":if("quantitative"===A||"genomic"===A)return this.channelScales[g](I);if("nominal"===A)return this.channelScales[g](I);break;case"color":case"stroke":case"size":if("quantitative"===A)return this.channelScales[g](I);if("nominal"===A)return this.channelScales[g](I);break;case"row":if("nominal"===A)return this.channelScales[g](I);break;case"strokeWidth":case"opacity":if("quantitative"===A)return this.channelScales[g](I);break;default:return void console.warn(`${g} is not supported for encoding values, so returning a undefined value`)}}}trackVisibility(g){const I=this.spec();if(!I.visibility||0===I.visibility.length||0===I.visibility.filter((g=>"track"===g.target)).length)return!0;let C=!0;return I.visibility.filter((g=>"track"===g.target)).forEach((A=>{const{operation:l,measure:i,threshold:c}=A;let d;d="zoomLevel"===i?g[i]:I[i],void 0!==d&&(C=C&&1===kI(d,l,c))})),C}markVisibility(g,I){const C=this.spec();if(!C.visibility||0===C.visibility.length||0===C.visibility.filter((g=>"mark"===g.target)).length)return 1;let A=1;return C.visibility.filter((g=>"mark"===g.target)).forEach((l=>{const{operation:i,threshold:c,conditionPadding:d,transitionPadding:Z,measure:e}=l,m=null!=d?d:0;let o=1;if("text"===C.mark&&"|xe-x|"===c&&"width"===e){const C=this.encodedPIXIProperty("xe",g),A=this.encodedPIXIProperty("x",g);void 0!==C&&(null==I?void 0:I.width)&&(o=kI(I.width+m,i,Math.abs(C-A),Z))}else"width"===e&&"number"==typeof c&&(null==I?void 0:I.width)?o=kI(I.width+m,i,c,Z):"zoomLevel"===e&&"number"==typeof c&&(null==I?void 0:I.zoomLevel)&&(o=kI(I.zoomLevel,i,c,Z));A>o&&(A=o)})),A}visualPropertyByChannel(g,I){const C=void 0!==I?Pg(I,this.spec()[g]):void 0;return this.encodedValue(g,C)}encodedPIXIProperty(g,I,C){const A=this.spec().mark;if(["text","color","row","stroke","opacity","strokeWidth","x","y","xe","x1","x1e","ye","size"].includes(g))return this.visualPropertyByChannel(g,I);switch(A){case"bar":return function(g,I,C,A){const l=g.visualPropertyByChannel("x",C),i=g.visualPropertyByChannel("xe",C),c=g.visualPropertyByChannel("size",C);switch(I){case"width":return null!=c?c:i?i-l:null==A?void 0:A.tileUnitWidth;case"x-start":if(!(null==A?void 0:A.markWidth))return;return i?(l+i-(null==A?void 0:A.markWidth))/2:l-(null==A?void 0:A.markWidth)/2;default:return}}(this,g,I,C);case"point":case"text":return function(g,I,C){const A=g.visualPropertyByChannel("xe",C),l=g.visualPropertyByChannel("x",C),i=g.visualPropertyByChannel("size",C);switch(I){case"x-center":return A?(A+l)/2:l;case"y-center":const I=g.visualPropertyByChannel("ye",C),c=g.visualPropertyByChannel("y",C);return I?(I+c)/2:c;case"p-size":return A&&g.spec().stretch?(A-l)/2:i;default:return}}(this,g,I);case"rect":return function(g,I,C,A){var l;switch(I){case"width":const I=g.visualPropertyByChannel("xe",C)?g.visualPropertyByChannel("xe",C)-g.visualPropertyByChannel("x",C):null==A?void 0:A.markWidth;return 0===I?.1:I;case"height":return null!=(l=g.visualPropertyByChannel("size",C))?l:null==A?void 0:A.markHeight;default:return}}(this,g,I,C);default:return}}addScaleMaterials(g){const I=this.data(),C=this.getGenomicChannel();C&&C.field?g.width&&g.height?(wg.forEach((A=>{var l,i,c,d;const Z=g[A];if(function(g,I){const C=g[I];return Og(g)&&("x"===I||"y"===I)&&Dg(C)&&"quantitative"===C.type}(g,A)&&Dg(Z)){const i=b(I,(g=>g[C.field])),c=[...i.keys()];if(!Z.domain){const g="zeroBaseline"in Z&&Z.zeroBaseline?0:s(c.map((g=>U(i.get(g).map((g=>Z.field?g[Z.field]:void 0)))))),I=a(c.map((g=>U(i.get(g).map((g=>Z.field?g[Z.field]:void 0))))));Z.domain=[g,I]}if(!Z.range){const C=g.row,i=Dg(C)?C.field:void 0,c=null!=(l=this.getChannelDomainArray("row"))?l:i?Array.from(new Set(I.map((g=>g[i])))):[1],d=g.height/c.length;switch(A){case"x":Z.range=[0,g.width];break;case"y":Z.range=[0,d]}}}else{const C=g.row,l=Dg(C)?C.field:void 0,e=null!=(i=this.getChannelDomainArray("row"))?i:l?Array.from(new Set(I.map((g=>g[l])))):[1],m=g.height/e.length;if(Z)if(!Dg(Z)||"quantitative"!==Z.type&&"genomic"!==Z.type){if(Dg(Z)&&"nominal"===Z.type&&(void 0===Z.domain&&(Z.domain=Array.from(new Set(I.map((g=>g[Z.field]))))),!Z.range)){let I,C=2;switch(A){case"x":case"xe":I=[0,g.width];break;case"y":case"ye":I=[m,0];break;case"color":case"stroke":I=this.theme.markCommon.nominalColorRange;break;case"row":I=[0,g.height];break;case"size":I=Z.domain.map((()=>C++))}I&&(Z.range=I)}}else{if(void 0===Z.domain){const g="zeroBaseline"in Z&&Z.zeroBaseline?0:null!=(c=s(I.map((g=>+g[Z.field]))))?c:0,C=null!=(d=a(I.map((g=>+g[Z.field]))))?d:0;Z.domain=[g,C]}else"genomic"!==Z.type||Qg(Z.domain)||(Z.domain=wI(Z.domain));if(!Z.range){let I;switch(A){case"x":case"xe":case"x1":case"x1e":I=[0,g.width];break;case"y":case"ye":I=[0,m];break;case"color":case"stroke":I=vI.QUANTITATIVE_COLOR;break;case"size":I=this.theme.markCommon.quantitativeSizeRange;break;case"strokeWidth":I=[1,3];break;case"opacity":I=[0,1]}I&&(Z.range=I)}}else{let I;switch(A){case"x":I=g.width/2;break;case"y":I=m/2;break;case"size":I="line"===g.mark?this.theme.line.size:"bar"===g.mark||"rect"===g.mark||"triangleRight"===g.mark||"triangleLeft"===g.mark||"triangleBottom"===g.mark||g.stretch&&"point"===g.mark&&Dg(g.x)&&Dg(g.xe)?void 0:"text"===g.mark?12:this.theme.point.size;break;case"color":I=this.theme.markCommon.color;break;case"row":I=0;break;case"stroke":I="text"===g.mark?this.theme.text.stroke:this.theme.markCommon.stroke;break;case"strokeWidth":I="rule"===g.mark?this.theme.rule.strokeWidth:"withinLink"===g.mark||"betweenLink"===g.mark?this.theme.link.strokeWidth:"text"===g.mark?this.theme.text.strokeWidth:this.theme.markCommon.strokeWidth;break;case"opacity":I=this.theme.markCommon.opacity;break;case"text":I=""}void 0!==I&&(g[A]={value:I})}}})),[["x","xe"],["y","ye"]].forEach((I=>{const[C,A]=I,l=g[C],i=g[A];if(Dg(l)&&Dg(i)&&l.type===i.type&&l.domain&&i.domain&&Array.isArray(l.domain)&&Array.isArray(i.domain))if("genomic"===l.type||"quantitative"===l.type){const g=s([l.domain[0],i.domain[0]]),I=a([l.domain[1],i.domain[1]]);l.domain=i.domain=[g,I]}else if("nominal"===l.type){const g=Array.from(new Set([...l.domain,...i.domain]));l.range=i.range=g}}))):console.warn("Track size is not determined yet"):console.warn("Genomic field is not provided in the specification")}generateScales(){const g=this.spec();wg.forEach((I=>{const C=g[I];if(Lg(C))this.channelScales[I]=()=>C.value;else if(Dg(C)){if("text"===I)return;const g=C.domain,A=C.range;if(void 0===g||void 0===A)return;if("quantitative"===C.type||"genomic"===C.type)switch(I){case"x":case"x1":case"xe":case"x1e":case"y":case"ye":case"size":case"opacity":case"strokeWidth":this.channelScales[I]=n().domain(g).range(A);break;case"color":case"stroke":let C=X;Object.keys(vg).includes(A)&&(C=vg[A]),this.channelScales[I]=M(C).domain(g)}else if("nominal"===C.type)switch(I){case"x":case"xe":case"y":case"ye":case"row":this.channelScales[I]=T().domain(g).range(A);break;case"size":this.channelScales[I]=L().domain(g).range(A);break;case"color":case"stroke":this.channelScales[I]=L(A).domain(g)}}}))}getChannelScale(g){return this.channelScales[g]}setChannelScale(g,I){this.channelScales[g]=I}addDataRows(g){this.dataAggregated=[...this.dataAggregated,...g]}isShowYAxis(){const g=this.spec(),I=this.getChannelDomainArray("y"),C=this.getChannelRangeArray("y");return Dg(g.y)&&"none"!==g.y.axis&&"quantitative"===g.y.type&&!!I&&!!C}getChannelDomainArray(g){const I=this.spec()[g];return Dg(I)&&Qg(I.domain)?I.domain:void 0}getChannelRangeArray(g){const I=this.spec()[g];return Dg(I)&&(C=I.range,y(C))?I.range:void 0;var C}validateSpec(){return KI(this.originalSpec())}}class TI{constructor(g,I,C){this.worker=C,this.dataConfig=I,this.uid=g.libraries.slugid.nice(),this.assembly="hg38",this.fetchTimeout=null,this.toFetch=new Set,this.initPromise=this.worker.then((g=>{var C;return I.url&&!I.bamUrl&&(I.bamUrl=I.url),I.baiUrl||(I.baiUrl=null!=(C=I.indexUrl)?C:`${I.bamUrl}.bai`),g.init(this.uid,I).then((()=>this.worker))}))}tilesetInfo(g){this.worker.then((I=>{I.tilesetInfo(this.uid).then(g)}))}fetchTilesDebounced(g,I){const{toFetch:C}=this;if(I[0].split(".")[0]!==(C.size?[...C][0].split(".")[0]:null)){for(const g of this.toFetch)this.track.fetching.delete(g);this.toFetch.clear()}I.forEach((g=>this.toFetch.add(g))),this.fetchTimeout&&clearTimeout(this.fetchTimeout),this.fetchTimeout=setTimeout((()=>{this.sendFetch(g,[...this.toFetch]),this.toFetch.clear()}),200)}sendFetch(g,I){this.worker.then((C=>{C.fetchTilesDebounced(this.uid,I).then(g)}))}}const DI="KCgpID0+IHsKICB2YXIgX19jcmVhdGUgPSBPYmplY3QuY3JlYXRlOwogIHZhciBfX2RlZlByb3AgPSBPYmplY3QuZGVmaW5lUHJvcGVydHk7CiAgdmFyIF9fZGVmUHJvcHMgPSBPYmplY3QuZGVmaW5lUHJvcGVydGllczsKICB2YXIgX19nZXRPd25Qcm9wRGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CiAgdmFyIF9fZ2V0T3duUHJvcERlc2NzID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnM7CiAgdmFyIF9fZ2V0T3duUHJvcE5hbWVzID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXM7CiAgdmFyIF9fZ2V0T3duUHJvcFN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzOwogIHZhciBfX2dldFByb3RvT2YgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Y7CiAgdmFyIF9faGFzT3duUHJvcCA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CiAgdmFyIF9fcHJvcElzRW51bSA9IE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGU7CiAgdmFyIF9fcG93ID0gTWF0aC5wb3c7CiAgdmFyIF9fZGVmTm9ybWFsUHJvcCA9IChvYmosIGtleSwgdmFsdWUpID0+IGtleSBpbiBvYmogPyBfX2RlZlByb3Aob2JqLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSwgdmFsdWUgfSkgOiBvYmpba2V5XSA9IHZhbHVlOwogIHZhciBfX3NwcmVhZFZhbHVlcyA9IChhLCBiKSA9PiB7CiAgICBmb3IgKHZhciBwcm9wIGluIGIgfHwgKGIgPSB7fSkpCiAgICAgIGlmIChfX2hhc093blByb3AuY2FsbChiLCBwcm9wKSkKICAgICAgICBfX2RlZk5vcm1hbFByb3AoYSwgcHJvcCwgYltwcm9wXSk7CiAgICBpZiAoX19nZXRPd25Qcm9wU3ltYm9scykKICAgICAgZm9yICh2YXIgcHJvcCBvZiBfX2dldE93blByb3BTeW1ib2xzKGIpKSB7CiAgICAgICAgaWYgKF9fcHJvcElzRW51bS5jYWxsKGIsIHByb3ApKQogICAgICAgICAgX19kZWZOb3JtYWxQcm9wKGEsIHByb3AsIGJbcHJvcF0pOwogICAgICB9CiAgICByZXR1cm4gYTsKICB9OwogIHZhciBfX3NwcmVhZFByb3BzID0gKGEsIGIpID0+IF9fZGVmUHJvcHMoYSwgX19nZXRPd25Qcm9wRGVzY3MoYikpOwogIHZhciBfX21hcmtBc01vZHVsZSA9ICh0YXJnZXQpID0+IF9fZGVmUHJvcCh0YXJnZXQsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICB2YXIgX19lc20gPSAoZm4sIHJlcykgPT4gZnVuY3Rpb24gX19pbml0KCkgewogICAgcmV0dXJuIGZuICYmIChyZXMgPSAoMCwgZm5bT2JqZWN0LmtleXMoZm4pWzBdXSkoZm4gPSAwKSksIHJlczsKICB9OwogIHZhciBfX2NvbW1vbkpTID0gKGNiLCBtb2QpID0+IGZ1bmN0aW9uIF9fcmVxdWlyZSgpIHsKICAgIHJldHVybiBtb2QgfHwgKDAsIGNiW09iamVjdC5rZXlzKGNiKVswXV0pKChtb2QgPSB7IGV4cG9ydHM6IHt9IH0pLmV4cG9ydHMsIG1vZCksIG1vZC5leHBvcnRzOwogIH07CiAgdmFyIF9fcmVFeHBvcnQgPSAodGFyZ2V0LCBtb2R1bGUsIGRlc2MpID0+IHsKICAgIGlmIChtb2R1bGUgJiYgdHlwZW9mIG1vZHVsZSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIG1vZHVsZSA9PT0gImZ1bmN0aW9uIikgewogICAgICBmb3IgKGxldCBrZXkgb2YgX19nZXRPd25Qcm9wTmFtZXMobW9kdWxlKSkKICAgICAgICBpZiAoIV9faGFzT3duUHJvcC5jYWxsKHRhcmdldCwga2V5KSAmJiBrZXkgIT09ICJkZWZhdWx0IikKICAgICAgICAgIF9fZGVmUHJvcCh0YXJnZXQsIGtleSwgeyBnZXQ6ICgpID0+IG1vZHVsZVtrZXldLCBlbnVtZXJhYmxlOiAhKGRlc2MgPSBfX2dldE93blByb3BEZXNjKG1vZHVsZSwga2V5KSkgfHwgZGVzYy5lbnVtZXJhYmxlIH0pOwogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9OwogIHZhciBfX3RvTW9kdWxlID0gKG1vZHVsZSkgPT4gewogICAgcmV0dXJuIF9fcmVFeHBvcnQoX19tYXJrQXNNb2R1bGUoX19kZWZQcm9wKG1vZHVsZSAhPSBudWxsID8gX19jcmVhdGUoX19nZXRQcm90b09mKG1vZHVsZSkpIDoge30sICJkZWZhdWx0IiwgbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlICYmICJkZWZhdWx0IiBpbiBtb2R1bGUgPyB7IGdldDogKCkgPT4gbW9kdWxlLmRlZmF1bHQsIGVudW1lcmFibGU6IHRydWUgfSA6IHsgdmFsdWU6IG1vZHVsZSwgZW51bWVyYWJsZTogdHJ1ZSB9KSksIG1vZHVsZSk7CiAgfTsKICB2YXIgX19hc3luYyA9IChfX3RoaXMsIF9fYXJndW1lbnRzLCBnZW5lcmF0b3IpID0+IHsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIHZhciBmdWxmaWxsZWQgPSAodmFsdWUpID0+IHsKICAgICAgICB0cnkgewogICAgICAgICAgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHZhciByZWplY3RlZCA9ICh2YWx1ZSkgPT4gewogICAgICAgIHRyeSB7CiAgICAgICAgICBzdGVwKGdlbmVyYXRvci50aHJvdyh2YWx1ZSkpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHZhciBzdGVwID0gKHgpID0+IHguZG9uZSA/IHJlc29sdmUoeC52YWx1ZSkgOiBQcm9taXNlLnJlc29sdmUoeC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsKICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KF9fdGhpcywgX19hcmd1bWVudHMpKS5uZXh0KCkpOwogICAgfSk7CiAgfTsKCiAgLy8gbm9kZV9tb2R1bGVzL2Jhc2U2NC1qcy9pbmRleC5qcwogIHZhciByZXF1aXJlX2Jhc2U2NF9qcyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9iYXNlNjQtanMvaW5kZXguanMiKGV4cG9ydHMpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGV4cG9ydHMuYnl0ZUxlbmd0aCA9IGJ5dGVMZW5ndGg7CiAgICAgIGV4cG9ydHMudG9CeXRlQXJyYXkgPSB0b0J5dGVBcnJheTsKICAgICAgZXhwb3J0cy5mcm9tQnl0ZUFycmF5ID0gZnJvbUJ5dGVBcnJheTsKICAgICAgdmFyIGxvb2t1cCA9IFtdOwogICAgICB2YXIgcmV2TG9va3VwID0gW107CiAgICAgIHZhciBBcnIgPSB0eXBlb2YgVWludDhBcnJheSAhPT0gInVuZGVmaW5lZCIgPyBVaW50OEFycmF5IDogQXJyYXk7CiAgICAgIHZhciBjb2RlID0gIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky8iOwogICAgICBmb3IgKGkgPSAwLCBsZW4gPSBjb2RlLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgbG9va3VwW2ldID0gY29kZVtpXTsKICAgICAgICByZXZMb29rdXBbY29kZS5jaGFyQ29kZUF0KGkpXSA9IGk7CiAgICAgIH0KICAgICAgdmFyIGk7CiAgICAgIHZhciBsZW47CiAgICAgIHJldkxvb2t1cFsiLSIuY2hhckNvZGVBdCgwKV0gPSA2MjsKICAgICAgcmV2TG9va3VwWyJfIi5jaGFyQ29kZUF0KDApXSA9IDYzOwogICAgICBmdW5jdGlvbiBnZXRMZW5zKGI2NCkgewogICAgICAgIHZhciBsZW4yID0gYjY0Lmxlbmd0aDsKICAgICAgICBpZiAobGVuMiAlIDQgPiAwKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgc3RyaW5nLiBMZW5ndGggbXVzdCBiZSBhIG11bHRpcGxlIG9mIDQiKTsKICAgICAgICB9CiAgICAgICAgdmFyIHZhbGlkTGVuID0gYjY0LmluZGV4T2YoIj0iKTsKICAgICAgICBpZiAodmFsaWRMZW4gPT09IC0xKQogICAgICAgICAgdmFsaWRMZW4gPSBsZW4yOwogICAgICAgIHZhciBwbGFjZUhvbGRlcnNMZW4gPSB2YWxpZExlbiA9PT0gbGVuMiA/IDAgOiA0IC0gdmFsaWRMZW4gJSA0OwogICAgICAgIHJldHVybiBbdmFsaWRMZW4sIHBsYWNlSG9sZGVyc0xlbl07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYnl0ZUxlbmd0aChiNjQpIHsKICAgICAgICB2YXIgbGVucyA9IGdldExlbnMoYjY0KTsKICAgICAgICB2YXIgdmFsaWRMZW4gPSBsZW5zWzBdOwogICAgICAgIHZhciBwbGFjZUhvbGRlcnNMZW4gPSBsZW5zWzFdOwogICAgICAgIHJldHVybiAodmFsaWRMZW4gKyBwbGFjZUhvbGRlcnNMZW4pICogMyAvIDQgLSBwbGFjZUhvbGRlcnNMZW47CiAgICAgIH0KICAgICAgZnVuY3Rpb24gX2J5dGVMZW5ndGgoYjY0LCB2YWxpZExlbiwgcGxhY2VIb2xkZXJzTGVuKSB7CiAgICAgICAgcmV0dXJuICh2YWxpZExlbiArIHBsYWNlSG9sZGVyc0xlbikgKiAzIC8gNCAtIHBsYWNlSG9sZGVyc0xlbjsKICAgICAgfQogICAgICBmdW5jdGlvbiB0b0J5dGVBcnJheShiNjQpIHsKICAgICAgICB2YXIgdG1wOwogICAgICAgIHZhciBsZW5zID0gZ2V0TGVucyhiNjQpOwogICAgICAgIHZhciB2YWxpZExlbiA9IGxlbnNbMF07CiAgICAgICAgdmFyIHBsYWNlSG9sZGVyc0xlbiA9IGxlbnNbMV07CiAgICAgICAgdmFyIGFyciA9IG5ldyBBcnIoX2J5dGVMZW5ndGgoYjY0LCB2YWxpZExlbiwgcGxhY2VIb2xkZXJzTGVuKSk7CiAgICAgICAgdmFyIGN1ckJ5dGUgPSAwOwogICAgICAgIHZhciBsZW4yID0gcGxhY2VIb2xkZXJzTGVuID4gMCA/IHZhbGlkTGVuIC0gNCA6IHZhbGlkTGVuOwogICAgICAgIHZhciBpMjsKICAgICAgICBmb3IgKGkyID0gMDsgaTIgPCBsZW4yOyBpMiArPSA0KSB7CiAgICAgICAgICB0bXAgPSByZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaTIpXSA8PCAxOCB8IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpMiArIDEpXSA8PCAxMiB8IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpMiArIDIpXSA8PCA2IHwgcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkyICsgMyldOwogICAgICAgICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgPj4gMTYgJiAyNTU7CiAgICAgICAgICBhcnJbY3VyQnl0ZSsrXSA9IHRtcCA+PiA4ICYgMjU1OwogICAgICAgICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgJiAyNTU7CiAgICAgICAgfQogICAgICAgIGlmIChwbGFjZUhvbGRlcnNMZW4gPT09IDIpIHsKICAgICAgICAgIHRtcCA9IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpMildIDw8IDIgfCByZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaTIgKyAxKV0gPj4gNDsKICAgICAgICAgIGFycltjdXJCeXRlKytdID0gdG1wICYgMjU1OwogICAgICAgIH0KICAgICAgICBpZiAocGxhY2VIb2xkZXJzTGVuID09PSAxKSB7CiAgICAgICAgICB0bXAgPSByZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaTIpXSA8PCAxMCB8IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpMiArIDEpXSA8PCA0IHwgcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkyICsgMildID4+IDI7CiAgICAgICAgICBhcnJbY3VyQnl0ZSsrXSA9IHRtcCA+PiA4ICYgMjU1OwogICAgICAgICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgJiAyNTU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhcnI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gdHJpcGxldFRvQmFzZTY0KG51bSkgewogICAgICAgIHJldHVybiBsb29rdXBbbnVtID4+IDE4ICYgNjNdICsgbG9va3VwW251bSA+PiAxMiAmIDYzXSArIGxvb2t1cFtudW0gPj4gNiAmIDYzXSArIGxvb2t1cFtudW0gJiA2M107CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZW5jb2RlQ2h1bmsodWludDgsIHN0YXJ0LCBlbmQpIHsKICAgICAgICB2YXIgdG1wOwogICAgICAgIHZhciBvdXRwdXQgPSBbXTsKICAgICAgICBmb3IgKHZhciBpMiA9IHN0YXJ0OyBpMiA8IGVuZDsgaTIgKz0gMykgewogICAgICAgICAgdG1wID0gKHVpbnQ4W2kyXSA8PCAxNiAmIDE2NzExNjgwKSArICh1aW50OFtpMiArIDFdIDw8IDggJiA2NTI4MCkgKyAodWludDhbaTIgKyAyXSAmIDI1NSk7CiAgICAgICAgICBvdXRwdXQucHVzaCh0cmlwbGV0VG9CYXNlNjQodG1wKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBvdXRwdXQuam9pbigiIik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZnJvbUJ5dGVBcnJheSh1aW50OCkgewogICAgICAgIHZhciB0bXA7CiAgICAgICAgdmFyIGxlbjIgPSB1aW50OC5sZW5ndGg7CiAgICAgICAgdmFyIGV4dHJhQnl0ZXMgPSBsZW4yICUgMzsKICAgICAgICB2YXIgcGFydHMgPSBbXTsKICAgICAgICB2YXIgbWF4Q2h1bmtMZW5ndGggPSAxNjM4MzsKICAgICAgICBmb3IgKHZhciBpMiA9IDAsIGxlbjIyID0gbGVuMiAtIGV4dHJhQnl0ZXM7IGkyIDwgbGVuMjI7IGkyICs9IG1heENodW5rTGVuZ3RoKSB7CiAgICAgICAgICBwYXJ0cy5wdXNoKGVuY29kZUNodW5rKHVpbnQ4LCBpMiwgaTIgKyBtYXhDaHVua0xlbmd0aCA+IGxlbjIyID8gbGVuMjIgOiBpMiArIG1heENodW5rTGVuZ3RoKSk7CiAgICAgICAgfQogICAgICAgIGlmIChleHRyYUJ5dGVzID09PSAxKSB7CiAgICAgICAgICB0bXAgPSB1aW50OFtsZW4yIC0gMV07CiAgICAgICAgICBwYXJ0cy5wdXNoKGxvb2t1cFt0bXAgPj4gMl0gKyBsb29rdXBbdG1wIDw8IDQgJiA2M10gKyAiPT0iKTsKICAgICAgICB9IGVsc2UgaWYgKGV4dHJhQnl0ZXMgPT09IDIpIHsKICAgICAgICAgIHRtcCA9ICh1aW50OFtsZW4yIC0gMl0gPDwgOCkgKyB1aW50OFtsZW4yIC0gMV07CiAgICAgICAgICBwYXJ0cy5wdXNoKGxvb2t1cFt0bXAgPj4gMTBdICsgbG9va3VwW3RtcCA+PiA0ICYgNjNdICsgbG9va3VwW3RtcCA8PCAyICYgNjNdICsgIj0iKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHBhcnRzLmpvaW4oIiIpOwogICAgICB9CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9pZWVlNzU0L2luZGV4LmpzCiAgdmFyIHJlcXVpcmVfaWVlZTc1NCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9pZWVlNzU0L2luZGV4LmpzIihleHBvcnRzKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgZXhwb3J0cy5yZWFkID0gZnVuY3Rpb24oYnVmZmVyLCBvZmZzZXQsIGlzTEUsIG1MZW4sIG5CeXRlcykgewogICAgICAgIHZhciBlLCBtOwogICAgICAgIHZhciBlTGVuID0gbkJ5dGVzICogOCAtIG1MZW4gLSAxOwogICAgICAgIHZhciBlTWF4ID0gKDEgPDwgZUxlbikgLSAxOwogICAgICAgIHZhciBlQmlhcyA9IGVNYXggPj4gMTsKICAgICAgICB2YXIgbkJpdHMgPSAtNzsKICAgICAgICB2YXIgaSA9IGlzTEUgPyBuQnl0ZXMgLSAxIDogMDsKICAgICAgICB2YXIgZCA9IGlzTEUgPyAtMSA6IDE7CiAgICAgICAgdmFyIHMgPSBidWZmZXJbb2Zmc2V0ICsgaV07CiAgICAgICAgaSArPSBkOwogICAgICAgIGUgPSBzICYgKDEgPDwgLW5CaXRzKSAtIDE7CiAgICAgICAgcyA+Pj0gLW5CaXRzOwogICAgICAgIG5CaXRzICs9IGVMZW47CiAgICAgICAgZm9yICg7IG5CaXRzID4gMDsgZSA9IGUgKiAyNTYgKyBidWZmZXJbb2Zmc2V0ICsgaV0sIGkgKz0gZCwgbkJpdHMgLT0gOCkgewogICAgICAgIH0KICAgICAgICBtID0gZSAmICgxIDw8IC1uQml0cykgLSAxOwogICAgICAgIGUgPj49IC1uQml0czsKICAgICAgICBuQml0cyArPSBtTGVuOwogICAgICAgIGZvciAoOyBuQml0cyA+IDA7IG0gPSBtICogMjU2ICsgYnVmZmVyW29mZnNldCArIGldLCBpICs9IGQsIG5CaXRzIC09IDgpIHsKICAgICAgICB9CiAgICAgICAgaWYgKGUgPT09IDApIHsKICAgICAgICAgIGUgPSAxIC0gZUJpYXM7CiAgICAgICAgfSBlbHNlIGlmIChlID09PSBlTWF4KSB7CiAgICAgICAgICByZXR1cm4gbSA/IE5hTiA6IChzID8gLTEgOiAxKSAqIEluZmluaXR5OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtID0gbSArIE1hdGgucG93KDIsIG1MZW4pOwogICAgICAgICAgZSA9IGUgLSBlQmlhczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChzID8gLTEgOiAxKSAqIG0gKiBNYXRoLnBvdygyLCBlIC0gbUxlbik7CiAgICAgIH07CiAgICAgIGV4cG9ydHMud3JpdGUgPSBmdW5jdGlvbihidWZmZXIsIHZhbHVlLCBvZmZzZXQsIGlzTEUsIG1MZW4sIG5CeXRlcykgewogICAgICAgIHZhciBlLCBtLCBjOwogICAgICAgIHZhciBlTGVuID0gbkJ5dGVzICogOCAtIG1MZW4gLSAxOwogICAgICAgIHZhciBlTWF4ID0gKDEgPDwgZUxlbikgLSAxOwogICAgICAgIHZhciBlQmlhcyA9IGVNYXggPj4gMTsKICAgICAgICB2YXIgcnQgPSBtTGVuID09PSAyMyA/IE1hdGgucG93KDIsIC0yNCkgLSBNYXRoLnBvdygyLCAtNzcpIDogMDsKICAgICAgICB2YXIgaSA9IGlzTEUgPyAwIDogbkJ5dGVzIC0gMTsKICAgICAgICB2YXIgZCA9IGlzTEUgPyAxIDogLTE7CiAgICAgICAgdmFyIHMgPSB2YWx1ZSA8IDAgfHwgdmFsdWUgPT09IDAgJiYgMSAvIHZhbHVlIDwgMCA/IDEgOiAwOwogICAgICAgIHZhbHVlID0gTWF0aC5hYnModmFsdWUpOwogICAgICAgIGlmIChpc05hTih2YWx1ZSkgfHwgdmFsdWUgPT09IEluZmluaXR5KSB7CiAgICAgICAgICBtID0gaXNOYU4odmFsdWUpID8gMSA6IDA7CiAgICAgICAgICBlID0gZU1heDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZSA9IE1hdGguZmxvb3IoTWF0aC5sb2codmFsdWUpIC8gTWF0aC5MTjIpOwogICAgICAgICAgaWYgKHZhbHVlICogKGMgPSBNYXRoLnBvdygyLCAtZSkpIDwgMSkgewogICAgICAgICAgICBlLS07CiAgICAgICAgICAgIGMgKj0gMjsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChlICsgZUJpYXMgPj0gMSkgewogICAgICAgICAgICB2YWx1ZSArPSBydCAvIGM7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YWx1ZSArPSBydCAqIE1hdGgucG93KDIsIDEgLSBlQmlhcyk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodmFsdWUgKiBjID49IDIpIHsKICAgICAgICAgICAgZSsrOwogICAgICAgICAgICBjIC89IDI7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZSArIGVCaWFzID49IGVNYXgpIHsKICAgICAgICAgICAgbSA9IDA7CiAgICAgICAgICAgIGUgPSBlTWF4OwogICAgICAgICAgfSBlbHNlIGlmIChlICsgZUJpYXMgPj0gMSkgewogICAgICAgICAgICBtID0gKHZhbHVlICogYyAtIDEpICogTWF0aC5wb3coMiwgbUxlbik7CiAgICAgICAgICAgIGUgPSBlICsgZUJpYXM7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtID0gdmFsdWUgKiBNYXRoLnBvdygyLCBlQmlhcyAtIDEpICogTWF0aC5wb3coMiwgbUxlbik7CiAgICAgICAgICAgIGUgPSAwOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmb3IgKDsgbUxlbiA+PSA4OyBidWZmZXJbb2Zmc2V0ICsgaV0gPSBtICYgMjU1LCBpICs9IGQsIG0gLz0gMjU2LCBtTGVuIC09IDgpIHsKICAgICAgICB9CiAgICAgICAgZSA9IGUgPDwgbUxlbiB8IG07CiAgICAgICAgZUxlbiArPSBtTGVuOwogICAgICAgIGZvciAoOyBlTGVuID4gMDsgYnVmZmVyW29mZnNldCArIGldID0gZSAmIDI1NSwgaSArPSBkLCBlIC89IDI1NiwgZUxlbiAtPSA4KSB7CiAgICAgICAgfQogICAgICAgIGJ1ZmZlcltvZmZzZXQgKyBpIC0gZF0gfD0gcyAqIDEyODsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2J1ZmZlci9pbmRleC5qcwogIHZhciByZXF1aXJlX2J1ZmZlciA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9idWZmZXIvaW5kZXguanMiKGV4cG9ydHMpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBiYXNlNjQgPSByZXF1aXJlX2Jhc2U2NF9qcygpOwogICAgICB2YXIgaWVlZTc1NCA9IHJlcXVpcmVfaWVlZTc1NCgpOwogICAgICB2YXIgY3VzdG9tSW5zcGVjdFN5bWJvbCA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbFsiZm9yIl0gPT09ICJmdW5jdGlvbiIgPyBTeW1ib2xbImZvciJdKCJub2RlanMudXRpbC5pbnNwZWN0LmN1c3RvbSIpIDogbnVsbDsKICAgICAgZXhwb3J0cy5CdWZmZXIgPSBCdWZmZXIzOwogICAgICBleHBvcnRzLlNsb3dCdWZmZXIgPSBTbG93QnVmZmVyOwogICAgICBleHBvcnRzLklOU1BFQ1RfTUFYX0JZVEVTID0gNTA7CiAgICAgIHZhciBLX01BWF9MRU5HVEggPSAyMTQ3NDgzNjQ3OwogICAgICBleHBvcnRzLmtNYXhMZW5ndGggPSBLX01BWF9MRU5HVEg7CiAgICAgIEJ1ZmZlcjMuVFlQRURfQVJSQVlfU1VQUE9SVCA9IHR5cGVkQXJyYXlTdXBwb3J0KCk7CiAgICAgIGlmICghQnVmZmVyMy5UWVBFRF9BUlJBWV9TVVBQT1JUICYmIHR5cGVvZiBjb25zb2xlICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YgY29uc29sZS5lcnJvciA9PT0gImZ1bmN0aW9uIikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIlRoaXMgYnJvd3NlciBsYWNrcyB0eXBlZCBhcnJheSAoVWludDhBcnJheSkgc3VwcG9ydCB3aGljaCBpcyByZXF1aXJlZCBieSBgYnVmZmVyYCB2NS54LiBVc2UgYGJ1ZmZlcmAgdjQueCBpZiB5b3UgcmVxdWlyZSBvbGQgYnJvd3NlciBzdXBwb3J0LiIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHR5cGVkQXJyYXlTdXBwb3J0KCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBjb25zdCBhcnIgPSBuZXcgVWludDhBcnJheSgxKTsKICAgICAgICAgIGNvbnN0IHByb3RvMiA9IHsgZm9vOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIDQyOwogICAgICAgICAgfSB9OwogICAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKHByb3RvMiwgVWludDhBcnJheS5wcm90b3R5cGUpOwogICAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKGFyciwgcHJvdG8yKTsKICAgICAgICAgIHJldHVybiBhcnIuZm9vKCkgPT09IDQyOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEJ1ZmZlcjMucHJvdG90eXBlLCAicGFyZW50IiwgewogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmICghQnVmZmVyMy5pc0J1ZmZlcih0aGlzKSkKICAgICAgICAgICAgcmV0dXJuIHZvaWQgMDsKICAgICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlcjsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQnVmZmVyMy5wcm90b3R5cGUsICJvZmZzZXQiLCB7CiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKCFCdWZmZXIzLmlzQnVmZmVyKHRoaXMpKQogICAgICAgICAgICByZXR1cm4gdm9pZCAwOwogICAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZU9mZnNldDsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBmdW5jdGlvbiBjcmVhdGVCdWZmZXIobGVuZ3RoKSB7CiAgICAgICAgaWYgKGxlbmd0aCA+IEtfTUFYX0xFTkdUSCkgewogICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ1RoZSB2YWx1ZSAiJyArIGxlbmd0aCArICciIGlzIGludmFsaWQgZm9yIG9wdGlvbiAic2l6ZSInKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYnVmID0gbmV3IFVpbnQ4QXJyYXkobGVuZ3RoKTsKICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YoYnVmLCBCdWZmZXIzLnByb3RvdHlwZSk7CiAgICAgICAgcmV0dXJuIGJ1ZjsKICAgICAgfQogICAgICBmdW5jdGlvbiBCdWZmZXIzKGFyZywgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKSB7CiAgICAgICAgaWYgKHR5cGVvZiBhcmcgPT09ICJudW1iZXIiKSB7CiAgICAgICAgICBpZiAodHlwZW9mIGVuY29kaW5nT3JPZmZzZXQgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RoZSAic3RyaW5nIiBhcmd1bWVudCBtdXN0IGJlIG9mIHR5cGUgc3RyaW5nLiBSZWNlaXZlZCB0eXBlIG51bWJlcicpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGFsbG9jVW5zYWZlKGFyZyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmcm9tKGFyZywgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKTsKICAgICAgfQogICAgICBCdWZmZXIzLnBvb2xTaXplID0gODE5MjsKICAgICAgZnVuY3Rpb24gZnJvbSh2YWx1ZSwgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKSB7CiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgIHJldHVybiBmcm9tU3RyaW5nKHZhbHVlLCBlbmNvZGluZ09yT2Zmc2V0KTsKICAgICAgICB9CiAgICAgICAgaWYgKEFycmF5QnVmZmVyLmlzVmlldyh2YWx1ZSkpIHsKICAgICAgICAgIHJldHVybiBmcm9tQXJyYXlWaWV3KHZhbHVlKTsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlRoZSBmaXJzdCBhcmd1bWVudCBtdXN0IGJlIG9uZSBvZiB0eXBlIHN0cmluZywgQnVmZmVyLCBBcnJheUJ1ZmZlciwgQXJyYXksIG9yIEFycmF5LWxpa2UgT2JqZWN0LiBSZWNlaXZlZCB0eXBlICIgKyB0eXBlb2YgdmFsdWUpOwogICAgICAgIH0KICAgICAgICBpZiAoaXNJbnN0YW5jZSh2YWx1ZSwgQXJyYXlCdWZmZXIpIHx8IHZhbHVlICYmIGlzSW5zdGFuY2UodmFsdWUuYnVmZmVyLCBBcnJheUJ1ZmZlcikpIHsKICAgICAgICAgIHJldHVybiBmcm9tQXJyYXlCdWZmZXIodmFsdWUsIGVuY29kaW5nT3JPZmZzZXQsIGxlbmd0aCk7CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlb2YgU2hhcmVkQXJyYXlCdWZmZXIgIT09ICJ1bmRlZmluZWQiICYmIChpc0luc3RhbmNlKHZhbHVlLCBTaGFyZWRBcnJheUJ1ZmZlcikgfHwgdmFsdWUgJiYgaXNJbnN0YW5jZSh2YWx1ZS5idWZmZXIsIFNoYXJlZEFycmF5QnVmZmVyKSkpIHsKICAgICAgICAgIHJldHVybiBmcm9tQXJyYXlCdWZmZXIodmFsdWUsIGVuY29kaW5nT3JPZmZzZXQsIGxlbmd0aCk7CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJudW1iZXIiKSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGUgInZhbHVlIiBhcmd1bWVudCBtdXN0IG5vdCBiZSBvZiB0eXBlIG51bWJlci4gUmVjZWl2ZWQgdHlwZSBudW1iZXInKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgdmFsdWVPZiA9IHZhbHVlLnZhbHVlT2YgJiYgdmFsdWUudmFsdWVPZigpOwogICAgICAgIGlmICh2YWx1ZU9mICE9IG51bGwgJiYgdmFsdWVPZiAhPT0gdmFsdWUpIHsKICAgICAgICAgIHJldHVybiBCdWZmZXIzLmZyb20odmFsdWVPZiwgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYiA9IGZyb21PYmplY3QodmFsdWUpOwogICAgICAgIGlmIChiKQogICAgICAgICAgcmV0dXJuIGI7CiAgICAgICAgaWYgKHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIFN5bWJvbC50b1ByaW1pdGl2ZSAhPSBudWxsICYmIHR5cGVvZiB2YWx1ZVtTeW1ib2wudG9QcmltaXRpdmVdID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICByZXR1cm4gQnVmZmVyMy5mcm9tKHZhbHVlW1N5bWJvbC50b1ByaW1pdGl2ZV0oInN0cmluZyIpLCBlbmNvZGluZ09yT2Zmc2V0LCBsZW5ndGgpOwogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJUaGUgZmlyc3QgYXJndW1lbnQgbXVzdCBiZSBvbmUgb2YgdHlwZSBzdHJpbmcsIEJ1ZmZlciwgQXJyYXlCdWZmZXIsIEFycmF5LCBvciBBcnJheS1saWtlIE9iamVjdC4gUmVjZWl2ZWQgdHlwZSAiICsgdHlwZW9mIHZhbHVlKTsKICAgICAgfQogICAgICBCdWZmZXIzLmZyb20gPSBmdW5jdGlvbih2YWx1ZSwgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIGZyb20odmFsdWUsIGVuY29kaW5nT3JPZmZzZXQsIGxlbmd0aCk7CiAgICAgIH07CiAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZihCdWZmZXIzLnByb3RvdHlwZSwgVWludDhBcnJheS5wcm90b3R5cGUpOwogICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YoQnVmZmVyMywgVWludDhBcnJheSk7CiAgICAgIGZ1bmN0aW9uIGFzc2VydFNpemUoc2l6ZSkgewogICAgICAgIGlmICh0eXBlb2Ygc2l6ZSAhPT0gIm51bWJlciIpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJyJzaXplIiBhcmd1bWVudCBtdXN0IGJlIG9mIHR5cGUgbnVtYmVyJyk7CiAgICAgICAgfSBlbHNlIGlmIChzaXplIDwgMCkgewogICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ1RoZSB2YWx1ZSAiJyArIHNpemUgKyAnIiBpcyBpbnZhbGlkIGZvciBvcHRpb24gInNpemUiJyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGFsbG9jKHNpemUsIGZpbGwsIGVuY29kaW5nKSB7CiAgICAgICAgYXNzZXJ0U2l6ZShzaXplKTsKICAgICAgICBpZiAoc2l6ZSA8PSAwKSB7CiAgICAgICAgICByZXR1cm4gY3JlYXRlQnVmZmVyKHNpemUpOwogICAgICAgIH0KICAgICAgICBpZiAoZmlsbCAhPT0gdm9pZCAwKSB7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIGVuY29kaW5nID09PSAic3RyaW5nIiA/IGNyZWF0ZUJ1ZmZlcihzaXplKS5maWxsKGZpbGwsIGVuY29kaW5nKSA6IGNyZWF0ZUJ1ZmZlcihzaXplKS5maWxsKGZpbGwpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY3JlYXRlQnVmZmVyKHNpemUpOwogICAgICB9CiAgICAgIEJ1ZmZlcjMuYWxsb2MgPSBmdW5jdGlvbihzaXplLCBmaWxsLCBlbmNvZGluZykgewogICAgICAgIHJldHVybiBhbGxvYyhzaXplLCBmaWxsLCBlbmNvZGluZyk7CiAgICAgIH07CiAgICAgIGZ1bmN0aW9uIGFsbG9jVW5zYWZlKHNpemUpIHsKICAgICAgICBhc3NlcnRTaXplKHNpemUpOwogICAgICAgIHJldHVybiBjcmVhdGVCdWZmZXIoc2l6ZSA8IDAgPyAwIDogY2hlY2tlZChzaXplKSB8IDApOwogICAgICB9CiAgICAgIEJ1ZmZlcjMuYWxsb2NVbnNhZmUgPSBmdW5jdGlvbihzaXplKSB7CiAgICAgICAgcmV0dXJuIGFsbG9jVW5zYWZlKHNpemUpOwogICAgICB9OwogICAgICBCdWZmZXIzLmFsbG9jVW5zYWZlU2xvdyA9IGZ1bmN0aW9uKHNpemUpIHsKICAgICAgICByZXR1cm4gYWxsb2NVbnNhZmUoc2l6ZSk7CiAgICAgIH07CiAgICAgIGZ1bmN0aW9uIGZyb21TdHJpbmcoc3RyaW5nLCBlbmNvZGluZykgewogICAgICAgIGlmICh0eXBlb2YgZW5jb2RpbmcgIT09ICJzdHJpbmciIHx8IGVuY29kaW5nID09PSAiIikgewogICAgICAgICAgZW5jb2RpbmcgPSAidXRmOCI7CiAgICAgICAgfQogICAgICAgIGlmICghQnVmZmVyMy5pc0VuY29kaW5nKGVuY29kaW5nKSkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiVW5rbm93biBlbmNvZGluZzogIiArIGVuY29kaW5nKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgbGVuZ3RoID0gYnl0ZUxlbmd0aChzdHJpbmcsIGVuY29kaW5nKSB8IDA7CiAgICAgICAgbGV0IGJ1ZiA9IGNyZWF0ZUJ1ZmZlcihsZW5ndGgpOwogICAgICAgIGNvbnN0IGFjdHVhbCA9IGJ1Zi53cml0ZShzdHJpbmcsIGVuY29kaW5nKTsKICAgICAgICBpZiAoYWN0dWFsICE9PSBsZW5ndGgpIHsKICAgICAgICAgIGJ1ZiA9IGJ1Zi5zbGljZSgwLCBhY3R1YWwpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYnVmOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGZyb21BcnJheUxpa2UoYXJyYXkpIHsKICAgICAgICBjb25zdCBsZW5ndGggPSBhcnJheS5sZW5ndGggPCAwID8gMCA6IGNoZWNrZWQoYXJyYXkubGVuZ3RoKSB8IDA7CiAgICAgICAgY29uc3QgYnVmID0gY3JlYXRlQnVmZmVyKGxlbmd0aCk7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgYnVmW2ldID0gYXJyYXlbaV0gJiAyNTU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBidWY7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZnJvbUFycmF5VmlldyhhcnJheVZpZXcpIHsKICAgICAgICBpZiAoaXNJbnN0YW5jZShhcnJheVZpZXcsIFVpbnQ4QXJyYXkpKSB7CiAgICAgICAgICBjb25zdCBjb3B5ID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlWaWV3KTsKICAgICAgICAgIHJldHVybiBmcm9tQXJyYXlCdWZmZXIoY29weS5idWZmZXIsIGNvcHkuYnl0ZU9mZnNldCwgY29weS5ieXRlTGVuZ3RoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZyb21BcnJheUxpa2UoYXJyYXlWaWV3KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBmcm9tQXJyYXlCdWZmZXIoYXJyYXksIGJ5dGVPZmZzZXQsIGxlbmd0aCkgewogICAgICAgIGlmIChieXRlT2Zmc2V0IDwgMCB8fCBhcnJheS5ieXRlTGVuZ3RoIDwgYnl0ZU9mZnNldCkgewogICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJyJvZmZzZXQiIGlzIG91dHNpZGUgb2YgYnVmZmVyIGJvdW5kcycpOwogICAgICAgIH0KICAgICAgICBpZiAoYXJyYXkuYnl0ZUxlbmd0aCA8IGJ5dGVPZmZzZXQgKyAobGVuZ3RoIHx8IDApKSB7CiAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignImxlbmd0aCIgaXMgb3V0c2lkZSBvZiBidWZmZXIgYm91bmRzJyk7CiAgICAgICAgfQogICAgICAgIGxldCBidWY7CiAgICAgICAgaWYgKGJ5dGVPZmZzZXQgPT09IHZvaWQgMCAmJiBsZW5ndGggPT09IHZvaWQgMCkgewogICAgICAgICAgYnVmID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXkpOwogICAgICAgIH0gZWxzZSBpZiAobGVuZ3RoID09PSB2b2lkIDApIHsKICAgICAgICAgIGJ1ZiA9IG5ldyBVaW50OEFycmF5KGFycmF5LCBieXRlT2Zmc2V0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYnVmID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXksIGJ5dGVPZmZzZXQsIGxlbmd0aCk7CiAgICAgICAgfQogICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZihidWYsIEJ1ZmZlcjMucHJvdG90eXBlKTsKICAgICAgICByZXR1cm4gYnVmOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGZyb21PYmplY3Qob2JqKSB7CiAgICAgICAgaWYgKEJ1ZmZlcjMuaXNCdWZmZXIob2JqKSkgewogICAgICAgICAgY29uc3QgbGVuID0gY2hlY2tlZChvYmoubGVuZ3RoKSB8IDA7CiAgICAgICAgICBjb25zdCBidWYgPSBjcmVhdGVCdWZmZXIobGVuKTsKICAgICAgICAgIGlmIChidWYubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBidWY7CiAgICAgICAgICB9CiAgICAgICAgICBvYmouY29weShidWYsIDAsIDAsIGxlbik7CiAgICAgICAgICByZXR1cm4gYnVmOwogICAgICAgIH0KICAgICAgICBpZiAob2JqLmxlbmd0aCAhPT0gdm9pZCAwKSB7CiAgICAgICAgICBpZiAodHlwZW9mIG9iai5sZW5ndGggIT09ICJudW1iZXIiIHx8IG51bWJlcklzTmFOKG9iai5sZW5ndGgpKSB7CiAgICAgICAgICAgIHJldHVybiBjcmVhdGVCdWZmZXIoMCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZnJvbUFycmF5TGlrZShvYmopOwogICAgICAgIH0KICAgICAgICBpZiAob2JqLnR5cGUgPT09ICJCdWZmZXIiICYmIEFycmF5LmlzQXJyYXkob2JqLmRhdGEpKSB7CiAgICAgICAgICByZXR1cm4gZnJvbUFycmF5TGlrZShvYmouZGF0YSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGNoZWNrZWQobGVuZ3RoKSB7CiAgICAgICAgaWYgKGxlbmd0aCA+PSBLX01BWF9MRU5HVEgpIHsKICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJBdHRlbXB0IHRvIGFsbG9jYXRlIEJ1ZmZlciBsYXJnZXIgdGhhbiBtYXhpbXVtIHNpemU6IDB4IiArIEtfTUFYX0xFTkdUSC50b1N0cmluZygxNikgKyAiIGJ5dGVzIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBsZW5ndGggfCAwOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFNsb3dCdWZmZXIobGVuZ3RoKSB7CiAgICAgICAgaWYgKCtsZW5ndGggIT0gbGVuZ3RoKSB7CiAgICAgICAgICBsZW5ndGggPSAwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gQnVmZmVyMy5hbGxvYygrbGVuZ3RoKTsKICAgICAgfQogICAgICBCdWZmZXIzLmlzQnVmZmVyID0gZnVuY3Rpb24gaXNCdWZmZXIoYikgewogICAgICAgIHJldHVybiBiICE9IG51bGwgJiYgYi5faXNCdWZmZXIgPT09IHRydWUgJiYgYiAhPT0gQnVmZmVyMy5wcm90b3R5cGU7CiAgICAgIH07CiAgICAgIEJ1ZmZlcjMuY29tcGFyZSA9IGZ1bmN0aW9uIGNvbXBhcmUoYSwgYikgewogICAgICAgIGlmIChpc0luc3RhbmNlKGEsIFVpbnQ4QXJyYXkpKQogICAgICAgICAgYSA9IEJ1ZmZlcjMuZnJvbShhLCBhLm9mZnNldCwgYS5ieXRlTGVuZ3RoKTsKICAgICAgICBpZiAoaXNJbnN0YW5jZShiLCBVaW50OEFycmF5KSkKICAgICAgICAgIGIgPSBCdWZmZXIzLmZyb20oYiwgYi5vZmZzZXQsIGIuYnl0ZUxlbmd0aCk7CiAgICAgICAgaWYgKCFCdWZmZXIzLmlzQnVmZmVyKGEpIHx8ICFCdWZmZXIzLmlzQnVmZmVyKGIpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGUgImJ1ZjEiLCAiYnVmMiIgYXJndW1lbnRzIG11c3QgYmUgb25lIG9mIHR5cGUgQnVmZmVyIG9yIFVpbnQ4QXJyYXknKTsKICAgICAgICB9CiAgICAgICAgaWYgKGEgPT09IGIpCiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBsZXQgeCA9IGEubGVuZ3RoOwogICAgICAgIGxldCB5ID0gYi5sZW5ndGg7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IE1hdGgubWluKHgsIHkpOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgIGlmIChhW2ldICE9PSBiW2ldKSB7CiAgICAgICAgICAgIHggPSBhW2ldOwogICAgICAgICAgICB5ID0gYltpXTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh4IDwgeSkKICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICBpZiAoeSA8IHgpCiAgICAgICAgICByZXR1cm4gMTsKICAgICAgICByZXR1cm4gMDsKICAgICAgfTsKICAgICAgQnVmZmVyMy5pc0VuY29kaW5nID0gZnVuY3Rpb24gaXNFbmNvZGluZyhlbmNvZGluZykgewogICAgICAgIHN3aXRjaCAoU3RyaW5nKGVuY29kaW5nKS50b0xvd2VyQ2FzZSgpKSB7CiAgICAgICAgICBjYXNlICJoZXgiOgogICAgICAgICAgY2FzZSAidXRmOCI6CiAgICAgICAgICBjYXNlICJ1dGYtOCI6CiAgICAgICAgICBjYXNlICJhc2NpaSI6CiAgICAgICAgICBjYXNlICJsYXRpbjEiOgogICAgICAgICAgY2FzZSAiYmluYXJ5IjoKICAgICAgICAgIGNhc2UgImJhc2U2NCI6CiAgICAgICAgICBjYXNlICJ1Y3MyIjoKICAgICAgICAgIGNhc2UgInVjcy0yIjoKICAgICAgICAgIGNhc2UgInV0ZjE2bGUiOgogICAgICAgICAgY2FzZSAidXRmLTE2bGUiOgogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIEJ1ZmZlcjMuY29uY2F0ID0gZnVuY3Rpb24gY29uY2F0KGxpc3QsIGxlbmd0aCkgewogICAgICAgIGlmICghQXJyYXkuaXNBcnJheShsaXN0KSkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignImxpc3QiIGFyZ3VtZW50IG11c3QgYmUgYW4gQXJyYXkgb2YgQnVmZmVycycpOwogICAgICAgIH0KICAgICAgICBpZiAobGlzdC5sZW5ndGggPT09IDApIHsKICAgICAgICAgIHJldHVybiBCdWZmZXIzLmFsbG9jKDApOwogICAgICAgIH0KICAgICAgICBsZXQgaTsKICAgICAgICBpZiAobGVuZ3RoID09PSB2b2lkIDApIHsKICAgICAgICAgIGxlbmd0aCA9IDA7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7ICsraSkgewogICAgICAgICAgICBsZW5ndGggKz0gbGlzdFtpXS5sZW5ndGg7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IGJ1ZmZlciA9IEJ1ZmZlcjMuYWxsb2NVbnNhZmUobGVuZ3RoKTsKICAgICAgICBsZXQgcG9zID0gMDsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7ICsraSkgewogICAgICAgICAgbGV0IGJ1ZiA9IGxpc3RbaV07CiAgICAgICAgICBpZiAoaXNJbnN0YW5jZShidWYsIFVpbnQ4QXJyYXkpKSB7CiAgICAgICAgICAgIGlmIChwb3MgKyBidWYubGVuZ3RoID4gYnVmZmVyLmxlbmd0aCkgewogICAgICAgICAgICAgIGlmICghQnVmZmVyMy5pc0J1ZmZlcihidWYpKQogICAgICAgICAgICAgICAgYnVmID0gQnVmZmVyMy5mcm9tKGJ1Zik7CiAgICAgICAgICAgICAgYnVmLmNvcHkoYnVmZmVyLCBwb3MpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIFVpbnQ4QXJyYXkucHJvdG90eXBlLnNldC5jYWxsKGJ1ZmZlciwgYnVmLCBwb3MpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKCFCdWZmZXIzLmlzQnVmZmVyKGJ1ZikpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignImxpc3QiIGFyZ3VtZW50IG11c3QgYmUgYW4gQXJyYXkgb2YgQnVmZmVycycpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYnVmLmNvcHkoYnVmZmVyLCBwb3MpOwogICAgICAgICAgfQogICAgICAgICAgcG9zICs9IGJ1Zi5sZW5ndGg7CiAgICAgICAgfQogICAgICAgIHJldHVybiBidWZmZXI7CiAgICAgIH07CiAgICAgIGZ1bmN0aW9uIGJ5dGVMZW5ndGgoc3RyaW5nLCBlbmNvZGluZykgewogICAgICAgIGlmIChCdWZmZXIzLmlzQnVmZmVyKHN0cmluZykpIHsKICAgICAgICAgIHJldHVybiBzdHJpbmcubGVuZ3RoOwogICAgICAgIH0KICAgICAgICBpZiAoQXJyYXlCdWZmZXIuaXNWaWV3KHN0cmluZykgfHwgaXNJbnN0YW5jZShzdHJpbmcsIEFycmF5QnVmZmVyKSkgewogICAgICAgICAgcmV0dXJuIHN0cmluZy5ieXRlTGVuZ3RoOwogICAgICAgIH0KICAgICAgICBpZiAodHlwZW9mIHN0cmluZyAhPT0gInN0cmluZyIpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RoZSAic3RyaW5nIiBhcmd1bWVudCBtdXN0IGJlIG9uZSBvZiB0eXBlIHN0cmluZywgQnVmZmVyLCBvciBBcnJheUJ1ZmZlci4gUmVjZWl2ZWQgdHlwZSAnICsgdHlwZW9mIHN0cmluZyk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGxlbiA9IHN0cmluZy5sZW5ndGg7CiAgICAgICAgY29uc3QgbXVzdE1hdGNoID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdID09PSB0cnVlOwogICAgICAgIGlmICghbXVzdE1hdGNoICYmIGxlbiA9PT0gMCkKICAgICAgICAgIHJldHVybiAwOwogICAgICAgIGxldCBsb3dlcmVkQ2FzZSA9IGZhbHNlOwogICAgICAgIGZvciAoOyA7ICkgewogICAgICAgICAgc3dpdGNoIChlbmNvZGluZykgewogICAgICAgICAgICBjYXNlICJhc2NpaSI6CiAgICAgICAgICAgIGNhc2UgImxhdGluMSI6CiAgICAgICAgICAgIGNhc2UgImJpbmFyeSI6CiAgICAgICAgICAgICAgcmV0dXJuIGxlbjsKICAgICAgICAgICAgY2FzZSAidXRmOCI6CiAgICAgICAgICAgIGNhc2UgInV0Zi04IjoKICAgICAgICAgICAgICByZXR1cm4gdXRmOFRvQnl0ZXMoc3RyaW5nKS5sZW5ndGg7CiAgICAgICAgICAgIGNhc2UgInVjczIiOgogICAgICAgICAgICBjYXNlICJ1Y3MtMiI6CiAgICAgICAgICAgIGNhc2UgInV0ZjE2bGUiOgogICAgICAgICAgICBjYXNlICJ1dGYtMTZsZSI6CiAgICAgICAgICAgICAgcmV0dXJuIGxlbiAqIDI7CiAgICAgICAgICAgIGNhc2UgImhleCI6CiAgICAgICAgICAgICAgcmV0dXJuIGxlbiA+Pj4gMTsKICAgICAgICAgICAgY2FzZSAiYmFzZTY0IjoKICAgICAgICAgICAgICByZXR1cm4gYmFzZTY0VG9CeXRlcyhzdHJpbmcpLmxlbmd0aDsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBpZiAobG93ZXJlZENhc2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtdXN0TWF0Y2ggPyAtMSA6IHV0ZjhUb0J5dGVzKHN0cmluZykubGVuZ3RoOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbmNvZGluZyA9ICgiIiArIGVuY29kaW5nKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgIGxvd2VyZWRDYXNlID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgQnVmZmVyMy5ieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aDsKICAgICAgZnVuY3Rpb24gc2xvd1RvU3RyaW5nKGVuY29kaW5nLCBzdGFydCwgZW5kKSB7CiAgICAgICAgbGV0IGxvd2VyZWRDYXNlID0gZmFsc2U7CiAgICAgICAgaWYgKHN0YXJ0ID09PSB2b2lkIDAgfHwgc3RhcnQgPCAwKSB7CiAgICAgICAgICBzdGFydCA9IDA7CiAgICAgICAgfQogICAgICAgIGlmIChzdGFydCA+IHRoaXMubGVuZ3RoKSB7CiAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgfQogICAgICAgIGlmIChlbmQgPT09IHZvaWQgMCB8fCBlbmQgPiB0aGlzLmxlbmd0aCkgewogICAgICAgICAgZW5kID0gdGhpcy5sZW5ndGg7CiAgICAgICAgfQogICAgICAgIGlmIChlbmQgPD0gMCkgewogICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIH0KICAgICAgICBlbmQgPj4+PSAwOwogICAgICAgIHN0YXJ0ID4+Pj0gMDsKICAgICAgICBpZiAoZW5kIDw9IHN0YXJ0KSB7CiAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgfQogICAgICAgIGlmICghZW5jb2RpbmcpCiAgICAgICAgICBlbmNvZGluZyA9ICJ1dGY4IjsKICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgc3dpdGNoIChlbmNvZGluZykgewogICAgICAgICAgICBjYXNlICJoZXgiOgogICAgICAgICAgICAgIHJldHVybiBoZXhTbGljZSh0aGlzLCBzdGFydCwgZW5kKTsKICAgICAgICAgICAgY2FzZSAidXRmOCI6CiAgICAgICAgICAgIGNhc2UgInV0Zi04IjoKICAgICAgICAgICAgICByZXR1cm4gdXRmOFNsaWNlKHRoaXMsIHN0YXJ0LCBlbmQpOwogICAgICAgICAgICBjYXNlICJhc2NpaSI6CiAgICAgICAgICAgICAgcmV0dXJuIGFzY2lpU2xpY2UodGhpcywgc3RhcnQsIGVuZCk7CiAgICAgICAgICAgIGNhc2UgImxhdGluMSI6CiAgICAgICAgICAgIGNhc2UgImJpbmFyeSI6CiAgICAgICAgICAgICAgcmV0dXJuIGxhdGluMVNsaWNlKHRoaXMsIHN0YXJ0LCBlbmQpOwogICAgICAgICAgICBjYXNlICJiYXNlNjQiOgogICAgICAgICAgICAgIHJldHVybiBiYXNlNjRTbGljZSh0aGlzLCBzdGFydCwgZW5kKTsKICAgICAgICAgICAgY2FzZSAidWNzMiI6CiAgICAgICAgICAgIGNhc2UgInVjcy0yIjoKICAgICAgICAgICAgY2FzZSAidXRmMTZsZSI6CiAgICAgICAgICAgIGNhc2UgInV0Zi0xNmxlIjoKICAgICAgICAgICAgICByZXR1cm4gdXRmMTZsZVNsaWNlKHRoaXMsIHN0YXJ0LCBlbmQpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIGlmIChsb3dlcmVkQ2FzZSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gZW5jb2Rpbmc6ICIgKyBlbmNvZGluZyk7CiAgICAgICAgICAgICAgZW5jb2RpbmcgPSAoZW5jb2RpbmcgKyAiIikudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICBsb3dlcmVkQ2FzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIEJ1ZmZlcjMucHJvdG90eXBlLl9pc0J1ZmZlciA9IHRydWU7CiAgICAgIGZ1bmN0aW9uIHN3YXAoYiwgbiwgbSkgewogICAgICAgIGNvbnN0IGkgPSBiW25dOwogICAgICAgIGJbbl0gPSBiW21dOwogICAgICAgIGJbbV0gPSBpOwogICAgICB9CiAgICAgIEJ1ZmZlcjMucHJvdG90eXBlLnN3YXAxNiA9IGZ1bmN0aW9uIHN3YXAxNigpIHsKICAgICAgICBjb25zdCBsZW4gPSB0aGlzLmxlbmd0aDsKICAgICAgICBpZiAobGVuICUgMiAhPT0gMCkgewogICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkJ1ZmZlciBzaXplIG11c3QgYmUgYSBtdWx0aXBsZSBvZiAxNi1iaXRzIik7CiAgICAgICAgfQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpICs9IDIpIHsKICAgICAgICAgIHN3YXAodGhpcywgaSwgaSArIDEpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfTsKICAgICAgQnVmZmVyMy5wcm90b3R5cGUuc3dhcDMyID0gZnVuY3Rpb24gc3dhcDMyKCkgewogICAgICAgIGNvbnN0IGxlbiA9IHRoaXMubGVuZ3RoOwogICAgICAgIGlmIChsZW4gJSA0ICE9PSAwKSB7CiAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQnVmZmVyIHNpemUgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDMyLWJpdHMiKTsKICAgICAgICB9CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkgKz0gNCkgewogICAgICAgICAgc3dhcCh0aGlzLCBpLCBpICsgMyk7CiAgICAgICAgICBzd2FwKHRoaXMsIGkgKyAxLCBpICsgMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9OwogICAgICBCdWZmZXIzLnByb3RvdHlwZS5zd2FwNjQgPSBmdW5jdGlvbiBzd2FwNjQoKSB7CiAgICAgICAgY29uc3QgbGVuID0gdGhpcy5sZW5ndGg7CiAgICAgICAgaWYgKGxlbiAlIDggIT09IDApIHsKICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJCdWZmZXIgc2l6ZSBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgNjQtYml0cyIpOwogICAgICAgIH0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSArPSA4KSB7CiAgICAgICAgICBzd2FwKHRoaXMsIGksIGkgKyA3KTsKICAgICAgICAgIHN3YXAodGhpcywgaSArIDEsIGkgKyA2KTsKICAgICAgICAgIHN3YXAodGhpcywgaSArIDIsIGkgKyA1KTsKICAgICAgICAgIHN3YXAodGhpcywgaSArIDMsIGkgKyA0KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH07CiAgICAgIEJ1ZmZlcjMucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgICAgY29uc3QgbGVuZ3RoID0gdGhpcy5sZW5ndGg7CiAgICAgICAgaWYgKGxlbmd0aCA9PT0gMCkKICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkKICAgICAgICAgIHJldHVybiB1dGY4U2xpY2UodGhpcywgMCwgbGVuZ3RoKTsKICAgICAgICByZXR1cm4gc2xvd1RvU3RyaW5nLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICAgIEJ1ZmZlcjMucHJvdG90eXBlLnRvTG9jYWxlU3RyaW5nID0gQnVmZmVyMy5wcm90b3R5cGUudG9TdHJpbmc7CiAgICAgIEJ1ZmZlcjMucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIGVxdWFscyhiKSB7CiAgICAgICAgaWYgKCFCdWZmZXIzLmlzQnVmZmVyKGIpKQogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQXJndW1lbnQgbXVzdCBiZSBhIEJ1ZmZlciIpOwogICAgICAgIGlmICh0aGlzID09PSBiKQogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJuIEJ1ZmZlcjMuY29tcGFyZSh0aGlzLCBiKSA9PT0gMDsKICAgICAgfTsKICAgICAgQnVmZmVyMy5wcm90b3R5cGUuaW5zcGVjdCA9IGZ1bmN0aW9uIGluc3BlY3QoKSB7CiAgICAgICAgbGV0IHN0ciA9ICIiOwogICAgICAgIGNvbnN0IG1heCA9IGV4cG9ydHMuSU5TUEVDVF9NQVhfQllURVM7CiAgICAgICAgc3RyID0gdGhpcy50b1N0cmluZygiaGV4IiwgMCwgbWF4KS5yZXBsYWNlKC8oLnsyfSkvZywgIiQxICIpLnRyaW0oKTsKICAgICAgICBpZiAodGhpcy5sZW5ndGggPiBtYXgpCiAgICAgICAgICBzdHIgKz0gIiAuLi4gIjsKICAgICAgICByZXR1cm4gIjxCdWZmZXIgIiArIHN0ciArICI+IjsKICAgICAgfTsKICAgICAgaWYgKGN1c3RvbUluc3BlY3RTeW1ib2wpIHsKICAgICAgICBCdWZmZXIzLnByb3RvdHlwZVtjdXN0b21JbnNwZWN0U3ltYm9sXSA9IEJ1ZmZlcjMucHJvdG90eXBlLmluc3BlY3Q7CiAgICAgIH0KICAgICAgQnVmZmVyMy5wcm90b3R5cGUuY29tcGFyZSA9IGZ1bmN0aW9uIGNvbXBhcmUodGFyZ2V0LCBzdGFydCwgZW5kLCB0aGlzU3RhcnQsIHRoaXNFbmQpIHsKICAgICAgICBpZiAoaXNJbnN0YW5jZSh0YXJnZXQsIFVpbnQ4QXJyYXkpKSB7CiAgICAgICAgICB0YXJnZXQgPSBCdWZmZXIzLmZyb20odGFyZ2V0LCB0YXJnZXQub2Zmc2V0LCB0YXJnZXQuYnl0ZUxlbmd0aCk7CiAgICAgICAgfQogICAgICAgIGlmICghQnVmZmVyMy5pc0J1ZmZlcih0YXJnZXQpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGUgInRhcmdldCIgYXJndW1lbnQgbXVzdCBiZSBvbmUgb2YgdHlwZSBCdWZmZXIgb3IgVWludDhBcnJheS4gUmVjZWl2ZWQgdHlwZSAnICsgdHlwZW9mIHRhcmdldCk7CiAgICAgICAgfQogICAgICAgIGlmIChzdGFydCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICBzdGFydCA9IDA7CiAgICAgICAgfQogICAgICAgIGlmIChlbmQgPT09IHZvaWQgMCkgewogICAgICAgICAgZW5kID0gdGFyZ2V0ID8gdGFyZ2V0Lmxlbmd0aCA6IDA7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzU3RhcnQgPT09IHZvaWQgMCkgewogICAgICAgICAgdGhpc1N0YXJ0ID0gMDsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXNFbmQgPT09IHZvaWQgMCkgewogICAgICAgICAgdGhpc0VuZCA9IHRoaXMubGVuZ3RoOwogICAgICAgIH0KICAgICAgICBpZiAoc3RhcnQgPCAwIHx8IGVuZCA+IHRhcmdldC5sZW5ndGggfHwgdGhpc1N0YXJ0IDwgMCB8fCB0aGlzRW5kID4gdGhpcy5sZW5ndGgpIHsKICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJvdXQgb2YgcmFuZ2UgaW5kZXgiKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXNTdGFydCA+PSB0aGlzRW5kICYmIHN0YXJ0ID49IGVuZCkgewogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzU3RhcnQgPj0gdGhpc0VuZCkgewogICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgICAgICBpZiAoc3RhcnQgPj0gZW5kKSB7CiAgICAgICAgICByZXR1cm4gMTsKICAgICAgICB9CiAgICAgICAgc3RhcnQgPj4+PSAwOwogICAgICAgIGVuZCA+Pj49IDA7CiAgICAgICAgdGhpc1N0YXJ0ID4+Pj0gMDsKICAgICAgICB0aGlzRW5kID4+Pj0gMDsKICAgICAgICBpZiAodGhpcyA9PT0gdGFyZ2V0KQogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgbGV0IHggPSB0aGlzRW5kIC0gdGhpc1N0YXJ0OwogICAgICAgIGxldCB5ID0gZW5kIC0gc3RhcnQ7CiAgICAgICAgY29uc3QgbGVuID0gTWF0aC5taW4oeCwgeSk7CiAgICAgICAgY29uc3QgdGhpc0NvcHkgPSB0aGlzLnNsaWNlKHRoaXNTdGFydCwgdGhpc0VuZCk7CiAgICAgICAgY29uc3QgdGFyZ2V0Q29weSA9IHRhcmdldC5zbGljZShzdGFydCwgZW5kKTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICBpZiAodGhpc0NvcHlbaV0gIT09IHRhcmdldENvcHlbaV0pIHsKICAgICAgICAgICAgeCA9IHRoaXNDb3B5W2ldOwogICAgICAgICAgICB5ID0gdGFyZ2V0Q29weVtpXTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh4IDwgeSkKICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICBpZiAoeSA8IHgpCiAgICAgICAgICByZXR1cm4gMTsKICAgICAgICByZXR1cm4gMDsKICAgICAgfTsKICAgICAgZnVuY3Rpb24gYmlkaXJlY3Rpb25hbEluZGV4T2YoYnVmZmVyLCB2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nLCBkaXIpIHsKICAgICAgICBpZiAoYnVmZmVyLmxlbmd0aCA9PT0gMCkKICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICBpZiAodHlwZW9mIGJ5dGVPZmZzZXQgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICBlbmNvZGluZyA9IGJ5dGVPZmZzZXQ7CiAgICAgICAgICBieXRlT2Zmc2V0ID0gMDsKICAgICAgICB9IGVsc2UgaWYgKGJ5dGVPZmZzZXQgPiAyMTQ3NDgzNjQ3KSB7CiAgICAgICAgICBieXRlT2Zmc2V0ID0gMjE0NzQ4MzY0NzsKICAgICAgICB9IGVsc2UgaWYgKGJ5dGVPZmZzZXQgPCAtMjE0NzQ4MzY0OCkgewogICAgICAgICAgYnl0ZU9mZnNldCA9IC0yMTQ3NDgzNjQ4OwogICAgICAgIH0KICAgICAgICBieXRlT2Zmc2V0ID0gK2J5dGVPZmZzZXQ7CiAgICAgICAgaWYgKG51bWJlcklzTmFOKGJ5dGVPZmZzZXQpKSB7CiAgICAgICAgICBieXRlT2Zmc2V0ID0gZGlyID8gMCA6IGJ1ZmZlci5sZW5ndGggLSAxOwogICAgICAgIH0KICAgICAgICBpZiAoYnl0ZU9mZnNldCA8IDApCiAgICAgICAgICBieXRlT2Zmc2V0ID0gYnVmZmVyLmxlbmd0aCArIGJ5dGVPZmZzZXQ7CiAgICAgICAgaWYgKGJ5dGVPZmZzZXQgPj0gYnVmZmVyLmxlbmd0aCkgewogICAgICAgICAgaWYgKGRpcikKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgZWxzZQogICAgICAgICAgICBieXRlT2Zmc2V0ID0gYnVmZmVyLmxlbmd0aCAtIDE7CiAgICAgICAgfSBlbHNlIGlmIChieXRlT2Zmc2V0IDwgMCkgewogICAgICAgICAgaWYgKGRpcikKICAgICAgICAgICAgYnl0ZU9mZnNldCA9IDA7CiAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiB2YWwgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICB2YWwgPSBCdWZmZXIzLmZyb20odmFsLCBlbmNvZGluZyk7CiAgICAgICAgfQogICAgICAgIGlmIChCdWZmZXIzLmlzQnVmZmVyKHZhbCkpIHsKICAgICAgICAgIGlmICh2YWwubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBhcnJheUluZGV4T2YoYnVmZmVyLCB2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nLCBkaXIpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbCA9PT0gIm51bWJlciIpIHsKICAgICAgICAgIHZhbCA9IHZhbCAmIDI1NTsKICAgICAgICAgIGlmICh0eXBlb2YgVWludDhBcnJheS5wcm90b3R5cGUuaW5kZXhPZiA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICBpZiAoZGlyKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFVpbnQ4QXJyYXkucHJvdG90eXBlLmluZGV4T2YuY2FsbChidWZmZXIsIHZhbCwgYnl0ZU9mZnNldCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmV0dXJuIFVpbnQ4QXJyYXkucHJvdG90eXBlLmxhc3RJbmRleE9mLmNhbGwoYnVmZmVyLCB2YWwsIGJ5dGVPZmZzZXQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gYXJyYXlJbmRleE9mKGJ1ZmZlciwgW3ZhbF0sIGJ5dGVPZmZzZXQsIGVuY29kaW5nLCBkaXIpOwogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJ2YWwgbXVzdCBiZSBzdHJpbmcsIG51bWJlciBvciBCdWZmZXIiKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBhcnJheUluZGV4T2YoYXJyLCB2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nLCBkaXIpIHsKICAgICAgICBsZXQgaW5kZXhTaXplID0gMTsKICAgICAgICBsZXQgYXJyTGVuZ3RoID0gYXJyLmxlbmd0aDsKICAgICAgICBsZXQgdmFsTGVuZ3RoID0gdmFsLmxlbmd0aDsKICAgICAgICBpZiAoZW5jb2RpbmcgIT09IHZvaWQgMCkgewogICAgICAgICAgZW5jb2RpbmcgPSBTdHJpbmcoZW5jb2RpbmcpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICBpZiAoZW5jb2RpbmcgPT09ICJ1Y3MyIiB8fCBlbmNvZGluZyA9PT0gInVjcy0yIiB8fCBlbmNvZGluZyA9PT0gInV0ZjE2bGUiIHx8IGVuY29kaW5nID09PSAidXRmLTE2bGUiKSB7CiAgICAgICAgICAgIGlmIChhcnIubGVuZ3RoIDwgMiB8fCB2YWwubGVuZ3RoIDwgMikgewogICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpbmRleFNpemUgPSAyOwogICAgICAgICAgICBhcnJMZW5ndGggLz0gMjsKICAgICAgICAgICAgdmFsTGVuZ3RoIC89IDI7CiAgICAgICAgICAgIGJ5dGVPZmZzZXQgLz0gMjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcmVhZChidWYsIGkyKSB7CiAgICAgICAgICBpZiAoaW5kZXhTaXplID09PSAxKSB7CiAgICAgICAgICAgIHJldHVybiBidWZbaTJdOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGJ1Zi5yZWFkVUludDE2QkUoaTIgKiBpbmRleFNpemUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBsZXQgaTsKICAgICAgICBpZiAoZGlyKSB7CiAgICAgICAgICBsZXQgZm91bmRJbmRleCA9IC0xOwogICAgICAgICAgZm9yIChpID0gYnl0ZU9mZnNldDsgaSA8IGFyckxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChyZWFkKGFyciwgaSkgPT09IHJlYWQodmFsLCBmb3VuZEluZGV4ID09PSAtMSA/IDAgOiBpIC0gZm91bmRJbmRleCkpIHsKICAgICAgICAgICAgICBpZiAoZm91bmRJbmRleCA9PT0gLTEpCiAgICAgICAgICAgICAgICBmb3VuZEluZGV4ID0gaTsKICAgICAgICAgICAgICBpZiAoaSAtIGZvdW5kSW5kZXggKyAxID09PSB2YWxMZW5ndGgpCiAgICAgICAgICAgICAgICByZXR1cm4gZm91bmRJbmRleCAqIGluZGV4U2l6ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpZiAoZm91bmRJbmRleCAhPT0gLTEpCiAgICAgICAgICAgICAgICBpIC09IGkgLSBmb3VuZEluZGV4OwogICAgICAgICAgICAgIGZvdW5kSW5kZXggPSAtMTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoYnl0ZU9mZnNldCArIHZhbExlbmd0aCA+IGFyckxlbmd0aCkKICAgICAgICAgICAgYnl0ZU9mZnNldCA9IGFyckxlbmd0aCAtIHZhbExlbmd0aDsKICAgICAgICAgIGZvciAoaSA9IGJ5dGVPZmZzZXQ7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgIGxldCBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdmFsTGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICBpZiAocmVhZChhcnIsIGkgKyBqKSAhPT0gcmVhZCh2YWwsIGopKSB7CiAgICAgICAgICAgICAgICBmb3VuZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChmb3VuZCkKICAgICAgICAgICAgICByZXR1cm4gaTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIC0xOwogICAgICB9CiAgICAgIEJ1ZmZlcjMucHJvdG90eXBlLmluY2x1ZGVzID0gZnVuY3Rpb24gaW5jbHVkZXModmFsLCBieXRlT2Zmc2V0LCBlbmNvZGluZykgewogICAgICAgIHJldHVybiB0aGlzLmluZGV4T2YodmFsLCBieXRlT2Zmc2V0LCBlbmNvZGluZykgIT09IC0xOwogICAgICB9OwogICAgICBCdWZmZXIzLnByb3RvdHlwZS5pbmRleE9mID0gZnVuY3Rpb24gaW5kZXhPZih2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nKSB7CiAgICAgICAgcmV0dXJuIGJpZGlyZWN0aW9uYWxJbmRleE9mKHRoaXMsIHZhbCwgYnl0ZU9mZnNldCwgZW5jb2RpbmcsIHRydWUpOwogICAgICB9OwogICAgICBCdWZmZXIzLnByb3RvdHlwZS5sYXN0SW5kZXhPZiA9IGZ1bmN0aW9uIGxhc3RJbmRleE9mKHZhbCwgYnl0ZU9mZnNldCwgZW5jb2RpbmcpIHsKICAgICAgICByZXR1cm4gYmlkaXJlY3Rpb25hbEluZGV4T2YodGhpcywgdmFsLCBieXRlT2Zmc2V0LCBlbmNvZGluZywgZmFsc2UpOwogICAgICB9OwogICAgICBmdW5jdGlvbiBoZXhXcml0ZShidWYsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpIHsKICAgICAgICBvZmZzZXQgPSBOdW1iZXIob2Zmc2V0KSB8fCAwOwogICAgICAgIGNvbnN0IHJlbWFpbmluZyA9IGJ1Zi5sZW5ndGggLSBvZmZzZXQ7CiAgICAgICAgaWYgKCFsZW5ndGgpIHsKICAgICAgICAgIGxlbmd0aCA9IHJlbWFpbmluZzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbGVuZ3RoID0gTnVtYmVyKGxlbmd0aCk7CiAgICAgICAgICBpZiAobGVuZ3RoID4gcmVtYWluaW5nKSB7CiAgICAgICAgICAgIGxlbmd0aCA9IHJlbWFpbmluZzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29uc3Qgc3RyTGVuID0gc3RyaW5nLmxlbmd0aDsKICAgICAgICBpZiAobGVuZ3RoID4gc3RyTGVuIC8gMikgewogICAgICAgICAgbGVuZ3RoID0gc3RyTGVuIC8gMjsKICAgICAgICB9CiAgICAgICAgbGV0IGk7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICAgICAgICBjb25zdCBwYXJzZWQgPSBwYXJzZUludChzdHJpbmcuc3Vic3RyKGkgKiAyLCAyKSwgMTYpOwogICAgICAgICAgaWYgKG51bWJlcklzTmFOKHBhcnNlZCkpCiAgICAgICAgICAgIHJldHVybiBpOwogICAgICAgICAgYnVmW29mZnNldCArIGldID0gcGFyc2VkOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaTsKICAgICAgfQogICAgICBmdW5jdGlvbiB1dGY4V3JpdGUoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIGJsaXRCdWZmZXIodXRmOFRvQnl0ZXMoc3RyaW5nLCBidWYubGVuZ3RoIC0gb2Zmc2V0KSwgYnVmLCBvZmZzZXQsIGxlbmd0aCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYXNjaWlXcml0ZShidWYsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpIHsKICAgICAgICByZXR1cm4gYmxpdEJ1ZmZlcihhc2NpaVRvQnl0ZXMoc3RyaW5nKSwgYnVmLCBvZmZzZXQsIGxlbmd0aCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYmFzZTY0V3JpdGUoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIGJsaXRCdWZmZXIoYmFzZTY0VG9CeXRlcyhzdHJpbmcpLCBidWYsIG9mZnNldCwgbGVuZ3RoKTsKICAgICAgfQogICAgICBmdW5jdGlvbiB1Y3MyV3JpdGUoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIGJsaXRCdWZmZXIodXRmMTZsZVRvQnl0ZXMoc3RyaW5nLCBidWYubGVuZ3RoIC0gb2Zmc2V0KSwgYnVmLCBvZmZzZXQsIGxlbmd0aCk7CiAgICAgIH0KICAgICAgQnVmZmVyMy5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbiB3cml0ZShzdHJpbmcsIG9mZnNldCwgbGVuZ3RoLCBlbmNvZGluZykgewogICAgICAgIGlmIChvZmZzZXQgPT09IHZvaWQgMCkgewogICAgICAgICAgZW5jb2RpbmcgPSAidXRmOCI7CiAgICAgICAgICBsZW5ndGggPSB0aGlzLmxlbmd0aDsKICAgICAgICAgIG9mZnNldCA9IDA7CiAgICAgICAgfSBlbHNlIGlmIChsZW5ndGggPT09IHZvaWQgMCAmJiB0eXBlb2Ygb2Zmc2V0ID09PSAic3RyaW5nIikgewogICAgICAgICAgZW5jb2RpbmcgPSBvZmZzZXQ7CiAgICAgICAgICBsZW5ndGggPSB0aGlzLmxlbmd0aDsKICAgICAgICAgIG9mZnNldCA9IDA7CiAgICAgICAgfSBlbHNlIGlmIChpc0Zpbml0ZShvZmZzZXQpKSB7CiAgICAgICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgICAgICBpZiAoaXNGaW5pdGUobGVuZ3RoKSkgewogICAgICAgICAgICBsZW5ndGggPSBsZW5ndGggPj4+IDA7CiAgICAgICAgICAgIGlmIChlbmNvZGluZyA9PT0gdm9pZCAwKQogICAgICAgICAgICAgIGVuY29kaW5nID0gInV0ZjgiOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZW5jb2RpbmcgPSBsZW5ndGg7CiAgICAgICAgICAgIGxlbmd0aCA9IHZvaWQgMDsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJCdWZmZXIud3JpdGUoc3RyaW5nLCBlbmNvZGluZywgb2Zmc2V0WywgbGVuZ3RoXSkgaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZCIpOwogICAgICAgIH0KICAgICAgICBjb25zdCByZW1haW5pbmcgPSB0aGlzLmxlbmd0aCAtIG9mZnNldDsKICAgICAgICBpZiAobGVuZ3RoID09PSB2b2lkIDAgfHwgbGVuZ3RoID4gcmVtYWluaW5nKQogICAgICAgICAgbGVuZ3RoID0gcmVtYWluaW5nOwogICAgICAgIGlmIChzdHJpbmcubGVuZ3RoID4gMCAmJiAobGVuZ3RoIDwgMCB8fCBvZmZzZXQgPCAwKSB8fCBvZmZzZXQgPiB0aGlzLmxlbmd0aCkgewogICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkF0dGVtcHQgdG8gd3JpdGUgb3V0c2lkZSBidWZmZXIgYm91bmRzIik7CiAgICAgICAgfQogICAgICAgIGlmICghZW5jb2RpbmcpCiAgICAgICAgICBlbmNvZGluZyA9ICJ1dGY4IjsKICAgICAgICBsZXQgbG93ZXJlZENhc2UgPSBmYWxzZTsKICAgICAgICBmb3IgKDsgOyApIHsKICAgICAgICAgIHN3aXRjaCAoZW5jb2RpbmcpIHsKICAgICAgICAgICAgY2FzZSAiaGV4IjoKICAgICAgICAgICAgICByZXR1cm4gaGV4V3JpdGUodGhpcywgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCk7CiAgICAgICAgICAgIGNhc2UgInV0ZjgiOgogICAgICAgICAgICBjYXNlICJ1dGYtOCI6CiAgICAgICAgICAgICAgcmV0dXJuIHV0ZjhXcml0ZSh0aGlzLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKTsKICAgICAgICAgICAgY2FzZSAiYXNjaWkiOgogICAgICAgICAgICBjYXNlICJsYXRpbjEiOgogICAgICAgICAgICBjYXNlICJiaW5hcnkiOgogICAgICAgICAgICAgIHJldHVybiBhc2NpaVdyaXRlKHRoaXMsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpOwogICAgICAgICAgICBjYXNlICJiYXNlNjQiOgogICAgICAgICAgICAgIHJldHVybiBiYXNlNjRXcml0ZSh0aGlzLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKTsKICAgICAgICAgICAgY2FzZSAidWNzMiI6CiAgICAgICAgICAgIGNhc2UgInVjcy0yIjoKICAgICAgICAgICAgY2FzZSAidXRmMTZsZSI6CiAgICAgICAgICAgIGNhc2UgInV0Zi0xNmxlIjoKICAgICAgICAgICAgICByZXR1cm4gdWNzMldyaXRlKHRoaXMsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIGlmIChsb3dlcmVkQ2FzZSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gZW5jb2Rpbmc6ICIgKyBlbmNvZGluZyk7CiAgICAgICAgICAgICAgZW5jb2RpbmcgPSAoIiIgKyBlbmNvZGluZykudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICBsb3dlcmVkQ2FzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgICBCdWZmZXIzLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiB0b0pTT04oKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHR5cGU6ICJCdWZmZXIiLAogICAgICAgICAgZGF0YTogQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodGhpcy5fYXJyIHx8IHRoaXMsIDApCiAgICAgICAgfTsKICAgICAgfTsKICAgICAgZnVuY3Rpb24gYmFzZTY0U2xpY2UoYnVmLCBzdGFydCwgZW5kKSB7CiAgICAgICAgaWYgKHN0YXJ0ID09PSAwICYmIGVuZCA9PT0gYnVmLmxlbmd0aCkgewogICAgICAgICAgcmV0dXJuIGJhc2U2NC5mcm9tQnl0ZUFycmF5KGJ1Zik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBiYXNlNjQuZnJvbUJ5dGVBcnJheShidWYuc2xpY2Uoc3RhcnQsIGVuZCkpOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiB1dGY4U2xpY2UoYnVmLCBzdGFydCwgZW5kKSB7CiAgICAgICAgZW5kID0gTWF0aC5taW4oYnVmLmxlbmd0aCwgZW5kKTsKICAgICAgICBjb25zdCByZXMgPSBbXTsKICAgICAgICBsZXQgaSA9IHN0YXJ0OwogICAgICAgIHdoaWxlIChpIDwgZW5kKSB7CiAgICAgICAgICBjb25zdCBmaXJzdEJ5dGUgPSBidWZbaV07CiAgICAgICAgICBsZXQgY29kZVBvaW50ID0gbnVsbDsKICAgICAgICAgIGxldCBieXRlc1BlclNlcXVlbmNlID0gZmlyc3RCeXRlID4gMjM5ID8gNCA6IGZpcnN0Qnl0ZSA+IDIyMyA/IDMgOiBmaXJzdEJ5dGUgPiAxOTEgPyAyIDogMTsKICAgICAgICAgIGlmIChpICsgYnl0ZXNQZXJTZXF1ZW5jZSA8PSBlbmQpIHsKICAgICAgICAgICAgbGV0IHNlY29uZEJ5dGUsIHRoaXJkQnl0ZSwgZm91cnRoQnl0ZSwgdGVtcENvZGVQb2ludDsKICAgICAgICAgICAgc3dpdGNoIChieXRlc1BlclNlcXVlbmNlKSB7CiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgaWYgKGZpcnN0Qnl0ZSA8IDEyOCkgewogICAgICAgICAgICAgICAgICBjb2RlUG9pbnQgPSBmaXJzdEJ5dGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBzZWNvbmRCeXRlID0gYnVmW2kgKyAxXTsKICAgICAgICAgICAgICAgIGlmICgoc2Vjb25kQnl0ZSAmIDE5MikgPT09IDEyOCkgewogICAgICAgICAgICAgICAgICB0ZW1wQ29kZVBvaW50ID0gKGZpcnN0Qnl0ZSAmIDMxKSA8PCA2IHwgc2Vjb25kQnl0ZSAmIDYzOwogICAgICAgICAgICAgICAgICBpZiAodGVtcENvZGVQb2ludCA+IDEyNykgewogICAgICAgICAgICAgICAgICAgIGNvZGVQb2ludCA9IHRlbXBDb2RlUG9pbnQ7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHNlY29uZEJ5dGUgPSBidWZbaSArIDFdOwogICAgICAgICAgICAgICAgdGhpcmRCeXRlID0gYnVmW2kgKyAyXTsKICAgICAgICAgICAgICAgIGlmICgoc2Vjb25kQnl0ZSAmIDE5MikgPT09IDEyOCAmJiAodGhpcmRCeXRlICYgMTkyKSA9PT0gMTI4KSB7CiAgICAgICAgICAgICAgICAgIHRlbXBDb2RlUG9pbnQgPSAoZmlyc3RCeXRlICYgMTUpIDw8IDEyIHwgKHNlY29uZEJ5dGUgJiA2MykgPDwgNiB8IHRoaXJkQnl0ZSAmIDYzOwogICAgICAgICAgICAgICAgICBpZiAodGVtcENvZGVQb2ludCA+IDIwNDcgJiYgKHRlbXBDb2RlUG9pbnQgPCA1NTI5NiB8fCB0ZW1wQ29kZVBvaW50ID4gNTczNDMpKSB7CiAgICAgICAgICAgICAgICAgICAgY29kZVBvaW50ID0gdGVtcENvZGVQb2ludDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgc2Vjb25kQnl0ZSA9IGJ1ZltpICsgMV07CiAgICAgICAgICAgICAgICB0aGlyZEJ5dGUgPSBidWZbaSArIDJdOwogICAgICAgICAgICAgICAgZm91cnRoQnl0ZSA9IGJ1ZltpICsgM107CiAgICAgICAgICAgICAgICBpZiAoKHNlY29uZEJ5dGUgJiAxOTIpID09PSAxMjggJiYgKHRoaXJkQnl0ZSAmIDE5MikgPT09IDEyOCAmJiAoZm91cnRoQnl0ZSAmIDE5MikgPT09IDEyOCkgewogICAgICAgICAgICAgICAgICB0ZW1wQ29kZVBvaW50ID0gKGZpcnN0Qnl0ZSAmIDE1KSA8PCAxOCB8IChzZWNvbmRCeXRlICYgNjMpIDw8IDEyIHwgKHRoaXJkQnl0ZSAmIDYzKSA8PCA2IHwgZm91cnRoQnl0ZSAmIDYzOwogICAgICAgICAgICAgICAgICBpZiAodGVtcENvZGVQb2ludCA+IDY1NTM1ICYmIHRlbXBDb2RlUG9pbnQgPCAxMTE0MTEyKSB7CiAgICAgICAgICAgICAgICAgICAgY29kZVBvaW50ID0gdGVtcENvZGVQb2ludDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoY29kZVBvaW50ID09PSBudWxsKSB7CiAgICAgICAgICAgIGNvZGVQb2ludCA9IDY1NTMzOwogICAgICAgICAgICBieXRlc1BlclNlcXVlbmNlID0gMTsKICAgICAgICAgIH0gZWxzZSBpZiAoY29kZVBvaW50ID4gNjU1MzUpIHsKICAgICAgICAgICAgY29kZVBvaW50IC09IDY1NTM2OwogICAgICAgICAgICByZXMucHVzaChjb2RlUG9pbnQgPj4+IDEwICYgMTAyMyB8IDU1Mjk2KTsKICAgICAgICAgICAgY29kZVBvaW50ID0gNTYzMjAgfCBjb2RlUG9pbnQgJiAxMDIzOwogICAgICAgICAgfQogICAgICAgICAgcmVzLnB1c2goY29kZVBvaW50KTsKICAgICAgICAgIGkgKz0gYnl0ZXNQZXJTZXF1ZW5jZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRlY29kZUNvZGVQb2ludHNBcnJheShyZXMpOwogICAgICB9CiAgICAgIHZhciBNQVhfQVJHVU1FTlRTX0xFTkdUSCA9IDQwOTY7CiAgICAgIGZ1bmN0aW9uIGRlY29kZUNvZGVQb2ludHNBcnJheShjb2RlUG9pbnRzKSB7CiAgICAgICAgY29uc3QgbGVuID0gY29kZVBvaW50cy5sZW5ndGg7CiAgICAgICAgaWYgKGxlbiA8PSBNQVhfQVJHVU1FTlRTX0xFTkdUSCkgewogICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkoU3RyaW5nLCBjb2RlUG9pbnRzKTsKICAgICAgICB9CiAgICAgICAgbGV0IHJlcyA9ICIiOwogICAgICAgIGxldCBpID0gMDsKICAgICAgICB3aGlsZSAoaSA8IGxlbikgewogICAgICAgICAgcmVzICs9IFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkoU3RyaW5nLCBjb2RlUG9pbnRzLnNsaWNlKGksIGkgKz0gTUFYX0FSR1VNRU5UU19MRU5HVEgpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlczsKICAgICAgfQogICAgICBmdW5jdGlvbiBhc2NpaVNsaWNlKGJ1Ziwgc3RhcnQsIGVuZCkgewogICAgICAgIGxldCByZXQgPSAiIjsKICAgICAgICBlbmQgPSBNYXRoLm1pbihidWYubGVuZ3RoLCBlbmQpOwogICAgICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8IGVuZDsgKytpKSB7CiAgICAgICAgICByZXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShidWZbaV0gJiAxMjcpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmV0OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGxhdGluMVNsaWNlKGJ1Ziwgc3RhcnQsIGVuZCkgewogICAgICAgIGxldCByZXQgPSAiIjsKICAgICAgICBlbmQgPSBNYXRoLm1pbihidWYubGVuZ3RoLCBlbmQpOwogICAgICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8IGVuZDsgKytpKSB7CiAgICAgICAgICByZXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShidWZbaV0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmV0OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGhleFNsaWNlKGJ1Ziwgc3RhcnQsIGVuZCkgewogICAgICAgIGNvbnN0IGxlbiA9IGJ1Zi5sZW5ndGg7CiAgICAgICAgaWYgKCFzdGFydCB8fCBzdGFydCA8IDApCiAgICAgICAgICBzdGFydCA9IDA7CiAgICAgICAgaWYgKCFlbmQgfHwgZW5kIDwgMCB8fCBlbmQgPiBsZW4pCiAgICAgICAgICBlbmQgPSBsZW47CiAgICAgICAgbGV0IG91dCA9ICIiOwogICAgICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8IGVuZDsgKytpKSB7CiAgICAgICAgICBvdXQgKz0gaGV4U2xpY2VMb29rdXBUYWJsZVtidWZbaV1dOwogICAgICAgIH0KICAgICAgICByZXR1cm4gb3V0OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHV0ZjE2bGVTbGljZShidWYsIHN0YXJ0LCBlbmQpIHsKICAgICAgICBjb25zdCBieXRlcyA9IGJ1Zi5zbGljZShzdGFydCwgZW5kKTsKICAgICAgICBsZXQgcmVzID0gIiI7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBieXRlcy5sZW5ndGggLSAxOyBpICs9IDIpIHsKICAgICAgICAgIHJlcyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGJ5dGVzW2ldICsgYnl0ZXNbaSArIDFdICogMjU2KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlczsKICAgICAgfQogICAgICBCdWZmZXIzLnByb3RvdHlwZS5zbGljZSA9IGZ1bmN0aW9uIHNsaWNlKHN0YXJ0LCBlbmQpIHsKICAgICAgICBjb25zdCBsZW4gPSB0aGlzLmxlbmd0aDsKICAgICAgICBzdGFydCA9IH5+c3RhcnQ7CiAgICAgICAgZW5kID0gZW5kID09PSB2b2lkIDAgPyBsZW4gOiB+fmVuZDsKICAgICAgICBpZiAoc3RhcnQgPCAwKSB7CiAgICAgICAgICBzdGFydCArPSBsZW47CiAgICAgICAgICBpZiAoc3RhcnQgPCAwKQogICAgICAgICAgICBzdGFydCA9IDA7CiAgICAgICAgfSBlbHNlIGlmIChzdGFydCA+IGxlbikgewogICAgICAgICAgc3RhcnQgPSBsZW47CiAgICAgICAgfQogICAgICAgIGlmIChlbmQgPCAwKSB7CiAgICAgICAgICBlbmQgKz0gbGVuOwogICAgICAgICAgaWYgKGVuZCA8IDApCiAgICAgICAgICAgIGVuZCA9IDA7CiAgICAgICAgfSBlbHNlIGlmIChlbmQgPiBsZW4pIHsKICAgICAgICAgIGVuZCA9IGxlbjsKICAgICAgICB9CiAgICAgICAgaWYgKGVuZCA8IHN0YXJ0KQogICAgICAgICAgZW5kID0gc3RhcnQ7CiAgICAgICAgY29uc3QgbmV3QnVmID0gdGhpcy5zdWJhcnJheShzdGFydCwgZW5kKTsKICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YobmV3QnVmLCBCdWZmZXIzLnByb3RvdHlwZSk7CiAgICAgICAgcmV0dXJuIG5ld0J1ZjsKICAgICAgfTsKICAgICAgZnVuY3Rpb24gY2hlY2tPZmZzZXQob2Zmc2V0LCBleHQsIGxlbmd0aCkgewogICAgICAgIGlmIChvZmZzZXQgJSAxICE9PSAwIHx8IG9mZnNldCA8IDApCiAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigib2Zmc2V0IGlzIG5vdCB1aW50Iik7CiAgICAgICAgaWYgKG9mZnNldCArIGV4dCA+IGxlbmd0aCkKICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJUcnlpbmcgdG8gYWNjZXNzIGJleW9uZCBidWZmZXIgbGVuZ3RoIik7CiAgICAgIH0KICAgICAgQnVmZmVyMy5wcm90b3R5cGUucmVhZFVpbnRMRSA9IEJ1ZmZlcjMucHJvdG90eXBlLnJlYWRVSW50TEUgPSBmdW5jdGlvbiByZWFkVUludExFKG9mZnNldCwgYnl0ZUxlbmd0aDIsIG5vQXNzZXJ0KSB7CiAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICAgIGJ5dGVMZW5ndGgyID0gYnl0ZUxlbmd0aDIgPj4+IDA7CiAgICAgICAgaWYgKCFub0Fzc2VydCkKICAgICAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgYnl0ZUxlbmd0aDIsIHRoaXMubGVuZ3RoKTsKICAgICAgICBsZXQgdmFsID0gdGhpc1tvZmZzZXRdOwogICAgICAgIGxldCBtdWwgPSAxOwogICAgICAgIGxldCBpID0gMDsKICAgICAgICB3aGlsZSAoKytpIDwgYnl0ZUxlbmd0aDIgJiYgKG11bCAqPSAyNTYpKSB7CiAgICAgICAgICB2YWwgKz0gdGhpc1tvZmZzZXQgKyBpXSAqIG11bDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgfTsKICAgICAgQnVmZmVyMy5wcm90b3R5cGUucmVhZFVpbnRCRSA9IEJ1ZmZlcjMucHJvdG90eXBlLnJlYWRVSW50QkUgPSBmdW5jdGlvbiByZWFkVUludEJFKG9mZnNldCwgYnl0ZUxlbmd0aDIsIG5vQXNzZXJ0KSB7CiAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICAgIGJ5dGVMZW5ndGgyID0gYnl0ZUxlbmd0aDIgPj4+IDA7CiAgICAgICAgaWYgKCFub0Fzc2VydCkgewogICAgICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCBieXRlTGVuZ3RoMiwgdGhpcy5sZW5ndGgpOwogICAgICAgIH0KICAgICAgICBsZXQgdmFsID0gdGhpc1tvZmZzZXQgKyAtLWJ5dGVMZW5ndGgyXTsKICAgICAgICBsZXQgbXVsID0gMTsKICAgICAgICB3aGlsZSAoYnl0ZUxlbmd0aDIgPiAwICYmIChtdWwgKj0gMjU2KSkgewogICAgICAgICAgdmFsICs9IHRoaXNbb2Zmc2V0ICsgLS1ieXRlTGVuZ3RoMl0gKiBtdWw7CiAgICAgICAgfQogICAgICAgIHJldHVybiB2YWw7CiAgICAgIH07CiAgICAgIEJ1ZmZlcjMucHJvdG90eXBlLnJlYWRVaW50OCA9IEJ1ZmZlcjMucHJvdG90eXBlLnJlYWRVSW50OCA9IGZ1bmN0aW9uIHJlYWRVSW50OChvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICAgIGlmICghbm9Bc3NlcnQpCiAgICAgICAgICBjaGVja09mZnNldChvZmZzZXQsIDEsIHRoaXMubGVuZ3RoKTsKICAgICAgICByZXR1cm4gdGhpc1tvZmZzZXRdOwogICAgICB9OwogICAgICBCdWZmZXIzLnByb3RvdHlwZS5yZWFkVWludDE2TEUgPSBCdWZmZXIzLnByb3RvdHlwZS5yZWFkVUludDE2TEUgPSBmdW5jdGlvbiByZWFkVUludDE2TEUob2Zmc2V0LCBub0Fzc2VydCkgewogICAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgICBpZiAoIW5vQXNzZXJ0KQogICAgICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCAyLCB0aGlzLmxlbmd0aCk7CiAgICAgICAgcmV0dXJuIHRoaXNbb2Zmc2V0XSB8IHRoaXNbb2Zmc2V0ICsgMV0gPDwgODsKICAgICAgfTsKICAgICAgQnVmZmVyMy5wcm90b3R5cGUucmVhZFVpbnQxNkJFID0gQnVmZmVyMy5wcm90b3R5cGUucmVhZFVJbnQxNkJFID0gZnVuY3Rpb24gcmVhZFVJbnQxNkJFKG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgICAgaWYgKCFub0Fzc2VydCkKICAgICAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgMiwgdGhpcy5sZW5ndGgpOwogICAgICAgIHJldHVybiB0aGlzW29mZnNldF0gPDwgOCB8IHRoaXNbb2Zmc2V0ICsgMV07CiAgICAgIH07CiAgICAgIEJ1ZmZlcjMucHJvdG90eXBlLnJlYWRVaW50MzJMRSA9IEJ1ZmZlcjMucHJvdG90eXBlLnJlYWRVSW50MzJMRSA9IGZ1bmN0aW9uIHJlYWRVSW50MzJMRShvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICAgIGlmICghbm9Bc3NlcnQpCiAgICAgICAgICBjaGVja09mZnNldChvZmZzZXQsIDQsIHRoaXMubGVuZ3RoKTsKICAgICAgICByZXR1cm4gKHRoaXNbb2Zmc2V0XSB8IHRoaXNbb2Zmc2V0ICsgMV0gPDwgOCB8IHRoaXNbb2Zmc2V0ICsgMl0gPDwgMTYpICsgdGhpc1tvZmZzZXQgKyAzXSAqIDE2Nzc3MjE2OwogICAgICB9OwogICAgICBCdWZmZXIzLnByb3RvdHlwZS5yZWFkVWludDMyQkUgPSBCdWZmZXIzLnByb3RvdHlwZS5yZWFkVUludDMyQkUgPSBmdW5jdGlvbiByZWFkVUludDMyQkUob2Zmc2V0LCBub0Fzc2VydCkgewogICAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgICBpZiAoIW5vQXNzZXJ0KQogICAgICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCA0LCB0aGlzLmxlbmd0aCk7CiAgICAgICAgcmV0dXJuIHRoaXNbb2Zmc2V0XSAqIDE2Nzc3MjE2ICsgKHRoaXNbb2Zmc2V0ICsgMV0gPDwgMTYgfCB0aGlzW29mZnNldCArIDJdIDw8IDggfCB0aGlzW29mZnNldCArIDNdKTsKICAgICAgfTsKICAgICAgQnVmZmVyMy5wcm90b3R5cGUucmVhZEJpZ1VJbnQ2NExFID0gZGVmaW5lQmlnSW50TWV0aG9kKGZ1bmN0aW9uIHJlYWRCaWdVSW50NjRMRShvZmZzZXQpIHsKICAgICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgICAgdmFsaWRhdGVOdW1iZXIob2Zmc2V0LCAib2Zmc2V0Iik7CiAgICAgICAgY29uc3QgZmlyc3QgPSB0aGlzW29mZnNldF07CiAgICAgICAgY29uc3QgbGFzdCA9IHRoaXNbb2Zmc2V0ICsgN107CiAgICAgICAgaWYgKGZpcnN0ID09PSB2b2lkIDAgfHwgbGFzdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICBib3VuZHNFcnJvcihvZmZzZXQsIHRoaXMubGVuZ3RoIC0gOCk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGxvID0gZmlyc3QgKyB0aGlzWysrb2Zmc2V0XSAqIDIgKiogOCArIHRoaXNbKytvZmZzZXRdICogMiAqKiAxNiArIHRoaXNbKytvZmZzZXRdICogMiAqKiAyNDsKICAgICAgICBjb25zdCBoaSA9IHRoaXNbKytvZmZzZXRdICsgdGhpc1srK29mZnNldF0gKiAyICoqIDggKyB0aGlzWysrb2Zmc2V0XSAqIDIgKiogMTYgKyBsYXN0ICogMiAqKiAyNDsKICAgICAgICByZXR1cm4gQmlnSW50KGxvKSArIChCaWdJbnQoaGkpIDw8IEJpZ0ludCgzMikpOwogICAgICB9KTsKICAgICAgQnVmZmVyMy5wcm90b3R5cGUucmVhZEJpZ1VJbnQ2NEJFID0gZGVmaW5lQmlnSW50TWV0aG9kKGZ1bmN0aW9uIHJlYWRCaWdVSW50NjRCRShvZmZzZXQpIHsKICAgICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgICAgdmFsaWRhdGVOdW1iZXIob2Zmc2V0LCAib2Zmc2V0Iik7CiAgICAgICAgY29uc3QgZmlyc3QgPSB0aGlzW29mZnNldF07CiAgICAgICAgY29uc3QgbGFzdCA9IHRoaXNbb2Zmc2V0ICsgN107CiAgICAgICAgaWYgKGZpcnN0ID09PSB2b2lkIDAgfHwgbGFzdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICBib3VuZHNFcnJvcihvZmZzZXQsIHRoaXMubGVuZ3RoIC0gOCk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGhpID0gZmlyc3QgKiAyICoqIDI0ICsgdGhpc1srK29mZnNldF0gKiAyICoqIDE2ICsgdGhpc1srK29mZnNldF0gKiAyICoqIDggKyB0aGlzWysrb2Zmc2V0XTsKICAgICAgICBjb25zdCBsbyA9IHRoaXNbKytvZmZzZXRdICogMiAqKiAyNCArIHRoaXNbKytvZmZzZXRdICogMiAqKiAxNiArIHRoaXNbKytvZmZzZXRdICogMiAqKiA4ICsgbGFzdDsKICAgICAgICByZXR1cm4gKEJpZ0ludChoaSkgPDwgQmlnSW50KDMyKSkgKyBCaWdJbnQobG8pOwogICAgICB9KTsKICAgICAgQnVmZmVyMy5wcm90b3R5cGUucmVhZEludExFID0gZnVuY3Rpb24gcmVhZEludExFKG9mZnNldCwgYnl0ZUxlbmd0aDIsIG5vQXNzZXJ0KSB7CiAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICAgIGJ5dGVMZW5ndGgyID0gYnl0ZUxlbmd0aDIgPj4+IDA7CiAgICAgICAgaWYgKCFub0Fzc2VydCkKICAgICAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgYnl0ZUxlbmd0aDIsIHRoaXMubGVuZ3RoKTsKICAgICAgICBsZXQgdmFsID0gdGhpc1tvZmZzZXRdOwogICAgICAgIGxldCBtdWwgPSAxOwogICAgICAgIGxldCBpID0gMDsKICAgICAgICB3aGlsZSAoKytpIDwgYnl0ZUxlbmd0aDIgJiYgKG11bCAqPSAyNTYpKSB7CiAgICAgICAgICB2YWwgKz0gdGhpc1tvZmZzZXQgKyBpXSAqIG11bDsKICAgICAgICB9CiAgICAgICAgbXVsICo9IDEyODsKICAgICAgICBpZiAodmFsID49IG11bCkKICAgICAgICAgIHZhbCAtPSBNYXRoLnBvdygyLCA4ICogYnl0ZUxlbmd0aDIpOwogICAgICAgIHJldHVybiB2YWw7CiAgICAgIH07CiAgICAgIEJ1ZmZlcjMucHJvdG90eXBlLnJlYWRJbnRCRSA9IGZ1bmN0aW9uIHJlYWRJbnRCRShvZmZzZXQsIGJ5dGVMZW5ndGgyLCBub0Fzc2VydCkgewogICAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgICBieXRlTGVuZ3RoMiA9IGJ5dGVMZW5ndGgyID4+PiAwOwogICAgICAgIGlmICghbm9Bc3NlcnQpCiAgICAgICAgICBjaGVja09mZnNldChvZmZzZXQsIGJ5dGVMZW5ndGgyLCB0aGlzLmxlbmd0aCk7CiAgICAgICAgbGV0IGkgPSBieXRlTGVuZ3RoMjsKICAgICAgICBsZXQgbXVsID0gMTsKICAgICAgICBsZXQgdmFsID0gdGhpc1tvZmZzZXQgKyAtLWldOwogICAgICAgIHdoaWxlIChpID4gMCAmJiAobXVsICo9IDI1NikpIHsKICAgICAgICAgIHZhbCArPSB0aGlzW29mZnNldCArIC0taV0gKiBtdWw7CiAgICAgICAgfQogICAgICAgIG11bCAqPSAxMjg7CiAgICAgICAgaWYgKHZhbCA+PSBtdWwpCiAgICAgICAgICB2YWwgLT0gTWF0aC5wb3coMiwgOCAqIGJ5dGVMZW5ndGgyKTsKICAgICAgICByZXR1cm4gdmFsOwogICAgICB9OwogICAgICBCdWZmZXIzLnByb3RvdHlwZS5yZWFkSW50OCA9IGZ1bmN0aW9uIHJlYWRJbnQ4KG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgICAgaWYgKCFub0Fzc2VydCkKICAgICAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgMSwgdGhpcy5sZW5ndGgpOwogICAgICAgIGlmICghKHRoaXNbb2Zmc2V0XSAmIDEyOCkpCiAgICAgICAgICByZXR1cm4gdGhpc1tvZmZzZXRdOwogICAgICAgIHJldHVybiAoMjU1IC0gdGhpc1tvZmZzZXRdICsgMSkgKiAtMTsKICAgICAgfTsKICAgICAgQnVmZmVyMy5wcm90b3R5cGUucmVhZEludDE2TEUgPSBmdW5jdGlvbiByZWFkSW50MTZMRShvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICAgIGlmICghbm9Bc3NlcnQpCiAgICAgICAgICBjaGVja09mZnNldChvZmZzZXQsIDIsIHRoaXMubGVuZ3RoKTsKICAgICAgICBjb25zdCB2YWwgPSB0aGlzW29mZnNldF0gfCB0aGlzW29mZnNldCArIDFdIDw8IDg7CiAgICAgICAgcmV0dXJuIHZhbCAmIDMyNzY4ID8gdmFsIHwgNDI5NDkwMTc2MCA6IHZhbDsKICAgICAgfTsKICAgICAgQnVmZmVyMy5wcm90b3R5cGUucmVhZEludDE2QkUgPSBmdW5jdGlvbiByZWFkSW50MTZCRShvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICAgIGlmICghbm9Bc3NlcnQpCiAgICAgICAgICBjaGVja09mZnNldChvZmZzZXQsIDIsIHRoaXMubGVuZ3RoKTsKICAgICAgICBjb25zdCB2YWwgPSB0aGlzW29mZnNldCArIDFdIHwgdGhpc1tvZmZzZXRdIDw8IDg7CiAgICAgICAgcmV0dXJuIHZhbCAmIDMyNzY4ID8gdmFsIHwgNDI5NDkwMTc2MCA6IHZhbDsKICAgICAgfTsKICAgICAgQnVmZmVyMy5wcm90b3R5cGUucmVhZEludDMyTEUgPSBmdW5jdGlvbiByZWFkSW50MzJMRShvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICAgIGlmICghbm9Bc3NlcnQpCiAgICAgICAgICBjaGVja09mZnNldChvZmZzZXQsIDQsIHRoaXMubGVuZ3RoKTsKICAgICAgICByZXR1cm4gdGhpc1tvZmZzZXRdIHwgdGhpc1tvZmZzZXQgKyAxXSA8PCA4IHwgdGhpc1tvZmZzZXQgKyAyXSA8PCAxNiB8IHRoaXNbb2Zmc2V0ICsgM10gPDwgMjQ7CiAgICAgIH07CiAgICAgIEJ1ZmZlcjMucHJvdG90eXBlLnJlYWRJbnQzMkJFID0gZnVuY3Rpb24gcmVhZEludDMyQkUob2Zmc2V0LCBub0Fzc2VydCkgewogICAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgICBpZiAoIW5vQXNzZXJ0KQogICAgICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCA0LCB0aGlzLmxlbmd0aCk7CiAgICAgICAgcmV0dXJuIHRoaXNbb2Zmc2V0XSA8PCAyNCB8IHRoaXNbb2Zmc2V0ICsgMV0gPDwgMTYgfCB0aGlzW29mZnNldCArIDJdIDw8IDggfCB0aGlzW29mZnNldCArIDNdOwogICAgICB9OwogICAgICBCdWZmZXIzLnByb3RvdHlwZS5yZWFkQmlnSW50NjRMRSA9IGRlZmluZUJpZ0ludE1ldGhvZChmdW5jdGlvbiByZWFkQmlnSW50NjRMRShvZmZzZXQpIHsKICAgICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgICAgdmFsaWRhdGVOdW1iZXIob2Zmc2V0LCAib2Zmc2V0Iik7CiAgICAgICAgY29uc3QgZmlyc3QgPSB0aGlzW29mZnNldF07CiAgICAgICAgY29uc3QgbGFzdCA9IHRoaXNbb2Zmc2V0ICsgN107CiAgICAgICAgaWYgKGZpcnN0ID09PSB2b2lkIDAgfHwgbGFzdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICBib3VuZHNFcnJvcihvZmZzZXQsIHRoaXMubGVuZ3RoIC0gOCk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHZhbCA9IHRoaXNbb2Zmc2V0ICsgNF0gKyB0aGlzW29mZnNldCArIDVdICogMiAqKiA4ICsgdGhpc1tvZmZzZXQgKyA2XSAqIDIgKiogMTYgKyAobGFzdCA8PCAyNCk7CiAgICAgICAgcmV0dXJuIChCaWdJbnQodmFsKSA8PCBCaWdJbnQoMzIpKSArIEJpZ0ludChmaXJzdCArIHRoaXNbKytvZmZzZXRdICogMiAqKiA4ICsgdGhpc1srK29mZnNldF0gKiAyICoqIDE2ICsgdGhpc1srK29mZnNldF0gKiAyICoqIDI0KTsKICAgICAgfSk7CiAgICAgIEJ1ZmZlcjMucHJvdG90eXBlLnJlYWRCaWdJbnQ2NEJFID0gZGVmaW5lQmlnSW50TWV0aG9kKGZ1bmN0aW9uIHJlYWRCaWdJbnQ2NEJFKG9mZnNldCkgewogICAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgICB2YWxpZGF0ZU51bWJlcihvZmZzZXQsICJvZmZzZXQiKTsKICAgICAgICBjb25zdCBmaXJzdCA9IHRoaXNbb2Zmc2V0XTsKICAgICAgICBjb25zdCBsYXN0ID0gdGhpc1tvZmZzZXQgKyA3XTsKICAgICAgICBpZiAoZmlyc3QgPT09IHZvaWQgMCB8fCBsYXN0ID09PSB2b2lkIDApIHsKICAgICAgICAgIGJvdW5kc0Vycm9yKG9mZnNldCwgdGhpcy5sZW5ndGggLSA4KTsKICAgICAgICB9CiAgICAgICAgY29uc3QgdmFsID0gKGZpcnN0IDw8IDI0KSArIHRoaXNbKytvZmZzZXRdICogMiAqKiAxNiArIHRoaXNbKytvZmZzZXRdICogMiAqKiA4ICsgdGhpc1srK29mZnNldF07CiAgICAgICAgcmV0dXJuIChCaWdJbnQodmFsKSA8PCBCaWdJbnQoMzIpKSArIEJpZ0ludCh0aGlzWysrb2Zmc2V0XSAqIDIgKiogMjQgKyB0aGlzWysrb2Zmc2V0XSAqIDIgKiogMTYgKyB0aGlzWysrb2Zmc2V0XSAqIDIgKiogOCArIGxhc3QpOwogICAgICB9KTsKICAgICAgQnVmZmVyMy5wcm90b3R5cGUucmVhZEZsb2F0TEUgPSBmdW5jdGlvbiByZWFkRmxvYXRMRShvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICAgIGlmICghbm9Bc3NlcnQpCiAgICAgICAgICBjaGVja09mZnNldChvZmZzZXQsIDQsIHRoaXMubGVuZ3RoKTsKICAgICAgICByZXR1cm4gaWVlZTc1NC5yZWFkKHRoaXMsIG9mZnNldCwgdHJ1ZSwgMjMsIDQpOwogICAgICB9OwogICAgICBCdWZmZXIzLnByb3RvdHlwZS5yZWFkRmxvYXRCRSA9IGZ1bmN0aW9uIHJlYWRGbG9hdEJFKG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgICAgaWYgKCFub0Fzc2VydCkKICAgICAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgNCwgdGhpcy5sZW5ndGgpOwogICAgICAgIHJldHVybiBpZWVlNzU0LnJlYWQodGhpcywgb2Zmc2V0LCBmYWxzZSwgMjMsIDQpOwogICAgICB9OwogICAgICBCdWZmZXIzLnByb3RvdHlwZS5yZWFkRG91YmxlTEUgPSBmdW5jdGlvbiByZWFkRG91YmxlTEUob2Zmc2V0LCBub0Fzc2VydCkgewogICAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgICBpZiAoIW5vQXNzZXJ0KQogICAgICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCA4LCB0aGlzLmxlbmd0aCk7CiAgICAgICAgcmV0dXJuIGllZWU3NTQucmVhZCh0aGlzLCBvZmZzZXQsIHRydWUsIDUyLCA4KTsKICAgICAgfTsKICAgICAgQnVmZmVyMy5wcm90b3R5cGUucmVhZERvdWJsZUJFID0gZnVuY3Rpb24gcmVhZERvdWJsZUJFKG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgICAgaWYgKCFub0Fzc2VydCkKICAgICAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgOCwgdGhpcy5sZW5ndGgpOwogICAgICAgIHJldHVybiBpZWVlNzU0LnJlYWQodGhpcywgb2Zmc2V0LCBmYWxzZSwgNTIsIDgpOwogICAgICB9OwogICAgICBmdW5jdGlvbiBjaGVja0ludChidWYsIHZhbHVlLCBvZmZzZXQsIGV4dCwgbWF4LCBtaW4pIHsKICAgICAgICBpZiAoIUJ1ZmZlcjMuaXNCdWZmZXIoYnVmKSkKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJyJidWZmZXIiIGFyZ3VtZW50IG11c3QgYmUgYSBCdWZmZXIgaW5zdGFuY2UnKTsKICAgICAgICBpZiAodmFsdWUgPiBtYXggfHwgdmFsdWUgPCBtaW4pCiAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignInZhbHVlIiBhcmd1bWVudCBpcyBvdXQgb2YgYm91bmRzJyk7CiAgICAgICAgaWYgKG9mZnNldCArIGV4dCA+IGJ1Zi5sZW5ndGgpCiAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiSW5kZXggb3V0IG9mIHJhbmdlIik7CiAgICAgIH0KICAgICAgQnVmZmVyMy5wcm90b3R5cGUud3JpdGVVaW50TEUgPSBCdWZmZXIzLnByb3RvdHlwZS53cml0ZVVJbnRMRSA9IGZ1bmN0aW9uIHdyaXRlVUludExFKHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgyLCBub0Fzc2VydCkgewogICAgICAgIHZhbHVlID0gK3ZhbHVlOwogICAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgICBieXRlTGVuZ3RoMiA9IGJ5dGVMZW5ndGgyID4+PiAwOwogICAgICAgIGlmICghbm9Bc3NlcnQpIHsKICAgICAgICAgIGNvbnN0IG1heEJ5dGVzID0gTWF0aC5wb3coMiwgOCAqIGJ5dGVMZW5ndGgyKSAtIDE7CiAgICAgICAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoMiwgbWF4Qnl0ZXMsIDApOwogICAgICAgIH0KICAgICAgICBsZXQgbXVsID0gMTsKICAgICAgICBsZXQgaSA9IDA7CiAgICAgICAgdGhpc1tvZmZzZXRdID0gdmFsdWUgJiAyNTU7CiAgICAgICAgd2hpbGUgKCsraSA8IGJ5dGVMZW5ndGgyICYmIChtdWwgKj0gMjU2KSkgewogICAgICAgICAgdGhpc1tvZmZzZXQgKyBpXSA9IHZhbHVlIC8gbXVsICYgMjU1OwogICAgICAgIH0KICAgICAgICByZXR1cm4gb2Zmc2V0ICsgYnl0ZUxlbmd0aDI7CiAgICAgIH07CiAgICAgIEJ1ZmZlcjMucHJvdG90eXBlLndyaXRlVWludEJFID0gQnVmZmVyMy5wcm90b3R5cGUud3JpdGVVSW50QkUgPSBmdW5jdGlvbiB3cml0ZVVJbnRCRSh2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoMiwgbm9Bc3NlcnQpIHsKICAgICAgICB2YWx1ZSA9ICt2YWx1ZTsKICAgICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgICAgYnl0ZUxlbmd0aDIgPSBieXRlTGVuZ3RoMiA+Pj4gMDsKICAgICAgICBpZiAoIW5vQXNzZXJ0KSB7CiAgICAgICAgICBjb25zdCBtYXhCeXRlcyA9IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoMikgLSAxOwogICAgICAgICAgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgYnl0ZUxlbmd0aDIsIG1heEJ5dGVzLCAwKTsKICAgICAgICB9CiAgICAgICAgbGV0IGkgPSBieXRlTGVuZ3RoMiAtIDE7CiAgICAgICAgbGV0IG11bCA9IDE7CiAgICAgICAgdGhpc1tvZmZzZXQgKyBpXSA9IHZhbHVlICYgMjU1OwogICAgICAgIHdoaWxlICgtLWkgPj0gMCAmJiAobXVsICo9IDI1NikpIHsKICAgICAgICAgIHRoaXNbb2Zmc2V0ICsgaV0gPSB2YWx1ZSAvIG11bCAmIDI1NTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG9mZnNldCArIGJ5dGVMZW5ndGgyOwogICAgICB9OwogICAgICBCdWZmZXIzLnByb3RvdHlwZS53cml0ZVVpbnQ4ID0gQnVmZmVyMy5wcm90b3R5cGUud3JpdGVVSW50OCA9IGZ1bmN0aW9uIHdyaXRlVUludDgodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgICAgICB2YWx1ZSA9ICt2YWx1ZTsKICAgICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgICAgaWYgKCFub0Fzc2VydCkKICAgICAgICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDEsIDI1NSwgMCk7CiAgICAgICAgdGhpc1tvZmZzZXRdID0gdmFsdWUgJiAyNTU7CiAgICAgICAgcmV0dXJuIG9mZnNldCArIDE7CiAgICAgIH07CiAgICAgIEJ1ZmZlcjMucHJvdG90eXBlLndyaXRlVWludDE2TEUgPSBCdWZmZXIzLnByb3RvdHlwZS53cml0ZVVJbnQxNkxFID0gZnVuY3Rpb24gd3JpdGVVSW50MTZMRSh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogICAgICAgIHZhbHVlID0gK3ZhbHVlOwogICAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgICBpZiAoIW5vQXNzZXJ0KQogICAgICAgICAgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgMiwgNjU1MzUsIDApOwogICAgICAgIHRoaXNbb2Zmc2V0XSA9IHZhbHVlICYgMjU1OwogICAgICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSB2YWx1ZSA+Pj4gODsKICAgICAgICByZXR1cm4gb2Zmc2V0ICsgMjsKICAgICAgfTsKICAgICAgQnVmZmVyMy5wcm90b3R5cGUud3JpdGVVaW50MTZCRSA9IEJ1ZmZlcjMucHJvdG90eXBlLndyaXRlVUludDE2QkUgPSBmdW5jdGlvbiB3cml0ZVVJbnQxNkJFKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICAgICAgdmFsdWUgPSArdmFsdWU7CiAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICAgIGlmICghbm9Bc3NlcnQpCiAgICAgICAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCAyLCA2NTUzNSwgMCk7CiAgICAgICAgdGhpc1tvZmZzZXRdID0gdmFsdWUgPj4+IDg7CiAgICAgICAgdGhpc1tvZmZzZXQgKyAxXSA9IHZhbHVlICYgMjU1OwogICAgICAgIHJldHVybiBvZmZzZXQgKyAyOwogICAgICB9OwogICAgICBCdWZmZXIzLnByb3RvdHlwZS53cml0ZVVpbnQzMkxFID0gQnVmZmVyMy5wcm90b3R5cGUud3JpdGVVSW50MzJMRSA9IGZ1bmN0aW9uIHdyaXRlVUludDMyTEUodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgICAgICB2YWx1ZSA9ICt2YWx1ZTsKICAgICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgICAgaWYgKCFub0Fzc2VydCkKICAgICAgICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDQsIDQyOTQ5NjcyOTUsIDApOwogICAgICAgIHRoaXNbb2Zmc2V0ICsgM10gPSB2YWx1ZSA+Pj4gMjQ7CiAgICAgICAgdGhpc1tvZmZzZXQgKyAyXSA9IHZhbHVlID4+PiAxNjsKICAgICAgICB0aGlzW29mZnNldCArIDFdID0gdmFsdWUgPj4+IDg7CiAgICAgICAgdGhpc1tvZmZzZXRdID0gdmFsdWUgJiAyNTU7CiAgICAgICAgcmV0dXJuIG9mZnNldCArIDQ7CiAgICAgIH07CiAgICAgIEJ1ZmZlcjMucHJvdG90eXBlLndyaXRlVWludDMyQkUgPSBCdWZmZXIzLnByb3RvdHlwZS53cml0ZVVJbnQzMkJFID0gZnVuY3Rpb24gd3JpdGVVSW50MzJCRSh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogICAgICAgIHZhbHVlID0gK3ZhbHVlOwogICAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgICBpZiAoIW5vQXNzZXJ0KQogICAgICAgICAgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgNCwgNDI5NDk2NzI5NSwgMCk7CiAgICAgICAgdGhpc1tvZmZzZXRdID0gdmFsdWUgPj4+IDI0OwogICAgICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSB2YWx1ZSA+Pj4gMTY7CiAgICAgICAgdGhpc1tvZmZzZXQgKyAyXSA9IHZhbHVlID4+PiA4OwogICAgICAgIHRoaXNbb2Zmc2V0ICsgM10gPSB2YWx1ZSAmIDI1NTsKICAgICAgICByZXR1cm4gb2Zmc2V0ICsgNDsKICAgICAgfTsKICAgICAgZnVuY3Rpb24gd3J0QmlnVUludDY0TEUoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBtaW4sIG1heCkgewogICAgICAgIGNoZWNrSW50QkkodmFsdWUsIG1pbiwgbWF4LCBidWYsIG9mZnNldCwgNyk7CiAgICAgICAgbGV0IGxvID0gTnVtYmVyKHZhbHVlICYgQmlnSW50KDQyOTQ5NjcyOTUpKTsKICAgICAgICBidWZbb2Zmc2V0KytdID0gbG87CiAgICAgICAgbG8gPSBsbyA+PiA4OwogICAgICAgIGJ1ZltvZmZzZXQrK10gPSBsbzsKICAgICAgICBsbyA9IGxvID4+IDg7CiAgICAgICAgYnVmW29mZnNldCsrXSA9IGxvOwogICAgICAgIGxvID0gbG8gPj4gODsKICAgICAgICBidWZbb2Zmc2V0KytdID0gbG87CiAgICAgICAgbGV0IGhpID0gTnVtYmVyKHZhbHVlID4+IEJpZ0ludCgzMikgJiBCaWdJbnQoNDI5NDk2NzI5NSkpOwogICAgICAgIGJ1ZltvZmZzZXQrK10gPSBoaTsKICAgICAgICBoaSA9IGhpID4+IDg7CiAgICAgICAgYnVmW29mZnNldCsrXSA9IGhpOwogICAgICAgIGhpID0gaGkgPj4gODsKICAgICAgICBidWZbb2Zmc2V0KytdID0gaGk7CiAgICAgICAgaGkgPSBoaSA+PiA4OwogICAgICAgIGJ1ZltvZmZzZXQrK10gPSBoaTsKICAgICAgICByZXR1cm4gb2Zmc2V0OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHdydEJpZ1VJbnQ2NEJFKGJ1ZiwgdmFsdWUsIG9mZnNldCwgbWluLCBtYXgpIHsKICAgICAgICBjaGVja0ludEJJKHZhbHVlLCBtaW4sIG1heCwgYnVmLCBvZmZzZXQsIDcpOwogICAgICAgIGxldCBsbyA9IE51bWJlcih2YWx1ZSAmIEJpZ0ludCg0Mjk0OTY3Mjk1KSk7CiAgICAgICAgYnVmW29mZnNldCArIDddID0gbG87CiAgICAgICAgbG8gPSBsbyA+PiA4OwogICAgICAgIGJ1ZltvZmZzZXQgKyA2XSA9IGxvOwogICAgICAgIGxvID0gbG8gPj4gODsKICAgICAgICBidWZbb2Zmc2V0ICsgNV0gPSBsbzsKICAgICAgICBsbyA9IGxvID4+IDg7CiAgICAgICAgYnVmW29mZnNldCArIDRdID0gbG87CiAgICAgICAgbGV0IGhpID0gTnVtYmVyKHZhbHVlID4+IEJpZ0ludCgzMikgJiBCaWdJbnQoNDI5NDk2NzI5NSkpOwogICAgICAgIGJ1ZltvZmZzZXQgKyAzXSA9IGhpOwogICAgICAgIGhpID0gaGkgPj4gODsKICAgICAgICBidWZbb2Zmc2V0ICsgMl0gPSBoaTsKICAgICAgICBoaSA9IGhpID4+IDg7CiAgICAgICAgYnVmW29mZnNldCArIDFdID0gaGk7CiAgICAgICAgaGkgPSBoaSA+PiA4OwogICAgICAgIGJ1ZltvZmZzZXRdID0gaGk7CiAgICAgICAgcmV0dXJuIG9mZnNldCArIDg7CiAgICAgIH0KICAgICAgQnVmZmVyMy5wcm90b3R5cGUud3JpdGVCaWdVSW50NjRMRSA9IGRlZmluZUJpZ0ludE1ldGhvZChmdW5jdGlvbiB3cml0ZUJpZ1VJbnQ2NExFKHZhbHVlLCBvZmZzZXQgPSAwKSB7CiAgICAgICAgcmV0dXJuIHdydEJpZ1VJbnQ2NExFKHRoaXMsIHZhbHVlLCBvZmZzZXQsIEJpZ0ludCgwKSwgQmlnSW50KCIweGZmZmZmZmZmZmZmZmZmZmYiKSk7CiAgICAgIH0pOwogICAgICBCdWZmZXIzLnByb3RvdHlwZS53cml0ZUJpZ1VJbnQ2NEJFID0gZGVmaW5lQmlnSW50TWV0aG9kKGZ1bmN0aW9uIHdyaXRlQmlnVUludDY0QkUodmFsdWUsIG9mZnNldCA9IDApIHsKICAgICAgICByZXR1cm4gd3J0QmlnVUludDY0QkUodGhpcywgdmFsdWUsIG9mZnNldCwgQmlnSW50KDApLCBCaWdJbnQoIjB4ZmZmZmZmZmZmZmZmZmZmZiIpKTsKICAgICAgfSk7CiAgICAgIEJ1ZmZlcjMucHJvdG90eXBlLndyaXRlSW50TEUgPSBmdW5jdGlvbiB3cml0ZUludExFKHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgyLCBub0Fzc2VydCkgewogICAgICAgIHZhbHVlID0gK3ZhbHVlOwogICAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgICBpZiAoIW5vQXNzZXJ0KSB7CiAgICAgICAgICBjb25zdCBsaW1pdCA9IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoMiAtIDEpOwogICAgICAgICAgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgYnl0ZUxlbmd0aDIsIGxpbWl0IC0gMSwgLWxpbWl0KTsKICAgICAgICB9CiAgICAgICAgbGV0IGkgPSAwOwogICAgICAgIGxldCBtdWwgPSAxOwogICAgICAgIGxldCBzdWIgPSAwOwogICAgICAgIHRoaXNbb2Zmc2V0XSA9IHZhbHVlICYgMjU1OwogICAgICAgIHdoaWxlICgrK2kgPCBieXRlTGVuZ3RoMiAmJiAobXVsICo9IDI1NikpIHsKICAgICAgICAgIGlmICh2YWx1ZSA8IDAgJiYgc3ViID09PSAwICYmIHRoaXNbb2Zmc2V0ICsgaSAtIDFdICE9PSAwKSB7CiAgICAgICAgICAgIHN1YiA9IDE7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzW29mZnNldCArIGldID0gKHZhbHVlIC8gbXVsID4+IDApIC0gc3ViICYgMjU1OwogICAgICAgIH0KICAgICAgICByZXR1cm4gb2Zmc2V0ICsgYnl0ZUxlbmd0aDI7CiAgICAgIH07CiAgICAgIEJ1ZmZlcjMucHJvdG90eXBlLndyaXRlSW50QkUgPSBmdW5jdGlvbiB3cml0ZUludEJFKHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgyLCBub0Fzc2VydCkgewogICAgICAgIHZhbHVlID0gK3ZhbHVlOwogICAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgICBpZiAoIW5vQXNzZXJ0KSB7CiAgICAgICAgICBjb25zdCBsaW1pdCA9IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoMiAtIDEpOwogICAgICAgICAgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgYnl0ZUxlbmd0aDIsIGxpbWl0IC0gMSwgLWxpbWl0KTsKICAgICAgICB9CiAgICAgICAgbGV0IGkgPSBieXRlTGVuZ3RoMiAtIDE7CiAgICAgICAgbGV0IG11bCA9IDE7CiAgICAgICAgbGV0IHN1YiA9IDA7CiAgICAgICAgdGhpc1tvZmZzZXQgKyBpXSA9IHZhbHVlICYgMjU1OwogICAgICAgIHdoaWxlICgtLWkgPj0gMCAmJiAobXVsICo9IDI1NikpIHsKICAgICAgICAgIGlmICh2YWx1ZSA8IDAgJiYgc3ViID09PSAwICYmIHRoaXNbb2Zmc2V0ICsgaSArIDFdICE9PSAwKSB7CiAgICAgICAgICAgIHN1YiA9IDE7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzW29mZnNldCArIGldID0gKHZhbHVlIC8gbXVsID4+IDApIC0gc3ViICYgMjU1OwogICAgICAgIH0KICAgICAgICByZXR1cm4gb2Zmc2V0ICsgYnl0ZUxlbmd0aDI7CiAgICAgIH07CiAgICAgIEJ1ZmZlcjMucHJvdG90eXBlLndyaXRlSW50OCA9IGZ1bmN0aW9uIHdyaXRlSW50OCh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogICAgICAgIHZhbHVlID0gK3ZhbHVlOwogICAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgICBpZiAoIW5vQXNzZXJ0KQogICAgICAgICAgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgMSwgMTI3LCAtMTI4KTsKICAgICAgICBpZiAodmFsdWUgPCAwKQogICAgICAgICAgdmFsdWUgPSAyNTUgKyB2YWx1ZSArIDE7CiAgICAgICAgdGhpc1tvZmZzZXRdID0gdmFsdWUgJiAyNTU7CiAgICAgICAgcmV0dXJuIG9mZnNldCArIDE7CiAgICAgIH07CiAgICAgIEJ1ZmZlcjMucHJvdG90eXBlLndyaXRlSW50MTZMRSA9IGZ1bmN0aW9uIHdyaXRlSW50MTZMRSh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogICAgICAgIHZhbHVlID0gK3ZhbHVlOwogICAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgICBpZiAoIW5vQXNzZXJ0KQogICAgICAgICAgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgMiwgMzI3NjcsIC0zMjc2OCk7CiAgICAgICAgdGhpc1tvZmZzZXRdID0gdmFsdWUgJiAyNTU7CiAgICAgICAgdGhpc1tvZmZzZXQgKyAxXSA9IHZhbHVlID4+PiA4OwogICAgICAgIHJldHVybiBvZmZzZXQgKyAyOwogICAgICB9OwogICAgICBCdWZmZXIzLnByb3RvdHlwZS53cml0ZUludDE2QkUgPSBmdW5jdGlvbiB3cml0ZUludDE2QkUodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgICAgICB2YWx1ZSA9ICt2YWx1ZTsKICAgICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgICAgaWYgKCFub0Fzc2VydCkKICAgICAgICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDIsIDMyNzY3LCAtMzI3NjgpOwogICAgICAgIHRoaXNbb2Zmc2V0XSA9IHZhbHVlID4+PiA4OwogICAgICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSB2YWx1ZSAmIDI1NTsKICAgICAgICByZXR1cm4gb2Zmc2V0ICsgMjsKICAgICAgfTsKICAgICAgQnVmZmVyMy5wcm90b3R5cGUud3JpdGVJbnQzMkxFID0gZnVuY3Rpb24gd3JpdGVJbnQzMkxFKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICAgICAgdmFsdWUgPSArdmFsdWU7CiAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICAgIGlmICghbm9Bc3NlcnQpCiAgICAgICAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCA0LCAyMTQ3NDgzNjQ3LCAtMjE0NzQ4MzY0OCk7CiAgICAgICAgdGhpc1tvZmZzZXRdID0gdmFsdWUgJiAyNTU7CiAgICAgICAgdGhpc1tvZmZzZXQgKyAxXSA9IHZhbHVlID4+PiA4OwogICAgICAgIHRoaXNbb2Zmc2V0ICsgMl0gPSB2YWx1ZSA+Pj4gMTY7CiAgICAgICAgdGhpc1tvZmZzZXQgKyAzXSA9IHZhbHVlID4+PiAyNDsKICAgICAgICByZXR1cm4gb2Zmc2V0ICsgNDsKICAgICAgfTsKICAgICAgQnVmZmVyMy5wcm90b3R5cGUud3JpdGVJbnQzMkJFID0gZnVuY3Rpb24gd3JpdGVJbnQzMkJFKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICAgICAgdmFsdWUgPSArdmFsdWU7CiAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICAgIGlmICghbm9Bc3NlcnQpCiAgICAgICAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCA0LCAyMTQ3NDgzNjQ3LCAtMjE0NzQ4MzY0OCk7CiAgICAgICAgaWYgKHZhbHVlIDwgMCkKICAgICAgICAgIHZhbHVlID0gNDI5NDk2NzI5NSArIHZhbHVlICsgMTsKICAgICAgICB0aGlzW29mZnNldF0gPSB2YWx1ZSA+Pj4gMjQ7CiAgICAgICAgdGhpc1tvZmZzZXQgKyAxXSA9IHZhbHVlID4+PiAxNjsKICAgICAgICB0aGlzW29mZnNldCArIDJdID0gdmFsdWUgPj4+IDg7CiAgICAgICAgdGhpc1tvZmZzZXQgKyAzXSA9IHZhbHVlICYgMjU1OwogICAgICAgIHJldHVybiBvZmZzZXQgKyA0OwogICAgICB9OwogICAgICBCdWZmZXIzLnByb3RvdHlwZS53cml0ZUJpZ0ludDY0TEUgPSBkZWZpbmVCaWdJbnRNZXRob2QoZnVuY3Rpb24gd3JpdGVCaWdJbnQ2NExFKHZhbHVlLCBvZmZzZXQgPSAwKSB7CiAgICAgICAgcmV0dXJuIHdydEJpZ1VJbnQ2NExFKHRoaXMsIHZhbHVlLCBvZmZzZXQsIC1CaWdJbnQoIjB4ODAwMDAwMDAwMDAwMDAwMCIpLCBCaWdJbnQoIjB4N2ZmZmZmZmZmZmZmZmZmZiIpKTsKICAgICAgfSk7CiAgICAgIEJ1ZmZlcjMucHJvdG90eXBlLndyaXRlQmlnSW50NjRCRSA9IGRlZmluZUJpZ0ludE1ldGhvZChmdW5jdGlvbiB3cml0ZUJpZ0ludDY0QkUodmFsdWUsIG9mZnNldCA9IDApIHsKICAgICAgICByZXR1cm4gd3J0QmlnVUludDY0QkUodGhpcywgdmFsdWUsIG9mZnNldCwgLUJpZ0ludCgiMHg4MDAwMDAwMDAwMDAwMDAwIiksIEJpZ0ludCgiMHg3ZmZmZmZmZmZmZmZmZmZmIikpOwogICAgICB9KTsKICAgICAgZnVuY3Rpb24gY2hlY2tJRUVFNzU0KGJ1ZiwgdmFsdWUsIG9mZnNldCwgZXh0LCBtYXgsIG1pbikgewogICAgICAgIGlmIChvZmZzZXQgKyBleHQgPiBidWYubGVuZ3RoKQogICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkluZGV4IG91dCBvZiByYW5nZSIpOwogICAgICAgIGlmIChvZmZzZXQgPCAwKQogICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkluZGV4IG91dCBvZiByYW5nZSIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHdyaXRlRmxvYXQoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4sIG5vQXNzZXJ0KSB7CiAgICAgICAgdmFsdWUgPSArdmFsdWU7CiAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICAgIGlmICghbm9Bc3NlcnQpIHsKICAgICAgICAgIGNoZWNrSUVFRTc1NChidWYsIHZhbHVlLCBvZmZzZXQsIDQsIDM0MDI4MjM0NjYzODUyODg2ZTIyLCAtMzQwMjgyMzQ2NjM4NTI4ODZlMjIpOwogICAgICAgIH0KICAgICAgICBpZWVlNzU0LndyaXRlKGJ1ZiwgdmFsdWUsIG9mZnNldCwgbGl0dGxlRW5kaWFuLCAyMywgNCk7CiAgICAgICAgcmV0dXJuIG9mZnNldCArIDQ7CiAgICAgIH0KICAgICAgQnVmZmVyMy5wcm90b3R5cGUud3JpdGVGbG9hdExFID0gZnVuY3Rpb24gd3JpdGVGbG9hdExFKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICAgICAgcmV0dXJuIHdyaXRlRmxvYXQodGhpcywgdmFsdWUsIG9mZnNldCwgdHJ1ZSwgbm9Bc3NlcnQpOwogICAgICB9OwogICAgICBCdWZmZXIzLnByb3RvdHlwZS53cml0ZUZsb2F0QkUgPSBmdW5jdGlvbiB3cml0ZUZsb2F0QkUodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgICAgICByZXR1cm4gd3JpdGVGbG9hdCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBmYWxzZSwgbm9Bc3NlcnQpOwogICAgICB9OwogICAgICBmdW5jdGlvbiB3cml0ZURvdWJsZShidWYsIHZhbHVlLCBvZmZzZXQsIGxpdHRsZUVuZGlhbiwgbm9Bc3NlcnQpIHsKICAgICAgICB2YWx1ZSA9ICt2YWx1ZTsKICAgICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgICAgaWYgKCFub0Fzc2VydCkgewogICAgICAgICAgY2hlY2tJRUVFNzU0KGJ1ZiwgdmFsdWUsIG9mZnNldCwgOCwgMTc5NzY5MzEzNDg2MjMxNTdlMjkyLCAtMTc5NzY5MzEzNDg2MjMxNTdlMjkyKTsKICAgICAgICB9CiAgICAgICAgaWVlZTc1NC53cml0ZShidWYsIHZhbHVlLCBvZmZzZXQsIGxpdHRsZUVuZGlhbiwgNTIsIDgpOwogICAgICAgIHJldHVybiBvZmZzZXQgKyA4OwogICAgICB9CiAgICAgIEJ1ZmZlcjMucHJvdG90eXBlLndyaXRlRG91YmxlTEUgPSBmdW5jdGlvbiB3cml0ZURvdWJsZUxFKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICAgICAgcmV0dXJuIHdyaXRlRG91YmxlKHRoaXMsIHZhbHVlLCBvZmZzZXQsIHRydWUsIG5vQXNzZXJ0KTsKICAgICAgfTsKICAgICAgQnVmZmVyMy5wcm90b3R5cGUud3JpdGVEb3VibGVCRSA9IGZ1bmN0aW9uIHdyaXRlRG91YmxlQkUodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgICAgICByZXR1cm4gd3JpdGVEb3VibGUodGhpcywgdmFsdWUsIG9mZnNldCwgZmFsc2UsIG5vQXNzZXJ0KTsKICAgICAgfTsKICAgICAgQnVmZmVyMy5wcm90b3R5cGUuY29weSA9IGZ1bmN0aW9uIGNvcHkodGFyZ2V0LCB0YXJnZXRTdGFydCwgc3RhcnQsIGVuZCkgewogICAgICAgIGlmICghQnVmZmVyMy5pc0J1ZmZlcih0YXJnZXQpKQogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiYXJndW1lbnQgc2hvdWxkIGJlIGEgQnVmZmVyIik7CiAgICAgICAgaWYgKCFzdGFydCkKICAgICAgICAgIHN0YXJ0ID0gMDsKICAgICAgICBpZiAoIWVuZCAmJiBlbmQgIT09IDApCiAgICAgICAgICBlbmQgPSB0aGlzLmxlbmd0aDsKICAgICAgICBpZiAodGFyZ2V0U3RhcnQgPj0gdGFyZ2V0Lmxlbmd0aCkKICAgICAgICAgIHRhcmdldFN0YXJ0ID0gdGFyZ2V0Lmxlbmd0aDsKICAgICAgICBpZiAoIXRhcmdldFN0YXJ0KQogICAgICAgICAgdGFyZ2V0U3RhcnQgPSAwOwogICAgICAgIGlmIChlbmQgPiAwICYmIGVuZCA8IHN0YXJ0KQogICAgICAgICAgZW5kID0gc3RhcnQ7CiAgICAgICAgaWYgKGVuZCA9PT0gc3RhcnQpCiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBpZiAodGFyZ2V0Lmxlbmd0aCA9PT0gMCB8fCB0aGlzLmxlbmd0aCA9PT0gMCkKICAgICAgICAgIHJldHVybiAwOwogICAgICAgIGlmICh0YXJnZXRTdGFydCA8IDApIHsKICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJ0YXJnZXRTdGFydCBvdXQgb2YgYm91bmRzIik7CiAgICAgICAgfQogICAgICAgIGlmIChzdGFydCA8IDAgfHwgc3RhcnQgPj0gdGhpcy5sZW5ndGgpCiAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiSW5kZXggb3V0IG9mIHJhbmdlIik7CiAgICAgICAgaWYgKGVuZCA8IDApCiAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigic291cmNlRW5kIG91dCBvZiBib3VuZHMiKTsKICAgICAgICBpZiAoZW5kID4gdGhpcy5sZW5ndGgpCiAgICAgICAgICBlbmQgPSB0aGlzLmxlbmd0aDsKICAgICAgICBpZiAodGFyZ2V0Lmxlbmd0aCAtIHRhcmdldFN0YXJ0IDwgZW5kIC0gc3RhcnQpIHsKICAgICAgICAgIGVuZCA9IHRhcmdldC5sZW5ndGggLSB0YXJnZXRTdGFydCArIHN0YXJ0OwogICAgICAgIH0KICAgICAgICBjb25zdCBsZW4gPSBlbmQgLSBzdGFydDsKICAgICAgICBpZiAodGhpcyA9PT0gdGFyZ2V0ICYmIHR5cGVvZiBVaW50OEFycmF5LnByb3RvdHlwZS5jb3B5V2l0aGluID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICB0aGlzLmNvcHlXaXRoaW4odGFyZ2V0U3RhcnQsIHN0YXJ0LCBlbmQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBVaW50OEFycmF5LnByb3RvdHlwZS5zZXQuY2FsbCh0YXJnZXQsIHRoaXMuc3ViYXJyYXkoc3RhcnQsIGVuZCksIHRhcmdldFN0YXJ0KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxlbjsKICAgICAgfTsKICAgICAgQnVmZmVyMy5wcm90b3R5cGUuZmlsbCA9IGZ1bmN0aW9uIGZpbGwodmFsLCBzdGFydCwgZW5kLCBlbmNvZGluZykgewogICAgICAgIGlmICh0eXBlb2YgdmFsID09PSAic3RyaW5nIikgewogICAgICAgICAgaWYgKHR5cGVvZiBzdGFydCA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgZW5jb2RpbmcgPSBzdGFydDsKICAgICAgICAgICAgc3RhcnQgPSAwOwogICAgICAgICAgICBlbmQgPSB0aGlzLmxlbmd0aDsKICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGVuZCA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgZW5jb2RpbmcgPSBlbmQ7CiAgICAgICAgICAgIGVuZCA9IHRoaXMubGVuZ3RoOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGVuY29kaW5nICE9PSB2b2lkIDAgJiYgdHlwZW9mIGVuY29kaW5nICE9PSAic3RyaW5nIikgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJlbmNvZGluZyBtdXN0IGJlIGEgc3RyaW5nIik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodHlwZW9mIGVuY29kaW5nID09PSAic3RyaW5nIiAmJiAhQnVmZmVyMy5pc0VuY29kaW5nKGVuY29kaW5nKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJVbmtub3duIGVuY29kaW5nOiAiICsgZW5jb2RpbmcpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHZhbC5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgY29uc3QgY29kZSA9IHZhbC5jaGFyQ29kZUF0KDApOwogICAgICAgICAgICBpZiAoZW5jb2RpbmcgPT09ICJ1dGY4IiAmJiBjb2RlIDwgMTI4IHx8IGVuY29kaW5nID09PSAibGF0aW4xIikgewogICAgICAgICAgICAgIHZhbCA9IGNvZGU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWwgPT09ICJudW1iZXIiKSB7CiAgICAgICAgICB2YWwgPSB2YWwgJiAyNTU7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsID09PSAiYm9vbGVhbiIpIHsKICAgICAgICAgIHZhbCA9IE51bWJlcih2YWwpOwogICAgICAgIH0KICAgICAgICBpZiAoc3RhcnQgPCAwIHx8IHRoaXMubGVuZ3RoIDwgc3RhcnQgfHwgdGhpcy5sZW5ndGggPCBlbmQpIHsKICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJPdXQgb2YgcmFuZ2UgaW5kZXgiKTsKICAgICAgICB9CiAgICAgICAgaWYgKGVuZCA8PSBzdGFydCkgewogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICAgIHN0YXJ0ID0gc3RhcnQgPj4+IDA7CiAgICAgICAgZW5kID0gZW5kID09PSB2b2lkIDAgPyB0aGlzLmxlbmd0aCA6IGVuZCA+Pj4gMDsKICAgICAgICBpZiAoIXZhbCkKICAgICAgICAgIHZhbCA9IDA7CiAgICAgICAgbGV0IGk7CiAgICAgICAgaWYgKHR5cGVvZiB2YWwgPT09ICJudW1iZXIiKSB7CiAgICAgICAgICBmb3IgKGkgPSBzdGFydDsgaSA8IGVuZDsgKytpKSB7CiAgICAgICAgICAgIHRoaXNbaV0gPSB2YWw7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGJ5dGVzID0gQnVmZmVyMy5pc0J1ZmZlcih2YWwpID8gdmFsIDogQnVmZmVyMy5mcm9tKHZhbCwgZW5jb2RpbmcpOwogICAgICAgICAgY29uc3QgbGVuID0gYnl0ZXMubGVuZ3RoOwogICAgICAgICAgaWYgKGxlbiA9PT0gMCkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGUgdmFsdWUgIicgKyB2YWwgKyAnIiBpcyBpbnZhbGlkIGZvciBhcmd1bWVudCAidmFsdWUiJyk7CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZW5kIC0gc3RhcnQ7ICsraSkgewogICAgICAgICAgICB0aGlzW2kgKyBzdGFydF0gPSBieXRlc1tpICUgbGVuXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH07CiAgICAgIHZhciBlcnJvcnMgPSB7fTsKICAgICAgZnVuY3Rpb24gRShzeW0sIGdldE1lc3NhZ2UsIEJhc2UpIHsKICAgICAgICBlcnJvcnNbc3ltXSA9IGNsYXNzIE5vZGVFcnJvciBleHRlbmRzIEJhc2UgewogICAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAibWVzc2FnZSIsIHsKICAgICAgICAgICAgICB2YWx1ZTogZ2V0TWVzc2FnZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpLAogICAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5uYW1lID0gYCR7dGhpcy5uYW1lfSBbJHtzeW19XWA7CiAgICAgICAgICAgIHRoaXMuc3RhY2s7CiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLm5hbWU7CiAgICAgICAgICB9CiAgICAgICAgICBnZXQgY29kZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHN5bTsKICAgICAgICAgIH0KICAgICAgICAgIHNldCBjb2RlKHZhbHVlKSB7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiY29kZSIsIHsKICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICB2YWx1ZSwKICAgICAgICAgICAgICB3cml0YWJsZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHRvU3RyaW5nKCkgewogICAgICAgICAgICByZXR1cm4gYCR7dGhpcy5uYW1lfSBbJHtzeW19XTogJHt0aGlzLm1lc3NhZ2V9YDsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CiAgICAgIEUoIkVSUl9CVUZGRVJfT1VUX09GX0JPVU5EUyIsIGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgICBpZiAobmFtZSkgewogICAgICAgICAgcmV0dXJuIGAke25hbWV9IGlzIG91dHNpZGUgb2YgYnVmZmVyIGJvdW5kc2A7CiAgICAgICAgfQogICAgICAgIHJldHVybiAiQXR0ZW1wdCB0byBhY2Nlc3MgbWVtb3J5IG91dHNpZGUgYnVmZmVyIGJvdW5kcyI7CiAgICAgIH0sIFJhbmdlRXJyb3IpOwogICAgICBFKCJFUlJfSU5WQUxJRF9BUkdfVFlQRSIsIGZ1bmN0aW9uKG5hbWUsIGFjdHVhbCkgewogICAgICAgIHJldHVybiBgVGhlICIke25hbWV9IiBhcmd1bWVudCBtdXN0IGJlIG9mIHR5cGUgbnVtYmVyLiBSZWNlaXZlZCB0eXBlICR7dHlwZW9mIGFjdHVhbH1gOwogICAgICB9LCBUeXBlRXJyb3IpOwogICAgICBFKCJFUlJfT1VUX09GX1JBTkdFIiwgZnVuY3Rpb24oc3RyLCByYW5nZSwgaW5wdXQpIHsKICAgICAgICBsZXQgbXNnID0gYFRoZSB2YWx1ZSBvZiAiJHtzdHJ9IiBpcyBvdXQgb2YgcmFuZ2UuYDsKICAgICAgICBsZXQgcmVjZWl2ZWQgPSBpbnB1dDsKICAgICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihpbnB1dCkgJiYgTWF0aC5hYnMoaW5wdXQpID4gMiAqKiAzMikgewogICAgICAgICAgcmVjZWl2ZWQgPSBhZGROdW1lcmljYWxTZXBhcmF0b3IoU3RyaW5nKGlucHV0KSk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgaW5wdXQgPT09ICJiaWdpbnQiKSB7CiAgICAgICAgICByZWNlaXZlZCA9IFN0cmluZyhpbnB1dCk7CiAgICAgICAgICBpZiAoaW5wdXQgPiBCaWdJbnQoMikgKiogQmlnSW50KDMyKSB8fCBpbnB1dCA8IC0oQmlnSW50KDIpICoqIEJpZ0ludCgzMikpKSB7CiAgICAgICAgICAgIHJlY2VpdmVkID0gYWRkTnVtZXJpY2FsU2VwYXJhdG9yKHJlY2VpdmVkKTsKICAgICAgICAgIH0KICAgICAgICAgIHJlY2VpdmVkICs9ICJuIjsKICAgICAgICB9CiAgICAgICAgbXNnICs9IGAgSXQgbXVzdCBiZSAke3JhbmdlfS4gUmVjZWl2ZWQgJHtyZWNlaXZlZH1gOwogICAgICAgIHJldHVybiBtc2c7CiAgICAgIH0sIFJhbmdlRXJyb3IpOwogICAgICBmdW5jdGlvbiBhZGROdW1lcmljYWxTZXBhcmF0b3IodmFsKSB7CiAgICAgICAgbGV0IHJlcyA9ICIiOwogICAgICAgIGxldCBpID0gdmFsLmxlbmd0aDsKICAgICAgICBjb25zdCBzdGFydCA9IHZhbFswXSA9PT0gIi0iID8gMSA6IDA7CiAgICAgICAgZm9yICg7IGkgPj0gc3RhcnQgKyA0OyBpIC09IDMpIHsKICAgICAgICAgIHJlcyA9IGBfJHt2YWwuc2xpY2UoaSAtIDMsIGkpfSR7cmVzfWA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBgJHt2YWwuc2xpY2UoMCwgaSl9JHtyZXN9YDsKICAgICAgfQogICAgICBmdW5jdGlvbiBjaGVja0JvdW5kcyhidWYsIG9mZnNldCwgYnl0ZUxlbmd0aDIpIHsKICAgICAgICB2YWxpZGF0ZU51bWJlcihvZmZzZXQsICJvZmZzZXQiKTsKICAgICAgICBpZiAoYnVmW29mZnNldF0gPT09IHZvaWQgMCB8fCBidWZbb2Zmc2V0ICsgYnl0ZUxlbmd0aDJdID09PSB2b2lkIDApIHsKICAgICAgICAgIGJvdW5kc0Vycm9yKG9mZnNldCwgYnVmLmxlbmd0aCAtIChieXRlTGVuZ3RoMiArIDEpKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gY2hlY2tJbnRCSSh2YWx1ZSwgbWluLCBtYXgsIGJ1Ziwgb2Zmc2V0LCBieXRlTGVuZ3RoMikgewogICAgICAgIGlmICh2YWx1ZSA+IG1heCB8fCB2YWx1ZSA8IG1pbikgewogICAgICAgICAgY29uc3QgbiA9IHR5cGVvZiBtaW4gPT09ICJiaWdpbnQiID8gIm4iIDogIiI7CiAgICAgICAgICBsZXQgcmFuZ2U7CiAgICAgICAgICBpZiAoYnl0ZUxlbmd0aDIgPiAzKSB7CiAgICAgICAgICAgIGlmIChtaW4gPT09IDAgfHwgbWluID09PSBCaWdJbnQoMCkpIHsKICAgICAgICAgICAgICByYW5nZSA9IGA+PSAwJHtufSBhbmQgPCAyJHtufSAqKiAkeyhieXRlTGVuZ3RoMiArIDEpICogOH0ke259YDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByYW5nZSA9IGA+PSAtKDIke259ICoqICR7KGJ5dGVMZW5ndGgyICsgMSkgKiA4IC0gMX0ke259KSBhbmQgPCAyICoqICR7KGJ5dGVMZW5ndGgyICsgMSkgKiA4IC0gMX0ke259YDsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmFuZ2UgPSBgPj0gJHttaW59JHtufSBhbmQgPD0gJHttYXh9JHtufWA7CiAgICAgICAgICB9CiAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLkVSUl9PVVRfT0ZfUkFOR0UoInZhbHVlIiwgcmFuZ2UsIHZhbHVlKTsKICAgICAgICB9CiAgICAgICAgY2hlY2tCb3VuZHMoYnVmLCBvZmZzZXQsIGJ5dGVMZW5ndGgyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiB2YWxpZGF0ZU51bWJlcih2YWx1ZSwgbmFtZSkgewogICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICJudW1iZXIiKSB7CiAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLkVSUl9JTlZBTElEX0FSR19UWVBFKG5hbWUsICJudW1iZXIiLCB2YWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGJvdW5kc0Vycm9yKHZhbHVlLCBsZW5ndGgsIHR5cGUpIHsKICAgICAgICBpZiAoTWF0aC5mbG9vcih2YWx1ZSkgIT09IHZhbHVlKSB7CiAgICAgICAgICB2YWxpZGF0ZU51bWJlcih2YWx1ZSwgdHlwZSk7CiAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLkVSUl9PVVRfT0ZfUkFOR0UodHlwZSB8fCAib2Zmc2V0IiwgImFuIGludGVnZXIiLCB2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIGlmIChsZW5ndGggPCAwKSB7CiAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLkVSUl9CVUZGRVJfT1VUX09GX0JPVU5EUygpOwogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLkVSUl9PVVRfT0ZfUkFOR0UodHlwZSB8fCAib2Zmc2V0IiwgYD49ICR7dHlwZSA/IDEgOiAwfSBhbmQgPD0gJHtsZW5ndGh9YCwgdmFsdWUpOwogICAgICB9CiAgICAgIHZhciBJTlZBTElEX0JBU0U2NF9SRSA9IC9bXisvMC05QS1aYS16LV9dL2c7CiAgICAgIGZ1bmN0aW9uIGJhc2U2NGNsZWFuKHN0cikgewogICAgICAgIHN0ciA9IHN0ci5zcGxpdCgiPSIpWzBdOwogICAgICAgIHN0ciA9IHN0ci50cmltKCkucmVwbGFjZShJTlZBTElEX0JBU0U2NF9SRSwgIiIpOwogICAgICAgIGlmIChzdHIubGVuZ3RoIDwgMikKICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICB3aGlsZSAoc3RyLmxlbmd0aCAlIDQgIT09IDApIHsKICAgICAgICAgIHN0ciA9IHN0ciArICI9IjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cjsKICAgICAgfQogICAgICBmdW5jdGlvbiB1dGY4VG9CeXRlcyhzdHJpbmcsIHVuaXRzKSB7CiAgICAgICAgdW5pdHMgPSB1bml0cyB8fCBJbmZpbml0eTsKICAgICAgICBsZXQgY29kZVBvaW50OwogICAgICAgIGNvbnN0IGxlbmd0aCA9IHN0cmluZy5sZW5ndGg7CiAgICAgICAgbGV0IGxlYWRTdXJyb2dhdGUgPSBudWxsOwogICAgICAgIGNvbnN0IGJ5dGVzID0gW107CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICAgICAgY29kZVBvaW50ID0gc3RyaW5nLmNoYXJDb2RlQXQoaSk7CiAgICAgICAgICBpZiAoY29kZVBvaW50ID4gNTUyOTUgJiYgY29kZVBvaW50IDwgNTczNDQpIHsKICAgICAgICAgICAgaWYgKCFsZWFkU3Vycm9nYXRlKSB7CiAgICAgICAgICAgICAgaWYgKGNvZGVQb2ludCA+IDU2MzE5KSB7CiAgICAgICAgICAgICAgICBpZiAoKHVuaXRzIC09IDMpID4gLTEpCiAgICAgICAgICAgICAgICAgIGJ5dGVzLnB1c2goMjM5LCAxOTEsIDE4OSk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGkgKyAxID09PSBsZW5ndGgpIHsKICAgICAgICAgICAgICAgIGlmICgodW5pdHMgLT0gMykgPiAtMSkKICAgICAgICAgICAgICAgICAgYnl0ZXMucHVzaCgyMzksIDE5MSwgMTg5KTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBsZWFkU3Vycm9nYXRlID0gY29kZVBvaW50OwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjb2RlUG9pbnQgPCA1NjMyMCkgewogICAgICAgICAgICAgIGlmICgodW5pdHMgLT0gMykgPiAtMSkKICAgICAgICAgICAgICAgIGJ5dGVzLnB1c2goMjM5LCAxOTEsIDE4OSk7CiAgICAgICAgICAgICAgbGVhZFN1cnJvZ2F0ZSA9IGNvZGVQb2ludDsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb2RlUG9pbnQgPSAobGVhZFN1cnJvZ2F0ZSAtIDU1Mjk2IDw8IDEwIHwgY29kZVBvaW50IC0gNTYzMjApICsgNjU1MzY7CiAgICAgICAgICB9IGVsc2UgaWYgKGxlYWRTdXJyb2dhdGUpIHsKICAgICAgICAgICAgaWYgKCh1bml0cyAtPSAzKSA+IC0xKQogICAgICAgICAgICAgIGJ5dGVzLnB1c2goMjM5LCAxOTEsIDE4OSk7CiAgICAgICAgICB9CiAgICAgICAgICBsZWFkU3Vycm9nYXRlID0gbnVsbDsKICAgICAgICAgIGlmIChjb2RlUG9pbnQgPCAxMjgpIHsKICAgICAgICAgICAgaWYgKCh1bml0cyAtPSAxKSA8IDApCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGJ5dGVzLnB1c2goY29kZVBvaW50KTsKICAgICAgICAgIH0gZWxzZSBpZiAoY29kZVBvaW50IDwgMjA0OCkgewogICAgICAgICAgICBpZiAoKHVuaXRzIC09IDIpIDwgMCkKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgYnl0ZXMucHVzaChjb2RlUG9pbnQgPj4gNiB8IDE5MiwgY29kZVBvaW50ICYgNjMgfCAxMjgpOwogICAgICAgICAgfSBlbHNlIGlmIChjb2RlUG9pbnQgPCA2NTUzNikgewogICAgICAgICAgICBpZiAoKHVuaXRzIC09IDMpIDwgMCkKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgYnl0ZXMucHVzaChjb2RlUG9pbnQgPj4gMTIgfCAyMjQsIGNvZGVQb2ludCA+PiA2ICYgNjMgfCAxMjgsIGNvZGVQb2ludCAmIDYzIHwgMTI4KTsKICAgICAgICAgIH0gZWxzZSBpZiAoY29kZVBvaW50IDwgMTExNDExMikgewogICAgICAgICAgICBpZiAoKHVuaXRzIC09IDQpIDwgMCkKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgYnl0ZXMucHVzaChjb2RlUG9pbnQgPj4gMTggfCAyNDAsIGNvZGVQb2ludCA+PiAxMiAmIDYzIHwgMTI4LCBjb2RlUG9pbnQgPj4gNiAmIDYzIHwgMTI4LCBjb2RlUG9pbnQgJiA2MyB8IDEyOCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgY29kZSBwb2ludCIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gYnl0ZXM7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYXNjaWlUb0J5dGVzKHN0cikgewogICAgICAgIGNvbnN0IGJ5dGVBcnJheSA9IFtdOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICBieXRlQXJyYXkucHVzaChzdHIuY2hhckNvZGVBdChpKSAmIDI1NSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBieXRlQXJyYXk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gdXRmMTZsZVRvQnl0ZXMoc3RyLCB1bml0cykgewogICAgICAgIGxldCBjLCBoaSwgbG87CiAgICAgICAgY29uc3QgYnl0ZUFycmF5ID0gW107CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyArK2kpIHsKICAgICAgICAgIGlmICgodW5pdHMgLT0gMikgPCAwKQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGMgPSBzdHIuY2hhckNvZGVBdChpKTsKICAgICAgICAgIGhpID0gYyA+PiA4OwogICAgICAgICAgbG8gPSBjICUgMjU2OwogICAgICAgICAgYnl0ZUFycmF5LnB1c2gobG8pOwogICAgICAgICAgYnl0ZUFycmF5LnB1c2goaGkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYnl0ZUFycmF5OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGJhc2U2NFRvQnl0ZXMoc3RyKSB7CiAgICAgICAgcmV0dXJuIGJhc2U2NC50b0J5dGVBcnJheShiYXNlNjRjbGVhbihzdHIpKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBibGl0QnVmZmVyKHNyYywgZHN0LCBvZmZzZXQsIGxlbmd0aCkgewogICAgICAgIGxldCBpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICAgICAgaWYgKGkgKyBvZmZzZXQgPj0gZHN0Lmxlbmd0aCB8fCBpID49IHNyYy5sZW5ndGgpCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZHN0W2kgKyBvZmZzZXRdID0gc3JjW2ldOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaTsKICAgICAgfQogICAgICBmdW5jdGlvbiBpc0luc3RhbmNlKG9iaiwgdHlwZSkgewogICAgICAgIHJldHVybiBvYmogaW5zdGFuY2VvZiB0eXBlIHx8IG9iaiAhPSBudWxsICYmIG9iai5jb25zdHJ1Y3RvciAhPSBudWxsICYmIG9iai5jb25zdHJ1Y3Rvci5uYW1lICE9IG51bGwgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgPT09IHR5cGUubmFtZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBudW1iZXJJc05hTihvYmopIHsKICAgICAgICByZXR1cm4gb2JqICE9PSBvYmo7CiAgICAgIH0KICAgICAgdmFyIGhleFNsaWNlTG9va3VwVGFibGUgPSBmdW5jdGlvbigpIHsKICAgICAgICBjb25zdCBhbHBoYWJldCA9ICIwMTIzNDU2Nzg5YWJjZGVmIjsKICAgICAgICBjb25zdCB0YWJsZSA9IG5ldyBBcnJheSgyNTYpOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTY7ICsraSkgewogICAgICAgICAgY29uc3QgaTE2ID0gaSAqIDE2OwogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxNjsgKytqKSB7CiAgICAgICAgICAgIHRhYmxlW2kxNiArIGpdID0gYWxwaGFiZXRbaV0gKyBhbHBoYWJldFtqXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRhYmxlOwogICAgICB9KCk7CiAgICAgIGZ1bmN0aW9uIGRlZmluZUJpZ0ludE1ldGhvZChmbikgewogICAgICAgIHJldHVybiB0eXBlb2YgQmlnSW50ID09PSAidW5kZWZpbmVkIiA/IEJ1ZmZlckJpZ0ludE5vdERlZmluZWQgOiBmbjsKICAgICAgfQogICAgICBmdW5jdGlvbiBCdWZmZXJCaWdJbnROb3REZWZpbmVkKCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiQmlnSW50IG5vdCBzdXBwb3J0ZWQiKTsKICAgICAgfQogICAgfQogIH0pOwoKICAvLyBzcmMvYWxpYXMvYnVmZmVyLXNoaW0uanMKICB2YXIgaW1wb3J0X2J1ZmZlcjsKICB2YXIgaW5pdF9idWZmZXJfc2hpbSA9IF9fZXNtKHsKICAgICJzcmMvYWxpYXMvYnVmZmVyLXNoaW0uanMiKCkgewogICAgICBpbXBvcnRfYnVmZmVyID0gX190b01vZHVsZShyZXF1aXJlX2J1ZmZlcigpKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2lzLW9ic2VydmFibGUvaW5kZXguanMKICB2YXIgcmVxdWlyZV9pc19vYnNlcnZhYmxlID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2lzLW9ic2VydmFibGUvaW5kZXguanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSAodmFsdWUpID0+IHsKICAgICAgICBpZiAoIXZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlb2YgU3ltYm9sLm9ic2VydmFibGUgPT09ICJzeW1ib2wiICYmIHR5cGVvZiB2YWx1ZVtTeW1ib2wub2JzZXJ2YWJsZV0gPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgIHJldHVybiB2YWx1ZSA9PT0gdmFsdWVbU3ltYm9sLm9ic2VydmFibGVdKCk7CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlb2YgdmFsdWVbIkBAb2JzZXJ2YWJsZSJdID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICByZXR1cm4gdmFsdWUgPT09IHZhbHVlWyJAQG9ic2VydmFibGUiXSgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3Qvc2VyaWFsaXplcnMuanMKICB2YXIgcmVxdWlyZV9zZXJpYWxpemVycyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3Qvc2VyaWFsaXplcnMuanMiKGV4cG9ydHMpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgICAgIGV4cG9ydHMuRGVmYXVsdFNlcmlhbGl6ZXIgPSBleHBvcnRzLmV4dGVuZFNlcmlhbGl6ZXIgPSB2b2lkIDA7CiAgICAgIGZ1bmN0aW9uIGV4dGVuZFNlcmlhbGl6ZXIoZXh0ZW5kLCBpbXBsZW1lbnRhdGlvbikgewogICAgICAgIGNvbnN0IGZhbGxiYWNrRGVzZXJpYWxpemVyID0gZXh0ZW5kLmRlc2VyaWFsaXplLmJpbmQoZXh0ZW5kKTsKICAgICAgICBjb25zdCBmYWxsYmFja1NlcmlhbGl6ZXIgPSBleHRlbmQuc2VyaWFsaXplLmJpbmQoZXh0ZW5kKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgZGVzZXJpYWxpemUobWVzc2FnZSkgewogICAgICAgICAgICByZXR1cm4gaW1wbGVtZW50YXRpb24uZGVzZXJpYWxpemUobWVzc2FnZSwgZmFsbGJhY2tEZXNlcmlhbGl6ZXIpOwogICAgICAgICAgfSwKICAgICAgICAgIHNlcmlhbGl6ZShpbnB1dCkgewogICAgICAgICAgICByZXR1cm4gaW1wbGVtZW50YXRpb24uc2VyaWFsaXplKGlucHV0LCBmYWxsYmFja1NlcmlhbGl6ZXIpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0KICAgICAgZXhwb3J0cy5leHRlbmRTZXJpYWxpemVyID0gZXh0ZW5kU2VyaWFsaXplcjsKICAgICAgdmFyIERlZmF1bHRFcnJvclNlcmlhbGl6ZXIgPSB7CiAgICAgICAgZGVzZXJpYWxpemUobWVzc2FnZSkgewogICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oRXJyb3IobWVzc2FnZS5tZXNzYWdlKSwgewogICAgICAgICAgICBuYW1lOiBtZXNzYWdlLm5hbWUsCiAgICAgICAgICAgIHN0YWNrOiBtZXNzYWdlLnN0YWNrCiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIHNlcmlhbGl6ZShlcnJvcikgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgX19lcnJvcl9tYXJrZXI6ICIkJGVycm9yIiwKICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSwKICAgICAgICAgICAgbmFtZTogZXJyb3IubmFtZSwKICAgICAgICAgICAgc3RhY2s6IGVycm9yLnN0YWNrCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfTsKICAgICAgdmFyIGlzU2VyaWFsaXplZEVycm9yID0gKHRoaW5nKSA9PiB0aGluZyAmJiB0eXBlb2YgdGhpbmcgPT09ICJvYmplY3QiICYmICJfX2Vycm9yX21hcmtlciIgaW4gdGhpbmcgJiYgdGhpbmcuX19lcnJvcl9tYXJrZXIgPT09ICIkJGVycm9yIjsKICAgICAgZXhwb3J0cy5EZWZhdWx0U2VyaWFsaXplciA9IHsKICAgICAgICBkZXNlcmlhbGl6ZShtZXNzYWdlKSB7CiAgICAgICAgICBpZiAoaXNTZXJpYWxpemVkRXJyb3IobWVzc2FnZSkpIHsKICAgICAgICAgICAgcmV0dXJuIERlZmF1bHRFcnJvclNlcmlhbGl6ZXIuZGVzZXJpYWxpemUobWVzc2FnZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gbWVzc2FnZTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHNlcmlhbGl6ZShpbnB1dCkgewogICAgICAgICAgaWYgKGlucHV0IGluc3RhbmNlb2YgRXJyb3IpIHsKICAgICAgICAgICAgcmV0dXJuIERlZmF1bHRFcnJvclNlcmlhbGl6ZXIuc2VyaWFsaXplKGlucHV0KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBpbnB1dDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QvY29tbW9uLmpzCiAgdmFyIHJlcXVpcmVfY29tbW9uID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC9jb21tb24uanMiKGV4cG9ydHMpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgICAgIGV4cG9ydHMuc2VyaWFsaXplID0gZXhwb3J0cy5kZXNlcmlhbGl6ZSA9IGV4cG9ydHMucmVnaXN0ZXJTZXJpYWxpemVyID0gdm9pZCAwOwogICAgICB2YXIgc2VyaWFsaXplcnNfMSA9IHJlcXVpcmVfc2VyaWFsaXplcnMoKTsKICAgICAgdmFyIHJlZ2lzdGVyZWRTZXJpYWxpemVyID0gc2VyaWFsaXplcnNfMS5EZWZhdWx0U2VyaWFsaXplcjsKICAgICAgZnVuY3Rpb24gcmVnaXN0ZXJTZXJpYWxpemVyMihzZXJpYWxpemVyKSB7CiAgICAgICAgcmVnaXN0ZXJlZFNlcmlhbGl6ZXIgPSBzZXJpYWxpemVyc18xLmV4dGVuZFNlcmlhbGl6ZXIocmVnaXN0ZXJlZFNlcmlhbGl6ZXIsIHNlcmlhbGl6ZXIpOwogICAgICB9CiAgICAgIGV4cG9ydHMucmVnaXN0ZXJTZXJpYWxpemVyID0gcmVnaXN0ZXJTZXJpYWxpemVyMjsKICAgICAgZnVuY3Rpb24gZGVzZXJpYWxpemUobWVzc2FnZSkgewogICAgICAgIHJldHVybiByZWdpc3RlcmVkU2VyaWFsaXplci5kZXNlcmlhbGl6ZShtZXNzYWdlKTsKICAgICAgfQogICAgICBleHBvcnRzLmRlc2VyaWFsaXplID0gZGVzZXJpYWxpemU7CiAgICAgIGZ1bmN0aW9uIHNlcmlhbGl6ZShpbnB1dCkgewogICAgICAgIHJldHVybiByZWdpc3RlcmVkU2VyaWFsaXplci5zZXJpYWxpemUoaW5wdXQpOwogICAgICB9CiAgICAgIGV4cG9ydHMuc2VyaWFsaXplID0gc2VyaWFsaXplOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0L3N5bWJvbHMuanMKICB2YXIgcmVxdWlyZV9zeW1ib2xzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC9zeW1ib2xzLmpzIihleHBvcnRzKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgICBleHBvcnRzLiR3b3JrZXIgPSBleHBvcnRzLiR0cmFuc2ZlcmFibGUgPSBleHBvcnRzLiR0ZXJtaW5hdGUgPSBleHBvcnRzLiRldmVudHMgPSBleHBvcnRzLiRlcnJvcnMgPSB2b2lkIDA7CiAgICAgIGV4cG9ydHMuJGVycm9ycyA9IFN5bWJvbCgidGhyZWFkLmVycm9ycyIpOwogICAgICBleHBvcnRzLiRldmVudHMgPSBTeW1ib2woInRocmVhZC5ldmVudHMiKTsKICAgICAgZXhwb3J0cy4kdGVybWluYXRlID0gU3ltYm9sKCJ0aHJlYWQudGVybWluYXRlIik7CiAgICAgIGV4cG9ydHMuJHRyYW5zZmVyYWJsZSA9IFN5bWJvbCgidGhyZWFkLnRyYW5zZmVyYWJsZSIpOwogICAgICBleHBvcnRzLiR3b3JrZXIgPSBTeW1ib2woInRocmVhZC53b3JrZXIiKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC90cmFuc2ZlcmFibGUuanMKICB2YXIgcmVxdWlyZV90cmFuc2ZlcmFibGUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0L3RyYW5zZmVyYWJsZS5qcyIoZXhwb3J0cykgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICAgICAgZXhwb3J0cy5UcmFuc2ZlciA9IGV4cG9ydHMuaXNUcmFuc2ZlckRlc2NyaXB0b3IgPSB2b2lkIDA7CiAgICAgIHZhciBzeW1ib2xzXzEgPSByZXF1aXJlX3N5bWJvbHMoKTsKICAgICAgZnVuY3Rpb24gaXNUcmFuc2ZlcmFibGUodGhpbmcpIHsKICAgICAgICBpZiAoIXRoaW5nIHx8IHR5cGVvZiB0aGluZyAhPT0gIm9iamVjdCIpCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gaXNUcmFuc2ZlckRlc2NyaXB0b3IodGhpbmcpIHsKICAgICAgICByZXR1cm4gdGhpbmcgJiYgdHlwZW9mIHRoaW5nID09PSAib2JqZWN0IiAmJiB0aGluZ1tzeW1ib2xzXzEuJHRyYW5zZmVyYWJsZV07CiAgICAgIH0KICAgICAgZXhwb3J0cy5pc1RyYW5zZmVyRGVzY3JpcHRvciA9IGlzVHJhbnNmZXJEZXNjcmlwdG9yOwogICAgICBmdW5jdGlvbiBUcmFuc2ZlcjIocGF5bG9hZCwgdHJhbnNmZXJhYmxlcykgewogICAgICAgIGlmICghdHJhbnNmZXJhYmxlcykgewogICAgICAgICAgaWYgKCFpc1RyYW5zZmVyYWJsZShwYXlsb2FkKSkKICAgICAgICAgICAgdGhyb3cgRXJyb3IoKTsKICAgICAgICAgIHRyYW5zZmVyYWJsZXMgPSBbcGF5bG9hZF07CiAgICAgICAgfQogICAgICAgIHJldHVybiB7CiAgICAgICAgICBbc3ltYm9sc18xLiR0cmFuc2ZlcmFibGVdOiB0cnVlLAogICAgICAgICAgc2VuZDogcGF5bG9hZCwKICAgICAgICAgIHRyYW5zZmVyYWJsZXMKICAgICAgICB9OwogICAgICB9CiAgICAgIGV4cG9ydHMuVHJhbnNmZXIgPSBUcmFuc2ZlcjI7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QvdHlwZXMvbWVzc2FnZXMuanMKICB2YXIgcmVxdWlyZV9tZXNzYWdlcyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3QvdHlwZXMvbWVzc2FnZXMuanMiKGV4cG9ydHMpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgICAgIGV4cG9ydHMuV29ya2VyTWVzc2FnZVR5cGUgPSBleHBvcnRzLk1hc3Rlck1lc3NhZ2VUeXBlID0gdm9pZCAwOwogICAgICB2YXIgTWFzdGVyTWVzc2FnZVR5cGU7CiAgICAgIChmdW5jdGlvbihNYXN0ZXJNZXNzYWdlVHlwZTIpIHsKICAgICAgICBNYXN0ZXJNZXNzYWdlVHlwZTJbImNhbmNlbCJdID0gImNhbmNlbCI7CiAgICAgICAgTWFzdGVyTWVzc2FnZVR5cGUyWyJydW4iXSA9ICJydW4iOwogICAgICB9KShNYXN0ZXJNZXNzYWdlVHlwZSA9IGV4cG9ydHMuTWFzdGVyTWVzc2FnZVR5cGUgfHwgKGV4cG9ydHMuTWFzdGVyTWVzc2FnZVR5cGUgPSB7fSkpOwogICAgICB2YXIgV29ya2VyTWVzc2FnZVR5cGU7CiAgICAgIChmdW5jdGlvbihXb3JrZXJNZXNzYWdlVHlwZTIpIHsKICAgICAgICBXb3JrZXJNZXNzYWdlVHlwZTJbImVycm9yIl0gPSAiZXJyb3IiOwogICAgICAgIFdvcmtlck1lc3NhZ2VUeXBlMlsiaW5pdCJdID0gImluaXQiOwogICAgICAgIFdvcmtlck1lc3NhZ2VUeXBlMlsicmVzdWx0Il0gPSAicmVzdWx0IjsKICAgICAgICBXb3JrZXJNZXNzYWdlVHlwZTJbInJ1bm5pbmciXSA9ICJydW5uaW5nIjsKICAgICAgICBXb3JrZXJNZXNzYWdlVHlwZTJbInVuY2F1Z2h0RXJyb3IiXSA9ICJ1bmNhdWdodEVycm9yIjsKICAgICAgfSkoV29ya2VyTWVzc2FnZVR5cGUgPSBleHBvcnRzLldvcmtlck1lc3NhZ2VUeXBlIHx8IChleHBvcnRzLldvcmtlck1lc3NhZ2VUeXBlID0ge30pKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL3RocmVhZHMvZGlzdC93b3JrZXIvaW1wbGVtZW50YXRpb24uYnJvd3Nlci5qcwogIHZhciByZXF1aXJlX2ltcGxlbWVudGF0aW9uX2Jyb3dzZXIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0L3dvcmtlci9pbXBsZW1lbnRhdGlvbi5icm93c2VyLmpzIihleHBvcnRzKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgICB2YXIgaXNXb3JrZXJSdW50aW1lID0gZnVuY3Rpb24gaXNXb3JrZXJSdW50aW1lMigpIHsKICAgICAgICBjb25zdCBpc1dpbmRvd0NvbnRleHQgPSB0eXBlb2Ygc2VsZiAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIFdpbmRvdyAhPT0gInVuZGVmaW5lZCIgJiYgc2VsZiBpbnN0YW5jZW9mIFdpbmRvdzsKICAgICAgICByZXR1cm4gdHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiICYmIHNlbGYucG9zdE1lc3NhZ2UgJiYgIWlzV2luZG93Q29udGV4dCA/IHRydWUgOiBmYWxzZTsKICAgICAgfTsKICAgICAgdmFyIHBvc3RNZXNzYWdlVG9NYXN0ZXIgPSBmdW5jdGlvbiBwb3N0TWVzc2FnZVRvTWFzdGVyMihkYXRhLCB0cmFuc2Zlckxpc3QpIHsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKGRhdGEsIHRyYW5zZmVyTGlzdCk7CiAgICAgIH07CiAgICAgIHZhciBzdWJzY3JpYmVUb01hc3Rlck1lc3NhZ2VzID0gZnVuY3Rpb24gc3Vic2NyaWJlVG9NYXN0ZXJNZXNzYWdlczIob25NZXNzYWdlKSB7CiAgICAgICAgY29uc3QgbWVzc2FnZUhhbmRsZXIgPSAobWVzc2FnZUV2ZW50KSA9PiB7CiAgICAgICAgICBvbk1lc3NhZ2UobWVzc2FnZUV2ZW50LmRhdGEpOwogICAgICAgIH07CiAgICAgICAgY29uc3QgdW5zdWJzY3JpYmUgPSAoKSA9PiB7CiAgICAgICAgICBzZWxmLnJlbW92ZUV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBtZXNzYWdlSGFuZGxlcik7CiAgICAgICAgfTsKICAgICAgICBzZWxmLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBtZXNzYWdlSGFuZGxlcik7CiAgICAgICAgcmV0dXJuIHVuc3Vic2NyaWJlOwogICAgICB9OwogICAgICBleHBvcnRzLmRlZmF1bHQgPSB7CiAgICAgICAgaXNXb3JrZXJSdW50aW1lLAogICAgICAgIHBvc3RNZXNzYWdlVG9NYXN0ZXIsCiAgICAgICAgc3Vic2NyaWJlVG9NYXN0ZXJNZXNzYWdlcwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvdGhyZWFkcy9kaXN0L3dvcmtlci9pbmRleC5qcwogIHZhciByZXF1aXJlX3dvcmtlciA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy90aHJlYWRzL2Rpc3Qvd29ya2VyL2luZGV4LmpzIihleHBvcnRzKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgX19hd2FpdGVyID0gZXhwb3J0cyAmJiBleHBvcnRzLl9fYXdhaXRlciB8fCBmdW5jdGlvbih0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHsKICAgICAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgewogICAgICAgICAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24ocmVzb2x2ZSkgewogICAgICAgICAgICByZXNvbHZlKHZhbHVlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgcmVqZWN0KGUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHN0ZXAoZ2VuZXJhdG9yWyJ0aHJvdyJdKHZhbHVlKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7CiAgICAgICAgICAgIHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOwogICAgICAgICAgfQogICAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpOwogICAgICAgIH0pOwogICAgICB9OwogICAgICB2YXIgX19pbXBvcnREZWZhdWx0ID0gZXhwb3J0cyAmJiBleHBvcnRzLl9faW1wb3J0RGVmYXVsdCB8fCBmdW5jdGlvbihtb2QpIHsKICAgICAgICByZXR1cm4gbW9kICYmIG1vZC5fX2VzTW9kdWxlID8gbW9kIDogeyAiZGVmYXVsdCI6IG1vZCB9OwogICAgICB9OwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgICBleHBvcnRzLmV4cG9zZSA9IGV4cG9ydHMuaXNXb3JrZXJSdW50aW1lID0gZXhwb3J0cy5UcmFuc2ZlciA9IGV4cG9ydHMucmVnaXN0ZXJTZXJpYWxpemVyID0gdm9pZCAwOwogICAgICB2YXIgaXNfb2JzZXJ2YWJsZV8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmVfaXNfb2JzZXJ2YWJsZSgpKTsKICAgICAgdmFyIGNvbW1vbl8xID0gcmVxdWlyZV9jb21tb24oKTsKICAgICAgdmFyIHRyYW5zZmVyYWJsZV8xID0gcmVxdWlyZV90cmFuc2ZlcmFibGUoKTsKICAgICAgdmFyIG1lc3NhZ2VzXzEgPSByZXF1aXJlX21lc3NhZ2VzKCk7CiAgICAgIHZhciBpbXBsZW1lbnRhdGlvbl8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmVfaW1wbGVtZW50YXRpb25fYnJvd3NlcigpKTsKICAgICAgdmFyIGNvbW1vbl8yID0gcmVxdWlyZV9jb21tb24oKTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJyZWdpc3RlclNlcmlhbGl6ZXIiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGNvbW1vbl8yLnJlZ2lzdGVyU2VyaWFsaXplcjsKICAgICAgfSB9KTsKICAgICAgdmFyIHRyYW5zZmVyYWJsZV8yID0gcmVxdWlyZV90cmFuc2ZlcmFibGUoKTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJUcmFuc2ZlciIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdHJhbnNmZXJhYmxlXzIuVHJhbnNmZXI7CiAgICAgIH0gfSk7CiAgICAgIGV4cG9ydHMuaXNXb3JrZXJSdW50aW1lID0gaW1wbGVtZW50YXRpb25fMS5kZWZhdWx0LmlzV29ya2VyUnVudGltZTsKICAgICAgdmFyIGV4cG9zZUNhbGxlZCA9IGZhbHNlOwogICAgICB2YXIgYWN0aXZlU3Vic2NyaXB0aW9ucyA9IG5ldyBNYXAoKTsKICAgICAgdmFyIGlzTWFzdGVySm9iQ2FuY2VsTWVzc2FnZSA9ICh0aGluZykgPT4gdGhpbmcgJiYgdGhpbmcudHlwZSA9PT0gbWVzc2FnZXNfMS5NYXN0ZXJNZXNzYWdlVHlwZS5jYW5jZWw7CiAgICAgIHZhciBpc01hc3RlckpvYlJ1bk1lc3NhZ2UgPSAodGhpbmcpID0+IHRoaW5nICYmIHRoaW5nLnR5cGUgPT09IG1lc3NhZ2VzXzEuTWFzdGVyTWVzc2FnZVR5cGUucnVuOwogICAgICB2YXIgaXNPYnNlcnZhYmxlID0gKHRoaW5nKSA9PiBpc19vYnNlcnZhYmxlXzEuZGVmYXVsdCh0aGluZykgfHwgaXNaZW5PYnNlcnZhYmxlKHRoaW5nKTsKICAgICAgZnVuY3Rpb24gaXNaZW5PYnNlcnZhYmxlKHRoaW5nKSB7CiAgICAgICAgcmV0dXJuIHRoaW5nICYmIHR5cGVvZiB0aGluZyA9PT0gIm9iamVjdCIgJiYgdHlwZW9mIHRoaW5nLnN1YnNjcmliZSA9PT0gImZ1bmN0aW9uIjsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWNvbnN0cnVjdFRyYW5zZmVyKHRoaW5nKSB7CiAgICAgICAgcmV0dXJuIHRyYW5zZmVyYWJsZV8xLmlzVHJhbnNmZXJEZXNjcmlwdG9yKHRoaW5nKSA/IHsgcGF5bG9hZDogdGhpbmcuc2VuZCwgdHJhbnNmZXJhYmxlczogdGhpbmcudHJhbnNmZXJhYmxlcyB9IDogeyBwYXlsb2FkOiB0aGluZywgdHJhbnNmZXJhYmxlczogdm9pZCAwIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcG9zdEZ1bmN0aW9uSW5pdE1lc3NhZ2UoKSB7CiAgICAgICAgY29uc3QgaW5pdE1lc3NhZ2UgPSB7CiAgICAgICAgICB0eXBlOiBtZXNzYWdlc18xLldvcmtlck1lc3NhZ2VUeXBlLmluaXQsCiAgICAgICAgICBleHBvc2VkOiB7CiAgICAgICAgICAgIHR5cGU6ICJmdW5jdGlvbiIKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGltcGxlbWVudGF0aW9uXzEuZGVmYXVsdC5wb3N0TWVzc2FnZVRvTWFzdGVyKGluaXRNZXNzYWdlKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBwb3N0TW9kdWxlSW5pdE1lc3NhZ2UobWV0aG9kTmFtZXMpIHsKICAgICAgICBjb25zdCBpbml0TWVzc2FnZSA9IHsKICAgICAgICAgIHR5cGU6IG1lc3NhZ2VzXzEuV29ya2VyTWVzc2FnZVR5cGUuaW5pdCwKICAgICAgICAgIGV4cG9zZWQ6IHsKICAgICAgICAgICAgdHlwZTogIm1vZHVsZSIsCiAgICAgICAgICAgIG1ldGhvZHM6IG1ldGhvZE5hbWVzCiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBpbXBsZW1lbnRhdGlvbl8xLmRlZmF1bHQucG9zdE1lc3NhZ2VUb01hc3Rlcihpbml0TWVzc2FnZSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcG9zdEpvYkVycm9yTWVzc2FnZSh1aWQsIHJhd0Vycm9yKSB7CiAgICAgICAgY29uc3QgeyBwYXlsb2FkOiBlcnJvciwgdHJhbnNmZXJhYmxlcyB9ID0gZGVjb25zdHJ1Y3RUcmFuc2ZlcihyYXdFcnJvcik7CiAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gewogICAgICAgICAgdHlwZTogbWVzc2FnZXNfMS5Xb3JrZXJNZXNzYWdlVHlwZS5lcnJvciwKICAgICAgICAgIHVpZCwKICAgICAgICAgIGVycm9yOiBjb21tb25fMS5zZXJpYWxpemUoZXJyb3IpCiAgICAgICAgfTsKICAgICAgICBpbXBsZW1lbnRhdGlvbl8xLmRlZmF1bHQucG9zdE1lc3NhZ2VUb01hc3RlcihlcnJvck1lc3NhZ2UsIHRyYW5zZmVyYWJsZXMpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHBvc3RKb2JSZXN1bHRNZXNzYWdlKHVpZCwgY29tcGxldGVkLCByZXN1bHRWYWx1ZSkgewogICAgICAgIGNvbnN0IHsgcGF5bG9hZCwgdHJhbnNmZXJhYmxlcyB9ID0gZGVjb25zdHJ1Y3RUcmFuc2ZlcihyZXN1bHRWYWx1ZSk7CiAgICAgICAgY29uc3QgcmVzdWx0TWVzc2FnZSA9IHsKICAgICAgICAgIHR5cGU6IG1lc3NhZ2VzXzEuV29ya2VyTWVzc2FnZVR5cGUucmVzdWx0LAogICAgICAgICAgdWlkLAogICAgICAgICAgY29tcGxldGU6IGNvbXBsZXRlZCA/IHRydWUgOiB2b2lkIDAsCiAgICAgICAgICBwYXlsb2FkCiAgICAgICAgfTsKICAgICAgICBpbXBsZW1lbnRhdGlvbl8xLmRlZmF1bHQucG9zdE1lc3NhZ2VUb01hc3RlcihyZXN1bHRNZXNzYWdlLCB0cmFuc2ZlcmFibGVzKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBwb3N0Sm9iU3RhcnRNZXNzYWdlKHVpZCwgcmVzdWx0VHlwZSkgewogICAgICAgIGNvbnN0IHN0YXJ0TWVzc2FnZSA9IHsKICAgICAgICAgIHR5cGU6IG1lc3NhZ2VzXzEuV29ya2VyTWVzc2FnZVR5cGUucnVubmluZywKICAgICAgICAgIHVpZCwKICAgICAgICAgIHJlc3VsdFR5cGUKICAgICAgICB9OwogICAgICAgIGltcGxlbWVudGF0aW9uXzEuZGVmYXVsdC5wb3N0TWVzc2FnZVRvTWFzdGVyKHN0YXJ0TWVzc2FnZSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcG9zdFVuY2F1Z2h0RXJyb3JNZXNzYWdlKGVycm9yKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IHsKICAgICAgICAgICAgdHlwZTogbWVzc2FnZXNfMS5Xb3JrZXJNZXNzYWdlVHlwZS51bmNhdWdodEVycm9yLAogICAgICAgICAgICBlcnJvcjogY29tbW9uXzEuc2VyaWFsaXplKGVycm9yKQogICAgICAgICAgfTsKICAgICAgICAgIGltcGxlbWVudGF0aW9uXzEuZGVmYXVsdC5wb3N0TWVzc2FnZVRvTWFzdGVyKGVycm9yTWVzc2FnZSk7CiAgICAgICAgfSBjYXRjaCAoc3ViRXJyb3IpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIk5vdCByZXBvcnRpbmcgdW5jYXVnaHQgZXJyb3IgYmFjayB0byBtYXN0ZXIgdGhyZWFkIGFzIGl0IG9jY3VyZWQgd2hpbGUgcmVwb3J0aW5nIGFuIHVuY2F1Z2h0IGVycm9yIGFscmVhZHkuXG5MYXRlc3QgZXJyb3I6Iiwgc3ViRXJyb3IsICJcbk9yaWdpbmFsIGVycm9yOiIsIGVycm9yKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcnVuRnVuY3Rpb24oam9iVUlELCBmbiwgYXJncykgewogICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7CiAgICAgICAgICBsZXQgc3luY1Jlc3VsdDsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN5bmNSZXN1bHQgPSBmbiguLi5hcmdzKTsKICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIHJldHVybiBwb3N0Sm9iRXJyb3JNZXNzYWdlKGpvYlVJRCwgZXJyb3IpOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgcmVzdWx0VHlwZSA9IGlzT2JzZXJ2YWJsZShzeW5jUmVzdWx0KSA/ICJvYnNlcnZhYmxlIiA6ICJwcm9taXNlIjsKICAgICAgICAgIHBvc3RKb2JTdGFydE1lc3NhZ2Uoam9iVUlELCByZXN1bHRUeXBlKTsKICAgICAgICAgIGlmIChpc09ic2VydmFibGUoc3luY1Jlc3VsdCkpIHsKICAgICAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gc3luY1Jlc3VsdC5zdWJzY3JpYmUoKHZhbHVlKSA9PiBwb3N0Sm9iUmVzdWx0TWVzc2FnZShqb2JVSUQsIGZhbHNlLCBjb21tb25fMS5zZXJpYWxpemUodmFsdWUpKSwgKGVycm9yKSA9PiB7CiAgICAgICAgICAgICAgcG9zdEpvYkVycm9yTWVzc2FnZShqb2JVSUQsIGNvbW1vbl8xLnNlcmlhbGl6ZShlcnJvcikpOwogICAgICAgICAgICAgIGFjdGl2ZVN1YnNjcmlwdGlvbnMuZGVsZXRlKGpvYlVJRCk7CiAgICAgICAgICAgIH0sICgpID0+IHsKICAgICAgICAgICAgICBwb3N0Sm9iUmVzdWx0TWVzc2FnZShqb2JVSUQsIHRydWUpOwogICAgICAgICAgICAgIGFjdGl2ZVN1YnNjcmlwdGlvbnMuZGVsZXRlKGpvYlVJRCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhY3RpdmVTdWJzY3JpcHRpb25zLnNldChqb2JVSUQsIHN1YnNjcmlwdGlvbik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHlpZWxkIHN5bmNSZXN1bHQ7CiAgICAgICAgICAgICAgcG9zdEpvYlJlc3VsdE1lc3NhZ2Uoam9iVUlELCB0cnVlLCBjb21tb25fMS5zZXJpYWxpemUocmVzdWx0KSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgcG9zdEpvYkVycm9yTWVzc2FnZShqb2JVSUQsIGNvbW1vbl8xLnNlcmlhbGl6ZShlcnJvcikpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZXhwb3NlMihleHBvc2VkKSB7CiAgICAgICAgaWYgKCFpbXBsZW1lbnRhdGlvbl8xLmRlZmF1bHQuaXNXb3JrZXJSdW50aW1lKCkpIHsKICAgICAgICAgIHRocm93IEVycm9yKCJleHBvc2UoKSBjYWxsZWQgaW4gdGhlIG1hc3RlciB0aHJlYWQuIik7CiAgICAgICAgfQogICAgICAgIGlmIChleHBvc2VDYWxsZWQpIHsKICAgICAgICAgIHRocm93IEVycm9yKCJleHBvc2UoKSBjYWxsZWQgbW9yZSB0aGFuIG9uY2UuIFRoaXMgaXMgbm90IHBvc3NpYmxlLiBQYXNzIGFuIG9iamVjdCB0byBleHBvc2UoKSBpZiB5b3Ugd2FudCB0byBleHBvc2UgbXVsdGlwbGUgZnVuY3Rpb25zLiIpOwogICAgICAgIH0KICAgICAgICBleHBvc2VDYWxsZWQgPSB0cnVlOwogICAgICAgIGlmICh0eXBlb2YgZXhwb3NlZCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgaW1wbGVtZW50YXRpb25fMS5kZWZhdWx0LnN1YnNjcmliZVRvTWFzdGVyTWVzc2FnZXMoKG1lc3NhZ2VEYXRhKSA9PiB7CiAgICAgICAgICAgIGlmIChpc01hc3RlckpvYlJ1bk1lc3NhZ2UobWVzc2FnZURhdGEpICYmICFtZXNzYWdlRGF0YS5tZXRob2QpIHsKICAgICAgICAgICAgICBydW5GdW5jdGlvbihtZXNzYWdlRGF0YS51aWQsIGV4cG9zZWQsIG1lc3NhZ2VEYXRhLmFyZ3MubWFwKGNvbW1vbl8xLmRlc2VyaWFsaXplKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgcG9zdEZ1bmN0aW9uSW5pdE1lc3NhZ2UoKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvc2VkID09PSAib2JqZWN0IiAmJiBleHBvc2VkKSB7CiAgICAgICAgICBpbXBsZW1lbnRhdGlvbl8xLmRlZmF1bHQuc3Vic2NyaWJlVG9NYXN0ZXJNZXNzYWdlcygobWVzc2FnZURhdGEpID0+IHsKICAgICAgICAgICAgaWYgKGlzTWFzdGVySm9iUnVuTWVzc2FnZShtZXNzYWdlRGF0YSkgJiYgbWVzc2FnZURhdGEubWV0aG9kKSB7CiAgICAgICAgICAgICAgcnVuRnVuY3Rpb24obWVzc2FnZURhdGEudWlkLCBleHBvc2VkW21lc3NhZ2VEYXRhLm1ldGhvZF0sIG1lc3NhZ2VEYXRhLmFyZ3MubWFwKGNvbW1vbl8xLmRlc2VyaWFsaXplKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgY29uc3QgbWV0aG9kTmFtZXMgPSBPYmplY3Qua2V5cyhleHBvc2VkKS5maWx0ZXIoKGtleSkgPT4gdHlwZW9mIGV4cG9zZWRba2V5XSA9PT0gImZ1bmN0aW9uIik7CiAgICAgICAgICBwb3N0TW9kdWxlSW5pdE1lc3NhZ2UobWV0aG9kTmFtZXMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBFcnJvcihgSW52YWxpZCBhcmd1bWVudCBwYXNzZWQgdG8gZXhwb3NlKCkuIEV4cGVjdGVkIGEgZnVuY3Rpb24gb3IgYW4gb2JqZWN0LCBnb3Q6ICR7ZXhwb3NlZH1gKTsKICAgICAgICB9CiAgICAgICAgaW1wbGVtZW50YXRpb25fMS5kZWZhdWx0LnN1YnNjcmliZVRvTWFzdGVyTWVzc2FnZXMoKG1lc3NhZ2VEYXRhKSA9PiB7CiAgICAgICAgICBpZiAoaXNNYXN0ZXJKb2JDYW5jZWxNZXNzYWdlKG1lc3NhZ2VEYXRhKSkgewogICAgICAgICAgICBjb25zdCBqb2JVSUQgPSBtZXNzYWdlRGF0YS51aWQ7CiAgICAgICAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IGFjdGl2ZVN1YnNjcmlwdGlvbnMuZ2V0KGpvYlVJRCk7CiAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb24pIHsKICAgICAgICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTsKICAgICAgICAgICAgICBhY3RpdmVTdWJzY3JpcHRpb25zLmRlbGV0ZShqb2JVSUQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgZXhwb3J0cy5leHBvc2UgPSBleHBvc2UyOwogICAgICBpZiAodHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiBzZWxmLmFkZEV2ZW50TGlzdGVuZXIgPT09ICJmdW5jdGlvbiIgJiYgaW1wbGVtZW50YXRpb25fMS5kZWZhdWx0LmlzV29ya2VyUnVudGltZSgpKSB7CiAgICAgICAgc2VsZi5hZGRFdmVudExpc3RlbmVyKCJlcnJvciIsIChldmVudCkgPT4gewogICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBwb3N0VW5jYXVnaHRFcnJvck1lc3NhZ2UoZXZlbnQuZXJyb3IgfHwgZXZlbnQpLCAyNTApOwogICAgICAgIH0pOwogICAgICAgIHNlbGYuYWRkRXZlbnRMaXN0ZW5lcigidW5oYW5kbGVkcmVqZWN0aW9uIiwgKGV2ZW50KSA9PiB7CiAgICAgICAgICBjb25zdCBlcnJvciA9IGV2ZW50LnJlYXNvbjsKICAgICAgICAgIGlmIChlcnJvciAmJiB0eXBlb2YgZXJyb3IubWVzc2FnZSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBwb3N0VW5jYXVnaHRFcnJvck1lc3NhZ2UoZXJyb3IpLCAyNTApOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmICh0eXBlb2YgcHJvY2VzcyAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIHByb2Nlc3Mub24gPT09ICJmdW5jdGlvbiIgJiYgaW1wbGVtZW50YXRpb25fMS5kZWZhdWx0LmlzV29ya2VyUnVudGltZSgpKSB7CiAgICAgICAgcHJvY2Vzcy5vbigidW5jYXVnaHRFeGNlcHRpb24iLCAoZXJyb3IpID0+IHsKICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gcG9zdFVuY2F1Z2h0RXJyb3JNZXNzYWdlKGVycm9yKSwgMjUwKTsKICAgICAgICB9KTsKICAgICAgICBwcm9jZXNzLm9uKCJ1bmhhbmRsZWRSZWplY3Rpb24iLCAoZXJyb3IpID0+IHsKICAgICAgICAgIGlmIChlcnJvciAmJiB0eXBlb2YgZXJyb3IubWVzc2FnZSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBwb3N0VW5jYXVnaHRFcnJvck1lc3NhZ2UoZXJyb3IpLCAyNTApOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2hlbHBlcnMvaW50ZXJvcFJlcXVpcmVEZWZhdWx0LmpzCiAgdmFyIHJlcXVpcmVfaW50ZXJvcFJlcXVpcmVEZWZhdWx0ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy9pbnRlcm9wUmVxdWlyZURlZmF1bHQuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7CiAgICAgICAgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsKICAgICAgICAgICJkZWZhdWx0Ijogb2JqCiAgICAgICAgfTsKICAgICAgfQogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQ7CiAgICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2dsb2JhbC5qcwogIHZhciByZXF1aXJlX2dsb2JhbCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2dsb2JhbC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGNoZWNrID0gZnVuY3Rpb24oaXQpIHsKICAgICAgICByZXR1cm4gaXQgJiYgaXQuTWF0aCA9PSBNYXRoICYmIGl0OwogICAgICB9OwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGNoZWNrKHR5cGVvZiBnbG9iYWxUaGlzID09ICJvYmplY3QiICYmIGdsb2JhbFRoaXMpIHx8IGNoZWNrKHR5cGVvZiB3aW5kb3cgPT0gIm9iamVjdCIgJiYgd2luZG93KSB8fCBjaGVjayh0eXBlb2Ygc2VsZiA9PSAib2JqZWN0IiAmJiBzZWxmKSB8fCBjaGVjayh0eXBlb2YgZ2xvYmFsID09ICJvYmplY3QiICYmIGdsb2JhbCkgfHwgZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0oKSB8fCBGdW5jdGlvbigicmV0dXJuIHRoaXMiKSgpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9pcy1jYWxsYWJsZS5qcwogIHZhciByZXF1aXJlX2lzX2NhbGxhYmxlID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvaXMtY2FsbGFibGUuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oYXJndW1lbnQpIHsKICAgICAgICByZXR1cm4gdHlwZW9mIGFyZ3VtZW50ID09PSAiZnVuY3Rpb24iOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9mYWlscy5qcwogIHZhciByZXF1aXJlX2ZhaWxzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZmFpbHMuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZXhlYykgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gISFleGVjKCk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZGVzY3JpcHRvcnMuanMKICB2YXIgcmVxdWlyZV9kZXNjcmlwdG9ycyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2Rlc2NyaXB0b3JzLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgZmFpbHMgPSByZXF1aXJlX2ZhaWxzKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gIWZhaWxzKGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sIDEsIHsgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiA3OwogICAgICAgIH0gfSlbMV0gIT0gNzsKICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL29iamVjdC1wcm9wZXJ0eS1pcy1lbnVtZXJhYmxlLmpzCiAgdmFyIHJlcXVpcmVfb2JqZWN0X3Byb3BlcnR5X2lzX2VudW1lcmFibGUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9vYmplY3QtcHJvcGVydHktaXMtZW51bWVyYWJsZS5qcyIoZXhwb3J0cykgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyICRwcm9wZXJ0eUlzRW51bWVyYWJsZSA9IHt9LnByb3BlcnR5SXNFbnVtZXJhYmxlOwogICAgICB2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcjsKICAgICAgdmFyIE5BU0hPUk5fQlVHID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yICYmICEkcHJvcGVydHlJc0VudW1lcmFibGUuY2FsbCh7IDE6IDIgfSwgMSk7CiAgICAgIGV4cG9ydHMuZiA9IE5BU0hPUk5fQlVHID8gZnVuY3Rpb24gcHJvcGVydHlJc0VudW1lcmFibGUoVikgewogICAgICAgIHZhciBkZXNjcmlwdG9yID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRoaXMsIFYpOwogICAgICAgIHJldHVybiAhIWRlc2NyaXB0b3IgJiYgZGVzY3JpcHRvci5lbnVtZXJhYmxlOwogICAgICB9IDogJHByb3BlcnR5SXNFbnVtZXJhYmxlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9jcmVhdGUtcHJvcGVydHktZGVzY3JpcHRvci5qcwogIHZhciByZXF1aXJlX2NyZWF0ZV9wcm9wZXJ0eV9kZXNjcmlwdG9yID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvY3JlYXRlLXByb3BlcnR5LWRlc2NyaXB0b3IuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oYml0bWFwLCB2YWx1ZSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBlbnVtZXJhYmxlOiAhKGJpdG1hcCAmIDEpLAogICAgICAgICAgY29uZmlndXJhYmxlOiAhKGJpdG1hcCAmIDIpLAogICAgICAgICAgd3JpdGFibGU6ICEoYml0bWFwICYgNCksCiAgICAgICAgICB2YWx1ZQogICAgICAgIH07CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2NsYXNzb2YtcmF3LmpzCiAgdmFyIHJlcXVpcmVfY2xhc3NvZl9yYXcgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9jbGFzc29mLXJhdy5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHRvU3RyaW5nID0ge30udG9TdHJpbmc7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpIHsKICAgICAgICByZXR1cm4gdG9TdHJpbmcuY2FsbChpdCkuc2xpY2UoOCwgLTEpOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9pbmRleGVkLW9iamVjdC5qcwogIHZhciByZXF1aXJlX2luZGV4ZWRfb2JqZWN0ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvaW5kZXhlZC1vYmplY3QuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBmYWlscyA9IHJlcXVpcmVfZmFpbHMoKTsKICAgICAgdmFyIGNsYXNzb2YgPSByZXF1aXJlX2NsYXNzb2ZfcmF3KCk7CiAgICAgIHZhciBzcGxpdCA9ICIiLnNwbGl0OwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZhaWxzKGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiAhT2JqZWN0KCJ6IikucHJvcGVydHlJc0VudW1lcmFibGUoMCk7CiAgICAgIH0pID8gZnVuY3Rpb24oaXQpIHsKICAgICAgICByZXR1cm4gY2xhc3NvZihpdCkgPT0gIlN0cmluZyIgPyBzcGxpdC5jYWxsKGl0LCAiIikgOiBPYmplY3QoaXQpOwogICAgICB9IDogT2JqZWN0OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9yZXF1aXJlLW9iamVjdC1jb2VyY2libGUuanMKICB2YXIgcmVxdWlyZV9yZXF1aXJlX29iamVjdF9jb2VyY2libGUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9yZXF1aXJlLW9iamVjdC1jb2VyY2libGUuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpIHsKICAgICAgICBpZiAoaXQgPT0gdm9pZCAwKQogICAgICAgICAgdGhyb3cgVHlwZUVycm9yKCJDYW4ndCBjYWxsIG1ldGhvZCBvbiAiICsgaXQpOwogICAgICAgIHJldHVybiBpdDsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvdG8taW5kZXhlZC1vYmplY3QuanMKICB2YXIgcmVxdWlyZV90b19pbmRleGVkX29iamVjdCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL3RvLWluZGV4ZWQtb2JqZWN0LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgSW5kZXhlZE9iamVjdCA9IHJlcXVpcmVfaW5kZXhlZF9vYmplY3QoKTsKICAgICAgdmFyIHJlcXVpcmVPYmplY3RDb2VyY2libGUgPSByZXF1aXJlX3JlcXVpcmVfb2JqZWN0X2NvZXJjaWJsZSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KSB7CiAgICAgICAgcmV0dXJuIEluZGV4ZWRPYmplY3QocmVxdWlyZU9iamVjdENvZXJjaWJsZShpdCkpOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9pcy1vYmplY3QuanMKICB2YXIgcmVxdWlyZV9pc19vYmplY3QgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9pcy1vYmplY3QuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBpc0NhbGxhYmxlID0gcmVxdWlyZV9pc19jYWxsYWJsZSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KSB7CiAgICAgICAgcmV0dXJuIHR5cGVvZiBpdCA9PT0gIm9iamVjdCIgPyBpdCAhPT0gbnVsbCA6IGlzQ2FsbGFibGUoaXQpOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9wYXRoLmpzCiAgdmFyIHJlcXVpcmVfcGF0aCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL3BhdGguanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0ge307CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2dldC1idWlsdC1pbi5qcwogIHZhciByZXF1aXJlX2dldF9idWlsdF9pbiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2dldC1idWlsdC1pbi5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHBhdGggPSByZXF1aXJlX3BhdGgoKTsKICAgICAgdmFyIGdsb2JhbDIgPSByZXF1aXJlX2dsb2JhbCgpOwogICAgICB2YXIgaXNDYWxsYWJsZSA9IHJlcXVpcmVfaXNfY2FsbGFibGUoKTsKICAgICAgdmFyIGFGdW5jdGlvbiA9IGZ1bmN0aW9uKHZhcmlhYmxlKSB7CiAgICAgICAgcmV0dXJuIGlzQ2FsbGFibGUodmFyaWFibGUpID8gdmFyaWFibGUgOiB2b2lkIDA7CiAgICAgIH07CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24obmFtZXNwYWNlLCBtZXRob2QpIHsKICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA8IDIgPyBhRnVuY3Rpb24ocGF0aFtuYW1lc3BhY2VdKSB8fCBhRnVuY3Rpb24oZ2xvYmFsMltuYW1lc3BhY2VdKSA6IHBhdGhbbmFtZXNwYWNlXSAmJiBwYXRoW25hbWVzcGFjZV1bbWV0aG9kXSB8fCBnbG9iYWwyW25hbWVzcGFjZV0gJiYgZ2xvYmFsMltuYW1lc3BhY2VdW21ldGhvZF07CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2VuZ2luZS11c2VyLWFnZW50LmpzCiAgdmFyIHJlcXVpcmVfZW5naW5lX3VzZXJfYWdlbnQgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9lbmdpbmUtdXNlci1hZ2VudC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGdldEJ1aWx0SW4gPSByZXF1aXJlX2dldF9idWlsdF9pbigpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGdldEJ1aWx0SW4oIm5hdmlnYXRvciIsICJ1c2VyQWdlbnQiKSB8fCAiIjsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZW5naW5lLXY4LXZlcnNpb24uanMKICB2YXIgcmVxdWlyZV9lbmdpbmVfdjhfdmVyc2lvbiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2VuZ2luZS12OC12ZXJzaW9uLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgZ2xvYmFsMiA9IHJlcXVpcmVfZ2xvYmFsKCk7CiAgICAgIHZhciB1c2VyQWdlbnQgPSByZXF1aXJlX2VuZ2luZV91c2VyX2FnZW50KCk7CiAgICAgIHZhciBwcm9jZXNzMiA9IGdsb2JhbDIucHJvY2VzczsKICAgICAgdmFyIERlbm8gPSBnbG9iYWwyLkRlbm87CiAgICAgIHZhciB2ZXJzaW9ucyA9IHByb2Nlc3MyICYmIHByb2Nlc3MyLnZlcnNpb25zIHx8IERlbm8gJiYgRGVuby52ZXJzaW9uOwogICAgICB2YXIgdjggPSB2ZXJzaW9ucyAmJiB2ZXJzaW9ucy52ODsKICAgICAgdmFyIG1hdGNoOwogICAgICB2YXIgdmVyc2lvbjsKICAgICAgaWYgKHY4KSB7CiAgICAgICAgbWF0Y2ggPSB2OC5zcGxpdCgiLiIpOwogICAgICAgIHZlcnNpb24gPSBtYXRjaFswXSA8IDQgPyAxIDogbWF0Y2hbMF0gKyBtYXRjaFsxXTsKICAgICAgfSBlbHNlIGlmICh1c2VyQWdlbnQpIHsKICAgICAgICBtYXRjaCA9IHVzZXJBZ2VudC5tYXRjaCgvRWRnZVwvKFxkKykvKTsKICAgICAgICBpZiAoIW1hdGNoIHx8IG1hdGNoWzFdID49IDc0KSB7CiAgICAgICAgICBtYXRjaCA9IHVzZXJBZ2VudC5tYXRjaCgvQ2hyb21lXC8oXGQrKS8pOwogICAgICAgICAgaWYgKG1hdGNoKQogICAgICAgICAgICB2ZXJzaW9uID0gbWF0Y2hbMV07CiAgICAgICAgfQogICAgICB9CiAgICAgIG1vZHVsZS5leHBvcnRzID0gdmVyc2lvbiAmJiArdmVyc2lvbjsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvbmF0aXZlLXN5bWJvbC5qcwogIHZhciByZXF1aXJlX25hdGl2ZV9zeW1ib2wgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9uYXRpdmUtc3ltYm9sLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgVjhfVkVSU0lPTiA9IHJlcXVpcmVfZW5naW5lX3Y4X3ZlcnNpb24oKTsKICAgICAgdmFyIGZhaWxzID0gcmVxdWlyZV9mYWlscygpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9ICEhT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyAmJiAhZmFpbHMoZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHN5bWJvbCA9IFN5bWJvbCgpOwogICAgICAgIHJldHVybiAhU3RyaW5nKHN5bWJvbCkgfHwgIShPYmplY3Qoc3ltYm9sKSBpbnN0YW5jZW9mIFN5bWJvbCkgfHwgIVN5bWJvbC5zaGFtICYmIFY4X1ZFUlNJT04gJiYgVjhfVkVSU0lPTiA8IDQxOwogICAgICB9KTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvdXNlLXN5bWJvbC1hcy11aWQuanMKICB2YXIgcmVxdWlyZV91c2Vfc3ltYm9sX2FzX3VpZCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL3VzZS1zeW1ib2wtYXMtdWlkLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgTkFUSVZFX1NZTUJPTCA9IHJlcXVpcmVfbmF0aXZlX3N5bWJvbCgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IE5BVElWRV9TWU1CT0wgJiYgIVN5bWJvbC5zaGFtICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT0gInN5bWJvbCI7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2lzLXN5bWJvbC5qcwogIHZhciByZXF1aXJlX2lzX3N5bWJvbCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2lzLXN5bWJvbC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGlzQ2FsbGFibGUgPSByZXF1aXJlX2lzX2NhbGxhYmxlKCk7CiAgICAgIHZhciBnZXRCdWlsdEluID0gcmVxdWlyZV9nZXRfYnVpbHRfaW4oKTsKICAgICAgdmFyIFVTRV9TWU1CT0xfQVNfVUlEID0gcmVxdWlyZV91c2Vfc3ltYm9sX2FzX3VpZCgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IFVTRV9TWU1CT0xfQVNfVUlEID8gZnVuY3Rpb24oaXQpIHsKICAgICAgICByZXR1cm4gdHlwZW9mIGl0ID09ICJzeW1ib2wiOwogICAgICB9IDogZnVuY3Rpb24oaXQpIHsKICAgICAgICB2YXIgJFN5bWJvbCA9IGdldEJ1aWx0SW4oIlN5bWJvbCIpOwogICAgICAgIHJldHVybiBpc0NhbGxhYmxlKCRTeW1ib2wpICYmIE9iamVjdChpdCkgaW5zdGFuY2VvZiAkU3ltYm9sOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy90cnktdG8tc3RyaW5nLmpzCiAgdmFyIHJlcXVpcmVfdHJ5X3RvX3N0cmluZyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL3RyeS10by1zdHJpbmcuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oYXJndW1lbnQpIHsKICAgICAgICB0cnkgewogICAgICAgICAgcmV0dXJuIFN0cmluZyhhcmd1bWVudCk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIHJldHVybiAiT2JqZWN0IjsKICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2EtY2FsbGFibGUuanMKICB2YXIgcmVxdWlyZV9hX2NhbGxhYmxlID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvYS1jYWxsYWJsZS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGlzQ2FsbGFibGUgPSByZXF1aXJlX2lzX2NhbGxhYmxlKCk7CiAgICAgIHZhciB0cnlUb1N0cmluZyA9IHJlcXVpcmVfdHJ5X3RvX3N0cmluZygpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGFyZ3VtZW50KSB7CiAgICAgICAgaWYgKGlzQ2FsbGFibGUoYXJndW1lbnQpKQogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50OwogICAgICAgIHRocm93IFR5cGVFcnJvcih0cnlUb1N0cmluZyhhcmd1bWVudCkgKyAiIGlzIG5vdCBhIGZ1bmN0aW9uIik7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2dldC1tZXRob2QuanMKICB2YXIgcmVxdWlyZV9nZXRfbWV0aG9kID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZ2V0LW1ldGhvZC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGFDYWxsYWJsZSA9IHJlcXVpcmVfYV9jYWxsYWJsZSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKFYsIFApIHsKICAgICAgICB2YXIgZnVuYyA9IFZbUF07CiAgICAgICAgcmV0dXJuIGZ1bmMgPT0gbnVsbCA/IHZvaWQgMCA6IGFDYWxsYWJsZShmdW5jKTsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvb3JkaW5hcnktdG8tcHJpbWl0aXZlLmpzCiAgdmFyIHJlcXVpcmVfb3JkaW5hcnlfdG9fcHJpbWl0aXZlID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvb3JkaW5hcnktdG8tcHJpbWl0aXZlLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgaXNDYWxsYWJsZSA9IHJlcXVpcmVfaXNfY2FsbGFibGUoKTsKICAgICAgdmFyIGlzT2JqZWN0ID0gcmVxdWlyZV9pc19vYmplY3QoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpbnB1dCwgcHJlZikgewogICAgICAgIHZhciBmbiwgdmFsOwogICAgICAgIGlmIChwcmVmID09PSAic3RyaW5nIiAmJiBpc0NhbGxhYmxlKGZuID0gaW5wdXQudG9TdHJpbmcpICYmICFpc09iamVjdCh2YWwgPSBmbi5jYWxsKGlucHV0KSkpCiAgICAgICAgICByZXR1cm4gdmFsOwogICAgICAgIGlmIChpc0NhbGxhYmxlKGZuID0gaW5wdXQudmFsdWVPZikgJiYgIWlzT2JqZWN0KHZhbCA9IGZuLmNhbGwoaW5wdXQpKSkKICAgICAgICAgIHJldHVybiB2YWw7CiAgICAgICAgaWYgKHByZWYgIT09ICJzdHJpbmciICYmIGlzQ2FsbGFibGUoZm4gPSBpbnB1dC50b1N0cmluZykgJiYgIWlzT2JqZWN0KHZhbCA9IGZuLmNhbGwoaW5wdXQpKSkKICAgICAgICAgIHJldHVybiB2YWw7CiAgICAgICAgdGhyb3cgVHlwZUVycm9yKCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUiKTsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvaXMtcHVyZS5qcwogIHZhciByZXF1aXJlX2lzX3B1cmUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9pcy1wdXJlLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHRydWU7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL3NldC1nbG9iYWwuanMKICB2YXIgcmVxdWlyZV9zZXRfZ2xvYmFsID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvc2V0LWdsb2JhbC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGdsb2JhbDIgPSByZXF1aXJlX2dsb2JhbCgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgICAgICB0cnkgewogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGdsb2JhbDIsIGtleSwgeyB2YWx1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgZ2xvYmFsMltrZXldID0gdmFsdWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvc2hhcmVkLXN0b3JlLmpzCiAgdmFyIHJlcXVpcmVfc2hhcmVkX3N0b3JlID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvc2hhcmVkLXN0b3JlLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgZ2xvYmFsMiA9IHJlcXVpcmVfZ2xvYmFsKCk7CiAgICAgIHZhciBzZXRHbG9iYWwgPSByZXF1aXJlX3NldF9nbG9iYWwoKTsKICAgICAgdmFyIFNIQVJFRCA9ICJfX2NvcmUtanNfc2hhcmVkX18iOwogICAgICB2YXIgc3RvcmUgPSBnbG9iYWwyW1NIQVJFRF0gfHwgc2V0R2xvYmFsKFNIQVJFRCwge30pOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHN0b3JlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9zaGFyZWQuanMKICB2YXIgcmVxdWlyZV9zaGFyZWQgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9zaGFyZWQuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBJU19QVVJFID0gcmVxdWlyZV9pc19wdXJlKCk7CiAgICAgIHZhciBzdG9yZSA9IHJlcXVpcmVfc2hhcmVkX3N0b3JlKCk7CiAgICAgIChtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgICAgICByZXR1cm4gc3RvcmVba2V5XSB8fCAoc3RvcmVba2V5XSA9IHZhbHVlICE9PSB2b2lkIDAgPyB2YWx1ZSA6IHt9KTsKICAgICAgfSkoInZlcnNpb25zIiwgW10pLnB1c2goewogICAgICAgIHZlcnNpb246ICIzLjE4LjAiLAogICAgICAgIG1vZGU6IElTX1BVUkUgPyAicHVyZSIgOiAiZ2xvYmFsIiwKICAgICAgICBjb3B5cmlnaHQ6ICJceEE5IDIwMjEgRGVuaXMgUHVzaGthcmV2ICh6bG9pcm9jay5ydSkiCiAgICAgIH0pOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy90by1vYmplY3QuanMKICB2YXIgcmVxdWlyZV90b19vYmplY3QgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy90by1vYmplY3QuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciByZXF1aXJlT2JqZWN0Q29lcmNpYmxlID0gcmVxdWlyZV9yZXF1aXJlX29iamVjdF9jb2VyY2libGUoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihhcmd1bWVudCkgewogICAgICAgIHJldHVybiBPYmplY3QocmVxdWlyZU9iamVjdENvZXJjaWJsZShhcmd1bWVudCkpOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9oYXMuanMKICB2YXIgcmVxdWlyZV9oYXMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9oYXMuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciB0b09iamVjdCA9IHJlcXVpcmVfdG9fb2JqZWN0KCk7CiAgICAgIHZhciBoYXNPd25Qcm9wZXJ0eSA9IHt9Lmhhc093blByb3BlcnR5OwogICAgICBtb2R1bGUuZXhwb3J0cyA9IE9iamVjdC5oYXNPd24gfHwgZnVuY3Rpb24gaGFzT3duKGl0LCBrZXkpIHsKICAgICAgICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbCh0b09iamVjdChpdCksIGtleSk7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL3VpZC5qcwogIHZhciByZXF1aXJlX3VpZCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL3VpZC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGlkID0gMDsKICAgICAgdmFyIHBvc3RmaXggPSBNYXRoLnJhbmRvbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGtleSkgewogICAgICAgIHJldHVybiAiU3ltYm9sKCIgKyBTdHJpbmcoa2V5ID09PSB2b2lkIDAgPyAiIiA6IGtleSkgKyAiKV8iICsgKCsraWQgKyBwb3N0Zml4KS50b1N0cmluZygzNik7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL3dlbGwta25vd24tc3ltYm9sLmpzCiAgdmFyIHJlcXVpcmVfd2VsbF9rbm93bl9zeW1ib2wgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy93ZWxsLWtub3duLXN5bWJvbC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGdsb2JhbDIgPSByZXF1aXJlX2dsb2JhbCgpOwogICAgICB2YXIgc2hhcmVkID0gcmVxdWlyZV9zaGFyZWQoKTsKICAgICAgdmFyIGhhcyA9IHJlcXVpcmVfaGFzKCk7CiAgICAgIHZhciB1aWQgPSByZXF1aXJlX3VpZCgpOwogICAgICB2YXIgTkFUSVZFX1NZTUJPTCA9IHJlcXVpcmVfbmF0aXZlX3N5bWJvbCgpOwogICAgICB2YXIgVVNFX1NZTUJPTF9BU19VSUQgPSByZXF1aXJlX3VzZV9zeW1ib2xfYXNfdWlkKCk7CiAgICAgIHZhciBXZWxsS25vd25TeW1ib2xzU3RvcmUgPSBzaGFyZWQoIndrcyIpOwogICAgICB2YXIgU3ltYm9sMiA9IGdsb2JhbDIuU3ltYm9sOwogICAgICB2YXIgY3JlYXRlV2VsbEtub3duU3ltYm9sID0gVVNFX1NZTUJPTF9BU19VSUQgPyBTeW1ib2wyIDogU3ltYm9sMiAmJiBTeW1ib2wyLndpdGhvdXRTZXR0ZXIgfHwgdWlkOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgICBpZiAoIWhhcyhXZWxsS25vd25TeW1ib2xzU3RvcmUsIG5hbWUpIHx8ICEoTkFUSVZFX1NZTUJPTCB8fCB0eXBlb2YgV2VsbEtub3duU3ltYm9sc1N0b3JlW25hbWVdID09ICJzdHJpbmciKSkgewogICAgICAgICAgaWYgKE5BVElWRV9TWU1CT0wgJiYgaGFzKFN5bWJvbDIsIG5hbWUpKSB7CiAgICAgICAgICAgIFdlbGxLbm93blN5bWJvbHNTdG9yZVtuYW1lXSA9IFN5bWJvbDJbbmFtZV07CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBXZWxsS25vd25TeW1ib2xzU3RvcmVbbmFtZV0gPSBjcmVhdGVXZWxsS25vd25TeW1ib2woIlN5bWJvbC4iICsgbmFtZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBXZWxsS25vd25TeW1ib2xzU3RvcmVbbmFtZV07CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL3RvLXByaW1pdGl2ZS5qcwogIHZhciByZXF1aXJlX3RvX3ByaW1pdGl2ZSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL3RvLXByaW1pdGl2ZS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGlzT2JqZWN0ID0gcmVxdWlyZV9pc19vYmplY3QoKTsKICAgICAgdmFyIGlzU3ltYm9sID0gcmVxdWlyZV9pc19zeW1ib2woKTsKICAgICAgdmFyIGdldE1ldGhvZCA9IHJlcXVpcmVfZ2V0X21ldGhvZCgpOwogICAgICB2YXIgb3JkaW5hcnlUb1ByaW1pdGl2ZSA9IHJlcXVpcmVfb3JkaW5hcnlfdG9fcHJpbWl0aXZlKCk7CiAgICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSByZXF1aXJlX3dlbGxfa25vd25fc3ltYm9sKCk7CiAgICAgIHZhciBUT19QUklNSVRJVkUgPSB3ZWxsS25vd25TeW1ib2woInRvUHJpbWl0aXZlIik7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaW5wdXQsIHByZWYpIHsKICAgICAgICBpZiAoIWlzT2JqZWN0KGlucHV0KSB8fCBpc1N5bWJvbChpbnB1dCkpCiAgICAgICAgICByZXR1cm4gaW5wdXQ7CiAgICAgICAgdmFyIGV4b3RpY1RvUHJpbSA9IGdldE1ldGhvZChpbnB1dCwgVE9fUFJJTUlUSVZFKTsKICAgICAgICB2YXIgcmVzdWx0OwogICAgICAgIGlmIChleG90aWNUb1ByaW0pIHsKICAgICAgICAgIGlmIChwcmVmID09PSB2b2lkIDApCiAgICAgICAgICAgIHByZWYgPSAiZGVmYXVsdCI7CiAgICAgICAgICByZXN1bHQgPSBleG90aWNUb1ByaW0uY2FsbChpbnB1dCwgcHJlZik7CiAgICAgICAgICBpZiAoIWlzT2JqZWN0KHJlc3VsdCkgfHwgaXNTeW1ib2wocmVzdWx0KSkKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgIHRocm93IFR5cGVFcnJvcigiQ2FuJ3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlIik7CiAgICAgICAgfQogICAgICAgIGlmIChwcmVmID09PSB2b2lkIDApCiAgICAgICAgICBwcmVmID0gIm51bWJlciI7CiAgICAgICAgcmV0dXJuIG9yZGluYXJ5VG9QcmltaXRpdmUoaW5wdXQsIHByZWYpOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy90by1wcm9wZXJ0eS1rZXkuanMKICB2YXIgcmVxdWlyZV90b19wcm9wZXJ0eV9rZXkgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy90by1wcm9wZXJ0eS1rZXkuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciB0b1ByaW1pdGl2ZSA9IHJlcXVpcmVfdG9fcHJpbWl0aXZlKCk7CiAgICAgIHZhciBpc1N5bWJvbCA9IHJlcXVpcmVfaXNfc3ltYm9sKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oYXJndW1lbnQpIHsKICAgICAgICB2YXIga2V5ID0gdG9QcmltaXRpdmUoYXJndW1lbnQsICJzdHJpbmciKTsKICAgICAgICByZXR1cm4gaXNTeW1ib2woa2V5KSA/IGtleSA6IFN0cmluZyhrZXkpOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9kb2N1bWVudC1jcmVhdGUtZWxlbWVudC5qcwogIHZhciByZXF1aXJlX2RvY3VtZW50X2NyZWF0ZV9lbGVtZW50ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZG9jdW1lbnQtY3JlYXRlLWVsZW1lbnQuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBnbG9iYWwyID0gcmVxdWlyZV9nbG9iYWwoKTsKICAgICAgdmFyIGlzT2JqZWN0ID0gcmVxdWlyZV9pc19vYmplY3QoKTsKICAgICAgdmFyIGRvY3VtZW50MiA9IGdsb2JhbDIuZG9jdW1lbnQ7CiAgICAgIHZhciBFWElTVFMgPSBpc09iamVjdChkb2N1bWVudDIpICYmIGlzT2JqZWN0KGRvY3VtZW50Mi5jcmVhdGVFbGVtZW50KTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCkgewogICAgICAgIHJldHVybiBFWElTVFMgPyBkb2N1bWVudDIuY3JlYXRlRWxlbWVudChpdCkgOiB7fTsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvaWU4LWRvbS1kZWZpbmUuanMKICB2YXIgcmVxdWlyZV9pZThfZG9tX2RlZmluZSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2llOC1kb20tZGVmaW5lLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgREVTQ1JJUFRPUlMgPSByZXF1aXJlX2Rlc2NyaXB0b3JzKCk7CiAgICAgIHZhciBmYWlscyA9IHJlcXVpcmVfZmFpbHMoKTsKICAgICAgdmFyIGNyZWF0ZUVsZW1lbnQgPSByZXF1aXJlX2RvY3VtZW50X2NyZWF0ZV9lbGVtZW50KCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gIURFU0NSSVBUT1JTICYmICFmYWlscyhmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KGNyZWF0ZUVsZW1lbnQoImRpdiIpLCAiYSIsIHsKICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiA3OwogICAgICAgICAgfQogICAgICAgIH0pLmEgIT0gNzsKICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL29iamVjdC1nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IuanMKICB2YXIgcmVxdWlyZV9vYmplY3RfZ2V0X293bl9wcm9wZXJ0eV9kZXNjcmlwdG9yID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvb2JqZWN0LWdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvci5qcyIoZXhwb3J0cykgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBERVNDUklQVE9SUyA9IHJlcXVpcmVfZGVzY3JpcHRvcnMoKTsKICAgICAgdmFyIHByb3BlcnR5SXNFbnVtZXJhYmxlTW9kdWxlID0gcmVxdWlyZV9vYmplY3RfcHJvcGVydHlfaXNfZW51bWVyYWJsZSgpOwogICAgICB2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yID0gcmVxdWlyZV9jcmVhdGVfcHJvcGVydHlfZGVzY3JpcHRvcigpOwogICAgICB2YXIgdG9JbmRleGVkT2JqZWN0ID0gcmVxdWlyZV90b19pbmRleGVkX29iamVjdCgpOwogICAgICB2YXIgdG9Qcm9wZXJ0eUtleSA9IHJlcXVpcmVfdG9fcHJvcGVydHlfa2V5KCk7CiAgICAgIHZhciBoYXMgPSByZXF1aXJlX2hhcygpOwogICAgICB2YXIgSUU4X0RPTV9ERUZJTkUgPSByZXF1aXJlX2llOF9kb21fZGVmaW5lKCk7CiAgICAgIHZhciAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcjsKICAgICAgZXhwb3J0cy5mID0gREVTQ1JJUFRPUlMgPyAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIDogZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE8sIFApIHsKICAgICAgICBPID0gdG9JbmRleGVkT2JqZWN0KE8pOwogICAgICAgIFAgPSB0b1Byb3BlcnR5S2V5KFApOwogICAgICAgIGlmIChJRThfRE9NX0RFRklORSkKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE8sIFApOwogICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIH0KICAgICAgICBpZiAoaGFzKE8sIFApKQogICAgICAgICAgcmV0dXJuIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvcighcHJvcGVydHlJc0VudW1lcmFibGVNb2R1bGUuZi5jYWxsKE8sIFApLCBPW1BdKTsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvaXMtZm9yY2VkLmpzCiAgdmFyIHJlcXVpcmVfaXNfZm9yY2VkID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvaXMtZm9yY2VkLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgZmFpbHMgPSByZXF1aXJlX2ZhaWxzKCk7CiAgICAgIHZhciBpc0NhbGxhYmxlID0gcmVxdWlyZV9pc19jYWxsYWJsZSgpOwogICAgICB2YXIgcmVwbGFjZW1lbnQgPSAvI3xcLnByb3RvdHlwZVwuLzsKICAgICAgdmFyIGlzRm9yY2VkID0gZnVuY3Rpb24oZmVhdHVyZSwgZGV0ZWN0aW9uKSB7CiAgICAgICAgdmFyIHZhbHVlID0gZGF0YVtub3JtYWxpemUoZmVhdHVyZSldOwogICAgICAgIHJldHVybiB2YWx1ZSA9PSBQT0xZRklMTCA/IHRydWUgOiB2YWx1ZSA9PSBOQVRJVkUgPyBmYWxzZSA6IGlzQ2FsbGFibGUoZGV0ZWN0aW9uKSA/IGZhaWxzKGRldGVjdGlvbikgOiAhIWRldGVjdGlvbjsKICAgICAgfTsKICAgICAgdmFyIG5vcm1hbGl6ZSA9IGlzRm9yY2VkLm5vcm1hbGl6ZSA9IGZ1bmN0aW9uKHN0cmluZykgewogICAgICAgIHJldHVybiBTdHJpbmcoc3RyaW5nKS5yZXBsYWNlKHJlcGxhY2VtZW50LCAiLiIpLnRvTG93ZXJDYXNlKCk7CiAgICAgIH07CiAgICAgIHZhciBkYXRhID0gaXNGb3JjZWQuZGF0YSA9IHt9OwogICAgICB2YXIgTkFUSVZFID0gaXNGb3JjZWQuTkFUSVZFID0gIk4iOwogICAgICB2YXIgUE9MWUZJTEwgPSBpc0ZvcmNlZC5QT0xZRklMTCA9ICJQIjsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBpc0ZvcmNlZDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZnVuY3Rpb24tYmluZC1jb250ZXh0LmpzCiAgdmFyIHJlcXVpcmVfZnVuY3Rpb25fYmluZF9jb250ZXh0ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZnVuY3Rpb24tYmluZC1jb250ZXh0LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgYUNhbGxhYmxlID0gcmVxdWlyZV9hX2NhbGxhYmxlKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZm4sIHRoYXQsIGxlbmd0aCkgewogICAgICAgIGFDYWxsYWJsZShmbik7CiAgICAgICAgaWYgKHRoYXQgPT09IHZvaWQgMCkKICAgICAgICAgIHJldHVybiBmbjsKICAgICAgICBzd2l0Y2ggKGxlbmd0aCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCk7CiAgICAgICAgICAgIH07CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSwgYik7CiAgICAgICAgICAgIH07CiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSwgYiwgYyk7CiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBmbi5hcHBseSh0aGF0LCBhcmd1bWVudHMpOwogICAgICAgIH07CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2FuLW9iamVjdC5qcwogIHZhciByZXF1aXJlX2FuX29iamVjdCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2FuLW9iamVjdC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGlzT2JqZWN0ID0gcmVxdWlyZV9pc19vYmplY3QoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihhcmd1bWVudCkgewogICAgICAgIGlmIChpc09iamVjdChhcmd1bWVudCkpCiAgICAgICAgICByZXR1cm4gYXJndW1lbnQ7CiAgICAgICAgdGhyb3cgVHlwZUVycm9yKFN0cmluZyhhcmd1bWVudCkgKyAiIGlzIG5vdCBhbiBvYmplY3QiKTsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvb2JqZWN0LWRlZmluZS1wcm9wZXJ0eS5qcwogIHZhciByZXF1aXJlX29iamVjdF9kZWZpbmVfcHJvcGVydHkgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9vYmplY3QtZGVmaW5lLXByb3BlcnR5LmpzIihleHBvcnRzKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIERFU0NSSVBUT1JTID0gcmVxdWlyZV9kZXNjcmlwdG9ycygpOwogICAgICB2YXIgSUU4X0RPTV9ERUZJTkUgPSByZXF1aXJlX2llOF9kb21fZGVmaW5lKCk7CiAgICAgIHZhciBhbk9iamVjdCA9IHJlcXVpcmVfYW5fb2JqZWN0KCk7CiAgICAgIHZhciB0b1Byb3BlcnR5S2V5ID0gcmVxdWlyZV90b19wcm9wZXJ0eV9rZXkoKTsKICAgICAgdmFyICRkZWZpbmVQcm9wZXJ0eSA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eTsKICAgICAgZXhwb3J0cy5mID0gREVTQ1JJUFRPUlMgPyAkZGVmaW5lUHJvcGVydHkgOiBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0eShPLCBQLCBBdHRyaWJ1dGVzKSB7CiAgICAgICAgYW5PYmplY3QoTyk7CiAgICAgICAgUCA9IHRvUHJvcGVydHlLZXkoUCk7CiAgICAgICAgYW5PYmplY3QoQXR0cmlidXRlcyk7CiAgICAgICAgaWYgKElFOF9ET01fREVGSU5FKQogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuICRkZWZpbmVQcm9wZXJ0eShPLCBQLCBBdHRyaWJ1dGVzKTsKICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICB9CiAgICAgICAgaWYgKCJnZXQiIGluIEF0dHJpYnV0ZXMgfHwgInNldCIgaW4gQXR0cmlidXRlcykKICAgICAgICAgIHRocm93IFR5cGVFcnJvcigiQWNjZXNzb3JzIG5vdCBzdXBwb3J0ZWQiKTsKICAgICAgICBpZiAoInZhbHVlIiBpbiBBdHRyaWJ1dGVzKQogICAgICAgICAgT1tQXSA9IEF0dHJpYnV0ZXMudmFsdWU7CiAgICAgICAgcmV0dXJuIE87CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2NyZWF0ZS1ub24tZW51bWVyYWJsZS1wcm9wZXJ0eS5qcwogIHZhciByZXF1aXJlX2NyZWF0ZV9ub25fZW51bWVyYWJsZV9wcm9wZXJ0eSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2NyZWF0ZS1ub24tZW51bWVyYWJsZS1wcm9wZXJ0eS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIERFU0NSSVBUT1JTID0gcmVxdWlyZV9kZXNjcmlwdG9ycygpOwogICAgICB2YXIgZGVmaW5lUHJvcGVydHlNb2R1bGUgPSByZXF1aXJlX29iamVjdF9kZWZpbmVfcHJvcGVydHkoKTsKICAgICAgdmFyIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvciA9IHJlcXVpcmVfY3JlYXRlX3Byb3BlcnR5X2Rlc2NyaXB0b3IoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBERVNDUklQVE9SUyA/IGZ1bmN0aW9uKG9iamVjdCwga2V5LCB2YWx1ZSkgewogICAgICAgIHJldHVybiBkZWZpbmVQcm9wZXJ0eU1vZHVsZS5mKG9iamVjdCwga2V5LCBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IoMSwgdmFsdWUpKTsKICAgICAgfSA6IGZ1bmN0aW9uKG9iamVjdCwga2V5LCB2YWx1ZSkgewogICAgICAgIG9iamVjdFtrZXldID0gdmFsdWU7CiAgICAgICAgcmV0dXJuIG9iamVjdDsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZXhwb3J0LmpzCiAgdmFyIHJlcXVpcmVfZXhwb3J0ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZXhwb3J0LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBnbG9iYWwyID0gcmVxdWlyZV9nbG9iYWwoKTsKICAgICAgdmFyIGlzQ2FsbGFibGUgPSByZXF1aXJlX2lzX2NhbGxhYmxlKCk7CiAgICAgIHZhciBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSByZXF1aXJlX29iamVjdF9nZXRfb3duX3Byb3BlcnR5X2Rlc2NyaXB0b3IoKS5mOwogICAgICB2YXIgaXNGb3JjZWQgPSByZXF1aXJlX2lzX2ZvcmNlZCgpOwogICAgICB2YXIgcGF0aCA9IHJlcXVpcmVfcGF0aCgpOwogICAgICB2YXIgYmluZCA9IHJlcXVpcmVfZnVuY3Rpb25fYmluZF9jb250ZXh0KCk7CiAgICAgIHZhciBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkgPSByZXF1aXJlX2NyZWF0ZV9ub25fZW51bWVyYWJsZV9wcm9wZXJ0eSgpOwogICAgICB2YXIgaGFzID0gcmVxdWlyZV9oYXMoKTsKICAgICAgdmFyIHdyYXBDb25zdHJ1Y3RvciA9IGZ1bmN0aW9uKE5hdGl2ZUNvbnN0cnVjdG9yKSB7CiAgICAgICAgdmFyIFdyYXBwZXIgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgICBpZiAodGhpcyBpbnN0YW5jZW9mIE5hdGl2ZUNvbnN0cnVjdG9yKSB7CiAgICAgICAgICAgIHN3aXRjaCAoYXJndW1lbnRzLmxlbmd0aCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTmF0aXZlQ29uc3RydWN0b3IoKTsKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE5hdGl2ZUNvbnN0cnVjdG9yKGEpOwogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTmF0aXZlQ29uc3RydWN0b3IoYSwgYik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5ldyBOYXRpdmVDb25zdHJ1Y3RvcihhLCBiLCBjKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBOYXRpdmVDb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH07CiAgICAgICAgV3JhcHBlci5wcm90b3R5cGUgPSBOYXRpdmVDb25zdHJ1Y3Rvci5wcm90b3R5cGU7CiAgICAgICAgcmV0dXJuIFdyYXBwZXI7CiAgICAgIH07CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24ob3B0aW9ucywgc291cmNlKSB7CiAgICAgICAgdmFyIFRBUkdFVCA9IG9wdGlvbnMudGFyZ2V0OwogICAgICAgIHZhciBHTE9CQUwgPSBvcHRpb25zLmdsb2JhbDsKICAgICAgICB2YXIgU1RBVElDID0gb3B0aW9ucy5zdGF0OwogICAgICAgIHZhciBQUk9UTyA9IG9wdGlvbnMucHJvdG87CiAgICAgICAgdmFyIG5hdGl2ZVNvdXJjZSA9IEdMT0JBTCA/IGdsb2JhbDIgOiBTVEFUSUMgPyBnbG9iYWwyW1RBUkdFVF0gOiAoZ2xvYmFsMltUQVJHRVRdIHx8IHt9KS5wcm90b3R5cGU7CiAgICAgICAgdmFyIHRhcmdldCA9IEdMT0JBTCA/IHBhdGggOiBwYXRoW1RBUkdFVF0gfHwgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KHBhdGgsIFRBUkdFVCwge30pW1RBUkdFVF07CiAgICAgICAgdmFyIHRhcmdldFByb3RvdHlwZSA9IHRhcmdldC5wcm90b3R5cGU7CiAgICAgICAgdmFyIEZPUkNFRCwgVVNFX05BVElWRSwgVklSVFVBTF9QUk9UT1RZUEU7CiAgICAgICAgdmFyIGtleSwgc291cmNlUHJvcGVydHksIHRhcmdldFByb3BlcnR5LCBuYXRpdmVQcm9wZXJ0eSwgcmVzdWx0UHJvcGVydHksIGRlc2NyaXB0b3I7CiAgICAgICAgZm9yIChrZXkgaW4gc291cmNlKSB7CiAgICAgICAgICBGT1JDRUQgPSBpc0ZvcmNlZChHTE9CQUwgPyBrZXkgOiBUQVJHRVQgKyAoU1RBVElDID8gIi4iIDogIiMiKSArIGtleSwgb3B0aW9ucy5mb3JjZWQpOwogICAgICAgICAgVVNFX05BVElWRSA9ICFGT1JDRUQgJiYgbmF0aXZlU291cmNlICYmIGhhcyhuYXRpdmVTb3VyY2UsIGtleSk7CiAgICAgICAgICB0YXJnZXRQcm9wZXJ0eSA9IHRhcmdldFtrZXldOwogICAgICAgICAgaWYgKFVTRV9OQVRJVkUpCiAgICAgICAgICAgIGlmIChvcHRpb25zLm5vVGFyZ2V0R2V0KSB7CiAgICAgICAgICAgICAgZGVzY3JpcHRvciA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcihuYXRpdmVTb3VyY2UsIGtleSk7CiAgICAgICAgICAgICAgbmF0aXZlUHJvcGVydHkgPSBkZXNjcmlwdG9yICYmIGRlc2NyaXB0b3IudmFsdWU7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIG5hdGl2ZVByb3BlcnR5ID0gbmF0aXZlU291cmNlW2tleV07CiAgICAgICAgICBzb3VyY2VQcm9wZXJ0eSA9IFVTRV9OQVRJVkUgJiYgbmF0aXZlUHJvcGVydHkgPyBuYXRpdmVQcm9wZXJ0eSA6IHNvdXJjZVtrZXldOwogICAgICAgICAgaWYgKFVTRV9OQVRJVkUgJiYgdHlwZW9mIHRhcmdldFByb3BlcnR5ID09PSB0eXBlb2Ygc291cmNlUHJvcGVydHkpCiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgaWYgKG9wdGlvbnMuYmluZCAmJiBVU0VfTkFUSVZFKQogICAgICAgICAgICByZXN1bHRQcm9wZXJ0eSA9IGJpbmQoc291cmNlUHJvcGVydHksIGdsb2JhbDIpOwogICAgICAgICAgZWxzZSBpZiAob3B0aW9ucy53cmFwICYmIFVTRV9OQVRJVkUpCiAgICAgICAgICAgIHJlc3VsdFByb3BlcnR5ID0gd3JhcENvbnN0cnVjdG9yKHNvdXJjZVByb3BlcnR5KTsKICAgICAgICAgIGVsc2UgaWYgKFBST1RPICYmIGlzQ2FsbGFibGUoc291cmNlUHJvcGVydHkpKQogICAgICAgICAgICByZXN1bHRQcm9wZXJ0eSA9IGJpbmQoRnVuY3Rpb24uY2FsbCwgc291cmNlUHJvcGVydHkpOwogICAgICAgICAgZWxzZQogICAgICAgICAgICByZXN1bHRQcm9wZXJ0eSA9IHNvdXJjZVByb3BlcnR5OwogICAgICAgICAgaWYgKG9wdGlvbnMuc2hhbSB8fCBzb3VyY2VQcm9wZXJ0eSAmJiBzb3VyY2VQcm9wZXJ0eS5zaGFtIHx8IHRhcmdldFByb3BlcnR5ICYmIHRhcmdldFByb3BlcnR5LnNoYW0pIHsKICAgICAgICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KHJlc3VsdFByb3BlcnR5LCAic2hhbSIsIHRydWUpOwogICAgICAgICAgfQogICAgICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KHRhcmdldCwga2V5LCByZXN1bHRQcm9wZXJ0eSk7CiAgICAgICAgICBpZiAoUFJPVE8pIHsKICAgICAgICAgICAgVklSVFVBTF9QUk9UT1RZUEUgPSBUQVJHRVQgKyAiUHJvdG90eXBlIjsKICAgICAgICAgICAgaWYgKCFoYXMocGF0aCwgVklSVFVBTF9QUk9UT1RZUEUpKSB7CiAgICAgICAgICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KHBhdGgsIFZJUlRVQUxfUFJPVE9UWVBFLCB7fSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KHBhdGhbVklSVFVBTF9QUk9UT1RZUEVdLCBrZXksIHNvdXJjZVByb3BlcnR5KTsKICAgICAgICAgICAgaWYgKG9wdGlvbnMucmVhbCAmJiB0YXJnZXRQcm90b3R5cGUgJiYgIXRhcmdldFByb3RvdHlwZVtrZXldKSB7CiAgICAgICAgICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KHRhcmdldFByb3RvdHlwZSwga2V5LCBzb3VyY2VQcm9wZXJ0eSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5vYmplY3QuZGVmaW5lLXByb3BlcnR5LmpzCiAgdmFyIHJlcXVpcmVfZXNfb2JqZWN0X2RlZmluZV9wcm9wZXJ0eSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5vYmplY3QuZGVmaW5lLXByb3BlcnR5LmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgJCA9IHJlcXVpcmVfZXhwb3J0KCk7CiAgICAgIHZhciBERVNDUklQVE9SUyA9IHJlcXVpcmVfZGVzY3JpcHRvcnMoKTsKICAgICAgdmFyIG9iamVjdERlZmluZVByb3BlcnR5TW9kaWxlID0gcmVxdWlyZV9vYmplY3RfZGVmaW5lX3Byb3BlcnR5KCk7CiAgICAgICQoeyB0YXJnZXQ6ICJPYmplY3QiLCBzdGF0OiB0cnVlLCBmb3JjZWQ6ICFERVNDUklQVE9SUywgc2hhbTogIURFU0NSSVBUT1JTIH0sIHsKICAgICAgICBkZWZpbmVQcm9wZXJ0eTogb2JqZWN0RGVmaW5lUHJvcGVydHlNb2RpbGUuZgogICAgICB9KTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9vYmplY3QvZGVmaW5lLXByb3BlcnR5LmpzCiAgdmFyIHJlcXVpcmVfZGVmaW5lX3Byb3BlcnR5ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9vYmplY3QvZGVmaW5lLXByb3BlcnR5LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICByZXF1aXJlX2VzX29iamVjdF9kZWZpbmVfcHJvcGVydHkoKTsKICAgICAgdmFyIHBhdGggPSByZXF1aXJlX3BhdGgoKTsKICAgICAgdmFyIE9iamVjdDIgPSBwYXRoLk9iamVjdDsKICAgICAgdmFyIGRlZmluZVByb3BlcnR5ID0gbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0eTIoaXQsIGtleSwgZGVzYykgewogICAgICAgIHJldHVybiBPYmplY3QyLmRlZmluZVByb3BlcnR5KGl0LCBrZXksIGRlc2MpOwogICAgICB9OwogICAgICBpZiAoT2JqZWN0Mi5kZWZpbmVQcm9wZXJ0eS5zaGFtKQogICAgICAgIGRlZmluZVByb3BlcnR5LnNoYW0gPSB0cnVlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9vYmplY3QvZGVmaW5lLXByb3BlcnR5LmpzCiAgdmFyIHJlcXVpcmVfZGVmaW5lX3Byb3BlcnR5MiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL29iamVjdC9kZWZpbmUtcHJvcGVydHkuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX2RlZmluZV9wcm9wZXJ0eSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhcmVudDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy1zdGFibGUvb2JqZWN0L2RlZmluZS1wcm9wZXJ0eS5qcwogIHZhciByZXF1aXJlX2RlZmluZV9wcm9wZXJ0eTMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzLXN0YWJsZS9vYmplY3QvZGVmaW5lLXByb3BlcnR5LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmVfZGVmaW5lX3Byb3BlcnR5MigpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9hZGQtdG8tdW5zY29wYWJsZXMuanMKICB2YXIgcmVxdWlyZV9hZGRfdG9fdW5zY29wYWJsZXMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9hZGQtdG8tdW5zY29wYWJsZXMuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oKSB7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2l0ZXJhdG9ycy5qcwogIHZhciByZXF1aXJlX2l0ZXJhdG9ycyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2l0ZXJhdG9ycy5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSB7fTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvaW5zcGVjdC1zb3VyY2UuanMKICB2YXIgcmVxdWlyZV9pbnNwZWN0X3NvdXJjZSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2luc3BlY3Qtc291cmNlLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgaXNDYWxsYWJsZSA9IHJlcXVpcmVfaXNfY2FsbGFibGUoKTsKICAgICAgdmFyIHN0b3JlID0gcmVxdWlyZV9zaGFyZWRfc3RvcmUoKTsKICAgICAgdmFyIGZ1bmN0aW9uVG9TdHJpbmcgPSBGdW5jdGlvbi50b1N0cmluZzsKICAgICAgaWYgKCFpc0NhbGxhYmxlKHN0b3JlLmluc3BlY3RTb3VyY2UpKSB7CiAgICAgICAgc3RvcmUuaW5zcGVjdFNvdXJjZSA9IGZ1bmN0aW9uKGl0KSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb25Ub1N0cmluZy5jYWxsKGl0KTsKICAgICAgICB9OwogICAgICB9CiAgICAgIG1vZHVsZS5leHBvcnRzID0gc3RvcmUuaW5zcGVjdFNvdXJjZTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvbmF0aXZlLXdlYWstbWFwLmpzCiAgdmFyIHJlcXVpcmVfbmF0aXZlX3dlYWtfbWFwID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvbmF0aXZlLXdlYWstbWFwLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgZ2xvYmFsMiA9IHJlcXVpcmVfZ2xvYmFsKCk7CiAgICAgIHZhciBpc0NhbGxhYmxlID0gcmVxdWlyZV9pc19jYWxsYWJsZSgpOwogICAgICB2YXIgaW5zcGVjdFNvdXJjZSA9IHJlcXVpcmVfaW5zcGVjdF9zb3VyY2UoKTsKICAgICAgdmFyIFdlYWtNYXAgPSBnbG9iYWwyLldlYWtNYXA7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gaXNDYWxsYWJsZShXZWFrTWFwKSAmJiAvbmF0aXZlIGNvZGUvLnRlc3QoaW5zcGVjdFNvdXJjZShXZWFrTWFwKSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL3NoYXJlZC1rZXkuanMKICB2YXIgcmVxdWlyZV9zaGFyZWRfa2V5ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvc2hhcmVkLWtleS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHNoYXJlZCA9IHJlcXVpcmVfc2hhcmVkKCk7CiAgICAgIHZhciB1aWQgPSByZXF1aXJlX3VpZCgpOwogICAgICB2YXIga2V5cyA9IHNoYXJlZCgia2V5cyIpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGtleSkgewogICAgICAgIHJldHVybiBrZXlzW2tleV0gfHwgKGtleXNba2V5XSA9IHVpZChrZXkpKTsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvaGlkZGVuLWtleXMuanMKICB2YXIgcmVxdWlyZV9oaWRkZW5fa2V5cyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2hpZGRlbi1rZXlzLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHt9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9pbnRlcm5hbC1zdGF0ZS5qcwogIHZhciByZXF1aXJlX2ludGVybmFsX3N0YXRlID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvaW50ZXJuYWwtc3RhdGUuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBOQVRJVkVfV0VBS19NQVAgPSByZXF1aXJlX25hdGl2ZV93ZWFrX21hcCgpOwogICAgICB2YXIgZ2xvYmFsMiA9IHJlcXVpcmVfZ2xvYmFsKCk7CiAgICAgIHZhciBpc09iamVjdCA9IHJlcXVpcmVfaXNfb2JqZWN0KCk7CiAgICAgIHZhciBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkgPSByZXF1aXJlX2NyZWF0ZV9ub25fZW51bWVyYWJsZV9wcm9wZXJ0eSgpOwogICAgICB2YXIgb2JqZWN0SGFzID0gcmVxdWlyZV9oYXMoKTsKICAgICAgdmFyIHNoYXJlZCA9IHJlcXVpcmVfc2hhcmVkX3N0b3JlKCk7CiAgICAgIHZhciBzaGFyZWRLZXkgPSByZXF1aXJlX3NoYXJlZF9rZXkoKTsKICAgICAgdmFyIGhpZGRlbktleXMgPSByZXF1aXJlX2hpZGRlbl9rZXlzKCk7CiAgICAgIHZhciBPQkpFQ1RfQUxSRUFEWV9JTklUSUFMSVpFRCA9ICJPYmplY3QgYWxyZWFkeSBpbml0aWFsaXplZCI7CiAgICAgIHZhciBXZWFrTWFwID0gZ2xvYmFsMi5XZWFrTWFwOwogICAgICB2YXIgc2V0MzsKICAgICAgdmFyIGdldDI7CiAgICAgIHZhciBoYXM7CiAgICAgIHZhciBlbmZvcmNlID0gZnVuY3Rpb24oaXQpIHsKICAgICAgICByZXR1cm4gaGFzKGl0KSA/IGdldDIoaXQpIDogc2V0MyhpdCwge30pOwogICAgICB9OwogICAgICB2YXIgZ2V0dGVyRm9yID0gZnVuY3Rpb24oVFlQRSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbihpdCkgewogICAgICAgICAgdmFyIHN0YXRlOwogICAgICAgICAgaWYgKCFpc09iamVjdChpdCkgfHwgKHN0YXRlID0gZ2V0MihpdCkpLnR5cGUgIT09IFRZUEUpIHsKICAgICAgICAgICAgdGhyb3cgVHlwZUVycm9yKCJJbmNvbXBhdGlibGUgcmVjZWl2ZXIsICIgKyBUWVBFICsgIiByZXF1aXJlZCIpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHN0YXRlOwogICAgICAgIH07CiAgICAgIH07CiAgICAgIGlmIChOQVRJVkVfV0VBS19NQVAgfHwgc2hhcmVkLnN0YXRlKSB7CiAgICAgICAgc3RvcmUgPSBzaGFyZWQuc3RhdGUgfHwgKHNoYXJlZC5zdGF0ZSA9IG5ldyBXZWFrTWFwKCkpOwogICAgICAgIHdtZ2V0ID0gc3RvcmUuZ2V0OwogICAgICAgIHdtaGFzID0gc3RvcmUuaGFzOwogICAgICAgIHdtc2V0ID0gc3RvcmUuc2V0OwogICAgICAgIHNldDMgPSBmdW5jdGlvbihpdCwgbWV0YWRhdGEpIHsKICAgICAgICAgIGlmICh3bWhhcy5jYWxsKHN0b3JlLCBpdCkpCiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoT0JKRUNUX0FMUkVBRFlfSU5JVElBTElaRUQpOwogICAgICAgICAgbWV0YWRhdGEuZmFjYWRlID0gaXQ7CiAgICAgICAgICB3bXNldC5jYWxsKHN0b3JlLCBpdCwgbWV0YWRhdGEpOwogICAgICAgICAgcmV0dXJuIG1ldGFkYXRhOwogICAgICAgIH07CiAgICAgICAgZ2V0MiA9IGZ1bmN0aW9uKGl0KSB7CiAgICAgICAgICByZXR1cm4gd21nZXQuY2FsbChzdG9yZSwgaXQpIHx8IHt9OwogICAgICAgIH07CiAgICAgICAgaGFzID0gZnVuY3Rpb24oaXQpIHsKICAgICAgICAgIHJldHVybiB3bWhhcy5jYWxsKHN0b3JlLCBpdCk7CiAgICAgICAgfTsKICAgICAgfSBlbHNlIHsKICAgICAgICBTVEFURSA9IHNoYXJlZEtleSgic3RhdGUiKTsKICAgICAgICBoaWRkZW5LZXlzW1NUQVRFXSA9IHRydWU7CiAgICAgICAgc2V0MyA9IGZ1bmN0aW9uKGl0LCBtZXRhZGF0YSkgewogICAgICAgICAgaWYgKG9iamVjdEhhcyhpdCwgU1RBVEUpKQogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKE9CSkVDVF9BTFJFQURZX0lOSVRJQUxJWkVEKTsKICAgICAgICAgIG1ldGFkYXRhLmZhY2FkZSA9IGl0OwogICAgICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KGl0LCBTVEFURSwgbWV0YWRhdGEpOwogICAgICAgICAgcmV0dXJuIG1ldGFkYXRhOwogICAgICAgIH07CiAgICAgICAgZ2V0MiA9IGZ1bmN0aW9uKGl0KSB7CiAgICAgICAgICByZXR1cm4gb2JqZWN0SGFzKGl0LCBTVEFURSkgPyBpdFtTVEFURV0gOiB7fTsKICAgICAgICB9OwogICAgICAgIGhhcyA9IGZ1bmN0aW9uKGl0KSB7CiAgICAgICAgICByZXR1cm4gb2JqZWN0SGFzKGl0LCBTVEFURSk7CiAgICAgICAgfTsKICAgICAgfQogICAgICB2YXIgc3RvcmU7CiAgICAgIHZhciB3bWdldDsKICAgICAgdmFyIHdtaGFzOwogICAgICB2YXIgd21zZXQ7CiAgICAgIHZhciBTVEFURTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAgICAgc2V0OiBzZXQzLAogICAgICAgIGdldDogZ2V0MiwKICAgICAgICBoYXMsCiAgICAgICAgZW5mb3JjZSwKICAgICAgICBnZXR0ZXJGb3IKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZnVuY3Rpb24tbmFtZS5qcwogIHZhciByZXF1aXJlX2Z1bmN0aW9uX25hbWUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9mdW5jdGlvbi1uYW1lLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgREVTQ1JJUFRPUlMgPSByZXF1aXJlX2Rlc2NyaXB0b3JzKCk7CiAgICAgIHZhciBoYXMgPSByZXF1aXJlX2hhcygpOwogICAgICB2YXIgRnVuY3Rpb25Qcm90b3R5cGUgPSBGdW5jdGlvbi5wcm90b3R5cGU7CiAgICAgIHZhciBnZXREZXNjcmlwdG9yID0gREVTQ1JJUFRPUlMgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcjsKICAgICAgdmFyIEVYSVNUUyA9IGhhcyhGdW5jdGlvblByb3RvdHlwZSwgIm5hbWUiKTsKICAgICAgdmFyIFBST1BFUiA9IEVYSVNUUyAmJiBmdW5jdGlvbiBzb21ldGhpbmcoKSB7CiAgICAgIH0ubmFtZSA9PT0gInNvbWV0aGluZyI7CiAgICAgIHZhciBDT05GSUdVUkFCTEUgPSBFWElTVFMgJiYgKCFERVNDUklQVE9SUyB8fCBERVNDUklQVE9SUyAmJiBnZXREZXNjcmlwdG9yKEZ1bmN0aW9uUHJvdG90eXBlLCAibmFtZSIpLmNvbmZpZ3VyYWJsZSk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICAgIEVYSVNUUywKICAgICAgICBQUk9QRVIsCiAgICAgICAgQ09ORklHVVJBQkxFCiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL3RvLWludGVnZXIuanMKICB2YXIgcmVxdWlyZV90b19pbnRlZ2VyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvdG8taW50ZWdlci5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGNlaWwgPSBNYXRoLmNlaWw7CiAgICAgIHZhciBmbG9vciA9IE1hdGguZmxvb3I7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oYXJndW1lbnQpIHsKICAgICAgICByZXR1cm4gaXNOYU4oYXJndW1lbnQgPSArYXJndW1lbnQpID8gMCA6IChhcmd1bWVudCA+IDAgPyBmbG9vciA6IGNlaWwpKGFyZ3VtZW50KTsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvdG8tbGVuZ3RoLmpzCiAgdmFyIHJlcXVpcmVfdG9fbGVuZ3RoID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvdG8tbGVuZ3RoLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgdG9JbnRlZ2VyID0gcmVxdWlyZV90b19pbnRlZ2VyKCk7CiAgICAgIHZhciBtaW4gPSBNYXRoLm1pbjsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihhcmd1bWVudCkgewogICAgICAgIHJldHVybiBhcmd1bWVudCA+IDAgPyBtaW4odG9JbnRlZ2VyKGFyZ3VtZW50KSwgOTAwNzE5OTI1NDc0MDk5MSkgOiAwOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy90by1hYnNvbHV0ZS1pbmRleC5qcwogIHZhciByZXF1aXJlX3RvX2Fic29sdXRlX2luZGV4ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvdG8tYWJzb2x1dGUtaW5kZXguanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciB0b0ludGVnZXIgPSByZXF1aXJlX3RvX2ludGVnZXIoKTsKICAgICAgdmFyIG1heCA9IE1hdGgubWF4OwogICAgICB2YXIgbWluID0gTWF0aC5taW47CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaW5kZXgsIGxlbmd0aCkgewogICAgICAgIHZhciBpbnRlZ2VyID0gdG9JbnRlZ2VyKGluZGV4KTsKICAgICAgICByZXR1cm4gaW50ZWdlciA8IDAgPyBtYXgoaW50ZWdlciArIGxlbmd0aCwgMCkgOiBtaW4oaW50ZWdlciwgbGVuZ3RoKTsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvYXJyYXktaW5jbHVkZXMuanMKICB2YXIgcmVxdWlyZV9hcnJheV9pbmNsdWRlcyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2FycmF5LWluY2x1ZGVzLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgdG9JbmRleGVkT2JqZWN0ID0gcmVxdWlyZV90b19pbmRleGVkX29iamVjdCgpOwogICAgICB2YXIgdG9MZW5ndGggPSByZXF1aXJlX3RvX2xlbmd0aCgpOwogICAgICB2YXIgdG9BYnNvbHV0ZUluZGV4ID0gcmVxdWlyZV90b19hYnNvbHV0ZV9pbmRleCgpOwogICAgICB2YXIgY3JlYXRlTWV0aG9kID0gZnVuY3Rpb24oSVNfSU5DTFVERVMpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oJHRoaXMsIGVsLCBmcm9tSW5kZXgpIHsKICAgICAgICAgIHZhciBPID0gdG9JbmRleGVkT2JqZWN0KCR0aGlzKTsKICAgICAgICAgIHZhciBsZW5ndGggPSB0b0xlbmd0aChPLmxlbmd0aCk7CiAgICAgICAgICB2YXIgaW5kZXggPSB0b0Fic29sdXRlSW5kZXgoZnJvbUluZGV4LCBsZW5ndGgpOwogICAgICAgICAgdmFyIHZhbHVlOwogICAgICAgICAgaWYgKElTX0lOQ0xVREVTICYmIGVsICE9IGVsKQogICAgICAgICAgICB3aGlsZSAobGVuZ3RoID4gaW5kZXgpIHsKICAgICAgICAgICAgICB2YWx1ZSA9IE9baW5kZXgrK107CiAgICAgICAgICAgICAgaWYgKHZhbHVlICE9IHZhbHVlKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIGVsc2UKICAgICAgICAgICAgZm9yICg7IGxlbmd0aCA+IGluZGV4OyBpbmRleCsrKSB7CiAgICAgICAgICAgICAgaWYgKChJU19JTkNMVURFUyB8fCBpbmRleCBpbiBPKSAmJiBPW2luZGV4XSA9PT0gZWwpCiAgICAgICAgICAgICAgICByZXR1cm4gSVNfSU5DTFVERVMgfHwgaW5kZXggfHwgMDsKICAgICAgICAgICAgfQogICAgICAgICAgcmV0dXJuICFJU19JTkNMVURFUyAmJiAtMTsKICAgICAgICB9OwogICAgICB9OwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgICBpbmNsdWRlczogY3JlYXRlTWV0aG9kKHRydWUpLAogICAgICAgIGluZGV4T2Y6IGNyZWF0ZU1ldGhvZChmYWxzZSkKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvb2JqZWN0LWtleXMtaW50ZXJuYWwuanMKICB2YXIgcmVxdWlyZV9vYmplY3Rfa2V5c19pbnRlcm5hbCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL29iamVjdC1rZXlzLWludGVybmFsLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgaGFzID0gcmVxdWlyZV9oYXMoKTsKICAgICAgdmFyIHRvSW5kZXhlZE9iamVjdCA9IHJlcXVpcmVfdG9faW5kZXhlZF9vYmplY3QoKTsKICAgICAgdmFyIGluZGV4T2YgPSByZXF1aXJlX2FycmF5X2luY2x1ZGVzKCkuaW5kZXhPZjsKICAgICAgdmFyIGhpZGRlbktleXMgPSByZXF1aXJlX2hpZGRlbl9rZXlzKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24ob2JqZWN0LCBuYW1lcykgewogICAgICAgIHZhciBPID0gdG9JbmRleGVkT2JqZWN0KG9iamVjdCk7CiAgICAgICAgdmFyIGkgPSAwOwogICAgICAgIHZhciByZXN1bHQgPSBbXTsKICAgICAgICB2YXIga2V5OwogICAgICAgIGZvciAoa2V5IGluIE8pCiAgICAgICAgICAhaGFzKGhpZGRlbktleXMsIGtleSkgJiYgaGFzKE8sIGtleSkgJiYgcmVzdWx0LnB1c2goa2V5KTsKICAgICAgICB3aGlsZSAobmFtZXMubGVuZ3RoID4gaSkKICAgICAgICAgIGlmIChoYXMoTywga2V5ID0gbmFtZXNbaSsrXSkpIHsKICAgICAgICAgICAgfmluZGV4T2YocmVzdWx0LCBrZXkpIHx8IHJlc3VsdC5wdXNoKGtleSk7CiAgICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZW51bS1idWcta2V5cy5qcwogIHZhciByZXF1aXJlX2VudW1fYnVnX2tleXMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9lbnVtLWJ1Zy1rZXlzLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IFsKICAgICAgICAiY29uc3RydWN0b3IiLAogICAgICAgICJoYXNPd25Qcm9wZXJ0eSIsCiAgICAgICAgImlzUHJvdG90eXBlT2YiLAogICAgICAgICJwcm9wZXJ0eUlzRW51bWVyYWJsZSIsCiAgICAgICAgInRvTG9jYWxlU3RyaW5nIiwKICAgICAgICAidG9TdHJpbmciLAogICAgICAgICJ2YWx1ZU9mIgogICAgICBdOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9vYmplY3Qta2V5cy5qcwogIHZhciByZXF1aXJlX29iamVjdF9rZXlzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvb2JqZWN0LWtleXMuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBpbnRlcm5hbE9iamVjdEtleXMgPSByZXF1aXJlX29iamVjdF9rZXlzX2ludGVybmFsKCk7CiAgICAgIHZhciBlbnVtQnVnS2V5cyA9IHJlcXVpcmVfZW51bV9idWdfa2V5cygpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IE9iamVjdC5rZXlzIHx8IGZ1bmN0aW9uIGtleXMoTykgewogICAgICAgIHJldHVybiBpbnRlcm5hbE9iamVjdEtleXMoTywgZW51bUJ1Z0tleXMpOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9vYmplY3QtZGVmaW5lLXByb3BlcnRpZXMuanMKICB2YXIgcmVxdWlyZV9vYmplY3RfZGVmaW5lX3Byb3BlcnRpZXMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9vYmplY3QtZGVmaW5lLXByb3BlcnRpZXMuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBERVNDUklQVE9SUyA9IHJlcXVpcmVfZGVzY3JpcHRvcnMoKTsKICAgICAgdmFyIGRlZmluZVByb3BlcnR5TW9kdWxlID0gcmVxdWlyZV9vYmplY3RfZGVmaW5lX3Byb3BlcnR5KCk7CiAgICAgIHZhciBhbk9iamVjdCA9IHJlcXVpcmVfYW5fb2JqZWN0KCk7CiAgICAgIHZhciBvYmplY3RLZXlzID0gcmVxdWlyZV9vYmplY3Rfa2V5cygpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IERFU0NSSVBUT1JTID8gT2JqZWN0LmRlZmluZVByb3BlcnRpZXMgOiBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKE8sIFByb3BlcnRpZXMpIHsKICAgICAgICBhbk9iamVjdChPKTsKICAgICAgICB2YXIga2V5cyA9IG9iamVjdEtleXMoUHJvcGVydGllcyk7CiAgICAgICAgdmFyIGxlbmd0aCA9IGtleXMubGVuZ3RoOwogICAgICAgIHZhciBpbmRleCA9IDA7CiAgICAgICAgdmFyIGtleTsKICAgICAgICB3aGlsZSAobGVuZ3RoID4gaW5kZXgpCiAgICAgICAgICBkZWZpbmVQcm9wZXJ0eU1vZHVsZS5mKE8sIGtleSA9IGtleXNbaW5kZXgrK10sIFByb3BlcnRpZXNba2V5XSk7CiAgICAgICAgcmV0dXJuIE87CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2h0bWwuanMKICB2YXIgcmVxdWlyZV9odG1sID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvaHRtbC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGdldEJ1aWx0SW4gPSByZXF1aXJlX2dldF9idWlsdF9pbigpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGdldEJ1aWx0SW4oImRvY3VtZW50IiwgImRvY3VtZW50RWxlbWVudCIpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9vYmplY3QtY3JlYXRlLmpzCiAgdmFyIHJlcXVpcmVfb2JqZWN0X2NyZWF0ZSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL29iamVjdC1jcmVhdGUuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBhbk9iamVjdCA9IHJlcXVpcmVfYW5fb2JqZWN0KCk7CiAgICAgIHZhciBkZWZpbmVQcm9wZXJ0aWVzID0gcmVxdWlyZV9vYmplY3RfZGVmaW5lX3Byb3BlcnRpZXMoKTsKICAgICAgdmFyIGVudW1CdWdLZXlzID0gcmVxdWlyZV9lbnVtX2J1Z19rZXlzKCk7CiAgICAgIHZhciBoaWRkZW5LZXlzID0gcmVxdWlyZV9oaWRkZW5fa2V5cygpOwogICAgICB2YXIgaHRtbCA9IHJlcXVpcmVfaHRtbCgpOwogICAgICB2YXIgZG9jdW1lbnRDcmVhdGVFbGVtZW50ID0gcmVxdWlyZV9kb2N1bWVudF9jcmVhdGVfZWxlbWVudCgpOwogICAgICB2YXIgc2hhcmVkS2V5ID0gcmVxdWlyZV9zaGFyZWRfa2V5KCk7CiAgICAgIHZhciBHVCA9ICI+IjsKICAgICAgdmFyIExUID0gIjwiOwogICAgICB2YXIgUFJPVE9UWVBFID0gInByb3RvdHlwZSI7CiAgICAgIHZhciBTQ1JJUFQgPSAic2NyaXB0IjsKICAgICAgdmFyIElFX1BST1RPID0gc2hhcmVkS2V5KCJJRV9QUk9UTyIpOwogICAgICB2YXIgRW1wdHlDb25zdHJ1Y3RvciA9IGZ1bmN0aW9uKCkgewogICAgICB9OwogICAgICB2YXIgc2NyaXB0VGFnID0gZnVuY3Rpb24oY29udGVudCkgewogICAgICAgIHJldHVybiBMVCArIFNDUklQVCArIEdUICsgY29udGVudCArIExUICsgIi8iICsgU0NSSVBUICsgR1Q7CiAgICAgIH07CiAgICAgIHZhciBOdWxsUHJvdG9PYmplY3RWaWFBY3RpdmVYID0gZnVuY3Rpb24oYWN0aXZlWERvY3VtZW50MikgewogICAgICAgIGFjdGl2ZVhEb2N1bWVudDIud3JpdGUoc2NyaXB0VGFnKCIiKSk7CiAgICAgICAgYWN0aXZlWERvY3VtZW50Mi5jbG9zZSgpOwogICAgICAgIHZhciB0ZW1wID0gYWN0aXZlWERvY3VtZW50Mi5wYXJlbnRXaW5kb3cuT2JqZWN0OwogICAgICAgIGFjdGl2ZVhEb2N1bWVudDIgPSBudWxsOwogICAgICAgIHJldHVybiB0ZW1wOwogICAgICB9OwogICAgICB2YXIgTnVsbFByb3RvT2JqZWN0VmlhSUZyYW1lID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGlmcmFtZSA9IGRvY3VtZW50Q3JlYXRlRWxlbWVudCgiaWZyYW1lIik7CiAgICAgICAgdmFyIEpTID0gImphdmEiICsgU0NSSVBUICsgIjoiOwogICAgICAgIHZhciBpZnJhbWVEb2N1bWVudDsKICAgICAgICBpZnJhbWUuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICBodG1sLmFwcGVuZENoaWxkKGlmcmFtZSk7CiAgICAgICAgaWZyYW1lLnNyYyA9IFN0cmluZyhKUyk7CiAgICAgICAgaWZyYW1lRG9jdW1lbnQgPSBpZnJhbWUuY29udGVudFdpbmRvdy5kb2N1bWVudDsKICAgICAgICBpZnJhbWVEb2N1bWVudC5vcGVuKCk7CiAgICAgICAgaWZyYW1lRG9jdW1lbnQud3JpdGUoc2NyaXB0VGFnKCJkb2N1bWVudC5GPU9iamVjdCIpKTsKICAgICAgICBpZnJhbWVEb2N1bWVudC5jbG9zZSgpOwogICAgICAgIHJldHVybiBpZnJhbWVEb2N1bWVudC5GOwogICAgICB9OwogICAgICB2YXIgYWN0aXZlWERvY3VtZW50OwogICAgICB2YXIgTnVsbFByb3RvT2JqZWN0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGFjdGl2ZVhEb2N1bWVudCA9IG5ldyBBY3RpdmVYT2JqZWN0KCJodG1sZmlsZSIpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgfQogICAgICAgIE51bGxQcm90b09iamVjdCA9IHR5cGVvZiBkb2N1bWVudCAhPSAidW5kZWZpbmVkIiA/IGRvY3VtZW50LmRvbWFpbiAmJiBhY3RpdmVYRG9jdW1lbnQgPyBOdWxsUHJvdG9PYmplY3RWaWFBY3RpdmVYKGFjdGl2ZVhEb2N1bWVudCkgOiBOdWxsUHJvdG9PYmplY3RWaWFJRnJhbWUoKSA6IE51bGxQcm90b09iamVjdFZpYUFjdGl2ZVgoYWN0aXZlWERvY3VtZW50KTsKICAgICAgICB2YXIgbGVuZ3RoID0gZW51bUJ1Z0tleXMubGVuZ3RoOwogICAgICAgIHdoaWxlIChsZW5ndGgtLSkKICAgICAgICAgIGRlbGV0ZSBOdWxsUHJvdG9PYmplY3RbUFJPVE9UWVBFXVtlbnVtQnVnS2V5c1tsZW5ndGhdXTsKICAgICAgICByZXR1cm4gTnVsbFByb3RvT2JqZWN0KCk7CiAgICAgIH07CiAgICAgIGhpZGRlbktleXNbSUVfUFJPVE9dID0gdHJ1ZTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBPYmplY3QuY3JlYXRlIHx8IGZ1bmN0aW9uIGNyZWF0ZShPLCBQcm9wZXJ0aWVzKSB7CiAgICAgICAgdmFyIHJlc3VsdDsKICAgICAgICBpZiAoTyAhPT0gbnVsbCkgewogICAgICAgICAgRW1wdHlDb25zdHJ1Y3RvcltQUk9UT1RZUEVdID0gYW5PYmplY3QoTyk7CiAgICAgICAgICByZXN1bHQgPSBuZXcgRW1wdHlDb25zdHJ1Y3RvcigpOwogICAgICAgICAgRW1wdHlDb25zdHJ1Y3RvcltQUk9UT1RZUEVdID0gbnVsbDsKICAgICAgICAgIHJlc3VsdFtJRV9QUk9UT10gPSBPOwogICAgICAgIH0gZWxzZQogICAgICAgICAgcmVzdWx0ID0gTnVsbFByb3RvT2JqZWN0KCk7CiAgICAgICAgcmV0dXJuIFByb3BlcnRpZXMgPT09IHZvaWQgMCA/IHJlc3VsdCA6IGRlZmluZVByb3BlcnRpZXMocmVzdWx0LCBQcm9wZXJ0aWVzKTsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvY29ycmVjdC1wcm90b3R5cGUtZ2V0dGVyLmpzCiAgdmFyIHJlcXVpcmVfY29ycmVjdF9wcm90b3R5cGVfZ2V0dGVyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvY29ycmVjdC1wcm90b3R5cGUtZ2V0dGVyLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgZmFpbHMgPSByZXF1aXJlX2ZhaWxzKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gIWZhaWxzKGZ1bmN0aW9uKCkgewogICAgICAgIGZ1bmN0aW9uIEYoKSB7CiAgICAgICAgfQogICAgICAgIEYucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gbnVsbDsKICAgICAgICByZXR1cm4gT2JqZWN0LmdldFByb3RvdHlwZU9mKG5ldyBGKCkpICE9PSBGLnByb3RvdHlwZTsKICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL29iamVjdC1nZXQtcHJvdG90eXBlLW9mLmpzCiAgdmFyIHJlcXVpcmVfb2JqZWN0X2dldF9wcm90b3R5cGVfb2YgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9vYmplY3QtZ2V0LXByb3RvdHlwZS1vZi5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGhhcyA9IHJlcXVpcmVfaGFzKCk7CiAgICAgIHZhciBpc0NhbGxhYmxlID0gcmVxdWlyZV9pc19jYWxsYWJsZSgpOwogICAgICB2YXIgdG9PYmplY3QgPSByZXF1aXJlX3RvX29iamVjdCgpOwogICAgICB2YXIgc2hhcmVkS2V5ID0gcmVxdWlyZV9zaGFyZWRfa2V5KCk7CiAgICAgIHZhciBDT1JSRUNUX1BST1RPVFlQRV9HRVRURVIgPSByZXF1aXJlX2NvcnJlY3RfcHJvdG90eXBlX2dldHRlcigpOwogICAgICB2YXIgSUVfUFJPVE8gPSBzaGFyZWRLZXkoIklFX1BST1RPIik7CiAgICAgIHZhciBPYmplY3RQcm90b3R5cGUgPSBPYmplY3QucHJvdG90eXBlOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IENPUlJFQ1RfUFJPVE9UWVBFX0dFVFRFUiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uKE8pIHsKICAgICAgICB2YXIgb2JqZWN0ID0gdG9PYmplY3QoTyk7CiAgICAgICAgaWYgKGhhcyhvYmplY3QsIElFX1BST1RPKSkKICAgICAgICAgIHJldHVybiBvYmplY3RbSUVfUFJPVE9dOwogICAgICAgIHZhciBjb25zdHJ1Y3RvciA9IG9iamVjdC5jb25zdHJ1Y3RvcjsKICAgICAgICBpZiAoaXNDYWxsYWJsZShjb25zdHJ1Y3RvcikgJiYgb2JqZWN0IGluc3RhbmNlb2YgY29uc3RydWN0b3IpIHsKICAgICAgICAgIHJldHVybiBjb25zdHJ1Y3Rvci5wcm90b3R5cGU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBvYmplY3QgaW5zdGFuY2VvZiBPYmplY3QgPyBPYmplY3RQcm90b3R5cGUgOiBudWxsOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9yZWRlZmluZS5qcwogIHZhciByZXF1aXJlX3JlZGVmaW5lID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvcmVkZWZpbmUuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkgPSByZXF1aXJlX2NyZWF0ZV9ub25fZW51bWVyYWJsZV9wcm9wZXJ0eSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKHRhcmdldCwga2V5LCB2YWx1ZSwgb3B0aW9ucykgewogICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuZW51bWVyYWJsZSkKICAgICAgICAgIHRhcmdldFtrZXldID0gdmFsdWU7CiAgICAgICAgZWxzZQogICAgICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KHRhcmdldCwga2V5LCB2YWx1ZSk7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2l0ZXJhdG9ycy1jb3JlLmpzCiAgdmFyIHJlcXVpcmVfaXRlcmF0b3JzX2NvcmUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9pdGVyYXRvcnMtY29yZS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgZmFpbHMgPSByZXF1aXJlX2ZhaWxzKCk7CiAgICAgIHZhciBpc0NhbGxhYmxlID0gcmVxdWlyZV9pc19jYWxsYWJsZSgpOwogICAgICB2YXIgY3JlYXRlID0gcmVxdWlyZV9vYmplY3RfY3JlYXRlKCk7CiAgICAgIHZhciBnZXRQcm90b3R5cGVPZiA9IHJlcXVpcmVfb2JqZWN0X2dldF9wcm90b3R5cGVfb2YoKTsKICAgICAgdmFyIHJlZGVmaW5lID0gcmVxdWlyZV9yZWRlZmluZSgpOwogICAgICB2YXIgd2VsbEtub3duU3ltYm9sID0gcmVxdWlyZV93ZWxsX2tub3duX3N5bWJvbCgpOwogICAgICB2YXIgSVNfUFVSRSA9IHJlcXVpcmVfaXNfcHVyZSgpOwogICAgICB2YXIgSVRFUkFUT1IgPSB3ZWxsS25vd25TeW1ib2woIml0ZXJhdG9yIik7CiAgICAgIHZhciBCVUdHWV9TQUZBUklfSVRFUkFUT1JTID0gZmFsc2U7CiAgICAgIHZhciBJdGVyYXRvclByb3RvdHlwZTsKICAgICAgdmFyIFByb3RvdHlwZU9mQXJyYXlJdGVyYXRvclByb3RvdHlwZTsKICAgICAgdmFyIGFycmF5SXRlcmF0b3I7CiAgICAgIGlmIChbXS5rZXlzKSB7CiAgICAgICAgYXJyYXlJdGVyYXRvciA9IFtdLmtleXMoKTsKICAgICAgICBpZiAoISgibmV4dCIgaW4gYXJyYXlJdGVyYXRvcikpCiAgICAgICAgICBCVUdHWV9TQUZBUklfSVRFUkFUT1JTID0gdHJ1ZTsKICAgICAgICBlbHNlIHsKICAgICAgICAgIFByb3RvdHlwZU9mQXJyYXlJdGVyYXRvclByb3RvdHlwZSA9IGdldFByb3RvdHlwZU9mKGdldFByb3RvdHlwZU9mKGFycmF5SXRlcmF0b3IpKTsKICAgICAgICAgIGlmIChQcm90b3R5cGVPZkFycmF5SXRlcmF0b3JQcm90b3R5cGUgIT09IE9iamVjdC5wcm90b3R5cGUpCiAgICAgICAgICAgIEl0ZXJhdG9yUHJvdG90eXBlID0gUHJvdG90eXBlT2ZBcnJheUl0ZXJhdG9yUHJvdG90eXBlOwogICAgICAgIH0KICAgICAgfQogICAgICB2YXIgTkVXX0lURVJBVE9SX1BST1RPVFlQRSA9IEl0ZXJhdG9yUHJvdG90eXBlID09IHZvaWQgMCB8fCBmYWlscyhmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdGVzdCA9IHt9OwogICAgICAgIHJldHVybiBJdGVyYXRvclByb3RvdHlwZVtJVEVSQVRPUl0uY2FsbCh0ZXN0KSAhPT0gdGVzdDsKICAgICAgfSk7CiAgICAgIGlmIChORVdfSVRFUkFUT1JfUFJPVE9UWVBFKQogICAgICAgIEl0ZXJhdG9yUHJvdG90eXBlID0ge307CiAgICAgIGVsc2UgaWYgKElTX1BVUkUpCiAgICAgICAgSXRlcmF0b3JQcm90b3R5cGUgPSBjcmVhdGUoSXRlcmF0b3JQcm90b3R5cGUpOwogICAgICBpZiAoIWlzQ2FsbGFibGUoSXRlcmF0b3JQcm90b3R5cGVbSVRFUkFUT1JdKSkgewogICAgICAgIHJlZGVmaW5lKEl0ZXJhdG9yUHJvdG90eXBlLCBJVEVSQVRPUiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9KTsKICAgICAgfQogICAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgICBJdGVyYXRvclByb3RvdHlwZSwKICAgICAgICBCVUdHWV9TQUZBUklfSVRFUkFUT1JTCiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL3RvLXN0cmluZy10YWctc3VwcG9ydC5qcwogIHZhciByZXF1aXJlX3RvX3N0cmluZ190YWdfc3VwcG9ydCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL3RvLXN0cmluZy10YWctc3VwcG9ydC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHdlbGxLbm93blN5bWJvbCA9IHJlcXVpcmVfd2VsbF9rbm93bl9zeW1ib2woKTsKICAgICAgdmFyIFRPX1NUUklOR19UQUcgPSB3ZWxsS25vd25TeW1ib2woInRvU3RyaW5nVGFnIik7CiAgICAgIHZhciB0ZXN0ID0ge307CiAgICAgIHRlc3RbVE9fU1RSSU5HX1RBR10gPSAieiI7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gU3RyaW5nKHRlc3QpID09PSAiW29iamVjdCB6XSI7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2NsYXNzb2YuanMKICB2YXIgcmVxdWlyZV9jbGFzc29mID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvY2xhc3NvZi5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIFRPX1NUUklOR19UQUdfU1VQUE9SVCA9IHJlcXVpcmVfdG9fc3RyaW5nX3RhZ19zdXBwb3J0KCk7CiAgICAgIHZhciBpc0NhbGxhYmxlID0gcmVxdWlyZV9pc19jYWxsYWJsZSgpOwogICAgICB2YXIgY2xhc3NvZlJhdyA9IHJlcXVpcmVfY2xhc3NvZl9yYXcoKTsKICAgICAgdmFyIHdlbGxLbm93blN5bWJvbCA9IHJlcXVpcmVfd2VsbF9rbm93bl9zeW1ib2woKTsKICAgICAgdmFyIFRPX1NUUklOR19UQUcgPSB3ZWxsS25vd25TeW1ib2woInRvU3RyaW5nVGFnIik7CiAgICAgIHZhciBDT1JSRUNUX0FSR1VNRU5UUyA9IGNsYXNzb2ZSYXcoZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGFyZ3VtZW50czsKICAgICAgfSgpKSA9PSAiQXJndW1lbnRzIjsKICAgICAgdmFyIHRyeUdldCA9IGZ1bmN0aW9uKGl0LCBrZXkpIHsKICAgICAgICB0cnkgewogICAgICAgICAgcmV0dXJuIGl0W2tleV07CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICB9CiAgICAgIH07CiAgICAgIG1vZHVsZS5leHBvcnRzID0gVE9fU1RSSU5HX1RBR19TVVBQT1JUID8gY2xhc3NvZlJhdyA6IGZ1bmN0aW9uKGl0KSB7CiAgICAgICAgdmFyIE8sIHRhZywgcmVzdWx0OwogICAgICAgIHJldHVybiBpdCA9PT0gdm9pZCAwID8gIlVuZGVmaW5lZCIgOiBpdCA9PT0gbnVsbCA/ICJOdWxsIiA6IHR5cGVvZiAodGFnID0gdHJ5R2V0KE8gPSBPYmplY3QoaXQpLCBUT19TVFJJTkdfVEFHKSkgPT0gInN0cmluZyIgPyB0YWcgOiBDT1JSRUNUX0FSR1VNRU5UUyA/IGNsYXNzb2ZSYXcoTykgOiAocmVzdWx0ID0gY2xhc3NvZlJhdyhPKSkgPT0gIk9iamVjdCIgJiYgaXNDYWxsYWJsZShPLmNhbGxlZSkgPyAiQXJndW1lbnRzIiA6IHJlc3VsdDsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvb2JqZWN0LXRvLXN0cmluZy5qcwogIHZhciByZXF1aXJlX29iamVjdF90b19zdHJpbmcgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9vYmplY3QtdG8tc3RyaW5nLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBUT19TVFJJTkdfVEFHX1NVUFBPUlQgPSByZXF1aXJlX3RvX3N0cmluZ190YWdfc3VwcG9ydCgpOwogICAgICB2YXIgY2xhc3NvZiA9IHJlcXVpcmVfY2xhc3NvZigpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IFRPX1NUUklOR19UQUdfU1VQUE9SVCA/IHt9LnRvU3RyaW5nIDogZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgICAgcmV0dXJuICJbb2JqZWN0ICIgKyBjbGFzc29mKHRoaXMpICsgIl0iOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9zZXQtdG8tc3RyaW5nLXRhZy5qcwogIHZhciByZXF1aXJlX3NldF90b19zdHJpbmdfdGFnID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvc2V0LXRvLXN0cmluZy10YWcuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBUT19TVFJJTkdfVEFHX1NVUFBPUlQgPSByZXF1aXJlX3RvX3N0cmluZ190YWdfc3VwcG9ydCgpOwogICAgICB2YXIgZGVmaW5lUHJvcGVydHkgPSByZXF1aXJlX29iamVjdF9kZWZpbmVfcHJvcGVydHkoKS5mOwogICAgICB2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5ID0gcmVxdWlyZV9jcmVhdGVfbm9uX2VudW1lcmFibGVfcHJvcGVydHkoKTsKICAgICAgdmFyIGhhcyA9IHJlcXVpcmVfaGFzKCk7CiAgICAgIHZhciB0b1N0cmluZyA9IHJlcXVpcmVfb2JqZWN0X3RvX3N0cmluZygpOwogICAgICB2YXIgd2VsbEtub3duU3ltYm9sID0gcmVxdWlyZV93ZWxsX2tub3duX3N5bWJvbCgpOwogICAgICB2YXIgVE9fU1RSSU5HX1RBRyA9IHdlbGxLbm93blN5bWJvbCgidG9TdHJpbmdUYWciKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCwgVEFHLCBTVEFUSUMsIFNFVF9NRVRIT0QpIHsKICAgICAgICBpZiAoaXQpIHsKICAgICAgICAgIHZhciB0YXJnZXQgPSBTVEFUSUMgPyBpdCA6IGl0LnByb3RvdHlwZTsKICAgICAgICAgIGlmICghaGFzKHRhcmdldCwgVE9fU1RSSU5HX1RBRykpIHsKICAgICAgICAgICAgZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBUT19TVFJJTkdfVEFHLCB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSwgdmFsdWU6IFRBRyB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChTRVRfTUVUSE9EICYmICFUT19TVFJJTkdfVEFHX1NVUFBPUlQpIHsKICAgICAgICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KHRhcmdldCwgInRvU3RyaW5nIiwgdG9TdHJpbmcpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvY3JlYXRlLWl0ZXJhdG9yLWNvbnN0cnVjdG9yLmpzCiAgdmFyIHJlcXVpcmVfY3JlYXRlX2l0ZXJhdG9yX2NvbnN0cnVjdG9yID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvY3JlYXRlLWl0ZXJhdG9yLWNvbnN0cnVjdG9yLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBJdGVyYXRvclByb3RvdHlwZSA9IHJlcXVpcmVfaXRlcmF0b3JzX2NvcmUoKS5JdGVyYXRvclByb3RvdHlwZTsKICAgICAgdmFyIGNyZWF0ZSA9IHJlcXVpcmVfb2JqZWN0X2NyZWF0ZSgpOwogICAgICB2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yID0gcmVxdWlyZV9jcmVhdGVfcHJvcGVydHlfZGVzY3JpcHRvcigpOwogICAgICB2YXIgc2V0VG9TdHJpbmdUYWcgPSByZXF1aXJlX3NldF90b19zdHJpbmdfdGFnKCk7CiAgICAgIHZhciBJdGVyYXRvcnMgPSByZXF1aXJlX2l0ZXJhdG9ycygpOwogICAgICB2YXIgcmV0dXJuVGhpcyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9OwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKEl0ZXJhdG9yQ29uc3RydWN0b3IsIE5BTUUsIG5leHQpIHsKICAgICAgICB2YXIgVE9fU1RSSU5HX1RBRyA9IE5BTUUgKyAiIEl0ZXJhdG9yIjsKICAgICAgICBJdGVyYXRvckNvbnN0cnVjdG9yLnByb3RvdHlwZSA9IGNyZWF0ZShJdGVyYXRvclByb3RvdHlwZSwgeyBuZXh0OiBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IoMSwgbmV4dCkgfSk7CiAgICAgICAgc2V0VG9TdHJpbmdUYWcoSXRlcmF0b3JDb25zdHJ1Y3RvciwgVE9fU1RSSU5HX1RBRywgZmFsc2UsIHRydWUpOwogICAgICAgIEl0ZXJhdG9yc1tUT19TVFJJTkdfVEFHXSA9IHJldHVyblRoaXM7CiAgICAgICAgcmV0dXJuIEl0ZXJhdG9yQ29uc3RydWN0b3I7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2EtcG9zc2libGUtcHJvdG90eXBlLmpzCiAgdmFyIHJlcXVpcmVfYV9wb3NzaWJsZV9wcm90b3R5cGUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9hLXBvc3NpYmxlLXByb3RvdHlwZS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGlzQ2FsbGFibGUgPSByZXF1aXJlX2lzX2NhbGxhYmxlKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oYXJndW1lbnQpIHsKICAgICAgICBpZiAodHlwZW9mIGFyZ3VtZW50ID09PSAib2JqZWN0IiB8fCBpc0NhbGxhYmxlKGFyZ3VtZW50KSkKICAgICAgICAgIHJldHVybiBhcmd1bWVudDsKICAgICAgICB0aHJvdyBUeXBlRXJyb3IoIkNhbid0IHNldCAiICsgU3RyaW5nKGFyZ3VtZW50KSArICIgYXMgYSBwcm90b3R5cGUiKTsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvb2JqZWN0LXNldC1wcm90b3R5cGUtb2YuanMKICB2YXIgcmVxdWlyZV9vYmplY3Rfc2V0X3Byb3RvdHlwZV9vZiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL29iamVjdC1zZXQtcHJvdG90eXBlLW9mLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgYW5PYmplY3QgPSByZXF1aXJlX2FuX29iamVjdCgpOwogICAgICB2YXIgYVBvc3NpYmxlUHJvdG90eXBlID0gcmVxdWlyZV9hX3Bvc3NpYmxlX3Byb3RvdHlwZSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCAoIl9fcHJvdG9fXyIgaW4ge30gPyBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgQ09SUkVDVF9TRVRURVIgPSBmYWxzZTsKICAgICAgICB2YXIgdGVzdCA9IHt9OwogICAgICAgIHZhciBzZXR0ZXI7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHNldHRlciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoT2JqZWN0LnByb3RvdHlwZSwgIl9fcHJvdG9fXyIpLnNldDsKICAgICAgICAgIHNldHRlci5jYWxsKHRlc3QsIFtdKTsKICAgICAgICAgIENPUlJFQ1RfU0VUVEVSID0gdGVzdCBpbnN0YW5jZW9mIEFycmF5OwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmdW5jdGlvbiBzZXRQcm90b3R5cGVPZihPLCBwcm90bzIpIHsKICAgICAgICAgIGFuT2JqZWN0KE8pOwogICAgICAgICAgYVBvc3NpYmxlUHJvdG90eXBlKHByb3RvMik7CiAgICAgICAgICBpZiAoQ09SUkVDVF9TRVRURVIpCiAgICAgICAgICAgIHNldHRlci5jYWxsKE8sIHByb3RvMik7CiAgICAgICAgICBlbHNlCiAgICAgICAgICAgIE8uX19wcm90b19fID0gcHJvdG8yOwogICAgICAgICAgcmV0dXJuIE87CiAgICAgICAgfTsKICAgICAgfSgpIDogdm9pZCAwKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZGVmaW5lLWl0ZXJhdG9yLmpzCiAgdmFyIHJlcXVpcmVfZGVmaW5lX2l0ZXJhdG9yID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZGVmaW5lLWl0ZXJhdG9yLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciAkID0gcmVxdWlyZV9leHBvcnQoKTsKICAgICAgdmFyIElTX1BVUkUgPSByZXF1aXJlX2lzX3B1cmUoKTsKICAgICAgdmFyIEZ1bmN0aW9uTmFtZSA9IHJlcXVpcmVfZnVuY3Rpb25fbmFtZSgpOwogICAgICB2YXIgaXNDYWxsYWJsZSA9IHJlcXVpcmVfaXNfY2FsbGFibGUoKTsKICAgICAgdmFyIGNyZWF0ZUl0ZXJhdG9yQ29uc3RydWN0b3IgPSByZXF1aXJlX2NyZWF0ZV9pdGVyYXRvcl9jb25zdHJ1Y3RvcigpOwogICAgICB2YXIgZ2V0UHJvdG90eXBlT2YgPSByZXF1aXJlX29iamVjdF9nZXRfcHJvdG90eXBlX29mKCk7CiAgICAgIHZhciBzZXRQcm90b3R5cGVPZiA9IHJlcXVpcmVfb2JqZWN0X3NldF9wcm90b3R5cGVfb2YoKTsKICAgICAgdmFyIHNldFRvU3RyaW5nVGFnID0gcmVxdWlyZV9zZXRfdG9fc3RyaW5nX3RhZygpOwogICAgICB2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5ID0gcmVxdWlyZV9jcmVhdGVfbm9uX2VudW1lcmFibGVfcHJvcGVydHkoKTsKICAgICAgdmFyIHJlZGVmaW5lID0gcmVxdWlyZV9yZWRlZmluZSgpOwogICAgICB2YXIgd2VsbEtub3duU3ltYm9sID0gcmVxdWlyZV93ZWxsX2tub3duX3N5bWJvbCgpOwogICAgICB2YXIgSXRlcmF0b3JzID0gcmVxdWlyZV9pdGVyYXRvcnMoKTsKICAgICAgdmFyIEl0ZXJhdG9yc0NvcmUgPSByZXF1aXJlX2l0ZXJhdG9yc19jb3JlKCk7CiAgICAgIHZhciBQUk9QRVJfRlVOQ1RJT05fTkFNRSA9IEZ1bmN0aW9uTmFtZS5QUk9QRVI7CiAgICAgIHZhciBDT05GSUdVUkFCTEVfRlVOQ1RJT05fTkFNRSA9IEZ1bmN0aW9uTmFtZS5DT05GSUdVUkFCTEU7CiAgICAgIHZhciBJdGVyYXRvclByb3RvdHlwZSA9IEl0ZXJhdG9yc0NvcmUuSXRlcmF0b3JQcm90b3R5cGU7CiAgICAgIHZhciBCVUdHWV9TQUZBUklfSVRFUkFUT1JTID0gSXRlcmF0b3JzQ29yZS5CVUdHWV9TQUZBUklfSVRFUkFUT1JTOwogICAgICB2YXIgSVRFUkFUT1IgPSB3ZWxsS25vd25TeW1ib2woIml0ZXJhdG9yIik7CiAgICAgIHZhciBLRVlTID0gImtleXMiOwogICAgICB2YXIgVkFMVUVTID0gInZhbHVlcyI7CiAgICAgIHZhciBFTlRSSUVTID0gImVudHJpZXMiOwogICAgICB2YXIgcmV0dXJuVGhpcyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9OwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKEl0ZXJhYmxlLCBOQU1FLCBJdGVyYXRvckNvbnN0cnVjdG9yLCBuZXh0LCBERUZBVUxULCBJU19TRVQsIEZPUkNFRCkgewogICAgICAgIGNyZWF0ZUl0ZXJhdG9yQ29uc3RydWN0b3IoSXRlcmF0b3JDb25zdHJ1Y3RvciwgTkFNRSwgbmV4dCk7CiAgICAgICAgdmFyIGdldEl0ZXJhdGlvbk1ldGhvZCA9IGZ1bmN0aW9uKEtJTkQpIHsKICAgICAgICAgIGlmIChLSU5EID09PSBERUZBVUxUICYmIGRlZmF1bHRJdGVyYXRvcikKICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRJdGVyYXRvcjsKICAgICAgICAgIGlmICghQlVHR1lfU0FGQVJJX0lURVJBVE9SUyAmJiBLSU5EIGluIEl0ZXJhYmxlUHJvdG90eXBlKQogICAgICAgICAgICByZXR1cm4gSXRlcmFibGVQcm90b3R5cGVbS0lORF07CiAgICAgICAgICBzd2l0Y2ggKEtJTkQpIHsKICAgICAgICAgICAgY2FzZSBLRVlTOgogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiBrZXlzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBJdGVyYXRvckNvbnN0cnVjdG9yKHRoaXMsIEtJTkQpOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNhc2UgVkFMVUVTOgogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiB2YWx1ZXMoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEl0ZXJhdG9yQ29uc3RydWN0b3IodGhpcywgS0lORCk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgY2FzZSBFTlRSSUVTOgogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiBlbnRyaWVzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBJdGVyYXRvckNvbnN0cnVjdG9yKHRoaXMsIEtJTkQpOwogICAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSXRlcmF0b3JDb25zdHJ1Y3Rvcih0aGlzKTsKICAgICAgICAgIH07CiAgICAgICAgfTsKICAgICAgICB2YXIgVE9fU1RSSU5HX1RBRyA9IE5BTUUgKyAiIEl0ZXJhdG9yIjsKICAgICAgICB2YXIgSU5DT1JSRUNUX1ZBTFVFU19OQU1FID0gZmFsc2U7CiAgICAgICAgdmFyIEl0ZXJhYmxlUHJvdG90eXBlID0gSXRlcmFibGUucHJvdG90eXBlOwogICAgICAgIHZhciBuYXRpdmVJdGVyYXRvciA9IEl0ZXJhYmxlUHJvdG90eXBlW0lURVJBVE9SXSB8fCBJdGVyYWJsZVByb3RvdHlwZVsiQEBpdGVyYXRvciJdIHx8IERFRkFVTFQgJiYgSXRlcmFibGVQcm90b3R5cGVbREVGQVVMVF07CiAgICAgICAgdmFyIGRlZmF1bHRJdGVyYXRvciA9ICFCVUdHWV9TQUZBUklfSVRFUkFUT1JTICYmIG5hdGl2ZUl0ZXJhdG9yIHx8IGdldEl0ZXJhdGlvbk1ldGhvZChERUZBVUxUKTsKICAgICAgICB2YXIgYW55TmF0aXZlSXRlcmF0b3IgPSBOQU1FID09ICJBcnJheSIgPyBJdGVyYWJsZVByb3RvdHlwZS5lbnRyaWVzIHx8IG5hdGl2ZUl0ZXJhdG9yIDogbmF0aXZlSXRlcmF0b3I7CiAgICAgICAgdmFyIEN1cnJlbnRJdGVyYXRvclByb3RvdHlwZSwgbWV0aG9kcywgS0VZOwogICAgICAgIGlmIChhbnlOYXRpdmVJdGVyYXRvcikgewogICAgICAgICAgQ3VycmVudEl0ZXJhdG9yUHJvdG90eXBlID0gZ2V0UHJvdG90eXBlT2YoYW55TmF0aXZlSXRlcmF0b3IuY2FsbChuZXcgSXRlcmFibGUoKSkpOwogICAgICAgICAgaWYgKEN1cnJlbnRJdGVyYXRvclByb3RvdHlwZSAhPT0gT2JqZWN0LnByb3RvdHlwZSAmJiBDdXJyZW50SXRlcmF0b3JQcm90b3R5cGUubmV4dCkgewogICAgICAgICAgICBpZiAoIUlTX1BVUkUgJiYgZ2V0UHJvdG90eXBlT2YoQ3VycmVudEl0ZXJhdG9yUHJvdG90eXBlKSAhPT0gSXRlcmF0b3JQcm90b3R5cGUpIHsKICAgICAgICAgICAgICBpZiAoc2V0UHJvdG90eXBlT2YpIHsKICAgICAgICAgICAgICAgIHNldFByb3RvdHlwZU9mKEN1cnJlbnRJdGVyYXRvclByb3RvdHlwZSwgSXRlcmF0b3JQcm90b3R5cGUpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWlzQ2FsbGFibGUoQ3VycmVudEl0ZXJhdG9yUHJvdG90eXBlW0lURVJBVE9SXSkpIHsKICAgICAgICAgICAgICAgIHJlZGVmaW5lKEN1cnJlbnRJdGVyYXRvclByb3RvdHlwZSwgSVRFUkFUT1IsIHJldHVyblRoaXMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBzZXRUb1N0cmluZ1RhZyhDdXJyZW50SXRlcmF0b3JQcm90b3R5cGUsIFRPX1NUUklOR19UQUcsIHRydWUsIHRydWUpOwogICAgICAgICAgICBpZiAoSVNfUFVSRSkKICAgICAgICAgICAgICBJdGVyYXRvcnNbVE9fU1RSSU5HX1RBR10gPSByZXR1cm5UaGlzOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoUFJPUEVSX0ZVTkNUSU9OX05BTUUgJiYgREVGQVVMVCA9PSBWQUxVRVMgJiYgbmF0aXZlSXRlcmF0b3IgJiYgbmF0aXZlSXRlcmF0b3IubmFtZSAhPT0gVkFMVUVTKSB7CiAgICAgICAgICBpZiAoIUlTX1BVUkUgJiYgQ09ORklHVVJBQkxFX0ZVTkNUSU9OX05BTUUpIHsKICAgICAgICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KEl0ZXJhYmxlUHJvdG90eXBlLCAibmFtZSIsIFZBTFVFUyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBJTkNPUlJFQ1RfVkFMVUVTX05BTUUgPSB0cnVlOwogICAgICAgICAgICBkZWZhdWx0SXRlcmF0b3IgPSBmdW5jdGlvbiB2YWx1ZXMoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG5hdGl2ZUl0ZXJhdG9yLmNhbGwodGhpcyk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChERUZBVUxUKSB7CiAgICAgICAgICBtZXRob2RzID0gewogICAgICAgICAgICB2YWx1ZXM6IGdldEl0ZXJhdGlvbk1ldGhvZChWQUxVRVMpLAogICAgICAgICAgICBrZXlzOiBJU19TRVQgPyBkZWZhdWx0SXRlcmF0b3IgOiBnZXRJdGVyYXRpb25NZXRob2QoS0VZUyksCiAgICAgICAgICAgIGVudHJpZXM6IGdldEl0ZXJhdGlvbk1ldGhvZChFTlRSSUVTKQogICAgICAgICAgfTsKICAgICAgICAgIGlmIChGT1JDRUQpCiAgICAgICAgICAgIGZvciAoS0VZIGluIG1ldGhvZHMpIHsKICAgICAgICAgICAgICBpZiAoQlVHR1lfU0FGQVJJX0lURVJBVE9SUyB8fCBJTkNPUlJFQ1RfVkFMVUVTX05BTUUgfHwgIShLRVkgaW4gSXRlcmFibGVQcm90b3R5cGUpKSB7CiAgICAgICAgICAgICAgICByZWRlZmluZShJdGVyYWJsZVByb3RvdHlwZSwgS0VZLCBtZXRob2RzW0tFWV0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgZWxzZQogICAgICAgICAgICAkKHsgdGFyZ2V0OiBOQU1FLCBwcm90bzogdHJ1ZSwgZm9yY2VkOiBCVUdHWV9TQUZBUklfSVRFUkFUT1JTIHx8IElOQ09SUkVDVF9WQUxVRVNfTkFNRSB9LCBtZXRob2RzKTsKICAgICAgICB9CiAgICAgICAgaWYgKCghSVNfUFVSRSB8fCBGT1JDRUQpICYmIEl0ZXJhYmxlUHJvdG90eXBlW0lURVJBVE9SXSAhPT0gZGVmYXVsdEl0ZXJhdG9yKSB7CiAgICAgICAgICByZWRlZmluZShJdGVyYWJsZVByb3RvdHlwZSwgSVRFUkFUT1IsIGRlZmF1bHRJdGVyYXRvciwgeyBuYW1lOiBERUZBVUxUIH0pOwogICAgICAgIH0KICAgICAgICBJdGVyYXRvcnNbTkFNRV0gPSBkZWZhdWx0SXRlcmF0b3I7CiAgICAgICAgcmV0dXJuIG1ldGhvZHM7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5hcnJheS5pdGVyYXRvci5qcwogIHZhciByZXF1aXJlX2VzX2FycmF5X2l0ZXJhdG9yID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLmFycmF5Lml0ZXJhdG9yLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciB0b0luZGV4ZWRPYmplY3QgPSByZXF1aXJlX3RvX2luZGV4ZWRfb2JqZWN0KCk7CiAgICAgIHZhciBhZGRUb1Vuc2NvcGFibGVzID0gcmVxdWlyZV9hZGRfdG9fdW5zY29wYWJsZXMoKTsKICAgICAgdmFyIEl0ZXJhdG9ycyA9IHJlcXVpcmVfaXRlcmF0b3JzKCk7CiAgICAgIHZhciBJbnRlcm5hbFN0YXRlTW9kdWxlID0gcmVxdWlyZV9pbnRlcm5hbF9zdGF0ZSgpOwogICAgICB2YXIgZGVmaW5lSXRlcmF0b3IgPSByZXF1aXJlX2RlZmluZV9pdGVyYXRvcigpOwogICAgICB2YXIgQVJSQVlfSVRFUkFUT1IgPSAiQXJyYXkgSXRlcmF0b3IiOwogICAgICB2YXIgc2V0SW50ZXJuYWxTdGF0ZSA9IEludGVybmFsU3RhdGVNb2R1bGUuc2V0OwogICAgICB2YXIgZ2V0SW50ZXJuYWxTdGF0ZSA9IEludGVybmFsU3RhdGVNb2R1bGUuZ2V0dGVyRm9yKEFSUkFZX0lURVJBVE9SKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBkZWZpbmVJdGVyYXRvcihBcnJheSwgIkFycmF5IiwgZnVuY3Rpb24oaXRlcmF0ZWQsIGtpbmQpIHsKICAgICAgICBzZXRJbnRlcm5hbFN0YXRlKHRoaXMsIHsKICAgICAgICAgIHR5cGU6IEFSUkFZX0lURVJBVE9SLAogICAgICAgICAgdGFyZ2V0OiB0b0luZGV4ZWRPYmplY3QoaXRlcmF0ZWQpLAogICAgICAgICAgaW5kZXg6IDAsCiAgICAgICAgICBraW5kCiAgICAgICAgfSk7CiAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBzdGF0ZSA9IGdldEludGVybmFsU3RhdGUodGhpcyk7CiAgICAgICAgdmFyIHRhcmdldCA9IHN0YXRlLnRhcmdldDsKICAgICAgICB2YXIga2luZCA9IHN0YXRlLmtpbmQ7CiAgICAgICAgdmFyIGluZGV4ID0gc3RhdGUuaW5kZXgrKzsKICAgICAgICBpZiAoIXRhcmdldCB8fCBpbmRleCA+PSB0YXJnZXQubGVuZ3RoKSB7CiAgICAgICAgICBzdGF0ZS50YXJnZXQgPSB2b2lkIDA7CiAgICAgICAgICByZXR1cm4geyB2YWx1ZTogdm9pZCAwLCBkb25lOiB0cnVlIH07CiAgICAgICAgfQogICAgICAgIGlmIChraW5kID09ICJrZXlzIikKICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBpbmRleCwgZG9uZTogZmFsc2UgfTsKICAgICAgICBpZiAoa2luZCA9PSAidmFsdWVzIikKICAgICAgICAgIHJldHVybiB7IHZhbHVlOiB0YXJnZXRbaW5kZXhdLCBkb25lOiBmYWxzZSB9OwogICAgICAgIHJldHVybiB7IHZhbHVlOiBbaW5kZXgsIHRhcmdldFtpbmRleF1dLCBkb25lOiBmYWxzZSB9OwogICAgICB9LCAidmFsdWVzIik7CiAgICAgIEl0ZXJhdG9ycy5Bcmd1bWVudHMgPSBJdGVyYXRvcnMuQXJyYXk7CiAgICAgIGFkZFRvVW5zY29wYWJsZXMoImtleXMiKTsKICAgICAgYWRkVG9VbnNjb3BhYmxlcygidmFsdWVzIik7CiAgICAgIGFkZFRvVW5zY29wYWJsZXMoImVudHJpZXMiKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvdG8tc3RyaW5nLmpzCiAgdmFyIHJlcXVpcmVfdG9fc3RyaW5nID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvdG8tc3RyaW5nLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgY2xhc3NvZiA9IHJlcXVpcmVfY2xhc3NvZigpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGFyZ3VtZW50KSB7CiAgICAgICAgaWYgKGNsYXNzb2YoYXJndW1lbnQpID09PSAiU3ltYm9sIikKICAgICAgICAgIHRocm93IFR5cGVFcnJvcigiQ2Fubm90IGNvbnZlcnQgYSBTeW1ib2wgdmFsdWUgdG8gYSBzdHJpbmciKTsKICAgICAgICByZXR1cm4gU3RyaW5nKGFyZ3VtZW50KTsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvc3RyaW5nLW11bHRpYnl0ZS5qcwogIHZhciByZXF1aXJlX3N0cmluZ19tdWx0aWJ5dGUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9zdHJpbmctbXVsdGlieXRlLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgdG9JbnRlZ2VyID0gcmVxdWlyZV90b19pbnRlZ2VyKCk7CiAgICAgIHZhciB0b1N0cmluZyA9IHJlcXVpcmVfdG9fc3RyaW5nKCk7CiAgICAgIHZhciByZXF1aXJlT2JqZWN0Q29lcmNpYmxlID0gcmVxdWlyZV9yZXF1aXJlX29iamVjdF9jb2VyY2libGUoKTsKICAgICAgdmFyIGNyZWF0ZU1ldGhvZCA9IGZ1bmN0aW9uKENPTlZFUlRfVE9fU1RSSU5HKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCR0aGlzLCBwb3MpIHsKICAgICAgICAgIHZhciBTID0gdG9TdHJpbmcocmVxdWlyZU9iamVjdENvZXJjaWJsZSgkdGhpcykpOwogICAgICAgICAgdmFyIHBvc2l0aW9uID0gdG9JbnRlZ2VyKHBvcyk7CiAgICAgICAgICB2YXIgc2l6ZSA9IFMubGVuZ3RoOwogICAgICAgICAgdmFyIGZpcnN0LCBzZWNvbmQ7CiAgICAgICAgICBpZiAocG9zaXRpb24gPCAwIHx8IHBvc2l0aW9uID49IHNpemUpCiAgICAgICAgICAgIHJldHVybiBDT05WRVJUX1RPX1NUUklORyA/ICIiIDogdm9pZCAwOwogICAgICAgICAgZmlyc3QgPSBTLmNoYXJDb2RlQXQocG9zaXRpb24pOwogICAgICAgICAgcmV0dXJuIGZpcnN0IDwgNTUyOTYgfHwgZmlyc3QgPiA1NjMxOSB8fCBwb3NpdGlvbiArIDEgPT09IHNpemUgfHwgKHNlY29uZCA9IFMuY2hhckNvZGVBdChwb3NpdGlvbiArIDEpKSA8IDU2MzIwIHx8IHNlY29uZCA+IDU3MzQzID8gQ09OVkVSVF9UT19TVFJJTkcgPyBTLmNoYXJBdChwb3NpdGlvbikgOiBmaXJzdCA6IENPTlZFUlRfVE9fU1RSSU5HID8gUy5zbGljZShwb3NpdGlvbiwgcG9zaXRpb24gKyAyKSA6IChmaXJzdCAtIDU1Mjk2IDw8IDEwKSArIChzZWNvbmQgLSA1NjMyMCkgKyA2NTUzNjsKICAgICAgICB9OwogICAgICB9OwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgICBjb2RlQXQ6IGNyZWF0ZU1ldGhvZChmYWxzZSksCiAgICAgICAgY2hhckF0OiBjcmVhdGVNZXRob2QodHJ1ZSkKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcwogIHZhciByZXF1aXJlX2VzX3N0cmluZ19pdGVyYXRvciA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5zdHJpbmcuaXRlcmF0b3IuanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIGNoYXJBdCA9IHJlcXVpcmVfc3RyaW5nX211bHRpYnl0ZSgpLmNoYXJBdDsKICAgICAgdmFyIHRvU3RyaW5nID0gcmVxdWlyZV90b19zdHJpbmcoKTsKICAgICAgdmFyIEludGVybmFsU3RhdGVNb2R1bGUgPSByZXF1aXJlX2ludGVybmFsX3N0YXRlKCk7CiAgICAgIHZhciBkZWZpbmVJdGVyYXRvciA9IHJlcXVpcmVfZGVmaW5lX2l0ZXJhdG9yKCk7CiAgICAgIHZhciBTVFJJTkdfSVRFUkFUT1IgPSAiU3RyaW5nIEl0ZXJhdG9yIjsKICAgICAgdmFyIHNldEludGVybmFsU3RhdGUgPSBJbnRlcm5hbFN0YXRlTW9kdWxlLnNldDsKICAgICAgdmFyIGdldEludGVybmFsU3RhdGUgPSBJbnRlcm5hbFN0YXRlTW9kdWxlLmdldHRlckZvcihTVFJJTkdfSVRFUkFUT1IpOwogICAgICBkZWZpbmVJdGVyYXRvcihTdHJpbmcsICJTdHJpbmciLCBmdW5jdGlvbihpdGVyYXRlZCkgewogICAgICAgIHNldEludGVybmFsU3RhdGUodGhpcywgewogICAgICAgICAgdHlwZTogU1RSSU5HX0lURVJBVE9SLAogICAgICAgICAgc3RyaW5nOiB0b1N0cmluZyhpdGVyYXRlZCksCiAgICAgICAgICBpbmRleDogMAogICAgICAgIH0pOwogICAgICB9LCBmdW5jdGlvbiBuZXh0KCkgewogICAgICAgIHZhciBzdGF0ZSA9IGdldEludGVybmFsU3RhdGUodGhpcyk7CiAgICAgICAgdmFyIHN0cmluZyA9IHN0YXRlLnN0cmluZzsKICAgICAgICB2YXIgaW5kZXggPSBzdGF0ZS5pbmRleDsKICAgICAgICB2YXIgcG9pbnQ7CiAgICAgICAgaWYgKGluZGV4ID49IHN0cmluZy5sZW5ndGgpCiAgICAgICAgICByZXR1cm4geyB2YWx1ZTogdm9pZCAwLCBkb25lOiB0cnVlIH07CiAgICAgICAgcG9pbnQgPSBjaGFyQXQoc3RyaW5nLCBpbmRleCk7CiAgICAgICAgc3RhdGUuaW5kZXggKz0gcG9pbnQubGVuZ3RoOwogICAgICAgIHJldHVybiB7IHZhbHVlOiBwb2ludCwgZG9uZTogZmFsc2UgfTsKICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2dldC1pdGVyYXRvci1tZXRob2QuanMKICB2YXIgcmVxdWlyZV9nZXRfaXRlcmF0b3JfbWV0aG9kID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZ2V0LWl0ZXJhdG9yLW1ldGhvZC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGNsYXNzb2YgPSByZXF1aXJlX2NsYXNzb2YoKTsKICAgICAgdmFyIGdldE1ldGhvZCA9IHJlcXVpcmVfZ2V0X21ldGhvZCgpOwogICAgICB2YXIgSXRlcmF0b3JzID0gcmVxdWlyZV9pdGVyYXRvcnMoKTsKICAgICAgdmFyIHdlbGxLbm93blN5bWJvbCA9IHJlcXVpcmVfd2VsbF9rbm93bl9zeW1ib2woKTsKICAgICAgdmFyIElURVJBVE9SID0gd2VsbEtub3duU3ltYm9sKCJpdGVyYXRvciIpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KSB7CiAgICAgICAgaWYgKGl0ICE9IHZvaWQgMCkKICAgICAgICAgIHJldHVybiBnZXRNZXRob2QoaXQsIElURVJBVE9SKSB8fCBnZXRNZXRob2QoaXQsICJAQGl0ZXJhdG9yIikgfHwgSXRlcmF0b3JzW2NsYXNzb2YoaXQpXTsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZ2V0LWl0ZXJhdG9yLmpzCiAgdmFyIHJlcXVpcmVfZ2V0X2l0ZXJhdG9yID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZ2V0LWl0ZXJhdG9yLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgYUNhbGxhYmxlID0gcmVxdWlyZV9hX2NhbGxhYmxlKCk7CiAgICAgIHZhciBhbk9iamVjdCA9IHJlcXVpcmVfYW5fb2JqZWN0KCk7CiAgICAgIHZhciBnZXRJdGVyYXRvck1ldGhvZCA9IHJlcXVpcmVfZ2V0X2l0ZXJhdG9yX21ldGhvZCgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGFyZ3VtZW50LCB1c2luZ0l0ZXJhdG9yKSB7CiAgICAgICAgdmFyIGl0ZXJhdG9yTWV0aG9kID0gYXJndW1lbnRzLmxlbmd0aCA8IDIgPyBnZXRJdGVyYXRvck1ldGhvZChhcmd1bWVudCkgOiB1c2luZ0l0ZXJhdG9yOwogICAgICAgIGlmIChhQ2FsbGFibGUoaXRlcmF0b3JNZXRob2QpKQogICAgICAgICAgcmV0dXJuIGFuT2JqZWN0KGl0ZXJhdG9yTWV0aG9kLmNhbGwoYXJndW1lbnQpKTsKICAgICAgICB0aHJvdyBUeXBlRXJyb3IoU3RyaW5nKGFyZ3VtZW50KSArICIgaXMgbm90IGl0ZXJhYmxlIik7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvZ2V0LWl0ZXJhdG9yLmpzCiAgdmFyIHJlcXVpcmVfZ2V0X2l0ZXJhdG9yMiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvZ2V0LWl0ZXJhdG9yLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICByZXF1aXJlX2VzX2FycmF5X2l0ZXJhdG9yKCk7CiAgICAgIHJlcXVpcmVfZXNfc3RyaW5nX2l0ZXJhdG9yKCk7CiAgICAgIHZhciBnZXRJdGVyYXRvciA9IHJlcXVpcmVfZ2V0X2l0ZXJhdG9yKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZ2V0SXRlcmF0b3I7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2RvbS1pdGVyYWJsZXMuanMKICB2YXIgcmVxdWlyZV9kb21faXRlcmFibGVzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZG9tLWl0ZXJhYmxlcy5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAgICAgQ1NTUnVsZUxpc3Q6IDAsCiAgICAgICAgQ1NTU3R5bGVEZWNsYXJhdGlvbjogMCwKICAgICAgICBDU1NWYWx1ZUxpc3Q6IDAsCiAgICAgICAgQ2xpZW50UmVjdExpc3Q6IDAsCiAgICAgICAgRE9NUmVjdExpc3Q6IDAsCiAgICAgICAgRE9NU3RyaW5nTGlzdDogMCwKICAgICAgICBET01Ub2tlbkxpc3Q6IDEsCiAgICAgICAgRGF0YVRyYW5zZmVySXRlbUxpc3Q6IDAsCiAgICAgICAgRmlsZUxpc3Q6IDAsCiAgICAgICAgSFRNTEFsbENvbGxlY3Rpb246IDAsCiAgICAgICAgSFRNTENvbGxlY3Rpb246IDAsCiAgICAgICAgSFRNTEZvcm1FbGVtZW50OiAwLAogICAgICAgIEhUTUxTZWxlY3RFbGVtZW50OiAwLAogICAgICAgIE1lZGlhTGlzdDogMCwKICAgICAgICBNaW1lVHlwZUFycmF5OiAwLAogICAgICAgIE5hbWVkTm9kZU1hcDogMCwKICAgICAgICBOb2RlTGlzdDogMSwKICAgICAgICBQYWludFJlcXVlc3RMaXN0OiAwLAogICAgICAgIFBsdWdpbjogMCwKICAgICAgICBQbHVnaW5BcnJheTogMCwKICAgICAgICBTVkdMZW5ndGhMaXN0OiAwLAogICAgICAgIFNWR051bWJlckxpc3Q6IDAsCiAgICAgICAgU1ZHUGF0aFNlZ0xpc3Q6IDAsCiAgICAgICAgU1ZHUG9pbnRMaXN0OiAwLAogICAgICAgIFNWR1N0cmluZ0xpc3Q6IDAsCiAgICAgICAgU1ZHVHJhbnNmb3JtTGlzdDogMCwKICAgICAgICBTb3VyY2VCdWZmZXJMaXN0OiAwLAogICAgICAgIFN0eWxlU2hlZXRMaXN0OiAwLAogICAgICAgIFRleHRUcmFja0N1ZUxpc3Q6IDAsCiAgICAgICAgVGV4dFRyYWNrTGlzdDogMCwKICAgICAgICBUb3VjaExpc3Q6IDAKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IuanMKICB2YXIgcmVxdWlyZV93ZWJfZG9tX2NvbGxlY3Rpb25zX2l0ZXJhdG9yID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IuanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHJlcXVpcmVfZXNfYXJyYXlfaXRlcmF0b3IoKTsKICAgICAgdmFyIERPTUl0ZXJhYmxlcyA9IHJlcXVpcmVfZG9tX2l0ZXJhYmxlcygpOwogICAgICB2YXIgZ2xvYmFsMiA9IHJlcXVpcmVfZ2xvYmFsKCk7CiAgICAgIHZhciBjbGFzc29mID0gcmVxdWlyZV9jbGFzc29mKCk7CiAgICAgIHZhciBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkgPSByZXF1aXJlX2NyZWF0ZV9ub25fZW51bWVyYWJsZV9wcm9wZXJ0eSgpOwogICAgICB2YXIgSXRlcmF0b3JzID0gcmVxdWlyZV9pdGVyYXRvcnMoKTsKICAgICAgdmFyIHdlbGxLbm93blN5bWJvbCA9IHJlcXVpcmVfd2VsbF9rbm93bl9zeW1ib2woKTsKICAgICAgdmFyIFRPX1NUUklOR19UQUcgPSB3ZWxsS25vd25TeW1ib2woInRvU3RyaW5nVGFnIik7CiAgICAgIGZvciAoQ09MTEVDVElPTl9OQU1FIGluIERPTUl0ZXJhYmxlcykgewogICAgICAgIENvbGxlY3Rpb24gPSBnbG9iYWwyW0NPTExFQ1RJT05fTkFNRV07CiAgICAgICAgQ29sbGVjdGlvblByb3RvdHlwZSA9IENvbGxlY3Rpb24gJiYgQ29sbGVjdGlvbi5wcm90b3R5cGU7CiAgICAgICAgaWYgKENvbGxlY3Rpb25Qcm90b3R5cGUgJiYgY2xhc3NvZihDb2xsZWN0aW9uUHJvdG90eXBlKSAhPT0gVE9fU1RSSU5HX1RBRykgewogICAgICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KENvbGxlY3Rpb25Qcm90b3R5cGUsIFRPX1NUUklOR19UQUcsIENPTExFQ1RJT05fTkFNRSk7CiAgICAgICAgfQogICAgICAgIEl0ZXJhdG9yc1tDT0xMRUNUSU9OX05BTUVdID0gSXRlcmF0b3JzLkFycmF5OwogICAgICB9CiAgICAgIHZhciBDb2xsZWN0aW9uOwogICAgICB2YXIgQ29sbGVjdGlvblByb3RvdHlwZTsKICAgICAgdmFyIENPTExFQ1RJT05fTkFNRTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvZ2V0LWl0ZXJhdG9yLmpzCiAgdmFyIHJlcXVpcmVfZ2V0X2l0ZXJhdG9yMyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL2dldC1pdGVyYXRvci5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHBhcmVudCA9IHJlcXVpcmVfZ2V0X2l0ZXJhdG9yMigpOwogICAgICByZXF1aXJlX3dlYl9kb21fY29sbGVjdGlvbnNfaXRlcmF0b3IoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXJlbnQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZmVhdHVyZXMvZ2V0LWl0ZXJhdG9yLmpzCiAgdmFyIHJlcXVpcmVfZ2V0X2l0ZXJhdG9yNCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZmVhdHVyZXMvZ2V0LWl0ZXJhdG9yLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgcGFyZW50ID0gcmVxdWlyZV9nZXRfaXRlcmF0b3IzKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGFyZW50OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzL2dldC1pdGVyYXRvci5qcwogIHZhciByZXF1aXJlX2dldF9pdGVyYXRvcjUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzL2dldC1pdGVyYXRvci5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlX2dldF9pdGVyYXRvcjQoKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvaXMtYXJyYXkuanMKICB2YXIgcmVxdWlyZV9pc19hcnJheSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2lzLWFycmF5LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgY2xhc3NvZiA9IHJlcXVpcmVfY2xhc3NvZl9yYXcoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uIGlzQXJyYXkoYXJndW1lbnQpIHsKICAgICAgICByZXR1cm4gY2xhc3NvZihhcmd1bWVudCkgPT0gIkFycmF5IjsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLmFycmF5LmlzLWFycmF5LmpzCiAgdmFyIHJlcXVpcmVfZXNfYXJyYXlfaXNfYXJyYXkgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMuYXJyYXkuaXMtYXJyYXkuanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciAkID0gcmVxdWlyZV9leHBvcnQoKTsKICAgICAgdmFyIGlzQXJyYXkgPSByZXF1aXJlX2lzX2FycmF5KCk7CiAgICAgICQoeyB0YXJnZXQ6ICJBcnJheSIsIHN0YXQ6IHRydWUgfSwgewogICAgICAgIGlzQXJyYXkKICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvYXJyYXkvaXMtYXJyYXkuanMKICB2YXIgcmVxdWlyZV9pc19hcnJheTIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL2FycmF5L2lzLWFycmF5LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICByZXF1aXJlX2VzX2FycmF5X2lzX2FycmF5KCk7CiAgICAgIHZhciBwYXRoID0gcmVxdWlyZV9wYXRoKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGF0aC5BcnJheS5pc0FycmF5OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9hcnJheS9pcy1hcnJheS5qcwogIHZhciByZXF1aXJlX2lzX2FycmF5MyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL2FycmF5L2lzLWFycmF5LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgcGFyZW50ID0gcmVxdWlyZV9pc19hcnJheTIoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXJlbnQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMtc3RhYmxlL2FycmF5L2lzLWFycmF5LmpzCiAgdmFyIHJlcXVpcmVfaXNfYXJyYXk0ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy1zdGFibGUvYXJyYXkvaXMtYXJyYXkuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZV9pc19hcnJheTMoKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9nZXQtaXRlcmF0b3ItbWV0aG9kLmpzCiAgdmFyIHJlcXVpcmVfZ2V0X2l0ZXJhdG9yX21ldGhvZDIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL2dldC1pdGVyYXRvci1tZXRob2QuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHJlcXVpcmVfZXNfYXJyYXlfaXRlcmF0b3IoKTsKICAgICAgcmVxdWlyZV9lc19zdHJpbmdfaXRlcmF0b3IoKTsKICAgICAgdmFyIGdldEl0ZXJhdG9yTWV0aG9kID0gcmVxdWlyZV9nZXRfaXRlcmF0b3JfbWV0aG9kKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZ2V0SXRlcmF0b3JNZXRob2Q7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL2dldC1pdGVyYXRvci1tZXRob2QuanMKICB2YXIgcmVxdWlyZV9nZXRfaXRlcmF0b3JfbWV0aG9kMyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL2dldC1pdGVyYXRvci1tZXRob2QuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX2dldF9pdGVyYXRvcl9tZXRob2QyKCk7CiAgICAgIHJlcXVpcmVfd2ViX2RvbV9jb2xsZWN0aW9uc19pdGVyYXRvcigpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhcmVudDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9mZWF0dXJlcy9nZXQtaXRlcmF0b3ItbWV0aG9kLmpzCiAgdmFyIHJlcXVpcmVfZ2V0X2l0ZXJhdG9yX21ldGhvZDQgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ZlYXR1cmVzL2dldC1pdGVyYXRvci1tZXRob2QuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX2dldF9pdGVyYXRvcl9tZXRob2QzKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGFyZW50OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzL2dldC1pdGVyYXRvci1tZXRob2QuanMKICB2YXIgcmVxdWlyZV9nZXRfaXRlcmF0b3JfbWV0aG9kNSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMvZ2V0LWl0ZXJhdG9yLW1ldGhvZC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlX2dldF9pdGVyYXRvcl9tZXRob2Q0KCk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2NyZWF0ZS1wcm9wZXJ0eS5qcwogIHZhciByZXF1aXJlX2NyZWF0ZV9wcm9wZXJ0eSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2NyZWF0ZS1wcm9wZXJ0eS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgdG9Qcm9wZXJ0eUtleSA9IHJlcXVpcmVfdG9fcHJvcGVydHlfa2V5KCk7CiAgICAgIHZhciBkZWZpbmVQcm9wZXJ0eU1vZHVsZSA9IHJlcXVpcmVfb2JqZWN0X2RlZmluZV9wcm9wZXJ0eSgpOwogICAgICB2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yID0gcmVxdWlyZV9jcmVhdGVfcHJvcGVydHlfZGVzY3JpcHRvcigpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKG9iamVjdCwga2V5LCB2YWx1ZSkgewogICAgICAgIHZhciBwcm9wZXJ0eUtleSA9IHRvUHJvcGVydHlLZXkoa2V5KTsKICAgICAgICBpZiAocHJvcGVydHlLZXkgaW4gb2JqZWN0KQogICAgICAgICAgZGVmaW5lUHJvcGVydHlNb2R1bGUuZihvYmplY3QsIHByb3BlcnR5S2V5LCBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IoMCwgdmFsdWUpKTsKICAgICAgICBlbHNlCiAgICAgICAgICBvYmplY3RbcHJvcGVydHlLZXldID0gdmFsdWU7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2lzLWNvbnN0cnVjdG9yLmpzCiAgdmFyIHJlcXVpcmVfaXNfY29uc3RydWN0b3IgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9pcy1jb25zdHJ1Y3Rvci5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGZhaWxzID0gcmVxdWlyZV9mYWlscygpOwogICAgICB2YXIgaXNDYWxsYWJsZSA9IHJlcXVpcmVfaXNfY2FsbGFibGUoKTsKICAgICAgdmFyIGNsYXNzb2YgPSByZXF1aXJlX2NsYXNzb2YoKTsKICAgICAgdmFyIGdldEJ1aWx0SW4gPSByZXF1aXJlX2dldF9idWlsdF9pbigpOwogICAgICB2YXIgaW5zcGVjdFNvdXJjZSA9IHJlcXVpcmVfaW5zcGVjdF9zb3VyY2UoKTsKICAgICAgdmFyIGVtcHR5ID0gW107CiAgICAgIHZhciBjb25zdHJ1Y3QgPSBnZXRCdWlsdEluKCJSZWZsZWN0IiwgImNvbnN0cnVjdCIpOwogICAgICB2YXIgY29uc3RydWN0b3JSZWdFeHAgPSAvXlxzKig/OmNsYXNzfGZ1bmN0aW9uKVxiLzsKICAgICAgdmFyIGV4ZWMgPSBjb25zdHJ1Y3RvclJlZ0V4cC5leGVjOwogICAgICB2YXIgSU5DT1JSRUNUX1RPX1NUUklORyA9ICFjb25zdHJ1Y3RvclJlZ0V4cC5leGVjKGZ1bmN0aW9uKCkgewogICAgICB9KTsKICAgICAgdmFyIGlzQ29uc3RydWN0b3JNb2Rlcm4gPSBmdW5jdGlvbihhcmd1bWVudCkgewogICAgICAgIGlmICghaXNDYWxsYWJsZShhcmd1bWVudCkpCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0cnVjdChPYmplY3QsIGVtcHR5LCBhcmd1bWVudCk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfTsKICAgICAgdmFyIGlzQ29uc3RydWN0b3JMZWdhY3kgPSBmdW5jdGlvbihhcmd1bWVudCkgewogICAgICAgIGlmICghaXNDYWxsYWJsZShhcmd1bWVudCkpCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgc3dpdGNoIChjbGFzc29mKGFyZ3VtZW50KSkgewogICAgICAgICAgY2FzZSAiQXN5bmNGdW5jdGlvbiI6CiAgICAgICAgICBjYXNlICJHZW5lcmF0b3JGdW5jdGlvbiI6CiAgICAgICAgICBjYXNlICJBc3luY0dlbmVyYXRvckZ1bmN0aW9uIjoKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gSU5DT1JSRUNUX1RPX1NUUklORyB8fCAhIWV4ZWMuY2FsbChjb25zdHJ1Y3RvclJlZ0V4cCwgaW5zcGVjdFNvdXJjZShhcmd1bWVudCkpOwogICAgICB9OwogICAgICBtb2R1bGUuZXhwb3J0cyA9ICFjb25zdHJ1Y3QgfHwgZmFpbHMoZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGNhbGxlZDsKICAgICAgICByZXR1cm4gaXNDb25zdHJ1Y3Rvck1vZGVybihpc0NvbnN0cnVjdG9yTW9kZXJuLmNhbGwpIHx8ICFpc0NvbnN0cnVjdG9yTW9kZXJuKE9iamVjdCkgfHwgIWlzQ29uc3RydWN0b3JNb2Rlcm4oZnVuY3Rpb24oKSB7CiAgICAgICAgICBjYWxsZWQgPSB0cnVlOwogICAgICAgIH0pIHx8IGNhbGxlZDsKICAgICAgfSkgPyBpc0NvbnN0cnVjdG9yTGVnYWN5IDogaXNDb25zdHJ1Y3Rvck1vZGVybjsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvYXJyYXktc3BlY2llcy1jb25zdHJ1Y3Rvci5qcwogIHZhciByZXF1aXJlX2FycmF5X3NwZWNpZXNfY29uc3RydWN0b3IgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9hcnJheS1zcGVjaWVzLWNvbnN0cnVjdG9yLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgaXNBcnJheSA9IHJlcXVpcmVfaXNfYXJyYXkoKTsKICAgICAgdmFyIGlzQ29uc3RydWN0b3IgPSByZXF1aXJlX2lzX2NvbnN0cnVjdG9yKCk7CiAgICAgIHZhciBpc09iamVjdCA9IHJlcXVpcmVfaXNfb2JqZWN0KCk7CiAgICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSByZXF1aXJlX3dlbGxfa25vd25fc3ltYm9sKCk7CiAgICAgIHZhciBTUEVDSUVTID0gd2VsbEtub3duU3ltYm9sKCJzcGVjaWVzIik7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24ob3JpZ2luYWxBcnJheSkgewogICAgICAgIHZhciBDOwogICAgICAgIGlmIChpc0FycmF5KG9yaWdpbmFsQXJyYXkpKSB7CiAgICAgICAgICBDID0gb3JpZ2luYWxBcnJheS5jb25zdHJ1Y3RvcjsKICAgICAgICAgIGlmIChpc0NvbnN0cnVjdG9yKEMpICYmIChDID09PSBBcnJheSB8fCBpc0FycmF5KEMucHJvdG90eXBlKSkpCiAgICAgICAgICAgIEMgPSB2b2lkIDA7CiAgICAgICAgICBlbHNlIGlmIChpc09iamVjdChDKSkgewogICAgICAgICAgICBDID0gQ1tTUEVDSUVTXTsKICAgICAgICAgICAgaWYgKEMgPT09IG51bGwpCiAgICAgICAgICAgICAgQyA9IHZvaWQgMDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIEMgPT09IHZvaWQgMCA/IEFycmF5IDogQzsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvYXJyYXktc3BlY2llcy1jcmVhdGUuanMKICB2YXIgcmVxdWlyZV9hcnJheV9zcGVjaWVzX2NyZWF0ZSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2FycmF5LXNwZWNpZXMtY3JlYXRlLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgYXJyYXlTcGVjaWVzQ29uc3RydWN0b3IgPSByZXF1aXJlX2FycmF5X3NwZWNpZXNfY29uc3RydWN0b3IoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihvcmlnaW5hbEFycmF5LCBsZW5ndGgpIHsKICAgICAgICByZXR1cm4gbmV3IChhcnJheVNwZWNpZXNDb25zdHJ1Y3RvcihvcmlnaW5hbEFycmF5KSkobGVuZ3RoID09PSAwID8gMCA6IGxlbmd0aCk7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2FycmF5LW1ldGhvZC1oYXMtc3BlY2llcy1zdXBwb3J0LmpzCiAgdmFyIHJlcXVpcmVfYXJyYXlfbWV0aG9kX2hhc19zcGVjaWVzX3N1cHBvcnQgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9hcnJheS1tZXRob2QtaGFzLXNwZWNpZXMtc3VwcG9ydC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGZhaWxzID0gcmVxdWlyZV9mYWlscygpOwogICAgICB2YXIgd2VsbEtub3duU3ltYm9sID0gcmVxdWlyZV93ZWxsX2tub3duX3N5bWJvbCgpOwogICAgICB2YXIgVjhfVkVSU0lPTiA9IHJlcXVpcmVfZW5naW5lX3Y4X3ZlcnNpb24oKTsKICAgICAgdmFyIFNQRUNJRVMgPSB3ZWxsS25vd25TeW1ib2woInNwZWNpZXMiKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihNRVRIT0RfTkFNRSkgewogICAgICAgIHJldHVybiBWOF9WRVJTSU9OID49IDUxIHx8ICFmYWlscyhmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBhcnJheSA9IFtdOwogICAgICAgICAgdmFyIGNvbnN0cnVjdG9yID0gYXJyYXkuY29uc3RydWN0b3IgPSB7fTsKICAgICAgICAgIGNvbnN0cnVjdG9yW1NQRUNJRVNdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB7IGZvbzogMSB9OwogICAgICAgICAgfTsKICAgICAgICAgIHJldHVybiBhcnJheVtNRVRIT0RfTkFNRV0oQm9vbGVhbikuZm9vICE9PSAxOwogICAgICAgIH0pOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzCiAgdmFyIHJlcXVpcmVfZXNfYXJyYXlfY29uY2F0ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgJCA9IHJlcXVpcmVfZXhwb3J0KCk7CiAgICAgIHZhciBmYWlscyA9IHJlcXVpcmVfZmFpbHMoKTsKICAgICAgdmFyIGlzQXJyYXkgPSByZXF1aXJlX2lzX2FycmF5KCk7CiAgICAgIHZhciBpc09iamVjdCA9IHJlcXVpcmVfaXNfb2JqZWN0KCk7CiAgICAgIHZhciB0b09iamVjdCA9IHJlcXVpcmVfdG9fb2JqZWN0KCk7CiAgICAgIHZhciB0b0xlbmd0aCA9IHJlcXVpcmVfdG9fbGVuZ3RoKCk7CiAgICAgIHZhciBjcmVhdGVQcm9wZXJ0eSA9IHJlcXVpcmVfY3JlYXRlX3Byb3BlcnR5KCk7CiAgICAgIHZhciBhcnJheVNwZWNpZXNDcmVhdGUgPSByZXF1aXJlX2FycmF5X3NwZWNpZXNfY3JlYXRlKCk7CiAgICAgIHZhciBhcnJheU1ldGhvZEhhc1NwZWNpZXNTdXBwb3J0ID0gcmVxdWlyZV9hcnJheV9tZXRob2RfaGFzX3NwZWNpZXNfc3VwcG9ydCgpOwogICAgICB2YXIgd2VsbEtub3duU3ltYm9sID0gcmVxdWlyZV93ZWxsX2tub3duX3N5bWJvbCgpOwogICAgICB2YXIgVjhfVkVSU0lPTiA9IHJlcXVpcmVfZW5naW5lX3Y4X3ZlcnNpb24oKTsKICAgICAgdmFyIElTX0NPTkNBVF9TUFJFQURBQkxFID0gd2VsbEtub3duU3ltYm9sKCJpc0NvbmNhdFNwcmVhZGFibGUiKTsKICAgICAgdmFyIE1BWF9TQUZFX0lOVEVHRVIgPSA5MDA3MTk5MjU0NzQwOTkxOwogICAgICB2YXIgTUFYSU1VTV9BTExPV0VEX0lOREVYX0VYQ0VFREVEID0gIk1heGltdW0gYWxsb3dlZCBpbmRleCBleGNlZWRlZCI7CiAgICAgIHZhciBJU19DT05DQVRfU1BSRUFEQUJMRV9TVVBQT1JUID0gVjhfVkVSU0lPTiA+PSA1MSB8fCAhZmFpbHMoZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGFycmF5ID0gW107CiAgICAgICAgYXJyYXlbSVNfQ09OQ0FUX1NQUkVBREFCTEVdID0gZmFsc2U7CiAgICAgICAgcmV0dXJuIGFycmF5LmNvbmNhdCgpWzBdICE9PSBhcnJheTsKICAgICAgfSk7CiAgICAgIHZhciBTUEVDSUVTX1NVUFBPUlQgPSBhcnJheU1ldGhvZEhhc1NwZWNpZXNTdXBwb3J0KCJjb25jYXQiKTsKICAgICAgdmFyIGlzQ29uY2F0U3ByZWFkYWJsZSA9IGZ1bmN0aW9uKE8pIHsKICAgICAgICBpZiAoIWlzT2JqZWN0KE8pKQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHZhciBzcHJlYWRhYmxlID0gT1tJU19DT05DQVRfU1BSRUFEQUJMRV07CiAgICAgICAgcmV0dXJuIHNwcmVhZGFibGUgIT09IHZvaWQgMCA/ICEhc3ByZWFkYWJsZSA6IGlzQXJyYXkoTyk7CiAgICAgIH07CiAgICAgIHZhciBGT1JDRUQgPSAhSVNfQ09OQ0FUX1NQUkVBREFCTEVfU1VQUE9SVCB8fCAhU1BFQ0lFU19TVVBQT1JUOwogICAgICAkKHsgdGFyZ2V0OiAiQXJyYXkiLCBwcm90bzogdHJ1ZSwgZm9yY2VkOiBGT1JDRUQgfSwgewogICAgICAgIGNvbmNhdDogZnVuY3Rpb24gY29uY2F0KGFyZykgewogICAgICAgICAgdmFyIE8gPSB0b09iamVjdCh0aGlzKTsKICAgICAgICAgIHZhciBBID0gYXJyYXlTcGVjaWVzQ3JlYXRlKE8sIDApOwogICAgICAgICAgdmFyIG4gPSAwOwogICAgICAgICAgdmFyIGksIGssIGxlbmd0aCwgbGVuLCBFOwogICAgICAgICAgZm9yIChpID0gLTEsIGxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgICBFID0gaSA9PT0gLTEgPyBPIDogYXJndW1lbnRzW2ldOwogICAgICAgICAgICBpZiAoaXNDb25jYXRTcHJlYWRhYmxlKEUpKSB7CiAgICAgICAgICAgICAgbGVuID0gdG9MZW5ndGgoRS5sZW5ndGgpOwogICAgICAgICAgICAgIGlmIChuICsgbGVuID4gTUFYX1NBRkVfSU5URUdFUikKICAgICAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihNQVhJTVVNX0FMTE9XRURfSU5ERVhfRVhDRUVERUQpOwogICAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBsZW47IGsrKywgbisrKQogICAgICAgICAgICAgICAgaWYgKGsgaW4gRSkKICAgICAgICAgICAgICAgICAgY3JlYXRlUHJvcGVydHkoQSwgbiwgRVtrXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKG4gPj0gTUFYX1NBRkVfSU5URUdFUikKICAgICAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihNQVhJTVVNX0FMTE9XRURfSU5ERVhfRVhDRUVERUQpOwogICAgICAgICAgICAgIGNyZWF0ZVByb3BlcnR5KEEsIG4rKywgRSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIEEubGVuZ3RoID0gbjsKICAgICAgICAgIHJldHVybiBBOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzCiAgdmFyIHJlcXVpcmVfZXNfb2JqZWN0X3RvX3N0cmluZyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9vYmplY3QtZ2V0LW93bi1wcm9wZXJ0eS1uYW1lcy5qcwogIHZhciByZXF1aXJlX29iamVjdF9nZXRfb3duX3Byb3BlcnR5X25hbWVzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvb2JqZWN0LWdldC1vd24tcHJvcGVydHktbmFtZXMuanMiKGV4cG9ydHMpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgaW50ZXJuYWxPYmplY3RLZXlzID0gcmVxdWlyZV9vYmplY3Rfa2V5c19pbnRlcm5hbCgpOwogICAgICB2YXIgZW51bUJ1Z0tleXMgPSByZXF1aXJlX2VudW1fYnVnX2tleXMoKTsKICAgICAgdmFyIGhpZGRlbktleXMgPSBlbnVtQnVnS2V5cy5jb25jYXQoImxlbmd0aCIsICJwcm90b3R5cGUiKTsKICAgICAgZXhwb3J0cy5mID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMgfHwgZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlOYW1lcyhPKSB7CiAgICAgICAgcmV0dXJuIGludGVybmFsT2JqZWN0S2V5cyhPLCBoaWRkZW5LZXlzKTsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvb2JqZWN0LWdldC1vd24tcHJvcGVydHktbmFtZXMtZXh0ZXJuYWwuanMKICB2YXIgcmVxdWlyZV9vYmplY3RfZ2V0X293bl9wcm9wZXJ0eV9uYW1lc19leHRlcm5hbCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL29iamVjdC1nZXQtb3duLXByb3BlcnR5LW5hbWVzLWV4dGVybmFsLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgdG9JbmRleGVkT2JqZWN0ID0gcmVxdWlyZV90b19pbmRleGVkX29iamVjdCgpOwogICAgICB2YXIgJGdldE93blByb3BlcnR5TmFtZXMgPSByZXF1aXJlX29iamVjdF9nZXRfb3duX3Byb3BlcnR5X25hbWVzKCkuZjsKICAgICAgdmFyIHRvU3RyaW5nID0ge30udG9TdHJpbmc7CiAgICAgIHZhciB3aW5kb3dOYW1lcyA9IHR5cGVvZiB3aW5kb3cgPT0gIm9iamVjdCIgJiYgd2luZG93ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzID8gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMod2luZG93KSA6IFtdOwogICAgICB2YXIgZ2V0V2luZG93TmFtZXMgPSBmdW5jdGlvbihpdCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gJGdldE93blByb3BlcnR5TmFtZXMoaXQpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICByZXR1cm4gd2luZG93TmFtZXMuc2xpY2UoKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIG1vZHVsZS5leHBvcnRzLmYgPSBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eU5hbWVzKGl0KSB7CiAgICAgICAgcmV0dXJuIHdpbmRvd05hbWVzICYmIHRvU3RyaW5nLmNhbGwoaXQpID09ICJbb2JqZWN0IFdpbmRvd10iID8gZ2V0V2luZG93TmFtZXMoaXQpIDogJGdldE93blByb3BlcnR5TmFtZXModG9JbmRleGVkT2JqZWN0KGl0KSk7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL29iamVjdC1nZXQtb3duLXByb3BlcnR5LXN5bWJvbHMuanMKICB2YXIgcmVxdWlyZV9vYmplY3RfZ2V0X293bl9wcm9wZXJ0eV9zeW1ib2xzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvb2JqZWN0LWdldC1vd24tcHJvcGVydHktc3ltYm9scy5qcyIoZXhwb3J0cykgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIGV4cG9ydHMuZiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL3dlbGwta25vd24tc3ltYm9sLXdyYXBwZWQuanMKICB2YXIgcmVxdWlyZV93ZWxsX2tub3duX3N5bWJvbF93cmFwcGVkID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvd2VsbC1rbm93bi1zeW1ib2wtd3JhcHBlZC5qcyIoZXhwb3J0cykgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSByZXF1aXJlX3dlbGxfa25vd25fc3ltYm9sKCk7CiAgICAgIGV4cG9ydHMuZiA9IHdlbGxLbm93blN5bWJvbDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZGVmaW5lLXdlbGwta25vd24tc3ltYm9sLmpzCiAgdmFyIHJlcXVpcmVfZGVmaW5lX3dlbGxfa25vd25fc3ltYm9sID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZGVmaW5lLXdlbGwta25vd24tc3ltYm9sLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgcGF0aCA9IHJlcXVpcmVfcGF0aCgpOwogICAgICB2YXIgaGFzID0gcmVxdWlyZV9oYXMoKTsKICAgICAgdmFyIHdyYXBwZWRXZWxsS25vd25TeW1ib2xNb2R1bGUgPSByZXF1aXJlX3dlbGxfa25vd25fc3ltYm9sX3dyYXBwZWQoKTsKICAgICAgdmFyIGRlZmluZVByb3BlcnR5ID0gcmVxdWlyZV9vYmplY3RfZGVmaW5lX3Byb3BlcnR5KCkuZjsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihOQU1FKSB7CiAgICAgICAgdmFyIFN5bWJvbDIgPSBwYXRoLlN5bWJvbCB8fCAocGF0aC5TeW1ib2wgPSB7fSk7CiAgICAgICAgaWYgKCFoYXMoU3ltYm9sMiwgTkFNRSkpCiAgICAgICAgICBkZWZpbmVQcm9wZXJ0eShTeW1ib2wyLCBOQU1FLCB7CiAgICAgICAgICAgIHZhbHVlOiB3cmFwcGVkV2VsbEtub3duU3ltYm9sTW9kdWxlLmYoTkFNRSkKICAgICAgICAgIH0pOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9hcnJheS1pdGVyYXRpb24uanMKICB2YXIgcmVxdWlyZV9hcnJheV9pdGVyYXRpb24gPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9hcnJheS1pdGVyYXRpb24uanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBiaW5kID0gcmVxdWlyZV9mdW5jdGlvbl9iaW5kX2NvbnRleHQoKTsKICAgICAgdmFyIEluZGV4ZWRPYmplY3QgPSByZXF1aXJlX2luZGV4ZWRfb2JqZWN0KCk7CiAgICAgIHZhciB0b09iamVjdCA9IHJlcXVpcmVfdG9fb2JqZWN0KCk7CiAgICAgIHZhciB0b0xlbmd0aCA9IHJlcXVpcmVfdG9fbGVuZ3RoKCk7CiAgICAgIHZhciBhcnJheVNwZWNpZXNDcmVhdGUgPSByZXF1aXJlX2FycmF5X3NwZWNpZXNfY3JlYXRlKCk7CiAgICAgIHZhciBwdXNoID0gW10ucHVzaDsKICAgICAgdmFyIGNyZWF0ZU1ldGhvZCA9IGZ1bmN0aW9uKFRZUEUpIHsKICAgICAgICB2YXIgSVNfTUFQID0gVFlQRSA9PSAxOwogICAgICAgIHZhciBJU19GSUxURVIgPSBUWVBFID09IDI7CiAgICAgICAgdmFyIElTX1NPTUUgPSBUWVBFID09IDM7CiAgICAgICAgdmFyIElTX0VWRVJZID0gVFlQRSA9PSA0OwogICAgICAgIHZhciBJU19GSU5EX0lOREVYID0gVFlQRSA9PSA2OwogICAgICAgIHZhciBJU19GSUxURVJfUkVKRUNUID0gVFlQRSA9PSA3OwogICAgICAgIHZhciBOT19IT0xFUyA9IFRZUEUgPT0gNSB8fCBJU19GSU5EX0lOREVYOwogICAgICAgIHJldHVybiBmdW5jdGlvbigkdGhpcywgY2FsbGJhY2tmbiwgdGhhdCwgc3BlY2lmaWNDcmVhdGUpIHsKICAgICAgICAgIHZhciBPID0gdG9PYmplY3QoJHRoaXMpOwogICAgICAgICAgdmFyIHNlbGYyID0gSW5kZXhlZE9iamVjdChPKTsKICAgICAgICAgIHZhciBib3VuZEZ1bmN0aW9uID0gYmluZChjYWxsYmFja2ZuLCB0aGF0LCAzKTsKICAgICAgICAgIHZhciBsZW5ndGggPSB0b0xlbmd0aChzZWxmMi5sZW5ndGgpOwogICAgICAgICAgdmFyIGluZGV4ID0gMDsKICAgICAgICAgIHZhciBjcmVhdGUgPSBzcGVjaWZpY0NyZWF0ZSB8fCBhcnJheVNwZWNpZXNDcmVhdGU7CiAgICAgICAgICB2YXIgdGFyZ2V0ID0gSVNfTUFQID8gY3JlYXRlKCR0aGlzLCBsZW5ndGgpIDogSVNfRklMVEVSIHx8IElTX0ZJTFRFUl9SRUpFQ1QgPyBjcmVhdGUoJHRoaXMsIDApIDogdm9pZCAwOwogICAgICAgICAgdmFyIHZhbHVlLCByZXN1bHQ7CiAgICAgICAgICBmb3IgKDsgbGVuZ3RoID4gaW5kZXg7IGluZGV4KyspCiAgICAgICAgICAgIGlmIChOT19IT0xFUyB8fCBpbmRleCBpbiBzZWxmMikgewogICAgICAgICAgICAgIHZhbHVlID0gc2VsZjJbaW5kZXhdOwogICAgICAgICAgICAgIHJlc3VsdCA9IGJvdW5kRnVuY3Rpb24odmFsdWUsIGluZGV4LCBPKTsKICAgICAgICAgICAgICBpZiAoVFlQRSkgewogICAgICAgICAgICAgICAgaWYgKElTX01BUCkKICAgICAgICAgICAgICAgICAgdGFyZ2V0W2luZGV4XSA9IHJlc3VsdDsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlc3VsdCkKICAgICAgICAgICAgICAgICAgc3dpdGNoIChUWVBFKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbmRleDsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICBwdXNoLmNhbGwodGFyZ2V0LCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgc3dpdGNoIChUWVBFKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgICAgIHB1c2guY2FsbCh0YXJnZXQsIHZhbHVlKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIElTX0ZJTkRfSU5ERVggPyAtMSA6IElTX1NPTUUgfHwgSVNfRVZFUlkgPyBJU19FVkVSWSA6IHRhcmdldDsKICAgICAgICB9OwogICAgICB9OwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgICBmb3JFYWNoOiBjcmVhdGVNZXRob2QoMCksCiAgICAgICAgbWFwOiBjcmVhdGVNZXRob2QoMSksCiAgICAgICAgZmlsdGVyOiBjcmVhdGVNZXRob2QoMiksCiAgICAgICAgc29tZTogY3JlYXRlTWV0aG9kKDMpLAogICAgICAgIGV2ZXJ5OiBjcmVhdGVNZXRob2QoNCksCiAgICAgICAgZmluZDogY3JlYXRlTWV0aG9kKDUpLAogICAgICAgIGZpbmRJbmRleDogY3JlYXRlTWV0aG9kKDYpLAogICAgICAgIGZpbHRlclJlamVjdDogY3JlYXRlTWV0aG9kKDcpCiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5zeW1ib2wuanMKICB2YXIgcmVxdWlyZV9lc19zeW1ib2wgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMuc3ltYm9sLmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciAkID0gcmVxdWlyZV9leHBvcnQoKTsKICAgICAgdmFyIGdsb2JhbDIgPSByZXF1aXJlX2dsb2JhbCgpOwogICAgICB2YXIgZ2V0QnVpbHRJbiA9IHJlcXVpcmVfZ2V0X2J1aWx0X2luKCk7CiAgICAgIHZhciBJU19QVVJFID0gcmVxdWlyZV9pc19wdXJlKCk7CiAgICAgIHZhciBERVNDUklQVE9SUyA9IHJlcXVpcmVfZGVzY3JpcHRvcnMoKTsKICAgICAgdmFyIE5BVElWRV9TWU1CT0wgPSByZXF1aXJlX25hdGl2ZV9zeW1ib2woKTsKICAgICAgdmFyIGZhaWxzID0gcmVxdWlyZV9mYWlscygpOwogICAgICB2YXIgaGFzID0gcmVxdWlyZV9oYXMoKTsKICAgICAgdmFyIGlzQXJyYXkgPSByZXF1aXJlX2lzX2FycmF5KCk7CiAgICAgIHZhciBpc0NhbGxhYmxlID0gcmVxdWlyZV9pc19jYWxsYWJsZSgpOwogICAgICB2YXIgaXNPYmplY3QgPSByZXF1aXJlX2lzX29iamVjdCgpOwogICAgICB2YXIgaXNTeW1ib2wgPSByZXF1aXJlX2lzX3N5bWJvbCgpOwogICAgICB2YXIgYW5PYmplY3QgPSByZXF1aXJlX2FuX29iamVjdCgpOwogICAgICB2YXIgdG9PYmplY3QgPSByZXF1aXJlX3RvX29iamVjdCgpOwogICAgICB2YXIgdG9JbmRleGVkT2JqZWN0ID0gcmVxdWlyZV90b19pbmRleGVkX29iamVjdCgpOwogICAgICB2YXIgdG9Qcm9wZXJ0eUtleSA9IHJlcXVpcmVfdG9fcHJvcGVydHlfa2V5KCk7CiAgICAgIHZhciAkdG9TdHJpbmcgPSByZXF1aXJlX3RvX3N0cmluZygpOwogICAgICB2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yID0gcmVxdWlyZV9jcmVhdGVfcHJvcGVydHlfZGVzY3JpcHRvcigpOwogICAgICB2YXIgbmF0aXZlT2JqZWN0Q3JlYXRlID0gcmVxdWlyZV9vYmplY3RfY3JlYXRlKCk7CiAgICAgIHZhciBvYmplY3RLZXlzID0gcmVxdWlyZV9vYmplY3Rfa2V5cygpOwogICAgICB2YXIgZ2V0T3duUHJvcGVydHlOYW1lc01vZHVsZSA9IHJlcXVpcmVfb2JqZWN0X2dldF9vd25fcHJvcGVydHlfbmFtZXMoKTsKICAgICAgdmFyIGdldE93blByb3BlcnR5TmFtZXNFeHRlcm5hbCA9IHJlcXVpcmVfb2JqZWN0X2dldF9vd25fcHJvcGVydHlfbmFtZXNfZXh0ZXJuYWwoKTsKICAgICAgdmFyIGdldE93blByb3BlcnR5U3ltYm9sc01vZHVsZSA9IHJlcXVpcmVfb2JqZWN0X2dldF9vd25fcHJvcGVydHlfc3ltYm9scygpOwogICAgICB2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yTW9kdWxlID0gcmVxdWlyZV9vYmplY3RfZ2V0X293bl9wcm9wZXJ0eV9kZXNjcmlwdG9yKCk7CiAgICAgIHZhciBkZWZpbmVQcm9wZXJ0eU1vZHVsZSA9IHJlcXVpcmVfb2JqZWN0X2RlZmluZV9wcm9wZXJ0eSgpOwogICAgICB2YXIgcHJvcGVydHlJc0VudW1lcmFibGVNb2R1bGUgPSByZXF1aXJlX29iamVjdF9wcm9wZXJ0eV9pc19lbnVtZXJhYmxlKCk7CiAgICAgIHZhciByZWRlZmluZSA9IHJlcXVpcmVfcmVkZWZpbmUoKTsKICAgICAgdmFyIHNoYXJlZCA9IHJlcXVpcmVfc2hhcmVkKCk7CiAgICAgIHZhciBzaGFyZWRLZXkgPSByZXF1aXJlX3NoYXJlZF9rZXkoKTsKICAgICAgdmFyIGhpZGRlbktleXMgPSByZXF1aXJlX2hpZGRlbl9rZXlzKCk7CiAgICAgIHZhciB1aWQgPSByZXF1aXJlX3VpZCgpOwogICAgICB2YXIgd2VsbEtub3duU3ltYm9sID0gcmVxdWlyZV93ZWxsX2tub3duX3N5bWJvbCgpOwogICAgICB2YXIgd3JhcHBlZFdlbGxLbm93blN5bWJvbE1vZHVsZSA9IHJlcXVpcmVfd2VsbF9rbm93bl9zeW1ib2xfd3JhcHBlZCgpOwogICAgICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sID0gcmVxdWlyZV9kZWZpbmVfd2VsbF9rbm93bl9zeW1ib2woKTsKICAgICAgdmFyIHNldFRvU3RyaW5nVGFnID0gcmVxdWlyZV9zZXRfdG9fc3RyaW5nX3RhZygpOwogICAgICB2YXIgSW50ZXJuYWxTdGF0ZU1vZHVsZSA9IHJlcXVpcmVfaW50ZXJuYWxfc3RhdGUoKTsKICAgICAgdmFyICRmb3JFYWNoID0gcmVxdWlyZV9hcnJheV9pdGVyYXRpb24oKS5mb3JFYWNoOwogICAgICB2YXIgSElEREVOID0gc2hhcmVkS2V5KCJoaWRkZW4iKTsKICAgICAgdmFyIFNZTUJPTCA9ICJTeW1ib2wiOwogICAgICB2YXIgUFJPVE9UWVBFID0gInByb3RvdHlwZSI7CiAgICAgIHZhciBUT19QUklNSVRJVkUgPSB3ZWxsS25vd25TeW1ib2woInRvUHJpbWl0aXZlIik7CiAgICAgIHZhciBzZXRJbnRlcm5hbFN0YXRlID0gSW50ZXJuYWxTdGF0ZU1vZHVsZS5zZXQ7CiAgICAgIHZhciBnZXRJbnRlcm5hbFN0YXRlID0gSW50ZXJuYWxTdGF0ZU1vZHVsZS5nZXR0ZXJGb3IoU1lNQk9MKTsKICAgICAgdmFyIE9iamVjdFByb3RvdHlwZSA9IE9iamVjdFtQUk9UT1RZUEVdOwogICAgICB2YXIgJFN5bWJvbCA9IGdsb2JhbDIuU3ltYm9sOwogICAgICB2YXIgJHN0cmluZ2lmeSA9IGdldEJ1aWx0SW4oIkpTT04iLCAic3RyaW5naWZ5Iik7CiAgICAgIHZhciBuYXRpdmVHZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JNb2R1bGUuZjsKICAgICAgdmFyIG5hdGl2ZURlZmluZVByb3BlcnR5ID0gZGVmaW5lUHJvcGVydHlNb2R1bGUuZjsKICAgICAgdmFyIG5hdGl2ZUdldE93blByb3BlcnR5TmFtZXMgPSBnZXRPd25Qcm9wZXJ0eU5hbWVzRXh0ZXJuYWwuZjsKICAgICAgdmFyIG5hdGl2ZVByb3BlcnR5SXNFbnVtZXJhYmxlID0gcHJvcGVydHlJc0VudW1lcmFibGVNb2R1bGUuZjsKICAgICAgdmFyIEFsbFN5bWJvbHMgPSBzaGFyZWQoInN5bWJvbHMiKTsKICAgICAgdmFyIE9iamVjdFByb3RvdHlwZVN5bWJvbHMgPSBzaGFyZWQoIm9wLXN5bWJvbHMiKTsKICAgICAgdmFyIFN0cmluZ1RvU3ltYm9sUmVnaXN0cnkgPSBzaGFyZWQoInN0cmluZy10by1zeW1ib2wtcmVnaXN0cnkiKTsKICAgICAgdmFyIFN5bWJvbFRvU3RyaW5nUmVnaXN0cnkgPSBzaGFyZWQoInN5bWJvbC10by1zdHJpbmctcmVnaXN0cnkiKTsKICAgICAgdmFyIFdlbGxLbm93blN5bWJvbHNTdG9yZSA9IHNoYXJlZCgid2tzIik7CiAgICAgIHZhciBRT2JqZWN0ID0gZ2xvYmFsMi5RT2JqZWN0OwogICAgICB2YXIgVVNFX1NFVFRFUiA9ICFRT2JqZWN0IHx8ICFRT2JqZWN0W1BST1RPVFlQRV0gfHwgIVFPYmplY3RbUFJPVE9UWVBFXS5maW5kQ2hpbGQ7CiAgICAgIHZhciBzZXRTeW1ib2xEZXNjcmlwdG9yID0gREVTQ1JJUFRPUlMgJiYgZmFpbHMoZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG5hdGl2ZU9iamVjdENyZWF0ZShuYXRpdmVEZWZpbmVQcm9wZXJ0eSh7fSwgImEiLCB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gbmF0aXZlRGVmaW5lUHJvcGVydHkodGhpcywgImEiLCB7IHZhbHVlOiA3IH0pLmE7CiAgICAgICAgICB9CiAgICAgICAgfSkpLmEgIT0gNzsKICAgICAgfSkgPyBmdW5jdGlvbihPLCBQLCBBdHRyaWJ1dGVzKSB7CiAgICAgICAgdmFyIE9iamVjdFByb3RvdHlwZURlc2NyaXB0b3IgPSBuYXRpdmVHZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoT2JqZWN0UHJvdG90eXBlLCBQKTsKICAgICAgICBpZiAoT2JqZWN0UHJvdG90eXBlRGVzY3JpcHRvcikKICAgICAgICAgIGRlbGV0ZSBPYmplY3RQcm90b3R5cGVbUF07CiAgICAgICAgbmF0aXZlRGVmaW5lUHJvcGVydHkoTywgUCwgQXR0cmlidXRlcyk7CiAgICAgICAgaWYgKE9iamVjdFByb3RvdHlwZURlc2NyaXB0b3IgJiYgTyAhPT0gT2JqZWN0UHJvdG90eXBlKSB7CiAgICAgICAgICBuYXRpdmVEZWZpbmVQcm9wZXJ0eShPYmplY3RQcm90b3R5cGUsIFAsIE9iamVjdFByb3RvdHlwZURlc2NyaXB0b3IpOwogICAgICAgIH0KICAgICAgfSA6IG5hdGl2ZURlZmluZVByb3BlcnR5OwogICAgICB2YXIgd3JhcCA9IGZ1bmN0aW9uKHRhZywgZGVzY3JpcHRpb24pIHsKICAgICAgICB2YXIgc3ltYm9sID0gQWxsU3ltYm9sc1t0YWddID0gbmF0aXZlT2JqZWN0Q3JlYXRlKCRTeW1ib2xbUFJPVE9UWVBFXSk7CiAgICAgICAgc2V0SW50ZXJuYWxTdGF0ZShzeW1ib2wsIHsKICAgICAgICAgIHR5cGU6IFNZTUJPTCwKICAgICAgICAgIHRhZywKICAgICAgICAgIGRlc2NyaXB0aW9uCiAgICAgICAgfSk7CiAgICAgICAgaWYgKCFERVNDUklQVE9SUykKICAgICAgICAgIHN5bWJvbC5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uOwogICAgICAgIHJldHVybiBzeW1ib2w7CiAgICAgIH07CiAgICAgIHZhciAkZGVmaW5lUHJvcGVydHkgPSBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0eShPLCBQLCBBdHRyaWJ1dGVzKSB7CiAgICAgICAgaWYgKE8gPT09IE9iamVjdFByb3RvdHlwZSkKICAgICAgICAgICRkZWZpbmVQcm9wZXJ0eShPYmplY3RQcm90b3R5cGVTeW1ib2xzLCBQLCBBdHRyaWJ1dGVzKTsKICAgICAgICBhbk9iamVjdChPKTsKICAgICAgICB2YXIga2V5ID0gdG9Qcm9wZXJ0eUtleShQKTsKICAgICAgICBhbk9iamVjdChBdHRyaWJ1dGVzKTsKICAgICAgICBpZiAoaGFzKEFsbFN5bWJvbHMsIGtleSkpIHsKICAgICAgICAgIGlmICghQXR0cmlidXRlcy5lbnVtZXJhYmxlKSB7CiAgICAgICAgICAgIGlmICghaGFzKE8sIEhJRERFTikpCiAgICAgICAgICAgICAgbmF0aXZlRGVmaW5lUHJvcGVydHkoTywgSElEREVOLCBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IoMSwge30pKTsKICAgICAgICAgICAgT1tISURERU5dW2tleV0gPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKGhhcyhPLCBISURERU4pICYmIE9bSElEREVOXVtrZXldKQogICAgICAgICAgICAgIE9bSElEREVOXVtrZXldID0gZmFsc2U7CiAgICAgICAgICAgIEF0dHJpYnV0ZXMgPSBuYXRpdmVPYmplY3RDcmVhdGUoQXR0cmlidXRlcywgeyBlbnVtZXJhYmxlOiBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IoMCwgZmFsc2UpIH0pOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHNldFN5bWJvbERlc2NyaXB0b3IoTywga2V5LCBBdHRyaWJ1dGVzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5hdGl2ZURlZmluZVByb3BlcnR5KE8sIGtleSwgQXR0cmlidXRlcyk7CiAgICAgIH07CiAgICAgIHZhciAkZGVmaW5lUHJvcGVydGllcyA9IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXMoTywgUHJvcGVydGllcykgewogICAgICAgIGFuT2JqZWN0KE8pOwogICAgICAgIHZhciBwcm9wZXJ0aWVzID0gdG9JbmRleGVkT2JqZWN0KFByb3BlcnRpZXMpOwogICAgICAgIHZhciBrZXlzID0gb2JqZWN0S2V5cyhwcm9wZXJ0aWVzKS5jb25jYXQoJGdldE93blByb3BlcnR5U3ltYm9scyhwcm9wZXJ0aWVzKSk7CiAgICAgICAgJGZvckVhY2goa2V5cywgZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICBpZiAoIURFU0NSSVBUT1JTIHx8ICRwcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHByb3BlcnRpZXMsIGtleSkpCiAgICAgICAgICAgICRkZWZpbmVQcm9wZXJ0eShPLCBrZXksIHByb3BlcnRpZXNba2V5XSk7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIE87CiAgICAgIH07CiAgICAgIHZhciAkY3JlYXRlID0gZnVuY3Rpb24gY3JlYXRlKE8sIFByb3BlcnRpZXMpIHsKICAgICAgICByZXR1cm4gUHJvcGVydGllcyA9PT0gdm9pZCAwID8gbmF0aXZlT2JqZWN0Q3JlYXRlKE8pIDogJGRlZmluZVByb3BlcnRpZXMobmF0aXZlT2JqZWN0Q3JlYXRlKE8pLCBQcm9wZXJ0aWVzKTsKICAgICAgfTsKICAgICAgdmFyICRwcm9wZXJ0eUlzRW51bWVyYWJsZSA9IGZ1bmN0aW9uIHByb3BlcnR5SXNFbnVtZXJhYmxlKFYpIHsKICAgICAgICB2YXIgUCA9IHRvUHJvcGVydHlLZXkoVik7CiAgICAgICAgdmFyIGVudW1lcmFibGUgPSBuYXRpdmVQcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHRoaXMsIFApOwogICAgICAgIGlmICh0aGlzID09PSBPYmplY3RQcm90b3R5cGUgJiYgaGFzKEFsbFN5bWJvbHMsIFApICYmICFoYXMoT2JqZWN0UHJvdG90eXBlU3ltYm9scywgUCkpCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIGVudW1lcmFibGUgfHwgIWhhcyh0aGlzLCBQKSB8fCAhaGFzKEFsbFN5bWJvbHMsIFApIHx8IGhhcyh0aGlzLCBISURERU4pICYmIHRoaXNbSElEREVOXVtQXSA/IGVudW1lcmFibGUgOiB0cnVlOwogICAgICB9OwogICAgICB2YXIgJGdldE93blByb3BlcnR5RGVzY3JpcHRvciA9IGZ1bmN0aW9uIGdldE93blByb3BlcnR5RGVzY3JpcHRvcihPLCBQKSB7CiAgICAgICAgdmFyIGl0ID0gdG9JbmRleGVkT2JqZWN0KE8pOwogICAgICAgIHZhciBrZXkgPSB0b1Byb3BlcnR5S2V5KFApOwogICAgICAgIGlmIChpdCA9PT0gT2JqZWN0UHJvdG90eXBlICYmIGhhcyhBbGxTeW1ib2xzLCBrZXkpICYmICFoYXMoT2JqZWN0UHJvdG90eXBlU3ltYm9scywga2V5KSkKICAgICAgICAgIHJldHVybjsKICAgICAgICB2YXIgZGVzY3JpcHRvciA9IG5hdGl2ZUdldE93blByb3BlcnR5RGVzY3JpcHRvcihpdCwga2V5KTsKICAgICAgICBpZiAoZGVzY3JpcHRvciAmJiBoYXMoQWxsU3ltYm9scywga2V5KSAmJiAhKGhhcyhpdCwgSElEREVOKSAmJiBpdFtISURERU5dW2tleV0pKSB7CiAgICAgICAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZGVzY3JpcHRvcjsKICAgICAgfTsKICAgICAgdmFyICRnZXRPd25Qcm9wZXJ0eU5hbWVzID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlOYW1lcyhPKSB7CiAgICAgICAgdmFyIG5hbWVzID0gbmF0aXZlR2V0T3duUHJvcGVydHlOYW1lcyh0b0luZGV4ZWRPYmplY3QoTykpOwogICAgICAgIHZhciByZXN1bHQgPSBbXTsKICAgICAgICAkZm9yRWFjaChuYW1lcywgZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICBpZiAoIWhhcyhBbGxTeW1ib2xzLCBrZXkpICYmICFoYXMoaGlkZGVuS2V5cywga2V5KSkKICAgICAgICAgICAgcmVzdWx0LnB1c2goa2V5KTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwogICAgICB2YXIgJGdldE93blByb3BlcnR5U3ltYm9scyA9IGZ1bmN0aW9uIGdldE93blByb3BlcnR5U3ltYm9scyhPKSB7CiAgICAgICAgdmFyIElTX09CSkVDVF9QUk9UT1RZUEUgPSBPID09PSBPYmplY3RQcm90b3R5cGU7CiAgICAgICAgdmFyIG5hbWVzID0gbmF0aXZlR2V0T3duUHJvcGVydHlOYW1lcyhJU19PQkpFQ1RfUFJPVE9UWVBFID8gT2JqZWN0UHJvdG90eXBlU3ltYm9scyA6IHRvSW5kZXhlZE9iamVjdChPKSk7CiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICAgICRmb3JFYWNoKG5hbWVzLCBmdW5jdGlvbihrZXkpIHsKICAgICAgICAgIGlmIChoYXMoQWxsU3ltYm9scywga2V5KSAmJiAoIUlTX09CSkVDVF9QUk9UT1RZUEUgfHwgaGFzKE9iamVjdFByb3RvdHlwZSwga2V5KSkpIHsKICAgICAgICAgICAgcmVzdWx0LnB1c2goQWxsU3ltYm9sc1trZXldKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwogICAgICBpZiAoIU5BVElWRV9TWU1CT0wpIHsKICAgICAgICAkU3ltYm9sID0gZnVuY3Rpb24gU3ltYm9sMigpIHsKICAgICAgICAgIGlmICh0aGlzIGluc3RhbmNlb2YgJFN5bWJvbCkKICAgICAgICAgICAgdGhyb3cgVHlwZUVycm9yKCJTeW1ib2wgaXMgbm90IGEgY29uc3RydWN0b3IiKTsKICAgICAgICAgIHZhciBkZXNjcmlwdGlvbiA9ICFhcmd1bWVudHMubGVuZ3RoIHx8IGFyZ3VtZW50c1swXSA9PT0gdm9pZCAwID8gdm9pZCAwIDogJHRvU3RyaW5nKGFyZ3VtZW50c1swXSk7CiAgICAgICAgICB2YXIgdGFnID0gdWlkKGRlc2NyaXB0aW9uKTsKICAgICAgICAgIHZhciBzZXR0ZXIgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICBpZiAodGhpcyA9PT0gT2JqZWN0UHJvdG90eXBlKQogICAgICAgICAgICAgIHNldHRlci5jYWxsKE9iamVjdFByb3RvdHlwZVN5bWJvbHMsIHZhbHVlKTsKICAgICAgICAgICAgaWYgKGhhcyh0aGlzLCBISURERU4pICYmIGhhcyh0aGlzW0hJRERFTl0sIHRhZykpCiAgICAgICAgICAgICAgdGhpc1tISURERU5dW3RhZ10gPSBmYWxzZTsKICAgICAgICAgICAgc2V0U3ltYm9sRGVzY3JpcHRvcih0aGlzLCB0YWcsIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvcigxLCB2YWx1ZSkpOwogICAgICAgICAgfTsKICAgICAgICAgIGlmIChERVNDUklQVE9SUyAmJiBVU0VfU0VUVEVSKQogICAgICAgICAgICBzZXRTeW1ib2xEZXNjcmlwdG9yKE9iamVjdFByb3RvdHlwZSwgdGFnLCB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSwgc2V0OiBzZXR0ZXIgfSk7CiAgICAgICAgICByZXR1cm4gd3JhcCh0YWcsIGRlc2NyaXB0aW9uKTsKICAgICAgICB9OwogICAgICAgIHJlZGVmaW5lKCRTeW1ib2xbUFJPVE9UWVBFXSwgInRvU3RyaW5nIiwgZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgICAgICByZXR1cm4gZ2V0SW50ZXJuYWxTdGF0ZSh0aGlzKS50YWc7CiAgICAgICAgfSk7CiAgICAgICAgcmVkZWZpbmUoJFN5bWJvbCwgIndpdGhvdXRTZXR0ZXIiLCBmdW5jdGlvbihkZXNjcmlwdGlvbikgewogICAgICAgICAgcmV0dXJuIHdyYXAodWlkKGRlc2NyaXB0aW9uKSwgZGVzY3JpcHRpb24pOwogICAgICAgIH0pOwogICAgICAgIHByb3BlcnR5SXNFbnVtZXJhYmxlTW9kdWxlLmYgPSAkcHJvcGVydHlJc0VudW1lcmFibGU7CiAgICAgICAgZGVmaW5lUHJvcGVydHlNb2R1bGUuZiA9ICRkZWZpbmVQcm9wZXJ0eTsKICAgICAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JNb2R1bGUuZiA9ICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CiAgICAgICAgZ2V0T3duUHJvcGVydHlOYW1lc01vZHVsZS5mID0gZ2V0T3duUHJvcGVydHlOYW1lc0V4dGVybmFsLmYgPSAkZ2V0T3duUHJvcGVydHlOYW1lczsKICAgICAgICBnZXRPd25Qcm9wZXJ0eVN5bWJvbHNNb2R1bGUuZiA9ICRnZXRPd25Qcm9wZXJ0eVN5bWJvbHM7CiAgICAgICAgd3JhcHBlZFdlbGxLbm93blN5bWJvbE1vZHVsZS5mID0gZnVuY3Rpb24obmFtZSkgewogICAgICAgICAgcmV0dXJuIHdyYXAod2VsbEtub3duU3ltYm9sKG5hbWUpLCBuYW1lKTsKICAgICAgICB9OwogICAgICAgIGlmIChERVNDUklQVE9SUykgewogICAgICAgICAgbmF0aXZlRGVmaW5lUHJvcGVydHkoJFN5bWJvbFtQUk9UT1RZUEVdLCAiZGVzY3JpcHRpb24iLCB7CiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiBkZXNjcmlwdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gZ2V0SW50ZXJuYWxTdGF0ZSh0aGlzKS5kZXNjcmlwdGlvbjsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBpZiAoIUlTX1BVUkUpIHsKICAgICAgICAgICAgcmVkZWZpbmUoT2JqZWN0UHJvdG90eXBlLCAicHJvcGVydHlJc0VudW1lcmFibGUiLCAkcHJvcGVydHlJc0VudW1lcmFibGUsIHsgdW5zYWZlOiB0cnVlIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICAkKHsgZ2xvYmFsOiB0cnVlLCB3cmFwOiB0cnVlLCBmb3JjZWQ6ICFOQVRJVkVfU1lNQk9MLCBzaGFtOiAhTkFUSVZFX1NZTUJPTCB9LCB7CiAgICAgICAgU3ltYm9sOiAkU3ltYm9sCiAgICAgIH0pOwogICAgICAkZm9yRWFjaChvYmplY3RLZXlzKFdlbGxLbm93blN5bWJvbHNTdG9yZSksIGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgICBkZWZpbmVXZWxsS25vd25TeW1ib2wobmFtZSk7CiAgICAgIH0pOwogICAgICAkKHsgdGFyZ2V0OiBTWU1CT0wsIHN0YXQ6IHRydWUsIGZvcmNlZDogIU5BVElWRV9TWU1CT0wgfSwgewogICAgICAgICJmb3IiOiBmdW5jdGlvbihrZXkpIHsKICAgICAgICAgIHZhciBzdHJpbmcgPSAkdG9TdHJpbmcoa2V5KTsKICAgICAgICAgIGlmIChoYXMoU3RyaW5nVG9TeW1ib2xSZWdpc3RyeSwgc3RyaW5nKSkKICAgICAgICAgICAgcmV0dXJuIFN0cmluZ1RvU3ltYm9sUmVnaXN0cnlbc3RyaW5nXTsKICAgICAgICAgIHZhciBzeW1ib2wgPSAkU3ltYm9sKHN0cmluZyk7CiAgICAgICAgICBTdHJpbmdUb1N5bWJvbFJlZ2lzdHJ5W3N0cmluZ10gPSBzeW1ib2w7CiAgICAgICAgICBTeW1ib2xUb1N0cmluZ1JlZ2lzdHJ5W3N5bWJvbF0gPSBzdHJpbmc7CiAgICAgICAgICByZXR1cm4gc3ltYm9sOwogICAgICAgIH0sCiAgICAgICAga2V5Rm9yOiBmdW5jdGlvbiBrZXlGb3Ioc3ltKSB7CiAgICAgICAgICBpZiAoIWlzU3ltYm9sKHN5bSkpCiAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihzeW0gKyAiIGlzIG5vdCBhIHN5bWJvbCIpOwogICAgICAgICAgaWYgKGhhcyhTeW1ib2xUb1N0cmluZ1JlZ2lzdHJ5LCBzeW0pKQogICAgICAgICAgICByZXR1cm4gU3ltYm9sVG9TdHJpbmdSZWdpc3RyeVtzeW1dOwogICAgICAgIH0sCiAgICAgICAgdXNlU2V0dGVyOiBmdW5jdGlvbigpIHsKICAgICAgICAgIFVTRV9TRVRURVIgPSB0cnVlOwogICAgICAgIH0sCiAgICAgICAgdXNlU2ltcGxlOiBmdW5jdGlvbigpIHsKICAgICAgICAgIFVTRV9TRVRURVIgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICAkKHsgdGFyZ2V0OiAiT2JqZWN0Iiwgc3RhdDogdHJ1ZSwgZm9yY2VkOiAhTkFUSVZFX1NZTUJPTCwgc2hhbTogIURFU0NSSVBUT1JTIH0sIHsKICAgICAgICBjcmVhdGU6ICRjcmVhdGUsCiAgICAgICAgZGVmaW5lUHJvcGVydHk6ICRkZWZpbmVQcm9wZXJ0eSwKICAgICAgICBkZWZpbmVQcm9wZXJ0aWVzOiAkZGVmaW5lUHJvcGVydGllcywKICAgICAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I6ICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IKICAgICAgfSk7CiAgICAgICQoeyB0YXJnZXQ6ICJPYmplY3QiLCBzdGF0OiB0cnVlLCBmb3JjZWQ6ICFOQVRJVkVfU1lNQk9MIH0sIHsKICAgICAgICBnZXRPd25Qcm9wZXJ0eU5hbWVzOiAkZ2V0T3duUHJvcGVydHlOYW1lcywKICAgICAgICBnZXRPd25Qcm9wZXJ0eVN5bWJvbHM6ICRnZXRPd25Qcm9wZXJ0eVN5bWJvbHMKICAgICAgfSk7CiAgICAgICQoeyB0YXJnZXQ6ICJPYmplY3QiLCBzdGF0OiB0cnVlLCBmb3JjZWQ6IGZhaWxzKGZ1bmN0aW9uKCkgewogICAgICAgIGdldE93blByb3BlcnR5U3ltYm9sc01vZHVsZS5mKDEpOwogICAgICB9KSB9LCB7CiAgICAgICAgZ2V0T3duUHJvcGVydHlTeW1ib2xzOiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMoaXQpIHsKICAgICAgICAgIHJldHVybiBnZXRPd25Qcm9wZXJ0eVN5bWJvbHNNb2R1bGUuZih0b09iamVjdChpdCkpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIGlmICgkc3RyaW5naWZ5KSB7CiAgICAgICAgRk9SQ0VEX0pTT05fU1RSSU5HSUZZID0gIU5BVElWRV9TWU1CT0wgfHwgZmFpbHMoZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgc3ltYm9sID0gJFN5bWJvbCgpOwogICAgICAgICAgcmV0dXJuICRzdHJpbmdpZnkoW3N5bWJvbF0pICE9ICJbbnVsbF0iIHx8ICRzdHJpbmdpZnkoeyBhOiBzeW1ib2wgfSkgIT0gInt9IiB8fCAkc3RyaW5naWZ5KE9iamVjdChzeW1ib2wpKSAhPSAie30iOwogICAgICAgIH0pOwogICAgICAgICQoeyB0YXJnZXQ6ICJKU09OIiwgc3RhdDogdHJ1ZSwgZm9yY2VkOiBGT1JDRURfSlNPTl9TVFJJTkdJRlkgfSwgewogICAgICAgICAgc3RyaW5naWZ5OiBmdW5jdGlvbiBzdHJpbmdpZnkoaXQsIHJlcGxhY2VyLCBzcGFjZSkgewogICAgICAgICAgICB2YXIgYXJncyA9IFtpdF07CiAgICAgICAgICAgIHZhciBpbmRleCA9IDE7CiAgICAgICAgICAgIHZhciAkcmVwbGFjZXI7CiAgICAgICAgICAgIHdoaWxlIChhcmd1bWVudHMubGVuZ3RoID4gaW5kZXgpCiAgICAgICAgICAgICAgYXJncy5wdXNoKGFyZ3VtZW50c1tpbmRleCsrXSk7CiAgICAgICAgICAgICRyZXBsYWNlciA9IHJlcGxhY2VyOwogICAgICAgICAgICBpZiAoIWlzT2JqZWN0KHJlcGxhY2VyKSAmJiBpdCA9PT0gdm9pZCAwIHx8IGlzU3ltYm9sKGl0KSkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmICghaXNBcnJheShyZXBsYWNlcikpCiAgICAgICAgICAgICAgcmVwbGFjZXIgPSBmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICAgICAgICAgICAgICBpZiAoaXNDYWxsYWJsZSgkcmVwbGFjZXIpKQogICAgICAgICAgICAgICAgICB2YWx1ZSA9ICRyZXBsYWNlci5jYWxsKHRoaXMsIGtleSwgdmFsdWUpOwogICAgICAgICAgICAgICAgaWYgKCFpc1N5bWJvbCh2YWx1ZSkpCiAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICBhcmdzWzFdID0gcmVwbGFjZXI7CiAgICAgICAgICAgIHJldHVybiAkc3RyaW5naWZ5LmFwcGx5KG51bGwsIGFyZ3MpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICAgIHZhciBGT1JDRURfSlNPTl9TVFJJTkdJRlk7CiAgICAgIGlmICghJFN5bWJvbFtQUk9UT1RZUEVdW1RPX1BSSU1JVElWRV0pIHsKICAgICAgICB2YWx1ZU9mID0gJFN5bWJvbFtQUk9UT1RZUEVdLnZhbHVlT2Y7CiAgICAgICAgcmVkZWZpbmUoJFN5bWJvbFtQUk9UT1RZUEVdLCBUT19QUklNSVRJVkUsIGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHZhbHVlT2YuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICB2YXIgdmFsdWVPZjsKICAgICAgc2V0VG9TdHJpbmdUYWcoJFN5bWJvbCwgU1lNQk9MKTsKICAgICAgaGlkZGVuS2V5c1tISURERU5dID0gdHJ1ZTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLnN5bWJvbC5hc3luYy1pdGVyYXRvci5qcwogIHZhciByZXF1aXJlX2VzX3N5bWJvbF9hc3luY19pdGVyYXRvciA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5zeW1ib2wuYXN5bmMtaXRlcmF0b3IuanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wgPSByZXF1aXJlX2RlZmluZV93ZWxsX2tub3duX3N5bWJvbCgpOwogICAgICBkZWZpbmVXZWxsS25vd25TeW1ib2woImFzeW5jSXRlcmF0b3IiKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLnN5bWJvbC5kZXNjcmlwdGlvbi5qcwogIHZhciByZXF1aXJlX2VzX3N5bWJvbF9kZXNjcmlwdGlvbiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5zeW1ib2wuZGVzY3JpcHRpb24uanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5zeW1ib2wuaGFzLWluc3RhbmNlLmpzCiAgdmFyIHJlcXVpcmVfZXNfc3ltYm9sX2hhc19pbnN0YW5jZSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5zeW1ib2wuaGFzLWluc3RhbmNlLmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sID0gcmVxdWlyZV9kZWZpbmVfd2VsbF9rbm93bl9zeW1ib2woKTsKICAgICAgZGVmaW5lV2VsbEtub3duU3ltYm9sKCJoYXNJbnN0YW5jZSIpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMuc3ltYm9sLmlzLWNvbmNhdC1zcHJlYWRhYmxlLmpzCiAgdmFyIHJlcXVpcmVfZXNfc3ltYm9sX2lzX2NvbmNhdF9zcHJlYWRhYmxlID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLnN5bWJvbC5pcy1jb25jYXQtc3ByZWFkYWJsZS5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCA9IHJlcXVpcmVfZGVmaW5lX3dlbGxfa25vd25fc3ltYm9sKCk7CiAgICAgIGRlZmluZVdlbGxLbm93blN5bWJvbCgiaXNDb25jYXRTcHJlYWRhYmxlIik7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5zeW1ib2wuaXRlcmF0b3IuanMKICB2YXIgcmVxdWlyZV9lc19zeW1ib2xfaXRlcmF0b3IgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMuc3ltYm9sLml0ZXJhdG9yLmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sID0gcmVxdWlyZV9kZWZpbmVfd2VsbF9rbm93bl9zeW1ib2woKTsKICAgICAgZGVmaW5lV2VsbEtub3duU3ltYm9sKCJpdGVyYXRvciIpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMuc3ltYm9sLm1hdGNoLmpzCiAgdmFyIHJlcXVpcmVfZXNfc3ltYm9sX21hdGNoID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLnN5bWJvbC5tYXRjaC5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCA9IHJlcXVpcmVfZGVmaW5lX3dlbGxfa25vd25fc3ltYm9sKCk7CiAgICAgIGRlZmluZVdlbGxLbm93blN5bWJvbCgibWF0Y2giKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLnN5bWJvbC5tYXRjaC1hbGwuanMKICB2YXIgcmVxdWlyZV9lc19zeW1ib2xfbWF0Y2hfYWxsID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLnN5bWJvbC5tYXRjaC1hbGwuanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wgPSByZXF1aXJlX2RlZmluZV93ZWxsX2tub3duX3N5bWJvbCgpOwogICAgICBkZWZpbmVXZWxsS25vd25TeW1ib2woIm1hdGNoQWxsIik7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5zeW1ib2wucmVwbGFjZS5qcwogIHZhciByZXF1aXJlX2VzX3N5bWJvbF9yZXBsYWNlID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLnN5bWJvbC5yZXBsYWNlLmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sID0gcmVxdWlyZV9kZWZpbmVfd2VsbF9rbm93bl9zeW1ib2woKTsKICAgICAgZGVmaW5lV2VsbEtub3duU3ltYm9sKCJyZXBsYWNlIik7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5zeW1ib2wuc2VhcmNoLmpzCiAgdmFyIHJlcXVpcmVfZXNfc3ltYm9sX3NlYXJjaCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5zeW1ib2wuc2VhcmNoLmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sID0gcmVxdWlyZV9kZWZpbmVfd2VsbF9rbm93bl9zeW1ib2woKTsKICAgICAgZGVmaW5lV2VsbEtub3duU3ltYm9sKCJzZWFyY2giKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLnN5bWJvbC5zcGVjaWVzLmpzCiAgdmFyIHJlcXVpcmVfZXNfc3ltYm9sX3NwZWNpZXMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMuc3ltYm9sLnNwZWNpZXMuanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wgPSByZXF1aXJlX2RlZmluZV93ZWxsX2tub3duX3N5bWJvbCgpOwogICAgICBkZWZpbmVXZWxsS25vd25TeW1ib2woInNwZWNpZXMiKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLnN5bWJvbC5zcGxpdC5qcwogIHZhciByZXF1aXJlX2VzX3N5bWJvbF9zcGxpdCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5zeW1ib2wuc3BsaXQuanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wgPSByZXF1aXJlX2RlZmluZV93ZWxsX2tub3duX3N5bWJvbCgpOwogICAgICBkZWZpbmVXZWxsS25vd25TeW1ib2woInNwbGl0Iik7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5zeW1ib2wudG8tcHJpbWl0aXZlLmpzCiAgdmFyIHJlcXVpcmVfZXNfc3ltYm9sX3RvX3ByaW1pdGl2ZSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5zeW1ib2wudG8tcHJpbWl0aXZlLmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sID0gcmVxdWlyZV9kZWZpbmVfd2VsbF9rbm93bl9zeW1ib2woKTsKICAgICAgZGVmaW5lV2VsbEtub3duU3ltYm9sKCJ0b1ByaW1pdGl2ZSIpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMuc3ltYm9sLnRvLXN0cmluZy10YWcuanMKICB2YXIgcmVxdWlyZV9lc19zeW1ib2xfdG9fc3RyaW5nX3RhZyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5zeW1ib2wudG8tc3RyaW5nLXRhZy5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCA9IHJlcXVpcmVfZGVmaW5lX3dlbGxfa25vd25fc3ltYm9sKCk7CiAgICAgIGRlZmluZVdlbGxLbm93blN5bWJvbCgidG9TdHJpbmdUYWciKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLnN5bWJvbC51bnNjb3BhYmxlcy5qcwogIHZhciByZXF1aXJlX2VzX3N5bWJvbF91bnNjb3BhYmxlcyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5zeW1ib2wudW5zY29wYWJsZXMuanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wgPSByZXF1aXJlX2RlZmluZV93ZWxsX2tub3duX3N5bWJvbCgpOwogICAgICBkZWZpbmVXZWxsS25vd25TeW1ib2woInVuc2NvcGFibGVzIik7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5qc29uLnRvLXN0cmluZy10YWcuanMKICB2YXIgcmVxdWlyZV9lc19qc29uX3RvX3N0cmluZ190YWcgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMuanNvbi50by1zdHJpbmctdGFnLmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgZ2xvYmFsMiA9IHJlcXVpcmVfZ2xvYmFsKCk7CiAgICAgIHZhciBzZXRUb1N0cmluZ1RhZyA9IHJlcXVpcmVfc2V0X3RvX3N0cmluZ190YWcoKTsKICAgICAgc2V0VG9TdHJpbmdUYWcoZ2xvYmFsMi5KU09OLCAiSlNPTiIsIHRydWUpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMubWF0aC50by1zdHJpbmctdGFnLmpzCiAgdmFyIHJlcXVpcmVfZXNfbWF0aF90b19zdHJpbmdfdGFnID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLm1hdGgudG8tc3RyaW5nLXRhZy5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLnJlZmxlY3QudG8tc3RyaW5nLXRhZy5qcwogIHZhciByZXF1aXJlX2VzX3JlZmxlY3RfdG9fc3RyaW5nX3RhZyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5yZWZsZWN0LnRvLXN0cmluZy10YWcuanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvc3ltYm9sL2luZGV4LmpzCiAgdmFyIHJlcXVpcmVfc3ltYm9sID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9zeW1ib2wvaW5kZXguanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHJlcXVpcmVfZXNfYXJyYXlfY29uY2F0KCk7CiAgICAgIHJlcXVpcmVfZXNfb2JqZWN0X3RvX3N0cmluZygpOwogICAgICByZXF1aXJlX2VzX3N5bWJvbCgpOwogICAgICByZXF1aXJlX2VzX3N5bWJvbF9hc3luY19pdGVyYXRvcigpOwogICAgICByZXF1aXJlX2VzX3N5bWJvbF9kZXNjcmlwdGlvbigpOwogICAgICByZXF1aXJlX2VzX3N5bWJvbF9oYXNfaW5zdGFuY2UoKTsKICAgICAgcmVxdWlyZV9lc19zeW1ib2xfaXNfY29uY2F0X3NwcmVhZGFibGUoKTsKICAgICAgcmVxdWlyZV9lc19zeW1ib2xfaXRlcmF0b3IoKTsKICAgICAgcmVxdWlyZV9lc19zeW1ib2xfbWF0Y2goKTsKICAgICAgcmVxdWlyZV9lc19zeW1ib2xfbWF0Y2hfYWxsKCk7CiAgICAgIHJlcXVpcmVfZXNfc3ltYm9sX3JlcGxhY2UoKTsKICAgICAgcmVxdWlyZV9lc19zeW1ib2xfc2VhcmNoKCk7CiAgICAgIHJlcXVpcmVfZXNfc3ltYm9sX3NwZWNpZXMoKTsKICAgICAgcmVxdWlyZV9lc19zeW1ib2xfc3BsaXQoKTsKICAgICAgcmVxdWlyZV9lc19zeW1ib2xfdG9fcHJpbWl0aXZlKCk7CiAgICAgIHJlcXVpcmVfZXNfc3ltYm9sX3RvX3N0cmluZ190YWcoKTsKICAgICAgcmVxdWlyZV9lc19zeW1ib2xfdW5zY29wYWJsZXMoKTsKICAgICAgcmVxdWlyZV9lc19qc29uX3RvX3N0cmluZ190YWcoKTsKICAgICAgcmVxdWlyZV9lc19tYXRoX3RvX3N0cmluZ190YWcoKTsKICAgICAgcmVxdWlyZV9lc19yZWZsZWN0X3RvX3N0cmluZ190YWcoKTsKICAgICAgdmFyIHBhdGggPSByZXF1aXJlX3BhdGgoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXRoLlN5bWJvbDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvc3ltYm9sL2luZGV4LmpzCiAgdmFyIHJlcXVpcmVfc3ltYm9sMiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL3N5bWJvbC9pbmRleC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHBhcmVudCA9IHJlcXVpcmVfc3ltYm9sKCk7CiAgICAgIHJlcXVpcmVfd2ViX2RvbV9jb2xsZWN0aW9uc19pdGVyYXRvcigpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhcmVudDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy1zdGFibGUvc3ltYm9sLmpzCiAgdmFyIHJlcXVpcmVfc3ltYm9sMyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMtc3RhYmxlL3N5bWJvbC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlX3N5bWJvbDIoKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvaXRlcmF0b3ItY2xvc2UuanMKICB2YXIgcmVxdWlyZV9pdGVyYXRvcl9jbG9zZSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2l0ZXJhdG9yLWNsb3NlLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgYW5PYmplY3QgPSByZXF1aXJlX2FuX29iamVjdCgpOwogICAgICB2YXIgZ2V0TWV0aG9kID0gcmVxdWlyZV9nZXRfbWV0aG9kKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXRlcmF0b3IsIGtpbmQsIHZhbHVlKSB7CiAgICAgICAgdmFyIGlubmVyUmVzdWx0LCBpbm5lckVycm9yOwogICAgICAgIGFuT2JqZWN0KGl0ZXJhdG9yKTsKICAgICAgICB0cnkgewogICAgICAgICAgaW5uZXJSZXN1bHQgPSBnZXRNZXRob2QoaXRlcmF0b3IsICJyZXR1cm4iKTsKICAgICAgICAgIGlmICghaW5uZXJSZXN1bHQpIHsKICAgICAgICAgICAgaWYgKGtpbmQgPT09ICJ0aHJvdyIpCiAgICAgICAgICAgICAgdGhyb3cgdmFsdWU7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlubmVyUmVzdWx0ID0gaW5uZXJSZXN1bHQuY2FsbChpdGVyYXRvcik7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIGlubmVyRXJyb3IgPSB0cnVlOwogICAgICAgICAgaW5uZXJSZXN1bHQgPSBlcnJvcjsKICAgICAgICB9CiAgICAgICAgaWYgKGtpbmQgPT09ICJ0aHJvdyIpCiAgICAgICAgICB0aHJvdyB2YWx1ZTsKICAgICAgICBpZiAoaW5uZXJFcnJvcikKICAgICAgICAgIHRocm93IGlubmVyUmVzdWx0OwogICAgICAgIGFuT2JqZWN0KGlubmVyUmVzdWx0KTsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2NhbGwtd2l0aC1zYWZlLWl0ZXJhdGlvbi1jbG9zaW5nLmpzCiAgdmFyIHJlcXVpcmVfY2FsbF93aXRoX3NhZmVfaXRlcmF0aW9uX2Nsb3NpbmcgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9jYWxsLXdpdGgtc2FmZS1pdGVyYXRpb24tY2xvc2luZy5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGFuT2JqZWN0ID0gcmVxdWlyZV9hbl9vYmplY3QoKTsKICAgICAgdmFyIGl0ZXJhdG9yQ2xvc2UgPSByZXF1aXJlX2l0ZXJhdG9yX2Nsb3NlKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXRlcmF0b3IsIGZuLCB2YWx1ZSwgRU5UUklFUykgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gRU5UUklFUyA/IGZuKGFuT2JqZWN0KHZhbHVlKVswXSwgdmFsdWVbMV0pIDogZm4odmFsdWUpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICBpdGVyYXRvckNsb3NlKGl0ZXJhdG9yLCAidGhyb3ciLCBlcnJvcik7CiAgICAgICAgfQogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9pcy1hcnJheS1pdGVyYXRvci1tZXRob2QuanMKICB2YXIgcmVxdWlyZV9pc19hcnJheV9pdGVyYXRvcl9tZXRob2QgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9pcy1hcnJheS1pdGVyYXRvci1tZXRob2QuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSByZXF1aXJlX3dlbGxfa25vd25fc3ltYm9sKCk7CiAgICAgIHZhciBJdGVyYXRvcnMgPSByZXF1aXJlX2l0ZXJhdG9ycygpOwogICAgICB2YXIgSVRFUkFUT1IgPSB3ZWxsS25vd25TeW1ib2woIml0ZXJhdG9yIik7CiAgICAgIHZhciBBcnJheVByb3RvdHlwZSA9IEFycmF5LnByb3RvdHlwZTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCkgewogICAgICAgIHJldHVybiBpdCAhPT0gdm9pZCAwICYmIChJdGVyYXRvcnMuQXJyYXkgPT09IGl0IHx8IEFycmF5UHJvdG90eXBlW0lURVJBVE9SXSA9PT0gaXQpOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9hcnJheS1mcm9tLmpzCiAgdmFyIHJlcXVpcmVfYXJyYXlfZnJvbSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2FycmF5LWZyb20uanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIGJpbmQgPSByZXF1aXJlX2Z1bmN0aW9uX2JpbmRfY29udGV4dCgpOwogICAgICB2YXIgdG9PYmplY3QgPSByZXF1aXJlX3RvX29iamVjdCgpOwogICAgICB2YXIgY2FsbFdpdGhTYWZlSXRlcmF0aW9uQ2xvc2luZyA9IHJlcXVpcmVfY2FsbF93aXRoX3NhZmVfaXRlcmF0aW9uX2Nsb3NpbmcoKTsKICAgICAgdmFyIGlzQXJyYXlJdGVyYXRvck1ldGhvZCA9IHJlcXVpcmVfaXNfYXJyYXlfaXRlcmF0b3JfbWV0aG9kKCk7CiAgICAgIHZhciBpc0NvbnN0cnVjdG9yID0gcmVxdWlyZV9pc19jb25zdHJ1Y3RvcigpOwogICAgICB2YXIgdG9MZW5ndGggPSByZXF1aXJlX3RvX2xlbmd0aCgpOwogICAgICB2YXIgY3JlYXRlUHJvcGVydHkgPSByZXF1aXJlX2NyZWF0ZV9wcm9wZXJ0eSgpOwogICAgICB2YXIgZ2V0SXRlcmF0b3IgPSByZXF1aXJlX2dldF9pdGVyYXRvcigpOwogICAgICB2YXIgZ2V0SXRlcmF0b3JNZXRob2QgPSByZXF1aXJlX2dldF9pdGVyYXRvcl9tZXRob2QoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBmcm9tKGFycmF5TGlrZSkgewogICAgICAgIHZhciBPID0gdG9PYmplY3QoYXJyYXlMaWtlKTsKICAgICAgICB2YXIgSVNfQ09OU1RSVUNUT1IgPSBpc0NvbnN0cnVjdG9yKHRoaXMpOwogICAgICAgIHZhciBhcmd1bWVudHNMZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICAgIHZhciBtYXBmbiA9IGFyZ3VtZW50c0xlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB2b2lkIDA7CiAgICAgICAgdmFyIG1hcHBpbmcgPSBtYXBmbiAhPT0gdm9pZCAwOwogICAgICAgIGlmIChtYXBwaW5nKQogICAgICAgICAgbWFwZm4gPSBiaW5kKG1hcGZuLCBhcmd1bWVudHNMZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdm9pZCAwLCAyKTsKICAgICAgICB2YXIgaXRlcmF0b3JNZXRob2QgPSBnZXRJdGVyYXRvck1ldGhvZChPKTsKICAgICAgICB2YXIgaW5kZXggPSAwOwogICAgICAgIHZhciBsZW5ndGgsIHJlc3VsdCwgc3RlcCwgaXRlcmF0b3IsIG5leHQsIHZhbHVlOwogICAgICAgIGlmIChpdGVyYXRvck1ldGhvZCAmJiAhKHRoaXMgPT0gQXJyYXkgJiYgaXNBcnJheUl0ZXJhdG9yTWV0aG9kKGl0ZXJhdG9yTWV0aG9kKSkpIHsKICAgICAgICAgIGl0ZXJhdG9yID0gZ2V0SXRlcmF0b3IoTywgaXRlcmF0b3JNZXRob2QpOwogICAgICAgICAgbmV4dCA9IGl0ZXJhdG9yLm5leHQ7CiAgICAgICAgICByZXN1bHQgPSBJU19DT05TVFJVQ1RPUiA/IG5ldyB0aGlzKCkgOiBbXTsKICAgICAgICAgIGZvciAoOyAhKHN0ZXAgPSBuZXh0LmNhbGwoaXRlcmF0b3IpKS5kb25lOyBpbmRleCsrKSB7CiAgICAgICAgICAgIHZhbHVlID0gbWFwcGluZyA/IGNhbGxXaXRoU2FmZUl0ZXJhdGlvbkNsb3NpbmcoaXRlcmF0b3IsIG1hcGZuLCBbc3RlcC52YWx1ZSwgaW5kZXhdLCB0cnVlKSA6IHN0ZXAudmFsdWU7CiAgICAgICAgICAgIGNyZWF0ZVByb3BlcnR5KHJlc3VsdCwgaW5kZXgsIHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgbGVuZ3RoID0gdG9MZW5ndGgoTy5sZW5ndGgpOwogICAgICAgICAgcmVzdWx0ID0gSVNfQ09OU1RSVUNUT1IgPyBuZXcgdGhpcyhsZW5ndGgpIDogQXJyYXkobGVuZ3RoKTsKICAgICAgICAgIGZvciAoOyBsZW5ndGggPiBpbmRleDsgaW5kZXgrKykgewogICAgICAgICAgICB2YWx1ZSA9IG1hcHBpbmcgPyBtYXBmbihPW2luZGV4XSwgaW5kZXgpIDogT1tpbmRleF07CiAgICAgICAgICAgIGNyZWF0ZVByb3BlcnR5KHJlc3VsdCwgaW5kZXgsIHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmVzdWx0Lmxlbmd0aCA9IGluZGV4OwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2NoZWNrLWNvcnJlY3RuZXNzLW9mLWl0ZXJhdGlvbi5qcwogIHZhciByZXF1aXJlX2NoZWNrX2NvcnJlY3RuZXNzX29mX2l0ZXJhdGlvbiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2NoZWNrLWNvcnJlY3RuZXNzLW9mLWl0ZXJhdGlvbi5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHdlbGxLbm93blN5bWJvbCA9IHJlcXVpcmVfd2VsbF9rbm93bl9zeW1ib2woKTsKICAgICAgdmFyIElURVJBVE9SID0gd2VsbEtub3duU3ltYm9sKCJpdGVyYXRvciIpOwogICAgICB2YXIgU0FGRV9DTE9TSU5HID0gZmFsc2U7CiAgICAgIHRyeSB7CiAgICAgICAgY2FsbGVkID0gMDsKICAgICAgICBpdGVyYXRvcldpdGhSZXR1cm4gPSB7CiAgICAgICAgICBuZXh0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHsgZG9uZTogISFjYWxsZWQrKyB9OwogICAgICAgICAgfSwKICAgICAgICAgICJyZXR1cm4iOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgU0FGRV9DTE9TSU5HID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGl0ZXJhdG9yV2l0aFJldHVybltJVEVSQVRPUl0gPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH07CiAgICAgICAgQXJyYXkuZnJvbShpdGVyYXRvcldpdGhSZXR1cm4sIGZ1bmN0aW9uKCkgewogICAgICAgICAgdGhyb3cgMjsKICAgICAgICB9KTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgfQogICAgICB2YXIgY2FsbGVkOwogICAgICB2YXIgaXRlcmF0b3JXaXRoUmV0dXJuOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGV4ZWMsIFNLSVBfQ0xPU0lORykgewogICAgICAgIGlmICghU0tJUF9DTE9TSU5HICYmICFTQUZFX0NMT1NJTkcpCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgdmFyIElURVJBVElPTl9TVVBQT1JUID0gZmFsc2U7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZhciBvYmplY3QgPSB7fTsKICAgICAgICAgIG9iamVjdFtJVEVSQVRPUl0gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBuZXh0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7IGRvbmU6IElURVJBVElPTl9TVVBQT1JUID0gdHJ1ZSB9OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgIH07CiAgICAgICAgICBleGVjKG9iamVjdCk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIElURVJBVElPTl9TVVBQT1JUOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMuYXJyYXkuZnJvbS5qcwogIHZhciByZXF1aXJlX2VzX2FycmF5X2Zyb20gPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMuYXJyYXkuZnJvbS5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyICQgPSByZXF1aXJlX2V4cG9ydCgpOwogICAgICB2YXIgZnJvbSA9IHJlcXVpcmVfYXJyYXlfZnJvbSgpOwogICAgICB2YXIgY2hlY2tDb3JyZWN0bmVzc09mSXRlcmF0aW9uID0gcmVxdWlyZV9jaGVja19jb3JyZWN0bmVzc19vZl9pdGVyYXRpb24oKTsKICAgICAgdmFyIElOQ09SUkVDVF9JVEVSQVRJT04gPSAhY2hlY2tDb3JyZWN0bmVzc09mSXRlcmF0aW9uKGZ1bmN0aW9uKGl0ZXJhYmxlKSB7CiAgICAgICAgQXJyYXkuZnJvbShpdGVyYWJsZSk7CiAgICAgIH0pOwogICAgICAkKHsgdGFyZ2V0OiAiQXJyYXkiLCBzdGF0OiB0cnVlLCBmb3JjZWQ6IElOQ09SUkVDVF9JVEVSQVRJT04gfSwgewogICAgICAgIGZyb20KICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvYXJyYXkvZnJvbS5qcwogIHZhciByZXF1aXJlX2Zyb20gPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL2FycmF5L2Zyb20uanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHJlcXVpcmVfZXNfc3RyaW5nX2l0ZXJhdG9yKCk7CiAgICAgIHJlcXVpcmVfZXNfYXJyYXlfZnJvbSgpOwogICAgICB2YXIgcGF0aCA9IHJlcXVpcmVfcGF0aCgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhdGguQXJyYXkuZnJvbTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvYXJyYXkvZnJvbS5qcwogIHZhciByZXF1aXJlX2Zyb20yID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvYXJyYXkvZnJvbS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHBhcmVudCA9IHJlcXVpcmVfZnJvbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhcmVudDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy1zdGFibGUvYXJyYXkvZnJvbS5qcwogIHZhciByZXF1aXJlX2Zyb20zID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy1zdGFibGUvYXJyYXkvZnJvbS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlX2Zyb20yKCk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5vYmplY3QuZGVmaW5lLXByb3BlcnRpZXMuanMKICB2YXIgcmVxdWlyZV9lc19vYmplY3RfZGVmaW5lX3Byb3BlcnRpZXMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMub2JqZWN0LmRlZmluZS1wcm9wZXJ0aWVzLmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgJCA9IHJlcXVpcmVfZXhwb3J0KCk7CiAgICAgIHZhciBERVNDUklQVE9SUyA9IHJlcXVpcmVfZGVzY3JpcHRvcnMoKTsKICAgICAgdmFyIGRlZmluZVByb3BlcnRpZXMgPSByZXF1aXJlX29iamVjdF9kZWZpbmVfcHJvcGVydGllcygpOwogICAgICAkKHsgdGFyZ2V0OiAiT2JqZWN0Iiwgc3RhdDogdHJ1ZSwgZm9yY2VkOiAhREVTQ1JJUFRPUlMsIHNoYW06ICFERVNDUklQVE9SUyB9LCB7CiAgICAgICAgZGVmaW5lUHJvcGVydGllcwogICAgICB9KTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9vYmplY3QvZGVmaW5lLXByb3BlcnRpZXMuanMKICB2YXIgcmVxdWlyZV9kZWZpbmVfcHJvcGVydGllcyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvb2JqZWN0L2RlZmluZS1wcm9wZXJ0aWVzLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICByZXF1aXJlX2VzX29iamVjdF9kZWZpbmVfcHJvcGVydGllcygpOwogICAgICB2YXIgcGF0aCA9IHJlcXVpcmVfcGF0aCgpOwogICAgICB2YXIgT2JqZWN0MiA9IHBhdGguT2JqZWN0OwogICAgICB2YXIgZGVmaW5lUHJvcGVydGllcyA9IG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllczIoVCwgRCkgewogICAgICAgIHJldHVybiBPYmplY3QyLmRlZmluZVByb3BlcnRpZXMoVCwgRCk7CiAgICAgIH07CiAgICAgIGlmIChPYmplY3QyLmRlZmluZVByb3BlcnRpZXMuc2hhbSkKICAgICAgICBkZWZpbmVQcm9wZXJ0aWVzLnNoYW0gPSB0cnVlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9vYmplY3QvZGVmaW5lLXByb3BlcnRpZXMuanMKICB2YXIgcmVxdWlyZV9kZWZpbmVfcHJvcGVydGllczIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9vYmplY3QvZGVmaW5lLXByb3BlcnRpZXMuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX2RlZmluZV9wcm9wZXJ0aWVzKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGFyZW50OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzLXN0YWJsZS9vYmplY3QvZGVmaW5lLXByb3BlcnRpZXMuanMKICB2YXIgcmVxdWlyZV9kZWZpbmVfcHJvcGVydGllczMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzLXN0YWJsZS9vYmplY3QvZGVmaW5lLXByb3BlcnRpZXMuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZV9kZWZpbmVfcHJvcGVydGllczIoKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvb3duLWtleXMuanMKICB2YXIgcmVxdWlyZV9vd25fa2V5cyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL293bi1rZXlzLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgZ2V0QnVpbHRJbiA9IHJlcXVpcmVfZ2V0X2J1aWx0X2luKCk7CiAgICAgIHZhciBnZXRPd25Qcm9wZXJ0eU5hbWVzTW9kdWxlID0gcmVxdWlyZV9vYmplY3RfZ2V0X293bl9wcm9wZXJ0eV9uYW1lcygpOwogICAgICB2YXIgZ2V0T3duUHJvcGVydHlTeW1ib2xzTW9kdWxlID0gcmVxdWlyZV9vYmplY3RfZ2V0X293bl9wcm9wZXJ0eV9zeW1ib2xzKCk7CiAgICAgIHZhciBhbk9iamVjdCA9IHJlcXVpcmVfYW5fb2JqZWN0KCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZ2V0QnVpbHRJbigiUmVmbGVjdCIsICJvd25LZXlzIikgfHwgZnVuY3Rpb24gb3duS2V5cyhpdCkgewogICAgICAgIHZhciBrZXlzID0gZ2V0T3duUHJvcGVydHlOYW1lc01vZHVsZS5mKGFuT2JqZWN0KGl0KSk7CiAgICAgICAgdmFyIGdldE93blByb3BlcnR5U3ltYm9scyA9IGdldE93blByb3BlcnR5U3ltYm9sc01vZHVsZS5mOwogICAgICAgIHJldHVybiBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPyBrZXlzLmNvbmNhdChnZXRPd25Qcm9wZXJ0eVN5bWJvbHMoaXQpKSA6IGtleXM7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9ycy5qcwogIHZhciByZXF1aXJlX2VzX29iamVjdF9nZXRfb3duX3Byb3BlcnR5X2Rlc2NyaXB0b3JzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLm9iamVjdC5nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3JzLmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgJCA9IHJlcXVpcmVfZXhwb3J0KCk7CiAgICAgIHZhciBERVNDUklQVE9SUyA9IHJlcXVpcmVfZGVzY3JpcHRvcnMoKTsKICAgICAgdmFyIG93bktleXMgPSByZXF1aXJlX293bl9rZXlzKCk7CiAgICAgIHZhciB0b0luZGV4ZWRPYmplY3QgPSByZXF1aXJlX3RvX2luZGV4ZWRfb2JqZWN0KCk7CiAgICAgIHZhciBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JNb2R1bGUgPSByZXF1aXJlX29iamVjdF9nZXRfb3duX3Byb3BlcnR5X2Rlc2NyaXB0b3IoKTsKICAgICAgdmFyIGNyZWF0ZVByb3BlcnR5ID0gcmVxdWlyZV9jcmVhdGVfcHJvcGVydHkoKTsKICAgICAgJCh7IHRhcmdldDogIk9iamVjdCIsIHN0YXQ6IHRydWUsIHNoYW06ICFERVNDUklQVE9SUyB9LCB7CiAgICAgICAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczogZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhvYmplY3QpIHsKICAgICAgICAgIHZhciBPID0gdG9JbmRleGVkT2JqZWN0KG9iamVjdCk7CiAgICAgICAgICB2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yTW9kdWxlLmY7CiAgICAgICAgICB2YXIga2V5cyA9IG93bktleXMoTyk7CiAgICAgICAgICB2YXIgcmVzdWx0ID0ge307CiAgICAgICAgICB2YXIgaW5kZXggPSAwOwogICAgICAgICAgdmFyIGtleSwgZGVzY3JpcHRvcjsKICAgICAgICAgIHdoaWxlIChrZXlzLmxlbmd0aCA+IGluZGV4KSB7CiAgICAgICAgICAgIGRlc2NyaXB0b3IgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTywga2V5ID0ga2V5c1tpbmRleCsrXSk7CiAgICAgICAgICAgIGlmIChkZXNjcmlwdG9yICE9PSB2b2lkIDApCiAgICAgICAgICAgICAgY3JlYXRlUHJvcGVydHkocmVzdWx0LCBrZXksIGRlc2NyaXB0b3IpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL29iamVjdC9nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3JzLmpzCiAgdmFyIHJlcXVpcmVfZ2V0X293bl9wcm9wZXJ0eV9kZXNjcmlwdG9ycyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvb2JqZWN0L2dldC1vd24tcHJvcGVydHktZGVzY3JpcHRvcnMuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHJlcXVpcmVfZXNfb2JqZWN0X2dldF9vd25fcHJvcGVydHlfZGVzY3JpcHRvcnMoKTsKICAgICAgdmFyIHBhdGggPSByZXF1aXJlX3BhdGgoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXRoLk9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9ycy5qcwogIHZhciByZXF1aXJlX2dldF9vd25fcHJvcGVydHlfZGVzY3JpcHRvcnMyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvb2JqZWN0L2dldC1vd24tcHJvcGVydHktZGVzY3JpcHRvcnMuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX2dldF9vd25fcHJvcGVydHlfZGVzY3JpcHRvcnMoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXJlbnQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMtc3RhYmxlL29iamVjdC9nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3JzLmpzCiAgdmFyIHJlcXVpcmVfZ2V0X293bl9wcm9wZXJ0eV9kZXNjcmlwdG9yczMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzLXN0YWJsZS9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9ycy5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlX2dldF9vd25fcHJvcGVydHlfZGVzY3JpcHRvcnMyKCk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2FycmF5LW1ldGhvZC1pcy1zdHJpY3QuanMKICB2YXIgcmVxdWlyZV9hcnJheV9tZXRob2RfaXNfc3RyaWN0ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvYXJyYXktbWV0aG9kLWlzLXN0cmljdC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgZmFpbHMgPSByZXF1aXJlX2ZhaWxzKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oTUVUSE9EX05BTUUsIGFyZ3VtZW50KSB7CiAgICAgICAgdmFyIG1ldGhvZCA9IFtdW01FVEhPRF9OQU1FXTsKICAgICAgICByZXR1cm4gISFtZXRob2QgJiYgZmFpbHMoZnVuY3Rpb24oKSB7CiAgICAgICAgICBtZXRob2QuY2FsbChudWxsLCBhcmd1bWVudCB8fCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdGhyb3cgMTsKICAgICAgICAgIH0sIDEpOwogICAgICAgIH0pOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9hcnJheS1mb3ItZWFjaC5qcwogIHZhciByZXF1aXJlX2FycmF5X2Zvcl9lYWNoID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvYXJyYXktZm9yLWVhY2guanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyICRmb3JFYWNoID0gcmVxdWlyZV9hcnJheV9pdGVyYXRpb24oKS5mb3JFYWNoOwogICAgICB2YXIgYXJyYXlNZXRob2RJc1N0cmljdCA9IHJlcXVpcmVfYXJyYXlfbWV0aG9kX2lzX3N0cmljdCgpOwogICAgICB2YXIgU1RSSUNUX01FVEhPRCA9IGFycmF5TWV0aG9kSXNTdHJpY3QoImZvckVhY2giKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSAhU1RSSUNUX01FVEhPRCA/IGZ1bmN0aW9uIGZvckVhY2goY2FsbGJhY2tmbikgewogICAgICAgIHJldHVybiAkZm9yRWFjaCh0aGlzLCBjYWxsYmFja2ZuLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHZvaWQgMCk7CiAgICAgIH0gOiBbXS5mb3JFYWNoOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2guanMKICB2YXIgcmVxdWlyZV9lc19hcnJheV9mb3JfZWFjaCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaC5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgJCA9IHJlcXVpcmVfZXhwb3J0KCk7CiAgICAgIHZhciBmb3JFYWNoID0gcmVxdWlyZV9hcnJheV9mb3JfZWFjaCgpOwogICAgICAkKHsgdGFyZ2V0OiAiQXJyYXkiLCBwcm90bzogdHJ1ZSwgZm9yY2VkOiBbXS5mb3JFYWNoICE9IGZvckVhY2ggfSwgewogICAgICAgIGZvckVhY2gKICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2VudHJ5LXZpcnR1YWwuanMKICB2YXIgcmVxdWlyZV9lbnRyeV92aXJ0dWFsID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZW50cnktdmlydHVhbC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHBhdGggPSByZXF1aXJlX3BhdGgoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihDT05TVFJVQ1RPUikgewogICAgICAgIHJldHVybiBwYXRoW0NPTlNUUlVDVE9SICsgIlByb3RvdHlwZSJdOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL2FycmF5L3ZpcnR1YWwvZm9yLWVhY2guanMKICB2YXIgcmVxdWlyZV9mb3JfZWFjaCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvYXJyYXkvdmlydHVhbC9mb3ItZWFjaC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgcmVxdWlyZV9lc19hcnJheV9mb3JfZWFjaCgpOwogICAgICB2YXIgZW50cnlWaXJ0dWFsID0gcmVxdWlyZV9lbnRyeV92aXJ0dWFsKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZW50cnlWaXJ0dWFsKCJBcnJheSIpLmZvckVhY2g7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL2FycmF5L3ZpcnR1YWwvZm9yLWVhY2guanMKICB2YXIgcmVxdWlyZV9mb3JfZWFjaDIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9hcnJheS92aXJ0dWFsL2Zvci1lYWNoLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgcGFyZW50ID0gcmVxdWlyZV9mb3JfZWFjaCgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhcmVudDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvaW5zdGFuY2UvZm9yLWVhY2guanMKICB2YXIgcmVxdWlyZV9mb3JfZWFjaDMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9pbnN0YW5jZS9mb3ItZWFjaC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgcmVxdWlyZV93ZWJfZG9tX2NvbGxlY3Rpb25zX2l0ZXJhdG9yKCk7CiAgICAgIHZhciBmb3JFYWNoID0gcmVxdWlyZV9mb3JfZWFjaDIoKTsKICAgICAgdmFyIGNsYXNzb2YgPSByZXF1aXJlX2NsYXNzb2YoKTsKICAgICAgdmFyIEFycmF5UHJvdG90eXBlID0gQXJyYXkucHJvdG90eXBlOwogICAgICB2YXIgRE9NSXRlcmFibGVzID0gewogICAgICAgIERPTVRva2VuTGlzdDogdHJ1ZSwKICAgICAgICBOb2RlTGlzdDogdHJ1ZQogICAgICB9OwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KSB7CiAgICAgICAgdmFyIG93biA9IGl0LmZvckVhY2g7CiAgICAgICAgcmV0dXJuIGl0ID09PSBBcnJheVByb3RvdHlwZSB8fCBpdCBpbnN0YW5jZW9mIEFycmF5ICYmIG93biA9PT0gQXJyYXlQcm90b3R5cGUuZm9yRWFjaCB8fCBET01JdGVyYWJsZXMuaGFzT3duUHJvcGVydHkoY2xhc3NvZihpdCkpID8gZm9yRWFjaCA6IG93bjsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy1zdGFibGUvaW5zdGFuY2UvZm9yLWVhY2guanMKICB2YXIgcmVxdWlyZV9mb3JfZWFjaDQgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzLXN0YWJsZS9pbnN0YW5jZS9mb3ItZWFjaC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlX2Zvcl9lYWNoMygpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvci5qcwogIHZhciByZXF1aXJlX2VzX29iamVjdF9nZXRfb3duX3Byb3BlcnR5X2Rlc2NyaXB0b3IgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvci5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyICQgPSByZXF1aXJlX2V4cG9ydCgpOwogICAgICB2YXIgZmFpbHMgPSByZXF1aXJlX2ZhaWxzKCk7CiAgICAgIHZhciB0b0luZGV4ZWRPYmplY3QgPSByZXF1aXJlX3RvX2luZGV4ZWRfb2JqZWN0KCk7CiAgICAgIHZhciBuYXRpdmVHZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSByZXF1aXJlX29iamVjdF9nZXRfb3duX3Byb3BlcnR5X2Rlc2NyaXB0b3IoKS5mOwogICAgICB2YXIgREVTQ1JJUFRPUlMgPSByZXF1aXJlX2Rlc2NyaXB0b3JzKCk7CiAgICAgIHZhciBGQUlMU19PTl9QUklNSVRJVkVTID0gZmFpbHMoZnVuY3Rpb24oKSB7CiAgICAgICAgbmF0aXZlR2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKDEpOwogICAgICB9KTsKICAgICAgdmFyIEZPUkNFRCA9ICFERVNDUklQVE9SUyB8fCBGQUlMU19PTl9QUklNSVRJVkVTOwogICAgICAkKHsgdGFyZ2V0OiAiT2JqZWN0Iiwgc3RhdDogdHJ1ZSwgZm9yY2VkOiBGT1JDRUQsIHNoYW06ICFERVNDUklQVE9SUyB9LCB7CiAgICAgICAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoaXQsIGtleSkgewogICAgICAgICAgcmV0dXJuIG5hdGl2ZUdldE93blByb3BlcnR5RGVzY3JpcHRvcih0b0luZGV4ZWRPYmplY3QoaXQpLCBrZXkpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvb2JqZWN0L2dldC1vd24tcHJvcGVydHktZGVzY3JpcHRvci5qcwogIHZhciByZXF1aXJlX2dldF9vd25fcHJvcGVydHlfZGVzY3JpcHRvciA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvb2JqZWN0L2dldC1vd24tcHJvcGVydHktZGVzY3JpcHRvci5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgcmVxdWlyZV9lc19vYmplY3RfZ2V0X293bl9wcm9wZXJ0eV9kZXNjcmlwdG9yKCk7CiAgICAgIHZhciBwYXRoID0gcmVxdWlyZV9wYXRoKCk7CiAgICAgIHZhciBPYmplY3QyID0gcGF0aC5PYmplY3Q7CiAgICAgIHZhciBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGdldE93blByb3BlcnR5RGVzY3JpcHRvcjIoaXQsIGtleSkgewogICAgICAgIHJldHVybiBPYmplY3QyLmdldE93blByb3BlcnR5RGVzY3JpcHRvcihpdCwga2V5KTsKICAgICAgfTsKICAgICAgaWYgKE9iamVjdDIuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLnNoYW0pCiAgICAgICAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLnNoYW0gPSB0cnVlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yLmpzCiAgdmFyIHJlcXVpcmVfZ2V0X293bl9wcm9wZXJ0eV9kZXNjcmlwdG9yMiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL29iamVjdC9nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX2dldF9vd25fcHJvcGVydHlfZGVzY3JpcHRvcigpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhcmVudDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy1zdGFibGUvb2JqZWN0L2dldC1vd24tcHJvcGVydHktZGVzY3JpcHRvci5qcwogIHZhciByZXF1aXJlX2dldF9vd25fcHJvcGVydHlfZGVzY3JpcHRvcjMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzLXN0YWJsZS9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmVfZ2V0X293bl9wcm9wZXJ0eV9kZXNjcmlwdG9yMigpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyLmpzCiAgdmFyIHJlcXVpcmVfZXNfYXJyYXlfZmlsdGVyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLmFycmF5LmZpbHRlci5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgJCA9IHJlcXVpcmVfZXhwb3J0KCk7CiAgICAgIHZhciAkZmlsdGVyID0gcmVxdWlyZV9hcnJheV9pdGVyYXRpb24oKS5maWx0ZXI7CiAgICAgIHZhciBhcnJheU1ldGhvZEhhc1NwZWNpZXNTdXBwb3J0ID0gcmVxdWlyZV9hcnJheV9tZXRob2RfaGFzX3NwZWNpZXNfc3VwcG9ydCgpOwogICAgICB2YXIgSEFTX1NQRUNJRVNfU1VQUE9SVCA9IGFycmF5TWV0aG9kSGFzU3BlY2llc1N1cHBvcnQoImZpbHRlciIpOwogICAgICAkKHsgdGFyZ2V0OiAiQXJyYXkiLCBwcm90bzogdHJ1ZSwgZm9yY2VkOiAhSEFTX1NQRUNJRVNfU1VQUE9SVCB9LCB7CiAgICAgICAgZmlsdGVyOiBmdW5jdGlvbiBmaWx0ZXIoY2FsbGJhY2tmbikgewogICAgICAgICAgcmV0dXJuICRmaWx0ZXIodGhpcywgY2FsbGJhY2tmbiwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB2b2lkIDApOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvYXJyYXkvdmlydHVhbC9maWx0ZXIuanMKICB2YXIgcmVxdWlyZV9maWx0ZXIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL2FycmF5L3ZpcnR1YWwvZmlsdGVyLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICByZXF1aXJlX2VzX2FycmF5X2ZpbHRlcigpOwogICAgICB2YXIgZW50cnlWaXJ0dWFsID0gcmVxdWlyZV9lbnRyeV92aXJ0dWFsKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZW50cnlWaXJ0dWFsKCJBcnJheSIpLmZpbHRlcjsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9pbnN0YW5jZS9maWx0ZXIuanMKICB2YXIgcmVxdWlyZV9maWx0ZXIyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9pbnN0YW5jZS9maWx0ZXIuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBmaWx0ZXIgPSByZXF1aXJlX2ZpbHRlcigpOwogICAgICB2YXIgQXJyYXlQcm90b3R5cGUgPSBBcnJheS5wcm90b3R5cGU7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpIHsKICAgICAgICB2YXIgb3duID0gaXQuZmlsdGVyOwogICAgICAgIHJldHVybiBpdCA9PT0gQXJyYXlQcm90b3R5cGUgfHwgaXQgaW5zdGFuY2VvZiBBcnJheSAmJiBvd24gPT09IEFycmF5UHJvdG90eXBlLmZpbHRlciA/IGZpbHRlciA6IG93bjsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvaW5zdGFuY2UvZmlsdGVyLmpzCiAgdmFyIHJlcXVpcmVfZmlsdGVyMyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL2luc3RhbmNlL2ZpbHRlci5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHBhcmVudCA9IHJlcXVpcmVfZmlsdGVyMigpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhcmVudDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy1zdGFibGUvaW5zdGFuY2UvZmlsdGVyLmpzCiAgdmFyIHJlcXVpcmVfZmlsdGVyNCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMtc3RhYmxlL2luc3RhbmNlL2ZpbHRlci5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlX2ZpbHRlcjMoKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1zeW1ib2xzLmpzCiAgdmFyIHJlcXVpcmVfZ2V0X293bl9wcm9wZXJ0eV9zeW1ib2xzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1zeW1ib2xzLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICByZXF1aXJlX2VzX3N5bWJvbCgpOwogICAgICB2YXIgcGF0aCA9IHJlcXVpcmVfcGF0aCgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhdGguT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9sczsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvb2JqZWN0L2dldC1vd24tcHJvcGVydHktc3ltYm9scy5qcwogIHZhciByZXF1aXJlX2dldF9vd25fcHJvcGVydHlfc3ltYm9sczIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1zeW1ib2xzLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgcGFyZW50ID0gcmVxdWlyZV9nZXRfb3duX3Byb3BlcnR5X3N5bWJvbHMoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXJlbnQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMtc3RhYmxlL29iamVjdC9nZXQtb3duLXByb3BlcnR5LXN5bWJvbHMuanMKICB2YXIgcmVxdWlyZV9nZXRfb3duX3Byb3BlcnR5X3N5bWJvbHMzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy1zdGFibGUvb2JqZWN0L2dldC1vd24tcHJvcGVydHktc3ltYm9scy5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlX2dldF9vd25fcHJvcGVydHlfc3ltYm9sczIoKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLm9iamVjdC5rZXlzLmpzCiAgdmFyIHJlcXVpcmVfZXNfb2JqZWN0X2tleXMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMub2JqZWN0LmtleXMuanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciAkID0gcmVxdWlyZV9leHBvcnQoKTsKICAgICAgdmFyIHRvT2JqZWN0ID0gcmVxdWlyZV90b19vYmplY3QoKTsKICAgICAgdmFyIG5hdGl2ZUtleXMgPSByZXF1aXJlX29iamVjdF9rZXlzKCk7CiAgICAgIHZhciBmYWlscyA9IHJlcXVpcmVfZmFpbHMoKTsKICAgICAgdmFyIEZBSUxTX09OX1BSSU1JVElWRVMgPSBmYWlscyhmdW5jdGlvbigpIHsKICAgICAgICBuYXRpdmVLZXlzKDEpOwogICAgICB9KTsKICAgICAgJCh7IHRhcmdldDogIk9iamVjdCIsIHN0YXQ6IHRydWUsIGZvcmNlZDogRkFJTFNfT05fUFJJTUlUSVZFUyB9LCB7CiAgICAgICAga2V5czogZnVuY3Rpb24ga2V5cyhpdCkgewogICAgICAgICAgcmV0dXJuIG5hdGl2ZUtleXModG9PYmplY3QoaXQpKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL29iamVjdC9rZXlzLmpzCiAgdmFyIHJlcXVpcmVfa2V5cyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvb2JqZWN0L2tleXMuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHJlcXVpcmVfZXNfb2JqZWN0X2tleXMoKTsKICAgICAgdmFyIHBhdGggPSByZXF1aXJlX3BhdGgoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXRoLk9iamVjdC5rZXlzOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9vYmplY3Qva2V5cy5qcwogIHZhciByZXF1aXJlX2tleXMyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvb2JqZWN0L2tleXMuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX2tleXMoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXJlbnQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMtc3RhYmxlL29iamVjdC9rZXlzLmpzCiAgdmFyIHJlcXVpcmVfa2V5czMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzLXN0YWJsZS9vYmplY3Qva2V5cy5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlX2tleXMyKCk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2EtY29uc3RydWN0b3IuanMKICB2YXIgcmVxdWlyZV9hX2NvbnN0cnVjdG9yID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvYS1jb25zdHJ1Y3Rvci5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGlzQ29uc3RydWN0b3IgPSByZXF1aXJlX2lzX2NvbnN0cnVjdG9yKCk7CiAgICAgIHZhciB0cnlUb1N0cmluZyA9IHJlcXVpcmVfdHJ5X3RvX3N0cmluZygpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGFyZ3VtZW50KSB7CiAgICAgICAgaWYgKGlzQ29uc3RydWN0b3IoYXJndW1lbnQpKQogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50OwogICAgICAgIHRocm93IFR5cGVFcnJvcih0cnlUb1N0cmluZyhhcmd1bWVudCkgKyAiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIik7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2Z1bmN0aW9uLWJpbmQuanMKICB2YXIgcmVxdWlyZV9mdW5jdGlvbl9iaW5kID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZnVuY3Rpb24tYmluZC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgYUNhbGxhYmxlID0gcmVxdWlyZV9hX2NhbGxhYmxlKCk7CiAgICAgIHZhciBpc09iamVjdCA9IHJlcXVpcmVfaXNfb2JqZWN0KCk7CiAgICAgIHZhciBzbGljZSA9IFtdLnNsaWNlOwogICAgICB2YXIgZmFjdG9yaWVzID0ge307CiAgICAgIHZhciBjb25zdHJ1Y3QgPSBmdW5jdGlvbihDLCBhcmdzTGVuZ3RoLCBhcmdzKSB7CiAgICAgICAgaWYgKCEoYXJnc0xlbmd0aCBpbiBmYWN0b3JpZXMpKSB7CiAgICAgICAgICBmb3IgKHZhciBsaXN0ID0gW10sIGkgPSAwOyBpIDwgYXJnc0xlbmd0aDsgaSsrKQogICAgICAgICAgICBsaXN0W2ldID0gImFbIiArIGkgKyAiXSI7CiAgICAgICAgICBmYWN0b3JpZXNbYXJnc0xlbmd0aF0gPSBGdW5jdGlvbigiQyxhIiwgInJldHVybiBuZXcgQygiICsgbGlzdC5qb2luKCIsIikgKyAiKSIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFjdG9yaWVzW2FyZ3NMZW5ndGhdKEMsIGFyZ3MpOwogICAgICB9OwogICAgICBtb2R1bGUuZXhwb3J0cyA9IEZ1bmN0aW9uLmJpbmQgfHwgZnVuY3Rpb24gYmluZCh0aGF0KSB7CiAgICAgICAgdmFyIGZuID0gYUNhbGxhYmxlKHRoaXMpOwogICAgICAgIHZhciBwYXJ0QXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgICAgICB2YXIgYm91bmRGdW5jdGlvbiA9IGZ1bmN0aW9uIGJvdW5kKCkgewogICAgICAgICAgdmFyIGFyZ3MgPSBwYXJ0QXJncy5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMpKTsKICAgICAgICAgIHJldHVybiB0aGlzIGluc3RhbmNlb2YgYm91bmRGdW5jdGlvbiA/IGNvbnN0cnVjdChmbiwgYXJncy5sZW5ndGgsIGFyZ3MpIDogZm4uYXBwbHkodGhhdCwgYXJncyk7CiAgICAgICAgfTsKICAgICAgICBpZiAoaXNPYmplY3QoZm4ucHJvdG90eXBlKSkKICAgICAgICAgIGJvdW5kRnVuY3Rpb24ucHJvdG90eXBlID0gZm4ucHJvdG90eXBlOwogICAgICAgIHJldHVybiBib3VuZEZ1bmN0aW9uOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMucmVmbGVjdC5jb25zdHJ1Y3QuanMKICB2YXIgcmVxdWlyZV9lc19yZWZsZWN0X2NvbnN0cnVjdCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5yZWZsZWN0LmNvbnN0cnVjdC5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyICQgPSByZXF1aXJlX2V4cG9ydCgpOwogICAgICB2YXIgZ2V0QnVpbHRJbiA9IHJlcXVpcmVfZ2V0X2J1aWx0X2luKCk7CiAgICAgIHZhciBhQ29uc3RydWN0b3IgPSByZXF1aXJlX2FfY29uc3RydWN0b3IoKTsKICAgICAgdmFyIGFuT2JqZWN0ID0gcmVxdWlyZV9hbl9vYmplY3QoKTsKICAgICAgdmFyIGlzT2JqZWN0ID0gcmVxdWlyZV9pc19vYmplY3QoKTsKICAgICAgdmFyIGNyZWF0ZSA9IHJlcXVpcmVfb2JqZWN0X2NyZWF0ZSgpOwogICAgICB2YXIgYmluZCA9IHJlcXVpcmVfZnVuY3Rpb25fYmluZCgpOwogICAgICB2YXIgZmFpbHMgPSByZXF1aXJlX2ZhaWxzKCk7CiAgICAgIHZhciBuYXRpdmVDb25zdHJ1Y3QgPSBnZXRCdWlsdEluKCJSZWZsZWN0IiwgImNvbnN0cnVjdCIpOwogICAgICB2YXIgTkVXX1RBUkdFVF9CVUcgPSBmYWlscyhmdW5jdGlvbigpIHsKICAgICAgICBmdW5jdGlvbiBGKCkgewogICAgICAgIH0KICAgICAgICByZXR1cm4gIShuYXRpdmVDb25zdHJ1Y3QoZnVuY3Rpb24oKSB7CiAgICAgICAgfSwgW10sIEYpIGluc3RhbmNlb2YgRik7CiAgICAgIH0pOwogICAgICB2YXIgQVJHU19CVUcgPSAhZmFpbHMoZnVuY3Rpb24oKSB7CiAgICAgICAgbmF0aXZlQ29uc3RydWN0KGZ1bmN0aW9uKCkgewogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgdmFyIEZPUkNFRCA9IE5FV19UQVJHRVRfQlVHIHx8IEFSR1NfQlVHOwogICAgICAkKHsgdGFyZ2V0OiAiUmVmbGVjdCIsIHN0YXQ6IHRydWUsIGZvcmNlZDogRk9SQ0VELCBzaGFtOiBGT1JDRUQgfSwgewogICAgICAgIGNvbnN0cnVjdDogZnVuY3Rpb24gY29uc3RydWN0KFRhcmdldCwgYXJncykgewogICAgICAgICAgYUNvbnN0cnVjdG9yKFRhcmdldCk7CiAgICAgICAgICBhbk9iamVjdChhcmdzKTsKICAgICAgICAgIHZhciBuZXdUYXJnZXQgPSBhcmd1bWVudHMubGVuZ3RoIDwgMyA/IFRhcmdldCA6IGFDb25zdHJ1Y3Rvcihhcmd1bWVudHNbMl0pOwogICAgICAgICAgaWYgKEFSR1NfQlVHICYmICFORVdfVEFSR0VUX0JVRykKICAgICAgICAgICAgcmV0dXJuIG5hdGl2ZUNvbnN0cnVjdChUYXJnZXQsIGFyZ3MsIG5ld1RhcmdldCk7CiAgICAgICAgICBpZiAoVGFyZ2V0ID09IG5ld1RhcmdldCkgewogICAgICAgICAgICBzd2l0Y2ggKGFyZ3MubGVuZ3RoKSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBUYXJnZXQoKTsKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFRhcmdldChhcmdzWzBdKTsKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFRhcmdldChhcmdzWzBdLCBhcmdzWzFdKTsKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFRhcmdldChhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKTsKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFRhcmdldChhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdLCBhcmdzWzNdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgJGFyZ3MgPSBbbnVsbF07CiAgICAgICAgICAgICRhcmdzLnB1c2guYXBwbHkoJGFyZ3MsIGFyZ3MpOwogICAgICAgICAgICByZXR1cm4gbmV3IChiaW5kLmFwcGx5KFRhcmdldCwgJGFyZ3MpKSgpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHByb3RvMiA9IG5ld1RhcmdldC5wcm90b3R5cGU7CiAgICAgICAgICB2YXIgaW5zdGFuY2UgPSBjcmVhdGUoaXNPYmplY3QocHJvdG8yKSA/IHByb3RvMiA6IE9iamVjdC5wcm90b3R5cGUpOwogICAgICAgICAgdmFyIHJlc3VsdCA9IEZ1bmN0aW9uLmFwcGx5LmNhbGwoVGFyZ2V0LCBpbnN0YW5jZSwgYXJncyk7CiAgICAgICAgICByZXR1cm4gaXNPYmplY3QocmVzdWx0KSA/IHJlc3VsdCA6IGluc3RhbmNlOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvcmVmbGVjdC9jb25zdHJ1Y3QuanMKICB2YXIgcmVxdWlyZV9jb25zdHJ1Y3QgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL3JlZmxlY3QvY29uc3RydWN0LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICByZXF1aXJlX2VzX3JlZmxlY3RfY29uc3RydWN0KCk7CiAgICAgIHZhciBwYXRoID0gcmVxdWlyZV9wYXRoKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGF0aC5SZWZsZWN0LmNvbnN0cnVjdDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvcmVmbGVjdC9jb25zdHJ1Y3QuanMKICB2YXIgcmVxdWlyZV9jb25zdHJ1Y3QyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvcmVmbGVjdC9jb25zdHJ1Y3QuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX2NvbnN0cnVjdCgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhcmVudDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy1zdGFibGUvcmVmbGVjdC9jb25zdHJ1Y3QuanMKICB2YXIgcmVxdWlyZV9jb25zdHJ1Y3QzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy1zdGFibGUvcmVmbGVjdC9jb25zdHJ1Y3QuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZV9jb25zdHJ1Y3QyKCk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZmVhdHVyZXMvYXJyYXkvaXMtYXJyYXkuanMKICB2YXIgcmVxdWlyZV9pc19hcnJheTUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ZlYXR1cmVzL2FycmF5L2lzLWFycmF5LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgcGFyZW50ID0gcmVxdWlyZV9pc19hcnJheTMoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXJlbnQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMvYXJyYXkvaXMtYXJyYXkuanMKICB2YXIgcmVxdWlyZV9pc19hcnJheTYgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzL2FycmF5L2lzLWFycmF5LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmVfaXNfYXJyYXk1KCk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2hlbHBlcnMvYXJyYXlXaXRoSG9sZXMuanMKICB2YXIgcmVxdWlyZV9hcnJheVdpdGhIb2xlcyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2hlbHBlcnMvYXJyYXlXaXRoSG9sZXMuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBfQXJyYXkkaXNBcnJheSA9IHJlcXVpcmVfaXNfYXJyYXk2KCk7CiAgICAgIGZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHsKICAgICAgICBpZiAoX0FycmF5JGlzQXJyYXkoYXJyKSkKICAgICAgICAgIHJldHVybiBhcnI7CiAgICAgIH0KICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfYXJyYXlXaXRoSG9sZXM7CiAgICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lc25leHQuc3ltYm9sLmFzeW5jLWRpc3Bvc2UuanMKICB2YXIgcmVxdWlyZV9lc25leHRfc3ltYm9sX2FzeW5jX2Rpc3Bvc2UgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXNuZXh0LnN5bWJvbC5hc3luYy1kaXNwb3NlLmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sID0gcmVxdWlyZV9kZWZpbmVfd2VsbF9rbm93bl9zeW1ib2woKTsKICAgICAgZGVmaW5lV2VsbEtub3duU3ltYm9sKCJhc3luY0Rpc3Bvc2UiKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzbmV4dC5zeW1ib2wuZGlzcG9zZS5qcwogIHZhciByZXF1aXJlX2VzbmV4dF9zeW1ib2xfZGlzcG9zZSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lc25leHQuc3ltYm9sLmRpc3Bvc2UuanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wgPSByZXF1aXJlX2RlZmluZV93ZWxsX2tub3duX3N5bWJvbCgpOwogICAgICBkZWZpbmVXZWxsS25vd25TeW1ib2woImRpc3Bvc2UiKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzbmV4dC5zeW1ib2wubWF0Y2hlci5qcwogIHZhciByZXF1aXJlX2VzbmV4dF9zeW1ib2xfbWF0Y2hlciA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lc25leHQuc3ltYm9sLm1hdGNoZXIuanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wgPSByZXF1aXJlX2RlZmluZV93ZWxsX2tub3duX3N5bWJvbCgpOwogICAgICBkZWZpbmVXZWxsS25vd25TeW1ib2woIm1hdGNoZXIiKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzbmV4dC5zeW1ib2wubWV0YWRhdGEuanMKICB2YXIgcmVxdWlyZV9lc25leHRfc3ltYm9sX21ldGFkYXRhID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzbmV4dC5zeW1ib2wubWV0YWRhdGEuanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wgPSByZXF1aXJlX2RlZmluZV93ZWxsX2tub3duX3N5bWJvbCgpOwogICAgICBkZWZpbmVXZWxsS25vd25TeW1ib2woIm1ldGFkYXRhIik7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lc25leHQuc3ltYm9sLm9ic2VydmFibGUuanMKICB2YXIgcmVxdWlyZV9lc25leHRfc3ltYm9sX29ic2VydmFibGUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXNuZXh0LnN5bWJvbC5vYnNlcnZhYmxlLmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sID0gcmVxdWlyZV9kZWZpbmVfd2VsbF9rbm93bl9zeW1ib2woKTsKICAgICAgZGVmaW5lV2VsbEtub3duU3ltYm9sKCJvYnNlcnZhYmxlIik7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lc25leHQuc3ltYm9sLnBhdHRlcm4tbWF0Y2guanMKICB2YXIgcmVxdWlyZV9lc25leHRfc3ltYm9sX3BhdHRlcm5fbWF0Y2ggPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXNuZXh0LnN5bWJvbC5wYXR0ZXJuLW1hdGNoLmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sID0gcmVxdWlyZV9kZWZpbmVfd2VsbF9rbm93bl9zeW1ib2woKTsKICAgICAgZGVmaW5lV2VsbEtub3duU3ltYm9sKCJwYXR0ZXJuTWF0Y2giKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzbmV4dC5zeW1ib2wucmVwbGFjZS1hbGwuanMKICB2YXIgcmVxdWlyZV9lc25leHRfc3ltYm9sX3JlcGxhY2VfYWxsID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzbmV4dC5zeW1ib2wucmVwbGFjZS1hbGwuanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wgPSByZXF1aXJlX2RlZmluZV93ZWxsX2tub3duX3N5bWJvbCgpOwogICAgICBkZWZpbmVXZWxsS25vd25TeW1ib2woInJlcGxhY2VBbGwiKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9mZWF0dXJlcy9zeW1ib2wvaW5kZXguanMKICB2YXIgcmVxdWlyZV9zeW1ib2w0ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9mZWF0dXJlcy9zeW1ib2wvaW5kZXguanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX3N5bWJvbDIoKTsKICAgICAgcmVxdWlyZV9lc25leHRfc3ltYm9sX2FzeW5jX2Rpc3Bvc2UoKTsKICAgICAgcmVxdWlyZV9lc25leHRfc3ltYm9sX2Rpc3Bvc2UoKTsKICAgICAgcmVxdWlyZV9lc25leHRfc3ltYm9sX21hdGNoZXIoKTsKICAgICAgcmVxdWlyZV9lc25leHRfc3ltYm9sX21ldGFkYXRhKCk7CiAgICAgIHJlcXVpcmVfZXNuZXh0X3N5bWJvbF9vYnNlcnZhYmxlKCk7CiAgICAgIHJlcXVpcmVfZXNuZXh0X3N5bWJvbF9wYXR0ZXJuX21hdGNoKCk7CiAgICAgIHJlcXVpcmVfZXNuZXh0X3N5bWJvbF9yZXBsYWNlX2FsbCgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhcmVudDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy9zeW1ib2wuanMKICB2YXIgcmVxdWlyZV9zeW1ib2w1ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy9zeW1ib2wuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZV9zeW1ib2w0KCk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2hlbHBlcnMvaXRlcmFibGVUb0FycmF5TGltaXQuanMKICB2YXIgcmVxdWlyZV9pdGVyYWJsZVRvQXJyYXlMaW1pdCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2hlbHBlcnMvaXRlcmFibGVUb0FycmF5TGltaXQuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBfU3ltYm9sID0gcmVxdWlyZV9zeW1ib2w1KCk7CiAgICAgIHZhciBfZ2V0SXRlcmF0b3JNZXRob2QgPSByZXF1aXJlX2dldF9pdGVyYXRvcl9tZXRob2Q1KCk7CiAgICAgIGZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHsKICAgICAgICB2YXIgX2kgPSBhcnIgPT0gbnVsbCA/IG51bGwgOiB0eXBlb2YgX1N5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgX2dldEl0ZXJhdG9yTWV0aG9kKGFycikgfHwgYXJyWyJAQGl0ZXJhdG9yIl07CiAgICAgICAgaWYgKF9pID09IG51bGwpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgdmFyIF9hcnIgPSBbXTsKICAgICAgICB2YXIgX24gPSB0cnVlOwogICAgICAgIHZhciBfZCA9IGZhbHNlOwogICAgICAgIHZhciBfcywgX2U7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZvciAoX2kgPSBfaS5jYWxsKGFycik7ICEoX24gPSAoX3MgPSBfaS5uZXh0KCkpLmRvbmUpOyBfbiA9IHRydWUpIHsKICAgICAgICAgICAgX2Fyci5wdXNoKF9zLnZhbHVlKTsKICAgICAgICAgICAgaWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICBfZCA9IHRydWU7CiAgICAgICAgICBfZSA9IGVycjsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfbiAmJiBfaVsicmV0dXJuIl0gIT0gbnVsbCkKICAgICAgICAgICAgICBfaVsicmV0dXJuIl0oKTsKICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChfZCkKICAgICAgICAgICAgICB0aHJvdyBfZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9hcnI7CiAgICAgIH0KICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfaXRlcmFibGVUb0FycmF5TGltaXQ7CiAgICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5hcnJheS5zbGljZS5qcwogIHZhciByZXF1aXJlX2VzX2FycmF5X3NsaWNlID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLmFycmF5LnNsaWNlLmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciAkID0gcmVxdWlyZV9leHBvcnQoKTsKICAgICAgdmFyIGlzQXJyYXkgPSByZXF1aXJlX2lzX2FycmF5KCk7CiAgICAgIHZhciBpc0NvbnN0cnVjdG9yID0gcmVxdWlyZV9pc19jb25zdHJ1Y3RvcigpOwogICAgICB2YXIgaXNPYmplY3QgPSByZXF1aXJlX2lzX29iamVjdCgpOwogICAgICB2YXIgdG9BYnNvbHV0ZUluZGV4ID0gcmVxdWlyZV90b19hYnNvbHV0ZV9pbmRleCgpOwogICAgICB2YXIgdG9MZW5ndGggPSByZXF1aXJlX3RvX2xlbmd0aCgpOwogICAgICB2YXIgdG9JbmRleGVkT2JqZWN0ID0gcmVxdWlyZV90b19pbmRleGVkX29iamVjdCgpOwogICAgICB2YXIgY3JlYXRlUHJvcGVydHkgPSByZXF1aXJlX2NyZWF0ZV9wcm9wZXJ0eSgpOwogICAgICB2YXIgd2VsbEtub3duU3ltYm9sID0gcmVxdWlyZV93ZWxsX2tub3duX3N5bWJvbCgpOwogICAgICB2YXIgYXJyYXlNZXRob2RIYXNTcGVjaWVzU3VwcG9ydCA9IHJlcXVpcmVfYXJyYXlfbWV0aG9kX2hhc19zcGVjaWVzX3N1cHBvcnQoKTsKICAgICAgdmFyIEhBU19TUEVDSUVTX1NVUFBPUlQgPSBhcnJheU1ldGhvZEhhc1NwZWNpZXNTdXBwb3J0KCJzbGljZSIpOwogICAgICB2YXIgU1BFQ0lFUyA9IHdlbGxLbm93blN5bWJvbCgic3BlY2llcyIpOwogICAgICB2YXIgbmF0aXZlU2xpY2UgPSBbXS5zbGljZTsKICAgICAgdmFyIG1heCA9IE1hdGgubWF4OwogICAgICAkKHsgdGFyZ2V0OiAiQXJyYXkiLCBwcm90bzogdHJ1ZSwgZm9yY2VkOiAhSEFTX1NQRUNJRVNfU1VQUE9SVCB9LCB7CiAgICAgICAgc2xpY2U6IGZ1bmN0aW9uIHNsaWNlKHN0YXJ0LCBlbmQpIHsKICAgICAgICAgIHZhciBPID0gdG9JbmRleGVkT2JqZWN0KHRoaXMpOwogICAgICAgICAgdmFyIGxlbmd0aCA9IHRvTGVuZ3RoKE8ubGVuZ3RoKTsKICAgICAgICAgIHZhciBrID0gdG9BYnNvbHV0ZUluZGV4KHN0YXJ0LCBsZW5ndGgpOwogICAgICAgICAgdmFyIGZpbiA9IHRvQWJzb2x1dGVJbmRleChlbmQgPT09IHZvaWQgMCA/IGxlbmd0aCA6IGVuZCwgbGVuZ3RoKTsKICAgICAgICAgIHZhciBDb25zdHJ1Y3RvciwgcmVzdWx0LCBuOwogICAgICAgICAgaWYgKGlzQXJyYXkoTykpIHsKICAgICAgICAgICAgQ29uc3RydWN0b3IgPSBPLmNvbnN0cnVjdG9yOwogICAgICAgICAgICBpZiAoaXNDb25zdHJ1Y3RvcihDb25zdHJ1Y3RvcikgJiYgKENvbnN0cnVjdG9yID09PSBBcnJheSB8fCBpc0FycmF5KENvbnN0cnVjdG9yLnByb3RvdHlwZSkpKSB7CiAgICAgICAgICAgICAgQ29uc3RydWN0b3IgPSB2b2lkIDA7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNPYmplY3QoQ29uc3RydWN0b3IpKSB7CiAgICAgICAgICAgICAgQ29uc3RydWN0b3IgPSBDb25zdHJ1Y3RvcltTUEVDSUVTXTsKICAgICAgICAgICAgICBpZiAoQ29uc3RydWN0b3IgPT09IG51bGwpCiAgICAgICAgICAgICAgICBDb25zdHJ1Y3RvciA9IHZvaWQgMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoQ29uc3RydWN0b3IgPT09IEFycmF5IHx8IENvbnN0cnVjdG9yID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICByZXR1cm4gbmF0aXZlU2xpY2UuY2FsbChPLCBrLCBmaW4pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXN1bHQgPSBuZXcgKENvbnN0cnVjdG9yID09PSB2b2lkIDAgPyBBcnJheSA6IENvbnN0cnVjdG9yKShtYXgoZmluIC0gaywgMCkpOwogICAgICAgICAgZm9yIChuID0gMDsgayA8IGZpbjsgaysrLCBuKyspCiAgICAgICAgICAgIGlmIChrIGluIE8pCiAgICAgICAgICAgICAgY3JlYXRlUHJvcGVydHkocmVzdWx0LCBuLCBPW2tdKTsKICAgICAgICAgIHJlc3VsdC5sZW5ndGggPSBuOwogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL2FycmF5L3ZpcnR1YWwvc2xpY2UuanMKICB2YXIgcmVxdWlyZV9zbGljZSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvYXJyYXkvdmlydHVhbC9zbGljZS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgcmVxdWlyZV9lc19hcnJheV9zbGljZSgpOwogICAgICB2YXIgZW50cnlWaXJ0dWFsID0gcmVxdWlyZV9lbnRyeV92aXJ0dWFsKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZW50cnlWaXJ0dWFsKCJBcnJheSIpLnNsaWNlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL2luc3RhbmNlL3NsaWNlLmpzCiAgdmFyIHJlcXVpcmVfc2xpY2UyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9pbnN0YW5jZS9zbGljZS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHNsaWNlID0gcmVxdWlyZV9zbGljZSgpOwogICAgICB2YXIgQXJyYXlQcm90b3R5cGUgPSBBcnJheS5wcm90b3R5cGU7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpIHsKICAgICAgICB2YXIgb3duID0gaXQuc2xpY2U7CiAgICAgICAgcmV0dXJuIGl0ID09PSBBcnJheVByb3RvdHlwZSB8fCBpdCBpbnN0YW5jZW9mIEFycmF5ICYmIG93biA9PT0gQXJyYXlQcm90b3R5cGUuc2xpY2UgPyBzbGljZSA6IG93bjsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvaW5zdGFuY2Uvc2xpY2UuanMKICB2YXIgcmVxdWlyZV9zbGljZTMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9pbnN0YW5jZS9zbGljZS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHBhcmVudCA9IHJlcXVpcmVfc2xpY2UyKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGFyZW50OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ZlYXR1cmVzL2luc3RhbmNlL3NsaWNlLmpzCiAgdmFyIHJlcXVpcmVfc2xpY2U0ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9mZWF0dXJlcy9pbnN0YW5jZS9zbGljZS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHBhcmVudCA9IHJlcXVpcmVfc2xpY2UzKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGFyZW50OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzL2luc3RhbmNlL3NsaWNlLmpzCiAgdmFyIHJlcXVpcmVfc2xpY2U1ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy9pbnN0YW5jZS9zbGljZS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlX3NsaWNlNCgpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ZlYXR1cmVzL2FycmF5L2Zyb20uanMKICB2YXIgcmVxdWlyZV9mcm9tNCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZmVhdHVyZXMvYXJyYXkvZnJvbS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHBhcmVudCA9IHJlcXVpcmVfZnJvbTIoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXJlbnQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMvYXJyYXkvZnJvbS5qcwogIHZhciByZXF1aXJlX2Zyb201ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy9hcnJheS9mcm9tLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmVfZnJvbTQoKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy9hcnJheUxpa2VUb0FycmF5LmpzCiAgdmFyIHJlcXVpcmVfYXJyYXlMaWtlVG9BcnJheSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2hlbHBlcnMvYXJyYXlMaWtlVG9BcnJheS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHsKICAgICAgICBpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkKICAgICAgICAgIGxlbiA9IGFyci5sZW5ndGg7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICBhcnIyW2ldID0gYXJyW2ldOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYXJyMjsKICAgICAgfQogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9hcnJheUxpa2VUb0FycmF5OwogICAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9oZWxwZXJzL3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5LmpzCiAgdmFyIHJlcXVpcmVfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9oZWxwZXJzL3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgX3NsaWNlSW5zdGFuY2VQcm9wZXJ0eSA9IHJlcXVpcmVfc2xpY2U1KCk7CiAgICAgIHZhciBfQXJyYXkkZnJvbSA9IHJlcXVpcmVfZnJvbTUoKTsKICAgICAgdmFyIGFycmF5TGlrZVRvQXJyYXkgPSByZXF1aXJlX2FycmF5TGlrZVRvQXJyYXkoKTsKICAgICAgZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikgewogICAgICAgIHZhciBfY29udGV4dDsKICAgICAgICBpZiAoIW8pCiAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikKICAgICAgICAgIHJldHVybiBhcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7CiAgICAgICAgdmFyIG4gPSBfc2xpY2VJbnN0YW5jZVByb3BlcnR5KF9jb250ZXh0ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pKS5jYWxsKF9jb250ZXh0LCA4LCAtMSk7CiAgICAgICAgaWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpCiAgICAgICAgICBuID0gby5jb25zdHJ1Y3Rvci5uYW1lOwogICAgICAgIGlmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikKICAgICAgICAgIHJldHVybiBfQXJyYXkkZnJvbShvKTsKICAgICAgICBpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpCiAgICAgICAgICByZXR1cm4gYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOwogICAgICB9CiAgICAgIG1vZHVsZS5leHBvcnRzID0gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5OwogICAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9oZWxwZXJzL25vbkl0ZXJhYmxlUmVzdC5qcwogIHZhciByZXF1aXJlX25vbkl0ZXJhYmxlUmVzdCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2hlbHBlcnMvbm9uSXRlcmFibGVSZXN0LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7CiAgICAgIH0KICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfbm9uSXRlcmFibGVSZXN0OwogICAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9oZWxwZXJzL3NsaWNlZFRvQXJyYXkuanMKICB2YXIgcmVxdWlyZV9zbGljZWRUb0FycmF5ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy9zbGljZWRUb0FycmF5LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgYXJyYXlXaXRoSG9sZXMgPSByZXF1aXJlX2FycmF5V2l0aEhvbGVzKCk7CiAgICAgIHZhciBpdGVyYWJsZVRvQXJyYXlMaW1pdCA9IHJlcXVpcmVfaXRlcmFibGVUb0FycmF5TGltaXQoKTsKICAgICAgdmFyIHVuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5ID0gcmVxdWlyZV91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheSgpOwogICAgICB2YXIgbm9uSXRlcmFibGVSZXN0ID0gcmVxdWlyZV9ub25JdGVyYWJsZVJlc3QoKTsKICAgICAgZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7CiAgICAgICAgcmV0dXJuIGFycmF5V2l0aEhvbGVzKGFycikgfHwgaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCB1bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShhcnIsIGkpIHx8IG5vbkl0ZXJhYmxlUmVzdCgpOwogICAgICB9CiAgICAgIG1vZHVsZS5leHBvcnRzID0gX3NsaWNlZFRvQXJyYXk7CiAgICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZmVhdHVyZXMvb2JqZWN0L2RlZmluZS1wcm9wZXJ0eS5qcwogIHZhciByZXF1aXJlX2RlZmluZV9wcm9wZXJ0eTQgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ZlYXR1cmVzL29iamVjdC9kZWZpbmUtcHJvcGVydHkuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX2RlZmluZV9wcm9wZXJ0eTIoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXJlbnQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMvb2JqZWN0L2RlZmluZS1wcm9wZXJ0eS5qcwogIHZhciByZXF1aXJlX2RlZmluZV9wcm9wZXJ0eTUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzL29iamVjdC9kZWZpbmUtcHJvcGVydHkuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZV9kZWZpbmVfcHJvcGVydHk0KCk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2hlbHBlcnMvZGVmaW5lUHJvcGVydHkuanMKICB2YXIgcmVxdWlyZV9kZWZpbmVQcm9wZXJ0eSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2hlbHBlcnMvZGVmaW5lUHJvcGVydHkuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBfT2JqZWN0JGRlZmluZVByb3BlcnR5ID0gcmVxdWlyZV9kZWZpbmVfcHJvcGVydHk1KCk7CiAgICAgIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsKICAgICAgICBpZiAoa2V5IGluIG9iaikgewogICAgICAgICAgX09iamVjdCRkZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICAgICAgICB2YWx1ZSwKICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgICAgICB3cml0YWJsZTogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG9ialtrZXldID0gdmFsdWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBvYmo7CiAgICAgIH0KICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfZGVmaW5lUHJvcGVydHk7CiAgICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5hcnJheS5tYXAuanMKICB2YXIgcmVxdWlyZV9lc19hcnJheV9tYXAgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMuYXJyYXkubWFwLmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciAkID0gcmVxdWlyZV9leHBvcnQoKTsKICAgICAgdmFyICRtYXAgPSByZXF1aXJlX2FycmF5X2l0ZXJhdGlvbigpLm1hcDsKICAgICAgdmFyIGFycmF5TWV0aG9kSGFzU3BlY2llc1N1cHBvcnQgPSByZXF1aXJlX2FycmF5X21ldGhvZF9oYXNfc3BlY2llc19zdXBwb3J0KCk7CiAgICAgIHZhciBIQVNfU1BFQ0lFU19TVVBQT1JUID0gYXJyYXlNZXRob2RIYXNTcGVjaWVzU3VwcG9ydCgibWFwIik7CiAgICAgICQoeyB0YXJnZXQ6ICJBcnJheSIsIHByb3RvOiB0cnVlLCBmb3JjZWQ6ICFIQVNfU1BFQ0lFU19TVVBQT1JUIH0sIHsKICAgICAgICBtYXA6IGZ1bmN0aW9uIG1hcDIoY2FsbGJhY2tmbikgewogICAgICAgICAgcmV0dXJuICRtYXAodGhpcywgY2FsbGJhY2tmbiwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB2b2lkIDApOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvYXJyYXkvdmlydHVhbC9tYXAuanMKICB2YXIgcmVxdWlyZV9tYXAgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL2FycmF5L3ZpcnR1YWwvbWFwLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICByZXF1aXJlX2VzX2FycmF5X21hcCgpOwogICAgICB2YXIgZW50cnlWaXJ0dWFsID0gcmVxdWlyZV9lbnRyeV92aXJ0dWFsKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZW50cnlWaXJ0dWFsKCJBcnJheSIpLm1hcDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9pbnN0YW5jZS9tYXAuanMKICB2YXIgcmVxdWlyZV9tYXAyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9pbnN0YW5jZS9tYXAuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBtYXAyID0gcmVxdWlyZV9tYXAoKTsKICAgICAgdmFyIEFycmF5UHJvdG90eXBlID0gQXJyYXkucHJvdG90eXBlOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KSB7CiAgICAgICAgdmFyIG93biA9IGl0Lm1hcDsKICAgICAgICByZXR1cm4gaXQgPT09IEFycmF5UHJvdG90eXBlIHx8IGl0IGluc3RhbmNlb2YgQXJyYXkgJiYgb3duID09PSBBcnJheVByb3RvdHlwZS5tYXAgPyBtYXAyIDogb3duOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9pbnN0YW5jZS9tYXAuanMKICB2YXIgcmVxdWlyZV9tYXAzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvaW5zdGFuY2UvbWFwLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgcGFyZW50ID0gcmVxdWlyZV9tYXAyKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGFyZW50OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzLXN0YWJsZS9pbnN0YW5jZS9tYXAuanMKICB2YXIgcmVxdWlyZV9tYXA0ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy1zdGFibGUvaW5zdGFuY2UvbWFwLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmVfbWFwMygpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvcmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzCiAgdmFyIHJlcXVpcmVfcnVudGltZSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9yZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBydW50aW1lID0gZnVuY3Rpb24oZXhwb3J0czIpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIE9wID0gT2JqZWN0LnByb3RvdHlwZTsKICAgICAgICB2YXIgaGFzT3duID0gT3AuaGFzT3duUHJvcGVydHk7CiAgICAgICAgdmFyIHVuZGVmaW5lZDI7CiAgICAgICAgdmFyICRTeW1ib2wgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iID8gU3ltYm9sIDoge307CiAgICAgICAgdmFyIGl0ZXJhdG9yU3ltYm9sID0gJFN5bWJvbC5pdGVyYXRvciB8fCAiQEBpdGVyYXRvciI7CiAgICAgICAgdmFyIGFzeW5jSXRlcmF0b3JTeW1ib2wgPSAkU3ltYm9sLmFzeW5jSXRlcmF0b3IgfHwgIkBAYXN5bmNJdGVyYXRvciI7CiAgICAgICAgdmFyIHRvU3RyaW5nVGFnU3ltYm9sID0gJFN5bWJvbC50b1N0cmluZ1RhZyB8fCAiQEB0b1N0cmluZ1RhZyI7CiAgICAgICAgZnVuY3Rpb24gZGVmaW5lKG9iaiwga2V5LCB2YWx1ZSkgewogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7CiAgICAgICAgICAgIHZhbHVlLAogICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBvYmpba2V5XTsKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGRlZmluZSh7fSwgIiIpOwogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgZGVmaW5lID0gZnVuY3Rpb24ob2JqLCBrZXksIHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiBvYmpba2V5XSA9IHZhbHVlOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gd3JhcChpbm5lckZuLCBvdXRlckZuLCBzZWxmMiwgdHJ5TG9jc0xpc3QpIHsKICAgICAgICAgIHZhciBwcm90b0dlbmVyYXRvciA9IG91dGVyRm4gJiYgb3V0ZXJGbi5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IgPyBvdXRlckZuIDogR2VuZXJhdG9yOwogICAgICAgICAgdmFyIGdlbmVyYXRvciA9IE9iamVjdC5jcmVhdGUocHJvdG9HZW5lcmF0b3IucHJvdG90eXBlKTsKICAgICAgICAgIHZhciBjb250ZXh0ID0gbmV3IENvbnRleHQodHJ5TG9jc0xpc3QgfHwgW10pOwogICAgICAgICAgZ2VuZXJhdG9yLl9pbnZva2UgPSBtYWtlSW52b2tlTWV0aG9kKGlubmVyRm4sIHNlbGYyLCBjb250ZXh0KTsKICAgICAgICAgIHJldHVybiBnZW5lcmF0b3I7CiAgICAgICAgfQogICAgICAgIGV4cG9ydHMyLndyYXAgPSB3cmFwOwogICAgICAgIGZ1bmN0aW9uIHRyeUNhdGNoKGZuLCBvYmosIGFyZykgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIHsgdHlwZTogIm5vcm1hbCIsIGFyZzogZm4uY2FsbChvYmosIGFyZykgfTsKICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICByZXR1cm4geyB0eXBlOiAidGhyb3ciLCBhcmc6IGVyciB9OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB2YXIgR2VuU3RhdGVTdXNwZW5kZWRTdGFydCA9ICJzdXNwZW5kZWRTdGFydCI7CiAgICAgICAgdmFyIEdlblN0YXRlU3VzcGVuZGVkWWllbGQgPSAic3VzcGVuZGVkWWllbGQiOwogICAgICAgIHZhciBHZW5TdGF0ZUV4ZWN1dGluZyA9ICJleGVjdXRpbmciOwogICAgICAgIHZhciBHZW5TdGF0ZUNvbXBsZXRlZCA9ICJjb21wbGV0ZWQiOwogICAgICAgIHZhciBDb250aW51ZVNlbnRpbmVsID0ge307CiAgICAgICAgZnVuY3Rpb24gR2VuZXJhdG9yKCkgewogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvbigpIHsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUoKSB7CiAgICAgICAgfQogICAgICAgIHZhciBJdGVyYXRvclByb3RvdHlwZSA9IHt9OwogICAgICAgIGRlZmluZShJdGVyYXRvclByb3RvdHlwZSwgaXRlcmF0b3JTeW1ib2wsIGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIGdldFByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mOwogICAgICAgIHZhciBOYXRpdmVJdGVyYXRvclByb3RvdHlwZSA9IGdldFByb3RvICYmIGdldFByb3RvKGdldFByb3RvKHZhbHVlcyhbXSkpKTsKICAgICAgICBpZiAoTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUgJiYgTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUgIT09IE9wICYmIGhhc093bi5jYWxsKE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlLCBpdGVyYXRvclN5bWJvbCkpIHsKICAgICAgICAgIEl0ZXJhdG9yUHJvdG90eXBlID0gTmF0aXZlSXRlcmF0b3JQcm90b3R5cGU7CiAgICAgICAgfQogICAgICAgIHZhciBHcCA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLnByb3RvdHlwZSA9IEdlbmVyYXRvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEl0ZXJhdG9yUHJvdG90eXBlKTsKICAgICAgICBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZTsKICAgICAgICBkZWZpbmUoR3AsICJjb25zdHJ1Y3RvciIsIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKTsKICAgICAgICBkZWZpbmUoR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsICJjb25zdHJ1Y3RvciIsIEdlbmVyYXRvckZ1bmN0aW9uKTsKICAgICAgICBHZW5lcmF0b3JGdW5jdGlvbi5kaXNwbGF5TmFtZSA9IGRlZmluZShHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgdG9TdHJpbmdUYWdTeW1ib2wsICJHZW5lcmF0b3JGdW5jdGlvbiIpOwogICAgICAgIGZ1bmN0aW9uIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhwcm90b3R5cGUpIHsKICAgICAgICAgIFsibmV4dCIsICJ0aHJvdyIsICJyZXR1cm4iXS5mb3JFYWNoKGZ1bmN0aW9uKG1ldGhvZCkgewogICAgICAgICAgICBkZWZpbmUocHJvdG90eXBlLCBtZXRob2QsIGZ1bmN0aW9uKGFyZykgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBhcmcpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBleHBvcnRzMi5pc0dlbmVyYXRvckZ1bmN0aW9uID0gZnVuY3Rpb24oZ2VuRnVuKSB7CiAgICAgICAgICB2YXIgY3RvciA9IHR5cGVvZiBnZW5GdW4gPT09ICJmdW5jdGlvbiIgJiYgZ2VuRnVuLmNvbnN0cnVjdG9yOwogICAgICAgICAgcmV0dXJuIGN0b3IgPyBjdG9yID09PSBHZW5lcmF0b3JGdW5jdGlvbiB8fCAoY3Rvci5kaXNwbGF5TmFtZSB8fCBjdG9yLm5hbWUpID09PSAiR2VuZXJhdG9yRnVuY3Rpb24iIDogZmFsc2U7CiAgICAgICAgfTsKICAgICAgICBleHBvcnRzMi5tYXJrID0gZnVuY3Rpb24oZ2VuRnVuKSB7CiAgICAgICAgICBpZiAoT2JqZWN0LnNldFByb3RvdHlwZU9mKSB7CiAgICAgICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZihnZW5GdW4sIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGdlbkZ1bi5fX3Byb3RvX18gPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZTsKICAgICAgICAgICAgZGVmaW5lKGdlbkZ1biwgdG9TdHJpbmdUYWdTeW1ib2wsICJHZW5lcmF0b3JGdW5jdGlvbiIpOwogICAgICAgICAgfQogICAgICAgICAgZ2VuRnVuLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoR3ApOwogICAgICAgICAgcmV0dXJuIGdlbkZ1bjsKICAgICAgICB9OwogICAgICAgIGV4cG9ydHMyLmF3cmFwID0gZnVuY3Rpb24oYXJnKSB7CiAgICAgICAgICByZXR1cm4geyBfX2F3YWl0OiBhcmcgfTsKICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIEFzeW5jSXRlcmF0b3IoZ2VuZXJhdG9yLCBQcm9taXNlSW1wbCkgewogICAgICAgICAgZnVuY3Rpb24gaW52b2tlKG1ldGhvZCwgYXJnLCByZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgdmFyIHJlY29yZCA9IHRyeUNhdGNoKGdlbmVyYXRvclttZXRob2RdLCBnZW5lcmF0b3IsIGFyZyk7CiAgICAgICAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gInRocm93IikgewogICAgICAgICAgICAgIHJlamVjdChyZWNvcmQuYXJnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gcmVjb3JkLmFyZzsKICAgICAgICAgICAgICB2YXIgdmFsdWUgPSByZXN1bHQudmFsdWU7CiAgICAgICAgICAgICAgaWYgKHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIgJiYgaGFzT3duLmNhbGwodmFsdWUsICJfX2F3YWl0IikpIHsKICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlSW1wbC5yZXNvbHZlKHZhbHVlLl9fYXdhaXQpLnRoZW4oZnVuY3Rpb24odmFsdWUyKSB7CiAgICAgICAgICAgICAgICAgIGludm9rZSgibmV4dCIsIHZhbHVlMiwgcmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikgewogICAgICAgICAgICAgICAgICBpbnZva2UoInRocm93IiwgZXJyLCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBQcm9taXNlSW1wbC5yZXNvbHZlKHZhbHVlKS50aGVuKGZ1bmN0aW9uKHVud3JhcHBlZCkgewogICAgICAgICAgICAgICAgcmVzdWx0LnZhbHVlID0gdW53cmFwcGVkOwogICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpOwogICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycm9yKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaW52b2tlKCJ0aHJvdyIsIGVycm9yLCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcHJldmlvdXNQcm9taXNlOwogICAgICAgICAgZnVuY3Rpb24gZW5xdWV1ZShtZXRob2QsIGFyZykgewogICAgICAgICAgICBmdW5jdGlvbiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpIHsKICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2VJbXBsKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICAgICAgaW52b2tlKG1ldGhvZCwgYXJnLCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBwcmV2aW91c1Byb21pc2UgPSBwcmV2aW91c1Byb21pc2UgPyBwcmV2aW91c1Byb21pc2UudGhlbihjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZywgY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcpIDogY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcoKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuX2ludm9rZSA9IGVucXVldWU7CiAgICAgICAgfQogICAgICAgIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSk7CiAgICAgICAgZGVmaW5lKEFzeW5jSXRlcmF0b3IucHJvdG90eXBlLCBhc3luY0l0ZXJhdG9yU3ltYm9sLCBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0pOwogICAgICAgIGV4cG9ydHMyLkFzeW5jSXRlcmF0b3IgPSBBc3luY0l0ZXJhdG9yOwogICAgICAgIGV4cG9ydHMyLmFzeW5jID0gZnVuY3Rpb24oaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZjIsIHRyeUxvY3NMaXN0LCBQcm9taXNlSW1wbCkgewogICAgICAgICAgaWYgKFByb21pc2VJbXBsID09PSB2b2lkIDApCiAgICAgICAgICAgIFByb21pc2VJbXBsID0gUHJvbWlzZTsKICAgICAgICAgIHZhciBpdGVyID0gbmV3IEFzeW5jSXRlcmF0b3Iod3JhcChpbm5lckZuLCBvdXRlckZuLCBzZWxmMiwgdHJ5TG9jc0xpc3QpLCBQcm9taXNlSW1wbCk7CiAgICAgICAgICByZXR1cm4gZXhwb3J0czIuaXNHZW5lcmF0b3JGdW5jdGlvbihvdXRlckZuKSA/IGl0ZXIgOiBpdGVyLm5leHQoKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICAgICByZXR1cm4gcmVzdWx0LmRvbmUgPyByZXN1bHQudmFsdWUgOiBpdGVyLm5leHQoKTsKICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgZnVuY3Rpb24gbWFrZUludm9rZU1ldGhvZChpbm5lckZuLCBzZWxmMiwgY29udGV4dCkgewogICAgICAgICAgdmFyIHN0YXRlID0gR2VuU3RhdGVTdXNwZW5kZWRTdGFydDsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiBpbnZva2UobWV0aG9kLCBhcmcpIHsKICAgICAgICAgICAgaWYgKHN0YXRlID09PSBHZW5TdGF0ZUV4ZWN1dGluZykgewogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZyIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gR2VuU3RhdGVDb21wbGV0ZWQpIHsKICAgICAgICAgICAgICBpZiAobWV0aG9kID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBhcmc7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBkb25lUmVzdWx0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29udGV4dC5tZXRob2QgPSBtZXRob2Q7CiAgICAgICAgICAgIGNvbnRleHQuYXJnID0gYXJnOwogICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICAgIHZhciBkZWxlZ2F0ZSA9IGNvbnRleHQuZGVsZWdhdGU7CiAgICAgICAgICAgICAgaWYgKGRlbGVnYXRlKSB7CiAgICAgICAgICAgICAgICB2YXIgZGVsZWdhdGVSZXN1bHQgPSBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KTsKICAgICAgICAgICAgICAgIGlmIChkZWxlZ2F0ZVJlc3VsdCkgewogICAgICAgICAgICAgICAgICBpZiAoZGVsZWdhdGVSZXN1bHQgPT09IENvbnRpbnVlU2VudGluZWwpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgIHJldHVybiBkZWxlZ2F0ZVJlc3VsdDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGNvbnRleHQubWV0aG9kID09PSAibmV4dCIpIHsKICAgICAgICAgICAgICAgIGNvbnRleHQuc2VudCA9IGNvbnRleHQuX3NlbnQgPSBjb250ZXh0LmFyZzsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRleHQubWV0aG9kID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUgPT09IEdlblN0YXRlU3VzcGVuZGVkU3RhcnQpIHsKICAgICAgICAgICAgICAgICAgc3RhdGUgPSBHZW5TdGF0ZUNvbXBsZXRlZDsKICAgICAgICAgICAgICAgICAgdGhyb3cgY29udGV4dC5hcmc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb250ZXh0LmRpc3BhdGNoRXhjZXB0aW9uKGNvbnRleHQuYXJnKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRleHQubWV0aG9kID09PSAicmV0dXJuIikgewogICAgICAgICAgICAgICAgY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGNvbnRleHQuYXJnKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgc3RhdGUgPSBHZW5TdGF0ZUV4ZWN1dGluZzsKICAgICAgICAgICAgICB2YXIgcmVjb3JkID0gdHJ5Q2F0Y2goaW5uZXJGbiwgc2VsZjIsIGNvbnRleHQpOwogICAgICAgICAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gIm5vcm1hbCIpIHsKICAgICAgICAgICAgICAgIHN0YXRlID0gY29udGV4dC5kb25lID8gR2VuU3RhdGVDb21wbGV0ZWQgOiBHZW5TdGF0ZVN1c3BlbmRlZFlpZWxkOwogICAgICAgICAgICAgICAgaWYgKHJlY29yZC5hcmcgPT09IENvbnRpbnVlU2VudGluZWwpIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICB2YWx1ZTogcmVjb3JkLmFyZywKICAgICAgICAgICAgICAgICAgZG9uZTogY29udGV4dC5kb25lCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVjb3JkLnR5cGUgPT09ICJ0aHJvdyIpIHsKICAgICAgICAgICAgICAgIHN0YXRlID0gR2VuU3RhdGVDb21wbGV0ZWQ7CiAgICAgICAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyI7CiAgICAgICAgICAgICAgICBjb250ZXh0LmFyZyA9IHJlY29yZC5hcmc7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KSB7CiAgICAgICAgICB2YXIgbWV0aG9kID0gZGVsZWdhdGUuaXRlcmF0b3JbY29udGV4dC5tZXRob2RdOwogICAgICAgICAgaWYgKG1ldGhvZCA9PT0gdW5kZWZpbmVkMikgewogICAgICAgICAgICBjb250ZXh0LmRlbGVnYXRlID0gbnVsbDsKICAgICAgICAgICAgaWYgKGNvbnRleHQubWV0aG9kID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgICAgaWYgKGRlbGVnYXRlLml0ZXJhdG9yWyJyZXR1cm4iXSkgewogICAgICAgICAgICAgICAgY29udGV4dC5tZXRob2QgPSAicmV0dXJuIjsKICAgICAgICAgICAgICAgIGNvbnRleHQuYXJnID0gdW5kZWZpbmVkMjsKICAgICAgICAgICAgICAgIG1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpOwogICAgICAgICAgICAgICAgaWYgKGNvbnRleHQubWV0aG9kID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyI7CiAgICAgICAgICAgICAgY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKCJUaGUgaXRlcmF0b3IgZG9lcyBub3QgcHJvdmlkZSBhICd0aHJvdycgbWV0aG9kIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcmVjb3JkID0gdHJ5Q2F0Y2gobWV0aG9kLCBkZWxlZ2F0ZS5pdGVyYXRvciwgY29udGV4dC5hcmcpOwogICAgICAgICAgaWYgKHJlY29yZC50eXBlID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgIGNvbnRleHQubWV0aG9kID0gInRocm93IjsKICAgICAgICAgICAgY29udGV4dC5hcmcgPSByZWNvcmQuYXJnOwogICAgICAgICAgICBjb250ZXh0LmRlbGVnYXRlID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgaW5mbyA9IHJlY29yZC5hcmc7CiAgICAgICAgICBpZiAoIWluZm8pIHsKICAgICAgICAgICAgY29udGV4dC5tZXRob2QgPSAidGhyb3ciOwogICAgICAgICAgICBjb250ZXh0LmFyZyA9IG5ldyBUeXBlRXJyb3IoIml0ZXJhdG9yIHJlc3VsdCBpcyBub3QgYW4gb2JqZWN0Iik7CiAgICAgICAgICAgIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsOwogICAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChpbmZvLmRvbmUpIHsKICAgICAgICAgICAgY29udGV4dFtkZWxlZ2F0ZS5yZXN1bHROYW1lXSA9IGluZm8udmFsdWU7CiAgICAgICAgICAgIGNvbnRleHQubmV4dCA9IGRlbGVnYXRlLm5leHRMb2M7CiAgICAgICAgICAgIGlmIChjb250ZXh0Lm1ldGhvZCAhPT0gInJldHVybiIpIHsKICAgICAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJuZXh0IjsKICAgICAgICAgICAgICBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZDI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBpbmZvOwogICAgICAgICAgfQogICAgICAgICAgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGw7CiAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgICB9CiAgICAgICAgZGVmaW5lSXRlcmF0b3JNZXRob2RzKEdwKTsKICAgICAgICBkZWZpbmUoR3AsIHRvU3RyaW5nVGFnU3ltYm9sLCAiR2VuZXJhdG9yIik7CiAgICAgICAgZGVmaW5lKEdwLCBpdGVyYXRvclN5bWJvbCwgZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9KTsKICAgICAgICBkZWZpbmUoR3AsICJ0b1N0cmluZyIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuICJbb2JqZWN0IEdlbmVyYXRvcl0iOwogICAgICAgIH0pOwogICAgICAgIGZ1bmN0aW9uIHB1c2hUcnlFbnRyeShsb2NzKSB7CiAgICAgICAgICB2YXIgZW50cnkgPSB7IHRyeUxvYzogbG9jc1swXSB9OwogICAgICAgICAgaWYgKDEgaW4gbG9jcykgewogICAgICAgICAgICBlbnRyeS5jYXRjaExvYyA9IGxvY3NbMV07CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoMiBpbiBsb2NzKSB7CiAgICAgICAgICAgIGVudHJ5LmZpbmFsbHlMb2MgPSBsb2NzWzJdOwogICAgICAgICAgICBlbnRyeS5hZnRlckxvYyA9IGxvY3NbM107CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnRyeUVudHJpZXMucHVzaChlbnRyeSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHJlc2V0VHJ5RW50cnkoZW50cnkpIHsKICAgICAgICAgIHZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uIHx8IHt9OwogICAgICAgICAgcmVjb3JkLnR5cGUgPSAibm9ybWFsIjsKICAgICAgICAgIGRlbGV0ZSByZWNvcmQuYXJnOwogICAgICAgICAgZW50cnkuY29tcGxldGlvbiA9IHJlY29yZDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gQ29udGV4dCh0cnlMb2NzTGlzdCkgewogICAgICAgICAgdGhpcy50cnlFbnRyaWVzID0gW3sgdHJ5TG9jOiAicm9vdCIgfV07CiAgICAgICAgICB0cnlMb2NzTGlzdC5mb3JFYWNoKHB1c2hUcnlFbnRyeSwgdGhpcyk7CiAgICAgICAgICB0aGlzLnJlc2V0KHRydWUpOwogICAgICAgIH0KICAgICAgICBleHBvcnRzMi5rZXlzID0gZnVuY3Rpb24ob2JqZWN0KSB7CiAgICAgICAgICB2YXIga2V5cyA9IFtdOwogICAgICAgICAgZm9yICh2YXIga2V5IGluIG9iamVjdCkgewogICAgICAgICAgICBrZXlzLnB1c2goa2V5KTsKICAgICAgICAgIH0KICAgICAgICAgIGtleXMucmV2ZXJzZSgpOwogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIG5leHQoKSB7CiAgICAgICAgICAgIHdoaWxlIChrZXlzLmxlbmd0aCkgewogICAgICAgICAgICAgIHZhciBrZXkyID0ga2V5cy5wb3AoKTsKICAgICAgICAgICAgICBpZiAoa2V5MiBpbiBvYmplY3QpIHsKICAgICAgICAgICAgICAgIG5leHQudmFsdWUgPSBrZXkyOwogICAgICAgICAgICAgICAgbmV4dC5kb25lID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV4dDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbmV4dC5kb25lID0gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIG5leHQ7CiAgICAgICAgICB9OwogICAgICAgIH07CiAgICAgICAgZnVuY3Rpb24gdmFsdWVzKGl0ZXJhYmxlKSB7CiAgICAgICAgICBpZiAoaXRlcmFibGUpIHsKICAgICAgICAgICAgdmFyIGl0ZXJhdG9yTWV0aG9kID0gaXRlcmFibGVbaXRlcmF0b3JTeW1ib2xdOwogICAgICAgICAgICBpZiAoaXRlcmF0b3JNZXRob2QpIHsKICAgICAgICAgICAgICByZXR1cm4gaXRlcmF0b3JNZXRob2QuY2FsbChpdGVyYWJsZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHR5cGVvZiBpdGVyYWJsZS5uZXh0ID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGl0ZXJhYmxlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghaXNOYU4oaXRlcmFibGUubGVuZ3RoKSkgewogICAgICAgICAgICAgIHZhciBpID0gLTEsIG5leHQgPSBmdW5jdGlvbiBuZXh0MigpIHsKICAgICAgICAgICAgICAgIHdoaWxlICgrK2kgPCBpdGVyYWJsZS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgaWYgKGhhc093bi5jYWxsKGl0ZXJhYmxlLCBpKSkgewogICAgICAgICAgICAgICAgICAgIG5leHQyLnZhbHVlID0gaXRlcmFibGVbaV07CiAgICAgICAgICAgICAgICAgICAgbmV4dDIuZG9uZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXh0MjsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbmV4dDIudmFsdWUgPSB1bmRlZmluZWQyOwogICAgICAgICAgICAgICAgbmV4dDIuZG9uZSA9IHRydWU7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV4dDI7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICByZXR1cm4gbmV4dC5uZXh0ID0gbmV4dDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHsgbmV4dDogZG9uZVJlc3VsdCB9OwogICAgICAgIH0KICAgICAgICBleHBvcnRzMi52YWx1ZXMgPSB2YWx1ZXM7CiAgICAgICAgZnVuY3Rpb24gZG9uZVJlc3VsdCgpIHsKICAgICAgICAgIHJldHVybiB7IHZhbHVlOiB1bmRlZmluZWQyLCBkb25lOiB0cnVlIH07CiAgICAgICAgfQogICAgICAgIENvbnRleHQucHJvdG90eXBlID0gewogICAgICAgICAgY29uc3RydWN0b3I6IENvbnRleHQsCiAgICAgICAgICByZXNldDogZnVuY3Rpb24oc2tpcFRlbXBSZXNldCkgewogICAgICAgICAgICB0aGlzLnByZXYgPSAwOwogICAgICAgICAgICB0aGlzLm5leHQgPSAwOwogICAgICAgICAgICB0aGlzLnNlbnQgPSB0aGlzLl9zZW50ID0gdW5kZWZpbmVkMjsKICAgICAgICAgICAgdGhpcy5kb25lID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuZGVsZWdhdGUgPSBudWxsOwogICAgICAgICAgICB0aGlzLm1ldGhvZCA9ICJuZXh0IjsKICAgICAgICAgICAgdGhpcy5hcmcgPSB1bmRlZmluZWQyOwogICAgICAgICAgICB0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChyZXNldFRyeUVudHJ5KTsKICAgICAgICAgICAgaWYgKCFza2lwVGVtcFJlc2V0KSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgbmFtZSBpbiB0aGlzKSB7CiAgICAgICAgICAgICAgICBpZiAobmFtZS5jaGFyQXQoMCkgPT09ICJ0IiAmJiBoYXNPd24uY2FsbCh0aGlzLCBuYW1lKSAmJiAhaXNOYU4oK25hbWUuc2xpY2UoMSkpKSB7CiAgICAgICAgICAgICAgICAgIHRoaXNbbmFtZV0gPSB1bmRlZmluZWQyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIHN0b3A6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB0aGlzLmRvbmUgPSB0cnVlOwogICAgICAgICAgICB2YXIgcm9vdEVudHJ5ID0gdGhpcy50cnlFbnRyaWVzWzBdOwogICAgICAgICAgICB2YXIgcm9vdFJlY29yZCA9IHJvb3RFbnRyeS5jb21wbGV0aW9uOwogICAgICAgICAgICBpZiAocm9vdFJlY29yZC50eXBlID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgICAgdGhyb3cgcm9vdFJlY29yZC5hcmc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMucnZhbDsKICAgICAgICAgIH0sCiAgICAgICAgICBkaXNwYXRjaEV4Y2VwdGlvbjogZnVuY3Rpb24oZXhjZXB0aW9uKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmRvbmUpIHsKICAgICAgICAgICAgICB0aHJvdyBleGNlcHRpb247CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzOwogICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGUobG9jLCBjYXVnaHQpIHsKICAgICAgICAgICAgICByZWNvcmQudHlwZSA9ICJ0aHJvdyI7CiAgICAgICAgICAgICAgcmVjb3JkLmFyZyA9IGV4Y2VwdGlvbjsKICAgICAgICAgICAgICBjb250ZXh0Lm5leHQgPSBsb2M7CiAgICAgICAgICAgICAgaWYgKGNhdWdodCkgewogICAgICAgICAgICAgICAgY29udGV4dC5tZXRob2QgPSAibmV4dCI7CiAgICAgICAgICAgICAgICBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZDI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiAhIWNhdWdodDsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldOwogICAgICAgICAgICAgIHZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uOwogICAgICAgICAgICAgIGlmIChlbnRyeS50cnlMb2MgPT09ICJyb290IikgewogICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZSgiZW5kIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChlbnRyeS50cnlMb2MgPD0gdGhpcy5wcmV2KSB7CiAgICAgICAgICAgICAgICB2YXIgaGFzQ2F0Y2ggPSBoYXNPd24uY2FsbChlbnRyeSwgImNhdGNoTG9jIik7CiAgICAgICAgICAgICAgICB2YXIgaGFzRmluYWxseSA9IGhhc093bi5jYWxsKGVudHJ5LCAiZmluYWxseUxvYyIpOwogICAgICAgICAgICAgICAgaWYgKGhhc0NhdGNoICYmIGhhc0ZpbmFsbHkpIHsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZShlbnRyeS5jYXRjaExvYywgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGFzQ2F0Y2gpIHsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZShlbnRyeS5jYXRjaExvYywgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGFzRmluYWxseSkgewogICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidHJ5IHN0YXRlbWVudCB3aXRob3V0IGNhdGNoIG9yIGZpbmFsbHkiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBhYnJ1cHQ6IGZ1bmN0aW9uKHR5cGUsIGFyZykgewogICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldOwogICAgICAgICAgICAgIGlmIChlbnRyeS50cnlMb2MgPD0gdGhpcy5wcmV2ICYmIGhhc093bi5jYWxsKGVudHJ5LCAiZmluYWxseUxvYyIpICYmIHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHsKICAgICAgICAgICAgICAgIHZhciBmaW5hbGx5RW50cnkgPSBlbnRyeTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZmluYWxseUVudHJ5ICYmICh0eXBlID09PSAiYnJlYWsiIHx8IHR5cGUgPT09ICJjb250aW51ZSIpICYmIGZpbmFsbHlFbnRyeS50cnlMb2MgPD0gYXJnICYmIGFyZyA8PSBmaW5hbGx5RW50cnkuZmluYWxseUxvYykgewogICAgICAgICAgICAgIGZpbmFsbHlFbnRyeSA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHJlY29yZCA9IGZpbmFsbHlFbnRyeSA/IGZpbmFsbHlFbnRyeS5jb21wbGV0aW9uIDoge307CiAgICAgICAgICAgIHJlY29yZC50eXBlID0gdHlwZTsKICAgICAgICAgICAgcmVjb3JkLmFyZyA9IGFyZzsKICAgICAgICAgICAgaWYgKGZpbmFsbHlFbnRyeSkgewogICAgICAgICAgICAgIHRoaXMubWV0aG9kID0gIm5leHQiOwogICAgICAgICAgICAgIHRoaXMubmV4dCA9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jOwogICAgICAgICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbXBsZXRlKHJlY29yZCk7CiAgICAgICAgICB9LAogICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKHJlY29yZCwgYWZ0ZXJMb2MpIHsKICAgICAgICAgICAgaWYgKHJlY29yZC50eXBlID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgICAgdGhyb3cgcmVjb3JkLmFyZzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocmVjb3JkLnR5cGUgPT09ICJicmVhayIgfHwgcmVjb3JkLnR5cGUgPT09ICJjb250aW51ZSIpIHsKICAgICAgICAgICAgICB0aGlzLm5leHQgPSByZWNvcmQuYXJnOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlY29yZC50eXBlID09PSAicmV0dXJuIikgewogICAgICAgICAgICAgIHRoaXMucnZhbCA9IHRoaXMuYXJnID0gcmVjb3JkLmFyZzsKICAgICAgICAgICAgICB0aGlzLm1ldGhvZCA9ICJyZXR1cm4iOwogICAgICAgICAgICAgIHRoaXMubmV4dCA9ICJlbmQiOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlY29yZC50eXBlID09PSAibm9ybWFsIiAmJiBhZnRlckxvYykgewogICAgICAgICAgICAgIHRoaXMubmV4dCA9IGFmdGVyTG9jOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsOwogICAgICAgICAgfSwKICAgICAgICAgIGZpbmlzaDogZnVuY3Rpb24oZmluYWxseUxvYykgewogICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldOwogICAgICAgICAgICAgIGlmIChlbnRyeS5maW5hbGx5TG9jID09PSBmaW5hbGx5TG9jKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRlKGVudHJ5LmNvbXBsZXRpb24sIGVudHJ5LmFmdGVyTG9jKTsKICAgICAgICAgICAgICAgIHJlc2V0VHJ5RW50cnkoZW50cnkpOwogICAgICAgICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgImNhdGNoIjogZnVuY3Rpb24odHJ5TG9jKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKICAgICAgICAgICAgICB2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07CiAgICAgICAgICAgICAgaWYgKGVudHJ5LnRyeUxvYyA9PT0gdHJ5TG9jKSB7CiAgICAgICAgICAgICAgICB2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbjsKICAgICAgICAgICAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gInRocm93IikgewogICAgICAgICAgICAgICAgICB2YXIgdGhyb3duID0gcmVjb3JkLmFyZzsKICAgICAgICAgICAgICAgICAgcmVzZXRUcnlFbnRyeShlbnRyeSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdGhyb3duOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImlsbGVnYWwgY2F0Y2ggYXR0ZW1wdCIpOwogICAgICAgICAgfSwKICAgICAgICAgIGRlbGVnYXRlWWllbGQ6IGZ1bmN0aW9uKGl0ZXJhYmxlLCByZXN1bHROYW1lLCBuZXh0TG9jKSB7CiAgICAgICAgICAgIHRoaXMuZGVsZWdhdGUgPSB7CiAgICAgICAgICAgICAgaXRlcmF0b3I6IHZhbHVlcyhpdGVyYWJsZSksCiAgICAgICAgICAgICAgcmVzdWx0TmFtZSwKICAgICAgICAgICAgICBuZXh0TG9jCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmICh0aGlzLm1ldGhvZCA9PT0gIm5leHQiKSB7CiAgICAgICAgICAgICAgdGhpcy5hcmcgPSB1bmRlZmluZWQyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgcmV0dXJuIGV4cG9ydHMyOwogICAgICB9KHR5cGVvZiBtb2R1bGUgPT09ICJvYmplY3QiID8gbW9kdWxlLmV4cG9ydHMgOiB7fSk7CiAgICAgIHRyeSB7CiAgICAgICAgcmVnZW5lcmF0b3JSdW50aW1lID0gcnVudGltZTsKICAgICAgfSBjYXRjaCAoYWNjaWRlbnRhbFN0cmljdE1vZGUpIHsKICAgICAgICBpZiAodHlwZW9mIGdsb2JhbFRoaXMgPT09ICJvYmplY3QiKSB7CiAgICAgICAgICBnbG9iYWxUaGlzLnJlZ2VuZXJhdG9yUnVudGltZSA9IHJ1bnRpbWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIEZ1bmN0aW9uKCJyIiwgInJlZ2VuZXJhdG9yUnVudGltZSA9IHIiKShydW50aW1lKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvcmVnZW5lcmF0b3IvaW5kZXguanMKICB2YXIgcmVxdWlyZV9yZWdlbmVyYXRvciA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL3JlZ2VuZXJhdG9yL2luZGV4LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmVfcnVudGltZSgpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9pdGVyYXRlLmpzCiAgdmFyIHJlcXVpcmVfaXRlcmF0ZSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2l0ZXJhdGUuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBhbk9iamVjdCA9IHJlcXVpcmVfYW5fb2JqZWN0KCk7CiAgICAgIHZhciBpc0FycmF5SXRlcmF0b3JNZXRob2QgPSByZXF1aXJlX2lzX2FycmF5X2l0ZXJhdG9yX21ldGhvZCgpOwogICAgICB2YXIgdG9MZW5ndGggPSByZXF1aXJlX3RvX2xlbmd0aCgpOwogICAgICB2YXIgYmluZCA9IHJlcXVpcmVfZnVuY3Rpb25fYmluZF9jb250ZXh0KCk7CiAgICAgIHZhciBnZXRJdGVyYXRvciA9IHJlcXVpcmVfZ2V0X2l0ZXJhdG9yKCk7CiAgICAgIHZhciBnZXRJdGVyYXRvck1ldGhvZCA9IHJlcXVpcmVfZ2V0X2l0ZXJhdG9yX21ldGhvZCgpOwogICAgICB2YXIgaXRlcmF0b3JDbG9zZSA9IHJlcXVpcmVfaXRlcmF0b3JfY2xvc2UoKTsKICAgICAgdmFyIFJlc3VsdCA9IGZ1bmN0aW9uKHN0b3BwZWQsIHJlc3VsdCkgewogICAgICAgIHRoaXMuc3RvcHBlZCA9IHN0b3BwZWQ7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgIH07CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXRlcmFibGUsIHVuYm91bmRGdW5jdGlvbiwgb3B0aW9ucykgewogICAgICAgIHZhciB0aGF0ID0gb3B0aW9ucyAmJiBvcHRpb25zLnRoYXQ7CiAgICAgICAgdmFyIEFTX0VOVFJJRVMgPSAhIShvcHRpb25zICYmIG9wdGlvbnMuQVNfRU5UUklFUyk7CiAgICAgICAgdmFyIElTX0lURVJBVE9SID0gISEob3B0aW9ucyAmJiBvcHRpb25zLklTX0lURVJBVE9SKTsKICAgICAgICB2YXIgSU5URVJSVVBURUQgPSAhIShvcHRpb25zICYmIG9wdGlvbnMuSU5URVJSVVBURUQpOwogICAgICAgIHZhciBmbiA9IGJpbmQodW5ib3VuZEZ1bmN0aW9uLCB0aGF0LCAxICsgQVNfRU5UUklFUyArIElOVEVSUlVQVEVEKTsKICAgICAgICB2YXIgaXRlcmF0b3IsIGl0ZXJGbiwgaW5kZXgsIGxlbmd0aCwgcmVzdWx0LCBuZXh0LCBzdGVwOwogICAgICAgIHZhciBzdG9wID0gZnVuY3Rpb24oY29uZGl0aW9uKSB7CiAgICAgICAgICBpZiAoaXRlcmF0b3IpCiAgICAgICAgICAgIGl0ZXJhdG9yQ2xvc2UoaXRlcmF0b3IsICJub3JtYWwiLCBjb25kaXRpb24pOwogICAgICAgICAgcmV0dXJuIG5ldyBSZXN1bHQodHJ1ZSwgY29uZGl0aW9uKTsKICAgICAgICB9OwogICAgICAgIHZhciBjYWxsRm4gPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgaWYgKEFTX0VOVFJJRVMpIHsKICAgICAgICAgICAgYW5PYmplY3QodmFsdWUpOwogICAgICAgICAgICByZXR1cm4gSU5URVJSVVBURUQgPyBmbih2YWx1ZVswXSwgdmFsdWVbMV0sIHN0b3ApIDogZm4odmFsdWVbMF0sIHZhbHVlWzFdKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBJTlRFUlJVUFRFRCA/IGZuKHZhbHVlLCBzdG9wKSA6IGZuKHZhbHVlKTsKICAgICAgICB9OwogICAgICAgIGlmIChJU19JVEVSQVRPUikgewogICAgICAgICAgaXRlcmF0b3IgPSBpdGVyYWJsZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaXRlckZuID0gZ2V0SXRlcmF0b3JNZXRob2QoaXRlcmFibGUpOwogICAgICAgICAgaWYgKCFpdGVyRm4pCiAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihTdHJpbmcoaXRlcmFibGUpICsgIiBpcyBub3QgaXRlcmFibGUiKTsKICAgICAgICAgIGlmIChpc0FycmF5SXRlcmF0b3JNZXRob2QoaXRlckZuKSkgewogICAgICAgICAgICBmb3IgKGluZGV4ID0gMCwgbGVuZ3RoID0gdG9MZW5ndGgoaXRlcmFibGUubGVuZ3RoKTsgbGVuZ3RoID4gaW5kZXg7IGluZGV4KyspIHsKICAgICAgICAgICAgICByZXN1bHQgPSBjYWxsRm4oaXRlcmFibGVbaW5kZXhdKTsKICAgICAgICAgICAgICBpZiAocmVzdWx0ICYmIHJlc3VsdCBpbnN0YW5jZW9mIFJlc3VsdCkKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXN1bHQoZmFsc2UpOwogICAgICAgICAgfQogICAgICAgICAgaXRlcmF0b3IgPSBnZXRJdGVyYXRvcihpdGVyYWJsZSwgaXRlckZuKTsKICAgICAgICB9CiAgICAgICAgbmV4dCA9IGl0ZXJhdG9yLm5leHQ7CiAgICAgICAgd2hpbGUgKCEoc3RlcCA9IG5leHQuY2FsbChpdGVyYXRvcikpLmRvbmUpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJlc3VsdCA9IGNhbGxGbihzdGVwLnZhbHVlKTsKICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGl0ZXJhdG9yQ2xvc2UoaXRlcmF0b3IsICJ0aHJvdyIsIGVycm9yKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0eXBlb2YgcmVzdWx0ID09ICJvYmplY3QiICYmIHJlc3VsdCAmJiByZXN1bHQgaW5zdGFuY2VvZiBSZXN1bHQpCiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgUmVzdWx0KGZhbHNlKTsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLmFnZ3JlZ2F0ZS1lcnJvci5qcwogIHZhciByZXF1aXJlX2VzX2FnZ3JlZ2F0ZV9lcnJvciA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5hZ2dyZWdhdGUtZXJyb3IuanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyICQgPSByZXF1aXJlX2V4cG9ydCgpOwogICAgICB2YXIgZ2V0UHJvdG90eXBlT2YgPSByZXF1aXJlX29iamVjdF9nZXRfcHJvdG90eXBlX29mKCk7CiAgICAgIHZhciBzZXRQcm90b3R5cGVPZiA9IHJlcXVpcmVfb2JqZWN0X3NldF9wcm90b3R5cGVfb2YoKTsKICAgICAgdmFyIGNyZWF0ZSA9IHJlcXVpcmVfb2JqZWN0X2NyZWF0ZSgpOwogICAgICB2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5ID0gcmVxdWlyZV9jcmVhdGVfbm9uX2VudW1lcmFibGVfcHJvcGVydHkoKTsKICAgICAgdmFyIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvciA9IHJlcXVpcmVfY3JlYXRlX3Byb3BlcnR5X2Rlc2NyaXB0b3IoKTsKICAgICAgdmFyIGl0ZXJhdGUgPSByZXF1aXJlX2l0ZXJhdGUoKTsKICAgICAgdmFyIHRvU3RyaW5nID0gcmVxdWlyZV90b19zdHJpbmcoKTsKICAgICAgdmFyICRBZ2dyZWdhdGVFcnJvciA9IGZ1bmN0aW9uIEFnZ3JlZ2F0ZUVycm9yKGVycm9ycywgbWVzc2FnZSkgewogICAgICAgIHZhciB0aGF0ID0gdGhpczsKICAgICAgICBpZiAoISh0aGF0IGluc3RhbmNlb2YgJEFnZ3JlZ2F0ZUVycm9yKSkKICAgICAgICAgIHJldHVybiBuZXcgJEFnZ3JlZ2F0ZUVycm9yKGVycm9ycywgbWVzc2FnZSk7CiAgICAgICAgaWYgKHNldFByb3RvdHlwZU9mKSB7CiAgICAgICAgICB0aGF0ID0gc2V0UHJvdG90eXBlT2YobmV3IEVycm9yKHZvaWQgMCksIGdldFByb3RvdHlwZU9mKHRoYXQpKTsKICAgICAgICB9CiAgICAgICAgaWYgKG1lc3NhZ2UgIT09IHZvaWQgMCkKICAgICAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSh0aGF0LCAibWVzc2FnZSIsIHRvU3RyaW5nKG1lc3NhZ2UpKTsKICAgICAgICB2YXIgZXJyb3JzQXJyYXkgPSBbXTsKICAgICAgICBpdGVyYXRlKGVycm9ycywgZXJyb3JzQXJyYXkucHVzaCwgeyB0aGF0OiBlcnJvcnNBcnJheSB9KTsKICAgICAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkodGhhdCwgImVycm9ycyIsIGVycm9yc0FycmF5KTsKICAgICAgICByZXR1cm4gdGhhdDsKICAgICAgfTsKICAgICAgJEFnZ3JlZ2F0ZUVycm9yLnByb3RvdHlwZSA9IGNyZWF0ZShFcnJvci5wcm90b3R5cGUsIHsKICAgICAgICBjb25zdHJ1Y3RvcjogY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yKDUsICRBZ2dyZWdhdGVFcnJvciksCiAgICAgICAgbWVzc2FnZTogY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yKDUsICIiKSwKICAgICAgICBuYW1lOiBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IoNSwgIkFnZ3JlZ2F0ZUVycm9yIikKICAgICAgfSk7CiAgICAgICQoeyBnbG9iYWw6IHRydWUgfSwgewogICAgICAgIEFnZ3JlZ2F0ZUVycm9yOiAkQWdncmVnYXRlRXJyb3IKICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL25hdGl2ZS1wcm9taXNlLWNvbnN0cnVjdG9yLmpzCiAgdmFyIHJlcXVpcmVfbmF0aXZlX3Byb21pc2VfY29uc3RydWN0b3IgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9uYXRpdmUtcHJvbWlzZS1jb25zdHJ1Y3Rvci5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGdsb2JhbDIgPSByZXF1aXJlX2dsb2JhbCgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGdsb2JhbDIuUHJvbWlzZTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvcmVkZWZpbmUtYWxsLmpzCiAgdmFyIHJlcXVpcmVfcmVkZWZpbmVfYWxsID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvcmVkZWZpbmUtYWxsLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgcmVkZWZpbmUgPSByZXF1aXJlX3JlZGVmaW5lKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24odGFyZ2V0LCBzcmMsIG9wdGlvbnMpIHsKICAgICAgICBmb3IgKHZhciBrZXkgaW4gc3JjKSB7CiAgICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnVuc2FmZSAmJiB0YXJnZXRba2V5XSkKICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSBzcmNba2V5XTsKICAgICAgICAgIGVsc2UKICAgICAgICAgICAgcmVkZWZpbmUodGFyZ2V0LCBrZXksIHNyY1trZXldLCBvcHRpb25zKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRhcmdldDsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvc2V0LXNwZWNpZXMuanMKICB2YXIgcmVxdWlyZV9zZXRfc3BlY2llcyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL3NldC1zcGVjaWVzLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBnZXRCdWlsdEluID0gcmVxdWlyZV9nZXRfYnVpbHRfaW4oKTsKICAgICAgdmFyIGRlZmluZVByb3BlcnR5TW9kdWxlID0gcmVxdWlyZV9vYmplY3RfZGVmaW5lX3Byb3BlcnR5KCk7CiAgICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSByZXF1aXJlX3dlbGxfa25vd25fc3ltYm9sKCk7CiAgICAgIHZhciBERVNDUklQVE9SUyA9IHJlcXVpcmVfZGVzY3JpcHRvcnMoKTsKICAgICAgdmFyIFNQRUNJRVMgPSB3ZWxsS25vd25TeW1ib2woInNwZWNpZXMiKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihDT05TVFJVQ1RPUl9OQU1FKSB7CiAgICAgICAgdmFyIENvbnN0cnVjdG9yID0gZ2V0QnVpbHRJbihDT05TVFJVQ1RPUl9OQU1FKTsKICAgICAgICB2YXIgZGVmaW5lUHJvcGVydHkgPSBkZWZpbmVQcm9wZXJ0eU1vZHVsZS5mOwogICAgICAgIGlmIChERVNDUklQVE9SUyAmJiBDb25zdHJ1Y3RvciAmJiAhQ29uc3RydWN0b3JbU1BFQ0lFU10pIHsKICAgICAgICAgIGRlZmluZVByb3BlcnR5KENvbnN0cnVjdG9yLCBTUEVDSUVTLCB7CiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9hbi1pbnN0YW5jZS5qcwogIHZhciByZXF1aXJlX2FuX2luc3RhbmNlID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvYW4taW5zdGFuY2UuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQsIENvbnN0cnVjdG9yLCBuYW1lKSB7CiAgICAgICAgaWYgKGl0IGluc3RhbmNlb2YgQ29uc3RydWN0b3IpCiAgICAgICAgICByZXR1cm4gaXQ7CiAgICAgICAgdGhyb3cgVHlwZUVycm9yKCJJbmNvcnJlY3QgIiArIChuYW1lID8gbmFtZSArICIgIiA6ICIiKSArICJpbnZvY2F0aW9uIik7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL3NwZWNpZXMtY29uc3RydWN0b3IuanMKICB2YXIgcmVxdWlyZV9zcGVjaWVzX2NvbnN0cnVjdG9yID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvc3BlY2llcy1jb25zdHJ1Y3Rvci5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGFuT2JqZWN0ID0gcmVxdWlyZV9hbl9vYmplY3QoKTsKICAgICAgdmFyIGFDb25zdHJ1Y3RvciA9IHJlcXVpcmVfYV9jb25zdHJ1Y3RvcigpOwogICAgICB2YXIgd2VsbEtub3duU3ltYm9sID0gcmVxdWlyZV93ZWxsX2tub3duX3N5bWJvbCgpOwogICAgICB2YXIgU1BFQ0lFUyA9IHdlbGxLbm93blN5bWJvbCgic3BlY2llcyIpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKE8sIGRlZmF1bHRDb25zdHJ1Y3RvcikgewogICAgICAgIHZhciBDID0gYW5PYmplY3QoTykuY29uc3RydWN0b3I7CiAgICAgICAgdmFyIFM7CiAgICAgICAgcmV0dXJuIEMgPT09IHZvaWQgMCB8fCAoUyA9IGFuT2JqZWN0KEMpW1NQRUNJRVNdKSA9PSB2b2lkIDAgPyBkZWZhdWx0Q29uc3RydWN0b3IgOiBhQ29uc3RydWN0b3IoUyk7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2VuZ2luZS1pcy1pb3MuanMKICB2YXIgcmVxdWlyZV9lbmdpbmVfaXNfaW9zID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZW5naW5lLWlzLWlvcy5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHVzZXJBZ2VudCA9IHJlcXVpcmVfZW5naW5lX3VzZXJfYWdlbnQoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSAvKD86aXBhZHxpcGhvbmV8aXBvZCkuKmFwcGxld2Via2l0L2kudGVzdCh1c2VyQWdlbnQpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9lbmdpbmUtaXMtbm9kZS5qcwogIHZhciByZXF1aXJlX2VuZ2luZV9pc19ub2RlID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZW5naW5lLWlzLW5vZGUuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBjbGFzc29mID0gcmVxdWlyZV9jbGFzc29mX3JhdygpOwogICAgICB2YXIgZ2xvYmFsMiA9IHJlcXVpcmVfZ2xvYmFsKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gY2xhc3NvZihnbG9iYWwyLnByb2Nlc3MpID09ICJwcm9jZXNzIjsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvdGFzay5qcwogIHZhciByZXF1aXJlX3Rhc2sgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy90YXNrLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgZ2xvYmFsMiA9IHJlcXVpcmVfZ2xvYmFsKCk7CiAgICAgIHZhciBpc0NhbGxhYmxlID0gcmVxdWlyZV9pc19jYWxsYWJsZSgpOwogICAgICB2YXIgZmFpbHMgPSByZXF1aXJlX2ZhaWxzKCk7CiAgICAgIHZhciBiaW5kID0gcmVxdWlyZV9mdW5jdGlvbl9iaW5kX2NvbnRleHQoKTsKICAgICAgdmFyIGh0bWwgPSByZXF1aXJlX2h0bWwoKTsKICAgICAgdmFyIGNyZWF0ZUVsZW1lbnQgPSByZXF1aXJlX2RvY3VtZW50X2NyZWF0ZV9lbGVtZW50KCk7CiAgICAgIHZhciBJU19JT1MgPSByZXF1aXJlX2VuZ2luZV9pc19pb3MoKTsKICAgICAgdmFyIElTX05PREUgPSByZXF1aXJlX2VuZ2luZV9pc19ub2RlKCk7CiAgICAgIHZhciBzZXQzID0gZ2xvYmFsMi5zZXRJbW1lZGlhdGU7CiAgICAgIHZhciBjbGVhciA9IGdsb2JhbDIuY2xlYXJJbW1lZGlhdGU7CiAgICAgIHZhciBwcm9jZXNzMiA9IGdsb2JhbDIucHJvY2VzczsKICAgICAgdmFyIE1lc3NhZ2VDaGFubmVsID0gZ2xvYmFsMi5NZXNzYWdlQ2hhbm5lbDsKICAgICAgdmFyIERpc3BhdGNoMiA9IGdsb2JhbDIuRGlzcGF0Y2g7CiAgICAgIHZhciBjb3VudGVyID0gMDsKICAgICAgdmFyIHF1ZXVlID0ge307CiAgICAgIHZhciBPTlJFQURZU1RBVEVDSEFOR0UgPSAib25yZWFkeXN0YXRlY2hhbmdlIjsKICAgICAgdmFyIGxvY2F0aW9uOwogICAgICB2YXIgZGVmZXI7CiAgICAgIHZhciBjaGFubmVsOwogICAgICB2YXIgcG9ydDsKICAgICAgdHJ5IHsKICAgICAgICBsb2NhdGlvbiA9IGdsb2JhbDIubG9jYXRpb247CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIH0KICAgICAgdmFyIHJ1biA9IGZ1bmN0aW9uKGlkKSB7CiAgICAgICAgaWYgKHF1ZXVlLmhhc093blByb3BlcnR5KGlkKSkgewogICAgICAgICAgdmFyIGZuID0gcXVldWVbaWRdOwogICAgICAgICAgZGVsZXRlIHF1ZXVlW2lkXTsKICAgICAgICAgIGZuKCk7CiAgICAgICAgfQogICAgICB9OwogICAgICB2YXIgcnVubmVyID0gZnVuY3Rpb24oaWQpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICBydW4oaWQpOwogICAgICAgIH07CiAgICAgIH07CiAgICAgIHZhciBsaXN0ZW5lciA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgcnVuKGV2ZW50LmRhdGEpOwogICAgICB9OwogICAgICB2YXIgcG9zdCA9IGZ1bmN0aW9uKGlkKSB7CiAgICAgICAgZ2xvYmFsMi5wb3N0TWVzc2FnZShTdHJpbmcoaWQpLCBsb2NhdGlvbi5wcm90b2NvbCArICIvLyIgKyBsb2NhdGlvbi5ob3N0KTsKICAgICAgfTsKICAgICAgaWYgKCFzZXQzIHx8ICFjbGVhcikgewogICAgICAgIHNldDMgPSBmdW5jdGlvbiBzZXRJbW1lZGlhdGUoZm4pIHsKICAgICAgICAgIHZhciBhcmdzID0gW107CiAgICAgICAgICB2YXIgYXJndW1lbnRzTGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsKICAgICAgICAgIHZhciBpID0gMTsKICAgICAgICAgIHdoaWxlIChhcmd1bWVudHNMZW5ndGggPiBpKQogICAgICAgICAgICBhcmdzLnB1c2goYXJndW1lbnRzW2krK10pOwogICAgICAgICAgcXVldWVbKytjb3VudGVyXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAoaXNDYWxsYWJsZShmbikgPyBmbiA6IEZ1bmN0aW9uKGZuKSkuYXBwbHkodm9pZCAwLCBhcmdzKTsKICAgICAgICAgIH07CiAgICAgICAgICBkZWZlcihjb3VudGVyKTsKICAgICAgICAgIHJldHVybiBjb3VudGVyOwogICAgICAgIH07CiAgICAgICAgY2xlYXIgPSBmdW5jdGlvbiBjbGVhckltbWVkaWF0ZShpZCkgewogICAgICAgICAgZGVsZXRlIHF1ZXVlW2lkXTsKICAgICAgICB9OwogICAgICAgIGlmIChJU19OT0RFKSB7CiAgICAgICAgICBkZWZlciA9IGZ1bmN0aW9uKGlkKSB7CiAgICAgICAgICAgIHByb2Nlc3MyLm5leHRUaWNrKHJ1bm5lcihpZCkpOwogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgaWYgKERpc3BhdGNoMiAmJiBEaXNwYXRjaDIubm93KSB7CiAgICAgICAgICBkZWZlciA9IGZ1bmN0aW9uKGlkKSB7CiAgICAgICAgICAgIERpc3BhdGNoMi5ub3cocnVubmVyKGlkKSk7CiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSBpZiAoTWVzc2FnZUNoYW5uZWwgJiYgIUlTX0lPUykgewogICAgICAgICAgY2hhbm5lbCA9IG5ldyBNZXNzYWdlQ2hhbm5lbCgpOwogICAgICAgICAgcG9ydCA9IGNoYW5uZWwucG9ydDI7CiAgICAgICAgICBjaGFubmVsLnBvcnQxLm9ubWVzc2FnZSA9IGxpc3RlbmVyOwogICAgICAgICAgZGVmZXIgPSBiaW5kKHBvcnQucG9zdE1lc3NhZ2UsIHBvcnQsIDEpOwogICAgICAgIH0gZWxzZSBpZiAoZ2xvYmFsMi5hZGRFdmVudExpc3RlbmVyICYmIGlzQ2FsbGFibGUoZ2xvYmFsMi5wb3N0TWVzc2FnZSkgJiYgIWdsb2JhbDIuaW1wb3J0U2NyaXB0cyAmJiBsb2NhdGlvbiAmJiBsb2NhdGlvbi5wcm90b2NvbCAhPT0gImZpbGU6IiAmJiAhZmFpbHMocG9zdCkpIHsKICAgICAgICAgIGRlZmVyID0gcG9zdDsKICAgICAgICAgIGdsb2JhbDIuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsIGxpc3RlbmVyLCBmYWxzZSk7CiAgICAgICAgfSBlbHNlIGlmIChPTlJFQURZU1RBVEVDSEFOR0UgaW4gY3JlYXRlRWxlbWVudCgic2NyaXB0IikpIHsKICAgICAgICAgIGRlZmVyID0gZnVuY3Rpb24oaWQpIHsKICAgICAgICAgICAgaHRtbC5hcHBlbmRDaGlsZChjcmVhdGVFbGVtZW50KCJzY3JpcHQiKSlbT05SRUFEWVNUQVRFQ0hBTkdFXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIGh0bWwucmVtb3ZlQ2hpbGQodGhpcyk7CiAgICAgICAgICAgICAgcnVuKGlkKTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRlZmVyID0gZnVuY3Rpb24oaWQpIHsKICAgICAgICAgICAgc2V0VGltZW91dChydW5uZXIoaWQpLCAwKTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9CiAgICAgIG1vZHVsZS5leHBvcnRzID0gewogICAgICAgIHNldDogc2V0MywKICAgICAgICBjbGVhcgogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9lbmdpbmUtaXMtaW9zLXBlYmJsZS5qcwogIHZhciByZXF1aXJlX2VuZ2luZV9pc19pb3NfcGViYmxlID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZW5naW5lLWlzLWlvcy1wZWJibGUuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciB1c2VyQWdlbnQgPSByZXF1aXJlX2VuZ2luZV91c2VyX2FnZW50KCk7CiAgICAgIHZhciBnbG9iYWwyID0gcmVxdWlyZV9nbG9iYWwoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSAvaXBhZHxpcGhvbmV8aXBvZC9pLnRlc3QodXNlckFnZW50KSAmJiBnbG9iYWwyLlBlYmJsZSAhPT0gdm9pZCAwOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9lbmdpbmUtaXMtd2Vib3Mtd2Via2l0LmpzCiAgdmFyIHJlcXVpcmVfZW5naW5lX2lzX3dlYm9zX3dlYmtpdCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2VuZ2luZS1pcy13ZWJvcy13ZWJraXQuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciB1c2VyQWdlbnQgPSByZXF1aXJlX2VuZ2luZV91c2VyX2FnZW50KCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gL3dlYjBzKD8hLipjaHJvbWUpL2kudGVzdCh1c2VyQWdlbnQpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9taWNyb3Rhc2suanMKICB2YXIgcmVxdWlyZV9taWNyb3Rhc2sgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9taWNyb3Rhc2suanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBnbG9iYWwyID0gcmVxdWlyZV9nbG9iYWwoKTsKICAgICAgdmFyIGdldE93blByb3BlcnR5RGVzY3JpcHRvciA9IHJlcXVpcmVfb2JqZWN0X2dldF9vd25fcHJvcGVydHlfZGVzY3JpcHRvcigpLmY7CiAgICAgIHZhciBtYWNyb3Rhc2sgPSByZXF1aXJlX3Rhc2soKS5zZXQ7CiAgICAgIHZhciBJU19JT1MgPSByZXF1aXJlX2VuZ2luZV9pc19pb3MoKTsKICAgICAgdmFyIElTX0lPU19QRUJCTEUgPSByZXF1aXJlX2VuZ2luZV9pc19pb3NfcGViYmxlKCk7CiAgICAgIHZhciBJU19XRUJPU19XRUJLSVQgPSByZXF1aXJlX2VuZ2luZV9pc193ZWJvc193ZWJraXQoKTsKICAgICAgdmFyIElTX05PREUgPSByZXF1aXJlX2VuZ2luZV9pc19ub2RlKCk7CiAgICAgIHZhciBNdXRhdGlvbk9ic2VydmVyID0gZ2xvYmFsMi5NdXRhdGlvbk9ic2VydmVyIHx8IGdsb2JhbDIuV2ViS2l0TXV0YXRpb25PYnNlcnZlcjsKICAgICAgdmFyIGRvY3VtZW50MiA9IGdsb2JhbDIuZG9jdW1lbnQ7CiAgICAgIHZhciBwcm9jZXNzMiA9IGdsb2JhbDIucHJvY2VzczsKICAgICAgdmFyIFByb21pc2UyID0gZ2xvYmFsMi5Qcm9taXNlOwogICAgICB2YXIgcXVldWVNaWNyb3Rhc2tEZXNjcmlwdG9yID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGdsb2JhbDIsICJxdWV1ZU1pY3JvdGFzayIpOwogICAgICB2YXIgcXVldWVNaWNyb3Rhc2sgPSBxdWV1ZU1pY3JvdGFza0Rlc2NyaXB0b3IgJiYgcXVldWVNaWNyb3Rhc2tEZXNjcmlwdG9yLnZhbHVlOwogICAgICB2YXIgZmx1c2g7CiAgICAgIHZhciBoZWFkOwogICAgICB2YXIgbGFzdDsKICAgICAgdmFyIG5vdGlmeTsKICAgICAgdmFyIHRvZ2dsZTsKICAgICAgdmFyIG5vZGU7CiAgICAgIHZhciBwcm9taXNlOwogICAgICB2YXIgdGhlbjsKICAgICAgaWYgKCFxdWV1ZU1pY3JvdGFzaykgewogICAgICAgIGZsdXNoID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgcGFyZW50LCBmbjsKICAgICAgICAgIGlmIChJU19OT0RFICYmIChwYXJlbnQgPSBwcm9jZXNzMi5kb21haW4pKQogICAgICAgICAgICBwYXJlbnQuZXhpdCgpOwogICAgICAgICAgd2hpbGUgKGhlYWQpIHsKICAgICAgICAgICAgZm4gPSBoZWFkLmZuOwogICAgICAgICAgICBoZWFkID0gaGVhZC5uZXh0OwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZuKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgaWYgKGhlYWQpCiAgICAgICAgICAgICAgICBub3RpZnkoKTsKICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBsYXN0ID0gdm9pZCAwOwogICAgICAgICAgICAgIHRocm93IGVycm9yOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBsYXN0ID0gdm9pZCAwOwogICAgICAgICAgaWYgKHBhcmVudCkKICAgICAgICAgICAgcGFyZW50LmVudGVyKCk7CiAgICAgICAgfTsKICAgICAgICBpZiAoIUlTX0lPUyAmJiAhSVNfTk9ERSAmJiAhSVNfV0VCT1NfV0VCS0lUICYmIE11dGF0aW9uT2JzZXJ2ZXIgJiYgZG9jdW1lbnQyKSB7CiAgICAgICAgICB0b2dnbGUgPSB0cnVlOwogICAgICAgICAgbm9kZSA9IGRvY3VtZW50Mi5jcmVhdGVUZXh0Tm9kZSgiIik7CiAgICAgICAgICBuZXcgTXV0YXRpb25PYnNlcnZlcihmbHVzaCkub2JzZXJ2ZShub2RlLCB7IGNoYXJhY3RlckRhdGE6IHRydWUgfSk7CiAgICAgICAgICBub3RpZnkgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgbm9kZS5kYXRhID0gdG9nZ2xlID0gIXRvZ2dsZTsKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIGlmICghSVNfSU9TX1BFQkJMRSAmJiBQcm9taXNlMiAmJiBQcm9taXNlMi5yZXNvbHZlKSB7CiAgICAgICAgICBwcm9taXNlID0gUHJvbWlzZTIucmVzb2x2ZSh2b2lkIDApOwogICAgICAgICAgcHJvbWlzZS5jb25zdHJ1Y3RvciA9IFByb21pc2UyOwogICAgICAgICAgdGhlbiA9IHByb21pc2UudGhlbjsKICAgICAgICAgIG5vdGlmeSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB0aGVuLmNhbGwocHJvbWlzZSwgZmx1c2gpOwogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgaWYgKElTX05PREUpIHsKICAgICAgICAgIG5vdGlmeSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBwcm9jZXNzMi5uZXh0VGljayhmbHVzaCk7CiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBub3RpZnkgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgbWFjcm90YXNrLmNhbGwoZ2xvYmFsMiwgZmx1c2gpOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0KICAgICAgbW9kdWxlLmV4cG9ydHMgPSBxdWV1ZU1pY3JvdGFzayB8fCBmdW5jdGlvbihmbikgewogICAgICAgIHZhciB0YXNrID0geyBmbiwgbmV4dDogdm9pZCAwIH07CiAgICAgICAgaWYgKGxhc3QpCiAgICAgICAgICBsYXN0Lm5leHQgPSB0YXNrOwogICAgICAgIGlmICghaGVhZCkgewogICAgICAgICAgaGVhZCA9IHRhc2s7CiAgICAgICAgICBub3RpZnkoKTsKICAgICAgICB9CiAgICAgICAgbGFzdCA9IHRhc2s7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL25ldy1wcm9taXNlLWNhcGFiaWxpdHkuanMKICB2YXIgcmVxdWlyZV9uZXdfcHJvbWlzZV9jYXBhYmlsaXR5ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvbmV3LXByb21pc2UtY2FwYWJpbGl0eS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgYUNhbGxhYmxlID0gcmVxdWlyZV9hX2NhbGxhYmxlKCk7CiAgICAgIHZhciBQcm9taXNlQ2FwYWJpbGl0eSA9IGZ1bmN0aW9uKEMpIHsKICAgICAgICB2YXIgcmVzb2x2ZSwgcmVqZWN0OwogICAgICAgIHRoaXMucHJvbWlzZSA9IG5ldyBDKGZ1bmN0aW9uKCQkcmVzb2x2ZSwgJCRyZWplY3QpIHsKICAgICAgICAgIGlmIChyZXNvbHZlICE9PSB2b2lkIDAgfHwgcmVqZWN0ICE9PSB2b2lkIDApCiAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcigiQmFkIFByb21pc2UgY29uc3RydWN0b3IiKTsKICAgICAgICAgIHJlc29sdmUgPSAkJHJlc29sdmU7CiAgICAgICAgICByZWplY3QgPSAkJHJlamVjdDsKICAgICAgICB9KTsKICAgICAgICB0aGlzLnJlc29sdmUgPSBhQ2FsbGFibGUocmVzb2x2ZSk7CiAgICAgICAgdGhpcy5yZWplY3QgPSBhQ2FsbGFibGUocmVqZWN0KTsKICAgICAgfTsKICAgICAgbW9kdWxlLmV4cG9ydHMuZiA9IGZ1bmN0aW9uKEMpIHsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2VDYXBhYmlsaXR5KEMpOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9wcm9taXNlLXJlc29sdmUuanMKICB2YXIgcmVxdWlyZV9wcm9taXNlX3Jlc29sdmUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9wcm9taXNlLXJlc29sdmUuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBhbk9iamVjdCA9IHJlcXVpcmVfYW5fb2JqZWN0KCk7CiAgICAgIHZhciBpc09iamVjdCA9IHJlcXVpcmVfaXNfb2JqZWN0KCk7CiAgICAgIHZhciBuZXdQcm9taXNlQ2FwYWJpbGl0eSA9IHJlcXVpcmVfbmV3X3Byb21pc2VfY2FwYWJpbGl0eSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKEMsIHgpIHsKICAgICAgICBhbk9iamVjdChDKTsKICAgICAgICBpZiAoaXNPYmplY3QoeCkgJiYgeC5jb25zdHJ1Y3RvciA9PT0gQykKICAgICAgICAgIHJldHVybiB4OwogICAgICAgIHZhciBwcm9taXNlQ2FwYWJpbGl0eSA9IG5ld1Byb21pc2VDYXBhYmlsaXR5LmYoQyk7CiAgICAgICAgdmFyIHJlc29sdmUgPSBwcm9taXNlQ2FwYWJpbGl0eS5yZXNvbHZlOwogICAgICAgIHJlc29sdmUoeCk7CiAgICAgICAgcmV0dXJuIHByb21pc2VDYXBhYmlsaXR5LnByb21pc2U7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2hvc3QtcmVwb3J0LWVycm9ycy5qcwogIHZhciByZXF1aXJlX2hvc3RfcmVwb3J0X2Vycm9ycyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2hvc3QtcmVwb3J0LWVycm9ycy5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGdsb2JhbDIgPSByZXF1aXJlX2dsb2JhbCgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgY29uc29sZTIgPSBnbG9iYWwyLmNvbnNvbGU7CiAgICAgICAgaWYgKGNvbnNvbGUyICYmIGNvbnNvbGUyLmVycm9yKSB7CiAgICAgICAgICBhcmd1bWVudHMubGVuZ3RoID09PSAxID8gY29uc29sZTIuZXJyb3IoYSkgOiBjb25zb2xlMi5lcnJvcihhLCBiKTsKICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL3BlcmZvcm0uanMKICB2YXIgcmVxdWlyZV9wZXJmb3JtID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvcGVyZm9ybS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihleGVjKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiB7IGVycm9yOiBmYWxzZSwgdmFsdWU6IGV4ZWMoKSB9OwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICByZXR1cm4geyBlcnJvcjogdHJ1ZSwgdmFsdWU6IGVycm9yIH07CiAgICAgICAgfQogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9lbmdpbmUtaXMtYnJvd3Nlci5qcwogIHZhciByZXF1aXJlX2VuZ2luZV9pc19icm93c2VyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZW5naW5lLWlzLWJyb3dzZXIuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gdHlwZW9mIHdpbmRvdyA9PSAib2JqZWN0IjsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLnByb21pc2UuanMKICB2YXIgcmVxdWlyZV9lc19wcm9taXNlID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLnByb21pc2UuanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyICQgPSByZXF1aXJlX2V4cG9ydCgpOwogICAgICB2YXIgSVNfUFVSRSA9IHJlcXVpcmVfaXNfcHVyZSgpOwogICAgICB2YXIgZ2xvYmFsMiA9IHJlcXVpcmVfZ2xvYmFsKCk7CiAgICAgIHZhciBnZXRCdWlsdEluID0gcmVxdWlyZV9nZXRfYnVpbHRfaW4oKTsKICAgICAgdmFyIE5hdGl2ZVByb21pc2UgPSByZXF1aXJlX25hdGl2ZV9wcm9taXNlX2NvbnN0cnVjdG9yKCk7CiAgICAgIHZhciByZWRlZmluZSA9IHJlcXVpcmVfcmVkZWZpbmUoKTsKICAgICAgdmFyIHJlZGVmaW5lQWxsID0gcmVxdWlyZV9yZWRlZmluZV9hbGwoKTsKICAgICAgdmFyIHNldFByb3RvdHlwZU9mID0gcmVxdWlyZV9vYmplY3Rfc2V0X3Byb3RvdHlwZV9vZigpOwogICAgICB2YXIgc2V0VG9TdHJpbmdUYWcgPSByZXF1aXJlX3NldF90b19zdHJpbmdfdGFnKCk7CiAgICAgIHZhciBzZXRTcGVjaWVzID0gcmVxdWlyZV9zZXRfc3BlY2llcygpOwogICAgICB2YXIgYUNhbGxhYmxlID0gcmVxdWlyZV9hX2NhbGxhYmxlKCk7CiAgICAgIHZhciBpc0NhbGxhYmxlID0gcmVxdWlyZV9pc19jYWxsYWJsZSgpOwogICAgICB2YXIgaXNPYmplY3QgPSByZXF1aXJlX2lzX29iamVjdCgpOwogICAgICB2YXIgYW5JbnN0YW5jZSA9IHJlcXVpcmVfYW5faW5zdGFuY2UoKTsKICAgICAgdmFyIGluc3BlY3RTb3VyY2UgPSByZXF1aXJlX2luc3BlY3Rfc291cmNlKCk7CiAgICAgIHZhciBpdGVyYXRlID0gcmVxdWlyZV9pdGVyYXRlKCk7CiAgICAgIHZhciBjaGVja0NvcnJlY3RuZXNzT2ZJdGVyYXRpb24gPSByZXF1aXJlX2NoZWNrX2NvcnJlY3RuZXNzX29mX2l0ZXJhdGlvbigpOwogICAgICB2YXIgc3BlY2llc0NvbnN0cnVjdG9yID0gcmVxdWlyZV9zcGVjaWVzX2NvbnN0cnVjdG9yKCk7CiAgICAgIHZhciB0YXNrID0gcmVxdWlyZV90YXNrKCkuc2V0OwogICAgICB2YXIgbWljcm90YXNrID0gcmVxdWlyZV9taWNyb3Rhc2soKTsKICAgICAgdmFyIHByb21pc2VSZXNvbHZlID0gcmVxdWlyZV9wcm9taXNlX3Jlc29sdmUoKTsKICAgICAgdmFyIGhvc3RSZXBvcnRFcnJvcnMgPSByZXF1aXJlX2hvc3RfcmVwb3J0X2Vycm9ycygpOwogICAgICB2YXIgbmV3UHJvbWlzZUNhcGFiaWxpdHlNb2R1bGUgPSByZXF1aXJlX25ld19wcm9taXNlX2NhcGFiaWxpdHkoKTsKICAgICAgdmFyIHBlcmZvcm0gPSByZXF1aXJlX3BlcmZvcm0oKTsKICAgICAgdmFyIEludGVybmFsU3RhdGVNb2R1bGUgPSByZXF1aXJlX2ludGVybmFsX3N0YXRlKCk7CiAgICAgIHZhciBpc0ZvcmNlZCA9IHJlcXVpcmVfaXNfZm9yY2VkKCk7CiAgICAgIHZhciB3ZWxsS25vd25TeW1ib2wgPSByZXF1aXJlX3dlbGxfa25vd25fc3ltYm9sKCk7CiAgICAgIHZhciBJU19CUk9XU0VSID0gcmVxdWlyZV9lbmdpbmVfaXNfYnJvd3NlcigpOwogICAgICB2YXIgSVNfTk9ERSA9IHJlcXVpcmVfZW5naW5lX2lzX25vZGUoKTsKICAgICAgdmFyIFY4X1ZFUlNJT04gPSByZXF1aXJlX2VuZ2luZV92OF92ZXJzaW9uKCk7CiAgICAgIHZhciBTUEVDSUVTID0gd2VsbEtub3duU3ltYm9sKCJzcGVjaWVzIik7CiAgICAgIHZhciBQUk9NSVNFID0gIlByb21pc2UiOwogICAgICB2YXIgZ2V0SW50ZXJuYWxTdGF0ZSA9IEludGVybmFsU3RhdGVNb2R1bGUuZ2V0OwogICAgICB2YXIgc2V0SW50ZXJuYWxTdGF0ZSA9IEludGVybmFsU3RhdGVNb2R1bGUuc2V0OwogICAgICB2YXIgZ2V0SW50ZXJuYWxQcm9taXNlU3RhdGUgPSBJbnRlcm5hbFN0YXRlTW9kdWxlLmdldHRlckZvcihQUk9NSVNFKTsKICAgICAgdmFyIE5hdGl2ZVByb21pc2VQcm90b3R5cGUgPSBOYXRpdmVQcm9taXNlICYmIE5hdGl2ZVByb21pc2UucHJvdG90eXBlOwogICAgICB2YXIgUHJvbWlzZUNvbnN0cnVjdG9yID0gTmF0aXZlUHJvbWlzZTsKICAgICAgdmFyIFByb21pc2VDb25zdHJ1Y3RvclByb3RvdHlwZSA9IE5hdGl2ZVByb21pc2VQcm90b3R5cGU7CiAgICAgIHZhciBUeXBlRXJyb3IyID0gZ2xvYmFsMi5UeXBlRXJyb3I7CiAgICAgIHZhciBkb2N1bWVudDIgPSBnbG9iYWwyLmRvY3VtZW50OwogICAgICB2YXIgcHJvY2VzczIgPSBnbG9iYWwyLnByb2Nlc3M7CiAgICAgIHZhciBuZXdQcm9taXNlQ2FwYWJpbGl0eSA9IG5ld1Byb21pc2VDYXBhYmlsaXR5TW9kdWxlLmY7CiAgICAgIHZhciBuZXdHZW5lcmljUHJvbWlzZUNhcGFiaWxpdHkgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eTsKICAgICAgdmFyIERJU1BBVENIX0VWRU5UID0gISEoZG9jdW1lbnQyICYmIGRvY3VtZW50Mi5jcmVhdGVFdmVudCAmJiBnbG9iYWwyLmRpc3BhdGNoRXZlbnQpOwogICAgICB2YXIgTkFUSVZFX1JFSkVDVElPTl9FVkVOVCA9IGlzQ2FsbGFibGUoZ2xvYmFsMi5Qcm9taXNlUmVqZWN0aW9uRXZlbnQpOwogICAgICB2YXIgVU5IQU5ETEVEX1JFSkVDVElPTiA9ICJ1bmhhbmRsZWRyZWplY3Rpb24iOwogICAgICB2YXIgUkVKRUNUSU9OX0hBTkRMRUQgPSAicmVqZWN0aW9uaGFuZGxlZCI7CiAgICAgIHZhciBQRU5ESU5HID0gMDsKICAgICAgdmFyIEZVTEZJTExFRCA9IDE7CiAgICAgIHZhciBSRUpFQ1RFRCA9IDI7CiAgICAgIHZhciBIQU5ETEVEID0gMTsKICAgICAgdmFyIFVOSEFORExFRCA9IDI7CiAgICAgIHZhciBTVUJDTEFTU0lORyA9IGZhbHNlOwogICAgICB2YXIgSW50ZXJuYWw7CiAgICAgIHZhciBPd25Qcm9taXNlQ2FwYWJpbGl0eTsKICAgICAgdmFyIFByb21pc2VXcmFwcGVyOwogICAgICB2YXIgbmF0aXZlVGhlbjsKICAgICAgdmFyIEZPUkNFRCA9IGlzRm9yY2VkKFBST01JU0UsIGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBQUk9NSVNFX0NPTlNUUlVDVE9SX1NPVVJDRSA9IGluc3BlY3RTb3VyY2UoUHJvbWlzZUNvbnN0cnVjdG9yKTsKICAgICAgICB2YXIgR0xPQkFMX0NPUkVfSlNfUFJPTUlTRSA9IFBST01JU0VfQ09OU1RSVUNUT1JfU09VUkNFICE9PSBTdHJpbmcoUHJvbWlzZUNvbnN0cnVjdG9yKTsKICAgICAgICBpZiAoIUdMT0JBTF9DT1JFX0pTX1BST01JU0UgJiYgVjhfVkVSU0lPTiA9PT0gNjYpCiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoSVNfUFVSRSAmJiAhUHJvbWlzZUNvbnN0cnVjdG9yUHJvdG90eXBlWyJmaW5hbGx5Il0pCiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoVjhfVkVSU0lPTiA+PSA1MSAmJiAvbmF0aXZlIGNvZGUvLnRlc3QoUFJPTUlTRV9DT05TVFJVQ1RPUl9TT1VSQ0UpKQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHZhciBwcm9taXNlID0gbmV3IFByb21pc2VDb25zdHJ1Y3RvcihmdW5jdGlvbihyZXNvbHZlKSB7CiAgICAgICAgICByZXNvbHZlKDEpOwogICAgICAgIH0pOwogICAgICAgIHZhciBGYWtlUHJvbWlzZSA9IGZ1bmN0aW9uKGV4ZWMpIHsKICAgICAgICAgIGV4ZWMoZnVuY3Rpb24oKSB7CiAgICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgdmFyIGNvbnN0cnVjdG9yID0gcHJvbWlzZS5jb25zdHJ1Y3RvciA9IHt9OwogICAgICAgIGNvbnN0cnVjdG9yW1NQRUNJRVNdID0gRmFrZVByb21pc2U7CiAgICAgICAgU1VCQ0xBU1NJTkcgPSBwcm9taXNlLnRoZW4oZnVuY3Rpb24oKSB7CiAgICAgICAgfSkgaW5zdGFuY2VvZiBGYWtlUHJvbWlzZTsKICAgICAgICBpZiAoIVNVQkNMQVNTSU5HKQogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJuICFHTE9CQUxfQ09SRV9KU19QUk9NSVNFICYmIElTX0JST1dTRVIgJiYgIU5BVElWRV9SRUpFQ1RJT05fRVZFTlQ7CiAgICAgIH0pOwogICAgICB2YXIgSU5DT1JSRUNUX0lURVJBVElPTiA9IEZPUkNFRCB8fCAhY2hlY2tDb3JyZWN0bmVzc09mSXRlcmF0aW9uKGZ1bmN0aW9uKGl0ZXJhYmxlKSB7CiAgICAgICAgUHJvbWlzZUNvbnN0cnVjdG9yLmFsbChpdGVyYWJsZSlbImNhdGNoIl0oZnVuY3Rpb24oKSB7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICB2YXIgaXNUaGVuYWJsZSA9IGZ1bmN0aW9uKGl0KSB7CiAgICAgICAgdmFyIHRoZW47CiAgICAgICAgcmV0dXJuIGlzT2JqZWN0KGl0KSAmJiBpc0NhbGxhYmxlKHRoZW4gPSBpdC50aGVuKSA/IHRoZW4gOiBmYWxzZTsKICAgICAgfTsKICAgICAgdmFyIG5vdGlmeSA9IGZ1bmN0aW9uKHN0YXRlLCBpc1JlamVjdCkgewogICAgICAgIGlmIChzdGF0ZS5ub3RpZmllZCkKICAgICAgICAgIHJldHVybjsKICAgICAgICBzdGF0ZS5ub3RpZmllZCA9IHRydWU7CiAgICAgICAgdmFyIGNoYWluID0gc3RhdGUucmVhY3Rpb25zOwogICAgICAgIG1pY3JvdGFzayhmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciB2YWx1ZSA9IHN0YXRlLnZhbHVlOwogICAgICAgICAgdmFyIG9rID0gc3RhdGUuc3RhdGUgPT0gRlVMRklMTEVEOwogICAgICAgICAgdmFyIGluZGV4ID0gMDsKICAgICAgICAgIHdoaWxlIChjaGFpbi5sZW5ndGggPiBpbmRleCkgewogICAgICAgICAgICB2YXIgcmVhY3Rpb24gPSBjaGFpbltpbmRleCsrXTsKICAgICAgICAgICAgdmFyIGhhbmRsZXIgPSBvayA/IHJlYWN0aW9uLm9rIDogcmVhY3Rpb24uZmFpbDsKICAgICAgICAgICAgdmFyIHJlc29sdmUgPSByZWFjdGlvbi5yZXNvbHZlOwogICAgICAgICAgICB2YXIgcmVqZWN0ID0gcmVhY3Rpb24ucmVqZWN0OwogICAgICAgICAgICB2YXIgZG9tYWluID0gcmVhY3Rpb24uZG9tYWluOwogICAgICAgICAgICB2YXIgcmVzdWx0LCB0aGVuLCBleGl0ZWQ7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgaWYgKGhhbmRsZXIpIHsKICAgICAgICAgICAgICAgIGlmICghb2spIHsKICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLnJlamVjdGlvbiA9PT0gVU5IQU5ETEVEKQogICAgICAgICAgICAgICAgICAgIG9uSGFuZGxlVW5oYW5kbGVkKHN0YXRlKTsKICAgICAgICAgICAgICAgICAgc3RhdGUucmVqZWN0aW9uID0gSEFORExFRDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChoYW5kbGVyID09PSB0cnVlKQogICAgICAgICAgICAgICAgICByZXN1bHQgPSB2YWx1ZTsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICBpZiAoZG9tYWluKQogICAgICAgICAgICAgICAgICAgIGRvbWFpbi5lbnRlcigpOwogICAgICAgICAgICAgICAgICByZXN1bHQgPSBoYW5kbGVyKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgaWYgKGRvbWFpbikgewogICAgICAgICAgICAgICAgICAgIGRvbWFpbi5leGl0KCk7CiAgICAgICAgICAgICAgICAgICAgZXhpdGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gcmVhY3Rpb24ucHJvbWlzZSkgewogICAgICAgICAgICAgICAgICByZWplY3QoVHlwZUVycm9yMigiUHJvbWlzZS1jaGFpbiBjeWNsZSIpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhlbiA9IGlzVGhlbmFibGUocmVzdWx0KSkgewogICAgICAgICAgICAgICAgICB0aGVuLmNhbGwocmVzdWx0LCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTsKICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIHJlamVjdCh2YWx1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgaWYgKGRvbWFpbiAmJiAhZXhpdGVkKQogICAgICAgICAgICAgICAgZG9tYWluLmV4aXQoKTsKICAgICAgICAgICAgICByZWplY3QoZXJyb3IpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZS5yZWFjdGlvbnMgPSBbXTsKICAgICAgICAgIHN0YXRlLm5vdGlmaWVkID0gZmFsc2U7CiAgICAgICAgICBpZiAoaXNSZWplY3QgJiYgIXN0YXRlLnJlamVjdGlvbikKICAgICAgICAgICAgb25VbmhhbmRsZWQoc3RhdGUpOwogICAgICAgIH0pOwogICAgICB9OwogICAgICB2YXIgZGlzcGF0Y2hFdmVudCA9IGZ1bmN0aW9uKG5hbWUsIHByb21pc2UsIHJlYXNvbikgewogICAgICAgIHZhciBldmVudCwgaGFuZGxlcjsKICAgICAgICBpZiAoRElTUEFUQ0hfRVZFTlQpIHsKICAgICAgICAgIGV2ZW50ID0gZG9jdW1lbnQyLmNyZWF0ZUV2ZW50KCJFdmVudCIpOwogICAgICAgICAgZXZlbnQucHJvbWlzZSA9IHByb21pc2U7CiAgICAgICAgICBldmVudC5yZWFzb24gPSByZWFzb247CiAgICAgICAgICBldmVudC5pbml0RXZlbnQobmFtZSwgZmFsc2UsIHRydWUpOwogICAgICAgICAgZ2xvYmFsMi5kaXNwYXRjaEV2ZW50KGV2ZW50KTsKICAgICAgICB9IGVsc2UKICAgICAgICAgIGV2ZW50ID0geyBwcm9taXNlLCByZWFzb24gfTsKICAgICAgICBpZiAoIU5BVElWRV9SRUpFQ1RJT05fRVZFTlQgJiYgKGhhbmRsZXIgPSBnbG9iYWwyWyJvbiIgKyBuYW1lXSkpCiAgICAgICAgICBoYW5kbGVyKGV2ZW50KTsKICAgICAgICBlbHNlIGlmIChuYW1lID09PSBVTkhBTkRMRURfUkVKRUNUSU9OKQogICAgICAgICAgaG9zdFJlcG9ydEVycm9ycygiVW5oYW5kbGVkIHByb21pc2UgcmVqZWN0aW9uIiwgcmVhc29uKTsKICAgICAgfTsKICAgICAgdmFyIG9uVW5oYW5kbGVkID0gZnVuY3Rpb24oc3RhdGUpIHsKICAgICAgICB0YXNrLmNhbGwoZ2xvYmFsMiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgcHJvbWlzZSA9IHN0YXRlLmZhY2FkZTsKICAgICAgICAgIHZhciB2YWx1ZSA9IHN0YXRlLnZhbHVlOwogICAgICAgICAgdmFyIElTX1VOSEFORExFRCA9IGlzVW5oYW5kbGVkKHN0YXRlKTsKICAgICAgICAgIHZhciByZXN1bHQ7CiAgICAgICAgICBpZiAoSVNfVU5IQU5ETEVEKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHBlcmZvcm0oZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgaWYgKElTX05PREUpIHsKICAgICAgICAgICAgICAgIHByb2Nlc3MyLmVtaXQoInVuaGFuZGxlZFJlamVjdGlvbiIsIHZhbHVlLCBwcm9taXNlKTsKICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIGRpc3BhdGNoRXZlbnQoVU5IQU5ETEVEX1JFSkVDVElPTiwgcHJvbWlzZSwgdmFsdWUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc3RhdGUucmVqZWN0aW9uID0gSVNfTk9ERSB8fCBpc1VuaGFuZGxlZChzdGF0ZSkgPyBVTkhBTkRMRUQgOiBIQU5ETEVEOwogICAgICAgICAgICBpZiAocmVzdWx0LmVycm9yKQogICAgICAgICAgICAgIHRocm93IHJlc3VsdC52YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfTsKICAgICAgdmFyIGlzVW5oYW5kbGVkID0gZnVuY3Rpb24oc3RhdGUpIHsKICAgICAgICByZXR1cm4gc3RhdGUucmVqZWN0aW9uICE9PSBIQU5ETEVEICYmICFzdGF0ZS5wYXJlbnQ7CiAgICAgIH07CiAgICAgIHZhciBvbkhhbmRsZVVuaGFuZGxlZCA9IGZ1bmN0aW9uKHN0YXRlKSB7CiAgICAgICAgdGFzay5jYWxsKGdsb2JhbDIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHByb21pc2UgPSBzdGF0ZS5mYWNhZGU7CiAgICAgICAgICBpZiAoSVNfTk9ERSkgewogICAgICAgICAgICBwcm9jZXNzMi5lbWl0KCJyZWplY3Rpb25IYW5kbGVkIiwgcHJvbWlzZSk7CiAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgZGlzcGF0Y2hFdmVudChSRUpFQ1RJT05fSEFORExFRCwgcHJvbWlzZSwgc3RhdGUudmFsdWUpOwogICAgICAgIH0pOwogICAgICB9OwogICAgICB2YXIgYmluZCA9IGZ1bmN0aW9uKGZuLCBzdGF0ZSwgdW53cmFwKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICBmbihzdGF0ZSwgdmFsdWUsIHVud3JhcCk7CiAgICAgICAgfTsKICAgICAgfTsKICAgICAgdmFyIGludGVybmFsUmVqZWN0ID0gZnVuY3Rpb24oc3RhdGUsIHZhbHVlLCB1bndyYXApIHsKICAgICAgICBpZiAoc3RhdGUuZG9uZSkKICAgICAgICAgIHJldHVybjsKICAgICAgICBzdGF0ZS5kb25lID0gdHJ1ZTsKICAgICAgICBpZiAodW53cmFwKQogICAgICAgICAgc3RhdGUgPSB1bndyYXA7CiAgICAgICAgc3RhdGUudmFsdWUgPSB2YWx1ZTsKICAgICAgICBzdGF0ZS5zdGF0ZSA9IFJFSkVDVEVEOwogICAgICAgIG5vdGlmeShzdGF0ZSwgdHJ1ZSk7CiAgICAgIH07CiAgICAgIHZhciBpbnRlcm5hbFJlc29sdmUgPSBmdW5jdGlvbihzdGF0ZSwgdmFsdWUsIHVud3JhcCkgewogICAgICAgIGlmIChzdGF0ZS5kb25lKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIHN0YXRlLmRvbmUgPSB0cnVlOwogICAgICAgIGlmICh1bndyYXApCiAgICAgICAgICBzdGF0ZSA9IHVud3JhcDsKICAgICAgICB0cnkgewogICAgICAgICAgaWYgKHN0YXRlLmZhY2FkZSA9PT0gdmFsdWUpCiAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcjIoIlByb21pc2UgY2FuJ3QgYmUgcmVzb2x2ZWQgaXRzZWxmIik7CiAgICAgICAgICB2YXIgdGhlbiA9IGlzVGhlbmFibGUodmFsdWUpOwogICAgICAgICAgaWYgKHRoZW4pIHsKICAgICAgICAgICAgbWljcm90YXNrKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHZhciB3cmFwcGVyID0geyBkb25lOiBmYWxzZSB9OwogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB0aGVuLmNhbGwodmFsdWUsIGJpbmQoaW50ZXJuYWxSZXNvbHZlLCB3cmFwcGVyLCBzdGF0ZSksIGJpbmQoaW50ZXJuYWxSZWplY3QsIHdyYXBwZXIsIHN0YXRlKSk7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGludGVybmFsUmVqZWN0KHdyYXBwZXIsIGVycm9yLCBzdGF0ZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0YXRlLnZhbHVlID0gdmFsdWU7CiAgICAgICAgICAgIHN0YXRlLnN0YXRlID0gRlVMRklMTEVEOwogICAgICAgICAgICBub3RpZnkoc3RhdGUsIGZhbHNlKTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgaW50ZXJuYWxSZWplY3QoeyBkb25lOiBmYWxzZSB9LCBlcnJvciwgc3RhdGUpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgaWYgKEZPUkNFRCkgewogICAgICAgIFByb21pc2VDb25zdHJ1Y3RvciA9IGZ1bmN0aW9uIFByb21pc2UyKGV4ZWN1dG9yKSB7CiAgICAgICAgICBhbkluc3RhbmNlKHRoaXMsIFByb21pc2VDb25zdHJ1Y3RvciwgUFJPTUlTRSk7CiAgICAgICAgICBhQ2FsbGFibGUoZXhlY3V0b3IpOwogICAgICAgICAgSW50ZXJuYWwuY2FsbCh0aGlzKTsKICAgICAgICAgIHZhciBzdGF0ZSA9IGdldEludGVybmFsU3RhdGUodGhpcyk7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBleGVjdXRvcihiaW5kKGludGVybmFsUmVzb2x2ZSwgc3RhdGUpLCBiaW5kKGludGVybmFsUmVqZWN0LCBzdGF0ZSkpOwogICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgaW50ZXJuYWxSZWplY3Qoc3RhdGUsIGVycm9yKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIFByb21pc2VDb25zdHJ1Y3RvclByb3RvdHlwZSA9IFByb21pc2VDb25zdHJ1Y3Rvci5wcm90b3R5cGU7CiAgICAgICAgSW50ZXJuYWwgPSBmdW5jdGlvbiBQcm9taXNlMihleGVjdXRvcikgewogICAgICAgICAgc2V0SW50ZXJuYWxTdGF0ZSh0aGlzLCB7CiAgICAgICAgICAgIHR5cGU6IFBST01JU0UsCiAgICAgICAgICAgIGRvbmU6IGZhbHNlLAogICAgICAgICAgICBub3RpZmllZDogZmFsc2UsCiAgICAgICAgICAgIHBhcmVudDogZmFsc2UsCiAgICAgICAgICAgIHJlYWN0aW9uczogW10sCiAgICAgICAgICAgIHJlamVjdGlvbjogZmFsc2UsCiAgICAgICAgICAgIHN0YXRlOiBQRU5ESU5HLAogICAgICAgICAgICB2YWx1ZTogdm9pZCAwCiAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIEludGVybmFsLnByb3RvdHlwZSA9IHJlZGVmaW5lQWxsKFByb21pc2VDb25zdHJ1Y3RvclByb3RvdHlwZSwgewogICAgICAgICAgdGhlbjogZnVuY3Rpb24gdGhlbihvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCkgewogICAgICAgICAgICB2YXIgc3RhdGUgPSBnZXRJbnRlcm5hbFByb21pc2VTdGF0ZSh0aGlzKTsKICAgICAgICAgICAgdmFyIHJlYWN0aW9uID0gbmV3UHJvbWlzZUNhcGFiaWxpdHkoc3BlY2llc0NvbnN0cnVjdG9yKHRoaXMsIFByb21pc2VDb25zdHJ1Y3RvcikpOwogICAgICAgICAgICByZWFjdGlvbi5vayA9IGlzQ2FsbGFibGUob25GdWxmaWxsZWQpID8gb25GdWxmaWxsZWQgOiB0cnVlOwogICAgICAgICAgICByZWFjdGlvbi5mYWlsID0gaXNDYWxsYWJsZShvblJlamVjdGVkKSAmJiBvblJlamVjdGVkOwogICAgICAgICAgICByZWFjdGlvbi5kb21haW4gPSBJU19OT0RFID8gcHJvY2VzczIuZG9tYWluIDogdm9pZCAwOwogICAgICAgICAgICBzdGF0ZS5wYXJlbnQgPSB0cnVlOwogICAgICAgICAgICBzdGF0ZS5yZWFjdGlvbnMucHVzaChyZWFjdGlvbik7CiAgICAgICAgICAgIGlmIChzdGF0ZS5zdGF0ZSAhPSBQRU5ESU5HKQogICAgICAgICAgICAgIG5vdGlmeShzdGF0ZSwgZmFsc2UpOwogICAgICAgICAgICByZXR1cm4gcmVhY3Rpb24ucHJvbWlzZTsKICAgICAgICAgIH0sCiAgICAgICAgICAiY2F0Y2giOiBmdW5jdGlvbihvblJlamVjdGVkKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRoZW4odm9pZCAwLCBvblJlamVjdGVkKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBPd25Qcm9taXNlQ2FwYWJpbGl0eSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHByb21pc2UgPSBuZXcgSW50ZXJuYWwoKTsKICAgICAgICAgIHZhciBzdGF0ZSA9IGdldEludGVybmFsU3RhdGUocHJvbWlzZSk7CiAgICAgICAgICB0aGlzLnByb21pc2UgPSBwcm9taXNlOwogICAgICAgICAgdGhpcy5yZXNvbHZlID0gYmluZChpbnRlcm5hbFJlc29sdmUsIHN0YXRlKTsKICAgICAgICAgIHRoaXMucmVqZWN0ID0gYmluZChpbnRlcm5hbFJlamVjdCwgc3RhdGUpOwogICAgICAgIH07CiAgICAgICAgbmV3UHJvbWlzZUNhcGFiaWxpdHlNb2R1bGUuZiA9IG5ld1Byb21pc2VDYXBhYmlsaXR5ID0gZnVuY3Rpb24oQykgewogICAgICAgICAgcmV0dXJuIEMgPT09IFByb21pc2VDb25zdHJ1Y3RvciB8fCBDID09PSBQcm9taXNlV3JhcHBlciA/IG5ldyBPd25Qcm9taXNlQ2FwYWJpbGl0eShDKSA6IG5ld0dlbmVyaWNQcm9taXNlQ2FwYWJpbGl0eShDKTsKICAgICAgICB9OwogICAgICAgIGlmICghSVNfUFVSRSAmJiBpc0NhbGxhYmxlKE5hdGl2ZVByb21pc2UpICYmIE5hdGl2ZVByb21pc2VQcm90b3R5cGUgIT09IE9iamVjdC5wcm90b3R5cGUpIHsKICAgICAgICAgIG5hdGl2ZVRoZW4gPSBOYXRpdmVQcm9taXNlUHJvdG90eXBlLnRoZW47CiAgICAgICAgICBpZiAoIVNVQkNMQVNTSU5HKSB7CiAgICAgICAgICAgIHJlZGVmaW5lKE5hdGl2ZVByb21pc2VQcm90b3R5cGUsICJ0aGVuIiwgZnVuY3Rpb24gdGhlbihvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCkgewogICAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpczsKICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2VDb25zdHJ1Y3RvcihmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgICAgIG5hdGl2ZVRoZW4uY2FsbCh0aGF0LCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgIH0pLnRoZW4ob25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQpOwogICAgICAgICAgICB9LCB7IHVuc2FmZTogdHJ1ZSB9KTsKICAgICAgICAgICAgcmVkZWZpbmUoTmF0aXZlUHJvbWlzZVByb3RvdHlwZSwgImNhdGNoIiwgUHJvbWlzZUNvbnN0cnVjdG9yUHJvdG90eXBlWyJjYXRjaCJdLCB7IHVuc2FmZTogdHJ1ZSB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGRlbGV0ZSBOYXRpdmVQcm9taXNlUHJvdG90eXBlLmNvbnN0cnVjdG9yOwogICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChzZXRQcm90b3R5cGVPZikgewogICAgICAgICAgICBzZXRQcm90b3R5cGVPZihOYXRpdmVQcm9taXNlUHJvdG90eXBlLCBQcm9taXNlQ29uc3RydWN0b3JQcm90b3R5cGUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICAkKHsgZ2xvYmFsOiB0cnVlLCB3cmFwOiB0cnVlLCBmb3JjZWQ6IEZPUkNFRCB9LCB7CiAgICAgICAgUHJvbWlzZTogUHJvbWlzZUNvbnN0cnVjdG9yCiAgICAgIH0pOwogICAgICBzZXRUb1N0cmluZ1RhZyhQcm9taXNlQ29uc3RydWN0b3IsIFBST01JU0UsIGZhbHNlLCB0cnVlKTsKICAgICAgc2V0U3BlY2llcyhQUk9NSVNFKTsKICAgICAgUHJvbWlzZVdyYXBwZXIgPSBnZXRCdWlsdEluKFBST01JU0UpOwogICAgICAkKHsgdGFyZ2V0OiBQUk9NSVNFLCBzdGF0OiB0cnVlLCBmb3JjZWQ6IEZPUkNFRCB9LCB7CiAgICAgICAgcmVqZWN0OiBmdW5jdGlvbiByZWplY3QocikgewogICAgICAgICAgdmFyIGNhcGFiaWxpdHkgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eSh0aGlzKTsKICAgICAgICAgIGNhcGFiaWxpdHkucmVqZWN0LmNhbGwodm9pZCAwLCByKTsKICAgICAgICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgJCh7IHRhcmdldDogUFJPTUlTRSwgc3RhdDogdHJ1ZSwgZm9yY2VkOiBJU19QVVJFIHx8IEZPUkNFRCB9LCB7CiAgICAgICAgcmVzb2x2ZTogZnVuY3Rpb24gcmVzb2x2ZSh4KSB7CiAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlc29sdmUoSVNfUFVSRSAmJiB0aGlzID09PSBQcm9taXNlV3JhcHBlciA/IFByb21pc2VDb25zdHJ1Y3RvciA6IHRoaXMsIHgpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgICQoeyB0YXJnZXQ6IFBST01JU0UsIHN0YXQ6IHRydWUsIGZvcmNlZDogSU5DT1JSRUNUX0lURVJBVElPTiB9LCB7CiAgICAgICAgYWxsOiBmdW5jdGlvbiBhbGwoaXRlcmFibGUpIHsKICAgICAgICAgIHZhciBDID0gdGhpczsKICAgICAgICAgIHZhciBjYXBhYmlsaXR5ID0gbmV3UHJvbWlzZUNhcGFiaWxpdHkoQyk7CiAgICAgICAgICB2YXIgcmVzb2x2ZSA9IGNhcGFiaWxpdHkucmVzb2x2ZTsKICAgICAgICAgIHZhciByZWplY3QgPSBjYXBhYmlsaXR5LnJlamVjdDsKICAgICAgICAgIHZhciByZXN1bHQgPSBwZXJmb3JtKGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgJHByb21pc2VSZXNvbHZlID0gYUNhbGxhYmxlKEMucmVzb2x2ZSk7CiAgICAgICAgICAgIHZhciB2YWx1ZXMgPSBbXTsKICAgICAgICAgICAgdmFyIGNvdW50ZXIgPSAwOwogICAgICAgICAgICB2YXIgcmVtYWluaW5nID0gMTsKICAgICAgICAgICAgaXRlcmF0ZShpdGVyYWJsZSwgZnVuY3Rpb24ocHJvbWlzZSkgewogICAgICAgICAgICAgIHZhciBpbmRleCA9IGNvdW50ZXIrKzsKICAgICAgICAgICAgICB2YXIgYWxyZWFkeUNhbGxlZCA9IGZhbHNlOwogICAgICAgICAgICAgIHZhbHVlcy5wdXNoKHZvaWQgMCk7CiAgICAgICAgICAgICAgcmVtYWluaW5nKys7CiAgICAgICAgICAgICAgJHByb21pc2VSZXNvbHZlLmNhbGwoQywgcHJvbWlzZSkudGhlbihmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKGFscmVhZHlDYWxsZWQpCiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGFscmVhZHlDYWxsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgdmFsdWVzW2luZGV4XSA9IHZhbHVlOwogICAgICAgICAgICAgICAgLS1yZW1haW5pbmcgfHwgcmVzb2x2ZSh2YWx1ZXMpOwogICAgICAgICAgICAgIH0sIHJlamVjdCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAtLXJlbWFpbmluZyB8fCByZXNvbHZlKHZhbHVlcyk7CiAgICAgICAgICB9KTsKICAgICAgICAgIGlmIChyZXN1bHQuZXJyb3IpCiAgICAgICAgICAgIHJlamVjdChyZXN1bHQudmFsdWUpOwogICAgICAgICAgcmV0dXJuIGNhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgICB9LAogICAgICAgIHJhY2U6IGZ1bmN0aW9uIHJhY2UoaXRlcmFibGUpIHsKICAgICAgICAgIHZhciBDID0gdGhpczsKICAgICAgICAgIHZhciBjYXBhYmlsaXR5ID0gbmV3UHJvbWlzZUNhcGFiaWxpdHkoQyk7CiAgICAgICAgICB2YXIgcmVqZWN0ID0gY2FwYWJpbGl0eS5yZWplY3Q7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gcGVyZm9ybShmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyICRwcm9taXNlUmVzb2x2ZSA9IGFDYWxsYWJsZShDLnJlc29sdmUpOwogICAgICAgICAgICBpdGVyYXRlKGl0ZXJhYmxlLCBmdW5jdGlvbihwcm9taXNlKSB7CiAgICAgICAgICAgICAgJHByb21pc2VSZXNvbHZlLmNhbGwoQywgcHJvbWlzZSkudGhlbihjYXBhYmlsaXR5LnJlc29sdmUsIHJlamVjdCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgICBpZiAocmVzdWx0LmVycm9yKQogICAgICAgICAgICByZWplY3QocmVzdWx0LnZhbHVlKTsKICAgICAgICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLnByb21pc2UuYWxsLXNldHRsZWQuanMKICB2YXIgcmVxdWlyZV9lc19wcm9taXNlX2FsbF9zZXR0bGVkID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLnByb21pc2UuYWxsLXNldHRsZWQuanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyICQgPSByZXF1aXJlX2V4cG9ydCgpOwogICAgICB2YXIgYUNhbGxhYmxlID0gcmVxdWlyZV9hX2NhbGxhYmxlKCk7CiAgICAgIHZhciBuZXdQcm9taXNlQ2FwYWJpbGl0eU1vZHVsZSA9IHJlcXVpcmVfbmV3X3Byb21pc2VfY2FwYWJpbGl0eSgpOwogICAgICB2YXIgcGVyZm9ybSA9IHJlcXVpcmVfcGVyZm9ybSgpOwogICAgICB2YXIgaXRlcmF0ZSA9IHJlcXVpcmVfaXRlcmF0ZSgpOwogICAgICAkKHsgdGFyZ2V0OiAiUHJvbWlzZSIsIHN0YXQ6IHRydWUgfSwgewogICAgICAgIGFsbFNldHRsZWQ6IGZ1bmN0aW9uIGFsbFNldHRsZWQoaXRlcmFibGUpIHsKICAgICAgICAgIHZhciBDID0gdGhpczsKICAgICAgICAgIHZhciBjYXBhYmlsaXR5ID0gbmV3UHJvbWlzZUNhcGFiaWxpdHlNb2R1bGUuZihDKTsKICAgICAgICAgIHZhciByZXNvbHZlID0gY2FwYWJpbGl0eS5yZXNvbHZlOwogICAgICAgICAgdmFyIHJlamVjdCA9IGNhcGFiaWxpdHkucmVqZWN0OwogICAgICAgICAgdmFyIHJlc3VsdCA9IHBlcmZvcm0oZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBwcm9taXNlUmVzb2x2ZSA9IGFDYWxsYWJsZShDLnJlc29sdmUpOwogICAgICAgICAgICB2YXIgdmFsdWVzID0gW107CiAgICAgICAgICAgIHZhciBjb3VudGVyID0gMDsKICAgICAgICAgICAgdmFyIHJlbWFpbmluZyA9IDE7CiAgICAgICAgICAgIGl0ZXJhdGUoaXRlcmFibGUsIGZ1bmN0aW9uKHByb21pc2UpIHsKICAgICAgICAgICAgICB2YXIgaW5kZXggPSBjb3VudGVyKys7CiAgICAgICAgICAgICAgdmFyIGFscmVhZHlDYWxsZWQgPSBmYWxzZTsKICAgICAgICAgICAgICB2YWx1ZXMucHVzaCh2b2lkIDApOwogICAgICAgICAgICAgIHJlbWFpbmluZysrOwogICAgICAgICAgICAgIHByb21pc2VSZXNvbHZlLmNhbGwoQywgcHJvbWlzZSkudGhlbihmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKGFscmVhZHlDYWxsZWQpCiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGFscmVhZHlDYWxsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgdmFsdWVzW2luZGV4XSA9IHsgc3RhdHVzOiAiZnVsZmlsbGVkIiwgdmFsdWUgfTsKICAgICAgICAgICAgICAgIC0tcmVtYWluaW5nIHx8IHJlc29sdmUodmFsdWVzKTsKICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikgewogICAgICAgICAgICAgICAgaWYgKGFscmVhZHlDYWxsZWQpCiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGFscmVhZHlDYWxsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgdmFsdWVzW2luZGV4XSA9IHsgc3RhdHVzOiAicmVqZWN0ZWQiLCByZWFzb246IGVycm9yIH07CiAgICAgICAgICAgICAgICAtLXJlbWFpbmluZyB8fCByZXNvbHZlKHZhbHVlcyk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAtLXJlbWFpbmluZyB8fCByZXNvbHZlKHZhbHVlcyk7CiAgICAgICAgICB9KTsKICAgICAgICAgIGlmIChyZXN1bHQuZXJyb3IpCiAgICAgICAgICAgIHJlamVjdChyZXN1bHQudmFsdWUpOwogICAgICAgICAgcmV0dXJuIGNhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMucHJvbWlzZS5hbnkuanMKICB2YXIgcmVxdWlyZV9lc19wcm9taXNlX2FueSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5wcm9taXNlLmFueS5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgJCA9IHJlcXVpcmVfZXhwb3J0KCk7CiAgICAgIHZhciBhQ2FsbGFibGUgPSByZXF1aXJlX2FfY2FsbGFibGUoKTsKICAgICAgdmFyIGdldEJ1aWx0SW4gPSByZXF1aXJlX2dldF9idWlsdF9pbigpOwogICAgICB2YXIgbmV3UHJvbWlzZUNhcGFiaWxpdHlNb2R1bGUgPSByZXF1aXJlX25ld19wcm9taXNlX2NhcGFiaWxpdHkoKTsKICAgICAgdmFyIHBlcmZvcm0gPSByZXF1aXJlX3BlcmZvcm0oKTsKICAgICAgdmFyIGl0ZXJhdGUgPSByZXF1aXJlX2l0ZXJhdGUoKTsKICAgICAgdmFyIFBST01JU0VfQU5ZX0VSUk9SID0gIk5vIG9uZSBwcm9taXNlIHJlc29sdmVkIjsKICAgICAgJCh7IHRhcmdldDogIlByb21pc2UiLCBzdGF0OiB0cnVlIH0sIHsKICAgICAgICBhbnk6IGZ1bmN0aW9uIGFueShpdGVyYWJsZSkgewogICAgICAgICAgdmFyIEMgPSB0aGlzOwogICAgICAgICAgdmFyIGNhcGFiaWxpdHkgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eU1vZHVsZS5mKEMpOwogICAgICAgICAgdmFyIHJlc29sdmUgPSBjYXBhYmlsaXR5LnJlc29sdmU7CiAgICAgICAgICB2YXIgcmVqZWN0ID0gY2FwYWJpbGl0eS5yZWplY3Q7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gcGVyZm9ybShmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHByb21pc2VSZXNvbHZlID0gYUNhbGxhYmxlKEMucmVzb2x2ZSk7CiAgICAgICAgICAgIHZhciBlcnJvcnMgPSBbXTsKICAgICAgICAgICAgdmFyIGNvdW50ZXIgPSAwOwogICAgICAgICAgICB2YXIgcmVtYWluaW5nID0gMTsKICAgICAgICAgICAgdmFyIGFscmVhZHlSZXNvbHZlZCA9IGZhbHNlOwogICAgICAgICAgICBpdGVyYXRlKGl0ZXJhYmxlLCBmdW5jdGlvbihwcm9taXNlKSB7CiAgICAgICAgICAgICAgdmFyIGluZGV4ID0gY291bnRlcisrOwogICAgICAgICAgICAgIHZhciBhbHJlYWR5UmVqZWN0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgICBlcnJvcnMucHVzaCh2b2lkIDApOwogICAgICAgICAgICAgIHJlbWFpbmluZysrOwogICAgICAgICAgICAgIHByb21pc2VSZXNvbHZlLmNhbGwoQywgcHJvbWlzZSkudGhlbihmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKGFscmVhZHlSZWplY3RlZCB8fCBhbHJlYWR5UmVzb2x2ZWQpCiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGFscmVhZHlSZXNvbHZlZCA9IHRydWU7CiAgICAgICAgICAgICAgICByZXNvbHZlKHZhbHVlKTsKICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikgewogICAgICAgICAgICAgICAgaWYgKGFscmVhZHlSZWplY3RlZCB8fCBhbHJlYWR5UmVzb2x2ZWQpCiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGFscmVhZHlSZWplY3RlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBlcnJvcnNbaW5kZXhdID0gZXJyb3I7CiAgICAgICAgICAgICAgICAtLXJlbWFpbmluZyB8fCByZWplY3QobmV3IChnZXRCdWlsdEluKCJBZ2dyZWdhdGVFcnJvciIpKShlcnJvcnMsIFBST01JU0VfQU5ZX0VSUk9SKSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAtLXJlbWFpbmluZyB8fCByZWplY3QobmV3IChnZXRCdWlsdEluKCJBZ2dyZWdhdGVFcnJvciIpKShlcnJvcnMsIFBST01JU0VfQU5ZX0VSUk9SKSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIGlmIChyZXN1bHQuZXJyb3IpCiAgICAgICAgICAgIHJlamVjdChyZXN1bHQudmFsdWUpOwogICAgICAgICAgcmV0dXJuIGNhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMucHJvbWlzZS5maW5hbGx5LmpzCiAgdmFyIHJlcXVpcmVfZXNfcHJvbWlzZV9maW5hbGx5ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLnByb21pc2UuZmluYWxseS5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgJCA9IHJlcXVpcmVfZXhwb3J0KCk7CiAgICAgIHZhciBJU19QVVJFID0gcmVxdWlyZV9pc19wdXJlKCk7CiAgICAgIHZhciBOYXRpdmVQcm9taXNlID0gcmVxdWlyZV9uYXRpdmVfcHJvbWlzZV9jb25zdHJ1Y3RvcigpOwogICAgICB2YXIgZmFpbHMgPSByZXF1aXJlX2ZhaWxzKCk7CiAgICAgIHZhciBnZXRCdWlsdEluID0gcmVxdWlyZV9nZXRfYnVpbHRfaW4oKTsKICAgICAgdmFyIGlzQ2FsbGFibGUgPSByZXF1aXJlX2lzX2NhbGxhYmxlKCk7CiAgICAgIHZhciBzcGVjaWVzQ29uc3RydWN0b3IgPSByZXF1aXJlX3NwZWNpZXNfY29uc3RydWN0b3IoKTsKICAgICAgdmFyIHByb21pc2VSZXNvbHZlID0gcmVxdWlyZV9wcm9taXNlX3Jlc29sdmUoKTsKICAgICAgdmFyIHJlZGVmaW5lID0gcmVxdWlyZV9yZWRlZmluZSgpOwogICAgICB2YXIgTk9OX0dFTkVSSUMgPSAhIU5hdGl2ZVByb21pc2UgJiYgZmFpbHMoZnVuY3Rpb24oKSB7CiAgICAgICAgTmF0aXZlUHJvbWlzZS5wcm90b3R5cGVbImZpbmFsbHkiXS5jYWxsKHsgdGhlbjogZnVuY3Rpb24oKSB7CiAgICAgICAgfSB9LCBmdW5jdGlvbigpIHsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgICQoeyB0YXJnZXQ6ICJQcm9taXNlIiwgcHJvdG86IHRydWUsIHJlYWw6IHRydWUsIGZvcmNlZDogTk9OX0dFTkVSSUMgfSwgewogICAgICAgICJmaW5hbGx5IjogZnVuY3Rpb24ob25GaW5hbGx5KSB7CiAgICAgICAgICB2YXIgQyA9IHNwZWNpZXNDb25zdHJ1Y3Rvcih0aGlzLCBnZXRCdWlsdEluKCJQcm9taXNlIikpOwogICAgICAgICAgdmFyIGlzRnVuY3Rpb24gPSBpc0NhbGxhYmxlKG9uRmluYWxseSk7CiAgICAgICAgICByZXR1cm4gdGhpcy50aGVuKGlzRnVuY3Rpb24gPyBmdW5jdGlvbih4KSB7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZShDLCBvbkZpbmFsbHkoKSkudGhlbihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4geDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IDogb25GaW5hbGx5LCBpc0Z1bmN0aW9uID8gZnVuY3Rpb24oZSkgewogICAgICAgICAgICByZXR1cm4gcHJvbWlzZVJlc29sdmUoQywgb25GaW5hbGx5KCkpLnRoZW4oZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IDogb25GaW5hbGx5KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBpZiAoIUlTX1BVUkUgJiYgaXNDYWxsYWJsZShOYXRpdmVQcm9taXNlKSkgewogICAgICAgIG1ldGhvZCA9IGdldEJ1aWx0SW4oIlByb21pc2UiKS5wcm90b3R5cGVbImZpbmFsbHkiXTsKICAgICAgICBpZiAoTmF0aXZlUHJvbWlzZS5wcm90b3R5cGVbImZpbmFsbHkiXSAhPT0gbWV0aG9kKSB7CiAgICAgICAgICByZWRlZmluZShOYXRpdmVQcm9taXNlLnByb3RvdHlwZSwgImZpbmFsbHkiLCBtZXRob2QsIHsgdW5zYWZlOiB0cnVlIH0pOwogICAgICAgIH0KICAgICAgfQogICAgICB2YXIgbWV0aG9kOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL3Byb21pc2UvaW5kZXguanMKICB2YXIgcmVxdWlyZV9wcm9taXNlID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9wcm9taXNlL2luZGV4LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICByZXF1aXJlX2VzX2FnZ3JlZ2F0ZV9lcnJvcigpOwogICAgICByZXF1aXJlX2VzX2FycmF5X2l0ZXJhdG9yKCk7CiAgICAgIHJlcXVpcmVfZXNfb2JqZWN0X3RvX3N0cmluZygpOwogICAgICByZXF1aXJlX2VzX3Byb21pc2UoKTsKICAgICAgcmVxdWlyZV9lc19wcm9taXNlX2FsbF9zZXR0bGVkKCk7CiAgICAgIHJlcXVpcmVfZXNfcHJvbWlzZV9hbnkoKTsKICAgICAgcmVxdWlyZV9lc19wcm9taXNlX2ZpbmFsbHkoKTsKICAgICAgcmVxdWlyZV9lc19zdHJpbmdfaXRlcmF0b3IoKTsKICAgICAgdmFyIHBhdGggPSByZXF1aXJlX3BhdGgoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXRoLlByb21pc2U7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL3Byb21pc2UvaW5kZXguanMKICB2YXIgcmVxdWlyZV9wcm9taXNlMiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL3Byb21pc2UvaW5kZXguanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX3Byb21pc2UoKTsKICAgICAgcmVxdWlyZV93ZWJfZG9tX2NvbGxlY3Rpb25zX2l0ZXJhdG9yKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGFyZW50OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXNuZXh0LmFnZ3JlZ2F0ZS1lcnJvci5qcwogIHZhciByZXF1aXJlX2VzbmV4dF9hZ2dyZWdhdGVfZXJyb3IgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXNuZXh0LmFnZ3JlZ2F0ZS1lcnJvci5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgcmVxdWlyZV9lc19hZ2dyZWdhdGVfZXJyb3IoKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzbmV4dC5wcm9taXNlLmFsbC1zZXR0bGVkLmpzCiAgdmFyIHJlcXVpcmVfZXNuZXh0X3Byb21pc2VfYWxsX3NldHRsZWQgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXNuZXh0LnByb21pc2UuYWxsLXNldHRsZWQuanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHJlcXVpcmVfZXNfcHJvbWlzZV9hbGxfc2V0dGxlZCgpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXNuZXh0LnByb21pc2UudHJ5LmpzCiAgdmFyIHJlcXVpcmVfZXNuZXh0X3Byb21pc2VfdHJ5ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzbmV4dC5wcm9taXNlLnRyeS5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgJCA9IHJlcXVpcmVfZXhwb3J0KCk7CiAgICAgIHZhciBuZXdQcm9taXNlQ2FwYWJpbGl0eU1vZHVsZSA9IHJlcXVpcmVfbmV3X3Byb21pc2VfY2FwYWJpbGl0eSgpOwogICAgICB2YXIgcGVyZm9ybSA9IHJlcXVpcmVfcGVyZm9ybSgpOwogICAgICAkKHsgdGFyZ2V0OiAiUHJvbWlzZSIsIHN0YXQ6IHRydWUgfSwgewogICAgICAgICJ0cnkiOiBmdW5jdGlvbihjYWxsYmFja2ZuKSB7CiAgICAgICAgICB2YXIgcHJvbWlzZUNhcGFiaWxpdHkgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eU1vZHVsZS5mKHRoaXMpOwogICAgICAgICAgdmFyIHJlc3VsdCA9IHBlcmZvcm0oY2FsbGJhY2tmbik7CiAgICAgICAgICAocmVzdWx0LmVycm9yID8gcHJvbWlzZUNhcGFiaWxpdHkucmVqZWN0IDogcHJvbWlzZUNhcGFiaWxpdHkucmVzb2x2ZSkocmVzdWx0LnZhbHVlKTsKICAgICAgICAgIHJldHVybiBwcm9taXNlQ2FwYWJpbGl0eS5wcm9taXNlOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lc25leHQucHJvbWlzZS5hbnkuanMKICB2YXIgcmVxdWlyZV9lc25leHRfcHJvbWlzZV9hbnkgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXNuZXh0LnByb21pc2UuYW55LmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICByZXF1aXJlX2VzX3Byb21pc2VfYW55KCk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZmVhdHVyZXMvcHJvbWlzZS9pbmRleC5qcwogIHZhciByZXF1aXJlX3Byb21pc2UzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9mZWF0dXJlcy9wcm9taXNlL2luZGV4LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgcGFyZW50ID0gcmVxdWlyZV9wcm9taXNlMigpOwogICAgICByZXF1aXJlX2VzbmV4dF9hZ2dyZWdhdGVfZXJyb3IoKTsKICAgICAgcmVxdWlyZV9lc25leHRfcHJvbWlzZV9hbGxfc2V0dGxlZCgpOwogICAgICByZXF1aXJlX2VzbmV4dF9wcm9taXNlX3RyeSgpOwogICAgICByZXF1aXJlX2VzbmV4dF9wcm9taXNlX2FueSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhcmVudDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy9wcm9taXNlLmpzCiAgdmFyIHJlcXVpcmVfcHJvbWlzZTQgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzL3Byb21pc2UuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZV9wcm9taXNlMygpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9oZWxwZXJzL2FzeW5jVG9HZW5lcmF0b3IuanMKICB2YXIgcmVxdWlyZV9hc3luY1RvR2VuZXJhdG9yID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy9hc3luY1RvR2VuZXJhdG9yLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgX1Byb21pc2UgPSByZXF1aXJlX3Byb21pc2U0KCk7CiAgICAgIGZ1bmN0aW9uIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywga2V5LCBhcmcpIHsKICAgICAgICB0cnkgewogICAgICAgICAgdmFyIGluZm8gPSBnZW5ba2V5XShhcmcpOwogICAgICAgICAgdmFyIHZhbHVlID0gaW5mby52YWx1ZTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgcmVqZWN0KGVycm9yKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKGluZm8uZG9uZSkgewogICAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF9Qcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHNlbGYyID0gdGhpcywgYXJncyA9IGFyZ3VtZW50czsKICAgICAgICAgIHJldHVybiBuZXcgX1Byb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgIHZhciBnZW4gPSBmbi5hcHBseShzZWxmMiwgYXJncyk7CiAgICAgICAgICAgIGZ1bmN0aW9uIF9uZXh0KHZhbHVlKSB7CiAgICAgICAgICAgICAgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBfdGhyb3coZXJyKSB7CiAgICAgICAgICAgICAgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9uZXh0KHZvaWQgMCk7CiAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICB9CiAgICAgIG1vZHVsZS5leHBvcnRzID0gX2FzeW5jVG9HZW5lcmF0b3I7CiAgICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMtc3RhYmxlL2luc3RhbmNlL3NsaWNlLmpzCiAgdmFyIHJlcXVpcmVfc2xpY2U2ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy1zdGFibGUvaW5zdGFuY2Uvc2xpY2UuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZV9zbGljZTMoKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy9jbGFzc0NhbGxDaGVjay5qcwogIHZhciByZXF1aXJlX2NsYXNzQ2FsbENoZWNrID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy9jbGFzc0NhbGxDaGVjay5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogICAgICAgIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfY2xhc3NDYWxsQ2hlY2s7CiAgICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2hlbHBlcnMvY3JlYXRlQ2xhc3MuanMKICB2YXIgcmVxdWlyZV9jcmVhdGVDbGFzcyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2hlbHBlcnMvY3JlYXRlQ2xhc3MuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBfT2JqZWN0JGRlZmluZVByb3BlcnR5ID0gcmVxdWlyZV9kZWZpbmVfcHJvcGVydHk1KCk7CiAgICAgIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOwogICAgICAgICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwogICAgICAgICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgICAgICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikKICAgICAgICAgICAgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7CiAgICAgICAgICBfT2JqZWN0JGRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgICAgICAgaWYgKHByb3RvUHJvcHMpCiAgICAgICAgICBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOwogICAgICAgIGlmIChzdGF0aWNQcm9wcykKICAgICAgICAgIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgICAgICAgcmV0dXJuIENvbnN0cnVjdG9yOwogICAgICB9CiAgICAgIG1vZHVsZS5leHBvcnRzID0gX2NyZWF0ZUNsYXNzOwogICAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMub2JqZWN0LmNyZWF0ZS5qcwogIHZhciByZXF1aXJlX2VzX29iamVjdF9jcmVhdGUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMub2JqZWN0LmNyZWF0ZS5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyICQgPSByZXF1aXJlX2V4cG9ydCgpOwogICAgICB2YXIgREVTQ1JJUFRPUlMgPSByZXF1aXJlX2Rlc2NyaXB0b3JzKCk7CiAgICAgIHZhciBjcmVhdGUgPSByZXF1aXJlX29iamVjdF9jcmVhdGUoKTsKICAgICAgJCh7IHRhcmdldDogIk9iamVjdCIsIHN0YXQ6IHRydWUsIHNoYW06ICFERVNDUklQVE9SUyB9LCB7CiAgICAgICAgY3JlYXRlCiAgICAgIH0pOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL29iamVjdC9jcmVhdGUuanMKICB2YXIgcmVxdWlyZV9jcmVhdGUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL29iamVjdC9jcmVhdGUuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHJlcXVpcmVfZXNfb2JqZWN0X2NyZWF0ZSgpOwogICAgICB2YXIgcGF0aCA9IHJlcXVpcmVfcGF0aCgpOwogICAgICB2YXIgT2JqZWN0MiA9IHBhdGguT2JqZWN0OwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGNyZWF0ZShQLCBEKSB7CiAgICAgICAgcmV0dXJuIE9iamVjdDIuY3JlYXRlKFAsIEQpOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9vYmplY3QvY3JlYXRlLmpzCiAgdmFyIHJlcXVpcmVfY3JlYXRlMiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL29iamVjdC9jcmVhdGUuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX2NyZWF0ZSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhcmVudDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9mZWF0dXJlcy9vYmplY3QvY3JlYXRlLmpzCiAgdmFyIHJlcXVpcmVfY3JlYXRlMyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZmVhdHVyZXMvb2JqZWN0L2NyZWF0ZS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHBhcmVudCA9IHJlcXVpcmVfY3JlYXRlMigpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhcmVudDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy9vYmplY3QvY3JlYXRlLmpzCiAgdmFyIHJlcXVpcmVfY3JlYXRlNCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMvb2JqZWN0L2NyZWF0ZS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlX2NyZWF0ZTMoKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLm9iamVjdC5zZXQtcHJvdG90eXBlLW9mLmpzCiAgdmFyIHJlcXVpcmVfZXNfb2JqZWN0X3NldF9wcm90b3R5cGVfb2YgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMub2JqZWN0LnNldC1wcm90b3R5cGUtb2YuanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciAkID0gcmVxdWlyZV9leHBvcnQoKTsKICAgICAgdmFyIHNldFByb3RvdHlwZU9mID0gcmVxdWlyZV9vYmplY3Rfc2V0X3Byb3RvdHlwZV9vZigpOwogICAgICAkKHsgdGFyZ2V0OiAiT2JqZWN0Iiwgc3RhdDogdHJ1ZSB9LCB7CiAgICAgICAgc2V0UHJvdG90eXBlT2YKICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvb2JqZWN0L3NldC1wcm90b3R5cGUtb2YuanMKICB2YXIgcmVxdWlyZV9zZXRfcHJvdG90eXBlX29mID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9vYmplY3Qvc2V0LXByb3RvdHlwZS1vZi5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgcmVxdWlyZV9lc19vYmplY3Rfc2V0X3Byb3RvdHlwZV9vZigpOwogICAgICB2YXIgcGF0aCA9IHJlcXVpcmVfcGF0aCgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhdGguT2JqZWN0LnNldFByb3RvdHlwZU9mOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9vYmplY3Qvc2V0LXByb3RvdHlwZS1vZi5qcwogIHZhciByZXF1aXJlX3NldF9wcm90b3R5cGVfb2YyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvb2JqZWN0L3NldC1wcm90b3R5cGUtb2YuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX3NldF9wcm90b3R5cGVfb2YoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXJlbnQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZmVhdHVyZXMvb2JqZWN0L3NldC1wcm90b3R5cGUtb2YuanMKICB2YXIgcmVxdWlyZV9zZXRfcHJvdG90eXBlX29mMyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZmVhdHVyZXMvb2JqZWN0L3NldC1wcm90b3R5cGUtb2YuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX3NldF9wcm90b3R5cGVfb2YyKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGFyZW50OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzL29iamVjdC9zZXQtcHJvdG90eXBlLW9mLmpzCiAgdmFyIHJlcXVpcmVfc2V0X3Byb3RvdHlwZV9vZjQgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzL29iamVjdC9zZXQtcHJvdG90eXBlLW9mLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmVfc2V0X3Byb3RvdHlwZV9vZjMoKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy9zZXRQcm90b3R5cGVPZi5qcwogIHZhciByZXF1aXJlX3NldFByb3RvdHlwZU9mID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy9zZXRQcm90b3R5cGVPZi5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIF9PYmplY3Qkc2V0UHJvdG90eXBlT2YgPSByZXF1aXJlX3NldF9wcm90b3R5cGVfb2Y0KCk7CiAgICAgIGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfc2V0UHJvdG90eXBlT2YgPSBfT2JqZWN0JHNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZjIobzIsIHAyKSB7CiAgICAgICAgICBvMi5fX3Byb3RvX18gPSBwMjsKICAgICAgICAgIHJldHVybiBvMjsKICAgICAgICB9OwogICAgICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgICAgICAgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsKICAgICAgfQogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9zZXRQcm90b3R5cGVPZjsKICAgICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy9pbmhlcml0cy5qcwogIHZhciByZXF1aXJlX2luaGVyaXRzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy9pbmhlcml0cy5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIF9PYmplY3QkY3JlYXRlID0gcmVxdWlyZV9jcmVhdGU0KCk7CiAgICAgIHZhciBzZXRQcm90b3R5cGVPZiA9IHJlcXVpcmVfc2V0UHJvdG90eXBlT2YoKTsKICAgICAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7CiAgICAgICAgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7CiAgICAgICAgfQogICAgICAgIHN1YkNsYXNzLnByb3RvdHlwZSA9IF9PYmplY3QkY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsKICAgICAgICAgIGNvbnN0cnVjdG9yOiB7CiAgICAgICAgICAgIHZhbHVlOiBzdWJDbGFzcywKICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGlmIChzdXBlckNsYXNzKQogICAgICAgICAgc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOwogICAgICB9CiAgICAgIG1vZHVsZS5leHBvcnRzID0gX2luaGVyaXRzOwogICAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL3N5bWJvbC9pdGVyYXRvci5qcwogIHZhciByZXF1aXJlX2l0ZXJhdG9yID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9zeW1ib2wvaXRlcmF0b3IuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHJlcXVpcmVfZXNfYXJyYXlfaXRlcmF0b3IoKTsKICAgICAgcmVxdWlyZV9lc19vYmplY3RfdG9fc3RyaW5nKCk7CiAgICAgIHJlcXVpcmVfZXNfc3RyaW5nX2l0ZXJhdG9yKCk7CiAgICAgIHJlcXVpcmVfZXNfc3ltYm9sX2l0ZXJhdG9yKCk7CiAgICAgIHZhciBXcmFwcGVkV2VsbEtub3duU3ltYm9sTW9kdWxlID0gcmVxdWlyZV93ZWxsX2tub3duX3N5bWJvbF93cmFwcGVkKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gV3JhcHBlZFdlbGxLbm93blN5bWJvbE1vZHVsZS5mKCJpdGVyYXRvciIpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9zeW1ib2wvaXRlcmF0b3IuanMKICB2YXIgcmVxdWlyZV9pdGVyYXRvcjIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9zeW1ib2wvaXRlcmF0b3IuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX2l0ZXJhdG9yKCk7CiAgICAgIHJlcXVpcmVfd2ViX2RvbV9jb2xsZWN0aW9uc19pdGVyYXRvcigpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhcmVudDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9mZWF0dXJlcy9zeW1ib2wvaXRlcmF0b3IuanMKICB2YXIgcmVxdWlyZV9pdGVyYXRvcjMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ZlYXR1cmVzL3N5bWJvbC9pdGVyYXRvci5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHBhcmVudCA9IHJlcXVpcmVfaXRlcmF0b3IyKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGFyZW50OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzL3N5bWJvbC9pdGVyYXRvci5qcwogIHZhciByZXF1aXJlX2l0ZXJhdG9yNCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMvc3ltYm9sL2l0ZXJhdG9yLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmVfaXRlcmF0b3IzKCk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2hlbHBlcnMvdHlwZW9mLmpzCiAgdmFyIHJlcXVpcmVfdHlwZW9mID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy90eXBlb2YuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBfU3ltYm9sID0gcmVxdWlyZV9zeW1ib2w1KCk7CiAgICAgIHZhciBfU3ltYm9sJGl0ZXJhdG9yID0gcmVxdWlyZV9pdGVyYXRvcjQoKTsKICAgICAgZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgICAiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiOwogICAgICAgIGlmICh0eXBlb2YgX1N5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgX1N5bWJvbCRpdGVyYXRvciA9PT0gInN5bWJvbCIpIHsKICAgICAgICAgIG1vZHVsZS5leHBvcnRzID0gX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iajIpIHsKICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBvYmoyOwogICAgICAgICAgfTsKICAgICAgICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1vZHVsZS5leHBvcnRzID0gX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iajIpIHsKICAgICAgICAgICAgcmV0dXJuIG9iajIgJiYgdHlwZW9mIF9TeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqMi5jb25zdHJ1Y3RvciA9PT0gX1N5bWJvbCAmJiBvYmoyICE9PSBfU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajI7CiAgICAgICAgICB9OwogICAgICAgICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF90eXBlb2Yob2JqKTsKICAgICAgfQogICAgICBtb2R1bGUuZXhwb3J0cyA9IF90eXBlb2Y7CiAgICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2hlbHBlcnMvYXNzZXJ0VGhpc0luaXRpYWxpemVkLmpzCiAgdmFyIHJlcXVpcmVfYXNzZXJ0VGhpc0luaXRpYWxpemVkID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIGZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZjIpIHsKICAgICAgICBpZiAoc2VsZjIgPT09IHZvaWQgMCkgewogICAgICAgICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGYyOwogICAgICB9CiAgICAgIG1vZHVsZS5leHBvcnRzID0gX2Fzc2VydFRoaXNJbml0aWFsaXplZDsKICAgICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuLmpzCiAgdmFyIHJlcXVpcmVfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2hlbHBlcnMvcG9zc2libGVDb25zdHJ1Y3RvclJldHVybi5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIF90eXBlb2YgPSByZXF1aXJlX3R5cGVvZigpWyJkZWZhdWx0Il07CiAgICAgIHZhciBhc3NlcnRUaGlzSW5pdGlhbGl6ZWQgPSByZXF1aXJlX2Fzc2VydFRoaXNJbml0aWFsaXplZCgpOwogICAgICBmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmMiwgY2FsbCkgewogICAgICAgIGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsKICAgICAgICAgIHJldHVybiBjYWxsOwogICAgICAgIH0gZWxzZSBpZiAoY2FsbCAhPT0gdm9pZCAwKSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJEZXJpdmVkIGNvbnN0cnVjdG9ycyBtYXkgb25seSByZXR1cm4gb2JqZWN0IG9yIHVuZGVmaW5lZCIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYyKTsKICAgICAgfQogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuOwogICAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMub2JqZWN0LmdldC1wcm90b3R5cGUtb2YuanMKICB2YXIgcmVxdWlyZV9lc19vYmplY3RfZ2V0X3Byb3RvdHlwZV9vZiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LXByb3RvdHlwZS1vZi5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyICQgPSByZXF1aXJlX2V4cG9ydCgpOwogICAgICB2YXIgZmFpbHMgPSByZXF1aXJlX2ZhaWxzKCk7CiAgICAgIHZhciB0b09iamVjdCA9IHJlcXVpcmVfdG9fb2JqZWN0KCk7CiAgICAgIHZhciBuYXRpdmVHZXRQcm90b3R5cGVPZiA9IHJlcXVpcmVfb2JqZWN0X2dldF9wcm90b3R5cGVfb2YoKTsKICAgICAgdmFyIENPUlJFQ1RfUFJPVE9UWVBFX0dFVFRFUiA9IHJlcXVpcmVfY29ycmVjdF9wcm90b3R5cGVfZ2V0dGVyKCk7CiAgICAgIHZhciBGQUlMU19PTl9QUklNSVRJVkVTID0gZmFpbHMoZnVuY3Rpb24oKSB7CiAgICAgICAgbmF0aXZlR2V0UHJvdG90eXBlT2YoMSk7CiAgICAgIH0pOwogICAgICAkKHsgdGFyZ2V0OiAiT2JqZWN0Iiwgc3RhdDogdHJ1ZSwgZm9yY2VkOiBGQUlMU19PTl9QUklNSVRJVkVTLCBzaGFtOiAhQ09SUkVDVF9QUk9UT1RZUEVfR0VUVEVSIH0sIHsKICAgICAgICBnZXRQcm90b3R5cGVPZjogZnVuY3Rpb24gZ2V0UHJvdG90eXBlT2YoaXQpIHsKICAgICAgICAgIHJldHVybiBuYXRpdmVHZXRQcm90b3R5cGVPZih0b09iamVjdChpdCkpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvb2JqZWN0L2dldC1wcm90b3R5cGUtb2YuanMKICB2YXIgcmVxdWlyZV9nZXRfcHJvdG90eXBlX29mID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9vYmplY3QvZ2V0LXByb3RvdHlwZS1vZi5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgcmVxdWlyZV9lc19vYmplY3RfZ2V0X3Byb3RvdHlwZV9vZigpOwogICAgICB2YXIgcGF0aCA9IHJlcXVpcmVfcGF0aCgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhdGguT2JqZWN0LmdldFByb3RvdHlwZU9mOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9vYmplY3QvZ2V0LXByb3RvdHlwZS1vZi5qcwogIHZhciByZXF1aXJlX2dldF9wcm90b3R5cGVfb2YyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvb2JqZWN0L2dldC1wcm90b3R5cGUtb2YuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX2dldF9wcm90b3R5cGVfb2YoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXJlbnQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZmVhdHVyZXMvb2JqZWN0L2dldC1wcm90b3R5cGUtb2YuanMKICB2YXIgcmVxdWlyZV9nZXRfcHJvdG90eXBlX29mMyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZmVhdHVyZXMvb2JqZWN0L2dldC1wcm90b3R5cGUtb2YuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX2dldF9wcm90b3R5cGVfb2YyKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGFyZW50OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzL29iamVjdC9nZXQtcHJvdG90eXBlLW9mLmpzCiAgdmFyIHJlcXVpcmVfZ2V0X3Byb3RvdHlwZV9vZjQgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzL29iamVjdC9nZXQtcHJvdG90eXBlLW9mLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmVfZ2V0X3Byb3RvdHlwZV9vZjMoKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy9nZXRQcm90b3R5cGVPZi5qcwogIHZhciByZXF1aXJlX2dldFByb3RvdHlwZU9mID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy9nZXRQcm90b3R5cGVPZi5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIF9PYmplY3Qkc2V0UHJvdG90eXBlT2YgPSByZXF1aXJlX3NldF9wcm90b3R5cGVfb2Y0KCk7CiAgICAgIHZhciBfT2JqZWN0JGdldFByb3RvdHlwZU9mID0gcmVxdWlyZV9nZXRfcHJvdG90eXBlX29mNCgpOwogICAgICBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogICAgICAgIG1vZHVsZS5leHBvcnRzID0gX2dldFByb3RvdHlwZU9mID0gX09iamVjdCRzZXRQcm90b3R5cGVPZiA/IF9PYmplY3QkZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YyKG8yKSB7CiAgICAgICAgICByZXR1cm4gbzIuX19wcm90b19fIHx8IF9PYmplY3QkZ2V0UHJvdG90eXBlT2YobzIpOwogICAgICAgIH07CiAgICAgICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICAgICAgICByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOwogICAgICB9CiAgICAgIG1vZHVsZS5leHBvcnRzID0gX2dldFByb3RvdHlwZU9mOwogICAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvbG9uZy9zcmMvbG9uZy5qcwogIHZhciByZXF1aXJlX2xvbmcgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvbG9uZy9zcmMvbG9uZy5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBMb25nOwogICAgICB2YXIgd2FzbSA9IG51bGw7CiAgICAgIHRyeSB7CiAgICAgICAgd2FzbSA9IG5ldyBXZWJBc3NlbWJseS5JbnN0YW5jZShuZXcgV2ViQXNzZW1ibHkuTW9kdWxlKG5ldyBVaW50OEFycmF5KFsKICAgICAgICAgIDAsCiAgICAgICAgICA5NywKICAgICAgICAgIDExNSwKICAgICAgICAgIDEwOSwKICAgICAgICAgIDEsCiAgICAgICAgICAwLAogICAgICAgICAgMCwKICAgICAgICAgIDAsCiAgICAgICAgICAxLAogICAgICAgICAgMTMsCiAgICAgICAgICAyLAogICAgICAgICAgOTYsCiAgICAgICAgICAwLAogICAgICAgICAgMSwKICAgICAgICAgIDEyNywKICAgICAgICAgIDk2LAogICAgICAgICAgNCwKICAgICAgICAgIDEyNywKICAgICAgICAgIDEyNywKICAgICAgICAgIDEyNywKICAgICAgICAgIDEyNywKICAgICAgICAgIDEsCiAgICAgICAgICAxMjcsCiAgICAgICAgICAzLAogICAgICAgICAgNywKICAgICAgICAgIDYsCiAgICAgICAgICAwLAogICAgICAgICAgMSwKICAgICAgICAgIDEsCiAgICAgICAgICAxLAogICAgICAgICAgMSwKICAgICAgICAgIDEsCiAgICAgICAgICA2LAogICAgICAgICAgNiwKICAgICAgICAgIDEsCiAgICAgICAgICAxMjcsCiAgICAgICAgICAxLAogICAgICAgICAgNjUsCiAgICAgICAgICAwLAogICAgICAgICAgMTEsCiAgICAgICAgICA3LAogICAgICAgICAgNTAsCiAgICAgICAgICA2LAogICAgICAgICAgMywKICAgICAgICAgIDEwOSwKICAgICAgICAgIDExNywKICAgICAgICAgIDEwOCwKICAgICAgICAgIDAsCiAgICAgICAgICAxLAogICAgICAgICAgNSwKICAgICAgICAgIDEwMCwKICAgICAgICAgIDEwNSwKICAgICAgICAgIDExOCwKICAgICAgICAgIDk1LAogICAgICAgICAgMTE1LAogICAgICAgICAgMCwKICAgICAgICAgIDIsCiAgICAgICAgICA1LAogICAgICAgICAgMTAwLAogICAgICAgICAgMTA1LAogICAgICAgICAgMTE4LAogICAgICAgICAgOTUsCiAgICAgICAgICAxMTcsCiAgICAgICAgICAwLAogICAgICAgICAgMywKICAgICAgICAgIDUsCiAgICAgICAgICAxMTQsCiAgICAgICAgICAxMDEsCiAgICAgICAgICAxMDksCiAgICAgICAgICA5NSwKICAgICAgICAgIDExNSwKICAgICAgICAgIDAsCiAgICAgICAgICA0LAogICAgICAgICAgNSwKICAgICAgICAgIDExNCwKICAgICAgICAgIDEwMSwKICAgICAgICAgIDEwOSwKICAgICAgICAgIDk1LAogICAgICAgICAgMTE3LAogICAgICAgICAgMCwKICAgICAgICAgIDUsCiAgICAgICAgICA4LAogICAgICAgICAgMTAzLAogICAgICAgICAgMTAxLAogICAgICAgICAgMTE2LAogICAgICAgICAgOTUsCiAgICAgICAgICAxMDQsCiAgICAgICAgICAxMDUsCiAgICAgICAgICAxMDMsCiAgICAgICAgICAxMDQsCiAgICAgICAgICAwLAogICAgICAgICAgMCwKICAgICAgICAgIDEwLAogICAgICAgICAgMTkxLAogICAgICAgICAgMSwKICAgICAgICAgIDYsCiAgICAgICAgICA0LAogICAgICAgICAgMCwKICAgICAgICAgIDM1LAogICAgICAgICAgMCwKICAgICAgICAgIDExLAogICAgICAgICAgMzYsCiAgICAgICAgICAxLAogICAgICAgICAgMSwKICAgICAgICAgIDEyNiwKICAgICAgICAgIDMyLAogICAgICAgICAgMCwKICAgICAgICAgIDE3MywKICAgICAgICAgIDMyLAogICAgICAgICAgMSwKICAgICAgICAgIDE3MywKICAgICAgICAgIDY2LAogICAgICAgICAgMzIsCiAgICAgICAgICAxMzQsCiAgICAgICAgICAxMzIsCiAgICAgICAgICAzMiwKICAgICAgICAgIDIsCiAgICAgICAgICAxNzMsCiAgICAgICAgICAzMiwKICAgICAgICAgIDMsCiAgICAgICAgICAxNzMsCiAgICAgICAgICA2NiwKICAgICAgICAgIDMyLAogICAgICAgICAgMTM0LAogICAgICAgICAgMTMyLAogICAgICAgICAgMTI2LAogICAgICAgICAgMzQsCiAgICAgICAgICA0LAogICAgICAgICAgNjYsCiAgICAgICAgICAzMiwKICAgICAgICAgIDEzNSwKICAgICAgICAgIDE2NywKICAgICAgICAgIDM2LAogICAgICAgICAgMCwKICAgICAgICAgIDMyLAogICAgICAgICAgNCwKICAgICAgICAgIDE2NywKICAgICAgICAgIDExLAogICAgICAgICAgMzYsCiAgICAgICAgICAxLAogICAgICAgICAgMSwKICAgICAgICAgIDEyNiwKICAgICAgICAgIDMyLAogICAgICAgICAgMCwKICAgICAgICAgIDE3MywKICAgICAgICAgIDMyLAogICAgICAgICAgMSwKICAgICAgICAgIDE3MywKICAgICAgICAgIDY2LAogICAgICAgICAgMzIsCiAgICAgICAgICAxMzQsCiAgICAgICAgICAxMzIsCiAgICAgICAgICAzMiwKICAgICAgICAgIDIsCiAgICAgICAgICAxNzMsCiAgICAgICAgICAzMiwKICAgICAgICAgIDMsCiAgICAgICAgICAxNzMsCiAgICAgICAgICA2NiwKICAgICAgICAgIDMyLAogICAgICAgICAgMTM0LAogICAgICAgICAgMTMyLAogICAgICAgICAgMTI3LAogICAgICAgICAgMzQsCiAgICAgICAgICA0LAogICAgICAgICAgNjYsCiAgICAgICAgICAzMiwKICAgICAgICAgIDEzNSwKICAgICAgICAgIDE2NywKICAgICAgICAgIDM2LAogICAgICAgICAgMCwKICAgICAgICAgIDMyLAogICAgICAgICAgNCwKICAgICAgICAgIDE2NywKICAgICAgICAgIDExLAogICAgICAgICAgMzYsCiAgICAgICAgICAxLAogICAgICAgICAgMSwKICAgICAgICAgIDEyNiwKICAgICAgICAgIDMyLAogICAgICAgICAgMCwKICAgICAgICAgIDE3MywKICAgICAgICAgIDMyLAogICAgICAgICAgMSwKICAgICAgICAgIDE3MywKICAgICAgICAgIDY2LAogICAgICAgICAgMzIsCiAgICAgICAgICAxMzQsCiAgICAgICAgICAxMzIsCiAgICAgICAgICAzMiwKICAgICAgICAgIDIsCiAgICAgICAgICAxNzMsCiAgICAgICAgICAzMiwKICAgICAgICAgIDMsCiAgICAgICAgICAxNzMsCiAgICAgICAgICA2NiwKICAgICAgICAgIDMyLAogICAgICAgICAgMTM0LAogICAgICAgICAgMTMyLAogICAgICAgICAgMTI4LAogICAgICAgICAgMzQsCiAgICAgICAgICA0LAogICAgICAgICAgNjYsCiAgICAgICAgICAzMiwKICAgICAgICAgIDEzNSwKICAgICAgICAgIDE2NywKICAgICAgICAgIDM2LAogICAgICAgICAgMCwKICAgICAgICAgIDMyLAogICAgICAgICAgNCwKICAgICAgICAgIDE2NywKICAgICAgICAgIDExLAogICAgICAgICAgMzYsCiAgICAgICAgICAxLAogICAgICAgICAgMSwKICAgICAgICAgIDEyNiwKICAgICAgICAgIDMyLAogICAgICAgICAgMCwKICAgICAgICAgIDE3MywKICAgICAgICAgIDMyLAogICAgICAgICAgMSwKICAgICAgICAgIDE3MywKICAgICAgICAgIDY2LAogICAgICAgICAgMzIsCiAgICAgICAgICAxMzQsCiAgICAgICAgICAxMzIsCiAgICAgICAgICAzMiwKICAgICAgICAgIDIsCiAgICAgICAgICAxNzMsCiAgICAgICAgICAzMiwKICAgICAgICAgIDMsCiAgICAgICAgICAxNzMsCiAgICAgICAgICA2NiwKICAgICAgICAgIDMyLAogICAgICAgICAgMTM0LAogICAgICAgICAgMTMyLAogICAgICAgICAgMTI5LAogICAgICAgICAgMzQsCiAgICAgICAgICA0LAogICAgICAgICAgNjYsCiAgICAgICAgICAzMiwKICAgICAgICAgIDEzNSwKICAgICAgICAgIDE2NywKICAgICAgICAgIDM2LAogICAgICAgICAgMCwKICAgICAgICAgIDMyLAogICAgICAgICAgNCwKICAgICAgICAgIDE2NywKICAgICAgICAgIDExLAogICAgICAgICAgMzYsCiAgICAgICAgICAxLAogICAgICAgICAgMSwKICAgICAgICAgIDEyNiwKICAgICAgICAgIDMyLAogICAgICAgICAgMCwKICAgICAgICAgIDE3MywKICAgICAgICAgIDMyLAogICAgICAgICAgMSwKICAgICAgICAgIDE3MywKICAgICAgICAgIDY2LAogICAgICAgICAgMzIsCiAgICAgICAgICAxMzQsCiAgICAgICAgICAxMzIsCiAgICAgICAgICAzMiwKICAgICAgICAgIDIsCiAgICAgICAgICAxNzMsCiAgICAgICAgICAzMiwKICAgICAgICAgIDMsCiAgICAgICAgICAxNzMsCiAgICAgICAgICA2NiwKICAgICAgICAgIDMyLAogICAgICAgICAgMTM0LAogICAgICAgICAgMTMyLAogICAgICAgICAgMTMwLAogICAgICAgICAgMzQsCiAgICAgICAgICA0LAogICAgICAgICAgNjYsCiAgICAgICAgICAzMiwKICAgICAgICAgIDEzNSwKICAgICAgICAgIDE2NywKICAgICAgICAgIDM2LAogICAgICAgICAgMCwKICAgICAgICAgIDMyLAogICAgICAgICAgNCwKICAgICAgICAgIDE2NywKICAgICAgICAgIDExCiAgICAgICAgXSkpLCB7fSkuZXhwb3J0czsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICB9CiAgICAgIGZ1bmN0aW9uIExvbmcobG93LCBoaWdoLCB1bnNpZ25lZCkgewogICAgICAgIHRoaXMubG93ID0gbG93IHwgMDsKICAgICAgICB0aGlzLmhpZ2ggPSBoaWdoIHwgMDsKICAgICAgICB0aGlzLnVuc2lnbmVkID0gISF1bnNpZ25lZDsKICAgICAgfQogICAgICBMb25nLnByb3RvdHlwZS5fX2lzTG9uZ19fOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTG9uZy5wcm90b3R5cGUsICJfX2lzTG9uZ19fIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICAgICAgZnVuY3Rpb24gaXNMb25nKG9iaikgewogICAgICAgIHJldHVybiAob2JqICYmIG9ialsiX19pc0xvbmdfXyJdKSA9PT0gdHJ1ZTsKICAgICAgfQogICAgICBMb25nLmlzTG9uZyA9IGlzTG9uZzsKICAgICAgdmFyIElOVF9DQUNIRSA9IHt9OwogICAgICB2YXIgVUlOVF9DQUNIRSA9IHt9OwogICAgICBmdW5jdGlvbiBmcm9tSW50KHZhbHVlLCB1bnNpZ25lZCkgewogICAgICAgIHZhciBvYmosIGNhY2hlZE9iaiwgY2FjaGU7CiAgICAgICAgaWYgKHVuc2lnbmVkKSB7CiAgICAgICAgICB2YWx1ZSA+Pj49IDA7CiAgICAgICAgICBpZiAoY2FjaGUgPSAwIDw9IHZhbHVlICYmIHZhbHVlIDwgMjU2KSB7CiAgICAgICAgICAgIGNhY2hlZE9iaiA9IFVJTlRfQ0FDSEVbdmFsdWVdOwogICAgICAgICAgICBpZiAoY2FjaGVkT2JqKQogICAgICAgICAgICAgIHJldHVybiBjYWNoZWRPYmo7CiAgICAgICAgICB9CiAgICAgICAgICBvYmogPSBmcm9tQml0cyh2YWx1ZSwgKHZhbHVlIHwgMCkgPCAwID8gLTEgOiAwLCB0cnVlKTsKICAgICAgICAgIGlmIChjYWNoZSkKICAgICAgICAgICAgVUlOVF9DQUNIRVt2YWx1ZV0gPSBvYmo7CiAgICAgICAgICByZXR1cm4gb2JqOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YWx1ZSB8PSAwOwogICAgICAgICAgaWYgKGNhY2hlID0gLTEyOCA8PSB2YWx1ZSAmJiB2YWx1ZSA8IDEyOCkgewogICAgICAgICAgICBjYWNoZWRPYmogPSBJTlRfQ0FDSEVbdmFsdWVdOwogICAgICAgICAgICBpZiAoY2FjaGVkT2JqKQogICAgICAgICAgICAgIHJldHVybiBjYWNoZWRPYmo7CiAgICAgICAgICB9CiAgICAgICAgICBvYmogPSBmcm9tQml0cyh2YWx1ZSwgdmFsdWUgPCAwID8gLTEgOiAwLCBmYWxzZSk7CiAgICAgICAgICBpZiAoY2FjaGUpCiAgICAgICAgICAgIElOVF9DQUNIRVt2YWx1ZV0gPSBvYmo7CiAgICAgICAgICByZXR1cm4gb2JqOwogICAgICAgIH0KICAgICAgfQogICAgICBMb25nLmZyb21JbnQgPSBmcm9tSW50OwogICAgICBmdW5jdGlvbiBmcm9tTnVtYmVyKHZhbHVlLCB1bnNpZ25lZCkgewogICAgICAgIGlmIChpc05hTih2YWx1ZSkpCiAgICAgICAgICByZXR1cm4gdW5zaWduZWQgPyBVWkVSTyA6IFpFUk87CiAgICAgICAgaWYgKHVuc2lnbmVkKSB7CiAgICAgICAgICBpZiAodmFsdWUgPCAwKQogICAgICAgICAgICByZXR1cm4gVVpFUk87CiAgICAgICAgICBpZiAodmFsdWUgPj0gVFdPX1BXUl82NF9EQkwpCiAgICAgICAgICAgIHJldHVybiBNQVhfVU5TSUdORURfVkFMVUU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICh2YWx1ZSA8PSAtVFdPX1BXUl82M19EQkwpCiAgICAgICAgICAgIHJldHVybiBNSU5fVkFMVUU7CiAgICAgICAgICBpZiAodmFsdWUgKyAxID49IFRXT19QV1JfNjNfREJMKQogICAgICAgICAgICByZXR1cm4gTUFYX1ZBTFVFOwogICAgICAgIH0KICAgICAgICBpZiAodmFsdWUgPCAwKQogICAgICAgICAgcmV0dXJuIGZyb21OdW1iZXIoLXZhbHVlLCB1bnNpZ25lZCkubmVnKCk7CiAgICAgICAgcmV0dXJuIGZyb21CaXRzKHZhbHVlICUgVFdPX1BXUl8zMl9EQkwgfCAwLCB2YWx1ZSAvIFRXT19QV1JfMzJfREJMIHwgMCwgdW5zaWduZWQpOwogICAgICB9CiAgICAgIExvbmcuZnJvbU51bWJlciA9IGZyb21OdW1iZXI7CiAgICAgIGZ1bmN0aW9uIGZyb21CaXRzKGxvd0JpdHMsIGhpZ2hCaXRzLCB1bnNpZ25lZCkgewogICAgICAgIHJldHVybiBuZXcgTG9uZyhsb3dCaXRzLCBoaWdoQml0cywgdW5zaWduZWQpOwogICAgICB9CiAgICAgIExvbmcuZnJvbUJpdHMgPSBmcm9tQml0czsKICAgICAgdmFyIHBvd19kYmwgPSBNYXRoLnBvdzsKICAgICAgZnVuY3Rpb24gZnJvbVN0cmluZyhzdHIsIHVuc2lnbmVkLCByYWRpeCkgewogICAgICAgIGlmIChzdHIubGVuZ3RoID09PSAwKQogICAgICAgICAgdGhyb3cgRXJyb3IoImVtcHR5IHN0cmluZyIpOwogICAgICAgIGlmIChzdHIgPT09ICJOYU4iIHx8IHN0ciA9PT0gIkluZmluaXR5IiB8fCBzdHIgPT09ICIrSW5maW5pdHkiIHx8IHN0ciA9PT0gIi1JbmZpbml0eSIpCiAgICAgICAgICByZXR1cm4gWkVSTzsKICAgICAgICBpZiAodHlwZW9mIHVuc2lnbmVkID09PSAibnVtYmVyIikgewogICAgICAgICAgcmFkaXggPSB1bnNpZ25lZCwgdW5zaWduZWQgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdW5zaWduZWQgPSAhIXVuc2lnbmVkOwogICAgICAgIH0KICAgICAgICByYWRpeCA9IHJhZGl4IHx8IDEwOwogICAgICAgIGlmIChyYWRpeCA8IDIgfHwgMzYgPCByYWRpeCkKICAgICAgICAgIHRocm93IFJhbmdlRXJyb3IoInJhZGl4Iik7CiAgICAgICAgdmFyIHA7CiAgICAgICAgaWYgKChwID0gc3RyLmluZGV4T2YoIi0iKSkgPiAwKQogICAgICAgICAgdGhyb3cgRXJyb3IoImludGVyaW9yIGh5cGhlbiIpOwogICAgICAgIGVsc2UgaWYgKHAgPT09IDApIHsKICAgICAgICAgIHJldHVybiBmcm9tU3RyaW5nKHN0ci5zdWJzdHJpbmcoMSksIHVuc2lnbmVkLCByYWRpeCkubmVnKCk7CiAgICAgICAgfQogICAgICAgIHZhciByYWRpeFRvUG93ZXIgPSBmcm9tTnVtYmVyKHBvd19kYmwocmFkaXgsIDgpKTsKICAgICAgICB2YXIgcmVzdWx0ID0gWkVSTzsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkgKz0gOCkgewogICAgICAgICAgdmFyIHNpemUgPSBNYXRoLm1pbig4LCBzdHIubGVuZ3RoIC0gaSksIHZhbHVlID0gcGFyc2VJbnQoc3RyLnN1YnN0cmluZyhpLCBpICsgc2l6ZSksIHJhZGl4KTsKICAgICAgICAgIGlmIChzaXplIDwgOCkgewogICAgICAgICAgICB2YXIgcG93ZXIgPSBmcm9tTnVtYmVyKHBvd19kYmwocmFkaXgsIHNpemUpKTsKICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0Lm11bChwb3dlcikuYWRkKGZyb21OdW1iZXIodmFsdWUpKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5tdWwocmFkaXhUb1Bvd2VyKTsKICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmFkZChmcm9tTnVtYmVyKHZhbHVlKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJlc3VsdC51bnNpZ25lZCA9IHVuc2lnbmVkOwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgTG9uZy5mcm9tU3RyaW5nID0gZnJvbVN0cmluZzsKICAgICAgZnVuY3Rpb24gZnJvbVZhbHVlKHZhbCwgdW5zaWduZWQpIHsKICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gIm51bWJlciIpCiAgICAgICAgICByZXR1cm4gZnJvbU51bWJlcih2YWwsIHVuc2lnbmVkKTsKICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gInN0cmluZyIpCiAgICAgICAgICByZXR1cm4gZnJvbVN0cmluZyh2YWwsIHVuc2lnbmVkKTsKICAgICAgICByZXR1cm4gZnJvbUJpdHModmFsLmxvdywgdmFsLmhpZ2gsIHR5cGVvZiB1bnNpZ25lZCA9PT0gImJvb2xlYW4iID8gdW5zaWduZWQgOiB2YWwudW5zaWduZWQpOwogICAgICB9CiAgICAgIExvbmcuZnJvbVZhbHVlID0gZnJvbVZhbHVlOwogICAgICB2YXIgVFdPX1BXUl8xNl9EQkwgPSAxIDw8IDE2OwogICAgICB2YXIgVFdPX1BXUl8yNF9EQkwgPSAxIDw8IDI0OwogICAgICB2YXIgVFdPX1BXUl8zMl9EQkwgPSBUV09fUFdSXzE2X0RCTCAqIFRXT19QV1JfMTZfREJMOwogICAgICB2YXIgVFdPX1BXUl82NF9EQkwgPSBUV09fUFdSXzMyX0RCTCAqIFRXT19QV1JfMzJfREJMOwogICAgICB2YXIgVFdPX1BXUl82M19EQkwgPSBUV09fUFdSXzY0X0RCTCAvIDI7CiAgICAgIHZhciBUV09fUFdSXzI0ID0gZnJvbUludChUV09fUFdSXzI0X0RCTCk7CiAgICAgIHZhciBaRVJPID0gZnJvbUludCgwKTsKICAgICAgTG9uZy5aRVJPID0gWkVSTzsKICAgICAgdmFyIFVaRVJPID0gZnJvbUludCgwLCB0cnVlKTsKICAgICAgTG9uZy5VWkVSTyA9IFVaRVJPOwogICAgICB2YXIgT05FID0gZnJvbUludCgxKTsKICAgICAgTG9uZy5PTkUgPSBPTkU7CiAgICAgIHZhciBVT05FID0gZnJvbUludCgxLCB0cnVlKTsKICAgICAgTG9uZy5VT05FID0gVU9ORTsKICAgICAgdmFyIE5FR19PTkUgPSBmcm9tSW50KC0xKTsKICAgICAgTG9uZy5ORUdfT05FID0gTkVHX09ORTsKICAgICAgdmFyIE1BWF9WQUxVRSA9IGZyb21CaXRzKDQyOTQ5NjcyOTUgfCAwLCAyMTQ3NDgzNjQ3IHwgMCwgZmFsc2UpOwogICAgICBMb25nLk1BWF9WQUxVRSA9IE1BWF9WQUxVRTsKICAgICAgdmFyIE1BWF9VTlNJR05FRF9WQUxVRSA9IGZyb21CaXRzKDQyOTQ5NjcyOTUgfCAwLCA0Mjk0OTY3Mjk1IHwgMCwgdHJ1ZSk7CiAgICAgIExvbmcuTUFYX1VOU0lHTkVEX1ZBTFVFID0gTUFYX1VOU0lHTkVEX1ZBTFVFOwogICAgICB2YXIgTUlOX1ZBTFVFID0gZnJvbUJpdHMoMCwgMjE0NzQ4MzY0OCB8IDAsIGZhbHNlKTsKICAgICAgTG9uZy5NSU5fVkFMVUUgPSBNSU5fVkFMVUU7CiAgICAgIHZhciBMb25nUHJvdG90eXBlID0gTG9uZy5wcm90b3R5cGU7CiAgICAgIExvbmdQcm90b3R5cGUudG9JbnQgPSBmdW5jdGlvbiB0b0ludCgpIHsKICAgICAgICByZXR1cm4gdGhpcy51bnNpZ25lZCA/IHRoaXMubG93ID4+PiAwIDogdGhpcy5sb3c7CiAgICAgIH07CiAgICAgIExvbmdQcm90b3R5cGUudG9OdW1iZXIgPSBmdW5jdGlvbiB0b051bWJlcigpIHsKICAgICAgICBpZiAodGhpcy51bnNpZ25lZCkKICAgICAgICAgIHJldHVybiAodGhpcy5oaWdoID4+PiAwKSAqIFRXT19QV1JfMzJfREJMICsgKHRoaXMubG93ID4+PiAwKTsKICAgICAgICByZXR1cm4gdGhpcy5oaWdoICogVFdPX1BXUl8zMl9EQkwgKyAodGhpcy5sb3cgPj4+IDApOwogICAgICB9OwogICAgICBMb25nUHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gdG9TdHJpbmcocmFkaXgpIHsKICAgICAgICByYWRpeCA9IHJhZGl4IHx8IDEwOwogICAgICAgIGlmIChyYWRpeCA8IDIgfHwgMzYgPCByYWRpeCkKICAgICAgICAgIHRocm93IFJhbmdlRXJyb3IoInJhZGl4Iik7CiAgICAgICAgaWYgKHRoaXMuaXNaZXJvKCkpCiAgICAgICAgICByZXR1cm4gIjAiOwogICAgICAgIGlmICh0aGlzLmlzTmVnYXRpdmUoKSkgewogICAgICAgICAgaWYgKHRoaXMuZXEoTUlOX1ZBTFVFKSkgewogICAgICAgICAgICB2YXIgcmFkaXhMb25nID0gZnJvbU51bWJlcihyYWRpeCksIGRpdiA9IHRoaXMuZGl2KHJhZGl4TG9uZyksIHJlbTEgPSBkaXYubXVsKHJhZGl4TG9uZykuc3ViKHRoaXMpOwogICAgICAgICAgICByZXR1cm4gZGl2LnRvU3RyaW5nKHJhZGl4KSArIHJlbTEudG9JbnQoKS50b1N0cmluZyhyYWRpeCk7CiAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgcmV0dXJuICItIiArIHRoaXMubmVnKCkudG9TdHJpbmcocmFkaXgpOwogICAgICAgIH0KICAgICAgICB2YXIgcmFkaXhUb1Bvd2VyID0gZnJvbU51bWJlcihwb3dfZGJsKHJhZGl4LCA2KSwgdGhpcy51bnNpZ25lZCksIHJlbSA9IHRoaXM7CiAgICAgICAgdmFyIHJlc3VsdCA9ICIiOwogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICB2YXIgcmVtRGl2ID0gcmVtLmRpdihyYWRpeFRvUG93ZXIpLCBpbnR2YWwgPSByZW0uc3ViKHJlbURpdi5tdWwocmFkaXhUb1Bvd2VyKSkudG9JbnQoKSA+Pj4gMCwgZGlnaXRzID0gaW50dmFsLnRvU3RyaW5nKHJhZGl4KTsKICAgICAgICAgIHJlbSA9IHJlbURpdjsKICAgICAgICAgIGlmIChyZW0uaXNaZXJvKCkpCiAgICAgICAgICAgIHJldHVybiBkaWdpdHMgKyByZXN1bHQ7CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgd2hpbGUgKGRpZ2l0cy5sZW5ndGggPCA2KQogICAgICAgICAgICAgIGRpZ2l0cyA9ICIwIiArIGRpZ2l0czsKICAgICAgICAgICAgcmVzdWx0ID0gIiIgKyBkaWdpdHMgKyByZXN1bHQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgICBMb25nUHJvdG90eXBlLmdldEhpZ2hCaXRzID0gZnVuY3Rpb24gZ2V0SGlnaEJpdHMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaGlnaDsKICAgICAgfTsKICAgICAgTG9uZ1Byb3RvdHlwZS5nZXRIaWdoQml0c1Vuc2lnbmVkID0gZnVuY3Rpb24gZ2V0SGlnaEJpdHNVbnNpZ25lZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5oaWdoID4+PiAwOwogICAgICB9OwogICAgICBMb25nUHJvdG90eXBlLmdldExvd0JpdHMgPSBmdW5jdGlvbiBnZXRMb3dCaXRzKCkgewogICAgICAgIHJldHVybiB0aGlzLmxvdzsKICAgICAgfTsKICAgICAgTG9uZ1Byb3RvdHlwZS5nZXRMb3dCaXRzVW5zaWduZWQgPSBmdW5jdGlvbiBnZXRMb3dCaXRzVW5zaWduZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubG93ID4+PiAwOwogICAgICB9OwogICAgICBMb25nUHJvdG90eXBlLmdldE51bUJpdHNBYnMgPSBmdW5jdGlvbiBnZXROdW1CaXRzQWJzKCkgewogICAgICAgIGlmICh0aGlzLmlzTmVnYXRpdmUoKSkKICAgICAgICAgIHJldHVybiB0aGlzLmVxKE1JTl9WQUxVRSkgPyA2NCA6IHRoaXMubmVnKCkuZ2V0TnVtQml0c0FicygpOwogICAgICAgIHZhciB2YWwgPSB0aGlzLmhpZ2ggIT0gMCA/IHRoaXMuaGlnaCA6IHRoaXMubG93OwogICAgICAgIGZvciAodmFyIGJpdCA9IDMxOyBiaXQgPiAwOyBiaXQtLSkKICAgICAgICAgIGlmICgodmFsICYgMSA8PCBiaXQpICE9IDApCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIHJldHVybiB0aGlzLmhpZ2ggIT0gMCA/IGJpdCArIDMzIDogYml0ICsgMTsKICAgICAgfTsKICAgICAgTG9uZ1Byb3RvdHlwZS5pc1plcm8gPSBmdW5jdGlvbiBpc1plcm8oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaGlnaCA9PT0gMCAmJiB0aGlzLmxvdyA9PT0gMDsKICAgICAgfTsKICAgICAgTG9uZ1Byb3RvdHlwZS5lcXogPSBMb25nUHJvdG90eXBlLmlzWmVybzsKICAgICAgTG9uZ1Byb3RvdHlwZS5pc05lZ2F0aXZlID0gZnVuY3Rpb24gaXNOZWdhdGl2ZSgpIHsKICAgICAgICByZXR1cm4gIXRoaXMudW5zaWduZWQgJiYgdGhpcy5oaWdoIDwgMDsKICAgICAgfTsKICAgICAgTG9uZ1Byb3RvdHlwZS5pc1Bvc2l0aXZlID0gZnVuY3Rpb24gaXNQb3NpdGl2ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy51bnNpZ25lZCB8fCB0aGlzLmhpZ2ggPj0gMDsKICAgICAgfTsKICAgICAgTG9uZ1Byb3RvdHlwZS5pc09kZCA9IGZ1bmN0aW9uIGlzT2RkKCkgewogICAgICAgIHJldHVybiAodGhpcy5sb3cgJiAxKSA9PT0gMTsKICAgICAgfTsKICAgICAgTG9uZ1Byb3RvdHlwZS5pc0V2ZW4gPSBmdW5jdGlvbiBpc0V2ZW4oKSB7CiAgICAgICAgcmV0dXJuICh0aGlzLmxvdyAmIDEpID09PSAwOwogICAgICB9OwogICAgICBMb25nUHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIGVxdWFscyhvdGhlcikgewogICAgICAgIGlmICghaXNMb25nKG90aGVyKSkKICAgICAgICAgIG90aGVyID0gZnJvbVZhbHVlKG90aGVyKTsKICAgICAgICBpZiAodGhpcy51bnNpZ25lZCAhPT0gb3RoZXIudW5zaWduZWQgJiYgdGhpcy5oaWdoID4+PiAzMSA9PT0gMSAmJiBvdGhlci5oaWdoID4+PiAzMSA9PT0gMSkKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gdGhpcy5oaWdoID09PSBvdGhlci5oaWdoICYmIHRoaXMubG93ID09PSBvdGhlci5sb3c7CiAgICAgIH07CiAgICAgIExvbmdQcm90b3R5cGUuZXEgPSBMb25nUHJvdG90eXBlLmVxdWFsczsKICAgICAgTG9uZ1Byb3RvdHlwZS5ub3RFcXVhbHMgPSBmdW5jdGlvbiBub3RFcXVhbHMob3RoZXIpIHsKICAgICAgICByZXR1cm4gIXRoaXMuZXEob3RoZXIpOwogICAgICB9OwogICAgICBMb25nUHJvdG90eXBlLm5lcSA9IExvbmdQcm90b3R5cGUubm90RXF1YWxzOwogICAgICBMb25nUHJvdG90eXBlLm5lID0gTG9uZ1Byb3RvdHlwZS5ub3RFcXVhbHM7CiAgICAgIExvbmdQcm90b3R5cGUubGVzc1RoYW4gPSBmdW5jdGlvbiBsZXNzVGhhbihvdGhlcikgewogICAgICAgIHJldHVybiB0aGlzLmNvbXAob3RoZXIpIDwgMDsKICAgICAgfTsKICAgICAgTG9uZ1Byb3RvdHlwZS5sdCA9IExvbmdQcm90b3R5cGUubGVzc1RoYW47CiAgICAgIExvbmdQcm90b3R5cGUubGVzc1RoYW5PckVxdWFsID0gZnVuY3Rpb24gbGVzc1RoYW5PckVxdWFsKG90aGVyKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29tcChvdGhlcikgPD0gMDsKICAgICAgfTsKICAgICAgTG9uZ1Byb3RvdHlwZS5sdGUgPSBMb25nUHJvdG90eXBlLmxlc3NUaGFuT3JFcXVhbDsKICAgICAgTG9uZ1Byb3RvdHlwZS5sZSA9IExvbmdQcm90b3R5cGUubGVzc1RoYW5PckVxdWFsOwogICAgICBMb25nUHJvdG90eXBlLmdyZWF0ZXJUaGFuID0gZnVuY3Rpb24gZ3JlYXRlclRoYW4ob3RoZXIpIHsKICAgICAgICByZXR1cm4gdGhpcy5jb21wKG90aGVyKSA+IDA7CiAgICAgIH07CiAgICAgIExvbmdQcm90b3R5cGUuZ3QgPSBMb25nUHJvdG90eXBlLmdyZWF0ZXJUaGFuOwogICAgICBMb25nUHJvdG90eXBlLmdyZWF0ZXJUaGFuT3JFcXVhbCA9IGZ1bmN0aW9uIGdyZWF0ZXJUaGFuT3JFcXVhbChvdGhlcikgewogICAgICAgIHJldHVybiB0aGlzLmNvbXAob3RoZXIpID49IDA7CiAgICAgIH07CiAgICAgIExvbmdQcm90b3R5cGUuZ3RlID0gTG9uZ1Byb3RvdHlwZS5ncmVhdGVyVGhhbk9yRXF1YWw7CiAgICAgIExvbmdQcm90b3R5cGUuZ2UgPSBMb25nUHJvdG90eXBlLmdyZWF0ZXJUaGFuT3JFcXVhbDsKICAgICAgTG9uZ1Byb3RvdHlwZS5jb21wYXJlID0gZnVuY3Rpb24gY29tcGFyZShvdGhlcikgewogICAgICAgIGlmICghaXNMb25nKG90aGVyKSkKICAgICAgICAgIG90aGVyID0gZnJvbVZhbHVlKG90aGVyKTsKICAgICAgICBpZiAodGhpcy5lcShvdGhlcikpCiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB2YXIgdGhpc05lZyA9IHRoaXMuaXNOZWdhdGl2ZSgpLCBvdGhlck5lZyA9IG90aGVyLmlzTmVnYXRpdmUoKTsKICAgICAgICBpZiAodGhpc05lZyAmJiAhb3RoZXJOZWcpCiAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgaWYgKCF0aGlzTmVnICYmIG90aGVyTmVnKQogICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgaWYgKCF0aGlzLnVuc2lnbmVkKQogICAgICAgICAgcmV0dXJuIHRoaXMuc3ViKG90aGVyKS5pc05lZ2F0aXZlKCkgPyAtMSA6IDE7CiAgICAgICAgcmV0dXJuIG90aGVyLmhpZ2ggPj4+IDAgPiB0aGlzLmhpZ2ggPj4+IDAgfHwgb3RoZXIuaGlnaCA9PT0gdGhpcy5oaWdoICYmIG90aGVyLmxvdyA+Pj4gMCA+IHRoaXMubG93ID4+PiAwID8gLTEgOiAxOwogICAgICB9OwogICAgICBMb25nUHJvdG90eXBlLmNvbXAgPSBMb25nUHJvdG90eXBlLmNvbXBhcmU7CiAgICAgIExvbmdQcm90b3R5cGUubmVnYXRlID0gZnVuY3Rpb24gbmVnYXRlKCkgewogICAgICAgIGlmICghdGhpcy51bnNpZ25lZCAmJiB0aGlzLmVxKE1JTl9WQUxVRSkpCiAgICAgICAgICByZXR1cm4gTUlOX1ZBTFVFOwogICAgICAgIHJldHVybiB0aGlzLm5vdCgpLmFkZChPTkUpOwogICAgICB9OwogICAgICBMb25nUHJvdG90eXBlLm5lZyA9IExvbmdQcm90b3R5cGUubmVnYXRlOwogICAgICBMb25nUHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIGFkZChhZGRlbmQpIHsKICAgICAgICBpZiAoIWlzTG9uZyhhZGRlbmQpKQogICAgICAgICAgYWRkZW5kID0gZnJvbVZhbHVlKGFkZGVuZCk7CiAgICAgICAgdmFyIGE0OCA9IHRoaXMuaGlnaCA+Pj4gMTY7CiAgICAgICAgdmFyIGEzMiA9IHRoaXMuaGlnaCAmIDY1NTM1OwogICAgICAgIHZhciBhMTYgPSB0aGlzLmxvdyA+Pj4gMTY7CiAgICAgICAgdmFyIGEwMCA9IHRoaXMubG93ICYgNjU1MzU7CiAgICAgICAgdmFyIGI0OCA9IGFkZGVuZC5oaWdoID4+PiAxNjsKICAgICAgICB2YXIgYjMyID0gYWRkZW5kLmhpZ2ggJiA2NTUzNTsKICAgICAgICB2YXIgYjE2ID0gYWRkZW5kLmxvdyA+Pj4gMTY7CiAgICAgICAgdmFyIGIwMCA9IGFkZGVuZC5sb3cgJiA2NTUzNTsKICAgICAgICB2YXIgYzQ4ID0gMCwgYzMyID0gMCwgYzE2ID0gMCwgYzAwID0gMDsKICAgICAgICBjMDAgKz0gYTAwICsgYjAwOwogICAgICAgIGMxNiArPSBjMDAgPj4+IDE2OwogICAgICAgIGMwMCAmPSA2NTUzNTsKICAgICAgICBjMTYgKz0gYTE2ICsgYjE2OwogICAgICAgIGMzMiArPSBjMTYgPj4+IDE2OwogICAgICAgIGMxNiAmPSA2NTUzNTsKICAgICAgICBjMzIgKz0gYTMyICsgYjMyOwogICAgICAgIGM0OCArPSBjMzIgPj4+IDE2OwogICAgICAgIGMzMiAmPSA2NTUzNTsKICAgICAgICBjNDggKz0gYTQ4ICsgYjQ4OwogICAgICAgIGM0OCAmPSA2NTUzNTsKICAgICAgICByZXR1cm4gZnJvbUJpdHMoYzE2IDw8IDE2IHwgYzAwLCBjNDggPDwgMTYgfCBjMzIsIHRoaXMudW5zaWduZWQpOwogICAgICB9OwogICAgICBMb25nUHJvdG90eXBlLnN1YnRyYWN0ID0gZnVuY3Rpb24gc3VidHJhY3Qoc3VidHJhaGVuZCkgewogICAgICAgIGlmICghaXNMb25nKHN1YnRyYWhlbmQpKQogICAgICAgICAgc3VidHJhaGVuZCA9IGZyb21WYWx1ZShzdWJ0cmFoZW5kKTsKICAgICAgICByZXR1cm4gdGhpcy5hZGQoc3VidHJhaGVuZC5uZWcoKSk7CiAgICAgIH07CiAgICAgIExvbmdQcm90b3R5cGUuc3ViID0gTG9uZ1Byb3RvdHlwZS5zdWJ0cmFjdDsKICAgICAgTG9uZ1Byb3RvdHlwZS5tdWx0aXBseSA9IGZ1bmN0aW9uIG11bHRpcGx5KG11bHRpcGxpZXIpIHsKICAgICAgICBpZiAodGhpcy5pc1plcm8oKSkKICAgICAgICAgIHJldHVybiBaRVJPOwogICAgICAgIGlmICghaXNMb25nKG11bHRpcGxpZXIpKQogICAgICAgICAgbXVsdGlwbGllciA9IGZyb21WYWx1ZShtdWx0aXBsaWVyKTsKICAgICAgICBpZiAod2FzbSkgewogICAgICAgICAgdmFyIGxvdyA9IHdhc20ubXVsKHRoaXMubG93LCB0aGlzLmhpZ2gsIG11bHRpcGxpZXIubG93LCBtdWx0aXBsaWVyLmhpZ2gpOwogICAgICAgICAgcmV0dXJuIGZyb21CaXRzKGxvdywgd2FzbS5nZXRfaGlnaCgpLCB0aGlzLnVuc2lnbmVkKTsKICAgICAgICB9CiAgICAgICAgaWYgKG11bHRpcGxpZXIuaXNaZXJvKCkpCiAgICAgICAgICByZXR1cm4gWkVSTzsKICAgICAgICBpZiAodGhpcy5lcShNSU5fVkFMVUUpKQogICAgICAgICAgcmV0dXJuIG11bHRpcGxpZXIuaXNPZGQoKSA/IE1JTl9WQUxVRSA6IFpFUk87CiAgICAgICAgaWYgKG11bHRpcGxpZXIuZXEoTUlOX1ZBTFVFKSkKICAgICAgICAgIHJldHVybiB0aGlzLmlzT2RkKCkgPyBNSU5fVkFMVUUgOiBaRVJPOwogICAgICAgIGlmICh0aGlzLmlzTmVnYXRpdmUoKSkgewogICAgICAgICAgaWYgKG11bHRpcGxpZXIuaXNOZWdhdGl2ZSgpKQogICAgICAgICAgICByZXR1cm4gdGhpcy5uZWcoKS5tdWwobXVsdGlwbGllci5uZWcoKSk7CiAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiB0aGlzLm5lZygpLm11bChtdWx0aXBsaWVyKS5uZWcoKTsKICAgICAgICB9IGVsc2UgaWYgKG11bHRpcGxpZXIuaXNOZWdhdGl2ZSgpKQogICAgICAgICAgcmV0dXJuIHRoaXMubXVsKG11bHRpcGxpZXIubmVnKCkpLm5lZygpOwogICAgICAgIGlmICh0aGlzLmx0KFRXT19QV1JfMjQpICYmIG11bHRpcGxpZXIubHQoVFdPX1BXUl8yNCkpCiAgICAgICAgICByZXR1cm4gZnJvbU51bWJlcih0aGlzLnRvTnVtYmVyKCkgKiBtdWx0aXBsaWVyLnRvTnVtYmVyKCksIHRoaXMudW5zaWduZWQpOwogICAgICAgIHZhciBhNDggPSB0aGlzLmhpZ2ggPj4+IDE2OwogICAgICAgIHZhciBhMzIgPSB0aGlzLmhpZ2ggJiA2NTUzNTsKICAgICAgICB2YXIgYTE2ID0gdGhpcy5sb3cgPj4+IDE2OwogICAgICAgIHZhciBhMDAgPSB0aGlzLmxvdyAmIDY1NTM1OwogICAgICAgIHZhciBiNDggPSBtdWx0aXBsaWVyLmhpZ2ggPj4+IDE2OwogICAgICAgIHZhciBiMzIgPSBtdWx0aXBsaWVyLmhpZ2ggJiA2NTUzNTsKICAgICAgICB2YXIgYjE2ID0gbXVsdGlwbGllci5sb3cgPj4+IDE2OwogICAgICAgIHZhciBiMDAgPSBtdWx0aXBsaWVyLmxvdyAmIDY1NTM1OwogICAgICAgIHZhciBjNDggPSAwLCBjMzIgPSAwLCBjMTYgPSAwLCBjMDAgPSAwOwogICAgICAgIGMwMCArPSBhMDAgKiBiMDA7CiAgICAgICAgYzE2ICs9IGMwMCA+Pj4gMTY7CiAgICAgICAgYzAwICY9IDY1NTM1OwogICAgICAgIGMxNiArPSBhMTYgKiBiMDA7CiAgICAgICAgYzMyICs9IGMxNiA+Pj4gMTY7CiAgICAgICAgYzE2ICY9IDY1NTM1OwogICAgICAgIGMxNiArPSBhMDAgKiBiMTY7CiAgICAgICAgYzMyICs9IGMxNiA+Pj4gMTY7CiAgICAgICAgYzE2ICY9IDY1NTM1OwogICAgICAgIGMzMiArPSBhMzIgKiBiMDA7CiAgICAgICAgYzQ4ICs9IGMzMiA+Pj4gMTY7CiAgICAgICAgYzMyICY9IDY1NTM1OwogICAgICAgIGMzMiArPSBhMTYgKiBiMTY7CiAgICAgICAgYzQ4ICs9IGMzMiA+Pj4gMTY7CiAgICAgICAgYzMyICY9IDY1NTM1OwogICAgICAgIGMzMiArPSBhMDAgKiBiMzI7CiAgICAgICAgYzQ4ICs9IGMzMiA+Pj4gMTY7CiAgICAgICAgYzMyICY9IDY1NTM1OwogICAgICAgIGM0OCArPSBhNDggKiBiMDAgKyBhMzIgKiBiMTYgKyBhMTYgKiBiMzIgKyBhMDAgKiBiNDg7CiAgICAgICAgYzQ4ICY9IDY1NTM1OwogICAgICAgIHJldHVybiBmcm9tQml0cyhjMTYgPDwgMTYgfCBjMDAsIGM0OCA8PCAxNiB8IGMzMiwgdGhpcy51bnNpZ25lZCk7CiAgICAgIH07CiAgICAgIExvbmdQcm90b3R5cGUubXVsID0gTG9uZ1Byb3RvdHlwZS5tdWx0aXBseTsKICAgICAgTG9uZ1Byb3RvdHlwZS5kaXZpZGUgPSBmdW5jdGlvbiBkaXZpZGUoZGl2aXNvcikgewogICAgICAgIGlmICghaXNMb25nKGRpdmlzb3IpKQogICAgICAgICAgZGl2aXNvciA9IGZyb21WYWx1ZShkaXZpc29yKTsKICAgICAgICBpZiAoZGl2aXNvci5pc1plcm8oKSkKICAgICAgICAgIHRocm93IEVycm9yKCJkaXZpc2lvbiBieSB6ZXJvIik7CiAgICAgICAgaWYgKHdhc20pIHsKICAgICAgICAgIGlmICghdGhpcy51bnNpZ25lZCAmJiB0aGlzLmhpZ2ggPT09IC0yMTQ3NDgzNjQ4ICYmIGRpdmlzb3IubG93ID09PSAtMSAmJiBkaXZpc29yLmhpZ2ggPT09IC0xKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGxvdyA9ICh0aGlzLnVuc2lnbmVkID8gd2FzbS5kaXZfdSA6IHdhc20uZGl2X3MpKHRoaXMubG93LCB0aGlzLmhpZ2gsIGRpdmlzb3IubG93LCBkaXZpc29yLmhpZ2gpOwogICAgICAgICAgcmV0dXJuIGZyb21CaXRzKGxvdywgd2FzbS5nZXRfaGlnaCgpLCB0aGlzLnVuc2lnbmVkKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuaXNaZXJvKCkpCiAgICAgICAgICByZXR1cm4gdGhpcy51bnNpZ25lZCA/IFVaRVJPIDogWkVSTzsKICAgICAgICB2YXIgYXBwcm94LCByZW0sIHJlczsKICAgICAgICBpZiAoIXRoaXMudW5zaWduZWQpIHsKICAgICAgICAgIGlmICh0aGlzLmVxKE1JTl9WQUxVRSkpIHsKICAgICAgICAgICAgaWYgKGRpdmlzb3IuZXEoT05FKSB8fCBkaXZpc29yLmVxKE5FR19PTkUpKQogICAgICAgICAgICAgIHJldHVybiBNSU5fVkFMVUU7CiAgICAgICAgICAgIGVsc2UgaWYgKGRpdmlzb3IuZXEoTUlOX1ZBTFVFKSkKICAgICAgICAgICAgICByZXR1cm4gT05FOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICB2YXIgaGFsZlRoaXMgPSB0aGlzLnNocigxKTsKICAgICAgICAgICAgICBhcHByb3ggPSBoYWxmVGhpcy5kaXYoZGl2aXNvcikuc2hsKDEpOwogICAgICAgICAgICAgIGlmIChhcHByb3guZXEoWkVSTykpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkaXZpc29yLmlzTmVnYXRpdmUoKSA/IE9ORSA6IE5FR19PTkU7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlbSA9IHRoaXMuc3ViKGRpdmlzb3IubXVsKGFwcHJveCkpOwogICAgICAgICAgICAgICAgcmVzID0gYXBwcm94LmFkZChyZW0uZGl2KGRpdmlzb3IpKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKGRpdmlzb3IuZXEoTUlOX1ZBTFVFKSkKICAgICAgICAgICAgcmV0dXJuIHRoaXMudW5zaWduZWQgPyBVWkVSTyA6IFpFUk87CiAgICAgICAgICBpZiAodGhpcy5pc05lZ2F0aXZlKCkpIHsKICAgICAgICAgICAgaWYgKGRpdmlzb3IuaXNOZWdhdGl2ZSgpKQogICAgICAgICAgICAgIHJldHVybiB0aGlzLm5lZygpLmRpdihkaXZpc29yLm5lZygpKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubmVnKCkuZGl2KGRpdmlzb3IpLm5lZygpOwogICAgICAgICAgfSBlbHNlIGlmIChkaXZpc29yLmlzTmVnYXRpdmUoKSkKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGl2KGRpdmlzb3IubmVnKCkpLm5lZygpOwogICAgICAgICAgcmVzID0gWkVSTzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKCFkaXZpc29yLnVuc2lnbmVkKQogICAgICAgICAgICBkaXZpc29yID0gZGl2aXNvci50b1Vuc2lnbmVkKCk7CiAgICAgICAgICBpZiAoZGl2aXNvci5ndCh0aGlzKSkKICAgICAgICAgICAgcmV0dXJuIFVaRVJPOwogICAgICAgICAgaWYgKGRpdmlzb3IuZ3QodGhpcy5zaHJ1KDEpKSkKICAgICAgICAgICAgcmV0dXJuIFVPTkU7CiAgICAgICAgICByZXMgPSBVWkVSTzsKICAgICAgICB9CiAgICAgICAgcmVtID0gdGhpczsKICAgICAgICB3aGlsZSAocmVtLmd0ZShkaXZpc29yKSkgewogICAgICAgICAgYXBwcm94ID0gTWF0aC5tYXgoMSwgTWF0aC5mbG9vcihyZW0udG9OdW1iZXIoKSAvIGRpdmlzb3IudG9OdW1iZXIoKSkpOwogICAgICAgICAgdmFyIGxvZzIgPSBNYXRoLmNlaWwoTWF0aC5sb2coYXBwcm94KSAvIE1hdGguTE4yKSwgZGVsdGEgPSBsb2cyIDw9IDQ4ID8gMSA6IHBvd19kYmwoMiwgbG9nMiAtIDQ4KSwgYXBwcm94UmVzID0gZnJvbU51bWJlcihhcHByb3gpLCBhcHByb3hSZW0gPSBhcHByb3hSZXMubXVsKGRpdmlzb3IpOwogICAgICAgICAgd2hpbGUgKGFwcHJveFJlbS5pc05lZ2F0aXZlKCkgfHwgYXBwcm94UmVtLmd0KHJlbSkpIHsKICAgICAgICAgICAgYXBwcm94IC09IGRlbHRhOwogICAgICAgICAgICBhcHByb3hSZXMgPSBmcm9tTnVtYmVyKGFwcHJveCwgdGhpcy51bnNpZ25lZCk7CiAgICAgICAgICAgIGFwcHJveFJlbSA9IGFwcHJveFJlcy5tdWwoZGl2aXNvcik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYXBwcm94UmVzLmlzWmVybygpKQogICAgICAgICAgICBhcHByb3hSZXMgPSBPTkU7CiAgICAgICAgICByZXMgPSByZXMuYWRkKGFwcHJveFJlcyk7CiAgICAgICAgICByZW0gPSByZW0uc3ViKGFwcHJveFJlbSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXM7CiAgICAgIH07CiAgICAgIExvbmdQcm90b3R5cGUuZGl2ID0gTG9uZ1Byb3RvdHlwZS5kaXZpZGU7CiAgICAgIExvbmdQcm90b3R5cGUubW9kdWxvID0gZnVuY3Rpb24gbW9kdWxvKGRpdmlzb3IpIHsKICAgICAgICBpZiAoIWlzTG9uZyhkaXZpc29yKSkKICAgICAgICAgIGRpdmlzb3IgPSBmcm9tVmFsdWUoZGl2aXNvcik7CiAgICAgICAgaWYgKHdhc20pIHsKICAgICAgICAgIHZhciBsb3cgPSAodGhpcy51bnNpZ25lZCA/IHdhc20ucmVtX3UgOiB3YXNtLnJlbV9zKSh0aGlzLmxvdywgdGhpcy5oaWdoLCBkaXZpc29yLmxvdywgZGl2aXNvci5oaWdoKTsKICAgICAgICAgIHJldHVybiBmcm9tQml0cyhsb3csIHdhc20uZ2V0X2hpZ2goKSwgdGhpcy51bnNpZ25lZCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLnN1Yih0aGlzLmRpdihkaXZpc29yKS5tdWwoZGl2aXNvcikpOwogICAgICB9OwogICAgICBMb25nUHJvdG90eXBlLm1vZCA9IExvbmdQcm90b3R5cGUubW9kdWxvOwogICAgICBMb25nUHJvdG90eXBlLnJlbSA9IExvbmdQcm90b3R5cGUubW9kdWxvOwogICAgICBMb25nUHJvdG90eXBlLm5vdCA9IGZ1bmN0aW9uIG5vdCgpIHsKICAgICAgICByZXR1cm4gZnJvbUJpdHMofnRoaXMubG93LCB+dGhpcy5oaWdoLCB0aGlzLnVuc2lnbmVkKTsKICAgICAgfTsKICAgICAgTG9uZ1Byb3RvdHlwZS5hbmQgPSBmdW5jdGlvbiBhbmQob3RoZXIpIHsKICAgICAgICBpZiAoIWlzTG9uZyhvdGhlcikpCiAgICAgICAgICBvdGhlciA9IGZyb21WYWx1ZShvdGhlcik7CiAgICAgICAgcmV0dXJuIGZyb21CaXRzKHRoaXMubG93ICYgb3RoZXIubG93LCB0aGlzLmhpZ2ggJiBvdGhlci5oaWdoLCB0aGlzLnVuc2lnbmVkKTsKICAgICAgfTsKICAgICAgTG9uZ1Byb3RvdHlwZS5vciA9IGZ1bmN0aW9uIG9yKG90aGVyKSB7CiAgICAgICAgaWYgKCFpc0xvbmcob3RoZXIpKQogICAgICAgICAgb3RoZXIgPSBmcm9tVmFsdWUob3RoZXIpOwogICAgICAgIHJldHVybiBmcm9tQml0cyh0aGlzLmxvdyB8IG90aGVyLmxvdywgdGhpcy5oaWdoIHwgb3RoZXIuaGlnaCwgdGhpcy51bnNpZ25lZCk7CiAgICAgIH07CiAgICAgIExvbmdQcm90b3R5cGUueG9yID0gZnVuY3Rpb24geG9yKG90aGVyKSB7CiAgICAgICAgaWYgKCFpc0xvbmcob3RoZXIpKQogICAgICAgICAgb3RoZXIgPSBmcm9tVmFsdWUob3RoZXIpOwogICAgICAgIHJldHVybiBmcm9tQml0cyh0aGlzLmxvdyBeIG90aGVyLmxvdywgdGhpcy5oaWdoIF4gb3RoZXIuaGlnaCwgdGhpcy51bnNpZ25lZCk7CiAgICAgIH07CiAgICAgIExvbmdQcm90b3R5cGUuc2hpZnRMZWZ0ID0gZnVuY3Rpb24gc2hpZnRMZWZ0KG51bUJpdHMpIHsKICAgICAgICBpZiAoaXNMb25nKG51bUJpdHMpKQogICAgICAgICAgbnVtQml0cyA9IG51bUJpdHMudG9JbnQoKTsKICAgICAgICBpZiAoKG51bUJpdHMgJj0gNjMpID09PSAwKQogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgZWxzZSBpZiAobnVtQml0cyA8IDMyKQogICAgICAgICAgcmV0dXJuIGZyb21CaXRzKHRoaXMubG93IDw8IG51bUJpdHMsIHRoaXMuaGlnaCA8PCBudW1CaXRzIHwgdGhpcy5sb3cgPj4+IDMyIC0gbnVtQml0cywgdGhpcy51bnNpZ25lZCk7CiAgICAgICAgZWxzZQogICAgICAgICAgcmV0dXJuIGZyb21CaXRzKDAsIHRoaXMubG93IDw8IG51bUJpdHMgLSAzMiwgdGhpcy51bnNpZ25lZCk7CiAgICAgIH07CiAgICAgIExvbmdQcm90b3R5cGUuc2hsID0gTG9uZ1Byb3RvdHlwZS5zaGlmdExlZnQ7CiAgICAgIExvbmdQcm90b3R5cGUuc2hpZnRSaWdodCA9IGZ1bmN0aW9uIHNoaWZ0UmlnaHQobnVtQml0cykgewogICAgICAgIGlmIChpc0xvbmcobnVtQml0cykpCiAgICAgICAgICBudW1CaXRzID0gbnVtQml0cy50b0ludCgpOwogICAgICAgIGlmICgobnVtQml0cyAmPSA2MykgPT09IDApCiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICBlbHNlIGlmIChudW1CaXRzIDwgMzIpCiAgICAgICAgICByZXR1cm4gZnJvbUJpdHModGhpcy5sb3cgPj4+IG51bUJpdHMgfCB0aGlzLmhpZ2ggPDwgMzIgLSBudW1CaXRzLCB0aGlzLmhpZ2ggPj4gbnVtQml0cywgdGhpcy51bnNpZ25lZCk7CiAgICAgICAgZWxzZQogICAgICAgICAgcmV0dXJuIGZyb21CaXRzKHRoaXMuaGlnaCA+PiBudW1CaXRzIC0gMzIsIHRoaXMuaGlnaCA+PSAwID8gMCA6IC0xLCB0aGlzLnVuc2lnbmVkKTsKICAgICAgfTsKICAgICAgTG9uZ1Byb3RvdHlwZS5zaHIgPSBMb25nUHJvdG90eXBlLnNoaWZ0UmlnaHQ7CiAgICAgIExvbmdQcm90b3R5cGUuc2hpZnRSaWdodFVuc2lnbmVkID0gZnVuY3Rpb24gc2hpZnRSaWdodFVuc2lnbmVkKG51bUJpdHMpIHsKICAgICAgICBpZiAoaXNMb25nKG51bUJpdHMpKQogICAgICAgICAgbnVtQml0cyA9IG51bUJpdHMudG9JbnQoKTsKICAgICAgICBudW1CaXRzICY9IDYzOwogICAgICAgIGlmIChudW1CaXRzID09PSAwKQogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICB2YXIgaGlnaCA9IHRoaXMuaGlnaDsKICAgICAgICAgIGlmIChudW1CaXRzIDwgMzIpIHsKICAgICAgICAgICAgdmFyIGxvdyA9IHRoaXMubG93OwogICAgICAgICAgICByZXR1cm4gZnJvbUJpdHMobG93ID4+PiBudW1CaXRzIHwgaGlnaCA8PCAzMiAtIG51bUJpdHMsIGhpZ2ggPj4+IG51bUJpdHMsIHRoaXMudW5zaWduZWQpOwogICAgICAgICAgfSBlbHNlIGlmIChudW1CaXRzID09PSAzMikKICAgICAgICAgICAgcmV0dXJuIGZyb21CaXRzKGhpZ2gsIDAsIHRoaXMudW5zaWduZWQpOwogICAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gZnJvbUJpdHMoaGlnaCA+Pj4gbnVtQml0cyAtIDMyLCAwLCB0aGlzLnVuc2lnbmVkKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIExvbmdQcm90b3R5cGUuc2hydSA9IExvbmdQcm90b3R5cGUuc2hpZnRSaWdodFVuc2lnbmVkOwogICAgICBMb25nUHJvdG90eXBlLnNocl91ID0gTG9uZ1Byb3RvdHlwZS5zaGlmdFJpZ2h0VW5zaWduZWQ7CiAgICAgIExvbmdQcm90b3R5cGUudG9TaWduZWQgPSBmdW5jdGlvbiB0b1NpZ25lZCgpIHsKICAgICAgICBpZiAoIXRoaXMudW5zaWduZWQpCiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICByZXR1cm4gZnJvbUJpdHModGhpcy5sb3csIHRoaXMuaGlnaCwgZmFsc2UpOwogICAgICB9OwogICAgICBMb25nUHJvdG90eXBlLnRvVW5zaWduZWQgPSBmdW5jdGlvbiB0b1Vuc2lnbmVkKCkgewogICAgICAgIGlmICh0aGlzLnVuc2lnbmVkKQogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgcmV0dXJuIGZyb21CaXRzKHRoaXMubG93LCB0aGlzLmhpZ2gsIHRydWUpOwogICAgICB9OwogICAgICBMb25nUHJvdG90eXBlLnRvQnl0ZXMgPSBmdW5jdGlvbiB0b0J5dGVzKGxlKSB7CiAgICAgICAgcmV0dXJuIGxlID8gdGhpcy50b0J5dGVzTEUoKSA6IHRoaXMudG9CeXRlc0JFKCk7CiAgICAgIH07CiAgICAgIExvbmdQcm90b3R5cGUudG9CeXRlc0xFID0gZnVuY3Rpb24gdG9CeXRlc0xFKCkgewogICAgICAgIHZhciBoaSA9IHRoaXMuaGlnaCwgbG8gPSB0aGlzLmxvdzsKICAgICAgICByZXR1cm4gWwogICAgICAgICAgbG8gJiAyNTUsCiAgICAgICAgICBsbyA+Pj4gOCAmIDI1NSwKICAgICAgICAgIGxvID4+PiAxNiAmIDI1NSwKICAgICAgICAgIGxvID4+PiAyNCwKICAgICAgICAgIGhpICYgMjU1LAogICAgICAgICAgaGkgPj4+IDggJiAyNTUsCiAgICAgICAgICBoaSA+Pj4gMTYgJiAyNTUsCiAgICAgICAgICBoaSA+Pj4gMjQKICAgICAgICBdOwogICAgICB9OwogICAgICBMb25nUHJvdG90eXBlLnRvQnl0ZXNCRSA9IGZ1bmN0aW9uIHRvQnl0ZXNCRSgpIHsKICAgICAgICB2YXIgaGkgPSB0aGlzLmhpZ2gsIGxvID0gdGhpcy5sb3c7CiAgICAgICAgcmV0dXJuIFsKICAgICAgICAgIGhpID4+PiAyNCwKICAgICAgICAgIGhpID4+PiAxNiAmIDI1NSwKICAgICAgICAgIGhpID4+PiA4ICYgMjU1LAogICAgICAgICAgaGkgJiAyNTUsCiAgICAgICAgICBsbyA+Pj4gMjQsCiAgICAgICAgICBsbyA+Pj4gMTYgJiAyNTUsCiAgICAgICAgICBsbyA+Pj4gOCAmIDI1NSwKICAgICAgICAgIGxvICYgMjU1CiAgICAgICAgXTsKICAgICAgfTsKICAgICAgTG9uZy5mcm9tQnl0ZXMgPSBmdW5jdGlvbiBmcm9tQnl0ZXMoYnl0ZXMsIHVuc2lnbmVkLCBsZSkgewogICAgICAgIHJldHVybiBsZSA/IExvbmcuZnJvbUJ5dGVzTEUoYnl0ZXMsIHVuc2lnbmVkKSA6IExvbmcuZnJvbUJ5dGVzQkUoYnl0ZXMsIHVuc2lnbmVkKTsKICAgICAgfTsKICAgICAgTG9uZy5mcm9tQnl0ZXNMRSA9IGZ1bmN0aW9uIGZyb21CeXRlc0xFKGJ5dGVzLCB1bnNpZ25lZCkgewogICAgICAgIHJldHVybiBuZXcgTG9uZyhieXRlc1swXSB8IGJ5dGVzWzFdIDw8IDggfCBieXRlc1syXSA8PCAxNiB8IGJ5dGVzWzNdIDw8IDI0LCBieXRlc1s0XSB8IGJ5dGVzWzVdIDw8IDggfCBieXRlc1s2XSA8PCAxNiB8IGJ5dGVzWzddIDw8IDI0LCB1bnNpZ25lZCk7CiAgICAgIH07CiAgICAgIExvbmcuZnJvbUJ5dGVzQkUgPSBmdW5jdGlvbiBmcm9tQnl0ZXNCRShieXRlcywgdW5zaWduZWQpIHsKICAgICAgICByZXR1cm4gbmV3IExvbmcoYnl0ZXNbNF0gPDwgMjQgfCBieXRlc1s1XSA8PCAxNiB8IGJ5dGVzWzZdIDw8IDggfCBieXRlc1s3XSwgYnl0ZXNbMF0gPDwgMjQgfCBieXRlc1sxXSA8PCAxNiB8IGJ5dGVzWzJdIDw8IDggfCBieXRlc1szXSwgdW5zaWduZWQpOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL2FycmF5L3ZpcnR1YWwvY29uY2F0LmpzCiAgdmFyIHJlcXVpcmVfY29uY2F0ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9hcnJheS92aXJ0dWFsL2NvbmNhdC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgcmVxdWlyZV9lc19hcnJheV9jb25jYXQoKTsKICAgICAgdmFyIGVudHJ5VmlydHVhbCA9IHJlcXVpcmVfZW50cnlfdmlydHVhbCgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGVudHJ5VmlydHVhbCgiQXJyYXkiKS5jb25jYXQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvaW5zdGFuY2UvY29uY2F0LmpzCiAgdmFyIHJlcXVpcmVfY29uY2F0MiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvaW5zdGFuY2UvY29uY2F0LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgY29uY2F0ID0gcmVxdWlyZV9jb25jYXQoKTsKICAgICAgdmFyIEFycmF5UHJvdG90eXBlID0gQXJyYXkucHJvdG90eXBlOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KSB7CiAgICAgICAgdmFyIG93biA9IGl0LmNvbmNhdDsKICAgICAgICByZXR1cm4gaXQgPT09IEFycmF5UHJvdG90eXBlIHx8IGl0IGluc3RhbmNlb2YgQXJyYXkgJiYgb3duID09PSBBcnJheVByb3RvdHlwZS5jb25jYXQgPyBjb25jYXQgOiBvd247CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL2luc3RhbmNlL2NvbmNhdC5qcwogIHZhciByZXF1aXJlX2NvbmNhdDMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9pbnN0YW5jZS9jb25jYXQuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX2NvbmNhdDIoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXJlbnQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMtc3RhYmxlL2luc3RhbmNlL2NvbmNhdC5qcwogIHZhciByZXF1aXJlX2NvbmNhdDQgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzLXN0YWJsZS9pbnN0YW5jZS9jb25jYXQuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZV9jb25jYXQzKCk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AZ21vZC9iYW0vZGlzdC92aXJ0dWFsT2Zmc2V0LmpzCiAgdmFyIHJlcXVpcmVfdmlydHVhbE9mZnNldCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AZ21vZC9iYW0vZGlzdC92aXJ0dWFsT2Zmc2V0LmpzIihleHBvcnRzKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IHJlcXVpcmVfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KCk7CiAgICAgIHZhciBfT2JqZWN0JGRlZmluZVByb3BlcnR5ID0gcmVxdWlyZV9kZWZpbmVfcHJvcGVydHkzKCk7CiAgICAgIF9PYmplY3QkZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgICAgdmFsdWU6IHRydWUKICAgICAgfSk7CiAgICAgIGV4cG9ydHMuZnJvbUJ5dGVzID0gZnJvbUJ5dGVzOwogICAgICBleHBvcnRzLmRlZmF1bHQgPSB2b2lkIDA7CiAgICAgIHZhciBfY29uY2F0ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2NvbmNhdDQoKSk7CiAgICAgIHZhciBfY2xhc3NDYWxsQ2hlY2syID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2NsYXNzQ2FsbENoZWNrKCkpOwogICAgICB2YXIgX2NyZWF0ZUNsYXNzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9jcmVhdGVDbGFzcygpKTsKICAgICAgdmFyIF9kZWZpbmVQcm9wZXJ0eTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfZGVmaW5lUHJvcGVydHkoKSk7CiAgICAgIHZhciBWaXJ0dWFsT2Zmc2V0ID0gLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKCkgewogICAgICAgIGZ1bmN0aW9uIFZpcnR1YWxPZmZzZXQyKGJsb2NrUG9zaXRpb24sIGRhdGFQb3NpdGlvbikgewogICAgICAgICAgKDAsIF9jbGFzc0NhbGxDaGVjazIuZGVmYXVsdCkodGhpcywgVmlydHVhbE9mZnNldDIpOwogICAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIuZGVmYXVsdCkodGhpcywgImJsb2NrUG9zaXRpb24iLCB2b2lkIDApOwogICAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIuZGVmYXVsdCkodGhpcywgImRhdGFQb3NpdGlvbiIsIHZvaWQgMCk7CiAgICAgICAgICB0aGlzLmJsb2NrUG9zaXRpb24gPSBibG9ja1Bvc2l0aW9uOwogICAgICAgICAgdGhpcy5kYXRhUG9zaXRpb24gPSBkYXRhUG9zaXRpb247CiAgICAgICAgfQogICAgICAgICgwLCBfY3JlYXRlQ2xhc3MyLmRlZmF1bHQpKFZpcnR1YWxPZmZzZXQyLCBbewogICAgICAgICAga2V5OiAidG9TdHJpbmciLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHRvU3RyaW5nKCkgewogICAgICAgICAgICB2YXIgX2NvbnRleHQ7CiAgICAgICAgICAgIHJldHVybiAoMCwgX2NvbmNhdC5kZWZhdWx0KShfY29udGV4dCA9ICIiLmNvbmNhdCh0aGlzLmJsb2NrUG9zaXRpb24sICI6IikpLmNhbGwoX2NvbnRleHQsIHRoaXMuZGF0YVBvc2l0aW9uKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJjb21wYXJlVG8iLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBhcmVUbyhiKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmJsb2NrUG9zaXRpb24gLSBiLmJsb2NrUG9zaXRpb24gfHwgdGhpcy5kYXRhUG9zaXRpb24gLSBiLmRhdGFQb3NpdGlvbjsKICAgICAgICAgIH0KICAgICAgICB9XSwgW3sKICAgICAgICAgIGtleTogIm1pbiIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gbWluKCkgewogICAgICAgICAgICB2YXIgbWluMjsKICAgICAgICAgICAgdmFyIGkgPSAwOwogICAgICAgICAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKICAgICAgICAgICAgICBhcmdzW19rZXldID0gYXJndW1lbnRzW19rZXldOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoOyAhbWluMjsgaSArPSAxKSB7CiAgICAgICAgICAgICAgbWluMiA9IGFyZ3NbaV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yICg7IGkgPCBhcmdzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgaWYgKG1pbjIuY29tcGFyZVRvKGFyZ3NbaV0pID4gMCkgewogICAgICAgICAgICAgICAgbWluMiA9IGFyZ3NbaV07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBtaW4yOwogICAgICAgICAgfQogICAgICAgIH1dKTsKICAgICAgICByZXR1cm4gVmlydHVhbE9mZnNldDI7CiAgICAgIH0oKTsKICAgICAgZXhwb3J0cy5kZWZhdWx0ID0gVmlydHVhbE9mZnNldDsKICAgICAgZnVuY3Rpb24gZnJvbUJ5dGVzKGJ5dGVzKSB7CiAgICAgICAgdmFyIG9mZnNldCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzFdIDogMDsKICAgICAgICB2YXIgYmlnZW5kaWFuID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMl0gOiBmYWxzZTsKICAgICAgICBpZiAoYmlnZW5kaWFuKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImJpZy1lbmRpYW4gdmlydHVhbCBmaWxlIG9mZnNldHMgbm90IGltcGxlbWVudGVkIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgVmlydHVhbE9mZnNldChieXRlc1tvZmZzZXQgKyA3XSAqIDEwOTk1MTE2Mjc3NzYgKyBieXRlc1tvZmZzZXQgKyA2XSAqIDQyOTQ5NjcyOTYgKyBieXRlc1tvZmZzZXQgKyA1XSAqIDE2Nzc3MjE2ICsgYnl0ZXNbb2Zmc2V0ICsgNF0gKiA2NTUzNiArIGJ5dGVzW29mZnNldCArIDNdICogMjU2ICsgYnl0ZXNbb2Zmc2V0ICsgMl0sIGJ5dGVzW29mZnNldCArIDFdIDw8IDggfCBieXRlc1tvZmZzZXRdKTsKICAgICAgfQogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGdtb2QvYmFtL2Rpc3QvY2h1bmsuanMKICB2YXIgcmVxdWlyZV9jaHVuayA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AZ21vZC9iYW0vZGlzdC9jaHVuay5qcyIoZXhwb3J0cykgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlX2ludGVyb3BSZXF1aXJlRGVmYXVsdCgpOwogICAgICB2YXIgX09iamVjdCRkZWZpbmVQcm9wZXJ0eSA9IHJlcXVpcmVfZGVmaW5lX3Byb3BlcnR5MygpOwogICAgICBfT2JqZWN0JGRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICAgIHZhbHVlOiB0cnVlCiAgICAgIH0pOwogICAgICBleHBvcnRzLmRlZmF1bHQgPSB2b2lkIDA7CiAgICAgIHZhciBfY29uY2F0ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2NvbmNhdDQoKSk7CiAgICAgIHZhciBfY2xhc3NDYWxsQ2hlY2syID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2NsYXNzQ2FsbENoZWNrKCkpOwogICAgICB2YXIgX2NyZWF0ZUNsYXNzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9jcmVhdGVDbGFzcygpKTsKICAgICAgdmFyIF9kZWZpbmVQcm9wZXJ0eTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfZGVmaW5lUHJvcGVydHkoKSk7CiAgICAgIHZhciBDaHVuayA9IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbigpIHsKICAgICAgICBmdW5jdGlvbiBDaHVuazIobWludiwgbWF4diwgYmluKSB7CiAgICAgICAgICB2YXIgZmV0Y2hlZFNpemUgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1szXSA6IHZvaWQgMDsKICAgICAgICAgICgwLCBfY2xhc3NDYWxsQ2hlY2syLmRlZmF1bHQpKHRoaXMsIENodW5rMik7CiAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5Mi5kZWZhdWx0KSh0aGlzLCAibWludiIsIHZvaWQgMCk7CiAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5Mi5kZWZhdWx0KSh0aGlzLCAibWF4diIsIHZvaWQgMCk7CiAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5Mi5kZWZhdWx0KSh0aGlzLCAiYmluIiwgdm9pZCAwKTsKICAgICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyLmRlZmF1bHQpKHRoaXMsICJfZmV0Y2hlZFNpemUiLCB2b2lkIDApOwogICAgICAgICAgdGhpcy5taW52ID0gbWludjsKICAgICAgICAgIHRoaXMubWF4diA9IG1heHY7CiAgICAgICAgICB0aGlzLmJpbiA9IGJpbjsKICAgICAgICAgIHRoaXMuX2ZldGNoZWRTaXplID0gZmV0Y2hlZFNpemU7CiAgICAgICAgfQogICAgICAgICgwLCBfY3JlYXRlQ2xhc3MyLmRlZmF1bHQpKENodW5rMiwgW3sKICAgICAgICAgIGtleTogInRvVW5pcXVlU3RyaW5nIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiB0b1VuaXF1ZVN0cmluZygpIHsKICAgICAgICAgICAgdmFyIF9jb250ZXh0LCBfY29udGV4dDIsIF9jb250ZXh0MzsKICAgICAgICAgICAgcmV0dXJuICgwLCBfY29uY2F0LmRlZmF1bHQpKF9jb250ZXh0ID0gKDAsIF9jb25jYXQuZGVmYXVsdCkoX2NvbnRleHQyID0gKDAsIF9jb25jYXQuZGVmYXVsdCkoX2NvbnRleHQzID0gIiIuY29uY2F0KHRoaXMubWludiwgIi4uIikpLmNhbGwoX2NvbnRleHQzLCB0aGlzLm1heHYsICIgKGJpbiAiKSkuY2FsbChfY29udGV4dDIsIHRoaXMuYmluLCAiLCBmZXRjaGVkU2l6ZSAiKSkuY2FsbChfY29udGV4dCwgdGhpcy5mZXRjaGVkU2l6ZSgpLCAiKSIpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInRvU3RyaW5nIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiB0b1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMudG9VbmlxdWVTdHJpbmcoKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJjb21wYXJlVG8iLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBhcmVUbyhiKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm1pbnYuY29tcGFyZVRvKGIubWludikgfHwgdGhpcy5tYXh2LmNvbXBhcmVUbyhiLm1heHYpIHx8IHRoaXMuYmluIC0gYi5iaW47CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiZmV0Y2hlZFNpemUiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoZWRTaXplKCkgewogICAgICAgICAgICBpZiAodGhpcy5fZmV0Y2hlZFNpemUgIT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mZXRjaGVkU2l6ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5tYXh2LmJsb2NrUG9zaXRpb24gKyAoMSA8PCAxNikgLSB0aGlzLm1pbnYuYmxvY2tQb3NpdGlvbjsKICAgICAgICAgIH0KICAgICAgICB9XSk7CiAgICAgICAgcmV0dXJuIENodW5rMjsKICAgICAgfSgpOwogICAgICBleHBvcnRzLmRlZmF1bHQgPSBDaHVuazsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvaW50ZXJvcFJlcXVpcmVEZWZhdWx0LmpzCiAgdmFyIHJlcXVpcmVfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2ludGVyb3BSZXF1aXJlRGVmYXVsdC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICAgICAgICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgICAgICAgImRlZmF1bHQiOiBvYmoKICAgICAgICB9OwogICAgICB9CiAgICAgIG1vZHVsZS5leHBvcnRzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDsKICAgICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvdHlwZW9mLmpzCiAgdmFyIHJlcXVpcmVfdHlwZW9mMiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL3R5cGVvZi5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgICAiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiOwogICAgICAgIGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7CiAgICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mMihvYmoyKSB7CiAgICAgICAgICAgIHJldHVybiB0eXBlb2Ygb2JqMjsKICAgICAgICAgIH07CiAgICAgICAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mMihvYmoyKSB7CiAgICAgICAgICAgIHJldHVybiBvYmoyICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqMi5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iajIgIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmoyOwogICAgICAgICAgfTsKICAgICAgICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfdHlwZW9mKG9iaik7CiAgICAgIH0KICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfdHlwZW9mOwogICAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjay5qcwogIHZhciByZXF1aXJlX2NsYXNzQ2FsbENoZWNrMiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7CiAgICAgICAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogICAgICAgIH0KICAgICAgfQogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9jbGFzc0NhbGxDaGVjazsKICAgICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MuanMKICB2YXIgcmVxdWlyZV9jcmVhdGVDbGFzczIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcy5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICAgICAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICAgICAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CiAgICAgICAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKQogICAgICAgICAgICBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogICAgICAgIGlmIChwcm90b1Byb3BzKQogICAgICAgICAgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICAgICAgICBpZiAoc3RhdGljUHJvcHMpCiAgICAgICAgICBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOwogICAgICAgIHJldHVybiBDb25zdHJ1Y3RvcjsKICAgICAgfQogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9jcmVhdGVDbGFzczsKICAgICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZGVmaW5lUHJvcGVydHkuanMKICB2YXIgcmVxdWlyZV9kZWZpbmVQcm9wZXJ0eTIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9kZWZpbmVQcm9wZXJ0eS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogICAgICAgIGlmIChrZXkgaW4gb2JqKSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgICAgICAgdmFsdWUsCiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgd3JpdGFibGU6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBvYmpba2V5XSA9IHZhbHVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gb2JqOwogICAgICB9CiAgICAgIG1vZHVsZS5leHBvcnRzID0gX2RlZmluZVByb3BlcnR5OwogICAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvYWJvcnRjb250cm9sbGVyLXBvbHlmaWxsL2Rpc3QvY2pzLXBvbnlmaWxsLmpzCiAgdmFyIHJlcXVpcmVfY2pzX3BvbnlmaWxsID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2Fib3J0Y29udHJvbGxlci1wb2x5ZmlsbC9kaXN0L2Nqcy1wb255ZmlsbC5qcyIoZXhwb3J0cykgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICAgICAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogICAgICAgIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICAgICAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICAgICAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CiAgICAgICAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKQogICAgICAgICAgICBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogICAgICAgIGlmIChwcm90b1Byb3BzKQogICAgICAgICAgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICAgICAgICBpZiAoc3RhdGljUHJvcHMpCiAgICAgICAgICBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOwogICAgICAgIHJldHVybiBDb25zdHJ1Y3RvcjsKICAgICAgfQogICAgICBmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsKICAgICAgICBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsKICAgICAgICB9CiAgICAgICAgc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7CiAgICAgICAgICBjb25zdHJ1Y3RvcjogewogICAgICAgICAgICB2YWx1ZTogc3ViQ2xhc3MsCiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBpZiAoc3VwZXJDbGFzcykKICAgICAgICAgIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsKICAgICAgICBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YyKG8yKSB7CiAgICAgICAgICByZXR1cm4gbzIuX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvMik7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgICAgICAgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZjIobzIsIHAyKSB7CiAgICAgICAgICBvMi5fX3Byb3RvX18gPSBwMjsKICAgICAgICAgIHJldHVybiBvMjsKICAgICAgICB9OwogICAgICAgIHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpIHsKICAgICAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09ICJ1bmRlZmluZWQiIHx8ICFSZWZsZWN0LmNvbnN0cnVjdCkKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoUmVmbGVjdC5jb25zdHJ1Y3Quc2hhbSkKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAodHlwZW9mIFByb3h5ID09PSAiZnVuY3Rpb24iKQogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIEJvb2xlYW4ucHJvdG90eXBlLnZhbHVlT2YuY2FsbChSZWZsZWN0LmNvbnN0cnVjdChCb29sZWFuLCBbXSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICB9KSk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZjIpIHsKICAgICAgICBpZiAoc2VsZjIgPT09IHZvaWQgMCkgewogICAgICAgICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGYyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYyLCBjYWxsKSB7CiAgICAgICAgaWYgKGNhbGwgJiYgKHR5cGVvZiBjYWxsID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsKICAgICAgICAgIHJldHVybiBjYWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gX2NyZWF0ZVN1cGVyKERlcml2ZWQpIHsKICAgICAgICB2YXIgaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCA9IF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKTsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gX2NyZWF0ZVN1cGVySW50ZXJuYWwoKSB7CiAgICAgICAgICB2YXIgU3VwZXIgPSBfZ2V0UHJvdG90eXBlT2YoRGVyaXZlZCksIHJlc3VsdDsKICAgICAgICAgIGlmIChoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KSB7CiAgICAgICAgICAgIHZhciBOZXdUYXJnZXQgPSBfZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3I7CiAgICAgICAgICAgIHJlc3VsdCA9IFJlZmxlY3QuY29uc3RydWN0KFN1cGVyLCBhcmd1bWVudHMsIE5ld1RhcmdldCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHQgPSBTdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIHJlc3VsdCk7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBfc3VwZXJQcm9wQmFzZShvYmplY3QsIHByb3BlcnR5KSB7CiAgICAgICAgd2hpbGUgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSkpIHsKICAgICAgICAgIG9iamVjdCA9IF9nZXRQcm90b3R5cGVPZihvYmplY3QpOwogICAgICAgICAgaWYgKG9iamVjdCA9PT0gbnVsbCkKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHJldHVybiBvYmplY3Q7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gX2dldCh0YXJnZXQsIHByb3BlcnR5LCByZWNlaXZlcikgewogICAgICAgIGlmICh0eXBlb2YgUmVmbGVjdCAhPT0gInVuZGVmaW5lZCIgJiYgUmVmbGVjdC5nZXQpIHsKICAgICAgICAgIF9nZXQgPSBSZWZsZWN0LmdldDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX2dldCA9IGZ1bmN0aW9uIF9nZXQyKHRhcmdldDIsIHByb3BlcnR5MiwgcmVjZWl2ZXIyKSB7CiAgICAgICAgICAgIHZhciBiYXNlID0gX3N1cGVyUHJvcEJhc2UodGFyZ2V0MiwgcHJvcGVydHkyKTsKICAgICAgICAgICAgaWYgKCFiYXNlKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGJhc2UsIHByb3BlcnR5Mik7CiAgICAgICAgICAgIGlmIChkZXNjLmdldCkgewogICAgICAgICAgICAgIHJldHVybiBkZXNjLmdldC5jYWxsKHJlY2VpdmVyMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGRlc2MudmFsdWU7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2dldCh0YXJnZXQsIHByb3BlcnR5LCByZWNlaXZlciB8fCB0YXJnZXQpOwogICAgICB9CiAgICAgIHZhciBFbWl0dGVyID0gLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKCkgewogICAgICAgIGZ1bmN0aW9uIEVtaXR0ZXIyKCkgewogICAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEVtaXR0ZXIyKTsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAibGlzdGVuZXJzIiwgewogICAgICAgICAgICB2YWx1ZToge30sCiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBfY3JlYXRlQ2xhc3MoRW1pdHRlcjIsIFt7CiAgICAgICAgICBrZXk6ICJhZGRFdmVudExpc3RlbmVyIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRFdmVudExpc3RlbmVyKHR5cGUsIGNhbGxiYWNrLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGlmICghKHR5cGUgaW4gdGhpcy5saXN0ZW5lcnMpKSB7CiAgICAgICAgICAgICAgdGhpcy5saXN0ZW5lcnNbdHlwZV0gPSBbXTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmxpc3RlbmVyc1t0eXBlXS5wdXNoKHsKICAgICAgICAgICAgICBjYWxsYmFjaywKICAgICAgICAgICAgICBvcHRpb25zCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInJlbW92ZUV2ZW50TGlzdGVuZXIiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgY2FsbGJhY2spIHsKICAgICAgICAgICAgaWYgKCEodHlwZSBpbiB0aGlzLmxpc3RlbmVycykpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHN0YWNrID0gdGhpcy5saXN0ZW5lcnNbdHlwZV07CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gc3RhY2subGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKHN0YWNrW2ldLmNhbGxiYWNrID09PSBjYWxsYmFjaykgewogICAgICAgICAgICAgICAgc3RhY2suc3BsaWNlKGksIDEpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImRpc3BhdGNoRXZlbnQiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgICAgICAgICAgaWYgKCEoZXZlbnQudHlwZSBpbiB0aGlzLmxpc3RlbmVycykpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHN0YWNrID0gdGhpcy5saXN0ZW5lcnNbZXZlbnQudHlwZV07CiAgICAgICAgICAgIHZhciBzdGFja1RvQ2FsbCA9IHN0YWNrLnNsaWNlKCk7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gc3RhY2tUb0NhbGwubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgICAgdmFyIGxpc3RlbmVyID0gc3RhY2tUb0NhbGxbaV07CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGxpc3RlbmVyLmNhbGxiYWNrLmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGxpc3RlbmVyLm9wdGlvbnMgJiYgbGlzdGVuZXIub3B0aW9ucy5vbmNlKSB7CiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQudHlwZSwgbGlzdGVuZXIuY2FsbGJhY2spOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gIWV2ZW50LmRlZmF1bHRQcmV2ZW50ZWQ7CiAgICAgICAgICB9CiAgICAgICAgfV0pOwogICAgICAgIHJldHVybiBFbWl0dGVyMjsKICAgICAgfSgpOwogICAgICB2YXIgQWJvcnRTaWduYWwgPSAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24oX0VtaXR0ZXIpIHsKICAgICAgICBfaW5oZXJpdHMoQWJvcnRTaWduYWwyLCBfRW1pdHRlcik7CiAgICAgICAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihBYm9ydFNpZ25hbDIpOwogICAgICAgIGZ1bmN0aW9uIEFib3J0U2lnbmFsMigpIHsKICAgICAgICAgIHZhciBfdGhpczsKICAgICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBBYm9ydFNpZ25hbDIpOwogICAgICAgICAgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKTsKICAgICAgICAgIGlmICghX3RoaXMubGlzdGVuZXJzKSB7CiAgICAgICAgICAgIEVtaXR0ZXIuY2FsbChfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7CiAgICAgICAgICB9CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJhYm9ydGVkIiwgewogICAgICAgICAgICB2YWx1ZTogZmFsc2UsCiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25hYm9ydCIsIHsKICAgICAgICAgICAgdmFsdWU6IG51bGwsCiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICAgIH0KICAgICAgICBfY3JlYXRlQ2xhc3MoQWJvcnRTaWduYWwyLCBbewogICAgICAgICAga2V5OiAidG9TdHJpbmciLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHRvU3RyaW5nKCkgewogICAgICAgICAgICByZXR1cm4gIltvYmplY3QgQWJvcnRTaWduYWxdIjsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJkaXNwYXRjaEV2ZW50IiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNwYXRjaEV2ZW50KGV2ZW50KSB7CiAgICAgICAgICAgIGlmIChldmVudC50eXBlID09PSAiYWJvcnQiKSB7CiAgICAgICAgICAgICAgdGhpcy5hYm9ydGVkID0gdHJ1ZTsKICAgICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMub25hYm9ydCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgdGhpcy5vbmFib3J0LmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBfZ2V0KF9nZXRQcm90b3R5cGVPZihBYm9ydFNpZ25hbDIucHJvdG90eXBlKSwgImRpc3BhdGNoRXZlbnQiLCB0aGlzKS5jYWxsKHRoaXMsIGV2ZW50KTsKICAgICAgICAgIH0KICAgICAgICB9XSk7CiAgICAgICAgcmV0dXJuIEFib3J0U2lnbmFsMjsKICAgICAgfShFbWl0dGVyKTsKICAgICAgdmFyIEFib3J0Q29udHJvbGxlciA9IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbigpIHsKICAgICAgICBmdW5jdGlvbiBBYm9ydENvbnRyb2xsZXIyKCkgewogICAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEFib3J0Q29udHJvbGxlcjIpOwogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICJzaWduYWwiLCB7CiAgICAgICAgICAgIHZhbHVlOiBuZXcgQWJvcnRTaWduYWwoKSwKICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIF9jcmVhdGVDbGFzcyhBYm9ydENvbnRyb2xsZXIyLCBbewogICAgICAgICAga2V5OiAiYWJvcnQiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGFib3J0KCkgewogICAgICAgICAgICB2YXIgZXZlbnQ7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgZXZlbnQgPSBuZXcgRXZlbnQoImFib3J0Iik7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICBpZiAodHlwZW9mIGRvY3VtZW50ICE9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgaWYgKCFkb2N1bWVudC5jcmVhdGVFdmVudCkgewogICAgICAgICAgICAgICAgICBldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50T2JqZWN0KCk7CiAgICAgICAgICAgICAgICAgIGV2ZW50LnR5cGUgPSAiYWJvcnQiOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgZXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgiRXZlbnQiKTsKICAgICAgICAgICAgICAgICAgZXZlbnQuaW5pdEV2ZW50KCJhYm9ydCIsIGZhbHNlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGV2ZW50ID0gewogICAgICAgICAgICAgICAgICB0eXBlOiAiYWJvcnQiLAogICAgICAgICAgICAgICAgICBidWJibGVzOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgY2FuY2VsYWJsZTogZmFsc2UKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuc2lnbmFsLmRpc3BhdGNoRXZlbnQoZXZlbnQpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInRvU3RyaW5nIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiB0b1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJuICJbb2JqZWN0IEFib3J0Q29udHJvbGxlcl0iOwogICAgICAgICAgfQogICAgICAgIH1dKTsKICAgICAgICByZXR1cm4gQWJvcnRDb250cm9sbGVyMjsKICAgICAgfSgpOwogICAgICBpZiAodHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7CiAgICAgICAgQWJvcnRDb250cm9sbGVyLnByb3RvdHlwZVtTeW1ib2wudG9TdHJpbmdUYWddID0gIkFib3J0Q29udHJvbGxlciI7CiAgICAgICAgQWJvcnRTaWduYWwucHJvdG90eXBlW1N5bWJvbC50b1N0cmluZ1RhZ10gPSAiQWJvcnRTaWduYWwiOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHBvbHlmaWxsTmVlZGVkKHNlbGYyKSB7CiAgICAgICAgaWYgKHNlbGYyLl9fRk9SQ0VfSU5TVEFMTF9BQk9SVENPTlRST0xMRVJfUE9MWUZJTEwpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJfX0ZPUkNFX0lOU1RBTExfQUJPUlRDT05UUk9MTEVSX1BPTFlGSUxMPXRydWUgaXMgc2V0LCB3aWxsIGZvcmNlIGluc3RhbGwgcG9seWZpbGwiKTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHlwZW9mIHNlbGYyLlJlcXVlc3QgPT09ICJmdW5jdGlvbiIgJiYgIXNlbGYyLlJlcXVlc3QucHJvdG90eXBlLmhhc093blByb3BlcnR5KCJzaWduYWwiKSB8fCAhc2VsZjIuQWJvcnRDb250cm9sbGVyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGFib3J0YWJsZUZldGNoRGVjb3JhdG9yKHBhdGNoVGFyZ2V0cykgewogICAgICAgIGlmICh0eXBlb2YgcGF0Y2hUYXJnZXRzID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICBwYXRjaFRhcmdldHMgPSB7CiAgICAgICAgICAgIGZldGNoOiBwYXRjaFRhcmdldHMKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHZhciBfcGF0Y2hUYXJnZXRzID0gcGF0Y2hUYXJnZXRzLCBmZXRjaDIgPSBfcGF0Y2hUYXJnZXRzLmZldGNoLCBfcGF0Y2hUYXJnZXRzJFJlcXVlc3QgPSBfcGF0Y2hUYXJnZXRzLlJlcXVlc3QsIE5hdGl2ZVJlcXVlc3QgPSBfcGF0Y2hUYXJnZXRzJFJlcXVlc3QgPT09IHZvaWQgMCA/IGZldGNoMi5SZXF1ZXN0IDogX3BhdGNoVGFyZ2V0cyRSZXF1ZXN0LCBOYXRpdmVBYm9ydENvbnRyb2xsZXIgPSBfcGF0Y2hUYXJnZXRzLkFib3J0Q29udHJvbGxlciwgX3BhdGNoVGFyZ2V0cyRfX0ZPUkNFID0gX3BhdGNoVGFyZ2V0cy5fX0ZPUkNFX0lOU1RBTExfQUJPUlRDT05UUk9MTEVSX1BPTFlGSUxMLCBfX0ZPUkNFX0lOU1RBTExfQUJPUlRDT05UUk9MTEVSX1BPTFlGSUxMID0gX3BhdGNoVGFyZ2V0cyRfX0ZPUkNFID09PSB2b2lkIDAgPyBmYWxzZSA6IF9wYXRjaFRhcmdldHMkX19GT1JDRTsKICAgICAgICBpZiAoIXBvbHlmaWxsTmVlZGVkKHsKICAgICAgICAgIGZldGNoOiBmZXRjaDIsCiAgICAgICAgICBSZXF1ZXN0OiBOYXRpdmVSZXF1ZXN0LAogICAgICAgICAgQWJvcnRDb250cm9sbGVyOiBOYXRpdmVBYm9ydENvbnRyb2xsZXIsCiAgICAgICAgICBfX0ZPUkNFX0lOU1RBTExfQUJPUlRDT05UUk9MTEVSX1BPTFlGSUxMCiAgICAgICAgfSkpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGZldGNoOiBmZXRjaDIsCiAgICAgICAgICAgIFJlcXVlc3QKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHZhciBSZXF1ZXN0ID0gTmF0aXZlUmVxdWVzdDsKICAgICAgICBpZiAoUmVxdWVzdCAmJiAhUmVxdWVzdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkoInNpZ25hbCIpIHx8IF9fRk9SQ0VfSU5TVEFMTF9BQk9SVENPTlRST0xMRVJfUE9MWUZJTEwpIHsKICAgICAgICAgIFJlcXVlc3QgPSBmdW5jdGlvbiBSZXF1ZXN0MihpbnB1dCwgaW5pdDIpIHsKICAgICAgICAgICAgdmFyIHNpZ25hbDsKICAgICAgICAgICAgaWYgKGluaXQyICYmIGluaXQyLnNpZ25hbCkgewogICAgICAgICAgICAgIHNpZ25hbCA9IGluaXQyLnNpZ25hbDsKICAgICAgICAgICAgICBkZWxldGUgaW5pdDIuc2lnbmFsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gbmV3IE5hdGl2ZVJlcXVlc3QoaW5wdXQsIGluaXQyKTsKICAgICAgICAgICAgaWYgKHNpZ25hbCkgewogICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyZXF1ZXN0LCAic2lnbmFsIiwgewogICAgICAgICAgICAgICAgd3JpdGFibGU6IGZhbHNlLAogICAgICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgICAgICAgICB2YWx1ZTogc2lnbmFsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3Q7CiAgICAgICAgICB9OwogICAgICAgICAgUmVxdWVzdC5wcm90b3R5cGUgPSBOYXRpdmVSZXF1ZXN0LnByb3RvdHlwZTsKICAgICAgICB9CiAgICAgICAgdmFyIHJlYWxGZXRjaCA9IGZldGNoMjsKICAgICAgICB2YXIgYWJvcnRhYmxlRmV0Y2ggPSBmdW5jdGlvbiBhYm9ydGFibGVGZXRjaDIoaW5wdXQsIGluaXQyKSB7CiAgICAgICAgICB2YXIgc2lnbmFsID0gUmVxdWVzdCAmJiBSZXF1ZXN0LnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKGlucHV0KSA/IGlucHV0LnNpZ25hbCA6IGluaXQyID8gaW5pdDIuc2lnbmFsIDogdm9pZCAwOwogICAgICAgICAgaWYgKHNpZ25hbCkgewogICAgICAgICAgICB2YXIgYWJvcnRFcnJvcjsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBhYm9ydEVycm9yID0gbmV3IERPTUV4Y2VwdGlvbigiQWJvcnRlZCIsICJBYm9ydEVycm9yIik7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgIGFib3J0RXJyb3IgPSBuZXcgRXJyb3IoIkFib3J0ZWQiKTsKICAgICAgICAgICAgICBhYm9ydEVycm9yLm5hbWUgPSAiQWJvcnRFcnJvciI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHNpZ25hbC5hYm9ydGVkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGFib3J0RXJyb3IpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBjYW5jZWxsYXRpb24gPSBuZXcgUHJvbWlzZShmdW5jdGlvbihfLCByZWplY3QpIHsKICAgICAgICAgICAgICBzaWduYWwuYWRkRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZWplY3QoYWJvcnRFcnJvcik7CiAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgb25jZTogdHJ1ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKGluaXQyICYmIGluaXQyLnNpZ25hbCkgewogICAgICAgICAgICAgIGRlbGV0ZSBpbml0Mi5zaWduYWw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmFjZShbY2FuY2VsbGF0aW9uLCByZWFsRmV0Y2goaW5wdXQsIGluaXQyKV0pOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHJlYWxGZXRjaChpbnB1dCwgaW5pdDIpOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGZldGNoOiBhYm9ydGFibGVGZXRjaCwKICAgICAgICAgIFJlcXVlc3QKICAgICAgICB9OwogICAgICB9CiAgICAgIGV4cG9ydHMuQWJvcnRDb250cm9sbGVyID0gQWJvcnRDb250cm9sbGVyOwogICAgICBleHBvcnRzLkFib3J0U2lnbmFsID0gQWJvcnRTaWduYWw7CiAgICAgIGV4cG9ydHMuYWJvcnRhYmxlRmV0Y2ggPSBhYm9ydGFibGVGZXRjaERlY29yYXRvcjsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2Fib3J0YWJsZS1wcm9taXNlLWNhY2hlL2Rpc3QvYWJvcnRjb250cm9sbGVyLXBvbnlmaWxsLmpzCiAgdmFyIHJlcXVpcmVfYWJvcnRjb250cm9sbGVyX3BvbnlmaWxsID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2Fib3J0YWJsZS1wcm9taXNlLWNhY2hlL2Rpc3QvYWJvcnRjb250cm9sbGVyLXBvbnlmaWxsLmpzIihleHBvcnRzKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgICBleHBvcnRzLkFib3J0U2lnbmFsID0gZXhwb3J0cy5BYm9ydENvbnRyb2xsZXIgPSB2b2lkIDA7CiAgICAgIHZhciBfY2pzUG9ueWZpbGwgPSByZXF1aXJlX2Nqc19wb255ZmlsbCgpOwogICAgICB2YXIgZ2V0R2xvYmFsID0gZnVuY3Rpb24gZ2V0R2xvYmFsMigpIHsKICAgICAgICBpZiAodHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICByZXR1cm4gd2luZG93OwogICAgICAgIH0KICAgICAgICBpZiAodHlwZW9mIGdsb2JhbCAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgIHJldHVybiBnbG9iYWw7CiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBFcnJvcigidW5hYmxlIHRvIGxvY2F0ZSBnbG9iYWwgb2JqZWN0Iik7CiAgICAgIH07CiAgICAgIHZhciBBYm9ydENvbnRyb2xsZXIgPSB0eXBlb2YgZ2V0R2xvYmFsKCkuQWJvcnRDb250cm9sbGVyID09PSAidW5kZWZpbmVkIiA/IF9janNQb255ZmlsbC5BYm9ydENvbnRyb2xsZXIgOiBnZXRHbG9iYWwoKS5BYm9ydENvbnRyb2xsZXI7CiAgICAgIGV4cG9ydHMuQWJvcnRDb250cm9sbGVyID0gQWJvcnRDb250cm9sbGVyOwogICAgICB2YXIgQWJvcnRTaWduYWwgPSB0eXBlb2YgZ2V0R2xvYmFsKCkuQWJvcnRDb250cm9sbGVyID09PSAidW5kZWZpbmVkIiA/IF9janNQb255ZmlsbC5BYm9ydFNpZ25hbCA6IGdldEdsb2JhbCgpLkFib3J0U2lnbmFsOwogICAgICBleHBvcnRzLkFib3J0U2lnbmFsID0gQWJvcnRTaWduYWw7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9hYm9ydGFibGUtcHJvbWlzZS1jYWNoZS9kaXN0L0FnZ3JlZ2F0ZUFib3J0Q29udHJvbGxlci5qcwogIHZhciByZXF1aXJlX0FnZ3JlZ2F0ZUFib3J0Q29udHJvbGxlciA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9hYm9ydGFibGUtcHJvbWlzZS1jYWNoZS9kaXN0L0FnZ3JlZ2F0ZUFib3J0Q29udHJvbGxlci5qcyIoZXhwb3J0cykgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoKTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICAgICAgZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwOwogICAgICB2YXIgX2NyZWF0ZUNsYXNzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9jcmVhdGVDbGFzczIoKSk7CiAgICAgIHZhciBfZGVmaW5lUHJvcGVydHkyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2RlZmluZVByb3BlcnR5MigpKTsKICAgICAgdmFyIF9jbGFzc0NhbGxDaGVjazIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfY2xhc3NDYWxsQ2hlY2syKCkpOwogICAgICB2YXIgX2Fib3J0Y29udHJvbGxlclBvbnlmaWxsID0gcmVxdWlyZV9hYm9ydGNvbnRyb2xsZXJfcG9ueWZpbGwoKTsKICAgICAgdmFyIE51bGxTaWduYWwgPSBmdW5jdGlvbiBOdWxsU2lnbmFsMigpIHsKICAgICAgICAoMCwgX2NsYXNzQ2FsbENoZWNrMi5kZWZhdWx0KSh0aGlzLCBOdWxsU2lnbmFsMik7CiAgICAgIH07CiAgICAgIHZhciBBZ2dyZWdhdGVBYm9ydENvbnRyb2xsZXIgPSAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24oKSB7CiAgICAgICAgZnVuY3Rpb24gQWdncmVnYXRlQWJvcnRDb250cm9sbGVyMigpIHsKICAgICAgICAgICgwLCBfY2xhc3NDYWxsQ2hlY2syLmRlZmF1bHQpKHRoaXMsIEFnZ3JlZ2F0ZUFib3J0Q29udHJvbGxlcjIpOwogICAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIuZGVmYXVsdCkodGhpcywgInNpZ25hbHMiLCBuZXcgU2V0KCkpOwogICAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIuZGVmYXVsdCkodGhpcywgImFib3J0Q29udHJvbGxlciIsIG5ldyBfYWJvcnRjb250cm9sbGVyUG9ueWZpbGwuQWJvcnRDb250cm9sbGVyKCkpOwogICAgICAgIH0KICAgICAgICAoMCwgX2NyZWF0ZUNsYXNzMi5kZWZhdWx0KShBZ2dyZWdhdGVBYm9ydENvbnRyb2xsZXIyLCBbewogICAgICAgICAga2V5OiAiYWRkU2lnbmFsIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRTaWduYWwoKSB7CiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgIHZhciBzaWduYWwgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1swXSA6IG5ldyBOdWxsU2lnbmFsKCk7CiAgICAgICAgICAgIGlmICh0aGlzLnNpZ25hbC5hYm9ydGVkKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJjYW5ub3QgYWRkIGEgc2lnbmFsLCBhbHJlYWR5IGFib3J0ZWQhIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zaWduYWxzLmFkZChzaWduYWwpOwogICAgICAgICAgICBpZiAoc2lnbmFsLmFib3J0ZWQpIHsKICAgICAgICAgICAgICB0aGlzLmhhbmRsZUFib3J0ZWQoc2lnbmFsKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygc2lnbmFsLmFkZEV2ZW50TGlzdGVuZXIgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICBzaWduYWwuYWRkRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIF90aGlzLmhhbmRsZUFib3J0ZWQoc2lnbmFsKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIHsga2V5OiAiaGFuZGxlQWJvcnRlZCIsIHZhbHVlOiBmdW5jdGlvbiBoYW5kbGVBYm9ydGVkKHNpZ25hbCkgewogICAgICAgICAgdGhpcy5zaWduYWxzLmRlbGV0ZShzaWduYWwpOwogICAgICAgICAgaWYgKHRoaXMuc2lnbmFscy5zaXplID09PSAwKSB7CiAgICAgICAgICAgIHRoaXMuYWJvcnRDb250cm9sbGVyLmFib3J0KCk7CiAgICAgICAgICB9CiAgICAgICAgfSB9LCB7IGtleTogImFib3J0IiwgdmFsdWU6IGZ1bmN0aW9uIGFib3J0KCkgewogICAgICAgICAgdGhpcy5hYm9ydENvbnRyb2xsZXIuYWJvcnQoKTsKICAgICAgICB9IH0sIHsga2V5OiAic2lnbmFsIiwgZ2V0OiBmdW5jdGlvbiBnZXQyKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuYWJvcnRDb250cm9sbGVyLnNpZ25hbDsKICAgICAgICB9IH1dKTsKICAgICAgICByZXR1cm4gQWdncmVnYXRlQWJvcnRDb250cm9sbGVyMjsKICAgICAgfSgpOwogICAgICBleHBvcnRzLmRlZmF1bHQgPSBBZ2dyZWdhdGVBYm9ydENvbnRyb2xsZXI7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9hYm9ydGFibGUtcHJvbWlzZS1jYWNoZS9kaXN0L0FnZ3JlZ2F0ZVN0YXR1c1JlcG9ydGVyLmpzCiAgdmFyIHJlcXVpcmVfQWdncmVnYXRlU3RhdHVzUmVwb3J0ZXIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvYWJvcnRhYmxlLXByb21pc2UtY2FjaGUvZGlzdC9BZ2dyZWdhdGVTdGF0dXNSZXBvcnRlci5qcyIoZXhwb3J0cykgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoKTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICAgICAgZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwOwogICAgICB2YXIgX2NsYXNzQ2FsbENoZWNrMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9jbGFzc0NhbGxDaGVjazIoKSk7CiAgICAgIHZhciBfY3JlYXRlQ2xhc3MyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2NyZWF0ZUNsYXNzMigpKTsKICAgICAgdmFyIF9kZWZpbmVQcm9wZXJ0eTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfZGVmaW5lUHJvcGVydHkyKCkpOwogICAgICB2YXIgQWdncmVnYXRlU3RhdHVzUmVwb3J0ZXIgPSAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24oKSB7CiAgICAgICAgZnVuY3Rpb24gQWdncmVnYXRlU3RhdHVzUmVwb3J0ZXIyKCkgewogICAgICAgICAgKDAsIF9jbGFzc0NhbGxDaGVjazIuZGVmYXVsdCkodGhpcywgQWdncmVnYXRlU3RhdHVzUmVwb3J0ZXIyKTsKICAgICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyLmRlZmF1bHQpKHRoaXMsICJjYWxsYmFja3MiLCBuZXcgU2V0KCkpOwogICAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIuZGVmYXVsdCkodGhpcywgImN1cnJlbnRNZXNzYWdlIiwgdm9pZCAwKTsKICAgICAgICB9CiAgICAgICAgKDAsIF9jcmVhdGVDbGFzczIuZGVmYXVsdCkoQWdncmVnYXRlU3RhdHVzUmVwb3J0ZXIyLCBbeyBrZXk6ICJhZGRDYWxsYmFjayIsIHZhbHVlOiBmdW5jdGlvbiBhZGRDYWxsYmFjaygpIHsKICAgICAgICAgIHZhciBjYWxsYmFjayA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzBdIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICB9OwogICAgICAgICAgdGhpcy5jYWxsYmFja3MuYWRkKGNhbGxiYWNrKTsKICAgICAgICAgIGNhbGxiYWNrKHRoaXMuY3VycmVudE1lc3NhZ2UpOwogICAgICAgIH0gfSwgeyBrZXk6ICJjYWxsYmFjayIsIHZhbHVlOiBmdW5jdGlvbiBjYWxsYmFjayhtZXNzYWdlKSB7CiAgICAgICAgICB0aGlzLmN1cnJlbnRNZXNzYWdlID0gbWVzc2FnZTsKICAgICAgICAgIHRoaXMuY2FsbGJhY2tzLmZvckVhY2goZnVuY3Rpb24oZWx0KSB7CiAgICAgICAgICAgIGVsdChtZXNzYWdlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gfV0pOwogICAgICAgIHJldHVybiBBZ2dyZWdhdGVTdGF0dXNSZXBvcnRlcjI7CiAgICAgIH0oKTsKICAgICAgZXhwb3J0cy5kZWZhdWx0ID0gQWdncmVnYXRlU3RhdHVzUmVwb3J0ZXI7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9hYm9ydGFibGUtcHJvbWlzZS1jYWNoZS9kaXN0L0Fib3J0YWJsZVByb21pc2VDYWNoZS5qcwogIHZhciByZXF1aXJlX0Fib3J0YWJsZVByb21pc2VDYWNoZSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9hYm9ydGFibGUtcHJvbWlzZS1jYWNoZS9kaXN0L0Fib3J0YWJsZVByb21pc2VDYWNoZS5qcyIoZXhwb3J0cykgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoKTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICAgICAgZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwOwogICAgICB2YXIgX3R5cGVvZjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfdHlwZW9mMigpKTsKICAgICAgdmFyIF9jbGFzc0NhbGxDaGVjazIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfY2xhc3NDYWxsQ2hlY2syKCkpOwogICAgICB2YXIgX2NyZWF0ZUNsYXNzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9jcmVhdGVDbGFzczIoKSk7CiAgICAgIHZhciBfZGVmaW5lUHJvcGVydHkyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2RlZmluZVByb3BlcnR5MigpKTsKICAgICAgdmFyIF9hYm9ydGNvbnRyb2xsZXJQb255ZmlsbCA9IHJlcXVpcmVfYWJvcnRjb250cm9sbGVyX3BvbnlmaWxsKCk7CiAgICAgIHZhciBfQWdncmVnYXRlQWJvcnRDb250cm9sbGVyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX0FnZ3JlZ2F0ZUFib3J0Q29udHJvbGxlcigpKTsKICAgICAgdmFyIF9BZ2dyZWdhdGVTdGF0dXNSZXBvcnRlciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9BZ2dyZWdhdGVTdGF0dXNSZXBvcnRlcigpKTsKICAgICAgdmFyIEFib3J0YWJsZVByb21pc2VDYWNoZSA9IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbigpIHsKICAgICAgICBmdW5jdGlvbiBBYm9ydGFibGVQcm9taXNlQ2FjaGUyKF9yZWYpIHsKICAgICAgICAgIHZhciBmaWxsID0gX3JlZi5maWxsLCBjYWNoZSA9IF9yZWYuY2FjaGU7CiAgICAgICAgICAoMCwgX2NsYXNzQ2FsbENoZWNrMi5kZWZhdWx0KSh0aGlzLCBBYm9ydGFibGVQcm9taXNlQ2FjaGUyKTsKICAgICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyLmRlZmF1bHQpKHRoaXMsICJjYWNoZSIsIHZvaWQgMCk7CiAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5Mi5kZWZhdWx0KSh0aGlzLCAiZmlsbENhbGxiYWNrIiwgdm9pZCAwKTsKICAgICAgICAgIGlmICh0eXBlb2YgZmlsbCAhPT0gImZ1bmN0aW9uIikKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigibXVzdCBwYXNzIGEgZmlsbCBmdW5jdGlvbiIpOwogICAgICAgICAgaWYgKCgwLCBfdHlwZW9mMi5kZWZhdWx0KShjYWNoZSkgIT09ICJvYmplY3QiKQogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJtdXN0IHBhc3MgYSBjYWNoZSBvYmplY3QiKTsKICAgICAgICAgIGlmICh0eXBlb2YgY2FjaGUuZ2V0ICE9PSAiZnVuY3Rpb24iIHx8IHR5cGVvZiBjYWNoZS5zZXQgIT09ICJmdW5jdGlvbiIgfHwgdHlwZW9mIGNhY2hlLmRlbGV0ZSAhPT0gImZ1bmN0aW9uIikKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiY2FjaGUgbXVzdCBpbXBsZW1lbnQgZ2V0KGtleSksIHNldChrZXksIHZhbCksIGFuZCBhbmQgZGVsZXRlKGtleSkiKTsKICAgICAgICAgIHRoaXMuY2FjaGUgPSBjYWNoZTsKICAgICAgICAgIHRoaXMuZmlsbENhbGxiYWNrID0gZmlsbDsKICAgICAgICB9CiAgICAgICAgKDAsIF9jcmVhdGVDbGFzczIuZGVmYXVsdCkoQWJvcnRhYmxlUHJvbWlzZUNhY2hlMiwgW3sga2V5OiAiZXZpY3QiLCB2YWx1ZTogZnVuY3Rpb24gZXZpY3Qoa2V5LCBlbnRyeSkgewogICAgICAgICAgaWYgKHRoaXMuY2FjaGUuZ2V0KGtleSkgPT09IGVudHJ5KQogICAgICAgICAgICB0aGlzLmNhY2hlLmRlbGV0ZShrZXkpOwogICAgICAgIH0gfSwgeyBrZXk6ICJmaWxsIiwgdmFsdWU6IGZ1bmN0aW9uIGZpbGwoa2V5LCBkYXRhLCBzaWduYWwsIHN0YXR1c0NhbGxiYWNrKSB7CiAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgICAgdmFyIGFib3J0ZXIgPSBuZXcgX0FnZ3JlZ2F0ZUFib3J0Q29udHJvbGxlci5kZWZhdWx0KCk7CiAgICAgICAgICB2YXIgc3RhdHVzUmVwb3J0ZXIgPSBuZXcgX0FnZ3JlZ2F0ZVN0YXR1c1JlcG9ydGVyLmRlZmF1bHQoKTsKICAgICAgICAgIHN0YXR1c1JlcG9ydGVyLmFkZENhbGxiYWNrKHN0YXR1c0NhbGxiYWNrKTsKICAgICAgICAgIHZhciBuZXdFbnRyeSA9IHsKICAgICAgICAgICAgYWJvcnRlciwKICAgICAgICAgICAgcHJvbWlzZTogdGhpcy5maWxsQ2FsbGJhY2soZGF0YSwgYWJvcnRlci5zaWduYWwsIGZ1bmN0aW9uKG1lc3NhZ2UpIHsKICAgICAgICAgICAgICBzdGF0dXNSZXBvcnRlci5jYWxsYmFjayhtZXNzYWdlKTsKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIHNldHRsZWQ6IGZhbHNlLAogICAgICAgICAgICBzdGF0dXNSZXBvcnRlciwKICAgICAgICAgICAgZ2V0IGFib3J0ZWQoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWJvcnRlci5zaWduYWwuYWJvcnRlZDsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICAgIG5ld0VudHJ5LmFib3J0ZXIuYWRkU2lnbmFsKHNpZ25hbCk7CiAgICAgICAgICBuZXdFbnRyeS5hYm9ydGVyLnNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCJhYm9ydCIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoIW5ld0VudHJ5LnNldHRsZWQpIHsKICAgICAgICAgICAgICBfdGhpcy5ldmljdChrZXksIG5ld0VudHJ5KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBuZXdFbnRyeS5wcm9taXNlLnRoZW4oZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIG5ld0VudHJ5LnNldHRsZWQgPSB0cnVlOwogICAgICAgICAgfSwgZnVuY3Rpb24oZXhjZXB0aW9uKSB7CiAgICAgICAgICAgIG5ld0VudHJ5LnNldHRsZWQgPSB0cnVlOwogICAgICAgICAgICBfdGhpcy5ldmljdChrZXksIG5ld0VudHJ5KTsKICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5jYWNoZS5zZXQoa2V5LCBuZXdFbnRyeSk7CiAgICAgICAgfSB9LCB7CiAgICAgICAgICBrZXk6ICJoYXMiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGhhcyhrZXkpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGUuaGFzKGtleSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiZ2V0IiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXQyKGtleSwgZGF0YSwgc2lnbmFsLCBzdGF0dXNDYWxsYmFjaykgewogICAgICAgICAgICBpZiAoIXNpZ25hbCAmJiBkYXRhIGluc3RhbmNlb2YgX2Fib3J0Y29udHJvbGxlclBvbnlmaWxsLkFib3J0U2lnbmFsKQogICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoInNlY29uZCBnZXQgYXJndW1lbnQgYXBwZWFycyB0byBiZSBhbiBBYm9ydFNpZ25hbCwgcGVyaGFwcyB5b3UgbWVhbnQgdG8gcGFzcyBgbnVsbGAgZm9yIHRoZSBmaWxsIGRhdGE/Iik7CiAgICAgICAgICAgIHZhciBjYWNoZUVudHJ5ID0gdGhpcy5jYWNoZS5nZXQoa2V5KTsKICAgICAgICAgICAgaWYgKGNhY2hlRW50cnkpIHsKICAgICAgICAgICAgICBpZiAoY2FjaGVFbnRyeS5hYm9ydGVkICYmICFjYWNoZUVudHJ5LnNldHRsZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMuZXZpY3Qoa2V5LCBjYWNoZUVudHJ5KTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldChrZXksIGRhdGEsIHNpZ25hbCwgc3RhdHVzQ2FsbGJhY2spOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoY2FjaGVFbnRyeS5zZXR0bGVkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2FjaGVFbnRyeS5wcm9taXNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjYWNoZUVudHJ5LmFib3J0ZXIuYWRkU2lnbmFsKHNpZ25hbCk7CiAgICAgICAgICAgICAgY2FjaGVFbnRyeS5zdGF0dXNSZXBvcnRlci5hZGRDYWxsYmFjayhzdGF0dXNDYWxsYmFjayk7CiAgICAgICAgICAgICAgcmV0dXJuIEFib3J0YWJsZVByb21pc2VDYWNoZTIuY2hlY2tTaW5nbGVQcm9taXNlKGNhY2hlRW50cnkucHJvbWlzZSwgc2lnbmFsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmZpbGwoa2V5LCBkYXRhLCBzaWduYWwsIHN0YXR1c0NhbGxiYWNrKTsKICAgICAgICAgICAgcmV0dXJuIEFib3J0YWJsZVByb21pc2VDYWNoZTIuY2hlY2tTaW5nbGVQcm9taXNlKHRoaXMuY2FjaGUuZ2V0KGtleSkucHJvbWlzZSwgc2lnbmFsKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJkZWxldGUiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9kZWxldGUoa2V5KSB7CiAgICAgICAgICAgIHZhciBjYWNoZWRFbnRyeSA9IHRoaXMuY2FjaGUuZ2V0KGtleSk7CiAgICAgICAgICAgIGlmIChjYWNoZWRFbnRyeSkgewogICAgICAgICAgICAgIGlmICghY2FjaGVkRW50cnkuc2V0dGxlZCkKICAgICAgICAgICAgICAgIGNhY2hlZEVudHJ5LmFib3J0ZXIuYWJvcnQoKTsKICAgICAgICAgICAgICB0aGlzLmNhY2hlLmRlbGV0ZShrZXkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgeyBrZXk6ICJjbGVhciIsIHZhbHVlOiBmdW5jdGlvbiBjbGVhcigpIHsKICAgICAgICAgIHZhciBrZXlJdGVyID0gdGhpcy5jYWNoZS5rZXlzKCk7CiAgICAgICAgICB2YXIgZGVsZXRlQ291bnQgPSAwOwogICAgICAgICAgZm9yICh2YXIgcmVzdWx0ID0ga2V5SXRlci5uZXh0KCk7ICFyZXN1bHQuZG9uZTsgcmVzdWx0ID0ga2V5SXRlci5uZXh0KCkpIHsKICAgICAgICAgICAgdGhpcy5kZWxldGUocmVzdWx0LnZhbHVlKTsKICAgICAgICAgICAgZGVsZXRlQ291bnQgKz0gMTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBkZWxldGVDb3VudDsKICAgICAgICB9IH1dLCBbeyBrZXk6ICJpc0Fib3J0RXhjZXB0aW9uIiwgdmFsdWU6IGZ1bmN0aW9uIGlzQWJvcnRFeGNlcHRpb24oZXhjZXB0aW9uKSB7CiAgICAgICAgICByZXR1cm4gZXhjZXB0aW9uLm5hbWUgPT09ICJBYm9ydEVycm9yIiB8fCBleGNlcHRpb24uY29kZSA9PT0gIkVSUl9BQk9SVEVEIiB8fCBleGNlcHRpb24ubWVzc2FnZSA9PT0gIkFib3J0RXJyb3I6IGFib3J0ZWQiIHx8IGV4Y2VwdGlvbi5tZXNzYWdlID09PSAiRXJyb3I6IGFib3J0ZWQiOwogICAgICAgIH0gfSwgeyBrZXk6ICJjaGVja1NpbmdsZVByb21pc2UiLCB2YWx1ZTogZnVuY3Rpb24gY2hlY2tTaW5nbGVQcm9taXNlKHByb21pc2UsIHNpZ25hbCkgewogICAgICAgICAgZnVuY3Rpb24gY2hlY2tGb3JTaW5nbGVBYm9ydCgpIHsKICAgICAgICAgICAgaWYgKHNpZ25hbCAmJiBzaWduYWwuYWJvcnRlZCkKICAgICAgICAgICAgICB0aHJvdyBPYmplY3QuYXNzaWduKG5ldyBFcnJvcigiYWJvcnRlZCIpLCB7IGNvZGU6ICJFUlJfQUJPUlRFRCIgfSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcHJvbWlzZS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICAgICBjaGVja0ZvclNpbmdsZUFib3J0KCk7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikgewogICAgICAgICAgICBjaGVja0ZvclNpbmdsZUFib3J0KCk7CiAgICAgICAgICAgIHRocm93IGVycm9yOwogICAgICAgICAgfSk7CiAgICAgICAgfSB9XSk7CiAgICAgICAgcmV0dXJuIEFib3J0YWJsZVByb21pc2VDYWNoZTI7CiAgICAgIH0oKTsKICAgICAgZXhwb3J0cy5kZWZhdWx0ID0gQWJvcnRhYmxlUHJvbWlzZUNhY2hlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvYWJvcnRhYmxlLXByb21pc2UtY2FjaGUvZGlzdC9pbmRleC5qcwogIHZhciByZXF1aXJlX2Rpc3QgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvYWJvcnRhYmxlLXByb21pc2UtY2FjaGUvZGlzdC9pbmRleC5qcyIoZXhwb3J0cykgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoKTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICAgICAgZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwOwogICAgICB2YXIgX0Fib3J0YWJsZVByb21pc2VDYWNoZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9BYm9ydGFibGVQcm9taXNlQ2FjaGUoKSk7CiAgICAgIHZhciBfZGVmYXVsdCA9IF9BYm9ydGFibGVQcm9taXNlQ2FjaGUuZGVmYXVsdDsKICAgICAgZXhwb3J0cy5kZWZhdWx0ID0gX2RlZmF1bHQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AZ21vZC9iYW0vbm9kZV9tb2R1bGVzL3F1aWNrLWxydS9pbmRleC5qcwogIHZhciByZXF1aXJlX3F1aWNrX2xydSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AZ21vZC9iYW0vbm9kZV9tb2R1bGVzL3F1aWNrLWxydS9pbmRleC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgUXVpY2tMUlUgPSBjbGFzcyB7CiAgICAgICAgY29uc3RydWN0b3Iob3B0aW9ucyA9IHt9KSB7CiAgICAgICAgICBpZiAoIShvcHRpb25zLm1heFNpemUgJiYgb3B0aW9ucy5tYXhTaXplID4gMCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiYG1heFNpemVgIG11c3QgYmUgYSBudW1iZXIgZ3JlYXRlciB0aGFuIDAiKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMubWF4U2l6ZSA9IG9wdGlvbnMubWF4U2l6ZTsKICAgICAgICAgIHRoaXMuY2FjaGUgPSBuZXcgTWFwKCk7CiAgICAgICAgICB0aGlzLm9sZENhY2hlID0gbmV3IE1hcCgpOwogICAgICAgICAgdGhpcy5fc2l6ZSA9IDA7CiAgICAgICAgfQogICAgICAgIF9zZXQoa2V5LCB2YWx1ZSkgewogICAgICAgICAgdGhpcy5jYWNoZS5zZXQoa2V5LCB2YWx1ZSk7CiAgICAgICAgICB0aGlzLl9zaXplKys7CiAgICAgICAgICBpZiAodGhpcy5fc2l6ZSA+PSB0aGlzLm1heFNpemUpIHsKICAgICAgICAgICAgdGhpcy5fc2l6ZSA9IDA7CiAgICAgICAgICAgIHRoaXMub2xkQ2FjaGUgPSB0aGlzLmNhY2hlOwogICAgICAgICAgICB0aGlzLmNhY2hlID0gbmV3IE1hcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBnZXQoa2V5KSB7CiAgICAgICAgICBpZiAodGhpcy5jYWNoZS5oYXMoa2V5KSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jYWNoZS5nZXQoa2V5KTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLm9sZENhY2hlLmhhcyhrZXkpKSB7CiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5vbGRDYWNoZS5nZXQoa2V5KTsKICAgICAgICAgICAgdGhpcy5fc2V0KGtleSwgdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHNldChrZXksIHZhbHVlKSB7CiAgICAgICAgICBpZiAodGhpcy5jYWNoZS5oYXMoa2V5KSkgewogICAgICAgICAgICB0aGlzLmNhY2hlLnNldChrZXksIHZhbHVlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuX3NldChrZXksIHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICBoYXMoa2V5KSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5jYWNoZS5oYXMoa2V5KSB8fCB0aGlzLm9sZENhY2hlLmhhcyhrZXkpOwogICAgICAgIH0KICAgICAgICBwZWVrKGtleSkgewogICAgICAgICAgaWYgKHRoaXMuY2FjaGUuaGFzKGtleSkpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGUuZ2V0KGtleSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5vbGRDYWNoZS5oYXMoa2V5KSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5vbGRDYWNoZS5nZXQoa2V5KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZGVsZXRlKGtleSkgewogICAgICAgICAgY29uc3QgZGVsZXRlZCA9IHRoaXMuY2FjaGUuZGVsZXRlKGtleSk7CiAgICAgICAgICBpZiAoZGVsZXRlZCkgewogICAgICAgICAgICB0aGlzLl9zaXplLS07CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdGhpcy5vbGRDYWNoZS5kZWxldGUoa2V5KSB8fCBkZWxldGVkOwogICAgICAgIH0KICAgICAgICBjbGVhcigpIHsKICAgICAgICAgIHRoaXMuY2FjaGUuY2xlYXIoKTsKICAgICAgICAgIHRoaXMub2xkQ2FjaGUuY2xlYXIoKTsKICAgICAgICAgIHRoaXMuX3NpemUgPSAwOwogICAgICAgIH0KICAgICAgICAqa2V5cygpIHsKICAgICAgICAgIGZvciAoY29uc3QgW2tleV0gb2YgdGhpcykgewogICAgICAgICAgICB5aWVsZCBrZXk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICp2YWx1ZXMoKSB7CiAgICAgICAgICBmb3IgKGNvbnN0IFssIHZhbHVlXSBvZiB0aGlzKSB7CiAgICAgICAgICAgIHlpZWxkIHZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAqW1N5bWJvbC5pdGVyYXRvcl0oKSB7CiAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy5jYWNoZSkgewogICAgICAgICAgICB5aWVsZCBpdGVtOwogICAgICAgICAgfQogICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIHRoaXMub2xkQ2FjaGUpIHsKICAgICAgICAgICAgY29uc3QgW2tleV0gPSBpdGVtOwogICAgICAgICAgICBpZiAoIXRoaXMuY2FjaGUuaGFzKGtleSkpIHsKICAgICAgICAgICAgICB5aWVsZCBpdGVtOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGdldCBzaXplKCkgewogICAgICAgICAgbGV0IG9sZENhY2hlU2l6ZSA9IDA7CiAgICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiB0aGlzLm9sZENhY2hlLmtleXMoKSkgewogICAgICAgICAgICBpZiAoIXRoaXMuY2FjaGUuaGFzKGtleSkpIHsKICAgICAgICAgICAgICBvbGRDYWNoZVNpemUrKzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRoaXMuX3NpemUgKyBvbGRDYWNoZVNpemU7CiAgICAgICAgfQogICAgICB9OwogICAgICBtb2R1bGUuZXhwb3J0cyA9IFF1aWNrTFJVOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGdtb2QvYmFtL2Rpc3QvaW5kZXhGaWxlLmpzCiAgdmFyIHJlcXVpcmVfaW5kZXhGaWxlID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BnbW9kL2JhbS9kaXN0L2luZGV4RmlsZS5qcyIoZXhwb3J0cykgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlX2ludGVyb3BSZXF1aXJlRGVmYXVsdCgpOwogICAgICB2YXIgX09iamVjdCRkZWZpbmVQcm9wZXJ0eTIgPSByZXF1aXJlX2RlZmluZV9wcm9wZXJ0eTMoKTsKICAgICAgX09iamVjdCRkZWZpbmVQcm9wZXJ0eTIoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgICAgdmFsdWU6IHRydWUKICAgICAgfSk7CiAgICAgIGV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDsKICAgICAgdmFyIF9kZWZpbmVQcm9wZXJ0eTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfZGVmaW5lX3Byb3BlcnR5MygpKTsKICAgICAgdmFyIF9kZWZpbmVQcm9wZXJ0aWVzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2RlZmluZV9wcm9wZXJ0aWVzMygpKTsKICAgICAgdmFyIF9nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2dldF9vd25fcHJvcGVydHlfZGVzY3JpcHRvcnMzKCkpOwogICAgICB2YXIgX2ZvckVhY2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfZm9yX2VhY2g0KCkpOwogICAgICB2YXIgX2dldE93blByb3BlcnR5RGVzY3JpcHRvciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9nZXRfb3duX3Byb3BlcnR5X2Rlc2NyaXB0b3IzKCkpOwogICAgICB2YXIgX2ZpbHRlciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9maWx0ZXI0KCkpOwogICAgICB2YXIgX2dldE93blByb3BlcnR5U3ltYm9scyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9nZXRfb3duX3Byb3BlcnR5X3N5bWJvbHMzKCkpOwogICAgICB2YXIgX2tleXMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfa2V5czMoKSk7CiAgICAgIHZhciBfcmVnZW5lcmF0b3IgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfcmVnZW5lcmF0b3IoKSk7CiAgICAgIHZhciBfYXN5bmNUb0dlbmVyYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfYXN5bmNUb0dlbmVyYXRvcigpKTsKICAgICAgdmFyIF9jbGFzc0NhbGxDaGVjazIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfY2xhc3NDYWxsQ2hlY2soKSk7CiAgICAgIHZhciBfY3JlYXRlQ2xhc3MyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2NyZWF0ZUNsYXNzKCkpOwogICAgICB2YXIgX2RlZmluZVByb3BlcnR5MyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9kZWZpbmVQcm9wZXJ0eSgpKTsKICAgICAgdmFyIF9hYm9ydGFibGVQcm9taXNlQ2FjaGUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfZGlzdCgpKTsKICAgICAgdmFyIF9xdWlja0xydSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9xdWlja19scnUoKSk7CiAgICAgIGZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgewogICAgICAgIHZhciBrZXlzID0gKDAsIF9rZXlzLmRlZmF1bHQpKG9iamVjdCk7CiAgICAgICAgaWYgKF9nZXRPd25Qcm9wZXJ0eVN5bWJvbHMuZGVmYXVsdCkgewogICAgICAgICAgdmFyIHN5bWJvbHMgPSAoMCwgX2dldE93blByb3BlcnR5U3ltYm9scy5kZWZhdWx0KShvYmplY3QpOwogICAgICAgICAgaWYgKGVudW1lcmFibGVPbmx5KQogICAgICAgICAgICBzeW1ib2xzID0gKDAsIF9maWx0ZXIuZGVmYXVsdCkoc3ltYm9scykuY2FsbChzeW1ib2xzLCBmdW5jdGlvbihzeW0pIHsKICAgICAgICAgICAgICByZXR1cm4gKDAsIF9nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IuZGVmYXVsdCkob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICAgICAgICAgIH0pOwogICAgICAgICAga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4ga2V5czsKICAgICAgfQogICAgICBmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKICAgICAgICAgIGlmIChpICUgMikgewogICAgICAgICAgICB2YXIgX2NvbnRleHQzOwogICAgICAgICAgICAoMCwgX2ZvckVhY2guZGVmYXVsdCkoX2NvbnRleHQzID0gb3duS2V5cyhPYmplY3Qoc291cmNlKSwgdHJ1ZSkpLmNhbGwoX2NvbnRleHQzLCBmdW5jdGlvbihrZXkpIHsKICAgICAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5My5kZWZhdWx0KSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoX2dldE93blByb3BlcnR5RGVzY3JpcHRvcnMuZGVmYXVsdCkgewogICAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnRpZXMuZGVmYXVsdCkodGFyZ2V0LCAoMCwgX2dldE93blByb3BlcnR5RGVzY3JpcHRvcnMuZGVmYXVsdCkoc291cmNlKSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgX2NvbnRleHQ0OwogICAgICAgICAgICAoMCwgX2ZvckVhY2guZGVmYXVsdCkoX2NvbnRleHQ0ID0gb3duS2V5cyhPYmplY3Qoc291cmNlKSkpLmNhbGwoX2NvbnRleHQ0LCBmdW5jdGlvbihrZXkpIHsKICAgICAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5Mi5kZWZhdWx0KSh0YXJnZXQsIGtleSwgKDAsIF9nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IuZGVmYXVsdCkoc291cmNlLCBrZXkpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0YXJnZXQ7CiAgICAgIH0KICAgICAgdmFyIEluZGV4RmlsZSA9IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbigpIHsKICAgICAgICBmdW5jdGlvbiBJbmRleEZpbGUyKF9yZWYpIHsKICAgICAgICAgIHZhciBmaWxlaGFuZGxlID0gX3JlZi5maWxlaGFuZGxlLCBfcmVmJHJlbmFtZVJlZlNlcSA9IF9yZWYucmVuYW1lUmVmU2VxLCByZW5hbWVSZWZTZXEgPSBfcmVmJHJlbmFtZVJlZlNlcSA9PT0gdm9pZCAwID8gZnVuY3Rpb24obikgewogICAgICAgICAgICByZXR1cm4gbjsKICAgICAgICAgIH0gOiBfcmVmJHJlbmFtZVJlZlNlcTsKICAgICAgICAgICgwLCBfY2xhc3NDYWxsQ2hlY2syLmRlZmF1bHQpKHRoaXMsIEluZGV4RmlsZTIpOwogICAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTMuZGVmYXVsdCkodGhpcywgImZpbGVoYW5kbGUiLCB2b2lkIDApOwogICAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTMuZGVmYXVsdCkodGhpcywgInJlbmFtZVJlZlNlcSIsIHZvaWQgMCk7CiAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5My5kZWZhdWx0KSh0aGlzLCAiX3BhcnNlQ2FjaGUiLCB2b2lkIDApOwogICAgICAgICAgdGhpcy5maWxlaGFuZGxlID0gZmlsZWhhbmRsZTsKICAgICAgICAgIHRoaXMucmVuYW1lUmVmU2VxID0gcmVuYW1lUmVmU2VxOwogICAgICAgIH0KICAgICAgICAoMCwgX2NyZWF0ZUNsYXNzMi5kZWZhdWx0KShJbmRleEZpbGUyLCBbewogICAgICAgICAga2V5OiAiX2ZpbmRGaXJzdERhdGEiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9maW5kRmlyc3REYXRhKGRhdGEsIHZpcnR1YWxPZmZzZXQpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnRGZGwgPSBkYXRhLmZpcnN0RGF0YUxpbmU7CiAgICAgICAgICAgIGlmIChjdXJyZW50RmRsKSB7CiAgICAgICAgICAgICAgZGF0YS5maXJzdERhdGFMaW5lID0gY3VycmVudEZkbC5jb21wYXJlVG8odmlydHVhbE9mZnNldCkgPiAwID8gdmlydHVhbE9mZnNldCA6IGN1cnJlbnRGZGw7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZGF0YS5maXJzdERhdGFMaW5lID0gdmlydHVhbE9mZnNldDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInBhcnNlIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIF9wYXJzZTIgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICAgICAgICB2YXIgb3B0cywgX2FyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvci5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBvcHRzID0gX2FyZ3MubGVuZ3RoID4gMCAmJiBfYXJnc1swXSAhPT0gdm9pZCAwID8gX2FyZ3NbMF0gOiB7fTsKICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5fcGFyc2VDYWNoZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wYXJzZUNhY2hlID0gbmV3IF9hYm9ydGFibGVQcm9taXNlQ2FjaGUuZGVmYXVsdCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGU6IG5ldyBfcXVpY2tMcnUuZGVmYXVsdCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhTaXplOiAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbDogZnVuY3Rpb24gZmlsbChvcHRzMiwgc2lnbmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuX3BhcnNlKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgb3B0czIpLCB7fSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWduYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgdGhpcy5fcGFyc2VDYWNoZS5nZXQoImluZGV4Iiwgb3B0cywgb3B0cy5zaWduYWwpKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCBfY2FsbGVlLCB0aGlzKTsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICBmdW5jdGlvbiBwYXJzZSgpIHsKICAgICAgICAgICAgICByZXR1cm4gX3BhcnNlMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBwYXJzZTsKICAgICAgICAgIH0oKQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImhhc1JlZlNlcSIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBfaGFzUmVmU2VxID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlMihzZXFJZCkgewogICAgICAgICAgICAgIHZhciBvcHRzLCBfYXJnczIgPSBhcmd1bWVudHM7CiAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvci5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgb3B0cyA9IF9hcmdzMi5sZW5ndGggPiAxICYmIF9hcmdzMlsxXSAhPT0gdm9pZCAwID8gX2FyZ3MyWzFdIDoge307CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZShvcHRzKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIudDEgPSBzZXFJZDsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi50MCA9IF9jb250ZXh0Mi5zZW50LmluZGljZXNbX2NvbnRleHQyLnQxXTsKICAgICAgICAgICAgICAgICAgICAgIGlmIChfY29udGV4dDIudDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA3OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi50MCA9IHt9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCAhIV9jb250ZXh0Mi50MC5iaW5JbmRleCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICBmdW5jdGlvbiBoYXNSZWZTZXEoX3gpIHsKICAgICAgICAgICAgICByZXR1cm4gX2hhc1JlZlNlcS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBoYXNSZWZTZXE7CiAgICAgICAgICB9KCkKICAgICAgICB9XSk7CiAgICAgICAgcmV0dXJuIEluZGV4RmlsZTI7CiAgICAgIH0oKTsKICAgICAgZXhwb3J0cy5kZWZhdWx0ID0gSW5kZXhGaWxlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9hcnJheS1zb3J0LmpzCiAgdmFyIHJlcXVpcmVfYXJyYXlfc29ydCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2FycmF5LXNvcnQuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBmbG9vciA9IE1hdGguZmxvb3I7CiAgICAgIHZhciBtZXJnZVNvcnQgPSBmdW5jdGlvbihhcnJheSwgY29tcGFyZWZuKSB7CiAgICAgICAgdmFyIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsKICAgICAgICB2YXIgbWlkZGxlID0gZmxvb3IobGVuZ3RoIC8gMik7CiAgICAgICAgcmV0dXJuIGxlbmd0aCA8IDggPyBpbnNlcnRpb25Tb3J0KGFycmF5LCBjb21wYXJlZm4pIDogbWVyZ2UobWVyZ2VTb3J0KGFycmF5LnNsaWNlKDAsIG1pZGRsZSksIGNvbXBhcmVmbiksIG1lcmdlU29ydChhcnJheS5zbGljZShtaWRkbGUpLCBjb21wYXJlZm4pLCBjb21wYXJlZm4pOwogICAgICB9OwogICAgICB2YXIgaW5zZXJ0aW9uU29ydCA9IGZ1bmN0aW9uKGFycmF5LCBjb21wYXJlZm4pIHsKICAgICAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgICAgIHZhciBpID0gMTsKICAgICAgICB2YXIgZWxlbWVudCwgajsKICAgICAgICB3aGlsZSAoaSA8IGxlbmd0aCkgewogICAgICAgICAgaiA9IGk7CiAgICAgICAgICBlbGVtZW50ID0gYXJyYXlbaV07CiAgICAgICAgICB3aGlsZSAoaiAmJiBjb21wYXJlZm4oYXJyYXlbaiAtIDFdLCBlbGVtZW50KSA+IDApIHsKICAgICAgICAgICAgYXJyYXlbal0gPSBhcnJheVstLWpdOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGogIT09IGkrKykKICAgICAgICAgICAgYXJyYXlbal0gPSBlbGVtZW50OwogICAgICAgIH0KICAgICAgICByZXR1cm4gYXJyYXk7CiAgICAgIH07CiAgICAgIHZhciBtZXJnZSA9IGZ1bmN0aW9uKGxlZnQsIHJpZ2h0LCBjb21wYXJlZm4pIHsKICAgICAgICB2YXIgbGxlbmd0aCA9IGxlZnQubGVuZ3RoOwogICAgICAgIHZhciBybGVuZ3RoID0gcmlnaHQubGVuZ3RoOwogICAgICAgIHZhciBsaW5kZXggPSAwOwogICAgICAgIHZhciByaW5kZXggPSAwOwogICAgICAgIHZhciByZXN1bHQgPSBbXTsKICAgICAgICB3aGlsZSAobGluZGV4IDwgbGxlbmd0aCB8fCByaW5kZXggPCBybGVuZ3RoKSB7CiAgICAgICAgICBpZiAobGluZGV4IDwgbGxlbmd0aCAmJiByaW5kZXggPCBybGVuZ3RoKSB7CiAgICAgICAgICAgIHJlc3VsdC5wdXNoKGNvbXBhcmVmbihsZWZ0W2xpbmRleF0sIHJpZ2h0W3JpbmRleF0pIDw9IDAgPyBsZWZ0W2xpbmRleCsrXSA6IHJpZ2h0W3JpbmRleCsrXSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHQucHVzaChsaW5kZXggPCBsbGVuZ3RoID8gbGVmdFtsaW5kZXgrK10gOiByaWdodFtyaW5kZXgrK10pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwogICAgICBtb2R1bGUuZXhwb3J0cyA9IG1lcmdlU29ydDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZW5naW5lLWZmLXZlcnNpb24uanMKICB2YXIgcmVxdWlyZV9lbmdpbmVfZmZfdmVyc2lvbiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2VuZ2luZS1mZi12ZXJzaW9uLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgdXNlckFnZW50ID0gcmVxdWlyZV9lbmdpbmVfdXNlcl9hZ2VudCgpOwogICAgICB2YXIgZmlyZWZveCA9IHVzZXJBZ2VudC5tYXRjaCgvZmlyZWZveFwvKFxkKykvaSk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gISFmaXJlZm94ICYmICtmaXJlZm94WzFdOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9lbmdpbmUtaXMtaWUtb3ItZWRnZS5qcwogIHZhciByZXF1aXJlX2VuZ2luZV9pc19pZV9vcl9lZGdlID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZW5naW5lLWlzLWllLW9yLWVkZ2UuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBVQSA9IHJlcXVpcmVfZW5naW5lX3VzZXJfYWdlbnQoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSAvTVNJRXxUcmlkZW50Ly50ZXN0KFVBKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZW5naW5lLXdlYmtpdC12ZXJzaW9uLmpzCiAgdmFyIHJlcXVpcmVfZW5naW5lX3dlYmtpdF92ZXJzaW9uID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvZW5naW5lLXdlYmtpdC12ZXJzaW9uLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgdXNlckFnZW50ID0gcmVxdWlyZV9lbmdpbmVfdXNlcl9hZ2VudCgpOwogICAgICB2YXIgd2Via2l0ID0gdXNlckFnZW50Lm1hdGNoKC9BcHBsZVdlYktpdFwvKFxkKylcLi8pOwogICAgICBtb2R1bGUuZXhwb3J0cyA9ICEhd2Via2l0ICYmICt3ZWJraXRbMV07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5hcnJheS5zb3J0LmpzCiAgdmFyIHJlcXVpcmVfZXNfYXJyYXlfc29ydCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5hcnJheS5zb3J0LmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciAkID0gcmVxdWlyZV9leHBvcnQoKTsKICAgICAgdmFyIGFDYWxsYWJsZSA9IHJlcXVpcmVfYV9jYWxsYWJsZSgpOwogICAgICB2YXIgdG9PYmplY3QgPSByZXF1aXJlX3RvX29iamVjdCgpOwogICAgICB2YXIgdG9MZW5ndGggPSByZXF1aXJlX3RvX2xlbmd0aCgpOwogICAgICB2YXIgdG9TdHJpbmcgPSByZXF1aXJlX3RvX3N0cmluZygpOwogICAgICB2YXIgZmFpbHMgPSByZXF1aXJlX2ZhaWxzKCk7CiAgICAgIHZhciBpbnRlcm5hbFNvcnQgPSByZXF1aXJlX2FycmF5X3NvcnQoKTsKICAgICAgdmFyIGFycmF5TWV0aG9kSXNTdHJpY3QgPSByZXF1aXJlX2FycmF5X21ldGhvZF9pc19zdHJpY3QoKTsKICAgICAgdmFyIEZGID0gcmVxdWlyZV9lbmdpbmVfZmZfdmVyc2lvbigpOwogICAgICB2YXIgSUVfT1JfRURHRSA9IHJlcXVpcmVfZW5naW5lX2lzX2llX29yX2VkZ2UoKTsKICAgICAgdmFyIFY4ID0gcmVxdWlyZV9lbmdpbmVfdjhfdmVyc2lvbigpOwogICAgICB2YXIgV0VCS0lUID0gcmVxdWlyZV9lbmdpbmVfd2Via2l0X3ZlcnNpb24oKTsKICAgICAgdmFyIHRlc3QgPSBbXTsKICAgICAgdmFyIG5hdGl2ZVNvcnQgPSB0ZXN0LnNvcnQ7CiAgICAgIHZhciBGQUlMU19PTl9VTkRFRklORUQgPSBmYWlscyhmdW5jdGlvbigpIHsKICAgICAgICB0ZXN0LnNvcnQodm9pZCAwKTsKICAgICAgfSk7CiAgICAgIHZhciBGQUlMU19PTl9OVUxMID0gZmFpbHMoZnVuY3Rpb24oKSB7CiAgICAgICAgdGVzdC5zb3J0KG51bGwpOwogICAgICB9KTsKICAgICAgdmFyIFNUUklDVF9NRVRIT0QgPSBhcnJheU1ldGhvZElzU3RyaWN0KCJzb3J0Iik7CiAgICAgIHZhciBTVEFCTEVfU09SVCA9ICFmYWlscyhmdW5jdGlvbigpIHsKICAgICAgICBpZiAoVjgpCiAgICAgICAgICByZXR1cm4gVjggPCA3MDsKICAgICAgICBpZiAoRkYgJiYgRkYgPiAzKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChJRV9PUl9FREdFKQogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKFdFQktJVCkKICAgICAgICAgIHJldHVybiBXRUJLSVQgPCA2MDM7CiAgICAgICAgdmFyIHJlc3VsdCA9ICIiOwogICAgICAgIHZhciBjb2RlLCBjaHIsIHZhbHVlLCBpbmRleDsKICAgICAgICBmb3IgKGNvZGUgPSA2NTsgY29kZSA8IDc2OyBjb2RlKyspIHsKICAgICAgICAgIGNociA9IFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSk7CiAgICAgICAgICBzd2l0Y2ggKGNvZGUpIHsKICAgICAgICAgICAgY2FzZSA2NjoKICAgICAgICAgICAgY2FzZSA2OToKICAgICAgICAgICAgY2FzZSA3MDoKICAgICAgICAgICAgY2FzZSA3MjoKICAgICAgICAgICAgICB2YWx1ZSA9IDM7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNjg6CiAgICAgICAgICAgIGNhc2UgNzE6CiAgICAgICAgICAgICAgdmFsdWUgPSA0OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHZhbHVlID0gMjsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAoaW5kZXggPSAwOyBpbmRleCA8IDQ3OyBpbmRleCsrKSB7CiAgICAgICAgICAgIHRlc3QucHVzaCh7IGs6IGNociArIGluZGV4LCB2OiB2YWx1ZSB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGVzdC5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBiLnYgLSBhLnY7CiAgICAgICAgfSk7CiAgICAgICAgZm9yIChpbmRleCA9IDA7IGluZGV4IDwgdGVzdC5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgIGNociA9IHRlc3RbaW5kZXhdLmsuY2hhckF0KDApOwogICAgICAgICAgaWYgKHJlc3VsdC5jaGFyQXQocmVzdWx0Lmxlbmd0aCAtIDEpICE9PSBjaHIpCiAgICAgICAgICAgIHJlc3VsdCArPSBjaHI7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQgIT09ICJER0JFRkhBQ0lKSyI7CiAgICAgIH0pOwogICAgICB2YXIgRk9SQ0VEID0gRkFJTFNfT05fVU5ERUZJTkVEIHx8ICFGQUlMU19PTl9OVUxMIHx8ICFTVFJJQ1RfTUVUSE9EIHx8ICFTVEFCTEVfU09SVDsKICAgICAgdmFyIGdldFNvcnRDb21wYXJlID0gZnVuY3Rpb24oY29tcGFyZWZuKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHgsIHkpIHsKICAgICAgICAgIGlmICh5ID09PSB2b2lkIDApCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgIGlmICh4ID09PSB2b2lkIDApCiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgaWYgKGNvbXBhcmVmbiAhPT0gdm9pZCAwKQogICAgICAgICAgICByZXR1cm4gK2NvbXBhcmVmbih4LCB5KSB8fCAwOwogICAgICAgICAgcmV0dXJuIHRvU3RyaW5nKHgpID4gdG9TdHJpbmcoeSkgPyAxIDogLTE7CiAgICAgICAgfTsKICAgICAgfTsKICAgICAgJCh7IHRhcmdldDogIkFycmF5IiwgcHJvdG86IHRydWUsIGZvcmNlZDogRk9SQ0VEIH0sIHsKICAgICAgICBzb3J0OiBmdW5jdGlvbiBzb3J0KGNvbXBhcmVmbikgewogICAgICAgICAgaWYgKGNvbXBhcmVmbiAhPT0gdm9pZCAwKQogICAgICAgICAgICBhQ2FsbGFibGUoY29tcGFyZWZuKTsKICAgICAgICAgIHZhciBhcnJheSA9IHRvT2JqZWN0KHRoaXMpOwogICAgICAgICAgaWYgKFNUQUJMRV9TT1JUKQogICAgICAgICAgICByZXR1cm4gY29tcGFyZWZuID09PSB2b2lkIDAgPyBuYXRpdmVTb3J0LmNhbGwoYXJyYXkpIDogbmF0aXZlU29ydC5jYWxsKGFycmF5LCBjb21wYXJlZm4pOwogICAgICAgICAgdmFyIGl0ZW1zID0gW107CiAgICAgICAgICB2YXIgYXJyYXlMZW5ndGggPSB0b0xlbmd0aChhcnJheS5sZW5ndGgpOwogICAgICAgICAgdmFyIGl0ZW1zTGVuZ3RoLCBpbmRleDsKICAgICAgICAgIGZvciAoaW5kZXggPSAwOyBpbmRleCA8IGFycmF5TGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgIGlmIChpbmRleCBpbiBhcnJheSkKICAgICAgICAgICAgICBpdGVtcy5wdXNoKGFycmF5W2luZGV4XSk7CiAgICAgICAgICB9CiAgICAgICAgICBpdGVtcyA9IGludGVybmFsU29ydChpdGVtcywgZ2V0U29ydENvbXBhcmUoY29tcGFyZWZuKSk7CiAgICAgICAgICBpdGVtc0xlbmd0aCA9IGl0ZW1zLmxlbmd0aDsKICAgICAgICAgIGluZGV4ID0gMDsKICAgICAgICAgIHdoaWxlIChpbmRleCA8IGl0ZW1zTGVuZ3RoKQogICAgICAgICAgICBhcnJheVtpbmRleF0gPSBpdGVtc1tpbmRleCsrXTsKICAgICAgICAgIHdoaWxlIChpbmRleCA8IGFycmF5TGVuZ3RoKQogICAgICAgICAgICBkZWxldGUgYXJyYXlbaW5kZXgrK107CiAgICAgICAgICByZXR1cm4gYXJyYXk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9hcnJheS92aXJ0dWFsL3NvcnQuanMKICB2YXIgcmVxdWlyZV9zb3J0ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9hcnJheS92aXJ0dWFsL3NvcnQuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHJlcXVpcmVfZXNfYXJyYXlfc29ydCgpOwogICAgICB2YXIgZW50cnlWaXJ0dWFsID0gcmVxdWlyZV9lbnRyeV92aXJ0dWFsKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZW50cnlWaXJ0dWFsKCJBcnJheSIpLnNvcnQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvaW5zdGFuY2Uvc29ydC5qcwogIHZhciByZXF1aXJlX3NvcnQyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9pbnN0YW5jZS9zb3J0LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgc29ydCA9IHJlcXVpcmVfc29ydCgpOwogICAgICB2YXIgQXJyYXlQcm90b3R5cGUgPSBBcnJheS5wcm90b3R5cGU7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpIHsKICAgICAgICB2YXIgb3duID0gaXQuc29ydDsKICAgICAgICByZXR1cm4gaXQgPT09IEFycmF5UHJvdG90eXBlIHx8IGl0IGluc3RhbmNlb2YgQXJyYXkgJiYgb3duID09PSBBcnJheVByb3RvdHlwZS5zb3J0ID8gc29ydCA6IG93bjsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvaW5zdGFuY2Uvc29ydC5qcwogIHZhciByZXF1aXJlX3NvcnQzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvaW5zdGFuY2Uvc29ydC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHBhcmVudCA9IHJlcXVpcmVfc29ydDIoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXJlbnQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMtc3RhYmxlL2luc3RhbmNlL3NvcnQuanMKICB2YXIgcmVxdWlyZV9zb3J0NCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMtc3RhYmxlL2luc3RhbmNlL3NvcnQuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZV9zb3J0MygpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMubnVtYmVyLm1pbi1zYWZlLWludGVnZXIuanMKICB2YXIgcmVxdWlyZV9lc19udW1iZXJfbWluX3NhZmVfaW50ZWdlciA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5udW1iZXIubWluLXNhZmUtaW50ZWdlci5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyICQgPSByZXF1aXJlX2V4cG9ydCgpOwogICAgICAkKHsgdGFyZ2V0OiAiTnVtYmVyIiwgc3RhdDogdHJ1ZSB9LCB7CiAgICAgICAgTUlOX1NBRkVfSU5URUdFUjogLTkwMDcxOTkyNTQ3NDA5OTEKICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvbnVtYmVyL21pbi1zYWZlLWludGVnZXIuanMKICB2YXIgcmVxdWlyZV9taW5fc2FmZV9pbnRlZ2VyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9udW1iZXIvbWluLXNhZmUtaW50ZWdlci5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgcmVxdWlyZV9lc19udW1iZXJfbWluX3NhZmVfaW50ZWdlcigpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IC05MDA3MTk5MjU0NzQwOTkxOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9udW1iZXIvbWluLXNhZmUtaW50ZWdlci5qcwogIHZhciByZXF1aXJlX21pbl9zYWZlX2ludGVnZXIyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvbnVtYmVyL21pbi1zYWZlLWludGVnZXIuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX21pbl9zYWZlX2ludGVnZXIoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXJlbnQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMtc3RhYmxlL251bWJlci9taW4tc2FmZS1pbnRlZ2VyLmpzCiAgdmFyIHJlcXVpcmVfbWluX3NhZmVfaW50ZWdlcjMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzLXN0YWJsZS9udW1iZXIvbWluLXNhZmUtaW50ZWdlci5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlX21pbl9zYWZlX2ludGVnZXIyKCk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5udW1iZXIubWF4LXNhZmUtaW50ZWdlci5qcwogIHZhciByZXF1aXJlX2VzX251bWJlcl9tYXhfc2FmZV9pbnRlZ2VyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLm51bWJlci5tYXgtc2FmZS1pbnRlZ2VyLmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgJCA9IHJlcXVpcmVfZXhwb3J0KCk7CiAgICAgICQoeyB0YXJnZXQ6ICJOdW1iZXIiLCBzdGF0OiB0cnVlIH0sIHsKICAgICAgICBNQVhfU0FGRV9JTlRFR0VSOiA5MDA3MTk5MjU0NzQwOTkxCiAgICAgIH0pOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL251bWJlci9tYXgtc2FmZS1pbnRlZ2VyLmpzCiAgdmFyIHJlcXVpcmVfbWF4X3NhZmVfaW50ZWdlciA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvbnVtYmVyL21heC1zYWZlLWludGVnZXIuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHJlcXVpcmVfZXNfbnVtYmVyX21heF9zYWZlX2ludGVnZXIoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSA5MDA3MTk5MjU0NzQwOTkxOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9udW1iZXIvbWF4LXNhZmUtaW50ZWdlci5qcwogIHZhciByZXF1aXJlX21heF9zYWZlX2ludGVnZXIyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvbnVtYmVyL21heC1zYWZlLWludGVnZXIuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX21heF9zYWZlX2ludGVnZXIoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXJlbnQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMtc3RhYmxlL251bWJlci9tYXgtc2FmZS1pbnRlZ2VyLmpzCiAgdmFyIHJlcXVpcmVfbWF4X3NhZmVfaW50ZWdlcjMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzLXN0YWJsZS9udW1iZXIvbWF4LXNhZmUtaW50ZWdlci5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlX21heF9zYWZlX2ludGVnZXIyKCk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy93ZWIudGltZXJzLmpzCiAgdmFyIHJlcXVpcmVfd2ViX3RpbWVycyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy93ZWIudGltZXJzLmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgJCA9IHJlcXVpcmVfZXhwb3J0KCk7CiAgICAgIHZhciBnbG9iYWwyID0gcmVxdWlyZV9nbG9iYWwoKTsKICAgICAgdmFyIGlzQ2FsbGFibGUgPSByZXF1aXJlX2lzX2NhbGxhYmxlKCk7CiAgICAgIHZhciB1c2VyQWdlbnQgPSByZXF1aXJlX2VuZ2luZV91c2VyX2FnZW50KCk7CiAgICAgIHZhciBzbGljZSA9IFtdLnNsaWNlOwogICAgICB2YXIgTVNJRSA9IC9NU0lFIC5cLi8udGVzdCh1c2VyQWdlbnQpOwogICAgICB2YXIgd3JhcCA9IGZ1bmN0aW9uKHNjaGVkdWxlcikgewogICAgICAgIHJldHVybiBmdW5jdGlvbihoYW5kbGVyLCB0aW1lb3V0KSB7CiAgICAgICAgICB2YXIgYm91bmRBcmdzID0gYXJndW1lbnRzLmxlbmd0aCA+IDI7CiAgICAgICAgICB2YXIgYXJncyA9IGJvdW5kQXJncyA/IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAyKSA6IHZvaWQgMDsKICAgICAgICAgIHJldHVybiBzY2hlZHVsZXIoYm91bmRBcmdzID8gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIChpc0NhbGxhYmxlKGhhbmRsZXIpID8gaGFuZGxlciA6IEZ1bmN0aW9uKGhhbmRsZXIpKS5hcHBseSh0aGlzLCBhcmdzKTsKICAgICAgICAgIH0gOiBoYW5kbGVyLCB0aW1lb3V0KTsKICAgICAgICB9OwogICAgICB9OwogICAgICAkKHsgZ2xvYmFsOiB0cnVlLCBiaW5kOiB0cnVlLCBmb3JjZWQ6IE1TSUUgfSwgewogICAgICAgIHNldFRpbWVvdXQ6IHdyYXAoZ2xvYmFsMi5zZXRUaW1lb3V0KSwKICAgICAgICBzZXRJbnRlcnZhbDogd3JhcChnbG9iYWwyLnNldEludGVydmFsKQogICAgICB9KTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvc2V0LXRpbWVvdXQuanMKICB2YXIgcmVxdWlyZV9zZXRfdGltZW91dCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL3NldC10aW1lb3V0LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICByZXF1aXJlX3dlYl90aW1lcnMoKTsKICAgICAgdmFyIHBhdGggPSByZXF1aXJlX3BhdGgoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXRoLnNldFRpbWVvdXQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMtc3RhYmxlL3NldC10aW1lb3V0LmpzCiAgdmFyIHJlcXVpcmVfc2V0X3RpbWVvdXQyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy1zdGFibGUvc2V0LXRpbWVvdXQuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZV9zZXRfdGltZW91dCgpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzLXN0YWJsZS9wcm9taXNlLmpzCiAgdmFyIHJlcXVpcmVfcHJvbWlzZTUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzLXN0YWJsZS9wcm9taXNlLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmVfcHJvbWlzZTIoKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BnbW9kL2JhbS9kaXN0L3V0aWwuanMKICB2YXIgcmVxdWlyZV91dGlsID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BnbW9kL2JhbS9kaXN0L3V0aWwuanMiKGV4cG9ydHMpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0ID0gcmVxdWlyZV9pbnRlcm9wUmVxdWlyZURlZmF1bHQoKTsKICAgICAgdmFyIF9PYmplY3QkZGVmaW5lUHJvcGVydHkgPSByZXF1aXJlX2RlZmluZV9wcm9wZXJ0eTMoKTsKICAgICAgX09iamVjdCRkZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgICB2YWx1ZTogdHJ1ZQogICAgICB9KTsKICAgICAgZXhwb3J0cy50aW1lb3V0ID0gdGltZW91dDsKICAgICAgZXhwb3J0cy5sb25nVG9OdW1iZXIgPSBsb25nVG9OdW1iZXI7CiAgICAgIGV4cG9ydHMuY2hlY2tBYm9ydFNpZ25hbCA9IGNoZWNrQWJvcnRTaWduYWw7CiAgICAgIGV4cG9ydHMuYWJvcnRCcmVha1BvaW50ID0gYWJvcnRCcmVha1BvaW50OwogICAgICBleHBvcnRzLmNhbk1lcmdlQmxvY2tzID0gY2FuTWVyZ2VCbG9ja3M7CiAgICAgIGV4cG9ydHMubWFrZU9wdHMgPSBtYWtlT3B0czsKICAgICAgZXhwb3J0cy5vcHRpbWl6ZUNodW5rcyA9IG9wdGltaXplQ2h1bmtzOwogICAgICB2YXIgX3JlZ2VuZXJhdG9yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX3JlZ2VuZXJhdG9yKCkpOwogICAgICB2YXIgX2ZvckVhY2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfZm9yX2VhY2g0KCkpOwogICAgICB2YXIgX3NvcnQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfc29ydDQoKSk7CiAgICAgIHZhciBfYXN5bmNUb0dlbmVyYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfYXN5bmNUb0dlbmVyYXRvcigpKTsKICAgICAgdmFyIF9taW5TYWZlSW50ZWdlciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9taW5fc2FmZV9pbnRlZ2VyMygpKTsKICAgICAgdmFyIF9tYXhTYWZlSW50ZWdlciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9tYXhfc2FmZV9pbnRlZ2VyMygpKTsKICAgICAgdmFyIF9zZXRUaW1lb3V0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9zZXRfdGltZW91dDIoKSk7CiAgICAgIHZhciBfcHJvbWlzZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9wcm9taXNlNSgpKTsKICAgICAgZnVuY3Rpb24gdGltZW91dChtcykgewogICAgICAgIHJldHVybiBuZXcgX3Byb21pc2UuZGVmYXVsdChmdW5jdGlvbihyZXNvbHZlKSB7CiAgICAgICAgICByZXR1cm4gKDAsIF9zZXRUaW1lb3V0Mi5kZWZhdWx0KShyZXNvbHZlLCBtcyk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbG9uZ1RvTnVtYmVyKGxvbmcpIHsKICAgICAgICBpZiAobG9uZy5ncmVhdGVyVGhhbihfbWF4U2FmZUludGVnZXIuZGVmYXVsdCkgfHwgbG9uZy5sZXNzVGhhbihfbWluU2FmZUludGVnZXIuZGVmYXVsdCkpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaW50ZWdlciBvdmVyZmxvdyIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbG9uZy50b051bWJlcigpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGNoZWNrQWJvcnRTaWduYWwoc2lnbmFsKSB7CiAgICAgICAgaWYgKCFzaWduYWwpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHNpZ25hbC5hYm9ydGVkKSB7CiAgICAgICAgICBpZiAodHlwZW9mIERPTUV4Y2VwdGlvbiAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IERPTUV4Y2VwdGlvbigiYWJvcnRlZCIsICJBYm9ydEVycm9yIik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgZSA9IG5ldyBFcnJvcigiYWJvcnRlZCIpOwogICAgICAgICAgICBlLmNvZGUgPSAiRVJSX0FCT1JURUQiOwogICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBhYm9ydEJyZWFrUG9pbnQoX3gpIHsKICAgICAgICByZXR1cm4gX2Fib3J0QnJlYWtQb2ludC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIF9hYm9ydEJyZWFrUG9pbnQoKSB7CiAgICAgICAgX2Fib3J0QnJlYWtQb2ludCA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvci5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZShzaWduYWwpIHsKICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9wcm9taXNlLmRlZmF1bHQucmVzb2x2ZSgpOwogICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICBjaGVja0Fib3J0U2lnbmFsKHNpZ25hbCk7CiAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgICAgfSkpOwogICAgICAgIHJldHVybiBfYWJvcnRCcmVha1BvaW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gY2FuTWVyZ2VCbG9ja3MoY2h1bmsxLCBjaHVuazIpIHsKICAgICAgICByZXR1cm4gY2h1bmsyLm1pbnYuYmxvY2tQb3NpdGlvbiAtIGNodW5rMS5tYXh2LmJsb2NrUG9zaXRpb24gPCA2NWUzICYmIGNodW5rMi5tYXh2LmJsb2NrUG9zaXRpb24gLSBjaHVuazEubWludi5ibG9ja1Bvc2l0aW9uIDwgNWU2OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIG1ha2VPcHRzKCkgewogICAgICAgIHZhciBvYmogPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgICAgIHJldHVybiAiYWJvcnRlZCIgaW4gb2JqID8gewogICAgICAgICAgc2lnbmFsOiBvYmoKICAgICAgICB9IDogb2JqOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIG9wdGltaXplQ2h1bmtzKGNodW5rcywgbG93ZXN0KSB7CiAgICAgICAgdmFyIG1lcmdlZENodW5rcyA9IFtdOwogICAgICAgIHZhciBsYXN0Q2h1bmsgPSBudWxsOwogICAgICAgIGlmIChjaHVua3MubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gY2h1bmtzOwogICAgICAgIH0KICAgICAgICAoMCwgX3NvcnQuZGVmYXVsdCkoY2h1bmtzKS5jYWxsKGNodW5rcywgZnVuY3Rpb24oYzAsIGMxKSB7CiAgICAgICAgICB2YXIgZGlmID0gYzAubWludi5ibG9ja1Bvc2l0aW9uIC0gYzEubWludi5ibG9ja1Bvc2l0aW9uOwogICAgICAgICAgaWYgKGRpZiAhPT0gMCkgewogICAgICAgICAgICByZXR1cm4gZGlmOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGMwLm1pbnYuZGF0YVBvc2l0aW9uIC0gYzEubWludi5kYXRhUG9zaXRpb247CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgKDAsIF9mb3JFYWNoLmRlZmF1bHQpKGNodW5rcykuY2FsbChjaHVua3MsIGZ1bmN0aW9uKGNodW5rKSB7CiAgICAgICAgICBpZiAoIWxvd2VzdCB8fCBjaHVuay5tYXh2LmNvbXBhcmVUbyhsb3dlc3QpID4gMCkgewogICAgICAgICAgICBpZiAobGFzdENodW5rID09PSBudWxsKSB7CiAgICAgICAgICAgICAgbWVyZ2VkQ2h1bmtzLnB1c2goY2h1bmspOwogICAgICAgICAgICAgIGxhc3RDaHVuayA9IGNodW5rOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlmIChjYW5NZXJnZUJsb2NrcyhsYXN0Q2h1bmssIGNodW5rKSkgewogICAgICAgICAgICAgICAgaWYgKGNodW5rLm1heHYuY29tcGFyZVRvKGxhc3RDaHVuay5tYXh2KSA+IDApIHsKICAgICAgICAgICAgICAgICAgbGFzdENodW5rLm1heHYgPSBjaHVuay5tYXh2OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtZXJnZWRDaHVua3MucHVzaChjaHVuayk7CiAgICAgICAgICAgICAgICBsYXN0Q2h1bmsgPSBjaHVuazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gbWVyZ2VkQ2h1bmtzOwogICAgICB9CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AZ21vZC9iYW0vZGlzdC9iYWkuanMKICB2YXIgcmVxdWlyZV9iYWkgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGdtb2QvYmFtL2Rpc3QvYmFpLmpzIihleHBvcnRzKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IHJlcXVpcmVfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KCk7CiAgICAgIHZhciBfT2JqZWN0JGRlZmluZVByb3BlcnR5MiA9IHJlcXVpcmVfZGVmaW5lX3Byb3BlcnR5MygpOwogICAgICBfT2JqZWN0JGRlZmluZVByb3BlcnR5MihleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgICB2YWx1ZTogdHJ1ZQogICAgICB9KTsKICAgICAgZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwOwogICAgICB2YXIgX2dldEl0ZXJhdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9nZXRfaXRlcmF0b3I1KCkpOwogICAgICB2YXIgX2lzQXJyYXkgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfaXNfYXJyYXk0KCkpOwogICAgICB2YXIgX2dldEl0ZXJhdG9yTWV0aG9kMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9nZXRfaXRlcmF0b3JfbWV0aG9kNSgpKTsKICAgICAgdmFyIF9zeW1ib2wgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfc3ltYm9sMygpKTsKICAgICAgdmFyIF9mcm9tID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2Zyb20zKCkpOwogICAgICB2YXIgX2RlZmluZVByb3BlcnR5MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9kZWZpbmVfcHJvcGVydHkzKCkpOwogICAgICB2YXIgX2RlZmluZVByb3BlcnRpZXMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfZGVmaW5lX3Byb3BlcnRpZXMzKCkpOwogICAgICB2YXIgX2dldE93blByb3BlcnR5RGVzY3JpcHRvcnMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfZ2V0X293bl9wcm9wZXJ0eV9kZXNjcmlwdG9yczMoKSk7CiAgICAgIHZhciBfZm9yRWFjaCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9mb3JfZWFjaDQoKSk7CiAgICAgIHZhciBfZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2dldF9vd25fcHJvcGVydHlfZGVzY3JpcHRvcjMoKSk7CiAgICAgIHZhciBfZmlsdGVyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2ZpbHRlcjQoKSk7CiAgICAgIHZhciBfZ2V0T3duUHJvcGVydHlTeW1ib2xzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2dldF9vd25fcHJvcGVydHlfc3ltYm9sczMoKSk7CiAgICAgIHZhciBfa2V5cyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9rZXlzMygpKTsKICAgICAgdmFyIF9jb25zdHJ1Y3QgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfY29uc3RydWN0MygpKTsKICAgICAgdmFyIF9zbGljZWRUb0FycmF5MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9zbGljZWRUb0FycmF5KCkpOwogICAgICB2YXIgX2RlZmluZVByb3BlcnR5MyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9kZWZpbmVQcm9wZXJ0eSgpKTsKICAgICAgdmFyIF9tYXAgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfbWFwNCgpKTsKICAgICAgdmFyIF9yZWdlbmVyYXRvciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9yZWdlbmVyYXRvcigpKTsKICAgICAgdmFyIF9hc3luY1RvR2VuZXJhdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9hc3luY1RvR2VuZXJhdG9yKCkpOwogICAgICB2YXIgX3NsaWNlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX3NsaWNlNigpKTsKICAgICAgdmFyIF9jbGFzc0NhbGxDaGVjazIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfY2xhc3NDYWxsQ2hlY2soKSk7CiAgICAgIHZhciBfY3JlYXRlQ2xhc3MyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2NyZWF0ZUNsYXNzKCkpOwogICAgICB2YXIgX2luaGVyaXRzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9pbmhlcml0cygpKTsKICAgICAgdmFyIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKCkpOwogICAgICB2YXIgX2dldFByb3RvdHlwZU9mMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9nZXRQcm90b3R5cGVPZigpKTsKICAgICAgdmFyIF9sb25nID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2xvbmcoKSk7CiAgICAgIHZhciBfdmlydHVhbE9mZnNldCA9IHJlcXVpcmVfdmlydHVhbE9mZnNldCgpOwogICAgICB2YXIgX2NodW5rID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2NodW5rKCkpOwogICAgICB2YXIgX2luZGV4RmlsZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9pbmRleEZpbGUoKSk7CiAgICAgIHZhciBfdXRpbCA9IHJlcXVpcmVfdXRpbCgpOwogICAgICBmdW5jdGlvbiBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihvLCBhbGxvd0FycmF5TGlrZSkgewogICAgICAgIHZhciBpdDsKICAgICAgICBpZiAodHlwZW9mIF9zeW1ib2wuZGVmYXVsdCA9PT0gInVuZGVmaW5lZCIgfHwgKDAsIF9nZXRJdGVyYXRvck1ldGhvZDIuZGVmYXVsdCkobykgPT0gbnVsbCkgewogICAgICAgICAgaWYgKCgwLCBfaXNBcnJheS5kZWZhdWx0KShvKSB8fCAoaXQgPSBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobykpIHx8IGFsbG93QXJyYXlMaWtlICYmIG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgewogICAgICAgICAgICBpZiAoaXQpCiAgICAgICAgICAgICAgbyA9IGl0OwogICAgICAgICAgICB2YXIgaSA9IDA7CiAgICAgICAgICAgIHZhciBGID0gZnVuY3Rpb24gRjIoKSB7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiB7IHM6IEYsIG46IGZ1bmN0aW9uIG4oKSB7CiAgICAgICAgICAgICAgaWYgKGkgPj0gby5sZW5ndGgpCiAgICAgICAgICAgICAgICByZXR1cm4geyBkb25lOiB0cnVlIH07CiAgICAgICAgICAgICAgcmV0dXJuIHsgZG9uZTogZmFsc2UsIHZhbHVlOiBvW2krK10gfTsKICAgICAgICAgICAgfSwgZTogZnVuY3Rpb24gZShfZSkgewogICAgICAgICAgICAgIHRocm93IF9lOwogICAgICAgICAgICB9LCBmOiBGIH07CiAgICAgICAgICB9CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gaXRlcmF0ZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7CiAgICAgICAgfQogICAgICAgIHZhciBub3JtYWxDb21wbGV0aW9uID0gdHJ1ZSwgZGlkRXJyID0gZmFsc2UsIGVycjsKICAgICAgICByZXR1cm4geyBzOiBmdW5jdGlvbiBzKCkgewogICAgICAgICAgaXQgPSAoMCwgX2dldEl0ZXJhdG9yMi5kZWZhdWx0KShvKTsKICAgICAgICB9LCBuOiBmdW5jdGlvbiBuKCkgewogICAgICAgICAgdmFyIHN0ZXAgPSBpdC5uZXh0KCk7CiAgICAgICAgICBub3JtYWxDb21wbGV0aW9uID0gc3RlcC5kb25lOwogICAgICAgICAgcmV0dXJuIHN0ZXA7CiAgICAgICAgfSwgZTogZnVuY3Rpb24gZShfZTIpIHsKICAgICAgICAgIGRpZEVyciA9IHRydWU7CiAgICAgICAgICBlcnIgPSBfZTI7CiAgICAgICAgfSwgZjogZnVuY3Rpb24gZigpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghbm9ybWFsQ29tcGxldGlvbiAmJiBpdC5yZXR1cm4gIT0gbnVsbCkKICAgICAgICAgICAgICBpdC5yZXR1cm4oKTsKICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChkaWRFcnIpCiAgICAgICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgICAgfQogICAgICAgIH0gfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7CiAgICAgICAgdmFyIF9jb250ZXh0NzsKICAgICAgICBpZiAoIW8pCiAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikKICAgICAgICAgIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOwogICAgICAgIHZhciBuID0gKDAsIF9zbGljZS5kZWZhdWx0KShfY29udGV4dDcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykpLmNhbGwoX2NvbnRleHQ3LCA4LCAtMSk7CiAgICAgICAgaWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpCiAgICAgICAgICBuID0gby5jb25zdHJ1Y3Rvci5uYW1lOwogICAgICAgIGlmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikKICAgICAgICAgIHJldHVybiAoMCwgX2Zyb20uZGVmYXVsdCkobyk7CiAgICAgICAgaWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKQogICAgICAgICAgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHsKICAgICAgICBpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkKICAgICAgICAgIGxlbiA9IGFyci5sZW5ndGg7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICBhcnIyW2ldID0gYXJyW2ldOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYXJyMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICAgICAgICB2YXIga2V5cyA9ICgwLCBfa2V5cy5kZWZhdWx0KShvYmplY3QpOwogICAgICAgIGlmIChfZ2V0T3duUHJvcGVydHlTeW1ib2xzLmRlZmF1bHQpIHsKICAgICAgICAgIHZhciBzeW1ib2xzID0gKDAsIF9nZXRPd25Qcm9wZXJ0eVN5bWJvbHMuZGVmYXVsdCkob2JqZWN0KTsKICAgICAgICAgIGlmIChlbnVtZXJhYmxlT25seSkKICAgICAgICAgICAgc3ltYm9scyA9ICgwLCBfZmlsdGVyLmRlZmF1bHQpKHN5bWJvbHMpLmNhbGwoc3ltYm9scywgZnVuY3Rpb24oc3ltKSB7CiAgICAgICAgICAgICAgcmV0dXJuICgwLCBfZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLmRlZmF1bHQpKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOwogICAgICAgICAgICB9KTsKICAgICAgICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGtleXM7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsKICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307CiAgICAgICAgICBpZiAoaSAlIDIpIHsKICAgICAgICAgICAgdmFyIF9jb250ZXh0NTsKICAgICAgICAgICAgKDAsIF9mb3JFYWNoLmRlZmF1bHQpKF9jb250ZXh0NSA9IG93bktleXMoT2JqZWN0KHNvdXJjZSksIHRydWUpKS5jYWxsKF9jb250ZXh0NSwgZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTMuZGVmYXVsdCkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKF9nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzLmRlZmF1bHQpIHsKICAgICAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0aWVzLmRlZmF1bHQpKHRhcmdldCwgKDAsIF9nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzLmRlZmF1bHQpKHNvdXJjZSkpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIF9jb250ZXh0NjsKICAgICAgICAgICAgKDAsIF9mb3JFYWNoLmRlZmF1bHQpKF9jb250ZXh0NiA9IG93bktleXMoT2JqZWN0KHNvdXJjZSkpKS5jYWxsKF9jb250ZXh0NiwgZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIuZGVmYXVsdCkodGFyZ2V0LCBrZXksICgwLCBfZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLmRlZmF1bHQpKHNvdXJjZSwga2V5KSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGFyZ2V0OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIF9jcmVhdGVTdXBlcihEZXJpdmVkKSB7CiAgICAgICAgdmFyIGhhc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QgPSBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCk7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9jcmVhdGVTdXBlckludGVybmFsKCkgewogICAgICAgICAgdmFyIFN1cGVyID0gKDAsIF9nZXRQcm90b3R5cGVPZjIuZGVmYXVsdCkoRGVyaXZlZCksIHJlc3VsdDsKICAgICAgICAgIGlmIChoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KSB7CiAgICAgICAgICAgIHZhciBOZXdUYXJnZXQgPSAoMCwgX2dldFByb3RvdHlwZU9mMi5kZWZhdWx0KSh0aGlzKS5jb25zdHJ1Y3RvcjsKICAgICAgICAgICAgcmVzdWx0ID0gKDAsIF9jb25zdHJ1Y3QuZGVmYXVsdCkoU3VwZXIsIGFyZ3VtZW50cywgTmV3VGFyZ2V0KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlc3VsdCA9IFN1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gKDAsIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuMi5kZWZhdWx0KSh0aGlzLCByZXN1bHQpOwogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpIHsKICAgICAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09ICJ1bmRlZmluZWQiIHx8ICFfY29uc3RydWN0LmRlZmF1bHQpCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKF9jb25zdHJ1Y3QuZGVmYXVsdC5zaGFtKQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICh0eXBlb2YgUHJveHkgPT09ICJmdW5jdGlvbiIpCiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB0cnkgewogICAgICAgICAgRGF0ZS5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCgoMCwgX2NvbnN0cnVjdC5kZWZhdWx0KShEYXRlLCBbXSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICB9KSk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIHZhciBCQUlfTUFHSUMgPSAyMTU3ODA1MDsKICAgICAgZnVuY3Rpb24gcm91bmREb3duKG4sIG11bHRpcGxlKSB7CiAgICAgICAgcmV0dXJuIG4gLSBuICUgbXVsdGlwbGU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcm91bmRVcChuLCBtdWx0aXBsZSkgewogICAgICAgIHJldHVybiBuIC0gbiAlIG11bHRpcGxlICsgbXVsdGlwbGU7CiAgICAgIH0KICAgICAgdmFyIEJBSSA9IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbihfSW5kZXhGaWxlKSB7CiAgICAgICAgKDAsIF9pbmhlcml0czIuZGVmYXVsdCkoQkFJMiwgX0luZGV4RmlsZSk7CiAgICAgICAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihCQUkyKTsKICAgICAgICBmdW5jdGlvbiBCQUkyKCkgewogICAgICAgICAgKDAsIF9jbGFzc0NhbGxDaGVjazIuZGVmYXVsdCkodGhpcywgQkFJMik7CiAgICAgICAgICByZXR1cm4gX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfQogICAgICAgICgwLCBfY3JlYXRlQ2xhc3MyLmRlZmF1bHQpKEJBSTIsIFt7CiAgICAgICAgICBrZXk6ICJwYXJzZVBzZXVkb0JpbiIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcGFyc2VQc2V1ZG9CaW4oYnl0ZXMsIG9mZnNldCkgewogICAgICAgICAgICB2YXIgbGluZUNvdW50ID0gKDAsIF91dGlsLmxvbmdUb051bWJlcikoX2xvbmcuZGVmYXVsdC5mcm9tQnl0ZXNMRSgoMCwgX3NsaWNlLmRlZmF1bHQpKEFycmF5LnByb3RvdHlwZSkuY2FsbChieXRlcywgb2Zmc2V0ICsgMTYsIG9mZnNldCArIDI0KSwgdHJ1ZSkpOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIGxpbmVDb3VudAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImxpbmVDb3VudCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBfbGluZUNvdW50ID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlKHJlZklkKSB7CiAgICAgICAgICAgICAgdmFyIG9wdHMsIHByb20sIGluZGV4LCByZXQsIF9hcmdzID0gYXJndW1lbnRzOwogICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgb3B0cyA9IF9hcmdzLmxlbmd0aCA+IDEgJiYgX2FyZ3NbMV0gIT09IHZvaWQgMCA/IF9hcmdzWzFdIDoge307CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlKG9wdHMpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgIHByb20gPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBwcm9tLmluZGljZXNbcmVmSWRdOwogICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIC0xKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgICAgICByZXQgPSBpbmRleC5zdGF0cyB8fCB7fTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIHJldC5saW5lQ291bnQgPT09IHZvaWQgMCA/IC0xIDogcmV0LmxpbmVDb3VudCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgX2NhbGxlZSwgdGhpcyk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgZnVuY3Rpb24gbGluZUNvdW50KF94KSB7CiAgICAgICAgICAgICAgcmV0dXJuIF9saW5lQ291bnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbGluZUNvdW50OwogICAgICAgICAgfSgpCiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiX3BhcnNlIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIF9wYXJzZTIgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgICAgICAgIHZhciBvcHRzLCBkYXRhLCBieXRlcywgZGVwdGgsIGJpbkxpbWl0LCBjdXJyT2Zmc2V0LCBpLCBiaW5Db3VudCwgc3RhdHMsIGJpbkluZGV4LCBqLCBiaW4sIGNodW5rQ291bnQsIGNodW5rcywgaywgdSwgdiwgbGluZWFyQ291bnQsIGxpbmVhckluZGV4LCBfaywgX2FyZ3MyID0gYXJndW1lbnRzOwogICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIG9wdHMgPSBfYXJnczIubGVuZ3RoID4gMCAmJiBfYXJnczJbMF0gIT09IHZvaWQgMCA/IF9hcmdzMlswXSA6IHt9OwogICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgYmFpOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBtYXhCbG9ja1NpemU6IDEgPDwgMTYKICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxlaGFuZGxlLnJlYWRGaWxlKG9wdHMpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICAgIGJ5dGVzID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIShieXRlcy5yZWFkVUludDMyTEUoMCkgIT09IEJBSV9NQUdJQykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA3OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTm90IGEgQkFJIGZpbGUiKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgICAgICBkYXRhLnJlZkNvdW50ID0gYnl0ZXMucmVhZEludDMyTEUoNCk7CiAgICAgICAgICAgICAgICAgICAgICBkZXB0aCA9IDU7CiAgICAgICAgICAgICAgICAgICAgICBiaW5MaW1pdCA9ICgoMSA8PCAoZGVwdGggKyAxKSAqIDMpIC0gMSkgLyA3OwogICAgICAgICAgICAgICAgICAgICAgZGF0YS5pbmRpY2VzID0gbmV3IEFycmF5KGRhdGEucmVmQ291bnQpOwogICAgICAgICAgICAgICAgICAgICAgY3Vyck9mZnNldCA9IDg7CiAgICAgICAgICAgICAgICAgICAgICBpID0gMDsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgICAgICAgaWYgKCEoaSA8IGRhdGEucmVmQ291bnQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNTA7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxNjsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuYWJvcnRCcmVha1BvaW50KShvcHRzLnNpZ25hbCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgICAgICAgIGJpbkNvdW50ID0gYnl0ZXMucmVhZEludDMyTEUoY3Vyck9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgICBzdGF0cyA9IHZvaWQgMDsKICAgICAgICAgICAgICAgICAgICAgIGN1cnJPZmZzZXQgKz0gNDsKICAgICAgICAgICAgICAgICAgICAgIGJpbkluZGV4ID0ge307CiAgICAgICAgICAgICAgICAgICAgICBqID0gMDsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgICAgICAgaWYgKCEoaiA8IGJpbkNvdW50KSkgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQyOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGJpbiA9IGJ5dGVzLnJlYWRVSW50MzJMRShjdXJyT2Zmc2V0KTsKICAgICAgICAgICAgICAgICAgICAgIGN1cnJPZmZzZXQgKz0gNDsKICAgICAgICAgICAgICAgICAgICAgIGlmICghKGJpbiA9PT0gYmluTGltaXQgKyAxKSkgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDMwOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGN1cnJPZmZzZXQgKz0gNDsKICAgICAgICAgICAgICAgICAgICAgIHN0YXRzID0gdGhpcy5wYXJzZVBzZXVkb0JpbihieXRlcywgY3Vyck9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgICBjdXJyT2Zmc2V0ICs9IDMyOwogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzOTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIShiaW4gPiBiaW5MaW1pdCArIDEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJiYWkgaW5kZXggY29udGFpbnMgdG9vIG1hbnkgYmlucywgcGxlYXNlIHVzZSBDU0kiKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM0OgogICAgICAgICAgICAgICAgICAgICAgY2h1bmtDb3VudCA9IGJ5dGVzLnJlYWRJbnQzMkxFKGN1cnJPZmZzZXQpOwogICAgICAgICAgICAgICAgICAgICAgY3Vyck9mZnNldCArPSA0OwogICAgICAgICAgICAgICAgICAgICAgY2h1bmtzID0gbmV3IEFycmF5KGNodW5rQ291bnQpOwogICAgICAgICAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IGNodW5rQ291bnQ7IGsgKz0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICB1ID0gKDAsIF92aXJ0dWFsT2Zmc2V0LmZyb21CeXRlcykoYnl0ZXMsIGN1cnJPZmZzZXQpOwogICAgICAgICAgICAgICAgICAgICAgICB2ID0gKDAsIF92aXJ0dWFsT2Zmc2V0LmZyb21CeXRlcykoYnl0ZXMsIGN1cnJPZmZzZXQgKyA4KTsKICAgICAgICAgICAgICAgICAgICAgICAgY3Vyck9mZnNldCArPSAxNjsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZmluZEZpcnN0RGF0YShkYXRhLCB1KTsKICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtzW2tdID0gbmV3IF9jaHVuay5kZWZhdWx0KHUsIHYsIGJpbik7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBiaW5JbmRleFtiaW5dID0gY2h1bmtzOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzk6CiAgICAgICAgICAgICAgICAgICAgICBqICs9IDE7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDIxOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA0MjoKICAgICAgICAgICAgICAgICAgICAgIGxpbmVhckNvdW50ID0gYnl0ZXMucmVhZEludDMyTEUoY3Vyck9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgICBjdXJyT2Zmc2V0ICs9IDQ7CiAgICAgICAgICAgICAgICAgICAgICBsaW5lYXJJbmRleCA9IG5ldyBBcnJheShsaW5lYXJDb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICBmb3IgKF9rID0gMDsgX2sgPCBsaW5lYXJDb3VudDsgX2sgKz0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICBsaW5lYXJJbmRleFtfa10gPSAoMCwgX3ZpcnR1YWxPZmZzZXQuZnJvbUJ5dGVzKShieXRlcywgY3Vyck9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJPZmZzZXQgKz0gODsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZmluZEZpcnN0RGF0YShkYXRhLCBsaW5lYXJJbmRleFtfa10pOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgZGF0YS5pbmRpY2VzW2ldID0gewogICAgICAgICAgICAgICAgICAgICAgICBiaW5JbmRleCwKICAgICAgICAgICAgICAgICAgICAgICAgbGluZWFySW5kZXgsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRzCiAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDc6CiAgICAgICAgICAgICAgICAgICAgICBpICs9IDE7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDEzOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA1MDoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBkYXRhKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDUxOgogICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICBmdW5jdGlvbiBfcGFyc2UoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF9wYXJzZTIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gX3BhcnNlOwogICAgICAgICAgfSgpCiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiaW5kZXhDb3YiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgX2luZGV4Q292ID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlMyhzZXFJZCwgc3RhcnQsIGVuZCkgewogICAgICAgICAgICAgIHZhciBvcHRzLCB2LCByYW5nZSwgaW5kZXhEYXRhLCBzZXFJZHgsIF9zZXFJZHgkbGluZWFySW5kZXgsIGxpbmVhckluZGV4LCBzdGF0cywgZSwgcywgZGVwdGhzLCB0b3RhbFNpemUsIGN1cnJlbnRQb3MsIGksIGosIF9hcmdzMyA9IGFyZ3VtZW50czsKICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBvcHRzID0gX2FyZ3MzLmxlbmd0aCA+IDMgJiYgX2FyZ3MzWzNdICE9PSB2b2lkIDAgPyBfYXJnczNbM10gOiB7fTsKICAgICAgICAgICAgICAgICAgICAgIHYgPSAxNjM4NDsKICAgICAgICAgICAgICAgICAgICAgIHJhbmdlID0gc3RhcnQgIT09IHZvaWQgMDsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlKG9wdHMpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgICAgIGluZGV4RGF0YSA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICAgICAgICAgICAgc2VxSWR4ID0gaW5kZXhEYXRhLmluZGljZXNbc2VxSWRdOwogICAgICAgICAgICAgICAgICAgICAgaWYgKHNlcUlkeCkgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIFtdKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAgICAgICBfc2VxSWR4JGxpbmVhckluZGV4ID0gc2VxSWR4LmxpbmVhckluZGV4LCBsaW5lYXJJbmRleCA9IF9zZXFJZHgkbGluZWFySW5kZXggPT09IHZvaWQgMCA/IFtdIDogX3NlcUlkeCRsaW5lYXJJbmRleCwgc3RhdHMgPSBzZXFJZHguc3RhdHM7CiAgICAgICAgICAgICAgICAgICAgICBpZiAobGluZWFySW5kZXgubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIFtdKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgICAgICAgZSA9IGVuZCAhPT0gdm9pZCAwID8gcm91bmRVcChlbmQsIHYpIDogKGxpbmVhckluZGV4Lmxlbmd0aCAtIDEpICogdjsKICAgICAgICAgICAgICAgICAgICAgIHMgPSBzdGFydCAhPT0gdm9pZCAwID8gcm91bmREb3duKHN0YXJ0LCB2KSA6IDA7CiAgICAgICAgICAgICAgICAgICAgICBpZiAocmFuZ2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGVwdGhzID0gbmV3IEFycmF5KChlIC0gcykgLyB2KTsKICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlcHRocyA9IG5ldyBBcnJheShsaW5lYXJJbmRleC5sZW5ndGggLSAxKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHRvdGFsU2l6ZSA9IGxpbmVhckluZGV4W2xpbmVhckluZGV4Lmxlbmd0aCAtIDFdLmJsb2NrUG9zaXRpb247CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIShlID4gKGxpbmVhckluZGV4Lmxlbmd0aCAtIDEpICogdikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxODsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInF1ZXJ5IG91dHNpZGUgb2YgcmFuZ2Ugb2YgbGluZWFyIGluZGV4Iik7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQb3MgPSBsaW5lYXJJbmRleFtzIC8gdl0uYmxvY2tQb3NpdGlvbjsKICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IHMgLyB2LCBqID0gMDsgaSA8IGUgLyB2OyBpKyssIGorKykgewogICAgICAgICAgICAgICAgICAgICAgICBkZXB0aHNbal0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcmU6IGxpbmVhckluZGV4W2kgKyAxXS5ibG9ja1Bvc2l0aW9uIC0gY3VycmVudFBvcywKICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogaSAqIHYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kOiBpICogdiArIHYKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFBvcyA9IGxpbmVhckluZGV4W2kgKyAxXS5ibG9ja1Bvc2l0aW9uOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsICgwLCBfbWFwLmRlZmF1bHQpKGRlcHRocykuY2FsbChkZXB0aHMsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgZCksIHt9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcmU6IGQuc2NvcmUgKiBzdGF0cy5saW5lQ291bnQgLyB0b3RhbFNpemUKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCBfY2FsbGVlMywgdGhpcyk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgZnVuY3Rpb24gaW5kZXhDb3YoX3gyLCBfeDMsIF94NCkgewogICAgICAgICAgICAgIHJldHVybiBfaW5kZXhDb3YuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gaW5kZXhDb3Y7CiAgICAgICAgICB9KCkKICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJyZWcyYmlucyIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVnMmJpbnMoYmVnLCBlbmQpIHsKICAgICAgICAgICAgZW5kIC09IDE7CiAgICAgICAgICAgIHJldHVybiBbWzAsIDBdLCBbMSArIChiZWcgPj4gMjYpLCAxICsgKGVuZCA+PiAyNildLCBbOSArIChiZWcgPj4gMjMpLCA5ICsgKGVuZCA+PiAyMyldLCBbNzMgKyAoYmVnID4+IDIwKSwgNzMgKyAoZW5kID4+IDIwKV0sIFs1ODUgKyAoYmVnID4+IDE3KSwgNTg1ICsgKGVuZCA+PiAxNyldLCBbNDY4MSArIChiZWcgPj4gMTQpLCA0NjgxICsgKGVuZCA+PiAxNCldXTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJibG9ja3NGb3JSYW5nZSIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBfYmxvY2tzRm9yUmFuZ2UgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KHJlZklkLCBtaW4sIG1heCkgewogICAgICAgICAgICAgIHZhciBvcHRzLCBpbmRleERhdGEsIGJhLCBvdmVybGFwcGluZ0JpbnMsIGNodW5rcywgX2l0ZXJhdG9yLCBfc3RlcCwgX3N0ZXAkdmFsdWUsIHN0YXJ0LCBlbmQsIGJpbiwgYmluQ2h1bmtzLCBjLCBuaW50diwgbG93ZXN0LCBtaW5MaW4sIG1heExpbiwgaSwgdnAsIF9hcmdzNCA9IGFyZ3VtZW50czsKICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBvcHRzID0gX2FyZ3M0Lmxlbmd0aCA+IDMgJiYgX2FyZ3M0WzNdICE9PSB2b2lkIDAgPyBfYXJnczRbM10gOiB7fTsKICAgICAgICAgICAgICAgICAgICAgIGlmIChtaW4gPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1pbiA9IDA7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZShvcHRzKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgICBpbmRleERhdGEgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleERhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCBbXSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgICAgYmEgPSBpbmRleERhdGEuaW5kaWNlc1tyZWZJZF07CiAgICAgICAgICAgICAgICAgICAgICBpZiAoYmEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgW10pOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgICBvdmVybGFwcGluZ0JpbnMgPSB0aGlzLnJlZzJiaW5zKG1pbiwgbWF4KTsKICAgICAgICAgICAgICAgICAgICAgIGNodW5rcyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIob3ZlcmxhcHBpbmdCaW5zKTsKICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7ICkgewogICAgICAgICAgICAgICAgICAgICAgICAgIF9zdGVwJHZhbHVlID0gKDAsIF9zbGljZWRUb0FycmF5Mi5kZWZhdWx0KShfc3RlcC52YWx1ZSwgMiksIHN0YXJ0ID0gX3N0ZXAkdmFsdWVbMF0sIGVuZCA9IF9zdGVwJHZhbHVlWzFdOwogICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYmluID0gc3RhcnQ7IGJpbiA8PSBlbmQ7IGJpbisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmEuYmluSW5kZXhbYmluXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaW5DaHVua3MgPSBiYS5iaW5JbmRleFtiaW5dOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwgYmluQ2h1bmtzLmxlbmd0aDsgKytjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtzLnB1c2gobmV3IF9jaHVuay5kZWZhdWx0KGJpbkNodW5rc1tjXS5taW52LCBiaW5DaHVua3NbY10ubWF4diwgYmluKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgICAgICBfaXRlcmF0b3IuZShlcnIpOwogICAgICAgICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yLmYoKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIG5pbnR2ID0gYmEubGluZWFySW5kZXgubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgbG93ZXN0ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgIG1pbkxpbiA9IE1hdGgubWluKG1pbiA+PiAxNCwgbmludHYgLSAxKTsKICAgICAgICAgICAgICAgICAgICAgIG1heExpbiA9IE1hdGgubWluKG1heCA+PiAxNCwgbmludHYgLSAxKTsKICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IG1pbkxpbjsgaSA8PSBtYXhMaW47ICsraSkgewogICAgICAgICAgICAgICAgICAgICAgICB2cCA9IGJhLmxpbmVhckluZGV4W2ldOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodnApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWxvd2VzdCB8fCB2cC5jb21wYXJlVG8obG93ZXN0KSA8IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VzdCA9IHZwOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsICgwLCBfdXRpbC5vcHRpbWl6ZUNodW5rcykoY2h1bmtzLCBsb3dlc3QpKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIF9jYWxsZWU0LCB0aGlzKTsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICBmdW5jdGlvbiBibG9ja3NGb3JSYW5nZShfeDUsIF94NiwgX3g3KSB7CiAgICAgICAgICAgICAgcmV0dXJuIF9ibG9ja3NGb3JSYW5nZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBibG9ja3NGb3JSYW5nZTsKICAgICAgICAgIH0oKQogICAgICAgIH1dKTsKICAgICAgICByZXR1cm4gQkFJMjsKICAgICAgfShfaW5kZXhGaWxlLmRlZmF1bHQpOwogICAgICBleHBvcnRzLmRlZmF1bHQgPSBCQUk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2ZyZWV6aW5nLmpzCiAgdmFyIHJlcXVpcmVfZnJlZXppbmcgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9mcmVlemluZy5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGZhaWxzID0gcmVxdWlyZV9mYWlscygpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9ICFmYWlscyhmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gT2JqZWN0LmlzRXh0ZW5zaWJsZShPYmplY3QucHJldmVudEV4dGVuc2lvbnMoe30pKTsKICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2ludGVybmFsLW1ldGFkYXRhLmpzCiAgdmFyIHJlcXVpcmVfaW50ZXJuYWxfbWV0YWRhdGEgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9pbnRlcm5hbC1tZXRhZGF0YS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyICQgPSByZXF1aXJlX2V4cG9ydCgpOwogICAgICB2YXIgaGlkZGVuS2V5cyA9IHJlcXVpcmVfaGlkZGVuX2tleXMoKTsKICAgICAgdmFyIGlzT2JqZWN0ID0gcmVxdWlyZV9pc19vYmplY3QoKTsKICAgICAgdmFyIGhhcyA9IHJlcXVpcmVfaGFzKCk7CiAgICAgIHZhciBkZWZpbmVQcm9wZXJ0eSA9IHJlcXVpcmVfb2JqZWN0X2RlZmluZV9wcm9wZXJ0eSgpLmY7CiAgICAgIHZhciBnZXRPd25Qcm9wZXJ0eU5hbWVzTW9kdWxlID0gcmVxdWlyZV9vYmplY3RfZ2V0X293bl9wcm9wZXJ0eV9uYW1lcygpOwogICAgICB2YXIgZ2V0T3duUHJvcGVydHlOYW1lc0V4dGVybmFsTW9kdWxlID0gcmVxdWlyZV9vYmplY3RfZ2V0X293bl9wcm9wZXJ0eV9uYW1lc19leHRlcm5hbCgpOwogICAgICB2YXIgdWlkID0gcmVxdWlyZV91aWQoKTsKICAgICAgdmFyIEZSRUVaSU5HID0gcmVxdWlyZV9mcmVlemluZygpOwogICAgICB2YXIgUkVRVUlSRUQgPSBmYWxzZTsKICAgICAgdmFyIE1FVEFEQVRBID0gdWlkKCJtZXRhIik7CiAgICAgIHZhciBpZCA9IDA7CiAgICAgIHZhciBpc0V4dGVuc2libGUgPSBPYmplY3QuaXNFeHRlbnNpYmxlIHx8IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9OwogICAgICB2YXIgc2V0TWV0YWRhdGEgPSBmdW5jdGlvbihpdCkgewogICAgICAgIGRlZmluZVByb3BlcnR5KGl0LCBNRVRBREFUQSwgeyB2YWx1ZTogewogICAgICAgICAgb2JqZWN0SUQ6ICJPIiArIGlkKyssCiAgICAgICAgICB3ZWFrRGF0YToge30KICAgICAgICB9IH0pOwogICAgICB9OwogICAgICB2YXIgZmFzdEtleSA9IGZ1bmN0aW9uKGl0LCBjcmVhdGUpIHsKICAgICAgICBpZiAoIWlzT2JqZWN0KGl0KSkKICAgICAgICAgIHJldHVybiB0eXBlb2YgaXQgPT0gInN5bWJvbCIgPyBpdCA6ICh0eXBlb2YgaXQgPT0gInN0cmluZyIgPyAiUyIgOiAiUCIpICsgaXQ7CiAgICAgICAgaWYgKCFoYXMoaXQsIE1FVEFEQVRBKSkgewogICAgICAgICAgaWYgKCFpc0V4dGVuc2libGUoaXQpKQogICAgICAgICAgICByZXR1cm4gIkYiOwogICAgICAgICAgaWYgKCFjcmVhdGUpCiAgICAgICAgICAgIHJldHVybiAiRSI7CiAgICAgICAgICBzZXRNZXRhZGF0YShpdCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpdFtNRVRBREFUQV0ub2JqZWN0SUQ7CiAgICAgIH07CiAgICAgIHZhciBnZXRXZWFrRGF0YSA9IGZ1bmN0aW9uKGl0LCBjcmVhdGUpIHsKICAgICAgICBpZiAoIWhhcyhpdCwgTUVUQURBVEEpKSB7CiAgICAgICAgICBpZiAoIWlzRXh0ZW5zaWJsZShpdCkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgaWYgKCFjcmVhdGUpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIHNldE1ldGFkYXRhKGl0KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGl0W01FVEFEQVRBXS53ZWFrRGF0YTsKICAgICAgfTsKICAgICAgdmFyIG9uRnJlZXplID0gZnVuY3Rpb24oaXQpIHsKICAgICAgICBpZiAoRlJFRVpJTkcgJiYgUkVRVUlSRUQgJiYgaXNFeHRlbnNpYmxlKGl0KSAmJiAhaGFzKGl0LCBNRVRBREFUQSkpCiAgICAgICAgICBzZXRNZXRhZGF0YShpdCk7CiAgICAgICAgcmV0dXJuIGl0OwogICAgICB9OwogICAgICB2YXIgZW5hYmxlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgbWV0YS5lbmFibGUgPSBmdW5jdGlvbigpIHsKICAgICAgICB9OwogICAgICAgIFJFUVVJUkVEID0gdHJ1ZTsKICAgICAgICB2YXIgZ2V0T3duUHJvcGVydHlOYW1lcyA9IGdldE93blByb3BlcnR5TmFtZXNNb2R1bGUuZjsKICAgICAgICB2YXIgc3BsaWNlID0gW10uc3BsaWNlOwogICAgICAgIHZhciB0ZXN0ID0ge307CiAgICAgICAgdGVzdFtNRVRBREFUQV0gPSAxOwogICAgICAgIGlmIChnZXRPd25Qcm9wZXJ0eU5hbWVzKHRlc3QpLmxlbmd0aCkgewogICAgICAgICAgZ2V0T3duUHJvcGVydHlOYW1lc01vZHVsZS5mID0gZnVuY3Rpb24oaXQpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGdldE93blByb3BlcnR5TmFtZXMoaXQpOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gcmVzdWx0Lmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKHJlc3VsdFtpXSA9PT0gTUVUQURBVEEpIHsKICAgICAgICAgICAgICAgIHNwbGljZS5jYWxsKHJlc3VsdCwgaSwgMSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgIH07CiAgICAgICAgICAkKHsgdGFyZ2V0OiAiT2JqZWN0Iiwgc3RhdDogdHJ1ZSwgZm9yY2VkOiB0cnVlIH0sIHsKICAgICAgICAgICAgZ2V0T3duUHJvcGVydHlOYW1lczogZ2V0T3duUHJvcGVydHlOYW1lc0V4dGVybmFsTW9kdWxlLmYKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfTsKICAgICAgdmFyIG1ldGEgPSBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgICBlbmFibGUsCiAgICAgICAgZmFzdEtleSwKICAgICAgICBnZXRXZWFrRGF0YSwKICAgICAgICBvbkZyZWV6ZQogICAgICB9OwogICAgICBoaWRkZW5LZXlzW01FVEFEQVRBXSA9IHRydWU7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2NvbGxlY3Rpb24uanMKICB2YXIgcmVxdWlyZV9jb2xsZWN0aW9uID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvY29sbGVjdGlvbi5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgJCA9IHJlcXVpcmVfZXhwb3J0KCk7CiAgICAgIHZhciBnbG9iYWwyID0gcmVxdWlyZV9nbG9iYWwoKTsKICAgICAgdmFyIEludGVybmFsTWV0YWRhdGFNb2R1bGUgPSByZXF1aXJlX2ludGVybmFsX21ldGFkYXRhKCk7CiAgICAgIHZhciBmYWlscyA9IHJlcXVpcmVfZmFpbHMoKTsKICAgICAgdmFyIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSA9IHJlcXVpcmVfY3JlYXRlX25vbl9lbnVtZXJhYmxlX3Byb3BlcnR5KCk7CiAgICAgIHZhciBpdGVyYXRlID0gcmVxdWlyZV9pdGVyYXRlKCk7CiAgICAgIHZhciBhbkluc3RhbmNlID0gcmVxdWlyZV9hbl9pbnN0YW5jZSgpOwogICAgICB2YXIgaXNDYWxsYWJsZSA9IHJlcXVpcmVfaXNfY2FsbGFibGUoKTsKICAgICAgdmFyIGlzT2JqZWN0ID0gcmVxdWlyZV9pc19vYmplY3QoKTsKICAgICAgdmFyIHNldFRvU3RyaW5nVGFnID0gcmVxdWlyZV9zZXRfdG9fc3RyaW5nX3RhZygpOwogICAgICB2YXIgZGVmaW5lUHJvcGVydHkgPSByZXF1aXJlX29iamVjdF9kZWZpbmVfcHJvcGVydHkoKS5mOwogICAgICB2YXIgZm9yRWFjaCA9IHJlcXVpcmVfYXJyYXlfaXRlcmF0aW9uKCkuZm9yRWFjaDsKICAgICAgdmFyIERFU0NSSVBUT1JTID0gcmVxdWlyZV9kZXNjcmlwdG9ycygpOwogICAgICB2YXIgSW50ZXJuYWxTdGF0ZU1vZHVsZSA9IHJlcXVpcmVfaW50ZXJuYWxfc3RhdGUoKTsKICAgICAgdmFyIHNldEludGVybmFsU3RhdGUgPSBJbnRlcm5hbFN0YXRlTW9kdWxlLnNldDsKICAgICAgdmFyIGludGVybmFsU3RhdGVHZXR0ZXJGb3IgPSBJbnRlcm5hbFN0YXRlTW9kdWxlLmdldHRlckZvcjsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihDT05TVFJVQ1RPUl9OQU1FLCB3cmFwcGVyLCBjb21tb24pIHsKICAgICAgICB2YXIgSVNfTUFQID0gQ09OU1RSVUNUT1JfTkFNRS5pbmRleE9mKCJNYXAiKSAhPT0gLTE7CiAgICAgICAgdmFyIElTX1dFQUsgPSBDT05TVFJVQ1RPUl9OQU1FLmluZGV4T2YoIldlYWsiKSAhPT0gLTE7CiAgICAgICAgdmFyIEFEREVSID0gSVNfTUFQID8gInNldCIgOiAiYWRkIjsKICAgICAgICB2YXIgTmF0aXZlQ29uc3RydWN0b3IgPSBnbG9iYWwyW0NPTlNUUlVDVE9SX05BTUVdOwogICAgICAgIHZhciBOYXRpdmVQcm90b3R5cGUgPSBOYXRpdmVDb25zdHJ1Y3RvciAmJiBOYXRpdmVDb25zdHJ1Y3Rvci5wcm90b3R5cGU7CiAgICAgICAgdmFyIGV4cG9ydGVkID0ge307CiAgICAgICAgdmFyIENvbnN0cnVjdG9yOwogICAgICAgIGlmICghREVTQ1JJUFRPUlMgfHwgIWlzQ2FsbGFibGUoTmF0aXZlQ29uc3RydWN0b3IpIHx8ICEoSVNfV0VBSyB8fCBOYXRpdmVQcm90b3R5cGUuZm9yRWFjaCAmJiAhZmFpbHMoZnVuY3Rpb24oKSB7CiAgICAgICAgICBuZXcgTmF0aXZlQ29uc3RydWN0b3IoKS5lbnRyaWVzKCkubmV4dCgpOwogICAgICAgIH0pKSkgewogICAgICAgICAgQ29uc3RydWN0b3IgPSBjb21tb24uZ2V0Q29uc3RydWN0b3Iod3JhcHBlciwgQ09OU1RSVUNUT1JfTkFNRSwgSVNfTUFQLCBBRERFUik7CiAgICAgICAgICBJbnRlcm5hbE1ldGFkYXRhTW9kdWxlLmVuYWJsZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBDb25zdHJ1Y3RvciA9IHdyYXBwZXIoZnVuY3Rpb24odGFyZ2V0LCBpdGVyYWJsZSkgewogICAgICAgICAgICBzZXRJbnRlcm5hbFN0YXRlKGFuSW5zdGFuY2UodGFyZ2V0LCBDb25zdHJ1Y3RvciwgQ09OU1RSVUNUT1JfTkFNRSksIHsKICAgICAgICAgICAgICB0eXBlOiBDT05TVFJVQ1RPUl9OQU1FLAogICAgICAgICAgICAgIGNvbGxlY3Rpb246IG5ldyBOYXRpdmVDb25zdHJ1Y3RvcigpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAoaXRlcmFibGUgIT0gdm9pZCAwKQogICAgICAgICAgICAgIGl0ZXJhdGUoaXRlcmFibGUsIHRhcmdldFtBRERFUl0sIHsgdGhhdDogdGFyZ2V0LCBBU19FTlRSSUVTOiBJU19NQVAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBnZXRJbnRlcm5hbFN0YXRlID0gaW50ZXJuYWxTdGF0ZUdldHRlckZvcihDT05TVFJVQ1RPUl9OQU1FKTsKICAgICAgICAgIGZvckVhY2goWyJhZGQiLCAiY2xlYXIiLCAiZGVsZXRlIiwgImZvckVhY2giLCAiZ2V0IiwgImhhcyIsICJzZXQiLCAia2V5cyIsICJ2YWx1ZXMiLCAiZW50cmllcyJdLCBmdW5jdGlvbihLRVkpIHsKICAgICAgICAgICAgdmFyIElTX0FEREVSID0gS0VZID09ICJhZGQiIHx8IEtFWSA9PSAic2V0IjsKICAgICAgICAgICAgaWYgKEtFWSBpbiBOYXRpdmVQcm90b3R5cGUgJiYgIShJU19XRUFLICYmIEtFWSA9PSAiY2xlYXIiKSkgewogICAgICAgICAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eShDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIEtFWSwgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgdmFyIGNvbGxlY3Rpb24gPSBnZXRJbnRlcm5hbFN0YXRlKHRoaXMpLmNvbGxlY3Rpb247CiAgICAgICAgICAgICAgICBpZiAoIUlTX0FEREVSICYmIElTX1dFQUsgJiYgIWlzT2JqZWN0KGEpKQogICAgICAgICAgICAgICAgICByZXR1cm4gS0VZID09ICJnZXQiID8gdm9pZCAwIDogZmFsc2U7CiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gY29sbGVjdGlvbltLRVldKGEgPT09IDAgPyAwIDogYSwgYik7CiAgICAgICAgICAgICAgICByZXR1cm4gSVNfQURERVIgPyB0aGlzIDogcmVzdWx0OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIElTX1dFQUsgfHwgZGVmaW5lUHJvcGVydHkoQ29uc3RydWN0b3IucHJvdG90eXBlLCAic2l6ZSIsIHsKICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiBnZXRJbnRlcm5hbFN0YXRlKHRoaXMpLmNvbGxlY3Rpb24uc2l6ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHNldFRvU3RyaW5nVGFnKENvbnN0cnVjdG9yLCBDT05TVFJVQ1RPUl9OQU1FLCBmYWxzZSwgdHJ1ZSk7CiAgICAgICAgZXhwb3J0ZWRbQ09OU1RSVUNUT1JfTkFNRV0gPSBDb25zdHJ1Y3RvcjsKICAgICAgICAkKHsgZ2xvYmFsOiB0cnVlLCBmb3JjZWQ6IHRydWUgfSwgZXhwb3J0ZWQpOwogICAgICAgIGlmICghSVNfV0VBSykKICAgICAgICAgIGNvbW1vbi5zZXRTdHJvbmcoQ29uc3RydWN0b3IsIENPTlNUUlVDVE9SX05BTUUsIElTX01BUCk7CiAgICAgICAgcmV0dXJuIENvbnN0cnVjdG9yOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9jb2xsZWN0aW9uLXdlYWsuanMKICB2YXIgcmVxdWlyZV9jb2xsZWN0aW9uX3dlYWsgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9jb2xsZWN0aW9uLXdlYWsuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIHJlZGVmaW5lQWxsID0gcmVxdWlyZV9yZWRlZmluZV9hbGwoKTsKICAgICAgdmFyIGdldFdlYWtEYXRhID0gcmVxdWlyZV9pbnRlcm5hbF9tZXRhZGF0YSgpLmdldFdlYWtEYXRhOwogICAgICB2YXIgYW5PYmplY3QgPSByZXF1aXJlX2FuX29iamVjdCgpOwogICAgICB2YXIgaXNPYmplY3QgPSByZXF1aXJlX2lzX29iamVjdCgpOwogICAgICB2YXIgYW5JbnN0YW5jZSA9IHJlcXVpcmVfYW5faW5zdGFuY2UoKTsKICAgICAgdmFyIGl0ZXJhdGUgPSByZXF1aXJlX2l0ZXJhdGUoKTsKICAgICAgdmFyIEFycmF5SXRlcmF0aW9uTW9kdWxlID0gcmVxdWlyZV9hcnJheV9pdGVyYXRpb24oKTsKICAgICAgdmFyICRoYXMgPSByZXF1aXJlX2hhcygpOwogICAgICB2YXIgSW50ZXJuYWxTdGF0ZU1vZHVsZSA9IHJlcXVpcmVfaW50ZXJuYWxfc3RhdGUoKTsKICAgICAgdmFyIHNldEludGVybmFsU3RhdGUgPSBJbnRlcm5hbFN0YXRlTW9kdWxlLnNldDsKICAgICAgdmFyIGludGVybmFsU3RhdGVHZXR0ZXJGb3IgPSBJbnRlcm5hbFN0YXRlTW9kdWxlLmdldHRlckZvcjsKICAgICAgdmFyIGZpbmQgPSBBcnJheUl0ZXJhdGlvbk1vZHVsZS5maW5kOwogICAgICB2YXIgZmluZEluZGV4ID0gQXJyYXlJdGVyYXRpb25Nb2R1bGUuZmluZEluZGV4OwogICAgICB2YXIgaWQgPSAwOwogICAgICB2YXIgdW5jYXVnaHRGcm96ZW5TdG9yZSA9IGZ1bmN0aW9uKHN0b3JlKSB7CiAgICAgICAgcmV0dXJuIHN0b3JlLmZyb3plbiB8fCAoc3RvcmUuZnJvemVuID0gbmV3IFVuY2F1Z2h0RnJvemVuU3RvcmUoKSk7CiAgICAgIH07CiAgICAgIHZhciBVbmNhdWdodEZyb3plblN0b3JlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5lbnRyaWVzID0gW107CiAgICAgIH07CiAgICAgIHZhciBmaW5kVW5jYXVnaHRGcm96ZW4gPSBmdW5jdGlvbihzdG9yZSwga2V5KSB7CiAgICAgICAgcmV0dXJuIGZpbmQoc3RvcmUuZW50cmllcywgZnVuY3Rpb24oaXQpIHsKICAgICAgICAgIHJldHVybiBpdFswXSA9PT0ga2V5OwogICAgICAgIH0pOwogICAgICB9OwogICAgICBVbmNhdWdodEZyb3plblN0b3JlLnByb3RvdHlwZSA9IHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgdmFyIGVudHJ5ID0gZmluZFVuY2F1Z2h0RnJvemVuKHRoaXMsIGtleSk7CiAgICAgICAgICBpZiAoZW50cnkpCiAgICAgICAgICAgIHJldHVybiBlbnRyeVsxXTsKICAgICAgICB9LAogICAgICAgIGhhczogZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICByZXR1cm4gISFmaW5kVW5jYXVnaHRGcm96ZW4odGhpcywga2V5KTsKICAgICAgICB9LAogICAgICAgIHNldDogZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogICAgICAgICAgdmFyIGVudHJ5ID0gZmluZFVuY2F1Z2h0RnJvemVuKHRoaXMsIGtleSk7CiAgICAgICAgICBpZiAoZW50cnkpCiAgICAgICAgICAgIGVudHJ5WzFdID0gdmFsdWU7CiAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHRoaXMuZW50cmllcy5wdXNoKFtrZXksIHZhbHVlXSk7CiAgICAgICAgfSwKICAgICAgICAiZGVsZXRlIjogZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICB2YXIgaW5kZXggPSBmaW5kSW5kZXgodGhpcy5lbnRyaWVzLCBmdW5jdGlvbihpdCkgewogICAgICAgICAgICByZXR1cm4gaXRbMF0gPT09IGtleTsKICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKH5pbmRleCkKICAgICAgICAgICAgdGhpcy5lbnRyaWVzLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgICByZXR1cm4gISF+aW5kZXg7CiAgICAgICAgfQogICAgICB9OwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgICBnZXRDb25zdHJ1Y3RvcjogZnVuY3Rpb24od3JhcHBlciwgQ09OU1RSVUNUT1JfTkFNRSwgSVNfTUFQLCBBRERFUikgewogICAgICAgICAgdmFyIEMgPSB3cmFwcGVyKGZ1bmN0aW9uKHRoYXQsIGl0ZXJhYmxlKSB7CiAgICAgICAgICAgIGFuSW5zdGFuY2UodGhhdCwgQywgQ09OU1RSVUNUT1JfTkFNRSk7CiAgICAgICAgICAgIHNldEludGVybmFsU3RhdGUodGhhdCwgewogICAgICAgICAgICAgIHR5cGU6IENPTlNUUlVDVE9SX05BTUUsCiAgICAgICAgICAgICAgaWQ6IGlkKyssCiAgICAgICAgICAgICAgZnJvemVuOiB2b2lkIDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGlmIChpdGVyYWJsZSAhPSB2b2lkIDApCiAgICAgICAgICAgICAgaXRlcmF0ZShpdGVyYWJsZSwgdGhhdFtBRERFUl0sIHsgdGhhdCwgQVNfRU5UUklFUzogSVNfTUFQIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgZ2V0SW50ZXJuYWxTdGF0ZSA9IGludGVybmFsU3RhdGVHZXR0ZXJGb3IoQ09OU1RSVUNUT1JfTkFNRSk7CiAgICAgICAgICB2YXIgZGVmaW5lID0gZnVuY3Rpb24odGhhdCwga2V5LCB2YWx1ZSkgewogICAgICAgICAgICB2YXIgc3RhdGUgPSBnZXRJbnRlcm5hbFN0YXRlKHRoYXQpOwogICAgICAgICAgICB2YXIgZGF0YSA9IGdldFdlYWtEYXRhKGFuT2JqZWN0KGtleSksIHRydWUpOwogICAgICAgICAgICBpZiAoZGF0YSA9PT0gdHJ1ZSkKICAgICAgICAgICAgICB1bmNhdWdodEZyb3plblN0b3JlKHN0YXRlKS5zZXQoa2V5LCB2YWx1ZSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICBkYXRhW3N0YXRlLmlkXSA9IHZhbHVlOwogICAgICAgICAgICByZXR1cm4gdGhhdDsKICAgICAgICAgIH07CiAgICAgICAgICByZWRlZmluZUFsbChDLnByb3RvdHlwZSwgewogICAgICAgICAgICAiZGVsZXRlIjogZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxTdGF0ZSh0aGlzKTsKICAgICAgICAgICAgICBpZiAoIWlzT2JqZWN0KGtleSkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgdmFyIGRhdGEgPSBnZXRXZWFrRGF0YShrZXkpOwogICAgICAgICAgICAgIGlmIChkYXRhID09PSB0cnVlKQogICAgICAgICAgICAgICAgcmV0dXJuIHVuY2F1Z2h0RnJvemVuU3RvcmUoc3RhdGUpWyJkZWxldGUiXShrZXkpOwogICAgICAgICAgICAgIHJldHVybiBkYXRhICYmICRoYXMoZGF0YSwgc3RhdGUuaWQpICYmIGRlbGV0ZSBkYXRhW3N0YXRlLmlkXTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaGFzOiBmdW5jdGlvbiBoYXMoa2V5KSB7CiAgICAgICAgICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxTdGF0ZSh0aGlzKTsKICAgICAgICAgICAgICBpZiAoIWlzT2JqZWN0KGtleSkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgdmFyIGRhdGEgPSBnZXRXZWFrRGF0YShrZXkpOwogICAgICAgICAgICAgIGlmIChkYXRhID09PSB0cnVlKQogICAgICAgICAgICAgICAgcmV0dXJuIHVuY2F1Z2h0RnJvemVuU3RvcmUoc3RhdGUpLmhhcyhrZXkpOwogICAgICAgICAgICAgIHJldHVybiBkYXRhICYmICRoYXMoZGF0YSwgc3RhdGUuaWQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIHJlZGVmaW5lQWxsKEMucHJvdG90eXBlLCBJU19NQVAgPyB7CiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0MihrZXkpIHsKICAgICAgICAgICAgICB2YXIgc3RhdGUgPSBnZXRJbnRlcm5hbFN0YXRlKHRoaXMpOwogICAgICAgICAgICAgIGlmIChpc09iamVjdChrZXkpKSB7CiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IGdldFdlYWtEYXRhKGtleSk7CiAgICAgICAgICAgICAgICBpZiAoZGF0YSA9PT0gdHJ1ZSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIHVuY2F1Z2h0RnJvemVuU3RvcmUoc3RhdGUpLmdldChrZXkpOwogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEgPyBkYXRhW3N0YXRlLmlkXSA6IHZvaWQgMDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldDogZnVuY3Rpb24gc2V0MyhrZXksIHZhbHVlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGRlZmluZSh0aGlzLCBrZXksIHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSA6IHsKICAgICAgICAgICAgYWRkOiBmdW5jdGlvbiBhZGQodmFsdWUpIHsKICAgICAgICAgICAgICByZXR1cm4gZGVmaW5lKHRoaXMsIHZhbHVlLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gQzsKICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy53ZWFrLW1hcC5qcwogIHZhciByZXF1aXJlX2VzX3dlYWtfbWFwID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLndlYWstbWFwLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBnbG9iYWwyID0gcmVxdWlyZV9nbG9iYWwoKTsKICAgICAgdmFyIHJlZGVmaW5lQWxsID0gcmVxdWlyZV9yZWRlZmluZV9hbGwoKTsKICAgICAgdmFyIEludGVybmFsTWV0YWRhdGFNb2R1bGUgPSByZXF1aXJlX2ludGVybmFsX21ldGFkYXRhKCk7CiAgICAgIHZhciBjb2xsZWN0aW9uID0gcmVxdWlyZV9jb2xsZWN0aW9uKCk7CiAgICAgIHZhciBjb2xsZWN0aW9uV2VhayA9IHJlcXVpcmVfY29sbGVjdGlvbl93ZWFrKCk7CiAgICAgIHZhciBpc09iamVjdCA9IHJlcXVpcmVfaXNfb2JqZWN0KCk7CiAgICAgIHZhciBlbmZvcmNlSXRlcm5hbFN0YXRlID0gcmVxdWlyZV9pbnRlcm5hbF9zdGF0ZSgpLmVuZm9yY2U7CiAgICAgIHZhciBOQVRJVkVfV0VBS19NQVAgPSByZXF1aXJlX25hdGl2ZV93ZWFrX21hcCgpOwogICAgICB2YXIgSVNfSUUxMSA9ICFnbG9iYWwyLkFjdGl2ZVhPYmplY3QgJiYgIkFjdGl2ZVhPYmplY3QiIGluIGdsb2JhbDI7CiAgICAgIHZhciBpc0V4dGVuc2libGUgPSBPYmplY3QuaXNFeHRlbnNpYmxlOwogICAgICB2YXIgSW50ZXJuYWxXZWFrTWFwOwogICAgICB2YXIgd3JhcHBlciA9IGZ1bmN0aW9uKGluaXQyKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIFdlYWtNYXAoKSB7CiAgICAgICAgICByZXR1cm4gaW5pdDIodGhpcywgYXJndW1lbnRzLmxlbmd0aCA/IGFyZ3VtZW50c1swXSA6IHZvaWQgMCk7CiAgICAgICAgfTsKICAgICAgfTsKICAgICAgdmFyICRXZWFrTWFwID0gbW9kdWxlLmV4cG9ydHMgPSBjb2xsZWN0aW9uKCJXZWFrTWFwIiwgd3JhcHBlciwgY29sbGVjdGlvbldlYWspOwogICAgICBpZiAoTkFUSVZFX1dFQUtfTUFQICYmIElTX0lFMTEpIHsKICAgICAgICBJbnRlcm5hbFdlYWtNYXAgPSBjb2xsZWN0aW9uV2Vhay5nZXRDb25zdHJ1Y3Rvcih3cmFwcGVyLCAiV2Vha01hcCIsIHRydWUpOwogICAgICAgIEludGVybmFsTWV0YWRhdGFNb2R1bGUuZW5hYmxlKCk7CiAgICAgICAgV2Vha01hcFByb3RvdHlwZSA9ICRXZWFrTWFwLnByb3RvdHlwZTsKICAgICAgICBuYXRpdmVEZWxldGUgPSBXZWFrTWFwUHJvdG90eXBlWyJkZWxldGUiXTsKICAgICAgICBuYXRpdmVIYXMgPSBXZWFrTWFwUHJvdG90eXBlLmhhczsKICAgICAgICBuYXRpdmVHZXQgPSBXZWFrTWFwUHJvdG90eXBlLmdldDsKICAgICAgICBuYXRpdmVTZXQgPSBXZWFrTWFwUHJvdG90eXBlLnNldDsKICAgICAgICByZWRlZmluZUFsbChXZWFrTWFwUHJvdG90eXBlLCB7CiAgICAgICAgICAiZGVsZXRlIjogZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICAgIGlmIChpc09iamVjdChrZXkpICYmICFpc0V4dGVuc2libGUoa2V5KSkgewogICAgICAgICAgICAgIHZhciBzdGF0ZSA9IGVuZm9yY2VJdGVybmFsU3RhdGUodGhpcyk7CiAgICAgICAgICAgICAgaWYgKCFzdGF0ZS5mcm96ZW4pCiAgICAgICAgICAgICAgICBzdGF0ZS5mcm96ZW4gPSBuZXcgSW50ZXJuYWxXZWFrTWFwKCk7CiAgICAgICAgICAgICAgcmV0dXJuIG5hdGl2ZURlbGV0ZS5jYWxsKHRoaXMsIGtleSkgfHwgc3RhdGUuZnJvemVuWyJkZWxldGUiXShrZXkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBuYXRpdmVEZWxldGUuY2FsbCh0aGlzLCBrZXkpOwogICAgICAgICAgfSwKICAgICAgICAgIGhhczogZnVuY3Rpb24gaGFzKGtleSkgewogICAgICAgICAgICBpZiAoaXNPYmplY3Qoa2V5KSAmJiAhaXNFeHRlbnNpYmxlKGtleSkpIHsKICAgICAgICAgICAgICB2YXIgc3RhdGUgPSBlbmZvcmNlSXRlcm5hbFN0YXRlKHRoaXMpOwogICAgICAgICAgICAgIGlmICghc3RhdGUuZnJvemVuKQogICAgICAgICAgICAgICAgc3RhdGUuZnJvemVuID0gbmV3IEludGVybmFsV2Vha01hcCgpOwogICAgICAgICAgICAgIHJldHVybiBuYXRpdmVIYXMuY2FsbCh0aGlzLCBrZXkpIHx8IHN0YXRlLmZyb3plbi5oYXMoa2V5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbmF0aXZlSGFzLmNhbGwodGhpcywga2V5KTsKICAgICAgICAgIH0sCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldDIoa2V5KSB7CiAgICAgICAgICAgIGlmIChpc09iamVjdChrZXkpICYmICFpc0V4dGVuc2libGUoa2V5KSkgewogICAgICAgICAgICAgIHZhciBzdGF0ZSA9IGVuZm9yY2VJdGVybmFsU3RhdGUodGhpcyk7CiAgICAgICAgICAgICAgaWYgKCFzdGF0ZS5mcm96ZW4pCiAgICAgICAgICAgICAgICBzdGF0ZS5mcm96ZW4gPSBuZXcgSW50ZXJuYWxXZWFrTWFwKCk7CiAgICAgICAgICAgICAgcmV0dXJuIG5hdGl2ZUhhcy5jYWxsKHRoaXMsIGtleSkgPyBuYXRpdmVHZXQuY2FsbCh0aGlzLCBrZXkpIDogc3RhdGUuZnJvemVuLmdldChrZXkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBuYXRpdmVHZXQuY2FsbCh0aGlzLCBrZXkpOwogICAgICAgICAgfSwKICAgICAgICAgIHNldDogZnVuY3Rpb24gc2V0MyhrZXksIHZhbHVlKSB7CiAgICAgICAgICAgIGlmIChpc09iamVjdChrZXkpICYmICFpc0V4dGVuc2libGUoa2V5KSkgewogICAgICAgICAgICAgIHZhciBzdGF0ZSA9IGVuZm9yY2VJdGVybmFsU3RhdGUodGhpcyk7CiAgICAgICAgICAgICAgaWYgKCFzdGF0ZS5mcm96ZW4pCiAgICAgICAgICAgICAgICBzdGF0ZS5mcm96ZW4gPSBuZXcgSW50ZXJuYWxXZWFrTWFwKCk7CiAgICAgICAgICAgICAgbmF0aXZlSGFzLmNhbGwodGhpcywga2V5KSA/IG5hdGl2ZVNldC5jYWxsKHRoaXMsIGtleSwgdmFsdWUpIDogc3RhdGUuZnJvemVuLnNldChrZXksIHZhbHVlKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgbmF0aXZlU2V0LmNhbGwodGhpcywga2V5LCB2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICAgIHZhciBXZWFrTWFwUHJvdG90eXBlOwogICAgICB2YXIgbmF0aXZlRGVsZXRlOwogICAgICB2YXIgbmF0aXZlSGFzOwogICAgICB2YXIgbmF0aXZlR2V0OwogICAgICB2YXIgbmF0aXZlU2V0OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL3dlYWstbWFwL2luZGV4LmpzCiAgdmFyIHJlcXVpcmVfd2Vha19tYXAgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL3dlYWstbWFwL2luZGV4LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICByZXF1aXJlX2VzX2FycmF5X2l0ZXJhdG9yKCk7CiAgICAgIHJlcXVpcmVfZXNfb2JqZWN0X3RvX3N0cmluZygpOwogICAgICByZXF1aXJlX2VzX3dlYWtfbWFwKCk7CiAgICAgIHZhciBwYXRoID0gcmVxdWlyZV9wYXRoKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGF0aC5XZWFrTWFwOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS93ZWFrLW1hcC9pbmRleC5qcwogIHZhciByZXF1aXJlX3dlYWtfbWFwMiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL3dlYWstbWFwL2luZGV4LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgcGFyZW50ID0gcmVxdWlyZV93ZWFrX21hcCgpOwogICAgICByZXF1aXJlX3dlYl9kb21fY29sbGVjdGlvbnNfaXRlcmF0b3IoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXJlbnQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL21hcC1lbXBsYWNlLmpzCiAgdmFyIHJlcXVpcmVfbWFwX2VtcGxhY2UgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9tYXAtZW1wbGFjZS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgYW5PYmplY3QgPSByZXF1aXJlX2FuX29iamVjdCgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGVtcGxhY2Uoa2V5LCBoYW5kbGVyKSB7CiAgICAgICAgdmFyIG1hcDIgPSBhbk9iamVjdCh0aGlzKTsKICAgICAgICB2YXIgdmFsdWUgPSBtYXAyLmhhcyhrZXkpICYmICJ1cGRhdGUiIGluIGhhbmRsZXIgPyBoYW5kbGVyLnVwZGF0ZShtYXAyLmdldChrZXkpLCBrZXksIG1hcDIpIDogaGFuZGxlci5pbnNlcnQoa2V5LCBtYXAyKTsKICAgICAgICBtYXAyLnNldChrZXksIHZhbHVlKTsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lc25leHQud2Vhay1tYXAuZW1wbGFjZS5qcwogIHZhciByZXF1aXJlX2VzbmV4dF93ZWFrX21hcF9lbXBsYWNlID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzbmV4dC53ZWFrLW1hcC5lbXBsYWNlLmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciAkID0gcmVxdWlyZV9leHBvcnQoKTsKICAgICAgdmFyIElTX1BVUkUgPSByZXF1aXJlX2lzX3B1cmUoKTsKICAgICAgdmFyICRlbXBsYWNlID0gcmVxdWlyZV9tYXBfZW1wbGFjZSgpOwogICAgICAkKHsgdGFyZ2V0OiAiV2Vha01hcCIsIHByb3RvOiB0cnVlLCByZWFsOiB0cnVlLCBmb3JjZWQ6IElTX1BVUkUgfSwgewogICAgICAgIGVtcGxhY2U6ICRlbXBsYWNlCiAgICAgIH0pOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9jb2xsZWN0aW9uLWZyb20uanMKICB2YXIgcmVxdWlyZV9jb2xsZWN0aW9uX2Zyb20gPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9jb2xsZWN0aW9uLWZyb20uanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIGFDYWxsYWJsZSA9IHJlcXVpcmVfYV9jYWxsYWJsZSgpOwogICAgICB2YXIgYUNvbnN0cnVjdG9yID0gcmVxdWlyZV9hX2NvbnN0cnVjdG9yKCk7CiAgICAgIHZhciBiaW5kID0gcmVxdWlyZV9mdW5jdGlvbl9iaW5kX2NvbnRleHQoKTsKICAgICAgdmFyIGl0ZXJhdGUgPSByZXF1aXJlX2l0ZXJhdGUoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBmcm9tKHNvdXJjZSkgewogICAgICAgIHZhciBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICAgIHZhciBtYXBGbiA9IGxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB2b2lkIDA7CiAgICAgICAgdmFyIG1hcHBpbmcsIGFycmF5LCBuLCBib3VuZEZ1bmN0aW9uOwogICAgICAgIGFDb25zdHJ1Y3Rvcih0aGlzKTsKICAgICAgICBtYXBwaW5nID0gbWFwRm4gIT09IHZvaWQgMDsKICAgICAgICBpZiAobWFwcGluZykKICAgICAgICAgIGFDYWxsYWJsZShtYXBGbik7CiAgICAgICAgaWYgKHNvdXJjZSA9PSB2b2lkIDApCiAgICAgICAgICByZXR1cm4gbmV3IHRoaXMoKTsKICAgICAgICBhcnJheSA9IFtdOwogICAgICAgIGlmIChtYXBwaW5nKSB7CiAgICAgICAgICBuID0gMDsKICAgICAgICAgIGJvdW5kRnVuY3Rpb24gPSBiaW5kKG1hcEZuLCBsZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdm9pZCAwLCAyKTsKICAgICAgICAgIGl0ZXJhdGUoc291cmNlLCBmdW5jdGlvbihuZXh0SXRlbSkgewogICAgICAgICAgICBhcnJheS5wdXNoKGJvdW5kRnVuY3Rpb24obmV4dEl0ZW0sIG4rKykpOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGl0ZXJhdGUoc291cmNlLCBhcnJheS5wdXNoLCB7IHRoYXQ6IGFycmF5IH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IHRoaXMoYXJyYXkpOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXNuZXh0LndlYWstbWFwLmZyb20uanMKICB2YXIgcmVxdWlyZV9lc25leHRfd2Vha19tYXBfZnJvbSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lc25leHQud2Vhay1tYXAuZnJvbS5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyICQgPSByZXF1aXJlX2V4cG9ydCgpOwogICAgICB2YXIgZnJvbSA9IHJlcXVpcmVfY29sbGVjdGlvbl9mcm9tKCk7CiAgICAgICQoeyB0YXJnZXQ6ICJXZWFrTWFwIiwgc3RhdDogdHJ1ZSB9LCB7CiAgICAgICAgZnJvbQogICAgICB9KTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvY29sbGVjdGlvbi1vZi5qcwogIHZhciByZXF1aXJlX2NvbGxlY3Rpb25fb2YgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9jb2xsZWN0aW9uLW9mLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gb2YoKSB7CiAgICAgICAgdmFyIGxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgICAgdmFyIEEgPSBuZXcgQXJyYXkobGVuZ3RoKTsKICAgICAgICB3aGlsZSAobGVuZ3RoLS0pCiAgICAgICAgICBBW2xlbmd0aF0gPSBhcmd1bWVudHNbbGVuZ3RoXTsKICAgICAgICByZXR1cm4gbmV3IHRoaXMoQSk7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lc25leHQud2Vhay1tYXAub2YuanMKICB2YXIgcmVxdWlyZV9lc25leHRfd2Vha19tYXBfb2YgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXNuZXh0LndlYWstbWFwLm9mLmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgJCA9IHJlcXVpcmVfZXhwb3J0KCk7CiAgICAgIHZhciBvZiA9IHJlcXVpcmVfY29sbGVjdGlvbl9vZigpOwogICAgICAkKHsgdGFyZ2V0OiAiV2Vha01hcCIsIHN0YXQ6IHRydWUgfSwgewogICAgICAgIG9mCiAgICAgIH0pOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9jb2xsZWN0aW9uLWRlbGV0ZS1hbGwuanMKICB2YXIgcmVxdWlyZV9jb2xsZWN0aW9uX2RlbGV0ZV9hbGwgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9jb2xsZWN0aW9uLWRlbGV0ZS1hbGwuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIGFDYWxsYWJsZSA9IHJlcXVpcmVfYV9jYWxsYWJsZSgpOwogICAgICB2YXIgYW5PYmplY3QgPSByZXF1aXJlX2FuX29iamVjdCgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBjb2xsZWN0aW9uID0gYW5PYmplY3QodGhpcyk7CiAgICAgICAgdmFyIHJlbW92ZXIgPSBhQ2FsbGFibGUoY29sbGVjdGlvblsiZGVsZXRlIl0pOwogICAgICAgIHZhciBhbGxEZWxldGVkID0gdHJ1ZTsKICAgICAgICB2YXIgd2FzRGVsZXRlZDsKICAgICAgICBmb3IgKHZhciBrID0gMCwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsgayA8IGxlbjsgaysrKSB7CiAgICAgICAgICB3YXNEZWxldGVkID0gcmVtb3Zlci5jYWxsKGNvbGxlY3Rpb24sIGFyZ3VtZW50c1trXSk7CiAgICAgICAgICBhbGxEZWxldGVkID0gYWxsRGVsZXRlZCAmJiB3YXNEZWxldGVkOwogICAgICAgIH0KICAgICAgICByZXR1cm4gISFhbGxEZWxldGVkOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXNuZXh0LndlYWstbWFwLmRlbGV0ZS1hbGwuanMKICB2YXIgcmVxdWlyZV9lc25leHRfd2Vha19tYXBfZGVsZXRlX2FsbCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lc25leHQud2Vhay1tYXAuZGVsZXRlLWFsbC5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgJCA9IHJlcXVpcmVfZXhwb3J0KCk7CiAgICAgIHZhciBJU19QVVJFID0gcmVxdWlyZV9pc19wdXJlKCk7CiAgICAgIHZhciBjb2xsZWN0aW9uRGVsZXRlQWxsID0gcmVxdWlyZV9jb2xsZWN0aW9uX2RlbGV0ZV9hbGwoKTsKICAgICAgJCh7IHRhcmdldDogIldlYWtNYXAiLCBwcm90bzogdHJ1ZSwgcmVhbDogdHJ1ZSwgZm9yY2VkOiBJU19QVVJFIH0sIHsKICAgICAgICBkZWxldGVBbGw6IGZ1bmN0aW9uIGRlbGV0ZUFsbCgpIHsKICAgICAgICAgIHJldHVybiBjb2xsZWN0aW9uRGVsZXRlQWxsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvbWFwLXVwc2VydC5qcwogIHZhciByZXF1aXJlX21hcF91cHNlcnQgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9tYXAtdXBzZXJ0LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBpc0NhbGxhYmxlID0gcmVxdWlyZV9pc19jYWxsYWJsZSgpOwogICAgICB2YXIgYW5PYmplY3QgPSByZXF1aXJlX2FuX29iamVjdCgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIHVwc2VydChrZXksIHVwZGF0ZUZuKSB7CiAgICAgICAgdmFyIG1hcDIgPSBhbk9iamVjdCh0aGlzKTsKICAgICAgICB2YXIgaW5zZXJ0Rm4gPSBhcmd1bWVudHMubGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHZvaWQgMDsKICAgICAgICB2YXIgdmFsdWU7CiAgICAgICAgaWYgKCFpc0NhbGxhYmxlKHVwZGF0ZUZuKSAmJiAhaXNDYWxsYWJsZShpbnNlcnRGbikpIHsKICAgICAgICAgIHRocm93IFR5cGVFcnJvcigiQXQgbGVhc3Qgb25lIGNhbGxiYWNrIHJlcXVpcmVkIik7CiAgICAgICAgfQogICAgICAgIGlmIChtYXAyLmhhcyhrZXkpKSB7CiAgICAgICAgICB2YWx1ZSA9IG1hcDIuZ2V0KGtleSk7CiAgICAgICAgICBpZiAoaXNDYWxsYWJsZSh1cGRhdGVGbikpIHsKICAgICAgICAgICAgdmFsdWUgPSB1cGRhdGVGbih2YWx1ZSk7CiAgICAgICAgICAgIG1hcDIuc2V0KGtleSwgdmFsdWUpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoaXNDYWxsYWJsZShpbnNlcnRGbikpIHsKICAgICAgICAgIHZhbHVlID0gaW5zZXJ0Rm4oKTsKICAgICAgICAgIG1hcDIuc2V0KGtleSwgdmFsdWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lc25leHQud2Vhay1tYXAudXBzZXJ0LmpzCiAgdmFyIHJlcXVpcmVfZXNuZXh0X3dlYWtfbWFwX3Vwc2VydCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lc25leHQud2Vhay1tYXAudXBzZXJ0LmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciAkID0gcmVxdWlyZV9leHBvcnQoKTsKICAgICAgdmFyIElTX1BVUkUgPSByZXF1aXJlX2lzX3B1cmUoKTsKICAgICAgdmFyICR1cHNlcnQgPSByZXF1aXJlX21hcF91cHNlcnQoKTsKICAgICAgJCh7IHRhcmdldDogIldlYWtNYXAiLCBwcm90bzogdHJ1ZSwgcmVhbDogdHJ1ZSwgZm9yY2VkOiBJU19QVVJFIH0sIHsKICAgICAgICB1cHNlcnQ6ICR1cHNlcnQKICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZmVhdHVyZXMvd2Vhay1tYXAvaW5kZXguanMKICB2YXIgcmVxdWlyZV93ZWFrX21hcDMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ZlYXR1cmVzL3dlYWstbWFwL2luZGV4LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgcGFyZW50ID0gcmVxdWlyZV93ZWFrX21hcDIoKTsKICAgICAgcmVxdWlyZV9lc19zdHJpbmdfaXRlcmF0b3IoKTsKICAgICAgcmVxdWlyZV9lc25leHRfd2Vha19tYXBfZW1wbGFjZSgpOwogICAgICByZXF1aXJlX2VzbmV4dF93ZWFrX21hcF9mcm9tKCk7CiAgICAgIHJlcXVpcmVfZXNuZXh0X3dlYWtfbWFwX29mKCk7CiAgICAgIHJlcXVpcmVfZXNuZXh0X3dlYWtfbWFwX2RlbGV0ZV9hbGwoKTsKICAgICAgcmVxdWlyZV9lc25leHRfd2Vha19tYXBfdXBzZXJ0KCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGFyZW50OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzL3dlYWstbWFwLmpzCiAgdmFyIHJlcXVpcmVfd2Vha19tYXA0ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy93ZWFrLW1hcC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlX3dlYWtfbWFwMygpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ZlYXR1cmVzL29iamVjdC9nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IuanMKICB2YXIgcmVxdWlyZV9nZXRfb3duX3Byb3BlcnR5X2Rlc2NyaXB0b3I0ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9mZWF0dXJlcy9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgcGFyZW50ID0gcmVxdWlyZV9nZXRfb3duX3Byb3BlcnR5X2Rlc2NyaXB0b3IyKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGFyZW50OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzL29iamVjdC9nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IuanMKICB2YXIgcmVxdWlyZV9nZXRfb3duX3Byb3BlcnR5X2Rlc2NyaXB0b3I1ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmVfZ2V0X293bl9wcm9wZXJ0eV9kZXNjcmlwdG9yNCgpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9oZWxwZXJzL2ludGVyb3BSZXF1aXJlV2lsZGNhcmQuanMKICB2YXIgcmVxdWlyZV9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgX3R5cGVvZiA9IHJlcXVpcmVfdHlwZW9mKClbImRlZmF1bHQiXTsKICAgICAgdmFyIF9XZWFrTWFwID0gcmVxdWlyZV93ZWFrX21hcDQoKTsKICAgICAgdmFyIF9PYmplY3QkZGVmaW5lUHJvcGVydHkgPSByZXF1aXJlX2RlZmluZV9wcm9wZXJ0eTUoKTsKICAgICAgdmFyIF9PYmplY3QkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gcmVxdWlyZV9nZXRfb3duX3Byb3BlcnR5X2Rlc2NyaXB0b3I1KCk7CiAgICAgIGZ1bmN0aW9uIF9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZShub2RlSW50ZXJvcCkgewogICAgICAgIGlmICh0eXBlb2YgX1dlYWtNYXAgIT09ICJmdW5jdGlvbiIpCiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB2YXIgY2FjaGVCYWJlbEludGVyb3AgPSBuZXcgX1dlYWtNYXAoKTsKICAgICAgICB2YXIgY2FjaGVOb2RlSW50ZXJvcCA9IG5ldyBfV2Vha01hcCgpOwogICAgICAgIHJldHVybiAoX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlID0gZnVuY3Rpb24gX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlMihub2RlSW50ZXJvcDIpIHsKICAgICAgICAgIHJldHVybiBub2RlSW50ZXJvcDIgPyBjYWNoZU5vZGVJbnRlcm9wIDogY2FjaGVCYWJlbEludGVyb3A7CiAgICAgICAgfSkobm9kZUludGVyb3ApOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaiwgbm9kZUludGVyb3ApIHsKICAgICAgICBpZiAoIW5vZGVJbnRlcm9wICYmIG9iaiAmJiBvYmouX19lc01vZHVsZSkgewogICAgICAgICAgcmV0dXJuIG9iajsKICAgICAgICB9CiAgICAgICAgaWYgKG9iaiA9PT0gbnVsbCB8fCBfdHlwZW9mKG9iaikgIT09ICJvYmplY3QiICYmIHR5cGVvZiBvYmogIT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJkZWZhdWx0Ijogb2JqCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICB2YXIgY2FjaGUgPSBfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUobm9kZUludGVyb3ApOwogICAgICAgIGlmIChjYWNoZSAmJiBjYWNoZS5oYXMob2JqKSkgewogICAgICAgICAgcmV0dXJuIGNhY2hlLmdldChvYmopOwogICAgICAgIH0KICAgICAgICB2YXIgbmV3T2JqID0ge307CiAgICAgICAgdmFyIGhhc1Byb3BlcnR5RGVzY3JpcHRvciA9IF9PYmplY3QkZGVmaW5lUHJvcGVydHkgJiYgX09iamVjdCRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CiAgICAgICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICAgICAgaWYgKGtleSAhPT0gImRlZmF1bHQiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICAgICAgdmFyIGRlc2MgPSBoYXNQcm9wZXJ0eURlc2NyaXB0b3IgPyBfT2JqZWN0JGdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiBudWxsOwogICAgICAgICAgICBpZiAoZGVzYyAmJiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpKSB7CiAgICAgICAgICAgICAgX09iamVjdCRkZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBuZXdPYmpbImRlZmF1bHQiXSA9IG9iajsKICAgICAgICBpZiAoY2FjaGUpIHsKICAgICAgICAgIGNhY2hlLnNldChvYmosIG5ld09iaik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXdPYmo7CiAgICAgIH0KICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZDsKICAgICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvb2JqZWN0LWFzc2lnbi5qcwogIHZhciByZXF1aXJlX29iamVjdF9hc3NpZ24gPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9vYmplY3QtYXNzaWduLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBERVNDUklQVE9SUyA9IHJlcXVpcmVfZGVzY3JpcHRvcnMoKTsKICAgICAgdmFyIGZhaWxzID0gcmVxdWlyZV9mYWlscygpOwogICAgICB2YXIgb2JqZWN0S2V5cyA9IHJlcXVpcmVfb2JqZWN0X2tleXMoKTsKICAgICAgdmFyIGdldE93blByb3BlcnR5U3ltYm9sc01vZHVsZSA9IHJlcXVpcmVfb2JqZWN0X2dldF9vd25fcHJvcGVydHlfc3ltYm9scygpOwogICAgICB2YXIgcHJvcGVydHlJc0VudW1lcmFibGVNb2R1bGUgPSByZXF1aXJlX29iamVjdF9wcm9wZXJ0eV9pc19lbnVtZXJhYmxlKCk7CiAgICAgIHZhciB0b09iamVjdCA9IHJlcXVpcmVfdG9fb2JqZWN0KCk7CiAgICAgIHZhciBJbmRleGVkT2JqZWN0ID0gcmVxdWlyZV9pbmRleGVkX29iamVjdCgpOwogICAgICB2YXIgJGFzc2lnbiA9IE9iamVjdC5hc3NpZ247CiAgICAgIHZhciBkZWZpbmVQcm9wZXJ0eSA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSAhJGFzc2lnbiB8fCBmYWlscyhmdW5jdGlvbigpIHsKICAgICAgICBpZiAoREVTQ1JJUFRPUlMgJiYgJGFzc2lnbih7IGI6IDEgfSwgJGFzc2lnbihkZWZpbmVQcm9wZXJ0eSh7fSwgImEiLCB7CiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZGVmaW5lUHJvcGVydHkodGhpcywgImIiLCB7CiAgICAgICAgICAgICAgdmFsdWU6IDMsCiAgICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSksIHsgYjogMiB9KSkuYiAhPT0gMSkKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHZhciBBID0ge307CiAgICAgICAgdmFyIEIgPSB7fTsKICAgICAgICB2YXIgc3ltYm9sID0gU3ltYm9sKCk7CiAgICAgICAgdmFyIGFscGhhYmV0ID0gImFiY2RlZmdoaWprbG1ub3BxcnN0IjsKICAgICAgICBBW3N5bWJvbF0gPSA3OwogICAgICAgIGFscGhhYmV0LnNwbGl0KCIiKS5mb3JFYWNoKGZ1bmN0aW9uKGNocikgewogICAgICAgICAgQltjaHJdID0gY2hyOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiAkYXNzaWduKHt9LCBBKVtzeW1ib2xdICE9IDcgfHwgb2JqZWN0S2V5cygkYXNzaWduKHt9LCBCKSkuam9pbigiIikgIT0gYWxwaGFiZXQ7CiAgICAgIH0pID8gZnVuY3Rpb24gYXNzaWduKHRhcmdldCwgc291cmNlKSB7CiAgICAgICAgdmFyIFQgPSB0b09iamVjdCh0YXJnZXQpOwogICAgICAgIHZhciBhcmd1bWVudHNMZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICAgIHZhciBpbmRleCA9IDE7CiAgICAgICAgdmFyIGdldE93blByb3BlcnR5U3ltYm9scyA9IGdldE93blByb3BlcnR5U3ltYm9sc01vZHVsZS5mOwogICAgICAgIHZhciBwcm9wZXJ0eUlzRW51bWVyYWJsZSA9IHByb3BlcnR5SXNFbnVtZXJhYmxlTW9kdWxlLmY7CiAgICAgICAgd2hpbGUgKGFyZ3VtZW50c0xlbmd0aCA+IGluZGV4KSB7CiAgICAgICAgICB2YXIgUyA9IEluZGV4ZWRPYmplY3QoYXJndW1lbnRzW2luZGV4KytdKTsKICAgICAgICAgIHZhciBrZXlzID0gZ2V0T3duUHJvcGVydHlTeW1ib2xzID8gb2JqZWN0S2V5cyhTKS5jb25jYXQoZ2V0T3duUHJvcGVydHlTeW1ib2xzKFMpKSA6IG9iamVjdEtleXMoUyk7CiAgICAgICAgICB2YXIgbGVuZ3RoID0ga2V5cy5sZW5ndGg7CiAgICAgICAgICB2YXIgaiA9IDA7CiAgICAgICAgICB2YXIga2V5OwogICAgICAgICAgd2hpbGUgKGxlbmd0aCA+IGopIHsKICAgICAgICAgICAga2V5ID0ga2V5c1tqKytdOwogICAgICAgICAgICBpZiAoIURFU0NSSVBUT1JTIHx8IHByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwoUywga2V5KSkKICAgICAgICAgICAgICBUW2tleV0gPSBTW2tleV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBUOwogICAgICB9IDogJGFzc2lnbjsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLm9iamVjdC5hc3NpZ24uanMKICB2YXIgcmVxdWlyZV9lc19vYmplY3RfYXNzaWduID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLm9iamVjdC5hc3NpZ24uanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciAkID0gcmVxdWlyZV9leHBvcnQoKTsKICAgICAgdmFyIGFzc2lnbiA9IHJlcXVpcmVfb2JqZWN0X2Fzc2lnbigpOwogICAgICAkKHsgdGFyZ2V0OiAiT2JqZWN0Iiwgc3RhdDogdHJ1ZSwgZm9yY2VkOiBPYmplY3QuYXNzaWduICE9PSBhc3NpZ24gfSwgewogICAgICAgIGFzc2lnbgogICAgICB9KTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9vYmplY3QvYXNzaWduLmpzCiAgdmFyIHJlcXVpcmVfYXNzaWduID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9vYmplY3QvYXNzaWduLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICByZXF1aXJlX2VzX29iamVjdF9hc3NpZ24oKTsKICAgICAgdmFyIHBhdGggPSByZXF1aXJlX3BhdGgoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXRoLk9iamVjdC5hc3NpZ247CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL29iamVjdC9hc3NpZ24uanMKICB2YXIgcmVxdWlyZV9hc3NpZ24yID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvb2JqZWN0L2Fzc2lnbi5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHBhcmVudCA9IHJlcXVpcmVfYXNzaWduKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGFyZW50OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzLXN0YWJsZS9vYmplY3QvYXNzaWduLmpzCiAgdmFyIHJlcXVpcmVfYXNzaWduMyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMtc3RhYmxlL29iamVjdC9hc3NpZ24uanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZV9hc3NpZ24yKCk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2FycmF5V2l0aEhvbGVzLmpzCiAgdmFyIHJlcXVpcmVfYXJyYXlXaXRoSG9sZXMyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvYXJyYXlXaXRoSG9sZXMuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIGZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKQogICAgICAgICAgcmV0dXJuIGFycjsKICAgICAgfQogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9hcnJheVdpdGhIb2xlczsKICAgICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvaXRlcmFibGVUb0FycmF5TGltaXQuanMKICB2YXIgcmVxdWlyZV9pdGVyYWJsZVRvQXJyYXlMaW1pdDIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9pdGVyYWJsZVRvQXJyYXlMaW1pdC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgewogICAgICAgIHZhciBfaSA9IGFyciA9PSBudWxsID8gbnVsbCA6IHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIGFycltTeW1ib2wuaXRlcmF0b3JdIHx8IGFyclsiQEBpdGVyYXRvciJdOwogICAgICAgIGlmIChfaSA9PSBudWxsKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIHZhciBfYXJyID0gW107CiAgICAgICAgdmFyIF9uID0gdHJ1ZTsKICAgICAgICB2YXIgX2QgPSBmYWxzZTsKICAgICAgICB2YXIgX3MsIF9lOwogICAgICAgIHRyeSB7CiAgICAgICAgICBmb3IgKF9pID0gX2kuY2FsbChhcnIpOyAhKF9uID0gKF9zID0gX2kubmV4dCgpKS5kb25lKTsgX24gPSB0cnVlKSB7CiAgICAgICAgICAgIF9hcnIucHVzaChfcy52YWx1ZSk7CiAgICAgICAgICAgIGlmIChpICYmIF9hcnIubGVuZ3RoID09PSBpKQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgX2QgPSB0cnVlOwogICAgICAgICAgX2UgPSBlcnI7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpCiAgICAgICAgICAgICAgX2lbInJldHVybiJdKCk7CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoX2QpCiAgICAgICAgICAgICAgdGhyb3cgX2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBfYXJyOwogICAgICB9CiAgICAgIG1vZHVsZS5leHBvcnRzID0gX2l0ZXJhYmxlVG9BcnJheUxpbWl0OwogICAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9hcnJheUxpa2VUb0FycmF5LmpzCiAgdmFyIHJlcXVpcmVfYXJyYXlMaWtlVG9BcnJheTIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9hcnJheUxpa2VUb0FycmF5LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBmdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikgewogICAgICAgIGlmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKQogICAgICAgICAgbGVuID0gYXJyLmxlbmd0aDsKICAgICAgICBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIGFycjJbaV0gPSBhcnJbaV07CiAgICAgICAgfQogICAgICAgIHJldHVybiBhcnIyOwogICAgICB9CiAgICAgIG1vZHVsZS5leHBvcnRzID0gX2FycmF5TGlrZVRvQXJyYXk7CiAgICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5LmpzCiAgdmFyIHJlcXVpcmVfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBhcnJheUxpa2VUb0FycmF5ID0gcmVxdWlyZV9hcnJheUxpa2VUb0FycmF5MigpOwogICAgICBmdW5jdGlvbiBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7CiAgICAgICAgaWYgKCFvKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpCiAgICAgICAgICByZXR1cm4gYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOwogICAgICAgIHZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTsKICAgICAgICBpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikKICAgICAgICAgIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7CiAgICAgICAgaWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKQogICAgICAgICAgcmV0dXJuIEFycmF5LmZyb20obyk7CiAgICAgICAgaWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKQogICAgICAgICAgcmV0dXJuIGFycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTsKICAgICAgfQogICAgICBtb2R1bGUuZXhwb3J0cyA9IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheTsKICAgICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvbm9uSXRlcmFibGVSZXN0LmpzCiAgdmFyIHJlcXVpcmVfbm9uSXRlcmFibGVSZXN0MiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL25vbkl0ZXJhYmxlUmVzdC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgZnVuY3Rpb24gX25vbkl0ZXJhYmxlUmVzdCgpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpOwogICAgICB9CiAgICAgIG1vZHVsZS5leHBvcnRzID0gX25vbkl0ZXJhYmxlUmVzdDsKICAgICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvc2xpY2VkVG9BcnJheS5qcwogIHZhciByZXF1aXJlX3NsaWNlZFRvQXJyYXkyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvc2xpY2VkVG9BcnJheS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGFycmF5V2l0aEhvbGVzID0gcmVxdWlyZV9hcnJheVdpdGhIb2xlczIoKTsKICAgICAgdmFyIGl0ZXJhYmxlVG9BcnJheUxpbWl0ID0gcmVxdWlyZV9pdGVyYWJsZVRvQXJyYXlMaW1pdDIoKTsKICAgICAgdmFyIHVuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5ID0gcmVxdWlyZV91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheTIoKTsKICAgICAgdmFyIG5vbkl0ZXJhYmxlUmVzdCA9IHJlcXVpcmVfbm9uSXRlcmFibGVSZXN0MigpOwogICAgICBmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHsKICAgICAgICByZXR1cm4gYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBpdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IHVuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KGFyciwgaSkgfHwgbm9uSXRlcmFibGVSZXN0KCk7CiAgICAgIH0KICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfc2xpY2VkVG9BcnJheTsKICAgICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL3JlZ2VuZXJhdG9yL2luZGV4LmpzCiAgdmFyIHJlcXVpcmVfcmVnZW5lcmF0b3IyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL3JlZ2VuZXJhdG9yL2luZGV4LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmVfcnVudGltZSgpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9hc3luY1RvR2VuZXJhdG9yLmpzCiAgdmFyIHJlcXVpcmVfYXN5bmNUb0dlbmVyYXRvcjIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9hc3luY1RvR2VuZXJhdG9yLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsKICAgICAgICAgIHZhciB2YWx1ZSA9IGluZm8udmFsdWU7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIHJlamVjdChlcnJvcik7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChpbmZvLmRvbmUpIHsKICAgICAgICAgIHJlc29sdmUodmFsdWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHNlbGYyID0gdGhpcywgYXJncyA9IGFyZ3VtZW50czsKICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgdmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYyLCBhcmdzKTsKICAgICAgICAgICAgZnVuY3Rpb24gX25leHQodmFsdWUpIHsKICAgICAgICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIF90aHJvdyhlcnIpIHsKICAgICAgICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJ0aHJvdyIsIGVycik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX25leHQodm9pZCAwKTsKICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgIH0KICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfYXN5bmNUb0dlbmVyYXRvcjsKICAgICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL3Bha28vbGliL3V0aWxzL2NvbW1vbi5qcwogIHZhciByZXF1aXJlX2NvbW1vbjIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvcGFrby9saWIvdXRpbHMvY29tbW9uLmpzIihleHBvcnRzKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgVFlQRURfT0sgPSB0eXBlb2YgVWludDhBcnJheSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIFVpbnQxNkFycmF5ICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YgSW50MzJBcnJheSAhPT0gInVuZGVmaW5lZCI7CiAgICAgIGZ1bmN0aW9uIF9oYXMob2JqLCBrZXkpIHsKICAgICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KTsKICAgICAgfQogICAgICBleHBvcnRzLmFzc2lnbiA9IGZ1bmN0aW9uKG9iaikgewogICAgICAgIHZhciBzb3VyY2VzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgICAgICB3aGlsZSAoc291cmNlcy5sZW5ndGgpIHsKICAgICAgICAgIHZhciBzb3VyY2UgPSBzb3VyY2VzLnNoaWZ0KCk7CiAgICAgICAgICBpZiAoIXNvdXJjZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0eXBlb2Ygc291cmNlICE9PSAib2JqZWN0IikgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHNvdXJjZSArICJtdXN0IGJlIG5vbi1vYmplY3QiKTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAodmFyIHAgaW4gc291cmNlKSB7CiAgICAgICAgICAgIGlmIChfaGFzKHNvdXJjZSwgcCkpIHsKICAgICAgICAgICAgICBvYmpbcF0gPSBzb3VyY2VbcF07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG9iajsKICAgICAgfTsKICAgICAgZXhwb3J0cy5zaHJpbmtCdWYgPSBmdW5jdGlvbihidWYsIHNpemUpIHsKICAgICAgICBpZiAoYnVmLmxlbmd0aCA9PT0gc2l6ZSkgewogICAgICAgICAgcmV0dXJuIGJ1ZjsKICAgICAgICB9CiAgICAgICAgaWYgKGJ1Zi5zdWJhcnJheSkgewogICAgICAgICAgcmV0dXJuIGJ1Zi5zdWJhcnJheSgwLCBzaXplKTsKICAgICAgICB9CiAgICAgICAgYnVmLmxlbmd0aCA9IHNpemU7CiAgICAgICAgcmV0dXJuIGJ1ZjsKICAgICAgfTsKICAgICAgdmFyIGZuVHlwZWQgPSB7CiAgICAgICAgYXJyYXlTZXQ6IGZ1bmN0aW9uKGRlc3QsIHNyYywgc3JjX29mZnMsIGxlbiwgZGVzdF9vZmZzKSB7CiAgICAgICAgICBpZiAoc3JjLnN1YmFycmF5ICYmIGRlc3Quc3ViYXJyYXkpIHsKICAgICAgICAgICAgZGVzdC5zZXQoc3JjLnN1YmFycmF5KHNyY19vZmZzLCBzcmNfb2ZmcyArIGxlbiksIGRlc3Rfb2Zmcyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgZGVzdFtkZXN0X29mZnMgKyBpXSA9IHNyY1tzcmNfb2ZmcyArIGldOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZmxhdHRlbkNodW5rczogZnVuY3Rpb24oY2h1bmtzKSB7CiAgICAgICAgICB2YXIgaSwgbCwgbGVuLCBwb3MsIGNodW5rLCByZXN1bHQ7CiAgICAgICAgICBsZW4gPSAwOwogICAgICAgICAgZm9yIChpID0gMCwgbCA9IGNodW5rcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgbGVuICs9IGNodW5rc1tpXS5sZW5ndGg7CiAgICAgICAgICB9CiAgICAgICAgICByZXN1bHQgPSBuZXcgVWludDhBcnJheShsZW4pOwogICAgICAgICAgcG9zID0gMDsKICAgICAgICAgIGZvciAoaSA9IDAsIGwgPSBjaHVua3MubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgIGNodW5rID0gY2h1bmtzW2ldOwogICAgICAgICAgICByZXN1bHQuc2V0KGNodW5rLCBwb3MpOwogICAgICAgICAgICBwb3MgKz0gY2h1bmsubGVuZ3RoOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHZhciBmblVudHlwZWQgPSB7CiAgICAgICAgYXJyYXlTZXQ6IGZ1bmN0aW9uKGRlc3QsIHNyYywgc3JjX29mZnMsIGxlbiwgZGVzdF9vZmZzKSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIGRlc3RbZGVzdF9vZmZzICsgaV0gPSBzcmNbc3JjX29mZnMgKyBpXTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGZsYXR0ZW5DaHVua3M6IGZ1bmN0aW9uKGNodW5rcykgewogICAgICAgICAgcmV0dXJuIFtdLmNvbmNhdC5hcHBseShbXSwgY2h1bmtzKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIGV4cG9ydHMuc2V0VHlwZWQgPSBmdW5jdGlvbihvbikgewogICAgICAgIGlmIChvbikgewogICAgICAgICAgZXhwb3J0cy5CdWY4ID0gVWludDhBcnJheTsKICAgICAgICAgIGV4cG9ydHMuQnVmMTYgPSBVaW50MTZBcnJheTsKICAgICAgICAgIGV4cG9ydHMuQnVmMzIgPSBJbnQzMkFycmF5OwogICAgICAgICAgZXhwb3J0cy5hc3NpZ24oZXhwb3J0cywgZm5UeXBlZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGV4cG9ydHMuQnVmOCA9IEFycmF5OwogICAgICAgICAgZXhwb3J0cy5CdWYxNiA9IEFycmF5OwogICAgICAgICAgZXhwb3J0cy5CdWYzMiA9IEFycmF5OwogICAgICAgICAgZXhwb3J0cy5hc3NpZ24oZXhwb3J0cywgZm5VbnR5cGVkKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIGV4cG9ydHMuc2V0VHlwZWQoVFlQRURfT0spOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvcGFrby9saWIvemxpYi90cmVlcy5qcwogIHZhciByZXF1aXJlX3RyZWVzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL3Bha28vbGliL3psaWIvdHJlZXMuanMiKGV4cG9ydHMpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciB1dGlscyA9IHJlcXVpcmVfY29tbW9uMigpOwogICAgICB2YXIgWl9GSVhFRCA9IDQ7CiAgICAgIHZhciBaX0JJTkFSWSA9IDA7CiAgICAgIHZhciBaX1RFWFQgPSAxOwogICAgICB2YXIgWl9VTktOT1dOID0gMjsKICAgICAgZnVuY3Rpb24gemVybyhidWYpIHsKICAgICAgICB2YXIgbGVuID0gYnVmLmxlbmd0aDsKICAgICAgICB3aGlsZSAoLS1sZW4gPj0gMCkgewogICAgICAgICAgYnVmW2xlbl0gPSAwOwogICAgICAgIH0KICAgICAgfQogICAgICB2YXIgU1RPUkVEX0JMT0NLID0gMDsKICAgICAgdmFyIFNUQVRJQ19UUkVFUyA9IDE7CiAgICAgIHZhciBEWU5fVFJFRVMgPSAyOwogICAgICB2YXIgTUlOX01BVENIID0gMzsKICAgICAgdmFyIE1BWF9NQVRDSCA9IDI1ODsKICAgICAgdmFyIExFTkdUSF9DT0RFUyA9IDI5OwogICAgICB2YXIgTElURVJBTFMgPSAyNTY7CiAgICAgIHZhciBMX0NPREVTID0gTElURVJBTFMgKyAxICsgTEVOR1RIX0NPREVTOwogICAgICB2YXIgRF9DT0RFUyA9IDMwOwogICAgICB2YXIgQkxfQ09ERVMgPSAxOTsKICAgICAgdmFyIEhFQVBfU0laRSA9IDIgKiBMX0NPREVTICsgMTsKICAgICAgdmFyIE1BWF9CSVRTID0gMTU7CiAgICAgIHZhciBCdWZfc2l6ZSA9IDE2OwogICAgICB2YXIgTUFYX0JMX0JJVFMgPSA3OwogICAgICB2YXIgRU5EX0JMT0NLID0gMjU2OwogICAgICB2YXIgUkVQXzNfNiA9IDE2OwogICAgICB2YXIgUkVQWl8zXzEwID0gMTc7CiAgICAgIHZhciBSRVBaXzExXzEzOCA9IDE4OwogICAgICB2YXIgZXh0cmFfbGJpdHMgPSBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMSwgMSwgMSwgMSwgMiwgMiwgMiwgMiwgMywgMywgMywgMywgNCwgNCwgNCwgNCwgNSwgNSwgNSwgNSwgMF07CiAgICAgIHZhciBleHRyYV9kYml0cyA9IFswLCAwLCAwLCAwLCAxLCAxLCAyLCAyLCAzLCAzLCA0LCA0LCA1LCA1LCA2LCA2LCA3LCA3LCA4LCA4LCA5LCA5LCAxMCwgMTAsIDExLCAxMSwgMTIsIDEyLCAxMywgMTNdOwogICAgICB2YXIgZXh0cmFfYmxiaXRzID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDIsIDMsIDddOwogICAgICB2YXIgYmxfb3JkZXIgPSBbMTYsIDE3LCAxOCwgMCwgOCwgNywgOSwgNiwgMTAsIDUsIDExLCA0LCAxMiwgMywgMTMsIDIsIDE0LCAxLCAxNV07CiAgICAgIHZhciBESVNUX0NPREVfTEVOID0gNTEyOwogICAgICB2YXIgc3RhdGljX2x0cmVlID0gbmV3IEFycmF5KChMX0NPREVTICsgMikgKiAyKTsKICAgICAgemVybyhzdGF0aWNfbHRyZWUpOwogICAgICB2YXIgc3RhdGljX2R0cmVlID0gbmV3IEFycmF5KERfQ09ERVMgKiAyKTsKICAgICAgemVybyhzdGF0aWNfZHRyZWUpOwogICAgICB2YXIgX2Rpc3RfY29kZSA9IG5ldyBBcnJheShESVNUX0NPREVfTEVOKTsKICAgICAgemVybyhfZGlzdF9jb2RlKTsKICAgICAgdmFyIF9sZW5ndGhfY29kZSA9IG5ldyBBcnJheShNQVhfTUFUQ0ggLSBNSU5fTUFUQ0ggKyAxKTsKICAgICAgemVybyhfbGVuZ3RoX2NvZGUpOwogICAgICB2YXIgYmFzZV9sZW5ndGggPSBuZXcgQXJyYXkoTEVOR1RIX0NPREVTKTsKICAgICAgemVybyhiYXNlX2xlbmd0aCk7CiAgICAgIHZhciBiYXNlX2Rpc3QgPSBuZXcgQXJyYXkoRF9DT0RFUyk7CiAgICAgIHplcm8oYmFzZV9kaXN0KTsKICAgICAgZnVuY3Rpb24gU3RhdGljVHJlZURlc2Moc3RhdGljX3RyZWUsIGV4dHJhX2JpdHMsIGV4dHJhX2Jhc2UsIGVsZW1zLCBtYXhfbGVuZ3RoKSB7CiAgICAgICAgdGhpcy5zdGF0aWNfdHJlZSA9IHN0YXRpY190cmVlOwogICAgICAgIHRoaXMuZXh0cmFfYml0cyA9IGV4dHJhX2JpdHM7CiAgICAgICAgdGhpcy5leHRyYV9iYXNlID0gZXh0cmFfYmFzZTsKICAgICAgICB0aGlzLmVsZW1zID0gZWxlbXM7CiAgICAgICAgdGhpcy5tYXhfbGVuZ3RoID0gbWF4X2xlbmd0aDsKICAgICAgICB0aGlzLmhhc19zdHJlZSA9IHN0YXRpY190cmVlICYmIHN0YXRpY190cmVlLmxlbmd0aDsKICAgICAgfQogICAgICB2YXIgc3RhdGljX2xfZGVzYzsKICAgICAgdmFyIHN0YXRpY19kX2Rlc2M7CiAgICAgIHZhciBzdGF0aWNfYmxfZGVzYzsKICAgICAgZnVuY3Rpb24gVHJlZURlc2MoZHluX3RyZWUsIHN0YXRfZGVzYykgewogICAgICAgIHRoaXMuZHluX3RyZWUgPSBkeW5fdHJlZTsKICAgICAgICB0aGlzLm1heF9jb2RlID0gMDsKICAgICAgICB0aGlzLnN0YXRfZGVzYyA9IHN0YXRfZGVzYzsKICAgICAgfQogICAgICBmdW5jdGlvbiBkX2NvZGUoZGlzdCkgewogICAgICAgIHJldHVybiBkaXN0IDwgMjU2ID8gX2Rpc3RfY29kZVtkaXN0XSA6IF9kaXN0X2NvZGVbMjU2ICsgKGRpc3QgPj4+IDcpXTsKICAgICAgfQogICAgICBmdW5jdGlvbiBwdXRfc2hvcnQocywgdykgewogICAgICAgIHMucGVuZGluZ19idWZbcy5wZW5kaW5nKytdID0gdyAmIDI1NTsKICAgICAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9IHcgPj4+IDggJiAyNTU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gc2VuZF9iaXRzKHMsIHZhbHVlLCBsZW5ndGgpIHsKICAgICAgICBpZiAocy5iaV92YWxpZCA+IEJ1Zl9zaXplIC0gbGVuZ3RoKSB7CiAgICAgICAgICBzLmJpX2J1ZiB8PSB2YWx1ZSA8PCBzLmJpX3ZhbGlkICYgNjU1MzU7CiAgICAgICAgICBwdXRfc2hvcnQocywgcy5iaV9idWYpOwogICAgICAgICAgcy5iaV9idWYgPSB2YWx1ZSA+PiBCdWZfc2l6ZSAtIHMuYmlfdmFsaWQ7CiAgICAgICAgICBzLmJpX3ZhbGlkICs9IGxlbmd0aCAtIEJ1Zl9zaXplOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzLmJpX2J1ZiB8PSB2YWx1ZSA8PCBzLmJpX3ZhbGlkICYgNjU1MzU7CiAgICAgICAgICBzLmJpX3ZhbGlkICs9IGxlbmd0aDsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gc2VuZF9jb2RlKHMsIGMsIHRyZWUpIHsKICAgICAgICBzZW5kX2JpdHMocywgdHJlZVtjICogMl0sIHRyZWVbYyAqIDIgKyAxXSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYmlfcmV2ZXJzZShjb2RlLCBsZW4pIHsKICAgICAgICB2YXIgcmVzID0gMDsKICAgICAgICBkbyB7CiAgICAgICAgICByZXMgfD0gY29kZSAmIDE7CiAgICAgICAgICBjb2RlID4+Pj0gMTsKICAgICAgICAgIHJlcyA8PD0gMTsKICAgICAgICB9IHdoaWxlICgtLWxlbiA+IDApOwogICAgICAgIHJldHVybiByZXMgPj4+IDE7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYmlfZmx1c2gocykgewogICAgICAgIGlmIChzLmJpX3ZhbGlkID09PSAxNikgewogICAgICAgICAgcHV0X3Nob3J0KHMsIHMuYmlfYnVmKTsKICAgICAgICAgIHMuYmlfYnVmID0gMDsKICAgICAgICAgIHMuYmlfdmFsaWQgPSAwOwogICAgICAgIH0gZWxzZSBpZiAocy5iaV92YWxpZCA+PSA4KSB7CiAgICAgICAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9IHMuYmlfYnVmICYgMjU1OwogICAgICAgICAgcy5iaV9idWYgPj49IDg7CiAgICAgICAgICBzLmJpX3ZhbGlkIC09IDg7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGdlbl9iaXRsZW4ocywgZGVzYykgewogICAgICAgIHZhciB0cmVlID0gZGVzYy5keW5fdHJlZTsKICAgICAgICB2YXIgbWF4X2NvZGUgPSBkZXNjLm1heF9jb2RlOwogICAgICAgIHZhciBzdHJlZSA9IGRlc2Muc3RhdF9kZXNjLnN0YXRpY190cmVlOwogICAgICAgIHZhciBoYXNfc3RyZWUgPSBkZXNjLnN0YXRfZGVzYy5oYXNfc3RyZWU7CiAgICAgICAgdmFyIGV4dHJhID0gZGVzYy5zdGF0X2Rlc2MuZXh0cmFfYml0czsKICAgICAgICB2YXIgYmFzZSA9IGRlc2Muc3RhdF9kZXNjLmV4dHJhX2Jhc2U7CiAgICAgICAgdmFyIG1heF9sZW5ndGggPSBkZXNjLnN0YXRfZGVzYy5tYXhfbGVuZ3RoOwogICAgICAgIHZhciBoOwogICAgICAgIHZhciBuLCBtOwogICAgICAgIHZhciBiaXRzOwogICAgICAgIHZhciB4Yml0czsKICAgICAgICB2YXIgZjsKICAgICAgICB2YXIgb3ZlcmZsb3cgPSAwOwogICAgICAgIGZvciAoYml0cyA9IDA7IGJpdHMgPD0gTUFYX0JJVFM7IGJpdHMrKykgewogICAgICAgICAgcy5ibF9jb3VudFtiaXRzXSA9IDA7CiAgICAgICAgfQogICAgICAgIHRyZWVbcy5oZWFwW3MuaGVhcF9tYXhdICogMiArIDFdID0gMDsKICAgICAgICBmb3IgKGggPSBzLmhlYXBfbWF4ICsgMTsgaCA8IEhFQVBfU0laRTsgaCsrKSB7CiAgICAgICAgICBuID0gcy5oZWFwW2hdOwogICAgICAgICAgYml0cyA9IHRyZWVbdHJlZVtuICogMiArIDFdICogMiArIDFdICsgMTsKICAgICAgICAgIGlmIChiaXRzID4gbWF4X2xlbmd0aCkgewogICAgICAgICAgICBiaXRzID0gbWF4X2xlbmd0aDsKICAgICAgICAgICAgb3ZlcmZsb3crKzsKICAgICAgICAgIH0KICAgICAgICAgIHRyZWVbbiAqIDIgKyAxXSA9IGJpdHM7CiAgICAgICAgICBpZiAobiA+IG1heF9jb2RlKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgcy5ibF9jb3VudFtiaXRzXSsrOwogICAgICAgICAgeGJpdHMgPSAwOwogICAgICAgICAgaWYgKG4gPj0gYmFzZSkgewogICAgICAgICAgICB4Yml0cyA9IGV4dHJhW24gLSBiYXNlXTsKICAgICAgICAgIH0KICAgICAgICAgIGYgPSB0cmVlW24gKiAyXTsKICAgICAgICAgIHMub3B0X2xlbiArPSBmICogKGJpdHMgKyB4Yml0cyk7CiAgICAgICAgICBpZiAoaGFzX3N0cmVlKSB7CiAgICAgICAgICAgIHMuc3RhdGljX2xlbiArPSBmICogKHN0cmVlW24gKiAyICsgMV0gKyB4Yml0cyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChvdmVyZmxvdyA9PT0gMCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBkbyB7CiAgICAgICAgICBiaXRzID0gbWF4X2xlbmd0aCAtIDE7CiAgICAgICAgICB3aGlsZSAocy5ibF9jb3VudFtiaXRzXSA9PT0gMCkgewogICAgICAgICAgICBiaXRzLS07CiAgICAgICAgICB9CiAgICAgICAgICBzLmJsX2NvdW50W2JpdHNdLS07CiAgICAgICAgICBzLmJsX2NvdW50W2JpdHMgKyAxXSArPSAyOwogICAgICAgICAgcy5ibF9jb3VudFttYXhfbGVuZ3RoXS0tOwogICAgICAgICAgb3ZlcmZsb3cgLT0gMjsKICAgICAgICB9IHdoaWxlIChvdmVyZmxvdyA+IDApOwogICAgICAgIGZvciAoYml0cyA9IG1heF9sZW5ndGg7IGJpdHMgIT09IDA7IGJpdHMtLSkgewogICAgICAgICAgbiA9IHMuYmxfY291bnRbYml0c107CiAgICAgICAgICB3aGlsZSAobiAhPT0gMCkgewogICAgICAgICAgICBtID0gcy5oZWFwWy0taF07CiAgICAgICAgICAgIGlmIChtID4gbWF4X2NvZGUpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodHJlZVttICogMiArIDFdICE9PSBiaXRzKSB7CiAgICAgICAgICAgICAgcy5vcHRfbGVuICs9IChiaXRzIC0gdHJlZVttICogMiArIDFdKSAqIHRyZWVbbSAqIDJdOwogICAgICAgICAgICAgIHRyZWVbbSAqIDIgKyAxXSA9IGJpdHM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbi0tOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBnZW5fY29kZXModHJlZSwgbWF4X2NvZGUsIGJsX2NvdW50KSB7CiAgICAgICAgdmFyIG5leHRfY29kZSA9IG5ldyBBcnJheShNQVhfQklUUyArIDEpOwogICAgICAgIHZhciBjb2RlID0gMDsKICAgICAgICB2YXIgYml0czsKICAgICAgICB2YXIgbjsKICAgICAgICBmb3IgKGJpdHMgPSAxOyBiaXRzIDw9IE1BWF9CSVRTOyBiaXRzKyspIHsKICAgICAgICAgIG5leHRfY29kZVtiaXRzXSA9IGNvZGUgPSBjb2RlICsgYmxfY291bnRbYml0cyAtIDFdIDw8IDE7CiAgICAgICAgfQogICAgICAgIGZvciAobiA9IDA7IG4gPD0gbWF4X2NvZGU7IG4rKykgewogICAgICAgICAgdmFyIGxlbiA9IHRyZWVbbiAqIDIgKyAxXTsKICAgICAgICAgIGlmIChsZW4gPT09IDApIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICB0cmVlW24gKiAyXSA9IGJpX3JldmVyc2UobmV4dF9jb2RlW2xlbl0rKywgbGVuKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gdHJfc3RhdGljX2luaXQoKSB7CiAgICAgICAgdmFyIG47CiAgICAgICAgdmFyIGJpdHM7CiAgICAgICAgdmFyIGxlbmd0aDsKICAgICAgICB2YXIgY29kZTsKICAgICAgICB2YXIgZGlzdDsKICAgICAgICB2YXIgYmxfY291bnQgPSBuZXcgQXJyYXkoTUFYX0JJVFMgKyAxKTsKICAgICAgICBsZW5ndGggPSAwOwogICAgICAgIGZvciAoY29kZSA9IDA7IGNvZGUgPCBMRU5HVEhfQ09ERVMgLSAxOyBjb2RlKyspIHsKICAgICAgICAgIGJhc2VfbGVuZ3RoW2NvZGVdID0gbGVuZ3RoOwogICAgICAgICAgZm9yIChuID0gMDsgbiA8IDEgPDwgZXh0cmFfbGJpdHNbY29kZV07IG4rKykgewogICAgICAgICAgICBfbGVuZ3RoX2NvZGVbbGVuZ3RoKytdID0gY29kZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX2xlbmd0aF9jb2RlW2xlbmd0aCAtIDFdID0gY29kZTsKICAgICAgICBkaXN0ID0gMDsKICAgICAgICBmb3IgKGNvZGUgPSAwOyBjb2RlIDwgMTY7IGNvZGUrKykgewogICAgICAgICAgYmFzZV9kaXN0W2NvZGVdID0gZGlzdDsKICAgICAgICAgIGZvciAobiA9IDA7IG4gPCAxIDw8IGV4dHJhX2RiaXRzW2NvZGVdOyBuKyspIHsKICAgICAgICAgICAgX2Rpc3RfY29kZVtkaXN0KytdID0gY29kZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZGlzdCA+Pj0gNzsKICAgICAgICBmb3IgKDsgY29kZSA8IERfQ09ERVM7IGNvZGUrKykgewogICAgICAgICAgYmFzZV9kaXN0W2NvZGVdID0gZGlzdCA8PCA3OwogICAgICAgICAgZm9yIChuID0gMDsgbiA8IDEgPDwgZXh0cmFfZGJpdHNbY29kZV0gLSA3OyBuKyspIHsKICAgICAgICAgICAgX2Rpc3RfY29kZVsyNTYgKyBkaXN0KytdID0gY29kZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZm9yIChiaXRzID0gMDsgYml0cyA8PSBNQVhfQklUUzsgYml0cysrKSB7CiAgICAgICAgICBibF9jb3VudFtiaXRzXSA9IDA7CiAgICAgICAgfQogICAgICAgIG4gPSAwOwogICAgICAgIHdoaWxlIChuIDw9IDE0MykgewogICAgICAgICAgc3RhdGljX2x0cmVlW24gKiAyICsgMV0gPSA4OwogICAgICAgICAgbisrOwogICAgICAgICAgYmxfY291bnRbOF0rKzsKICAgICAgICB9CiAgICAgICAgd2hpbGUgKG4gPD0gMjU1KSB7CiAgICAgICAgICBzdGF0aWNfbHRyZWVbbiAqIDIgKyAxXSA9IDk7CiAgICAgICAgICBuKys7CiAgICAgICAgICBibF9jb3VudFs5XSsrOwogICAgICAgIH0KICAgICAgICB3aGlsZSAobiA8PSAyNzkpIHsKICAgICAgICAgIHN0YXRpY19sdHJlZVtuICogMiArIDFdID0gNzsKICAgICAgICAgIG4rKzsKICAgICAgICAgIGJsX2NvdW50WzddKys7CiAgICAgICAgfQogICAgICAgIHdoaWxlIChuIDw9IDI4NykgewogICAgICAgICAgc3RhdGljX2x0cmVlW24gKiAyICsgMV0gPSA4OwogICAgICAgICAgbisrOwogICAgICAgICAgYmxfY291bnRbOF0rKzsKICAgICAgICB9CiAgICAgICAgZ2VuX2NvZGVzKHN0YXRpY19sdHJlZSwgTF9DT0RFUyArIDEsIGJsX2NvdW50KTsKICAgICAgICBmb3IgKG4gPSAwOyBuIDwgRF9DT0RFUzsgbisrKSB7CiAgICAgICAgICBzdGF0aWNfZHRyZWVbbiAqIDIgKyAxXSA9IDU7CiAgICAgICAgICBzdGF0aWNfZHRyZWVbbiAqIDJdID0gYmlfcmV2ZXJzZShuLCA1KTsKICAgICAgICB9CiAgICAgICAgc3RhdGljX2xfZGVzYyA9IG5ldyBTdGF0aWNUcmVlRGVzYyhzdGF0aWNfbHRyZWUsIGV4dHJhX2xiaXRzLCBMSVRFUkFMUyArIDEsIExfQ09ERVMsIE1BWF9CSVRTKTsKICAgICAgICBzdGF0aWNfZF9kZXNjID0gbmV3IFN0YXRpY1RyZWVEZXNjKHN0YXRpY19kdHJlZSwgZXh0cmFfZGJpdHMsIDAsIERfQ09ERVMsIE1BWF9CSVRTKTsKICAgICAgICBzdGF0aWNfYmxfZGVzYyA9IG5ldyBTdGF0aWNUcmVlRGVzYyhuZXcgQXJyYXkoMCksIGV4dHJhX2JsYml0cywgMCwgQkxfQ09ERVMsIE1BWF9CTF9CSVRTKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBpbml0X2Jsb2NrKHMpIHsKICAgICAgICB2YXIgbjsKICAgICAgICBmb3IgKG4gPSAwOyBuIDwgTF9DT0RFUzsgbisrKSB7CiAgICAgICAgICBzLmR5bl9sdHJlZVtuICogMl0gPSAwOwogICAgICAgIH0KICAgICAgICBmb3IgKG4gPSAwOyBuIDwgRF9DT0RFUzsgbisrKSB7CiAgICAgICAgICBzLmR5bl9kdHJlZVtuICogMl0gPSAwOwogICAgICAgIH0KICAgICAgICBmb3IgKG4gPSAwOyBuIDwgQkxfQ09ERVM7IG4rKykgewogICAgICAgICAgcy5ibF90cmVlW24gKiAyXSA9IDA7CiAgICAgICAgfQogICAgICAgIHMuZHluX2x0cmVlW0VORF9CTE9DSyAqIDJdID0gMTsKICAgICAgICBzLm9wdF9sZW4gPSBzLnN0YXRpY19sZW4gPSAwOwogICAgICAgIHMubGFzdF9saXQgPSBzLm1hdGNoZXMgPSAwOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGJpX3dpbmR1cChzKSB7CiAgICAgICAgaWYgKHMuYmlfdmFsaWQgPiA4KSB7CiAgICAgICAgICBwdXRfc2hvcnQocywgcy5iaV9idWYpOwogICAgICAgIH0gZWxzZSBpZiAocy5iaV92YWxpZCA+IDApIHsKICAgICAgICAgIHMucGVuZGluZ19idWZbcy5wZW5kaW5nKytdID0gcy5iaV9idWY7CiAgICAgICAgfQogICAgICAgIHMuYmlfYnVmID0gMDsKICAgICAgICBzLmJpX3ZhbGlkID0gMDsKICAgICAgfQogICAgICBmdW5jdGlvbiBjb3B5X2Jsb2NrKHMsIGJ1ZiwgbGVuLCBoZWFkZXIpIHsKICAgICAgICBiaV93aW5kdXAocyk7CiAgICAgICAgaWYgKGhlYWRlcikgewogICAgICAgICAgcHV0X3Nob3J0KHMsIGxlbik7CiAgICAgICAgICBwdXRfc2hvcnQocywgfmxlbik7CiAgICAgICAgfQogICAgICAgIHV0aWxzLmFycmF5U2V0KHMucGVuZGluZ19idWYsIHMud2luZG93LCBidWYsIGxlbiwgcy5wZW5kaW5nKTsKICAgICAgICBzLnBlbmRpbmcgKz0gbGVuOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHNtYWxsZXIodHJlZSwgbiwgbSwgZGVwdGgpIHsKICAgICAgICB2YXIgX24yID0gbiAqIDI7CiAgICAgICAgdmFyIF9tMiA9IG0gKiAyOwogICAgICAgIHJldHVybiB0cmVlW19uMl0gPCB0cmVlW19tMl0gfHwgdHJlZVtfbjJdID09PSB0cmVlW19tMl0gJiYgZGVwdGhbbl0gPD0gZGVwdGhbbV07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcHFkb3duaGVhcChzLCB0cmVlLCBrKSB7CiAgICAgICAgdmFyIHYgPSBzLmhlYXBba107CiAgICAgICAgdmFyIGogPSBrIDw8IDE7CiAgICAgICAgd2hpbGUgKGogPD0gcy5oZWFwX2xlbikgewogICAgICAgICAgaWYgKGogPCBzLmhlYXBfbGVuICYmIHNtYWxsZXIodHJlZSwgcy5oZWFwW2ogKyAxXSwgcy5oZWFwW2pdLCBzLmRlcHRoKSkgewogICAgICAgICAgICBqKys7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc21hbGxlcih0cmVlLCB2LCBzLmhlYXBbal0sIHMuZGVwdGgpKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgcy5oZWFwW2tdID0gcy5oZWFwW2pdOwogICAgICAgICAgayA9IGo7CiAgICAgICAgICBqIDw8PSAxOwogICAgICAgIH0KICAgICAgICBzLmhlYXBba10gPSB2OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGNvbXByZXNzX2Jsb2NrKHMsIGx0cmVlLCBkdHJlZSkgewogICAgICAgIHZhciBkaXN0OwogICAgICAgIHZhciBsYzsKICAgICAgICB2YXIgbHggPSAwOwogICAgICAgIHZhciBjb2RlOwogICAgICAgIHZhciBleHRyYTsKICAgICAgICBpZiAocy5sYXN0X2xpdCAhPT0gMCkgewogICAgICAgICAgZG8gewogICAgICAgICAgICBkaXN0ID0gcy5wZW5kaW5nX2J1ZltzLmRfYnVmICsgbHggKiAyXSA8PCA4IHwgcy5wZW5kaW5nX2J1ZltzLmRfYnVmICsgbHggKiAyICsgMV07CiAgICAgICAgICAgIGxjID0gcy5wZW5kaW5nX2J1ZltzLmxfYnVmICsgbHhdOwogICAgICAgICAgICBseCsrOwogICAgICAgICAgICBpZiAoZGlzdCA9PT0gMCkgewogICAgICAgICAgICAgIHNlbmRfY29kZShzLCBsYywgbHRyZWUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGNvZGUgPSBfbGVuZ3RoX2NvZGVbbGNdOwogICAgICAgICAgICAgIHNlbmRfY29kZShzLCBjb2RlICsgTElURVJBTFMgKyAxLCBsdHJlZSk7CiAgICAgICAgICAgICAgZXh0cmEgPSBleHRyYV9sYml0c1tjb2RlXTsKICAgICAgICAgICAgICBpZiAoZXh0cmEgIT09IDApIHsKICAgICAgICAgICAgICAgIGxjIC09IGJhc2VfbGVuZ3RoW2NvZGVdOwogICAgICAgICAgICAgICAgc2VuZF9iaXRzKHMsIGxjLCBleHRyYSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGRpc3QtLTsKICAgICAgICAgICAgICBjb2RlID0gZF9jb2RlKGRpc3QpOwogICAgICAgICAgICAgIHNlbmRfY29kZShzLCBjb2RlLCBkdHJlZSk7CiAgICAgICAgICAgICAgZXh0cmEgPSBleHRyYV9kYml0c1tjb2RlXTsKICAgICAgICAgICAgICBpZiAoZXh0cmEgIT09IDApIHsKICAgICAgICAgICAgICAgIGRpc3QgLT0gYmFzZV9kaXN0W2NvZGVdOwogICAgICAgICAgICAgICAgc2VuZF9iaXRzKHMsIGRpc3QsIGV4dHJhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gd2hpbGUgKGx4IDwgcy5sYXN0X2xpdCk7CiAgICAgICAgfQogICAgICAgIHNlbmRfY29kZShzLCBFTkRfQkxPQ0ssIGx0cmVlKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBidWlsZF90cmVlKHMsIGRlc2MpIHsKICAgICAgICB2YXIgdHJlZSA9IGRlc2MuZHluX3RyZWU7CiAgICAgICAgdmFyIHN0cmVlID0gZGVzYy5zdGF0X2Rlc2Muc3RhdGljX3RyZWU7CiAgICAgICAgdmFyIGhhc19zdHJlZSA9IGRlc2Muc3RhdF9kZXNjLmhhc19zdHJlZTsKICAgICAgICB2YXIgZWxlbXMgPSBkZXNjLnN0YXRfZGVzYy5lbGVtczsKICAgICAgICB2YXIgbiwgbTsKICAgICAgICB2YXIgbWF4X2NvZGUgPSAtMTsKICAgICAgICB2YXIgbm9kZTsKICAgICAgICBzLmhlYXBfbGVuID0gMDsKICAgICAgICBzLmhlYXBfbWF4ID0gSEVBUF9TSVpFOwogICAgICAgIGZvciAobiA9IDA7IG4gPCBlbGVtczsgbisrKSB7CiAgICAgICAgICBpZiAodHJlZVtuICogMl0gIT09IDApIHsKICAgICAgICAgICAgcy5oZWFwWysrcy5oZWFwX2xlbl0gPSBtYXhfY29kZSA9IG47CiAgICAgICAgICAgIHMuZGVwdGhbbl0gPSAwOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdHJlZVtuICogMiArIDFdID0gMDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgd2hpbGUgKHMuaGVhcF9sZW4gPCAyKSB7CiAgICAgICAgICBub2RlID0gcy5oZWFwWysrcy5oZWFwX2xlbl0gPSBtYXhfY29kZSA8IDIgPyArK21heF9jb2RlIDogMDsKICAgICAgICAgIHRyZWVbbm9kZSAqIDJdID0gMTsKICAgICAgICAgIHMuZGVwdGhbbm9kZV0gPSAwOwogICAgICAgICAgcy5vcHRfbGVuLS07CiAgICAgICAgICBpZiAoaGFzX3N0cmVlKSB7CiAgICAgICAgICAgIHMuc3RhdGljX2xlbiAtPSBzdHJlZVtub2RlICogMiArIDFdOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBkZXNjLm1heF9jb2RlID0gbWF4X2NvZGU7CiAgICAgICAgZm9yIChuID0gcy5oZWFwX2xlbiA+PiAxOyBuID49IDE7IG4tLSkgewogICAgICAgICAgcHFkb3duaGVhcChzLCB0cmVlLCBuKTsKICAgICAgICB9CiAgICAgICAgbm9kZSA9IGVsZW1zOwogICAgICAgIGRvIHsKICAgICAgICAgIG4gPSBzLmhlYXBbMV07CiAgICAgICAgICBzLmhlYXBbMV0gPSBzLmhlYXBbcy5oZWFwX2xlbi0tXTsKICAgICAgICAgIHBxZG93bmhlYXAocywgdHJlZSwgMSk7CiAgICAgICAgICBtID0gcy5oZWFwWzFdOwogICAgICAgICAgcy5oZWFwWy0tcy5oZWFwX21heF0gPSBuOwogICAgICAgICAgcy5oZWFwWy0tcy5oZWFwX21heF0gPSBtOwogICAgICAgICAgdHJlZVtub2RlICogMl0gPSB0cmVlW24gKiAyXSArIHRyZWVbbSAqIDJdOwogICAgICAgICAgcy5kZXB0aFtub2RlXSA9IChzLmRlcHRoW25dID49IHMuZGVwdGhbbV0gPyBzLmRlcHRoW25dIDogcy5kZXB0aFttXSkgKyAxOwogICAgICAgICAgdHJlZVtuICogMiArIDFdID0gdHJlZVttICogMiArIDFdID0gbm9kZTsKICAgICAgICAgIHMuaGVhcFsxXSA9IG5vZGUrKzsKICAgICAgICAgIHBxZG93bmhlYXAocywgdHJlZSwgMSk7CiAgICAgICAgfSB3aGlsZSAocy5oZWFwX2xlbiA+PSAyKTsKICAgICAgICBzLmhlYXBbLS1zLmhlYXBfbWF4XSA9IHMuaGVhcFsxXTsKICAgICAgICBnZW5fYml0bGVuKHMsIGRlc2MpOwogICAgICAgIGdlbl9jb2Rlcyh0cmVlLCBtYXhfY29kZSwgcy5ibF9jb3VudCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gc2Nhbl90cmVlKHMsIHRyZWUsIG1heF9jb2RlKSB7CiAgICAgICAgdmFyIG47CiAgICAgICAgdmFyIHByZXZsZW4gPSAtMTsKICAgICAgICB2YXIgY3VybGVuOwogICAgICAgIHZhciBuZXh0bGVuID0gdHJlZVswICogMiArIDFdOwogICAgICAgIHZhciBjb3VudCA9IDA7CiAgICAgICAgdmFyIG1heF9jb3VudCA9IDc7CiAgICAgICAgdmFyIG1pbl9jb3VudCA9IDQ7CiAgICAgICAgaWYgKG5leHRsZW4gPT09IDApIHsKICAgICAgICAgIG1heF9jb3VudCA9IDEzODsKICAgICAgICAgIG1pbl9jb3VudCA9IDM7CiAgICAgICAgfQogICAgICAgIHRyZWVbKG1heF9jb2RlICsgMSkgKiAyICsgMV0gPSA2NTUzNTsKICAgICAgICBmb3IgKG4gPSAwOyBuIDw9IG1heF9jb2RlOyBuKyspIHsKICAgICAgICAgIGN1cmxlbiA9IG5leHRsZW47CiAgICAgICAgICBuZXh0bGVuID0gdHJlZVsobiArIDEpICogMiArIDFdOwogICAgICAgICAgaWYgKCsrY291bnQgPCBtYXhfY291bnQgJiYgY3VybGVuID09PSBuZXh0bGVuKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfSBlbHNlIGlmIChjb3VudCA8IG1pbl9jb3VudCkgewogICAgICAgICAgICBzLmJsX3RyZWVbY3VybGVuICogMl0gKz0gY291bnQ7CiAgICAgICAgICB9IGVsc2UgaWYgKGN1cmxlbiAhPT0gMCkgewogICAgICAgICAgICBpZiAoY3VybGVuICE9PSBwcmV2bGVuKSB7CiAgICAgICAgICAgICAgcy5ibF90cmVlW2N1cmxlbiAqIDJdKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcy5ibF90cmVlW1JFUF8zXzYgKiAyXSsrOwogICAgICAgICAgfSBlbHNlIGlmIChjb3VudCA8PSAxMCkgewogICAgICAgICAgICBzLmJsX3RyZWVbUkVQWl8zXzEwICogMl0rKzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHMuYmxfdHJlZVtSRVBaXzExXzEzOCAqIDJdKys7CiAgICAgICAgICB9CiAgICAgICAgICBjb3VudCA9IDA7CiAgICAgICAgICBwcmV2bGVuID0gY3VybGVuOwogICAgICAgICAgaWYgKG5leHRsZW4gPT09IDApIHsKICAgICAgICAgICAgbWF4X2NvdW50ID0gMTM4OwogICAgICAgICAgICBtaW5fY291bnQgPSAzOwogICAgICAgICAgfSBlbHNlIGlmIChjdXJsZW4gPT09IG5leHRsZW4pIHsKICAgICAgICAgICAgbWF4X2NvdW50ID0gNjsKICAgICAgICAgICAgbWluX2NvdW50ID0gMzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1heF9jb3VudCA9IDc7CiAgICAgICAgICAgIG1pbl9jb3VudCA9IDQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIHNlbmRfdHJlZShzLCB0cmVlLCBtYXhfY29kZSkgewogICAgICAgIHZhciBuOwogICAgICAgIHZhciBwcmV2bGVuID0gLTE7CiAgICAgICAgdmFyIGN1cmxlbjsKICAgICAgICB2YXIgbmV4dGxlbiA9IHRyZWVbMCAqIDIgKyAxXTsKICAgICAgICB2YXIgY291bnQgPSAwOwogICAgICAgIHZhciBtYXhfY291bnQgPSA3OwogICAgICAgIHZhciBtaW5fY291bnQgPSA0OwogICAgICAgIGlmIChuZXh0bGVuID09PSAwKSB7CiAgICAgICAgICBtYXhfY291bnQgPSAxMzg7CiAgICAgICAgICBtaW5fY291bnQgPSAzOwogICAgICAgIH0KICAgICAgICBmb3IgKG4gPSAwOyBuIDw9IG1heF9jb2RlOyBuKyspIHsKICAgICAgICAgIGN1cmxlbiA9IG5leHRsZW47CiAgICAgICAgICBuZXh0bGVuID0gdHJlZVsobiArIDEpICogMiArIDFdOwogICAgICAgICAgaWYgKCsrY291bnQgPCBtYXhfY291bnQgJiYgY3VybGVuID09PSBuZXh0bGVuKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfSBlbHNlIGlmIChjb3VudCA8IG1pbl9jb3VudCkgewogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgc2VuZF9jb2RlKHMsIGN1cmxlbiwgcy5ibF90cmVlKTsKICAgICAgICAgICAgfSB3aGlsZSAoLS1jb3VudCAhPT0gMCk7CiAgICAgICAgICB9IGVsc2UgaWYgKGN1cmxlbiAhPT0gMCkgewogICAgICAgICAgICBpZiAoY3VybGVuICE9PSBwcmV2bGVuKSB7CiAgICAgICAgICAgICAgc2VuZF9jb2RlKHMsIGN1cmxlbiwgcy5ibF90cmVlKTsKICAgICAgICAgICAgICBjb3VudC0tOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbmRfY29kZShzLCBSRVBfM182LCBzLmJsX3RyZWUpOwogICAgICAgICAgICBzZW5kX2JpdHMocywgY291bnQgLSAzLCAyKTsKICAgICAgICAgIH0gZWxzZSBpZiAoY291bnQgPD0gMTApIHsKICAgICAgICAgICAgc2VuZF9jb2RlKHMsIFJFUFpfM18xMCwgcy5ibF90cmVlKTsKICAgICAgICAgICAgc2VuZF9iaXRzKHMsIGNvdW50IC0gMywgMyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzZW5kX2NvZGUocywgUkVQWl8xMV8xMzgsIHMuYmxfdHJlZSk7CiAgICAgICAgICAgIHNlbmRfYml0cyhzLCBjb3VudCAtIDExLCA3KTsKICAgICAgICAgIH0KICAgICAgICAgIGNvdW50ID0gMDsKICAgICAgICAgIHByZXZsZW4gPSBjdXJsZW47CiAgICAgICAgICBpZiAobmV4dGxlbiA9PT0gMCkgewogICAgICAgICAgICBtYXhfY291bnQgPSAxMzg7CiAgICAgICAgICAgIG1pbl9jb3VudCA9IDM7CiAgICAgICAgICB9IGVsc2UgaWYgKGN1cmxlbiA9PT0gbmV4dGxlbikgewogICAgICAgICAgICBtYXhfY291bnQgPSA2OwogICAgICAgICAgICBtaW5fY291bnQgPSAzOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbWF4X2NvdW50ID0gNzsKICAgICAgICAgICAgbWluX2NvdW50ID0gNDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYnVpbGRfYmxfdHJlZShzKSB7CiAgICAgICAgdmFyIG1heF9ibGluZGV4OwogICAgICAgIHNjYW5fdHJlZShzLCBzLmR5bl9sdHJlZSwgcy5sX2Rlc2MubWF4X2NvZGUpOwogICAgICAgIHNjYW5fdHJlZShzLCBzLmR5bl9kdHJlZSwgcy5kX2Rlc2MubWF4X2NvZGUpOwogICAgICAgIGJ1aWxkX3RyZWUocywgcy5ibF9kZXNjKTsKICAgICAgICBmb3IgKG1heF9ibGluZGV4ID0gQkxfQ09ERVMgLSAxOyBtYXhfYmxpbmRleCA+PSAzOyBtYXhfYmxpbmRleC0tKSB7CiAgICAgICAgICBpZiAocy5ibF90cmVlW2JsX29yZGVyW21heF9ibGluZGV4XSAqIDIgKyAxXSAhPT0gMCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcy5vcHRfbGVuICs9IDMgKiAobWF4X2JsaW5kZXggKyAxKSArIDUgKyA1ICsgNDsKICAgICAgICByZXR1cm4gbWF4X2JsaW5kZXg7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gc2VuZF9hbGxfdHJlZXMocywgbGNvZGVzLCBkY29kZXMsIGJsY29kZXMpIHsKICAgICAgICB2YXIgcmFuazsKICAgICAgICBzZW5kX2JpdHMocywgbGNvZGVzIC0gMjU3LCA1KTsKICAgICAgICBzZW5kX2JpdHMocywgZGNvZGVzIC0gMSwgNSk7CiAgICAgICAgc2VuZF9iaXRzKHMsIGJsY29kZXMgLSA0LCA0KTsKICAgICAgICBmb3IgKHJhbmsgPSAwOyByYW5rIDwgYmxjb2RlczsgcmFuaysrKSB7CiAgICAgICAgICBzZW5kX2JpdHMocywgcy5ibF90cmVlW2JsX29yZGVyW3JhbmtdICogMiArIDFdLCAzKTsKICAgICAgICB9CiAgICAgICAgc2VuZF90cmVlKHMsIHMuZHluX2x0cmVlLCBsY29kZXMgLSAxKTsKICAgICAgICBzZW5kX3RyZWUocywgcy5keW5fZHRyZWUsIGRjb2RlcyAtIDEpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRldGVjdF9kYXRhX3R5cGUocykgewogICAgICAgIHZhciBibGFja19tYXNrID0gNDA5MzYyNDQ0NzsKICAgICAgICB2YXIgbjsKICAgICAgICBmb3IgKG4gPSAwOyBuIDw9IDMxOyBuKyssIGJsYWNrX21hc2sgPj4+PSAxKSB7CiAgICAgICAgICBpZiAoYmxhY2tfbWFzayAmIDEgJiYgcy5keW5fbHRyZWVbbiAqIDJdICE9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBaX0JJTkFSWTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHMuZHluX2x0cmVlWzkgKiAyXSAhPT0gMCB8fCBzLmR5bl9sdHJlZVsxMCAqIDJdICE9PSAwIHx8IHMuZHluX2x0cmVlWzEzICogMl0gIT09IDApIHsKICAgICAgICAgIHJldHVybiBaX1RFWFQ7CiAgICAgICAgfQogICAgICAgIGZvciAobiA9IDMyOyBuIDwgTElURVJBTFM7IG4rKykgewogICAgICAgICAgaWYgKHMuZHluX2x0cmVlW24gKiAyXSAhPT0gMCkgewogICAgICAgICAgICByZXR1cm4gWl9URVhUOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gWl9CSU5BUlk7CiAgICAgIH0KICAgICAgdmFyIHN0YXRpY19pbml0X2RvbmUgPSBmYWxzZTsKICAgICAgZnVuY3Rpb24gX3RyX2luaXQocykgewogICAgICAgIGlmICghc3RhdGljX2luaXRfZG9uZSkgewogICAgICAgICAgdHJfc3RhdGljX2luaXQoKTsKICAgICAgICAgIHN0YXRpY19pbml0X2RvbmUgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBzLmxfZGVzYyA9IG5ldyBUcmVlRGVzYyhzLmR5bl9sdHJlZSwgc3RhdGljX2xfZGVzYyk7CiAgICAgICAgcy5kX2Rlc2MgPSBuZXcgVHJlZURlc2Mocy5keW5fZHRyZWUsIHN0YXRpY19kX2Rlc2MpOwogICAgICAgIHMuYmxfZGVzYyA9IG5ldyBUcmVlRGVzYyhzLmJsX3RyZWUsIHN0YXRpY19ibF9kZXNjKTsKICAgICAgICBzLmJpX2J1ZiA9IDA7CiAgICAgICAgcy5iaV92YWxpZCA9IDA7CiAgICAgICAgaW5pdF9ibG9jayhzKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBfdHJfc3RvcmVkX2Jsb2NrKHMsIGJ1Ziwgc3RvcmVkX2xlbiwgbGFzdCkgewogICAgICAgIHNlbmRfYml0cyhzLCAoU1RPUkVEX0JMT0NLIDw8IDEpICsgKGxhc3QgPyAxIDogMCksIDMpOwogICAgICAgIGNvcHlfYmxvY2socywgYnVmLCBzdG9yZWRfbGVuLCB0cnVlKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBfdHJfYWxpZ24ocykgewogICAgICAgIHNlbmRfYml0cyhzLCBTVEFUSUNfVFJFRVMgPDwgMSwgMyk7CiAgICAgICAgc2VuZF9jb2RlKHMsIEVORF9CTE9DSywgc3RhdGljX2x0cmVlKTsKICAgICAgICBiaV9mbHVzaChzKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBfdHJfZmx1c2hfYmxvY2socywgYnVmLCBzdG9yZWRfbGVuLCBsYXN0KSB7CiAgICAgICAgdmFyIG9wdF9sZW5iLCBzdGF0aWNfbGVuYjsKICAgICAgICB2YXIgbWF4X2JsaW5kZXggPSAwOwogICAgICAgIGlmIChzLmxldmVsID4gMCkgewogICAgICAgICAgaWYgKHMuc3RybS5kYXRhX3R5cGUgPT09IFpfVU5LTk9XTikgewogICAgICAgICAgICBzLnN0cm0uZGF0YV90eXBlID0gZGV0ZWN0X2RhdGFfdHlwZShzKTsKICAgICAgICAgIH0KICAgICAgICAgIGJ1aWxkX3RyZWUocywgcy5sX2Rlc2MpOwogICAgICAgICAgYnVpbGRfdHJlZShzLCBzLmRfZGVzYyk7CiAgICAgICAgICBtYXhfYmxpbmRleCA9IGJ1aWxkX2JsX3RyZWUocyk7CiAgICAgICAgICBvcHRfbGVuYiA9IHMub3B0X2xlbiArIDMgKyA3ID4+PiAzOwogICAgICAgICAgc3RhdGljX2xlbmIgPSBzLnN0YXRpY19sZW4gKyAzICsgNyA+Pj4gMzsKICAgICAgICAgIGlmIChzdGF0aWNfbGVuYiA8PSBvcHRfbGVuYikgewogICAgICAgICAgICBvcHRfbGVuYiA9IHN0YXRpY19sZW5iOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBvcHRfbGVuYiA9IHN0YXRpY19sZW5iID0gc3RvcmVkX2xlbiArIDU7CiAgICAgICAgfQogICAgICAgIGlmIChzdG9yZWRfbGVuICsgNCA8PSBvcHRfbGVuYiAmJiBidWYgIT09IC0xKSB7CiAgICAgICAgICBfdHJfc3RvcmVkX2Jsb2NrKHMsIGJ1Ziwgc3RvcmVkX2xlbiwgbGFzdCk7CiAgICAgICAgfSBlbHNlIGlmIChzLnN0cmF0ZWd5ID09PSBaX0ZJWEVEIHx8IHN0YXRpY19sZW5iID09PSBvcHRfbGVuYikgewogICAgICAgICAgc2VuZF9iaXRzKHMsIChTVEFUSUNfVFJFRVMgPDwgMSkgKyAobGFzdCA/IDEgOiAwKSwgMyk7CiAgICAgICAgICBjb21wcmVzc19ibG9jayhzLCBzdGF0aWNfbHRyZWUsIHN0YXRpY19kdHJlZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNlbmRfYml0cyhzLCAoRFlOX1RSRUVTIDw8IDEpICsgKGxhc3QgPyAxIDogMCksIDMpOwogICAgICAgICAgc2VuZF9hbGxfdHJlZXMocywgcy5sX2Rlc2MubWF4X2NvZGUgKyAxLCBzLmRfZGVzYy5tYXhfY29kZSArIDEsIG1heF9ibGluZGV4ICsgMSk7CiAgICAgICAgICBjb21wcmVzc19ibG9jayhzLCBzLmR5bl9sdHJlZSwgcy5keW5fZHRyZWUpOwogICAgICAgIH0KICAgICAgICBpbml0X2Jsb2NrKHMpOwogICAgICAgIGlmIChsYXN0KSB7CiAgICAgICAgICBiaV93aW5kdXAocyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIF90cl90YWxseShzLCBkaXN0LCBsYykgewogICAgICAgIHMucGVuZGluZ19idWZbcy5kX2J1ZiArIHMubGFzdF9saXQgKiAyXSA9IGRpc3QgPj4+IDggJiAyNTU7CiAgICAgICAgcy5wZW5kaW5nX2J1ZltzLmRfYnVmICsgcy5sYXN0X2xpdCAqIDIgKyAxXSA9IGRpc3QgJiAyNTU7CiAgICAgICAgcy5wZW5kaW5nX2J1ZltzLmxfYnVmICsgcy5sYXN0X2xpdF0gPSBsYyAmIDI1NTsKICAgICAgICBzLmxhc3RfbGl0Kys7CiAgICAgICAgaWYgKGRpc3QgPT09IDApIHsKICAgICAgICAgIHMuZHluX2x0cmVlW2xjICogMl0rKzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcy5tYXRjaGVzKys7CiAgICAgICAgICBkaXN0LS07CiAgICAgICAgICBzLmR5bl9sdHJlZVsoX2xlbmd0aF9jb2RlW2xjXSArIExJVEVSQUxTICsgMSkgKiAyXSsrOwogICAgICAgICAgcy5keW5fZHRyZWVbZF9jb2RlKGRpc3QpICogMl0rKzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHMubGFzdF9saXQgPT09IHMubGl0X2J1ZnNpemUgLSAxOwogICAgICB9CiAgICAgIGV4cG9ydHMuX3RyX2luaXQgPSBfdHJfaW5pdDsKICAgICAgZXhwb3J0cy5fdHJfc3RvcmVkX2Jsb2NrID0gX3RyX3N0b3JlZF9ibG9jazsKICAgICAgZXhwb3J0cy5fdHJfZmx1c2hfYmxvY2sgPSBfdHJfZmx1c2hfYmxvY2s7CiAgICAgIGV4cG9ydHMuX3RyX3RhbGx5ID0gX3RyX3RhbGx5OwogICAgICBleHBvcnRzLl90cl9hbGlnbiA9IF90cl9hbGlnbjsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL3Bha28vbGliL3psaWIvYWRsZXIzMi5qcwogIHZhciByZXF1aXJlX2FkbGVyMzIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvcGFrby9saWIvemxpYi9hZGxlcjMyLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGZ1bmN0aW9uIGFkbGVyMzIoYWRsZXIsIGJ1ZiwgbGVuLCBwb3MpIHsKICAgICAgICB2YXIgczEgPSBhZGxlciAmIDY1NTM1IHwgMCwgczIgPSBhZGxlciA+Pj4gMTYgJiA2NTUzNSB8IDAsIG4gPSAwOwogICAgICAgIHdoaWxlIChsZW4gIT09IDApIHsKICAgICAgICAgIG4gPSBsZW4gPiAyZTMgPyAyZTMgOiBsZW47CiAgICAgICAgICBsZW4gLT0gbjsKICAgICAgICAgIGRvIHsKICAgICAgICAgICAgczEgPSBzMSArIGJ1Zltwb3MrK10gfCAwOwogICAgICAgICAgICBzMiA9IHMyICsgczEgfCAwOwogICAgICAgICAgfSB3aGlsZSAoLS1uKTsKICAgICAgICAgIHMxICU9IDY1NTIxOwogICAgICAgICAgczIgJT0gNjU1MjE7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzMSB8IHMyIDw8IDE2IHwgMDsKICAgICAgfQogICAgICBtb2R1bGUuZXhwb3J0cyA9IGFkbGVyMzI7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9wYWtvL2xpYi96bGliL2NyYzMyLmpzCiAgdmFyIHJlcXVpcmVfY3JjMzIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvcGFrby9saWIvemxpYi9jcmMzMi5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBtYWtlVGFibGUoKSB7CiAgICAgICAgdmFyIGMsIHRhYmxlID0gW107CiAgICAgICAgZm9yICh2YXIgbiA9IDA7IG4gPCAyNTY7IG4rKykgewogICAgICAgICAgYyA9IG47CiAgICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IDg7IGsrKykgewogICAgICAgICAgICBjID0gYyAmIDEgPyAzOTg4MjkyMzg0IF4gYyA+Pj4gMSA6IGMgPj4+IDE7CiAgICAgICAgICB9CiAgICAgICAgICB0YWJsZVtuXSA9IGM7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0YWJsZTsKICAgICAgfQogICAgICB2YXIgY3JjVGFibGUgPSBtYWtlVGFibGUoKTsKICAgICAgZnVuY3Rpb24gY3JjMzIoY3JjLCBidWYsIGxlbiwgcG9zKSB7CiAgICAgICAgdmFyIHQgPSBjcmNUYWJsZSwgZW5kID0gcG9zICsgbGVuOwogICAgICAgIGNyYyBePSAtMTsKICAgICAgICBmb3IgKHZhciBpID0gcG9zOyBpIDwgZW5kOyBpKyspIHsKICAgICAgICAgIGNyYyA9IGNyYyA+Pj4gOCBeIHRbKGNyYyBeIGJ1ZltpXSkgJiAyNTVdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY3JjIF4gLTE7CiAgICAgIH0KICAgICAgbW9kdWxlLmV4cG9ydHMgPSBjcmMzMjsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL3Bha28vbGliL3psaWIvbWVzc2FnZXMuanMKICB2YXIgcmVxdWlyZV9tZXNzYWdlczIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvcGFrby9saWIvemxpYi9tZXNzYWdlcy5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgICAyOiAibmVlZCBkaWN0aW9uYXJ5IiwKICAgICAgICAxOiAic3RyZWFtIGVuZCIsCiAgICAgICAgMDogIiIsCiAgICAgICAgIi0xIjogImZpbGUgZXJyb3IiLAogICAgICAgICItMiI6ICJzdHJlYW0gZXJyb3IiLAogICAgICAgICItMyI6ICJkYXRhIGVycm9yIiwKICAgICAgICAiLTQiOiAiaW5zdWZmaWNpZW50IG1lbW9yeSIsCiAgICAgICAgIi01IjogImJ1ZmZlciBlcnJvciIsCiAgICAgICAgIi02IjogImluY29tcGF0aWJsZSB2ZXJzaW9uIgogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvcGFrby9saWIvemxpYi9kZWZsYXRlLmpzCiAgdmFyIHJlcXVpcmVfZGVmbGF0ZSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9wYWtvL2xpYi96bGliL2RlZmxhdGUuanMiKGV4cG9ydHMpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciB1dGlscyA9IHJlcXVpcmVfY29tbW9uMigpOwogICAgICB2YXIgdHJlZXMgPSByZXF1aXJlX3RyZWVzKCk7CiAgICAgIHZhciBhZGxlcjMyID0gcmVxdWlyZV9hZGxlcjMyKCk7CiAgICAgIHZhciBjcmMzMiA9IHJlcXVpcmVfY3JjMzIoKTsKICAgICAgdmFyIG1zZyA9IHJlcXVpcmVfbWVzc2FnZXMyKCk7CiAgICAgIHZhciBaX05PX0ZMVVNIID0gMDsKICAgICAgdmFyIFpfUEFSVElBTF9GTFVTSCA9IDE7CiAgICAgIHZhciBaX0ZVTExfRkxVU0ggPSAzOwogICAgICB2YXIgWl9GSU5JU0ggPSA0OwogICAgICB2YXIgWl9CTE9DSyA9IDU7CiAgICAgIHZhciBaX09LID0gMDsKICAgICAgdmFyIFpfU1RSRUFNX0VORCA9IDE7CiAgICAgIHZhciBaX1NUUkVBTV9FUlJPUiA9IC0yOwogICAgICB2YXIgWl9EQVRBX0VSUk9SID0gLTM7CiAgICAgIHZhciBaX0JVRl9FUlJPUiA9IC01OwogICAgICB2YXIgWl9ERUZBVUxUX0NPTVBSRVNTSU9OID0gLTE7CiAgICAgIHZhciBaX0ZJTFRFUkVEID0gMTsKICAgICAgdmFyIFpfSFVGRk1BTl9PTkxZID0gMjsKICAgICAgdmFyIFpfUkxFID0gMzsKICAgICAgdmFyIFpfRklYRUQgPSA0OwogICAgICB2YXIgWl9ERUZBVUxUX1NUUkFURUdZID0gMDsKICAgICAgdmFyIFpfVU5LTk9XTiA9IDI7CiAgICAgIHZhciBaX0RFRkxBVEVEID0gODsKICAgICAgdmFyIE1BWF9NRU1fTEVWRUwgPSA5OwogICAgICB2YXIgTUFYX1dCSVRTID0gMTU7CiAgICAgIHZhciBERUZfTUVNX0xFVkVMID0gODsKICAgICAgdmFyIExFTkdUSF9DT0RFUyA9IDI5OwogICAgICB2YXIgTElURVJBTFMgPSAyNTY7CiAgICAgIHZhciBMX0NPREVTID0gTElURVJBTFMgKyAxICsgTEVOR1RIX0NPREVTOwogICAgICB2YXIgRF9DT0RFUyA9IDMwOwogICAgICB2YXIgQkxfQ09ERVMgPSAxOTsKICAgICAgdmFyIEhFQVBfU0laRSA9IDIgKiBMX0NPREVTICsgMTsKICAgICAgdmFyIE1BWF9CSVRTID0gMTU7CiAgICAgIHZhciBNSU5fTUFUQ0ggPSAzOwogICAgICB2YXIgTUFYX01BVENIID0gMjU4OwogICAgICB2YXIgTUlOX0xPT0tBSEVBRCA9IE1BWF9NQVRDSCArIE1JTl9NQVRDSCArIDE7CiAgICAgIHZhciBQUkVTRVRfRElDVCA9IDMyOwogICAgICB2YXIgSU5JVF9TVEFURSA9IDQyOwogICAgICB2YXIgRVhUUkFfU1RBVEUgPSA2OTsKICAgICAgdmFyIE5BTUVfU1RBVEUgPSA3MzsKICAgICAgdmFyIENPTU1FTlRfU1RBVEUgPSA5MTsKICAgICAgdmFyIEhDUkNfU1RBVEUgPSAxMDM7CiAgICAgIHZhciBCVVNZX1NUQVRFID0gMTEzOwogICAgICB2YXIgRklOSVNIX1NUQVRFID0gNjY2OwogICAgICB2YXIgQlNfTkVFRF9NT1JFID0gMTsKICAgICAgdmFyIEJTX0JMT0NLX0RPTkUgPSAyOwogICAgICB2YXIgQlNfRklOSVNIX1NUQVJURUQgPSAzOwogICAgICB2YXIgQlNfRklOSVNIX0RPTkUgPSA0OwogICAgICB2YXIgT1NfQ09ERSA9IDM7CiAgICAgIGZ1bmN0aW9uIGVycihzdHJtLCBlcnJvckNvZGUpIHsKICAgICAgICBzdHJtLm1zZyA9IG1zZ1tlcnJvckNvZGVdOwogICAgICAgIHJldHVybiBlcnJvckNvZGU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcmFuayhmKSB7CiAgICAgICAgcmV0dXJuIChmIDw8IDEpIC0gKGYgPiA0ID8gOSA6IDApOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHplcm8oYnVmKSB7CiAgICAgICAgdmFyIGxlbiA9IGJ1Zi5sZW5ndGg7CiAgICAgICAgd2hpbGUgKC0tbGVuID49IDApIHsKICAgICAgICAgIGJ1ZltsZW5dID0gMDsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZmx1c2hfcGVuZGluZyhzdHJtKSB7CiAgICAgICAgdmFyIHMgPSBzdHJtLnN0YXRlOwogICAgICAgIHZhciBsZW4gPSBzLnBlbmRpbmc7CiAgICAgICAgaWYgKGxlbiA+IHN0cm0uYXZhaWxfb3V0KSB7CiAgICAgICAgICBsZW4gPSBzdHJtLmF2YWlsX291dDsKICAgICAgICB9CiAgICAgICAgaWYgKGxlbiA9PT0gMCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB1dGlscy5hcnJheVNldChzdHJtLm91dHB1dCwgcy5wZW5kaW5nX2J1Ziwgcy5wZW5kaW5nX291dCwgbGVuLCBzdHJtLm5leHRfb3V0KTsKICAgICAgICBzdHJtLm5leHRfb3V0ICs9IGxlbjsKICAgICAgICBzLnBlbmRpbmdfb3V0ICs9IGxlbjsKICAgICAgICBzdHJtLnRvdGFsX291dCArPSBsZW47CiAgICAgICAgc3RybS5hdmFpbF9vdXQgLT0gbGVuOwogICAgICAgIHMucGVuZGluZyAtPSBsZW47CiAgICAgICAgaWYgKHMucGVuZGluZyA9PT0gMCkgewogICAgICAgICAgcy5wZW5kaW5nX291dCA9IDA7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGZsdXNoX2Jsb2NrX29ubHkocywgbGFzdCkgewogICAgICAgIHRyZWVzLl90cl9mbHVzaF9ibG9jayhzLCBzLmJsb2NrX3N0YXJ0ID49IDAgPyBzLmJsb2NrX3N0YXJ0IDogLTEsIHMuc3Ryc3RhcnQgLSBzLmJsb2NrX3N0YXJ0LCBsYXN0KTsKICAgICAgICBzLmJsb2NrX3N0YXJ0ID0gcy5zdHJzdGFydDsKICAgICAgICBmbHVzaF9wZW5kaW5nKHMuc3RybSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcHV0X2J5dGUocywgYikgewogICAgICAgIHMucGVuZGluZ19idWZbcy5wZW5kaW5nKytdID0gYjsKICAgICAgfQogICAgICBmdW5jdGlvbiBwdXRTaG9ydE1TQihzLCBiKSB7CiAgICAgICAgcy5wZW5kaW5nX2J1ZltzLnBlbmRpbmcrK10gPSBiID4+PiA4ICYgMjU1OwogICAgICAgIHMucGVuZGluZ19idWZbcy5wZW5kaW5nKytdID0gYiAmIDI1NTsKICAgICAgfQogICAgICBmdW5jdGlvbiByZWFkX2J1ZihzdHJtLCBidWYsIHN0YXJ0LCBzaXplKSB7CiAgICAgICAgdmFyIGxlbiA9IHN0cm0uYXZhaWxfaW47CiAgICAgICAgaWYgKGxlbiA+IHNpemUpIHsKICAgICAgICAgIGxlbiA9IHNpemU7CiAgICAgICAgfQogICAgICAgIGlmIChsZW4gPT09IDApIHsKICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICBzdHJtLmF2YWlsX2luIC09IGxlbjsKICAgICAgICB1dGlscy5hcnJheVNldChidWYsIHN0cm0uaW5wdXQsIHN0cm0ubmV4dF9pbiwgbGVuLCBzdGFydCk7CiAgICAgICAgaWYgKHN0cm0uc3RhdGUud3JhcCA9PT0gMSkgewogICAgICAgICAgc3RybS5hZGxlciA9IGFkbGVyMzIoc3RybS5hZGxlciwgYnVmLCBsZW4sIHN0YXJ0KTsKICAgICAgICB9IGVsc2UgaWYgKHN0cm0uc3RhdGUud3JhcCA9PT0gMikgewogICAgICAgICAgc3RybS5hZGxlciA9IGNyYzMyKHN0cm0uYWRsZXIsIGJ1ZiwgbGVuLCBzdGFydCk7CiAgICAgICAgfQogICAgICAgIHN0cm0ubmV4dF9pbiArPSBsZW47CiAgICAgICAgc3RybS50b3RhbF9pbiArPSBsZW47CiAgICAgICAgcmV0dXJuIGxlbjsKICAgICAgfQogICAgICBmdW5jdGlvbiBsb25nZXN0X21hdGNoKHMsIGN1cl9tYXRjaCkgewogICAgICAgIHZhciBjaGFpbl9sZW5ndGggPSBzLm1heF9jaGFpbl9sZW5ndGg7CiAgICAgICAgdmFyIHNjYW4gPSBzLnN0cnN0YXJ0OwogICAgICAgIHZhciBtYXRjaDsKICAgICAgICB2YXIgbGVuOwogICAgICAgIHZhciBiZXN0X2xlbiA9IHMucHJldl9sZW5ndGg7CiAgICAgICAgdmFyIG5pY2VfbWF0Y2ggPSBzLm5pY2VfbWF0Y2g7CiAgICAgICAgdmFyIGxpbWl0ID0gcy5zdHJzdGFydCA+IHMud19zaXplIC0gTUlOX0xPT0tBSEVBRCA/IHMuc3Ryc3RhcnQgLSAocy53X3NpemUgLSBNSU5fTE9PS0FIRUFEKSA6IDA7CiAgICAgICAgdmFyIF93aW4gPSBzLndpbmRvdzsKICAgICAgICB2YXIgd21hc2sgPSBzLndfbWFzazsKICAgICAgICB2YXIgcHJldiA9IHMucHJldjsKICAgICAgICB2YXIgc3RyZW5kID0gcy5zdHJzdGFydCArIE1BWF9NQVRDSDsKICAgICAgICB2YXIgc2Nhbl9lbmQxID0gX3dpbltzY2FuICsgYmVzdF9sZW4gLSAxXTsKICAgICAgICB2YXIgc2Nhbl9lbmQgPSBfd2luW3NjYW4gKyBiZXN0X2xlbl07CiAgICAgICAgaWYgKHMucHJldl9sZW5ndGggPj0gcy5nb29kX21hdGNoKSB7CiAgICAgICAgICBjaGFpbl9sZW5ndGggPj49IDI7CiAgICAgICAgfQogICAgICAgIGlmIChuaWNlX21hdGNoID4gcy5sb29rYWhlYWQpIHsKICAgICAgICAgIG5pY2VfbWF0Y2ggPSBzLmxvb2thaGVhZDsKICAgICAgICB9CiAgICAgICAgZG8gewogICAgICAgICAgbWF0Y2ggPSBjdXJfbWF0Y2g7CiAgICAgICAgICBpZiAoX3dpblttYXRjaCArIGJlc3RfbGVuXSAhPT0gc2Nhbl9lbmQgfHwgX3dpblttYXRjaCArIGJlc3RfbGVuIC0gMV0gIT09IHNjYW5fZW5kMSB8fCBfd2luW21hdGNoXSAhPT0gX3dpbltzY2FuXSB8fCBfd2luWysrbWF0Y2hdICE9PSBfd2luW3NjYW4gKyAxXSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIHNjYW4gKz0gMjsKICAgICAgICAgIG1hdGNoKys7CiAgICAgICAgICBkbyB7CiAgICAgICAgICB9IHdoaWxlIChfd2luWysrc2Nhbl0gPT09IF93aW5bKyttYXRjaF0gJiYgX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2hdICYmIF93aW5bKytzY2FuXSA9PT0gX3dpblsrK21hdGNoXSAmJiBfd2luWysrc2Nhbl0gPT09IF93aW5bKyttYXRjaF0gJiYgX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2hdICYmIF93aW5bKytzY2FuXSA9PT0gX3dpblsrK21hdGNoXSAmJiBfd2luWysrc2Nhbl0gPT09IF93aW5bKyttYXRjaF0gJiYgX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2hdICYmIHNjYW4gPCBzdHJlbmQpOwogICAgICAgICAgbGVuID0gTUFYX01BVENIIC0gKHN0cmVuZCAtIHNjYW4pOwogICAgICAgICAgc2NhbiA9IHN0cmVuZCAtIE1BWF9NQVRDSDsKICAgICAgICAgIGlmIChsZW4gPiBiZXN0X2xlbikgewogICAgICAgICAgICBzLm1hdGNoX3N0YXJ0ID0gY3VyX21hdGNoOwogICAgICAgICAgICBiZXN0X2xlbiA9IGxlbjsKICAgICAgICAgICAgaWYgKGxlbiA+PSBuaWNlX21hdGNoKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2Nhbl9lbmQxID0gX3dpbltzY2FuICsgYmVzdF9sZW4gLSAxXTsKICAgICAgICAgICAgc2Nhbl9lbmQgPSBfd2luW3NjYW4gKyBiZXN0X2xlbl07CiAgICAgICAgICB9CiAgICAgICAgfSB3aGlsZSAoKGN1cl9tYXRjaCA9IHByZXZbY3VyX21hdGNoICYgd21hc2tdKSA+IGxpbWl0ICYmIC0tY2hhaW5fbGVuZ3RoICE9PSAwKTsKICAgICAgICBpZiAoYmVzdF9sZW4gPD0gcy5sb29rYWhlYWQpIHsKICAgICAgICAgIHJldHVybiBiZXN0X2xlbjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHMubG9va2FoZWFkOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGZpbGxfd2luZG93KHMpIHsKICAgICAgICB2YXIgX3dfc2l6ZSA9IHMud19zaXplOwogICAgICAgIHZhciBwLCBuLCBtLCBtb3JlLCBzdHI7CiAgICAgICAgZG8gewogICAgICAgICAgbW9yZSA9IHMud2luZG93X3NpemUgLSBzLmxvb2thaGVhZCAtIHMuc3Ryc3RhcnQ7CiAgICAgICAgICBpZiAocy5zdHJzdGFydCA+PSBfd19zaXplICsgKF93X3NpemUgLSBNSU5fTE9PS0FIRUFEKSkgewogICAgICAgICAgICB1dGlscy5hcnJheVNldChzLndpbmRvdywgcy53aW5kb3csIF93X3NpemUsIF93X3NpemUsIDApOwogICAgICAgICAgICBzLm1hdGNoX3N0YXJ0IC09IF93X3NpemU7CiAgICAgICAgICAgIHMuc3Ryc3RhcnQgLT0gX3dfc2l6ZTsKICAgICAgICAgICAgcy5ibG9ja19zdGFydCAtPSBfd19zaXplOwogICAgICAgICAgICBuID0gcy5oYXNoX3NpemU7CiAgICAgICAgICAgIHAgPSBuOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgbSA9IHMuaGVhZFstLXBdOwogICAgICAgICAgICAgIHMuaGVhZFtwXSA9IG0gPj0gX3dfc2l6ZSA/IG0gLSBfd19zaXplIDogMDsKICAgICAgICAgICAgfSB3aGlsZSAoLS1uKTsKICAgICAgICAgICAgbiA9IF93X3NpemU7CiAgICAgICAgICAgIHAgPSBuOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgbSA9IHMucHJldlstLXBdOwogICAgICAgICAgICAgIHMucHJldltwXSA9IG0gPj0gX3dfc2l6ZSA/IG0gLSBfd19zaXplIDogMDsKICAgICAgICAgICAgfSB3aGlsZSAoLS1uKTsKICAgICAgICAgICAgbW9yZSArPSBfd19zaXplOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHMuc3RybS5hdmFpbF9pbiA9PT0gMCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIG4gPSByZWFkX2J1ZihzLnN0cm0sIHMud2luZG93LCBzLnN0cnN0YXJ0ICsgcy5sb29rYWhlYWQsIG1vcmUpOwogICAgICAgICAgcy5sb29rYWhlYWQgKz0gbjsKICAgICAgICAgIGlmIChzLmxvb2thaGVhZCArIHMuaW5zZXJ0ID49IE1JTl9NQVRDSCkgewogICAgICAgICAgICBzdHIgPSBzLnN0cnN0YXJ0IC0gcy5pbnNlcnQ7CiAgICAgICAgICAgIHMuaW5zX2ggPSBzLndpbmRvd1tzdHJdOwogICAgICAgICAgICBzLmluc19oID0gKHMuaW5zX2ggPDwgcy5oYXNoX3NoaWZ0IF4gcy53aW5kb3dbc3RyICsgMV0pICYgcy5oYXNoX21hc2s7CiAgICAgICAgICAgIHdoaWxlIChzLmluc2VydCkgewogICAgICAgICAgICAgIHMuaW5zX2ggPSAocy5pbnNfaCA8PCBzLmhhc2hfc2hpZnQgXiBzLndpbmRvd1tzdHIgKyBNSU5fTUFUQ0ggLSAxXSkgJiBzLmhhc2hfbWFzazsKICAgICAgICAgICAgICBzLnByZXZbc3RyICYgcy53X21hc2tdID0gcy5oZWFkW3MuaW5zX2hdOwogICAgICAgICAgICAgIHMuaGVhZFtzLmluc19oXSA9IHN0cjsKICAgICAgICAgICAgICBzdHIrKzsKICAgICAgICAgICAgICBzLmluc2VydC0tOwogICAgICAgICAgICAgIGlmIChzLmxvb2thaGVhZCArIHMuaW5zZXJ0IDwgTUlOX01BVENIKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IHdoaWxlIChzLmxvb2thaGVhZCA8IE1JTl9MT09LQUhFQUQgJiYgcy5zdHJtLmF2YWlsX2luICE9PSAwKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZsYXRlX3N0b3JlZChzLCBmbHVzaCkgewogICAgICAgIHZhciBtYXhfYmxvY2tfc2l6ZSA9IDY1NTM1OwogICAgICAgIGlmIChtYXhfYmxvY2tfc2l6ZSA+IHMucGVuZGluZ19idWZfc2l6ZSAtIDUpIHsKICAgICAgICAgIG1heF9ibG9ja19zaXplID0gcy5wZW5kaW5nX2J1Zl9zaXplIC0gNTsKICAgICAgICB9CiAgICAgICAgZm9yICg7IDsgKSB7CiAgICAgICAgICBpZiAocy5sb29rYWhlYWQgPD0gMSkgewogICAgICAgICAgICBmaWxsX3dpbmRvdyhzKTsKICAgICAgICAgICAgaWYgKHMubG9va2FoZWFkID09PSAwICYmIGZsdXNoID09PSBaX05PX0ZMVVNIKSB7CiAgICAgICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocy5sb29rYWhlYWQgPT09IDApIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcy5zdHJzdGFydCArPSBzLmxvb2thaGVhZDsKICAgICAgICAgIHMubG9va2FoZWFkID0gMDsKICAgICAgICAgIHZhciBtYXhfc3RhcnQgPSBzLmJsb2NrX3N0YXJ0ICsgbWF4X2Jsb2NrX3NpemU7CiAgICAgICAgICBpZiAocy5zdHJzdGFydCA9PT0gMCB8fCBzLnN0cnN0YXJ0ID49IG1heF9zdGFydCkgewogICAgICAgICAgICBzLmxvb2thaGVhZCA9IHMuc3Ryc3RhcnQgLSBtYXhfc3RhcnQ7CiAgICAgICAgICAgIHMuc3Ryc3RhcnQgPSBtYXhfc3RhcnQ7CiAgICAgICAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChzLnN0cnN0YXJ0IC0gcy5ibG9ja19zdGFydCA+PSBzLndfc2l6ZSAtIE1JTl9MT09LQUhFQUQpIHsKICAgICAgICAgICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICAgICAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzLmluc2VydCA9IDA7CiAgICAgICAgaWYgKGZsdXNoID09PSBaX0ZJTklTSCkgewogICAgICAgICAgZmx1c2hfYmxvY2tfb25seShzLCB0cnVlKTsKICAgICAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBCU19GSU5JU0hfU1RBUlRFRDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBCU19GSU5JU0hfRE9ORTsKICAgICAgICB9CiAgICAgICAgaWYgKHMuc3Ryc3RhcnQgPiBzLmJsb2NrX3N0YXJ0KSB7CiAgICAgICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGVmbGF0ZV9mYXN0KHMsIGZsdXNoKSB7CiAgICAgICAgdmFyIGhhc2hfaGVhZDsKICAgICAgICB2YXIgYmZsdXNoOwogICAgICAgIGZvciAoOyA7ICkgewogICAgICAgICAgaWYgKHMubG9va2FoZWFkIDwgTUlOX0xPT0tBSEVBRCkgewogICAgICAgICAgICBmaWxsX3dpbmRvdyhzKTsKICAgICAgICAgICAgaWYgKHMubG9va2FoZWFkIDwgTUlOX0xPT0tBSEVBRCAmJiBmbHVzaCA9PT0gWl9OT19GTFVTSCkgewogICAgICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHMubG9va2FoZWFkID09PSAwKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGhhc2hfaGVhZCA9IDA7CiAgICAgICAgICBpZiAocy5sb29rYWhlYWQgPj0gTUlOX01BVENIKSB7CiAgICAgICAgICAgIHMuaW5zX2ggPSAocy5pbnNfaCA8PCBzLmhhc2hfc2hpZnQgXiBzLndpbmRvd1tzLnN0cnN0YXJ0ICsgTUlOX01BVENIIC0gMV0pICYgcy5oYXNoX21hc2s7CiAgICAgICAgICAgIGhhc2hfaGVhZCA9IHMucHJldltzLnN0cnN0YXJ0ICYgcy53X21hc2tdID0gcy5oZWFkW3MuaW5zX2hdOwogICAgICAgICAgICBzLmhlYWRbcy5pbnNfaF0gPSBzLnN0cnN0YXJ0OwogICAgICAgICAgfQogICAgICAgICAgaWYgKGhhc2hfaGVhZCAhPT0gMCAmJiBzLnN0cnN0YXJ0IC0gaGFzaF9oZWFkIDw9IHMud19zaXplIC0gTUlOX0xPT0tBSEVBRCkgewogICAgICAgICAgICBzLm1hdGNoX2xlbmd0aCA9IGxvbmdlc3RfbWF0Y2gocywgaGFzaF9oZWFkKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChzLm1hdGNoX2xlbmd0aCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICAgICAgYmZsdXNoID0gdHJlZXMuX3RyX3RhbGx5KHMsIHMuc3Ryc3RhcnQgLSBzLm1hdGNoX3N0YXJ0LCBzLm1hdGNoX2xlbmd0aCAtIE1JTl9NQVRDSCk7CiAgICAgICAgICAgIHMubG9va2FoZWFkIC09IHMubWF0Y2hfbGVuZ3RoOwogICAgICAgICAgICBpZiAocy5tYXRjaF9sZW5ndGggPD0gcy5tYXhfbGF6eV9tYXRjaCAmJiBzLmxvb2thaGVhZCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICAgICAgICBzLm1hdGNoX2xlbmd0aC0tOwogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIHMuc3Ryc3RhcnQrKzsKICAgICAgICAgICAgICAgIHMuaW5zX2ggPSAocy5pbnNfaCA8PCBzLmhhc2hfc2hpZnQgXiBzLndpbmRvd1tzLnN0cnN0YXJ0ICsgTUlOX01BVENIIC0gMV0pICYgcy5oYXNoX21hc2s7CiAgICAgICAgICAgICAgICBoYXNoX2hlYWQgPSBzLnByZXZbcy5zdHJzdGFydCAmIHMud19tYXNrXSA9IHMuaGVhZFtzLmluc19oXTsKICAgICAgICAgICAgICAgIHMuaGVhZFtzLmluc19oXSA9IHMuc3Ryc3RhcnQ7CiAgICAgICAgICAgICAgfSB3aGlsZSAoLS1zLm1hdGNoX2xlbmd0aCAhPT0gMCk7CiAgICAgICAgICAgICAgcy5zdHJzdGFydCsrOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHMuc3Ryc3RhcnQgKz0gcy5tYXRjaF9sZW5ndGg7CiAgICAgICAgICAgICAgcy5tYXRjaF9sZW5ndGggPSAwOwogICAgICAgICAgICAgIHMuaW5zX2ggPSBzLndpbmRvd1tzLnN0cnN0YXJ0XTsKICAgICAgICAgICAgICBzLmluc19oID0gKHMuaW5zX2ggPDwgcy5oYXNoX3NoaWZ0IF4gcy53aW5kb3dbcy5zdHJzdGFydCArIDFdKSAmIHMuaGFzaF9tYXNrOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBiZmx1c2ggPSB0cmVlcy5fdHJfdGFsbHkocywgMCwgcy53aW5kb3dbcy5zdHJzdGFydF0pOwogICAgICAgICAgICBzLmxvb2thaGVhZC0tOwogICAgICAgICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYmZsdXNoKSB7CiAgICAgICAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcy5pbnNlcnQgPSBzLnN0cnN0YXJ0IDwgTUlOX01BVENIIC0gMSA/IHMuc3Ryc3RhcnQgOiBNSU5fTUFUQ0ggLSAxOwogICAgICAgIGlmIChmbHVzaCA9PT0gWl9GSU5JU0gpIHsKICAgICAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgdHJ1ZSk7CiAgICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gQlNfRklOSVNIX1NUQVJURUQ7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gQlNfRklOSVNIX0RPTkU7CiAgICAgICAgfQogICAgICAgIGlmIChzLmxhc3RfbGl0KSB7CiAgICAgICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBCU19CTE9DS19ET05FOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRlZmxhdGVfc2xvdyhzLCBmbHVzaCkgewogICAgICAgIHZhciBoYXNoX2hlYWQ7CiAgICAgICAgdmFyIGJmbHVzaDsKICAgICAgICB2YXIgbWF4X2luc2VydDsKICAgICAgICBmb3IgKDsgOyApIHsKICAgICAgICAgIGlmIChzLmxvb2thaGVhZCA8IE1JTl9MT09LQUhFQUQpIHsKICAgICAgICAgICAgZmlsbF93aW5kb3cocyk7CiAgICAgICAgICAgIGlmIChzLmxvb2thaGVhZCA8IE1JTl9MT09LQUhFQUQgJiYgZmx1c2ggPT09IFpfTk9fRkxVU0gpIHsKICAgICAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBoYXNoX2hlYWQgPSAwOwogICAgICAgICAgaWYgKHMubG9va2FoZWFkID49IE1JTl9NQVRDSCkgewogICAgICAgICAgICBzLmluc19oID0gKHMuaW5zX2ggPDwgcy5oYXNoX3NoaWZ0IF4gcy53aW5kb3dbcy5zdHJzdGFydCArIE1JTl9NQVRDSCAtIDFdKSAmIHMuaGFzaF9tYXNrOwogICAgICAgICAgICBoYXNoX2hlYWQgPSBzLnByZXZbcy5zdHJzdGFydCAmIHMud19tYXNrXSA9IHMuaGVhZFtzLmluc19oXTsKICAgICAgICAgICAgcy5oZWFkW3MuaW5zX2hdID0gcy5zdHJzdGFydDsKICAgICAgICAgIH0KICAgICAgICAgIHMucHJldl9sZW5ndGggPSBzLm1hdGNoX2xlbmd0aDsKICAgICAgICAgIHMucHJldl9tYXRjaCA9IHMubWF0Y2hfc3RhcnQ7CiAgICAgICAgICBzLm1hdGNoX2xlbmd0aCA9IE1JTl9NQVRDSCAtIDE7CiAgICAgICAgICBpZiAoaGFzaF9oZWFkICE9PSAwICYmIHMucHJldl9sZW5ndGggPCBzLm1heF9sYXp5X21hdGNoICYmIHMuc3Ryc3RhcnQgLSBoYXNoX2hlYWQgPD0gcy53X3NpemUgLSBNSU5fTE9PS0FIRUFEKSB7CiAgICAgICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gbG9uZ2VzdF9tYXRjaChzLCBoYXNoX2hlYWQpOwogICAgICAgICAgICBpZiAocy5tYXRjaF9sZW5ndGggPD0gNSAmJiAocy5zdHJhdGVneSA9PT0gWl9GSUxURVJFRCB8fCBzLm1hdGNoX2xlbmd0aCA9PT0gTUlOX01BVENIICYmIHMuc3Ryc3RhcnQgLSBzLm1hdGNoX3N0YXJ0ID4gNDA5NikpIHsKICAgICAgICAgICAgICBzLm1hdGNoX2xlbmd0aCA9IE1JTl9NQVRDSCAtIDE7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChzLnByZXZfbGVuZ3RoID49IE1JTl9NQVRDSCAmJiBzLm1hdGNoX2xlbmd0aCA8PSBzLnByZXZfbGVuZ3RoKSB7CiAgICAgICAgICAgIG1heF9pbnNlcnQgPSBzLnN0cnN0YXJ0ICsgcy5sb29rYWhlYWQgLSBNSU5fTUFUQ0g7CiAgICAgICAgICAgIGJmbHVzaCA9IHRyZWVzLl90cl90YWxseShzLCBzLnN0cnN0YXJ0IC0gMSAtIHMucHJldl9tYXRjaCwgcy5wcmV2X2xlbmd0aCAtIE1JTl9NQVRDSCk7CiAgICAgICAgICAgIHMubG9va2FoZWFkIC09IHMucHJldl9sZW5ndGggLSAxOwogICAgICAgICAgICBzLnByZXZfbGVuZ3RoIC09IDI7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICBpZiAoKytzLnN0cnN0YXJ0IDw9IG1heF9pbnNlcnQpIHsKICAgICAgICAgICAgICAgIHMuaW5zX2ggPSAocy5pbnNfaCA8PCBzLmhhc2hfc2hpZnQgXiBzLndpbmRvd1tzLnN0cnN0YXJ0ICsgTUlOX01BVENIIC0gMV0pICYgcy5oYXNoX21hc2s7CiAgICAgICAgICAgICAgICBoYXNoX2hlYWQgPSBzLnByZXZbcy5zdHJzdGFydCAmIHMud19tYXNrXSA9IHMuaGVhZFtzLmluc19oXTsKICAgICAgICAgICAgICAgIHMuaGVhZFtzLmluc19oXSA9IHMuc3Ryc3RhcnQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IHdoaWxlICgtLXMucHJldl9sZW5ndGggIT09IDApOwogICAgICAgICAgICBzLm1hdGNoX2F2YWlsYWJsZSA9IDA7CiAgICAgICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gTUlOX01BVENIIC0gMTsKICAgICAgICAgICAgcy5zdHJzdGFydCsrOwogICAgICAgICAgICBpZiAoYmZsdXNoKSB7CiAgICAgICAgICAgICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICAgICAgICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKHMubWF0Y2hfYXZhaWxhYmxlKSB7CiAgICAgICAgICAgIGJmbHVzaCA9IHRyZWVzLl90cl90YWxseShzLCAwLCBzLndpbmRvd1tzLnN0cnN0YXJ0IC0gMV0pOwogICAgICAgICAgICBpZiAoYmZsdXNoKSB7CiAgICAgICAgICAgICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcy5zdHJzdGFydCsrOwogICAgICAgICAgICBzLmxvb2thaGVhZC0tOwogICAgICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHMubWF0Y2hfYXZhaWxhYmxlID0gMTsKICAgICAgICAgICAgcy5zdHJzdGFydCsrOwogICAgICAgICAgICBzLmxvb2thaGVhZC0tOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAocy5tYXRjaF9hdmFpbGFibGUpIHsKICAgICAgICAgIGJmbHVzaCA9IHRyZWVzLl90cl90YWxseShzLCAwLCBzLndpbmRvd1tzLnN0cnN0YXJ0IC0gMV0pOwogICAgICAgICAgcy5tYXRjaF9hdmFpbGFibGUgPSAwOwogICAgICAgIH0KICAgICAgICBzLmluc2VydCA9IHMuc3Ryc3RhcnQgPCBNSU5fTUFUQ0ggLSAxID8gcy5zdHJzdGFydCA6IE1JTl9NQVRDSCAtIDE7CiAgICAgICAgaWYgKGZsdXNoID09PSBaX0ZJTklTSCkgewogICAgICAgICAgZmx1c2hfYmxvY2tfb25seShzLCB0cnVlKTsKICAgICAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBCU19GSU5JU0hfU1RBUlRFRDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBCU19GSU5JU0hfRE9ORTsKICAgICAgICB9CiAgICAgICAgaWYgKHMubGFzdF9saXQpIHsKICAgICAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIEJTX0JMT0NLX0RPTkU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGVmbGF0ZV9ybGUocywgZmx1c2gpIHsKICAgICAgICB2YXIgYmZsdXNoOwogICAgICAgIHZhciBwcmV2OwogICAgICAgIHZhciBzY2FuLCBzdHJlbmQ7CiAgICAgICAgdmFyIF93aW4gPSBzLndpbmRvdzsKICAgICAgICBmb3IgKDsgOyApIHsKICAgICAgICAgIGlmIChzLmxvb2thaGVhZCA8PSBNQVhfTUFUQ0gpIHsKICAgICAgICAgICAgZmlsbF93aW5kb3cocyk7CiAgICAgICAgICAgIGlmIChzLmxvb2thaGVhZCA8PSBNQVhfTUFUQ0ggJiYgZmx1c2ggPT09IFpfTk9fRkxVU0gpIHsKICAgICAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBzLm1hdGNoX2xlbmd0aCA9IDA7CiAgICAgICAgICBpZiAocy5sb29rYWhlYWQgPj0gTUlOX01BVENIICYmIHMuc3Ryc3RhcnQgPiAwKSB7CiAgICAgICAgICAgIHNjYW4gPSBzLnN0cnN0YXJ0IC0gMTsKICAgICAgICAgICAgcHJldiA9IF93aW5bc2Nhbl07CiAgICAgICAgICAgIGlmIChwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmIHByZXYgPT09IF93aW5bKytzY2FuXSkgewogICAgICAgICAgICAgIHN0cmVuZCA9IHMuc3Ryc3RhcnQgKyBNQVhfTUFUQ0g7CiAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIH0gd2hpbGUgKHByZXYgPT09IF93aW5bKytzY2FuXSAmJiBwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmIHByZXYgPT09IF93aW5bKytzY2FuXSAmJiBwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmIHByZXYgPT09IF93aW5bKytzY2FuXSAmJiBwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgc2NhbiA8IHN0cmVuZCk7CiAgICAgICAgICAgICAgcy5tYXRjaF9sZW5ndGggPSBNQVhfTUFUQ0ggLSAoc3RyZW5kIC0gc2Nhbik7CiAgICAgICAgICAgICAgaWYgKHMubWF0Y2hfbGVuZ3RoID4gcy5sb29rYWhlYWQpIHsKICAgICAgICAgICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gcy5sb29rYWhlYWQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocy5tYXRjaF9sZW5ndGggPj0gTUlOX01BVENIKSB7CiAgICAgICAgICAgIGJmbHVzaCA9IHRyZWVzLl90cl90YWxseShzLCAxLCBzLm1hdGNoX2xlbmd0aCAtIE1JTl9NQVRDSCk7CiAgICAgICAgICAgIHMubG9va2FoZWFkIC09IHMubWF0Y2hfbGVuZ3RoOwogICAgICAgICAgICBzLnN0cnN0YXJ0ICs9IHMubWF0Y2hfbGVuZ3RoOwogICAgICAgICAgICBzLm1hdGNoX2xlbmd0aCA9IDA7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBiZmx1c2ggPSB0cmVlcy5fdHJfdGFsbHkocywgMCwgcy53aW5kb3dbcy5zdHJzdGFydF0pOwogICAgICAgICAgICBzLmxvb2thaGVhZC0tOwogICAgICAgICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYmZsdXNoKSB7CiAgICAgICAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcy5pbnNlcnQgPSAwOwogICAgICAgIGlmIChmbHVzaCA9PT0gWl9GSU5JU0gpIHsKICAgICAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgdHJ1ZSk7CiAgICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gQlNfRklOSVNIX1NUQVJURUQ7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gQlNfRklOSVNIX0RPTkU7CiAgICAgICAgfQogICAgICAgIGlmIChzLmxhc3RfbGl0KSB7CiAgICAgICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBCU19CTE9DS19ET05FOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRlZmxhdGVfaHVmZihzLCBmbHVzaCkgewogICAgICAgIHZhciBiZmx1c2g7CiAgICAgICAgZm9yICg7IDsgKSB7CiAgICAgICAgICBpZiAocy5sb29rYWhlYWQgPT09IDApIHsKICAgICAgICAgICAgZmlsbF93aW5kb3cocyk7CiAgICAgICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICAgICAgICAgIGlmIChmbHVzaCA9PT0gWl9OT19GTFVTSCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gMDsKICAgICAgICAgIGJmbHVzaCA9IHRyZWVzLl90cl90YWxseShzLCAwLCBzLndpbmRvd1tzLnN0cnN0YXJ0XSk7CiAgICAgICAgICBzLmxvb2thaGVhZC0tOwogICAgICAgICAgcy5zdHJzdGFydCsrOwogICAgICAgICAgaWYgKGJmbHVzaCkgewogICAgICAgICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHMuaW5zZXJ0ID0gMDsKICAgICAgICBpZiAoZmx1c2ggPT09IFpfRklOSVNIKSB7CiAgICAgICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIHRydWUpOwogICAgICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIEJTX0ZJTklTSF9TVEFSVEVEOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIEJTX0ZJTklTSF9ET05FOwogICAgICAgIH0KICAgICAgICBpZiAocy5sYXN0X2xpdCkgewogICAgICAgICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gQlNfQkxPQ0tfRE9ORTsKICAgICAgfQogICAgICBmdW5jdGlvbiBDb25maWcoZ29vZF9sZW5ndGgsIG1heF9sYXp5LCBuaWNlX2xlbmd0aCwgbWF4X2NoYWluLCBmdW5jKSB7CiAgICAgICAgdGhpcy5nb29kX2xlbmd0aCA9IGdvb2RfbGVuZ3RoOwogICAgICAgIHRoaXMubWF4X2xhenkgPSBtYXhfbGF6eTsKICAgICAgICB0aGlzLm5pY2VfbGVuZ3RoID0gbmljZV9sZW5ndGg7CiAgICAgICAgdGhpcy5tYXhfY2hhaW4gPSBtYXhfY2hhaW47CiAgICAgICAgdGhpcy5mdW5jID0gZnVuYzsKICAgICAgfQogICAgICB2YXIgY29uZmlndXJhdGlvbl90YWJsZTsKICAgICAgY29uZmlndXJhdGlvbl90YWJsZSA9IFsKICAgICAgICBuZXcgQ29uZmlnKDAsIDAsIDAsIDAsIGRlZmxhdGVfc3RvcmVkKSwKICAgICAgICBuZXcgQ29uZmlnKDQsIDQsIDgsIDQsIGRlZmxhdGVfZmFzdCksCiAgICAgICAgbmV3IENvbmZpZyg0LCA1LCAxNiwgOCwgZGVmbGF0ZV9mYXN0KSwKICAgICAgICBuZXcgQ29uZmlnKDQsIDYsIDMyLCAzMiwgZGVmbGF0ZV9mYXN0KSwKICAgICAgICBuZXcgQ29uZmlnKDQsIDQsIDE2LCAxNiwgZGVmbGF0ZV9zbG93KSwKICAgICAgICBuZXcgQ29uZmlnKDgsIDE2LCAzMiwgMzIsIGRlZmxhdGVfc2xvdyksCiAgICAgICAgbmV3IENvbmZpZyg4LCAxNiwgMTI4LCAxMjgsIGRlZmxhdGVfc2xvdyksCiAgICAgICAgbmV3IENvbmZpZyg4LCAzMiwgMTI4LCAyNTYsIGRlZmxhdGVfc2xvdyksCiAgICAgICAgbmV3IENvbmZpZygzMiwgMTI4LCAyNTgsIDEwMjQsIGRlZmxhdGVfc2xvdyksCiAgICAgICAgbmV3IENvbmZpZygzMiwgMjU4LCAyNTgsIDQwOTYsIGRlZmxhdGVfc2xvdykKICAgICAgXTsKICAgICAgZnVuY3Rpb24gbG1faW5pdChzKSB7CiAgICAgICAgcy53aW5kb3dfc2l6ZSA9IDIgKiBzLndfc2l6ZTsKICAgICAgICB6ZXJvKHMuaGVhZCk7CiAgICAgICAgcy5tYXhfbGF6eV9tYXRjaCA9IGNvbmZpZ3VyYXRpb25fdGFibGVbcy5sZXZlbF0ubWF4X2xhenk7CiAgICAgICAgcy5nb29kX21hdGNoID0gY29uZmlndXJhdGlvbl90YWJsZVtzLmxldmVsXS5nb29kX2xlbmd0aDsKICAgICAgICBzLm5pY2VfbWF0Y2ggPSBjb25maWd1cmF0aW9uX3RhYmxlW3MubGV2ZWxdLm5pY2VfbGVuZ3RoOwogICAgICAgIHMubWF4X2NoYWluX2xlbmd0aCA9IGNvbmZpZ3VyYXRpb25fdGFibGVbcy5sZXZlbF0ubWF4X2NoYWluOwogICAgICAgIHMuc3Ryc3RhcnQgPSAwOwogICAgICAgIHMuYmxvY2tfc3RhcnQgPSAwOwogICAgICAgIHMubG9va2FoZWFkID0gMDsKICAgICAgICBzLmluc2VydCA9IDA7CiAgICAgICAgcy5tYXRjaF9sZW5ndGggPSBzLnByZXZfbGVuZ3RoID0gTUlOX01BVENIIC0gMTsKICAgICAgICBzLm1hdGNoX2F2YWlsYWJsZSA9IDA7CiAgICAgICAgcy5pbnNfaCA9IDA7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gRGVmbGF0ZVN0YXRlKCkgewogICAgICAgIHRoaXMuc3RybSA9IG51bGw7CiAgICAgICAgdGhpcy5zdGF0dXMgPSAwOwogICAgICAgIHRoaXMucGVuZGluZ19idWYgPSBudWxsOwogICAgICAgIHRoaXMucGVuZGluZ19idWZfc2l6ZSA9IDA7CiAgICAgICAgdGhpcy5wZW5kaW5nX291dCA9IDA7CiAgICAgICAgdGhpcy5wZW5kaW5nID0gMDsKICAgICAgICB0aGlzLndyYXAgPSAwOwogICAgICAgIHRoaXMuZ3poZWFkID0gbnVsbDsKICAgICAgICB0aGlzLmd6aW5kZXggPSAwOwogICAgICAgIHRoaXMubWV0aG9kID0gWl9ERUZMQVRFRDsKICAgICAgICB0aGlzLmxhc3RfZmx1c2ggPSAtMTsKICAgICAgICB0aGlzLndfc2l6ZSA9IDA7CiAgICAgICAgdGhpcy53X2JpdHMgPSAwOwogICAgICAgIHRoaXMud19tYXNrID0gMDsKICAgICAgICB0aGlzLndpbmRvdyA9IG51bGw7CiAgICAgICAgdGhpcy53aW5kb3dfc2l6ZSA9IDA7CiAgICAgICAgdGhpcy5wcmV2ID0gbnVsbDsKICAgICAgICB0aGlzLmhlYWQgPSBudWxsOwogICAgICAgIHRoaXMuaW5zX2ggPSAwOwogICAgICAgIHRoaXMuaGFzaF9zaXplID0gMDsKICAgICAgICB0aGlzLmhhc2hfYml0cyA9IDA7CiAgICAgICAgdGhpcy5oYXNoX21hc2sgPSAwOwogICAgICAgIHRoaXMuaGFzaF9zaGlmdCA9IDA7CiAgICAgICAgdGhpcy5ibG9ja19zdGFydCA9IDA7CiAgICAgICAgdGhpcy5tYXRjaF9sZW5ndGggPSAwOwogICAgICAgIHRoaXMucHJldl9tYXRjaCA9IDA7CiAgICAgICAgdGhpcy5tYXRjaF9hdmFpbGFibGUgPSAwOwogICAgICAgIHRoaXMuc3Ryc3RhcnQgPSAwOwogICAgICAgIHRoaXMubWF0Y2hfc3RhcnQgPSAwOwogICAgICAgIHRoaXMubG9va2FoZWFkID0gMDsKICAgICAgICB0aGlzLnByZXZfbGVuZ3RoID0gMDsKICAgICAgICB0aGlzLm1heF9jaGFpbl9sZW5ndGggPSAwOwogICAgICAgIHRoaXMubWF4X2xhenlfbWF0Y2ggPSAwOwogICAgICAgIHRoaXMubGV2ZWwgPSAwOwogICAgICAgIHRoaXMuc3RyYXRlZ3kgPSAwOwogICAgICAgIHRoaXMuZ29vZF9tYXRjaCA9IDA7CiAgICAgICAgdGhpcy5uaWNlX21hdGNoID0gMDsKICAgICAgICB0aGlzLmR5bl9sdHJlZSA9IG5ldyB1dGlscy5CdWYxNihIRUFQX1NJWkUgKiAyKTsKICAgICAgICB0aGlzLmR5bl9kdHJlZSA9IG5ldyB1dGlscy5CdWYxNigoMiAqIERfQ09ERVMgKyAxKSAqIDIpOwogICAgICAgIHRoaXMuYmxfdHJlZSA9IG5ldyB1dGlscy5CdWYxNigoMiAqIEJMX0NPREVTICsgMSkgKiAyKTsKICAgICAgICB6ZXJvKHRoaXMuZHluX2x0cmVlKTsKICAgICAgICB6ZXJvKHRoaXMuZHluX2R0cmVlKTsKICAgICAgICB6ZXJvKHRoaXMuYmxfdHJlZSk7CiAgICAgICAgdGhpcy5sX2Rlc2MgPSBudWxsOwogICAgICAgIHRoaXMuZF9kZXNjID0gbnVsbDsKICAgICAgICB0aGlzLmJsX2Rlc2MgPSBudWxsOwogICAgICAgIHRoaXMuYmxfY291bnQgPSBuZXcgdXRpbHMuQnVmMTYoTUFYX0JJVFMgKyAxKTsKICAgICAgICB0aGlzLmhlYXAgPSBuZXcgdXRpbHMuQnVmMTYoMiAqIExfQ09ERVMgKyAxKTsKICAgICAgICB6ZXJvKHRoaXMuaGVhcCk7CiAgICAgICAgdGhpcy5oZWFwX2xlbiA9IDA7CiAgICAgICAgdGhpcy5oZWFwX21heCA9IDA7CiAgICAgICAgdGhpcy5kZXB0aCA9IG5ldyB1dGlscy5CdWYxNigyICogTF9DT0RFUyArIDEpOwogICAgICAgIHplcm8odGhpcy5kZXB0aCk7CiAgICAgICAgdGhpcy5sX2J1ZiA9IDA7CiAgICAgICAgdGhpcy5saXRfYnVmc2l6ZSA9IDA7CiAgICAgICAgdGhpcy5sYXN0X2xpdCA9IDA7CiAgICAgICAgdGhpcy5kX2J1ZiA9IDA7CiAgICAgICAgdGhpcy5vcHRfbGVuID0gMDsKICAgICAgICB0aGlzLnN0YXRpY19sZW4gPSAwOwogICAgICAgIHRoaXMubWF0Y2hlcyA9IDA7CiAgICAgICAgdGhpcy5pbnNlcnQgPSAwOwogICAgICAgIHRoaXMuYmlfYnVmID0gMDsKICAgICAgICB0aGlzLmJpX3ZhbGlkID0gMDsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZsYXRlUmVzZXRLZWVwKHN0cm0pIHsKICAgICAgICB2YXIgczsKICAgICAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsKICAgICAgICAgIHJldHVybiBlcnIoc3RybSwgWl9TVFJFQU1fRVJST1IpOwogICAgICAgIH0KICAgICAgICBzdHJtLnRvdGFsX2luID0gc3RybS50b3RhbF9vdXQgPSAwOwogICAgICAgIHN0cm0uZGF0YV90eXBlID0gWl9VTktOT1dOOwogICAgICAgIHMgPSBzdHJtLnN0YXRlOwogICAgICAgIHMucGVuZGluZyA9IDA7CiAgICAgICAgcy5wZW5kaW5nX291dCA9IDA7CiAgICAgICAgaWYgKHMud3JhcCA8IDApIHsKICAgICAgICAgIHMud3JhcCA9IC1zLndyYXA7CiAgICAgICAgfQogICAgICAgIHMuc3RhdHVzID0gcy53cmFwID8gSU5JVF9TVEFURSA6IEJVU1lfU1RBVEU7CiAgICAgICAgc3RybS5hZGxlciA9IHMud3JhcCA9PT0gMiA/IDAgOiAxOwogICAgICAgIHMubGFzdF9mbHVzaCA9IFpfTk9fRkxVU0g7CiAgICAgICAgdHJlZXMuX3RyX2luaXQocyk7CiAgICAgICAgcmV0dXJuIFpfT0s7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGVmbGF0ZVJlc2V0KHN0cm0pIHsKICAgICAgICB2YXIgcmV0ID0gZGVmbGF0ZVJlc2V0S2VlcChzdHJtKTsKICAgICAgICBpZiAocmV0ID09PSBaX09LKSB7CiAgICAgICAgICBsbV9pbml0KHN0cm0uc3RhdGUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmV0OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRlZmxhdGVTZXRIZWFkZXIoc3RybSwgaGVhZCkgewogICAgICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSkgewogICAgICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SOwogICAgICAgIH0KICAgICAgICBpZiAoc3RybS5zdGF0ZS53cmFwICE9PSAyKSB7CiAgICAgICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1I7CiAgICAgICAgfQogICAgICAgIHN0cm0uc3RhdGUuZ3poZWFkID0gaGVhZDsKICAgICAgICByZXR1cm4gWl9PSzsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZsYXRlSW5pdDIoc3RybSwgbGV2ZWwsIG1ldGhvZCwgd2luZG93Qml0cywgbWVtTGV2ZWwsIHN0cmF0ZWd5KSB7CiAgICAgICAgaWYgKCFzdHJtKSB7CiAgICAgICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1I7CiAgICAgICAgfQogICAgICAgIHZhciB3cmFwID0gMTsKICAgICAgICBpZiAobGV2ZWwgPT09IFpfREVGQVVMVF9DT01QUkVTU0lPTikgewogICAgICAgICAgbGV2ZWwgPSA2OwogICAgICAgIH0KICAgICAgICBpZiAod2luZG93Qml0cyA8IDApIHsKICAgICAgICAgIHdyYXAgPSAwOwogICAgICAgICAgd2luZG93Qml0cyA9IC13aW5kb3dCaXRzOwogICAgICAgIH0gZWxzZSBpZiAod2luZG93Qml0cyA+IDE1KSB7CiAgICAgICAgICB3cmFwID0gMjsKICAgICAgICAgIHdpbmRvd0JpdHMgLT0gMTY7CiAgICAgICAgfQogICAgICAgIGlmIChtZW1MZXZlbCA8IDEgfHwgbWVtTGV2ZWwgPiBNQVhfTUVNX0xFVkVMIHx8IG1ldGhvZCAhPT0gWl9ERUZMQVRFRCB8fCB3aW5kb3dCaXRzIDwgOCB8fCB3aW5kb3dCaXRzID4gMTUgfHwgbGV2ZWwgPCAwIHx8IGxldmVsID4gOSB8fCBzdHJhdGVneSA8IDAgfHwgc3RyYXRlZ3kgPiBaX0ZJWEVEKSB7CiAgICAgICAgICByZXR1cm4gZXJyKHN0cm0sIFpfU1RSRUFNX0VSUk9SKTsKICAgICAgICB9CiAgICAgICAgaWYgKHdpbmRvd0JpdHMgPT09IDgpIHsKICAgICAgICAgIHdpbmRvd0JpdHMgPSA5OwogICAgICAgIH0KICAgICAgICB2YXIgcyA9IG5ldyBEZWZsYXRlU3RhdGUoKTsKICAgICAgICBzdHJtLnN0YXRlID0gczsKICAgICAgICBzLnN0cm0gPSBzdHJtOwogICAgICAgIHMud3JhcCA9IHdyYXA7CiAgICAgICAgcy5nemhlYWQgPSBudWxsOwogICAgICAgIHMud19iaXRzID0gd2luZG93Qml0czsKICAgICAgICBzLndfc2l6ZSA9IDEgPDwgcy53X2JpdHM7CiAgICAgICAgcy53X21hc2sgPSBzLndfc2l6ZSAtIDE7CiAgICAgICAgcy5oYXNoX2JpdHMgPSBtZW1MZXZlbCArIDc7CiAgICAgICAgcy5oYXNoX3NpemUgPSAxIDw8IHMuaGFzaF9iaXRzOwogICAgICAgIHMuaGFzaF9tYXNrID0gcy5oYXNoX3NpemUgLSAxOwogICAgICAgIHMuaGFzaF9zaGlmdCA9IH5+KChzLmhhc2hfYml0cyArIE1JTl9NQVRDSCAtIDEpIC8gTUlOX01BVENIKTsKICAgICAgICBzLndpbmRvdyA9IG5ldyB1dGlscy5CdWY4KHMud19zaXplICogMik7CiAgICAgICAgcy5oZWFkID0gbmV3IHV0aWxzLkJ1ZjE2KHMuaGFzaF9zaXplKTsKICAgICAgICBzLnByZXYgPSBuZXcgdXRpbHMuQnVmMTYocy53X3NpemUpOwogICAgICAgIHMubGl0X2J1ZnNpemUgPSAxIDw8IG1lbUxldmVsICsgNjsKICAgICAgICBzLnBlbmRpbmdfYnVmX3NpemUgPSBzLmxpdF9idWZzaXplICogNDsKICAgICAgICBzLnBlbmRpbmdfYnVmID0gbmV3IHV0aWxzLkJ1Zjgocy5wZW5kaW5nX2J1Zl9zaXplKTsKICAgICAgICBzLmRfYnVmID0gMSAqIHMubGl0X2J1ZnNpemU7CiAgICAgICAgcy5sX2J1ZiA9ICgxICsgMikgKiBzLmxpdF9idWZzaXplOwogICAgICAgIHMubGV2ZWwgPSBsZXZlbDsKICAgICAgICBzLnN0cmF0ZWd5ID0gc3RyYXRlZ3k7CiAgICAgICAgcy5tZXRob2QgPSBtZXRob2Q7CiAgICAgICAgcmV0dXJuIGRlZmxhdGVSZXNldChzdHJtKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZsYXRlSW5pdChzdHJtLCBsZXZlbCkgewogICAgICAgIHJldHVybiBkZWZsYXRlSW5pdDIoc3RybSwgbGV2ZWwsIFpfREVGTEFURUQsIE1BWF9XQklUUywgREVGX01FTV9MRVZFTCwgWl9ERUZBVUxUX1NUUkFURUdZKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZsYXRlKHN0cm0sIGZsdXNoKSB7CiAgICAgICAgdmFyIG9sZF9mbHVzaCwgczsKICAgICAgICB2YXIgYmVnLCB2YWw7CiAgICAgICAgaWYgKCFzdHJtIHx8ICFzdHJtLnN0YXRlIHx8IGZsdXNoID4gWl9CTE9DSyB8fCBmbHVzaCA8IDApIHsKICAgICAgICAgIHJldHVybiBzdHJtID8gZXJyKHN0cm0sIFpfU1RSRUFNX0VSUk9SKSA6IFpfU1RSRUFNX0VSUk9SOwogICAgICAgIH0KICAgICAgICBzID0gc3RybS5zdGF0ZTsKICAgICAgICBpZiAoIXN0cm0ub3V0cHV0IHx8ICFzdHJtLmlucHV0ICYmIHN0cm0uYXZhaWxfaW4gIT09IDAgfHwgcy5zdGF0dXMgPT09IEZJTklTSF9TVEFURSAmJiBmbHVzaCAhPT0gWl9GSU5JU0gpIHsKICAgICAgICAgIHJldHVybiBlcnIoc3RybSwgc3RybS5hdmFpbF9vdXQgPT09IDAgPyBaX0JVRl9FUlJPUiA6IFpfU1RSRUFNX0VSUk9SKTsKICAgICAgICB9CiAgICAgICAgcy5zdHJtID0gc3RybTsKICAgICAgICBvbGRfZmx1c2ggPSBzLmxhc3RfZmx1c2g7CiAgICAgICAgcy5sYXN0X2ZsdXNoID0gZmx1c2g7CiAgICAgICAgaWYgKHMuc3RhdHVzID09PSBJTklUX1NUQVRFKSB7CiAgICAgICAgICBpZiAocy53cmFwID09PSAyKSB7CiAgICAgICAgICAgIHN0cm0uYWRsZXIgPSAwOwogICAgICAgICAgICBwdXRfYnl0ZShzLCAzMSk7CiAgICAgICAgICAgIHB1dF9ieXRlKHMsIDEzOSk7CiAgICAgICAgICAgIHB1dF9ieXRlKHMsIDgpOwogICAgICAgICAgICBpZiAoIXMuZ3poZWFkKSB7CiAgICAgICAgICAgICAgcHV0X2J5dGUocywgMCk7CiAgICAgICAgICAgICAgcHV0X2J5dGUocywgMCk7CiAgICAgICAgICAgICAgcHV0X2J5dGUocywgMCk7CiAgICAgICAgICAgICAgcHV0X2J5dGUocywgMCk7CiAgICAgICAgICAgICAgcHV0X2J5dGUocywgMCk7CiAgICAgICAgICAgICAgcHV0X2J5dGUocywgcy5sZXZlbCA9PT0gOSA/IDIgOiBzLnN0cmF0ZWd5ID49IFpfSFVGRk1BTl9PTkxZIHx8IHMubGV2ZWwgPCAyID8gNCA6IDApOwogICAgICAgICAgICAgIHB1dF9ieXRlKHMsIE9TX0NPREUpOwogICAgICAgICAgICAgIHMuc3RhdHVzID0gQlVTWV9TVEFURTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBwdXRfYnl0ZShzLCAocy5nemhlYWQudGV4dCA/IDEgOiAwKSArIChzLmd6aGVhZC5oY3JjID8gMiA6IDApICsgKCFzLmd6aGVhZC5leHRyYSA/IDAgOiA0KSArICghcy5nemhlYWQubmFtZSA/IDAgOiA4KSArICghcy5nemhlYWQuY29tbWVudCA/IDAgOiAxNikpOwogICAgICAgICAgICAgIHB1dF9ieXRlKHMsIHMuZ3poZWFkLnRpbWUgJiAyNTUpOwogICAgICAgICAgICAgIHB1dF9ieXRlKHMsIHMuZ3poZWFkLnRpbWUgPj4gOCAmIDI1NSk7CiAgICAgICAgICAgICAgcHV0X2J5dGUocywgcy5nemhlYWQudGltZSA+PiAxNiAmIDI1NSk7CiAgICAgICAgICAgICAgcHV0X2J5dGUocywgcy5nemhlYWQudGltZSA+PiAyNCAmIDI1NSk7CiAgICAgICAgICAgICAgcHV0X2J5dGUocywgcy5sZXZlbCA9PT0gOSA/IDIgOiBzLnN0cmF0ZWd5ID49IFpfSFVGRk1BTl9PTkxZIHx8IHMubGV2ZWwgPCAyID8gNCA6IDApOwogICAgICAgICAgICAgIHB1dF9ieXRlKHMsIHMuZ3poZWFkLm9zICYgMjU1KTsKICAgICAgICAgICAgICBpZiAocy5nemhlYWQuZXh0cmEgJiYgcy5nemhlYWQuZXh0cmEubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBwdXRfYnl0ZShzLCBzLmd6aGVhZC5leHRyYS5sZW5ndGggJiAyNTUpOwogICAgICAgICAgICAgICAgcHV0X2J5dGUocywgcy5nemhlYWQuZXh0cmEubGVuZ3RoID4+IDggJiAyNTUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAocy5nemhlYWQuaGNyYykgewogICAgICAgICAgICAgICAgc3RybS5hZGxlciA9IGNyYzMyKHN0cm0uYWRsZXIsIHMucGVuZGluZ19idWYsIHMucGVuZGluZywgMCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHMuZ3ppbmRleCA9IDA7CiAgICAgICAgICAgICAgcy5zdGF0dXMgPSBFWFRSQV9TVEFURTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIGhlYWRlciA9IFpfREVGTEFURUQgKyAocy53X2JpdHMgLSA4IDw8IDQpIDw8IDg7CiAgICAgICAgICAgIHZhciBsZXZlbF9mbGFncyA9IC0xOwogICAgICAgICAgICBpZiAocy5zdHJhdGVneSA+PSBaX0hVRkZNQU5fT05MWSB8fCBzLmxldmVsIDwgMikgewogICAgICAgICAgICAgIGxldmVsX2ZsYWdzID0gMDsKICAgICAgICAgICAgfSBlbHNlIGlmIChzLmxldmVsIDwgNikgewogICAgICAgICAgICAgIGxldmVsX2ZsYWdzID0gMTsKICAgICAgICAgICAgfSBlbHNlIGlmIChzLmxldmVsID09PSA2KSB7CiAgICAgICAgICAgICAgbGV2ZWxfZmxhZ3MgPSAyOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGxldmVsX2ZsYWdzID0gMzsKICAgICAgICAgICAgfQogICAgICAgICAgICBoZWFkZXIgfD0gbGV2ZWxfZmxhZ3MgPDwgNjsKICAgICAgICAgICAgaWYgKHMuc3Ryc3RhcnQgIT09IDApIHsKICAgICAgICAgICAgICBoZWFkZXIgfD0gUFJFU0VUX0RJQ1Q7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaGVhZGVyICs9IDMxIC0gaGVhZGVyICUgMzE7CiAgICAgICAgICAgIHMuc3RhdHVzID0gQlVTWV9TVEFURTsKICAgICAgICAgICAgcHV0U2hvcnRNU0IocywgaGVhZGVyKTsKICAgICAgICAgICAgaWYgKHMuc3Ryc3RhcnQgIT09IDApIHsKICAgICAgICAgICAgICBwdXRTaG9ydE1TQihzLCBzdHJtLmFkbGVyID4+PiAxNik7CiAgICAgICAgICAgICAgcHV0U2hvcnRNU0Iocywgc3RybS5hZGxlciAmIDY1NTM1KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdHJtLmFkbGVyID0gMTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHMuc3RhdHVzID09PSBFWFRSQV9TVEFURSkgewogICAgICAgICAgaWYgKHMuZ3poZWFkLmV4dHJhKSB7CiAgICAgICAgICAgIGJlZyA9IHMucGVuZGluZzsKICAgICAgICAgICAgd2hpbGUgKHMuZ3ppbmRleCA8IChzLmd6aGVhZC5leHRyYS5sZW5ndGggJiA2NTUzNSkpIHsKICAgICAgICAgICAgICBpZiAocy5wZW5kaW5nID09PSBzLnBlbmRpbmdfYnVmX3NpemUpIHsKICAgICAgICAgICAgICAgIGlmIChzLmd6aGVhZC5oY3JjICYmIHMucGVuZGluZyA+IGJlZykgewogICAgICAgICAgICAgICAgICBzdHJtLmFkbGVyID0gY3JjMzIoc3RybS5hZGxlciwgcy5wZW5kaW5nX2J1Ziwgcy5wZW5kaW5nIC0gYmVnLCBiZWcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZmx1c2hfcGVuZGluZyhzdHJtKTsKICAgICAgICAgICAgICAgIGJlZyA9IHMucGVuZGluZzsKICAgICAgICAgICAgICAgIGlmIChzLnBlbmRpbmcgPT09IHMucGVuZGluZ19idWZfc2l6ZSkgewogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcHV0X2J5dGUocywgcy5nemhlYWQuZXh0cmFbcy5nemluZGV4XSAmIDI1NSk7CiAgICAgICAgICAgICAgcy5nemluZGV4Kys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHMuZ3poZWFkLmhjcmMgJiYgcy5wZW5kaW5nID4gYmVnKSB7CiAgICAgICAgICAgICAgc3RybS5hZGxlciA9IGNyYzMyKHN0cm0uYWRsZXIsIHMucGVuZGluZ19idWYsIHMucGVuZGluZyAtIGJlZywgYmVnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocy5nemluZGV4ID09PSBzLmd6aGVhZC5leHRyYS5sZW5ndGgpIHsKICAgICAgICAgICAgICBzLmd6aW5kZXggPSAwOwogICAgICAgICAgICAgIHMuc3RhdHVzID0gTkFNRV9TVEFURTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcy5zdGF0dXMgPSBOQU1FX1NUQVRFOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAocy5zdGF0dXMgPT09IE5BTUVfU1RBVEUpIHsKICAgICAgICAgIGlmIChzLmd6aGVhZC5uYW1lKSB7CiAgICAgICAgICAgIGJlZyA9IHMucGVuZGluZzsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIGlmIChzLnBlbmRpbmcgPT09IHMucGVuZGluZ19idWZfc2l6ZSkgewogICAgICAgICAgICAgICAgaWYgKHMuZ3poZWFkLmhjcmMgJiYgcy5wZW5kaW5nID4gYmVnKSB7CiAgICAgICAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBjcmMzMihzdHJtLmFkbGVyLCBzLnBlbmRpbmdfYnVmLCBzLnBlbmRpbmcgLSBiZWcsIGJlZyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmbHVzaF9wZW5kaW5nKHN0cm0pOwogICAgICAgICAgICAgICAgYmVnID0gcy5wZW5kaW5nOwogICAgICAgICAgICAgICAgaWYgKHMucGVuZGluZyA9PT0gcy5wZW5kaW5nX2J1Zl9zaXplKSB7CiAgICAgICAgICAgICAgICAgIHZhbCA9IDE7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAocy5nemluZGV4IDwgcy5nemhlYWQubmFtZS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHZhbCA9IHMuZ3poZWFkLm5hbWUuY2hhckNvZGVBdChzLmd6aW5kZXgrKykgJiAyNTU7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhbCA9IDA7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHB1dF9ieXRlKHMsIHZhbCk7CiAgICAgICAgICAgIH0gd2hpbGUgKHZhbCAhPT0gMCk7CiAgICAgICAgICAgIGlmIChzLmd6aGVhZC5oY3JjICYmIHMucGVuZGluZyA+IGJlZykgewogICAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBjcmMzMihzdHJtLmFkbGVyLCBzLnBlbmRpbmdfYnVmLCBzLnBlbmRpbmcgLSBiZWcsIGJlZyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHZhbCA9PT0gMCkgewogICAgICAgICAgICAgIHMuZ3ppbmRleCA9IDA7CiAgICAgICAgICAgICAgcy5zdGF0dXMgPSBDT01NRU5UX1NUQVRFOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzLnN0YXR1cyA9IENPTU1FTlRfU1RBVEU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChzLnN0YXR1cyA9PT0gQ09NTUVOVF9TVEFURSkgewogICAgICAgICAgaWYgKHMuZ3poZWFkLmNvbW1lbnQpIHsKICAgICAgICAgICAgYmVnID0gcy5wZW5kaW5nOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgaWYgKHMucGVuZGluZyA9PT0gcy5wZW5kaW5nX2J1Zl9zaXplKSB7CiAgICAgICAgICAgICAgICBpZiAocy5nemhlYWQuaGNyYyAmJiBzLnBlbmRpbmcgPiBiZWcpIHsKICAgICAgICAgICAgICAgICAgc3RybS5hZGxlciA9IGNyYzMyKHN0cm0uYWRsZXIsIHMucGVuZGluZ19idWYsIHMucGVuZGluZyAtIGJlZywgYmVnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZsdXNoX3BlbmRpbmcoc3RybSk7CiAgICAgICAgICAgICAgICBiZWcgPSBzLnBlbmRpbmc7CiAgICAgICAgICAgICAgICBpZiAocy5wZW5kaW5nID09PSBzLnBlbmRpbmdfYnVmX3NpemUpIHsKICAgICAgICAgICAgICAgICAgdmFsID0gMTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzLmd6aW5kZXggPCBzLmd6aGVhZC5jb21tZW50Lmxlbmd0aCkgewogICAgICAgICAgICAgICAgdmFsID0gcy5nemhlYWQuY29tbWVudC5jaGFyQ29kZUF0KHMuZ3ppbmRleCsrKSAmIDI1NTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFsID0gMDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcHV0X2J5dGUocywgdmFsKTsKICAgICAgICAgICAgfSB3aGlsZSAodmFsICE9PSAwKTsKICAgICAgICAgICAgaWYgKHMuZ3poZWFkLmhjcmMgJiYgcy5wZW5kaW5nID4gYmVnKSB7CiAgICAgICAgICAgICAgc3RybS5hZGxlciA9IGNyYzMyKHN0cm0uYWRsZXIsIHMucGVuZGluZ19idWYsIHMucGVuZGluZyAtIGJlZywgYmVnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodmFsID09PSAwKSB7CiAgICAgICAgICAgICAgcy5zdGF0dXMgPSBIQ1JDX1NUQVRFOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzLnN0YXR1cyA9IEhDUkNfU1RBVEU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChzLnN0YXR1cyA9PT0gSENSQ19TVEFURSkgewogICAgICAgICAgaWYgKHMuZ3poZWFkLmhjcmMpIHsKICAgICAgICAgICAgaWYgKHMucGVuZGluZyArIDIgPiBzLnBlbmRpbmdfYnVmX3NpemUpIHsKICAgICAgICAgICAgICBmbHVzaF9wZW5kaW5nKHN0cm0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzLnBlbmRpbmcgKyAyIDw9IHMucGVuZGluZ19idWZfc2l6ZSkgewogICAgICAgICAgICAgIHB1dF9ieXRlKHMsIHN0cm0uYWRsZXIgJiAyNTUpOwogICAgICAgICAgICAgIHB1dF9ieXRlKHMsIHN0cm0uYWRsZXIgPj4gOCAmIDI1NSk7CiAgICAgICAgICAgICAgc3RybS5hZGxlciA9IDA7CiAgICAgICAgICAgICAgcy5zdGF0dXMgPSBCVVNZX1NUQVRFOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzLnN0YXR1cyA9IEJVU1lfU1RBVEU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChzLnBlbmRpbmcgIT09IDApIHsKICAgICAgICAgIGZsdXNoX3BlbmRpbmcoc3RybSk7CiAgICAgICAgICBpZiAoc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICAgICAgcy5sYXN0X2ZsdXNoID0gLTE7CiAgICAgICAgICAgIHJldHVybiBaX09LOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoc3RybS5hdmFpbF9pbiA9PT0gMCAmJiByYW5rKGZsdXNoKSA8PSByYW5rKG9sZF9mbHVzaCkgJiYgZmx1c2ggIT09IFpfRklOSVNIKSB7CiAgICAgICAgICByZXR1cm4gZXJyKHN0cm0sIFpfQlVGX0VSUk9SKTsKICAgICAgICB9CiAgICAgICAgaWYgKHMuc3RhdHVzID09PSBGSU5JU0hfU1RBVEUgJiYgc3RybS5hdmFpbF9pbiAhPT0gMCkgewogICAgICAgICAgcmV0dXJuIGVycihzdHJtLCBaX0JVRl9FUlJPUik7CiAgICAgICAgfQogICAgICAgIGlmIChzdHJtLmF2YWlsX2luICE9PSAwIHx8IHMubG9va2FoZWFkICE9PSAwIHx8IGZsdXNoICE9PSBaX05PX0ZMVVNIICYmIHMuc3RhdHVzICE9PSBGSU5JU0hfU1RBVEUpIHsKICAgICAgICAgIHZhciBic3RhdGUgPSBzLnN0cmF0ZWd5ID09PSBaX0hVRkZNQU5fT05MWSA/IGRlZmxhdGVfaHVmZihzLCBmbHVzaCkgOiBzLnN0cmF0ZWd5ID09PSBaX1JMRSA/IGRlZmxhdGVfcmxlKHMsIGZsdXNoKSA6IGNvbmZpZ3VyYXRpb25fdGFibGVbcy5sZXZlbF0uZnVuYyhzLCBmbHVzaCk7CiAgICAgICAgICBpZiAoYnN0YXRlID09PSBCU19GSU5JU0hfU1RBUlRFRCB8fCBic3RhdGUgPT09IEJTX0ZJTklTSF9ET05FKSB7CiAgICAgICAgICAgIHMuc3RhdHVzID0gRklOSVNIX1NUQVRFOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGJzdGF0ZSA9PT0gQlNfTkVFRF9NT1JFIHx8IGJzdGF0ZSA9PT0gQlNfRklOSVNIX1NUQVJURUQpIHsKICAgICAgICAgICAgaWYgKHN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICAgICAgcy5sYXN0X2ZsdXNoID0gLTE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIFpfT0s7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYnN0YXRlID09PSBCU19CTE9DS19ET05FKSB7CiAgICAgICAgICAgIGlmIChmbHVzaCA9PT0gWl9QQVJUSUFMX0ZMVVNIKSB7CiAgICAgICAgICAgICAgdHJlZXMuX3RyX2FsaWduKHMpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGZsdXNoICE9PSBaX0JMT0NLKSB7CiAgICAgICAgICAgICAgdHJlZXMuX3RyX3N0b3JlZF9ibG9jayhzLCAwLCAwLCBmYWxzZSk7CiAgICAgICAgICAgICAgaWYgKGZsdXNoID09PSBaX0ZVTExfRkxVU0gpIHsKICAgICAgICAgICAgICAgIHplcm8ocy5oZWFkKTsKICAgICAgICAgICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICAgICAgICAgICAgICBzLnN0cnN0YXJ0ID0gMDsKICAgICAgICAgICAgICAgICAgcy5ibG9ja19zdGFydCA9IDA7CiAgICAgICAgICAgICAgICAgIHMuaW5zZXJ0ID0gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmx1c2hfcGVuZGluZyhzdHJtKTsKICAgICAgICAgICAgaWYgKHN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICAgICAgcy5sYXN0X2ZsdXNoID0gLTE7CiAgICAgICAgICAgICAgcmV0dXJuIFpfT0s7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGZsdXNoICE9PSBaX0ZJTklTSCkgewogICAgICAgICAgcmV0dXJuIFpfT0s7CiAgICAgICAgfQogICAgICAgIGlmIChzLndyYXAgPD0gMCkgewogICAgICAgICAgcmV0dXJuIFpfU1RSRUFNX0VORDsKICAgICAgICB9CiAgICAgICAgaWYgKHMud3JhcCA9PT0gMikgewogICAgICAgICAgcHV0X2J5dGUocywgc3RybS5hZGxlciAmIDI1NSk7CiAgICAgICAgICBwdXRfYnl0ZShzLCBzdHJtLmFkbGVyID4+IDggJiAyNTUpOwogICAgICAgICAgcHV0X2J5dGUocywgc3RybS5hZGxlciA+PiAxNiAmIDI1NSk7CiAgICAgICAgICBwdXRfYnl0ZShzLCBzdHJtLmFkbGVyID4+IDI0ICYgMjU1KTsKICAgICAgICAgIHB1dF9ieXRlKHMsIHN0cm0udG90YWxfaW4gJiAyNTUpOwogICAgICAgICAgcHV0X2J5dGUocywgc3RybS50b3RhbF9pbiA+PiA4ICYgMjU1KTsKICAgICAgICAgIHB1dF9ieXRlKHMsIHN0cm0udG90YWxfaW4gPj4gMTYgJiAyNTUpOwogICAgICAgICAgcHV0X2J5dGUocywgc3RybS50b3RhbF9pbiA+PiAyNCAmIDI1NSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHB1dFNob3J0TVNCKHMsIHN0cm0uYWRsZXIgPj4+IDE2KTsKICAgICAgICAgIHB1dFNob3J0TVNCKHMsIHN0cm0uYWRsZXIgJiA2NTUzNSk7CiAgICAgICAgfQogICAgICAgIGZsdXNoX3BlbmRpbmcoc3RybSk7CiAgICAgICAgaWYgKHMud3JhcCA+IDApIHsKICAgICAgICAgIHMud3JhcCA9IC1zLndyYXA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzLnBlbmRpbmcgIT09IDAgPyBaX09LIDogWl9TVFJFQU1fRU5EOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRlZmxhdGVFbmQoc3RybSkgewogICAgICAgIHZhciBzdGF0dXM7CiAgICAgICAgaWYgKCFzdHJtIHx8ICFzdHJtLnN0YXRlKSB7CiAgICAgICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1I7CiAgICAgICAgfQogICAgICAgIHN0YXR1cyA9IHN0cm0uc3RhdGUuc3RhdHVzOwogICAgICAgIGlmIChzdGF0dXMgIT09IElOSVRfU1RBVEUgJiYgc3RhdHVzICE9PSBFWFRSQV9TVEFURSAmJiBzdGF0dXMgIT09IE5BTUVfU1RBVEUgJiYgc3RhdHVzICE9PSBDT01NRU5UX1NUQVRFICYmIHN0YXR1cyAhPT0gSENSQ19TVEFURSAmJiBzdGF0dXMgIT09IEJVU1lfU1RBVEUgJiYgc3RhdHVzICE9PSBGSU5JU0hfU1RBVEUpIHsKICAgICAgICAgIHJldHVybiBlcnIoc3RybSwgWl9TVFJFQU1fRVJST1IpOwogICAgICAgIH0KICAgICAgICBzdHJtLnN0YXRlID0gbnVsbDsKICAgICAgICByZXR1cm4gc3RhdHVzID09PSBCVVNZX1NUQVRFID8gZXJyKHN0cm0sIFpfREFUQV9FUlJPUikgOiBaX09LOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRlZmxhdGVTZXREaWN0aW9uYXJ5KHN0cm0sIGRpY3Rpb25hcnkpIHsKICAgICAgICB2YXIgZGljdExlbmd0aCA9IGRpY3Rpb25hcnkubGVuZ3RoOwogICAgICAgIHZhciBzOwogICAgICAgIHZhciBzdHIsIG47CiAgICAgICAgdmFyIHdyYXA7CiAgICAgICAgdmFyIGF2YWlsOwogICAgICAgIHZhciBuZXh0OwogICAgICAgIHZhciBpbnB1dDsKICAgICAgICB2YXIgdG1wRGljdDsKICAgICAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsKICAgICAgICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUjsKICAgICAgICB9CiAgICAgICAgcyA9IHN0cm0uc3RhdGU7CiAgICAgICAgd3JhcCA9IHMud3JhcDsKICAgICAgICBpZiAod3JhcCA9PT0gMiB8fCB3cmFwID09PSAxICYmIHMuc3RhdHVzICE9PSBJTklUX1NUQVRFIHx8IHMubG9va2FoZWFkKSB7CiAgICAgICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1I7CiAgICAgICAgfQogICAgICAgIGlmICh3cmFwID09PSAxKSB7CiAgICAgICAgICBzdHJtLmFkbGVyID0gYWRsZXIzMihzdHJtLmFkbGVyLCBkaWN0aW9uYXJ5LCBkaWN0TGVuZ3RoLCAwKTsKICAgICAgICB9CiAgICAgICAgcy53cmFwID0gMDsKICAgICAgICBpZiAoZGljdExlbmd0aCA+PSBzLndfc2l6ZSkgewogICAgICAgICAgaWYgKHdyYXAgPT09IDApIHsKICAgICAgICAgICAgemVybyhzLmhlYWQpOwogICAgICAgICAgICBzLnN0cnN0YXJ0ID0gMDsKICAgICAgICAgICAgcy5ibG9ja19zdGFydCA9IDA7CiAgICAgICAgICAgIHMuaW5zZXJ0ID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIHRtcERpY3QgPSBuZXcgdXRpbHMuQnVmOChzLndfc2l6ZSk7CiAgICAgICAgICB1dGlscy5hcnJheVNldCh0bXBEaWN0LCBkaWN0aW9uYXJ5LCBkaWN0TGVuZ3RoIC0gcy53X3NpemUsIHMud19zaXplLCAwKTsKICAgICAgICAgIGRpY3Rpb25hcnkgPSB0bXBEaWN0OwogICAgICAgICAgZGljdExlbmd0aCA9IHMud19zaXplOwogICAgICAgIH0KICAgICAgICBhdmFpbCA9IHN0cm0uYXZhaWxfaW47CiAgICAgICAgbmV4dCA9IHN0cm0ubmV4dF9pbjsKICAgICAgICBpbnB1dCA9IHN0cm0uaW5wdXQ7CiAgICAgICAgc3RybS5hdmFpbF9pbiA9IGRpY3RMZW5ndGg7CiAgICAgICAgc3RybS5uZXh0X2luID0gMDsKICAgICAgICBzdHJtLmlucHV0ID0gZGljdGlvbmFyeTsKICAgICAgICBmaWxsX3dpbmRvdyhzKTsKICAgICAgICB3aGlsZSAocy5sb29rYWhlYWQgPj0gTUlOX01BVENIKSB7CiAgICAgICAgICBzdHIgPSBzLnN0cnN0YXJ0OwogICAgICAgICAgbiA9IHMubG9va2FoZWFkIC0gKE1JTl9NQVRDSCAtIDEpOwogICAgICAgICAgZG8gewogICAgICAgICAgICBzLmluc19oID0gKHMuaW5zX2ggPDwgcy5oYXNoX3NoaWZ0IF4gcy53aW5kb3dbc3RyICsgTUlOX01BVENIIC0gMV0pICYgcy5oYXNoX21hc2s7CiAgICAgICAgICAgIHMucHJldltzdHIgJiBzLndfbWFza10gPSBzLmhlYWRbcy5pbnNfaF07CiAgICAgICAgICAgIHMuaGVhZFtzLmluc19oXSA9IHN0cjsKICAgICAgICAgICAgc3RyKys7CiAgICAgICAgICB9IHdoaWxlICgtLW4pOwogICAgICAgICAgcy5zdHJzdGFydCA9IHN0cjsKICAgICAgICAgIHMubG9va2FoZWFkID0gTUlOX01BVENIIC0gMTsKICAgICAgICAgIGZpbGxfd2luZG93KHMpOwogICAgICAgIH0KICAgICAgICBzLnN0cnN0YXJ0ICs9IHMubG9va2FoZWFkOwogICAgICAgIHMuYmxvY2tfc3RhcnQgPSBzLnN0cnN0YXJ0OwogICAgICAgIHMuaW5zZXJ0ID0gcy5sb29rYWhlYWQ7CiAgICAgICAgcy5sb29rYWhlYWQgPSAwOwogICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gcy5wcmV2X2xlbmd0aCA9IE1JTl9NQVRDSCAtIDE7CiAgICAgICAgcy5tYXRjaF9hdmFpbGFibGUgPSAwOwogICAgICAgIHN0cm0ubmV4dF9pbiA9IG5leHQ7CiAgICAgICAgc3RybS5pbnB1dCA9IGlucHV0OwogICAgICAgIHN0cm0uYXZhaWxfaW4gPSBhdmFpbDsKICAgICAgICBzLndyYXAgPSB3cmFwOwogICAgICAgIHJldHVybiBaX09LOwogICAgICB9CiAgICAgIGV4cG9ydHMuZGVmbGF0ZUluaXQgPSBkZWZsYXRlSW5pdDsKICAgICAgZXhwb3J0cy5kZWZsYXRlSW5pdDIgPSBkZWZsYXRlSW5pdDI7CiAgICAgIGV4cG9ydHMuZGVmbGF0ZVJlc2V0ID0gZGVmbGF0ZVJlc2V0OwogICAgICBleHBvcnRzLmRlZmxhdGVSZXNldEtlZXAgPSBkZWZsYXRlUmVzZXRLZWVwOwogICAgICBleHBvcnRzLmRlZmxhdGVTZXRIZWFkZXIgPSBkZWZsYXRlU2V0SGVhZGVyOwogICAgICBleHBvcnRzLmRlZmxhdGUgPSBkZWZsYXRlOwogICAgICBleHBvcnRzLmRlZmxhdGVFbmQgPSBkZWZsYXRlRW5kOwogICAgICBleHBvcnRzLmRlZmxhdGVTZXREaWN0aW9uYXJ5ID0gZGVmbGF0ZVNldERpY3Rpb25hcnk7CiAgICAgIGV4cG9ydHMuZGVmbGF0ZUluZm8gPSAicGFrbyBkZWZsYXRlIChmcm9tIE5vZGVjYSBwcm9qZWN0KSI7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9wYWtvL2xpYi91dGlscy9zdHJpbmdzLmpzCiAgdmFyIHJlcXVpcmVfc3RyaW5ncyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9wYWtvL2xpYi91dGlscy9zdHJpbmdzLmpzIihleHBvcnRzKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgdXRpbHMgPSByZXF1aXJlX2NvbW1vbjIoKTsKICAgICAgdmFyIFNUUl9BUFBMWV9PSyA9IHRydWU7CiAgICAgIHZhciBTVFJfQVBQTFlfVUlBX09LID0gdHJ1ZTsKICAgICAgdHJ5IHsKICAgICAgICBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIFswXSk7CiAgICAgIH0gY2F0Y2ggKF9fKSB7CiAgICAgICAgU1RSX0FQUExZX09LID0gZmFsc2U7CiAgICAgIH0KICAgICAgdHJ5IHsKICAgICAgICBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIG5ldyBVaW50OEFycmF5KDEpKTsKICAgICAgfSBjYXRjaCAoX18pIHsKICAgICAgICBTVFJfQVBQTFlfVUlBX09LID0gZmFsc2U7CiAgICAgIH0KICAgICAgdmFyIF91dGY4bGVuID0gbmV3IHV0aWxzLkJ1ZjgoMjU2KTsKICAgICAgZm9yIChxID0gMDsgcSA8IDI1NjsgcSsrKSB7CiAgICAgICAgX3V0ZjhsZW5bcV0gPSBxID49IDI1MiA/IDYgOiBxID49IDI0OCA/IDUgOiBxID49IDI0MCA/IDQgOiBxID49IDIyNCA/IDMgOiBxID49IDE5MiA/IDIgOiAxOwogICAgICB9CiAgICAgIHZhciBxOwogICAgICBfdXRmOGxlblsyNTRdID0gX3V0ZjhsZW5bMjU0XSA9IDE7CiAgICAgIGV4cG9ydHMuc3RyaW5nMmJ1ZiA9IGZ1bmN0aW9uKHN0cikgewogICAgICAgIHZhciBidWYsIGMsIGMyLCBtX3BvcywgaSwgc3RyX2xlbiA9IHN0ci5sZW5ndGgsIGJ1Zl9sZW4gPSAwOwogICAgICAgIGZvciAobV9wb3MgPSAwOyBtX3BvcyA8IHN0cl9sZW47IG1fcG9zKyspIHsKICAgICAgICAgIGMgPSBzdHIuY2hhckNvZGVBdChtX3Bvcyk7CiAgICAgICAgICBpZiAoKGMgJiA2NDUxMikgPT09IDU1Mjk2ICYmIG1fcG9zICsgMSA8IHN0cl9sZW4pIHsKICAgICAgICAgICAgYzIgPSBzdHIuY2hhckNvZGVBdChtX3BvcyArIDEpOwogICAgICAgICAgICBpZiAoKGMyICYgNjQ1MTIpID09PSA1NjMyMCkgewogICAgICAgICAgICAgIGMgPSA2NTUzNiArIChjIC0gNTUyOTYgPDwgMTApICsgKGMyIC0gNTYzMjApOwogICAgICAgICAgICAgIG1fcG9zKys7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGJ1Zl9sZW4gKz0gYyA8IDEyOCA/IDEgOiBjIDwgMjA0OCA/IDIgOiBjIDwgNjU1MzYgPyAzIDogNDsKICAgICAgICB9CiAgICAgICAgYnVmID0gbmV3IHV0aWxzLkJ1ZjgoYnVmX2xlbik7CiAgICAgICAgZm9yIChpID0gMCwgbV9wb3MgPSAwOyBpIDwgYnVmX2xlbjsgbV9wb3MrKykgewogICAgICAgICAgYyA9IHN0ci5jaGFyQ29kZUF0KG1fcG9zKTsKICAgICAgICAgIGlmICgoYyAmIDY0NTEyKSA9PT0gNTUyOTYgJiYgbV9wb3MgKyAxIDwgc3RyX2xlbikgewogICAgICAgICAgICBjMiA9IHN0ci5jaGFyQ29kZUF0KG1fcG9zICsgMSk7CiAgICAgICAgICAgIGlmICgoYzIgJiA2NDUxMikgPT09IDU2MzIwKSB7CiAgICAgICAgICAgICAgYyA9IDY1NTM2ICsgKGMgLSA1NTI5NiA8PCAxMCkgKyAoYzIgLSA1NjMyMCk7CiAgICAgICAgICAgICAgbV9wb3MrKzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKGMgPCAxMjgpIHsKICAgICAgICAgICAgYnVmW2krK10gPSBjOwogICAgICAgICAgfSBlbHNlIGlmIChjIDwgMjA0OCkgewogICAgICAgICAgICBidWZbaSsrXSA9IDE5MiB8IGMgPj4+IDY7CiAgICAgICAgICAgIGJ1ZltpKytdID0gMTI4IHwgYyAmIDYzOwogICAgICAgICAgfSBlbHNlIGlmIChjIDwgNjU1MzYpIHsKICAgICAgICAgICAgYnVmW2krK10gPSAyMjQgfCBjID4+PiAxMjsKICAgICAgICAgICAgYnVmW2krK10gPSAxMjggfCBjID4+PiA2ICYgNjM7CiAgICAgICAgICAgIGJ1ZltpKytdID0gMTI4IHwgYyAmIDYzOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYnVmW2krK10gPSAyNDAgfCBjID4+PiAxODsKICAgICAgICAgICAgYnVmW2krK10gPSAxMjggfCBjID4+PiAxMiAmIDYzOwogICAgICAgICAgICBidWZbaSsrXSA9IDEyOCB8IGMgPj4+IDYgJiA2MzsKICAgICAgICAgICAgYnVmW2krK10gPSAxMjggfCBjICYgNjM7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBidWY7CiAgICAgIH07CiAgICAgIGZ1bmN0aW9uIGJ1ZjJiaW5zdHJpbmcoYnVmLCBsZW4pIHsKICAgICAgICBpZiAobGVuIDwgNjU1MzQpIHsKICAgICAgICAgIGlmIChidWYuc3ViYXJyYXkgJiYgU1RSX0FQUExZX1VJQV9PSyB8fCAhYnVmLnN1YmFycmF5ICYmIFNUUl9BUFBMWV9PSykgewogICAgICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCB1dGlscy5zaHJpbmtCdWYoYnVmLCBsZW4pKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdmFyIHJlc3VsdCA9ICIiOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIHJlc3VsdCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGJ1ZltpXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgZXhwb3J0cy5idWYyYmluc3RyaW5nID0gZnVuY3Rpb24oYnVmKSB7CiAgICAgICAgcmV0dXJuIGJ1ZjJiaW5zdHJpbmcoYnVmLCBidWYubGVuZ3RoKTsKICAgICAgfTsKICAgICAgZXhwb3J0cy5iaW5zdHJpbmcyYnVmID0gZnVuY3Rpb24oc3RyKSB7CiAgICAgICAgdmFyIGJ1ZiA9IG5ldyB1dGlscy5CdWY4KHN0ci5sZW5ndGgpOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBidWYubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIGJ1ZltpXSA9IHN0ci5jaGFyQ29kZUF0KGkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYnVmOwogICAgICB9OwogICAgICBleHBvcnRzLmJ1ZjJzdHJpbmcgPSBmdW5jdGlvbihidWYsIG1heCkgewogICAgICAgIHZhciBpLCBvdXQsIGMsIGNfbGVuOwogICAgICAgIHZhciBsZW4gPSBtYXggfHwgYnVmLmxlbmd0aDsKICAgICAgICB2YXIgdXRmMTZidWYgPSBuZXcgQXJyYXkobGVuICogMik7CiAgICAgICAgZm9yIChvdXQgPSAwLCBpID0gMDsgaSA8IGxlbjsgKSB7CiAgICAgICAgICBjID0gYnVmW2krK107CiAgICAgICAgICBpZiAoYyA8IDEyOCkgewogICAgICAgICAgICB1dGYxNmJ1ZltvdXQrK10gPSBjOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGNfbGVuID0gX3V0ZjhsZW5bY107CiAgICAgICAgICBpZiAoY19sZW4gPiA0KSB7CiAgICAgICAgICAgIHV0ZjE2YnVmW291dCsrXSA9IDY1NTMzOwogICAgICAgICAgICBpICs9IGNfbGVuIC0gMTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBjICY9IGNfbGVuID09PSAyID8gMzEgOiBjX2xlbiA9PT0gMyA/IDE1IDogNzsKICAgICAgICAgIHdoaWxlIChjX2xlbiA+IDEgJiYgaSA8IGxlbikgewogICAgICAgICAgICBjID0gYyA8PCA2IHwgYnVmW2krK10gJiA2MzsKICAgICAgICAgICAgY19sZW4tLTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChjX2xlbiA+IDEpIHsKICAgICAgICAgICAgdXRmMTZidWZbb3V0KytdID0gNjU1MzM7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGMgPCA2NTUzNikgewogICAgICAgICAgICB1dGYxNmJ1ZltvdXQrK10gPSBjOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYyAtPSA2NTUzNjsKICAgICAgICAgICAgdXRmMTZidWZbb3V0KytdID0gNTUyOTYgfCBjID4+IDEwICYgMTAyMzsKICAgICAgICAgICAgdXRmMTZidWZbb3V0KytdID0gNTYzMjAgfCBjICYgMTAyMzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJ1ZjJiaW5zdHJpbmcodXRmMTZidWYsIG91dCk7CiAgICAgIH07CiAgICAgIGV4cG9ydHMudXRmOGJvcmRlciA9IGZ1bmN0aW9uKGJ1ZiwgbWF4KSB7CiAgICAgICAgdmFyIHBvczsKICAgICAgICBtYXggPSBtYXggfHwgYnVmLmxlbmd0aDsKICAgICAgICBpZiAobWF4ID4gYnVmLmxlbmd0aCkgewogICAgICAgICAgbWF4ID0gYnVmLmxlbmd0aDsKICAgICAgICB9CiAgICAgICAgcG9zID0gbWF4IC0gMTsKICAgICAgICB3aGlsZSAocG9zID49IDAgJiYgKGJ1Zltwb3NdICYgMTkyKSA9PT0gMTI4KSB7CiAgICAgICAgICBwb3MtLTsKICAgICAgICB9CiAgICAgICAgaWYgKHBvcyA8IDApIHsKICAgICAgICAgIHJldHVybiBtYXg7CiAgICAgICAgfQogICAgICAgIGlmIChwb3MgPT09IDApIHsKICAgICAgICAgIHJldHVybiBtYXg7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwb3MgKyBfdXRmOGxlbltidWZbcG9zXV0gPiBtYXggPyBwb3MgOiBtYXg7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9wYWtvL2xpYi96bGliL3pzdHJlYW0uanMKICB2YXIgcmVxdWlyZV96c3RyZWFtID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL3Bha28vbGliL3psaWIvenN0cmVhbS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBaU3RyZWFtKCkgewogICAgICAgIHRoaXMuaW5wdXQgPSBudWxsOwogICAgICAgIHRoaXMubmV4dF9pbiA9IDA7CiAgICAgICAgdGhpcy5hdmFpbF9pbiA9IDA7CiAgICAgICAgdGhpcy50b3RhbF9pbiA9IDA7CiAgICAgICAgdGhpcy5vdXRwdXQgPSBudWxsOwogICAgICAgIHRoaXMubmV4dF9vdXQgPSAwOwogICAgICAgIHRoaXMuYXZhaWxfb3V0ID0gMDsKICAgICAgICB0aGlzLnRvdGFsX291dCA9IDA7CiAgICAgICAgdGhpcy5tc2cgPSAiIjsKICAgICAgICB0aGlzLnN0YXRlID0gbnVsbDsKICAgICAgICB0aGlzLmRhdGFfdHlwZSA9IDI7CiAgICAgICAgdGhpcy5hZGxlciA9IDA7CiAgICAgIH0KICAgICAgbW9kdWxlLmV4cG9ydHMgPSBaU3RyZWFtOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvcGFrby9saWIvZGVmbGF0ZS5qcwogIHZhciByZXF1aXJlX2RlZmxhdGUyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL3Bha28vbGliL2RlZmxhdGUuanMiKGV4cG9ydHMpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciB6bGliX2RlZmxhdGUgPSByZXF1aXJlX2RlZmxhdGUoKTsKICAgICAgdmFyIHV0aWxzID0gcmVxdWlyZV9jb21tb24yKCk7CiAgICAgIHZhciBzdHJpbmdzID0gcmVxdWlyZV9zdHJpbmdzKCk7CiAgICAgIHZhciBtc2cgPSByZXF1aXJlX21lc3NhZ2VzMigpOwogICAgICB2YXIgWlN0cmVhbSA9IHJlcXVpcmVfenN0cmVhbSgpOwogICAgICB2YXIgdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nOwogICAgICB2YXIgWl9OT19GTFVTSCA9IDA7CiAgICAgIHZhciBaX0ZJTklTSCA9IDQ7CiAgICAgIHZhciBaX09LID0gMDsKICAgICAgdmFyIFpfU1RSRUFNX0VORCA9IDE7CiAgICAgIHZhciBaX1NZTkNfRkxVU0ggPSAyOwogICAgICB2YXIgWl9ERUZBVUxUX0NPTVBSRVNTSU9OID0gLTE7CiAgICAgIHZhciBaX0RFRkFVTFRfU1RSQVRFR1kgPSAwOwogICAgICB2YXIgWl9ERUZMQVRFRCA9IDg7CiAgICAgIGZ1bmN0aW9uIERlZmxhdGUob3B0aW9ucykgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBEZWZsYXRlKSkKICAgICAgICAgIHJldHVybiBuZXcgRGVmbGF0ZShvcHRpb25zKTsKICAgICAgICB0aGlzLm9wdGlvbnMgPSB1dGlscy5hc3NpZ24oewogICAgICAgICAgbGV2ZWw6IFpfREVGQVVMVF9DT01QUkVTU0lPTiwKICAgICAgICAgIG1ldGhvZDogWl9ERUZMQVRFRCwKICAgICAgICAgIGNodW5rU2l6ZTogMTYzODQsCiAgICAgICAgICB3aW5kb3dCaXRzOiAxNSwKICAgICAgICAgIG1lbUxldmVsOiA4LAogICAgICAgICAgc3RyYXRlZ3k6IFpfREVGQVVMVF9TVFJBVEVHWSwKICAgICAgICAgIHRvOiAiIgogICAgICAgIH0sIG9wdGlvbnMgfHwge30pOwogICAgICAgIHZhciBvcHQgPSB0aGlzLm9wdGlvbnM7CiAgICAgICAgaWYgKG9wdC5yYXcgJiYgb3B0LndpbmRvd0JpdHMgPiAwKSB7CiAgICAgICAgICBvcHQud2luZG93Qml0cyA9IC1vcHQud2luZG93Qml0czsKICAgICAgICB9IGVsc2UgaWYgKG9wdC5nemlwICYmIG9wdC53aW5kb3dCaXRzID4gMCAmJiBvcHQud2luZG93Qml0cyA8IDE2KSB7CiAgICAgICAgICBvcHQud2luZG93Qml0cyArPSAxNjsKICAgICAgICB9CiAgICAgICAgdGhpcy5lcnIgPSAwOwogICAgICAgIHRoaXMubXNnID0gIiI7CiAgICAgICAgdGhpcy5lbmRlZCA9IGZhbHNlOwogICAgICAgIHRoaXMuY2h1bmtzID0gW107CiAgICAgICAgdGhpcy5zdHJtID0gbmV3IFpTdHJlYW0oKTsKICAgICAgICB0aGlzLnN0cm0uYXZhaWxfb3V0ID0gMDsKICAgICAgICB2YXIgc3RhdHVzID0gemxpYl9kZWZsYXRlLmRlZmxhdGVJbml0Mih0aGlzLnN0cm0sIG9wdC5sZXZlbCwgb3B0Lm1ldGhvZCwgb3B0LndpbmRvd0JpdHMsIG9wdC5tZW1MZXZlbCwgb3B0LnN0cmF0ZWd5KTsKICAgICAgICBpZiAoc3RhdHVzICE9PSBaX09LKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobXNnW3N0YXR1c10pOwogICAgICAgIH0KICAgICAgICBpZiAob3B0LmhlYWRlcikgewogICAgICAgICAgemxpYl9kZWZsYXRlLmRlZmxhdGVTZXRIZWFkZXIodGhpcy5zdHJtLCBvcHQuaGVhZGVyKTsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdC5kaWN0aW9uYXJ5KSB7CiAgICAgICAgICB2YXIgZGljdDsKICAgICAgICAgIGlmICh0eXBlb2Ygb3B0LmRpY3Rpb25hcnkgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIGRpY3QgPSBzdHJpbmdzLnN0cmluZzJidWYob3B0LmRpY3Rpb25hcnkpOwogICAgICAgICAgfSBlbHNlIGlmICh0b1N0cmluZy5jYWxsKG9wdC5kaWN0aW9uYXJ5KSA9PT0gIltvYmplY3QgQXJyYXlCdWZmZXJdIikgewogICAgICAgICAgICBkaWN0ID0gbmV3IFVpbnQ4QXJyYXkob3B0LmRpY3Rpb25hcnkpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGljdCA9IG9wdC5kaWN0aW9uYXJ5OwogICAgICAgICAgfQogICAgICAgICAgc3RhdHVzID0gemxpYl9kZWZsYXRlLmRlZmxhdGVTZXREaWN0aW9uYXJ5KHRoaXMuc3RybSwgZGljdCk7CiAgICAgICAgICBpZiAoc3RhdHVzICE9PSBaX09LKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtc2dbc3RhdHVzXSk7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLl9kaWN0X3NldCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIERlZmxhdGUucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbihkYXRhLCBtb2RlKSB7CiAgICAgICAgdmFyIHN0cm0gPSB0aGlzLnN0cm07CiAgICAgICAgdmFyIGNodW5rU2l6ZSA9IHRoaXMub3B0aW9ucy5jaHVua1NpemU7CiAgICAgICAgdmFyIHN0YXR1cywgX21vZGU7CiAgICAgICAgaWYgKHRoaXMuZW5kZWQpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgX21vZGUgPSBtb2RlID09PSB+fm1vZGUgPyBtb2RlIDogbW9kZSA9PT0gdHJ1ZSA/IFpfRklOSVNIIDogWl9OT19GTFVTSDsKICAgICAgICBpZiAodHlwZW9mIGRhdGEgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICBzdHJtLmlucHV0ID0gc3RyaW5ncy5zdHJpbmcyYnVmKGRhdGEpOwogICAgICAgIH0gZWxzZSBpZiAodG9TdHJpbmcuY2FsbChkYXRhKSA9PT0gIltvYmplY3QgQXJyYXlCdWZmZXJdIikgewogICAgICAgICAgc3RybS5pbnB1dCA9IG5ldyBVaW50OEFycmF5KGRhdGEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJtLmlucHV0ID0gZGF0YTsKICAgICAgICB9CiAgICAgICAgc3RybS5uZXh0X2luID0gMDsKICAgICAgICBzdHJtLmF2YWlsX2luID0gc3RybS5pbnB1dC5sZW5ndGg7CiAgICAgICAgZG8gewogICAgICAgICAgaWYgKHN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICAgIHN0cm0ub3V0cHV0ID0gbmV3IHV0aWxzLkJ1ZjgoY2h1bmtTaXplKTsKICAgICAgICAgICAgc3RybS5uZXh0X291dCA9IDA7CiAgICAgICAgICAgIHN0cm0uYXZhaWxfb3V0ID0gY2h1bmtTaXplOwogICAgICAgICAgfQogICAgICAgICAgc3RhdHVzID0gemxpYl9kZWZsYXRlLmRlZmxhdGUoc3RybSwgX21vZGUpOwogICAgICAgICAgaWYgKHN0YXR1cyAhPT0gWl9TVFJFQU1fRU5EICYmIHN0YXR1cyAhPT0gWl9PSykgewogICAgICAgICAgICB0aGlzLm9uRW5kKHN0YXR1cyk7CiAgICAgICAgICAgIHRoaXMuZW5kZWQgPSB0cnVlOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc3RybS5hdmFpbF9vdXQgPT09IDAgfHwgc3RybS5hdmFpbF9pbiA9PT0gMCAmJiAoX21vZGUgPT09IFpfRklOSVNIIHx8IF9tb2RlID09PSBaX1NZTkNfRkxVU0gpKSB7CiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMudG8gPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgdGhpcy5vbkRhdGEoc3RyaW5ncy5idWYyYmluc3RyaW5nKHV0aWxzLnNocmlua0J1ZihzdHJtLm91dHB1dCwgc3RybS5uZXh0X291dCkpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLm9uRGF0YSh1dGlscy5zaHJpbmtCdWYoc3RybS5vdXRwdXQsIHN0cm0ubmV4dF9vdXQpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gd2hpbGUgKChzdHJtLmF2YWlsX2luID4gMCB8fCBzdHJtLmF2YWlsX291dCA9PT0gMCkgJiYgc3RhdHVzICE9PSBaX1NUUkVBTV9FTkQpOwogICAgICAgIGlmIChfbW9kZSA9PT0gWl9GSU5JU0gpIHsKICAgICAgICAgIHN0YXR1cyA9IHpsaWJfZGVmbGF0ZS5kZWZsYXRlRW5kKHRoaXMuc3RybSk7CiAgICAgICAgICB0aGlzLm9uRW5kKHN0YXR1cyk7CiAgICAgICAgICB0aGlzLmVuZGVkID0gdHJ1ZTsKICAgICAgICAgIHJldHVybiBzdGF0dXMgPT09IFpfT0s7CiAgICAgICAgfQogICAgICAgIGlmIChfbW9kZSA9PT0gWl9TWU5DX0ZMVVNIKSB7CiAgICAgICAgICB0aGlzLm9uRW5kKFpfT0spOwogICAgICAgICAgc3RybS5hdmFpbF9vdXQgPSAwOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9OwogICAgICBEZWZsYXRlLnByb3RvdHlwZS5vbkRhdGEgPSBmdW5jdGlvbihjaHVuaykgewogICAgICAgIHRoaXMuY2h1bmtzLnB1c2goY2h1bmspOwogICAgICB9OwogICAgICBEZWZsYXRlLnByb3RvdHlwZS5vbkVuZCA9IGZ1bmN0aW9uKHN0YXR1cykgewogICAgICAgIGlmIChzdGF0dXMgPT09IFpfT0spIHsKICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMudG8gPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIHRoaXMucmVzdWx0ID0gdGhpcy5jaHVua3Muam9pbigiIik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnJlc3VsdCA9IHV0aWxzLmZsYXR0ZW5DaHVua3ModGhpcy5jaHVua3MpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLmNodW5rcyA9IFtdOwogICAgICAgIHRoaXMuZXJyID0gc3RhdHVzOwogICAgICAgIHRoaXMubXNnID0gdGhpcy5zdHJtLm1zZzsKICAgICAgfTsKICAgICAgZnVuY3Rpb24gZGVmbGF0ZShpbnB1dCwgb3B0aW9ucykgewogICAgICAgIHZhciBkZWZsYXRvciA9IG5ldyBEZWZsYXRlKG9wdGlvbnMpOwogICAgICAgIGRlZmxhdG9yLnB1c2goaW5wdXQsIHRydWUpOwogICAgICAgIGlmIChkZWZsYXRvci5lcnIpIHsKICAgICAgICAgIHRocm93IGRlZmxhdG9yLm1zZyB8fCBtc2dbZGVmbGF0b3IuZXJyXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRlZmxhdG9yLnJlc3VsdDsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZWZsYXRlUmF3KGlucHV0LCBvcHRpb25zKSB7CiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICAgICAgb3B0aW9ucy5yYXcgPSB0cnVlOwogICAgICAgIHJldHVybiBkZWZsYXRlKGlucHV0LCBvcHRpb25zKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBnemlwKGlucHV0LCBvcHRpb25zKSB7CiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICAgICAgb3B0aW9ucy5nemlwID0gdHJ1ZTsKICAgICAgICByZXR1cm4gZGVmbGF0ZShpbnB1dCwgb3B0aW9ucyk7CiAgICAgIH0KICAgICAgZXhwb3J0cy5EZWZsYXRlID0gRGVmbGF0ZTsKICAgICAgZXhwb3J0cy5kZWZsYXRlID0gZGVmbGF0ZTsKICAgICAgZXhwb3J0cy5kZWZsYXRlUmF3ID0gZGVmbGF0ZVJhdzsKICAgICAgZXhwb3J0cy5nemlwID0gZ3ppcDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL3Bha28vbGliL3psaWIvaW5mZmFzdC5qcwogIHZhciByZXF1aXJlX2luZmZhc3QgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvcGFrby9saWIvemxpYi9pbmZmYXN0LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBCQUQgPSAzMDsKICAgICAgdmFyIFRZUEUgPSAxMjsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBpbmZsYXRlX2Zhc3Qoc3RybSwgc3RhcnQpIHsKICAgICAgICB2YXIgc3RhdGU7CiAgICAgICAgdmFyIF9pbjsKICAgICAgICB2YXIgbGFzdDsKICAgICAgICB2YXIgX291dDsKICAgICAgICB2YXIgYmVnOwogICAgICAgIHZhciBlbmQ7CiAgICAgICAgdmFyIGRtYXg7CiAgICAgICAgdmFyIHdzaXplOwogICAgICAgIHZhciB3aGF2ZTsKICAgICAgICB2YXIgd25leHQ7CiAgICAgICAgdmFyIHNfd2luZG93OwogICAgICAgIHZhciBob2xkOwogICAgICAgIHZhciBiaXRzOwogICAgICAgIHZhciBsY29kZTsKICAgICAgICB2YXIgZGNvZGU7CiAgICAgICAgdmFyIGxtYXNrOwogICAgICAgIHZhciBkbWFzazsKICAgICAgICB2YXIgaGVyZTsKICAgICAgICB2YXIgb3A7CiAgICAgICAgdmFyIGxlbjsKICAgICAgICB2YXIgZGlzdDsKICAgICAgICB2YXIgZnJvbTsKICAgICAgICB2YXIgZnJvbV9zb3VyY2U7CiAgICAgICAgdmFyIGlucHV0LCBvdXRwdXQ7CiAgICAgICAgc3RhdGUgPSBzdHJtLnN0YXRlOwogICAgICAgIF9pbiA9IHN0cm0ubmV4dF9pbjsKICAgICAgICBpbnB1dCA9IHN0cm0uaW5wdXQ7CiAgICAgICAgbGFzdCA9IF9pbiArIChzdHJtLmF2YWlsX2luIC0gNSk7CiAgICAgICAgX291dCA9IHN0cm0ubmV4dF9vdXQ7CiAgICAgICAgb3V0cHV0ID0gc3RybS5vdXRwdXQ7CiAgICAgICAgYmVnID0gX291dCAtIChzdGFydCAtIHN0cm0uYXZhaWxfb3V0KTsKICAgICAgICBlbmQgPSBfb3V0ICsgKHN0cm0uYXZhaWxfb3V0IC0gMjU3KTsKICAgICAgICBkbWF4ID0gc3RhdGUuZG1heDsKICAgICAgICB3c2l6ZSA9IHN0YXRlLndzaXplOwogICAgICAgIHdoYXZlID0gc3RhdGUud2hhdmU7CiAgICAgICAgd25leHQgPSBzdGF0ZS53bmV4dDsKICAgICAgICBzX3dpbmRvdyA9IHN0YXRlLndpbmRvdzsKICAgICAgICBob2xkID0gc3RhdGUuaG9sZDsKICAgICAgICBiaXRzID0gc3RhdGUuYml0czsKICAgICAgICBsY29kZSA9IHN0YXRlLmxlbmNvZGU7CiAgICAgICAgZGNvZGUgPSBzdGF0ZS5kaXN0Y29kZTsKICAgICAgICBsbWFzayA9ICgxIDw8IHN0YXRlLmxlbmJpdHMpIC0gMTsKICAgICAgICBkbWFzayA9ICgxIDw8IHN0YXRlLmRpc3RiaXRzKSAtIDE7CiAgICAgICAgdG9wOgogICAgICAgICAgZG8gewogICAgICAgICAgICBpZiAoYml0cyA8IDE1KSB7CiAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaGVyZSA9IGxjb2RlW2hvbGQgJiBsbWFza107CiAgICAgICAgICAgIGRvbGVuOgogICAgICAgICAgICAgIGZvciAoOyA7ICkgewogICAgICAgICAgICAgICAgb3AgPSBoZXJlID4+PiAyNDsKICAgICAgICAgICAgICAgIGhvbGQgPj4+PSBvcDsKICAgICAgICAgICAgICAgIGJpdHMgLT0gb3A7CiAgICAgICAgICAgICAgICBvcCA9IGhlcmUgPj4+IDE2ICYgMjU1OwogICAgICAgICAgICAgICAgaWYgKG9wID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gaGVyZSAmIDY1NTM1OwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcCAmIDE2KSB7CiAgICAgICAgICAgICAgICAgIGxlbiA9IGhlcmUgJiA2NTUzNTsKICAgICAgICAgICAgICAgICAgb3AgJj0gMTU7CiAgICAgICAgICAgICAgICAgIGlmIChvcCkgewogICAgICAgICAgICAgICAgICAgIGlmIChiaXRzIDwgb3ApIHsKICAgICAgICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbX2luKytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxlbiArPSBob2xkICYgKDEgPDwgb3ApIC0gMTsKICAgICAgICAgICAgICAgICAgICBob2xkID4+Pj0gb3A7CiAgICAgICAgICAgICAgICAgICAgYml0cyAtPSBvcDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoYml0cyA8IDE1KSB7CiAgICAgICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaGVyZSA9IGRjb2RlW2hvbGQgJiBkbWFza107CiAgICAgICAgICAgICAgICAgIGRvZGlzdDoKICAgICAgICAgICAgICAgICAgICBmb3IgKDsgOyApIHsKICAgICAgICAgICAgICAgICAgICAgIG9wID0gaGVyZSA+Pj4gMjQ7CiAgICAgICAgICAgICAgICAgICAgICBob2xkID4+Pj0gb3A7CiAgICAgICAgICAgICAgICAgICAgICBiaXRzIC09IG9wOwogICAgICAgICAgICAgICAgICAgICAgb3AgPSBoZXJlID4+PiAxNiAmIDI1NTsKICAgICAgICAgICAgICAgICAgICAgIGlmIChvcCAmIDE2KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3QgPSBoZXJlICYgNjU1MzU7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wICY9IDE1OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYml0cyA8IG9wKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICAgICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJpdHMgPCBvcCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZGlzdCArPSBob2xkICYgKDEgPDwgb3ApIC0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpc3QgPiBkbWF4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBkaXN0YW5jZSB0b28gZmFyIGJhY2siOwogICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgdG9wOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGhvbGQgPj4+PSBvcDsKICAgICAgICAgICAgICAgICAgICAgICAgYml0cyAtPSBvcDsKICAgICAgICAgICAgICAgICAgICAgICAgb3AgPSBfb3V0IC0gYmVnOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGlzdCA+IG9wKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgb3AgPSBkaXN0IC0gb3A7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wID4gd2hhdmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5zYW5lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gImludmFsaWQgZGlzdGFuY2UgdG9vIGZhciBiYWNrIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgdG9wOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tX3NvdXJjZSA9IHNfd2luZG93OwogICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3bmV4dCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSArPSB3c2l6ZSAtIG9wOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wIDwgbGVuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbiAtPSBvcDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gc193aW5kb3dbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSB3aGlsZSAoLS1vcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gPSBfb3V0IC0gZGlzdDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbV9zb3VyY2UgPSBvdXRwdXQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh3bmV4dCA8IG9wKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tICs9IHdzaXplICsgd25leHQgLSBvcDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wIC09IHduZXh0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wIDwgbGVuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbiAtPSBvcDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gc193aW5kb3dbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSB3aGlsZSAoLS1vcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod25leHQgPCBsZW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcCA9IHduZXh0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbiAtPSBvcDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IHNfd2luZG93W2Zyb20rK107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSB3aGlsZSAoLS1vcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSA9IF9vdXQgLSBkaXN0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb21fc291cmNlID0gb3V0cHV0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gKz0gd25leHQgLSBvcDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcCA8IGxlbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW4gLT0gb3A7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IHNfd2luZG93W2Zyb20rK107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKC0tb3ApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tID0gX291dCAtIGRpc3Q7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb21fc291cmNlID0gb3V0cHV0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAobGVuID4gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBmcm9tX3NvdXJjZVtmcm9tKytdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBmcm9tX3NvdXJjZVtmcm9tKytdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBmcm9tX3NvdXJjZVtmcm9tKytdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuIC09IDM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsZW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gZnJvbV9zb3VyY2VbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsZW4gPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gZnJvbV9zb3VyY2VbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSA9IF9vdXQgLSBkaXN0OwogICAgICAgICAgICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gb3V0cHV0W2Zyb20rK107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IG91dHB1dFtmcm9tKytdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbiAtPSAzOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKGxlbiA+IDIpOwogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsZW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gb3V0cHV0W2Zyb20rK107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGVuID4gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IG91dHB1dFtmcm9tKytdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgob3AgJiA2NCkgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaGVyZSA9IGRjb2RlWyhoZXJlICYgNjU1MzUpICsgKGhvbGQgJiAoMSA8PCBvcCkgLSAxKV07CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlIGRvZGlzdDsKICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gImludmFsaWQgZGlzdGFuY2UgY29kZSI7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIHRvcDsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKG9wICYgNjQpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIGhlcmUgPSBsY29kZVsoaGVyZSAmIDY1NTM1KSArIChob2xkICYgKDEgPDwgb3ApIC0gMSldOwogICAgICAgICAgICAgICAgICBjb250aW51ZSBkb2xlbjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob3AgJiAzMikgewogICAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gVFlQRTsKICAgICAgICAgICAgICAgICAgYnJlYWsgdG9wOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBsaXRlcmFsL2xlbmd0aCBjb2RlIjsKICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICAgICAgYnJlYWsgdG9wOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfSB3aGlsZSAoX2luIDwgbGFzdCAmJiBfb3V0IDwgZW5kKTsKICAgICAgICBsZW4gPSBiaXRzID4+IDM7CiAgICAgICAgX2luIC09IGxlbjsKICAgICAgICBiaXRzIC09IGxlbiA8PCAzOwogICAgICAgIGhvbGQgJj0gKDEgPDwgYml0cykgLSAxOwogICAgICAgIHN0cm0ubmV4dF9pbiA9IF9pbjsKICAgICAgICBzdHJtLm5leHRfb3V0ID0gX291dDsKICAgICAgICBzdHJtLmF2YWlsX2luID0gX2luIDwgbGFzdCA/IDUgKyAobGFzdCAtIF9pbikgOiA1IC0gKF9pbiAtIGxhc3QpOwogICAgICAgIHN0cm0uYXZhaWxfb3V0ID0gX291dCA8IGVuZCA/IDI1NyArIChlbmQgLSBfb3V0KSA6IDI1NyAtIChfb3V0IC0gZW5kKTsKICAgICAgICBzdGF0ZS5ob2xkID0gaG9sZDsKICAgICAgICBzdGF0ZS5iaXRzID0gYml0czsKICAgICAgICByZXR1cm47CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9wYWtvL2xpYi96bGliL2luZnRyZWVzLmpzCiAgdmFyIHJlcXVpcmVfaW5mdHJlZXMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvcGFrby9saWIvemxpYi9pbmZ0cmVlcy5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgdXRpbHMgPSByZXF1aXJlX2NvbW1vbjIoKTsKICAgICAgdmFyIE1BWEJJVFMgPSAxNTsKICAgICAgdmFyIEVOT1VHSF9MRU5TID0gODUyOwogICAgICB2YXIgRU5PVUdIX0RJU1RTID0gNTkyOwogICAgICB2YXIgQ09ERVMgPSAwOwogICAgICB2YXIgTEVOUyA9IDE7CiAgICAgIHZhciBESVNUUyA9IDI7CiAgICAgIHZhciBsYmFzZSA9IFsKICAgICAgICAzLAogICAgICAgIDQsCiAgICAgICAgNSwKICAgICAgICA2LAogICAgICAgIDcsCiAgICAgICAgOCwKICAgICAgICA5LAogICAgICAgIDEwLAogICAgICAgIDExLAogICAgICAgIDEzLAogICAgICAgIDE1LAogICAgICAgIDE3LAogICAgICAgIDE5LAogICAgICAgIDIzLAogICAgICAgIDI3LAogICAgICAgIDMxLAogICAgICAgIDM1LAogICAgICAgIDQzLAogICAgICAgIDUxLAogICAgICAgIDU5LAogICAgICAgIDY3LAogICAgICAgIDgzLAogICAgICAgIDk5LAogICAgICAgIDExNSwKICAgICAgICAxMzEsCiAgICAgICAgMTYzLAogICAgICAgIDE5NSwKICAgICAgICAyMjcsCiAgICAgICAgMjU4LAogICAgICAgIDAsCiAgICAgICAgMAogICAgICBdOwogICAgICB2YXIgbGV4dCA9IFsKICAgICAgICAxNiwKICAgICAgICAxNiwKICAgICAgICAxNiwKICAgICAgICAxNiwKICAgICAgICAxNiwKICAgICAgICAxNiwKICAgICAgICAxNiwKICAgICAgICAxNiwKICAgICAgICAxNywKICAgICAgICAxNywKICAgICAgICAxNywKICAgICAgICAxNywKICAgICAgICAxOCwKICAgICAgICAxOCwKICAgICAgICAxOCwKICAgICAgICAxOCwKICAgICAgICAxOSwKICAgICAgICAxOSwKICAgICAgICAxOSwKICAgICAgICAxOSwKICAgICAgICAyMCwKICAgICAgICAyMCwKICAgICAgICAyMCwKICAgICAgICAyMCwKICAgICAgICAyMSwKICAgICAgICAyMSwKICAgICAgICAyMSwKICAgICAgICAyMSwKICAgICAgICAxNiwKICAgICAgICA3MiwKICAgICAgICA3OAogICAgICBdOwogICAgICB2YXIgZGJhc2UgPSBbCiAgICAgICAgMSwKICAgICAgICAyLAogICAgICAgIDMsCiAgICAgICAgNCwKICAgICAgICA1LAogICAgICAgIDcsCiAgICAgICAgOSwKICAgICAgICAxMywKICAgICAgICAxNywKICAgICAgICAyNSwKICAgICAgICAzMywKICAgICAgICA0OSwKICAgICAgICA2NSwKICAgICAgICA5NywKICAgICAgICAxMjksCiAgICAgICAgMTkzLAogICAgICAgIDI1NywKICAgICAgICAzODUsCiAgICAgICAgNTEzLAogICAgICAgIDc2OSwKICAgICAgICAxMDI1LAogICAgICAgIDE1MzcsCiAgICAgICAgMjA0OSwKICAgICAgICAzMDczLAogICAgICAgIDQwOTcsCiAgICAgICAgNjE0NSwKICAgICAgICA4MTkzLAogICAgICAgIDEyMjg5LAogICAgICAgIDE2Mzg1LAogICAgICAgIDI0NTc3LAogICAgICAgIDAsCiAgICAgICAgMAogICAgICBdOwogICAgICB2YXIgZGV4dCA9IFsKICAgICAgICAxNiwKICAgICAgICAxNiwKICAgICAgICAxNiwKICAgICAgICAxNiwKICAgICAgICAxNywKICAgICAgICAxNywKICAgICAgICAxOCwKICAgICAgICAxOCwKICAgICAgICAxOSwKICAgICAgICAxOSwKICAgICAgICAyMCwKICAgICAgICAyMCwKICAgICAgICAyMSwKICAgICAgICAyMSwKICAgICAgICAyMiwKICAgICAgICAyMiwKICAgICAgICAyMywKICAgICAgICAyMywKICAgICAgICAyNCwKICAgICAgICAyNCwKICAgICAgICAyNSwKICAgICAgICAyNSwKICAgICAgICAyNiwKICAgICAgICAyNiwKICAgICAgICAyNywKICAgICAgICAyNywKICAgICAgICAyOCwKICAgICAgICAyOCwKICAgICAgICAyOSwKICAgICAgICAyOSwKICAgICAgICA2NCwKICAgICAgICA2NAogICAgICBdOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGluZmxhdGVfdGFibGUodHlwZSwgbGVucywgbGVuc19pbmRleCwgY29kZXMsIHRhYmxlLCB0YWJsZV9pbmRleCwgd29yaywgb3B0cykgewogICAgICAgIHZhciBiaXRzID0gb3B0cy5iaXRzOwogICAgICAgIHZhciBsZW4gPSAwOwogICAgICAgIHZhciBzeW0gPSAwOwogICAgICAgIHZhciBtaW4gPSAwLCBtYXggPSAwOwogICAgICAgIHZhciByb290ID0gMDsKICAgICAgICB2YXIgY3VyciA9IDA7CiAgICAgICAgdmFyIGRyb3AgPSAwOwogICAgICAgIHZhciBsZWZ0ID0gMDsKICAgICAgICB2YXIgdXNlZCA9IDA7CiAgICAgICAgdmFyIGh1ZmYgPSAwOwogICAgICAgIHZhciBpbmNyOwogICAgICAgIHZhciBmaWxsOwogICAgICAgIHZhciBsb3c7CiAgICAgICAgdmFyIG1hc2s7CiAgICAgICAgdmFyIG5leHQ7CiAgICAgICAgdmFyIGJhc2UgPSBudWxsOwogICAgICAgIHZhciBiYXNlX2luZGV4ID0gMDsKICAgICAgICB2YXIgZW5kOwogICAgICAgIHZhciBjb3VudCA9IG5ldyB1dGlscy5CdWYxNihNQVhCSVRTICsgMSk7CiAgICAgICAgdmFyIG9mZnMgPSBuZXcgdXRpbHMuQnVmMTYoTUFYQklUUyArIDEpOwogICAgICAgIHZhciBleHRyYSA9IG51bGw7CiAgICAgICAgdmFyIGV4dHJhX2luZGV4ID0gMDsKICAgICAgICB2YXIgaGVyZV9iaXRzLCBoZXJlX29wLCBoZXJlX3ZhbDsKICAgICAgICBmb3IgKGxlbiA9IDA7IGxlbiA8PSBNQVhCSVRTOyBsZW4rKykgewogICAgICAgICAgY291bnRbbGVuXSA9IDA7CiAgICAgICAgfQogICAgICAgIGZvciAoc3ltID0gMDsgc3ltIDwgY29kZXM7IHN5bSsrKSB7CiAgICAgICAgICBjb3VudFtsZW5zW2xlbnNfaW5kZXggKyBzeW1dXSsrOwogICAgICAgIH0KICAgICAgICByb290ID0gYml0czsKICAgICAgICBmb3IgKG1heCA9IE1BWEJJVFM7IG1heCA+PSAxOyBtYXgtLSkgewogICAgICAgICAgaWYgKGNvdW50W21heF0gIT09IDApIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChyb290ID4gbWF4KSB7CiAgICAgICAgICByb290ID0gbWF4OwogICAgICAgIH0KICAgICAgICBpZiAobWF4ID09PSAwKSB7CiAgICAgICAgICB0YWJsZVt0YWJsZV9pbmRleCsrXSA9IDEgPDwgMjQgfCA2NCA8PCAxNiB8IDA7CiAgICAgICAgICB0YWJsZVt0YWJsZV9pbmRleCsrXSA9IDEgPDwgMjQgfCA2NCA8PCAxNiB8IDA7CiAgICAgICAgICBvcHRzLmJpdHMgPSAxOwogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIGZvciAobWluID0gMTsgbWluIDwgbWF4OyBtaW4rKykgewogICAgICAgICAgaWYgKGNvdW50W21pbl0gIT09IDApIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChyb290IDwgbWluKSB7CiAgICAgICAgICByb290ID0gbWluOwogICAgICAgIH0KICAgICAgICBsZWZ0ID0gMTsKICAgICAgICBmb3IgKGxlbiA9IDE7IGxlbiA8PSBNQVhCSVRTOyBsZW4rKykgewogICAgICAgICAgbGVmdCA8PD0gMTsKICAgICAgICAgIGxlZnQgLT0gY291bnRbbGVuXTsKICAgICAgICAgIGlmIChsZWZ0IDwgMCkgewogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChsZWZ0ID4gMCAmJiAodHlwZSA9PT0gQ09ERVMgfHwgbWF4ICE9PSAxKSkgewogICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgICAgICBvZmZzWzFdID0gMDsKICAgICAgICBmb3IgKGxlbiA9IDE7IGxlbiA8IE1BWEJJVFM7IGxlbisrKSB7CiAgICAgICAgICBvZmZzW2xlbiArIDFdID0gb2Zmc1tsZW5dICsgY291bnRbbGVuXTsKICAgICAgICB9CiAgICAgICAgZm9yIChzeW0gPSAwOyBzeW0gPCBjb2Rlczsgc3ltKyspIHsKICAgICAgICAgIGlmIChsZW5zW2xlbnNfaW5kZXggKyBzeW1dICE9PSAwKSB7CiAgICAgICAgICAgIHdvcmtbb2Zmc1tsZW5zW2xlbnNfaW5kZXggKyBzeW1dXSsrXSA9IHN5bTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHR5cGUgPT09IENPREVTKSB7CiAgICAgICAgICBiYXNlID0gZXh0cmEgPSB3b3JrOwogICAgICAgICAgZW5kID0gMTk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSBMRU5TKSB7CiAgICAgICAgICBiYXNlID0gbGJhc2U7CiAgICAgICAgICBiYXNlX2luZGV4IC09IDI1NzsKICAgICAgICAgIGV4dHJhID0gbGV4dDsKICAgICAgICAgIGV4dHJhX2luZGV4IC09IDI1NzsKICAgICAgICAgIGVuZCA9IDI1NjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYmFzZSA9IGRiYXNlOwogICAgICAgICAgZXh0cmEgPSBkZXh0OwogICAgICAgICAgZW5kID0gLTE7CiAgICAgICAgfQogICAgICAgIGh1ZmYgPSAwOwogICAgICAgIHN5bSA9IDA7CiAgICAgICAgbGVuID0gbWluOwogICAgICAgIG5leHQgPSB0YWJsZV9pbmRleDsKICAgICAgICBjdXJyID0gcm9vdDsKICAgICAgICBkcm9wID0gMDsKICAgICAgICBsb3cgPSAtMTsKICAgICAgICB1c2VkID0gMSA8PCByb290OwogICAgICAgIG1hc2sgPSB1c2VkIC0gMTsKICAgICAgICBpZiAodHlwZSA9PT0gTEVOUyAmJiB1c2VkID4gRU5PVUdIX0xFTlMgfHwgdHlwZSA9PT0gRElTVFMgJiYgdXNlZCA+IEVOT1VHSF9ESVNUUykgewogICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQogICAgICAgIGZvciAoOyA7ICkgewogICAgICAgICAgaGVyZV9iaXRzID0gbGVuIC0gZHJvcDsKICAgICAgICAgIGlmICh3b3JrW3N5bV0gPCBlbmQpIHsKICAgICAgICAgICAgaGVyZV9vcCA9IDA7CiAgICAgICAgICAgIGhlcmVfdmFsID0gd29ya1tzeW1dOwogICAgICAgICAgfSBlbHNlIGlmICh3b3JrW3N5bV0gPiBlbmQpIHsKICAgICAgICAgICAgaGVyZV9vcCA9IGV4dHJhW2V4dHJhX2luZGV4ICsgd29ya1tzeW1dXTsKICAgICAgICAgICAgaGVyZV92YWwgPSBiYXNlW2Jhc2VfaW5kZXggKyB3b3JrW3N5bV1dOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaGVyZV9vcCA9IDMyICsgNjQ7CiAgICAgICAgICAgIGhlcmVfdmFsID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIGluY3IgPSAxIDw8IGxlbiAtIGRyb3A7CiAgICAgICAgICBmaWxsID0gMSA8PCBjdXJyOwogICAgICAgICAgbWluID0gZmlsbDsKICAgICAgICAgIGRvIHsKICAgICAgICAgICAgZmlsbCAtPSBpbmNyOwogICAgICAgICAgICB0YWJsZVtuZXh0ICsgKGh1ZmYgPj4gZHJvcCkgKyBmaWxsXSA9IGhlcmVfYml0cyA8PCAyNCB8IGhlcmVfb3AgPDwgMTYgfCBoZXJlX3ZhbCB8IDA7CiAgICAgICAgICB9IHdoaWxlIChmaWxsICE9PSAwKTsKICAgICAgICAgIGluY3IgPSAxIDw8IGxlbiAtIDE7CiAgICAgICAgICB3aGlsZSAoaHVmZiAmIGluY3IpIHsKICAgICAgICAgICAgaW5jciA+Pj0gMTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChpbmNyICE9PSAwKSB7CiAgICAgICAgICAgIGh1ZmYgJj0gaW5jciAtIDE7CiAgICAgICAgICAgIGh1ZmYgKz0gaW5jcjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGh1ZmYgPSAwOwogICAgICAgICAgfQogICAgICAgICAgc3ltKys7CiAgICAgICAgICBpZiAoLS1jb3VudFtsZW5dID09PSAwKSB7CiAgICAgICAgICAgIGlmIChsZW4gPT09IG1heCkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxlbiA9IGxlbnNbbGVuc19pbmRleCArIHdvcmtbc3ltXV07CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobGVuID4gcm9vdCAmJiAoaHVmZiAmIG1hc2spICE9PSBsb3cpIHsKICAgICAgICAgICAgaWYgKGRyb3AgPT09IDApIHsKICAgICAgICAgICAgICBkcm9wID0gcm9vdDsKICAgICAgICAgICAgfQogICAgICAgICAgICBuZXh0ICs9IG1pbjsKICAgICAgICAgICAgY3VyciA9IGxlbiAtIGRyb3A7CiAgICAgICAgICAgIGxlZnQgPSAxIDw8IGN1cnI7CiAgICAgICAgICAgIHdoaWxlIChjdXJyICsgZHJvcCA8IG1heCkgewogICAgICAgICAgICAgIGxlZnQgLT0gY291bnRbY3VyciArIGRyb3BdOwogICAgICAgICAgICAgIGlmIChsZWZ0IDw9IDApIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjdXJyKys7CiAgICAgICAgICAgICAgbGVmdCA8PD0gMTsKICAgICAgICAgICAgfQogICAgICAgICAgICB1c2VkICs9IDEgPDwgY3VycjsKICAgICAgICAgICAgaWYgKHR5cGUgPT09IExFTlMgJiYgdXNlZCA+IEVOT1VHSF9MRU5TIHx8IHR5cGUgPT09IERJU1RTICYmIHVzZWQgPiBFTk9VR0hfRElTVFMpIHsKICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsb3cgPSBodWZmICYgbWFzazsKICAgICAgICAgICAgdGFibGVbbG93XSA9IHJvb3QgPDwgMjQgfCBjdXJyIDw8IDE2IHwgbmV4dCAtIHRhYmxlX2luZGV4IHwgMDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGh1ZmYgIT09IDApIHsKICAgICAgICAgIHRhYmxlW25leHQgKyBodWZmXSA9IGxlbiAtIGRyb3AgPDwgMjQgfCA2NCA8PCAxNiB8IDA7CiAgICAgICAgfQogICAgICAgIG9wdHMuYml0cyA9IHJvb3Q7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9wYWtvL2xpYi96bGliL2luZmxhdGUuanMKICB2YXIgcmVxdWlyZV9pbmZsYXRlID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL3Bha28vbGliL3psaWIvaW5mbGF0ZS5qcyIoZXhwb3J0cykgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIHV0aWxzID0gcmVxdWlyZV9jb21tb24yKCk7CiAgICAgIHZhciBhZGxlcjMyID0gcmVxdWlyZV9hZGxlcjMyKCk7CiAgICAgIHZhciBjcmMzMiA9IHJlcXVpcmVfY3JjMzIoKTsKICAgICAgdmFyIGluZmxhdGVfZmFzdCA9IHJlcXVpcmVfaW5mZmFzdCgpOwogICAgICB2YXIgaW5mbGF0ZV90YWJsZSA9IHJlcXVpcmVfaW5mdHJlZXMoKTsKICAgICAgdmFyIENPREVTID0gMDsKICAgICAgdmFyIExFTlMgPSAxOwogICAgICB2YXIgRElTVFMgPSAyOwogICAgICB2YXIgWl9GSU5JU0ggPSA0OwogICAgICB2YXIgWl9CTE9DSyA9IDU7CiAgICAgIHZhciBaX1RSRUVTID0gNjsKICAgICAgdmFyIFpfT0sgPSAwOwogICAgICB2YXIgWl9TVFJFQU1fRU5EID0gMTsKICAgICAgdmFyIFpfTkVFRF9ESUNUID0gMjsKICAgICAgdmFyIFpfU1RSRUFNX0VSUk9SID0gLTI7CiAgICAgIHZhciBaX0RBVEFfRVJST1IgPSAtMzsKICAgICAgdmFyIFpfTUVNX0VSUk9SID0gLTQ7CiAgICAgIHZhciBaX0JVRl9FUlJPUiA9IC01OwogICAgICB2YXIgWl9ERUZMQVRFRCA9IDg7CiAgICAgIHZhciBIRUFEID0gMTsKICAgICAgdmFyIEZMQUdTID0gMjsKICAgICAgdmFyIFRJTUUgPSAzOwogICAgICB2YXIgT1MgPSA0OwogICAgICB2YXIgRVhMRU4gPSA1OwogICAgICB2YXIgRVhUUkEgPSA2OwogICAgICB2YXIgTkFNRSA9IDc7CiAgICAgIHZhciBDT01NRU5UID0gODsKICAgICAgdmFyIEhDUkMgPSA5OwogICAgICB2YXIgRElDVElEID0gMTA7CiAgICAgIHZhciBESUNUID0gMTE7CiAgICAgIHZhciBUWVBFID0gMTI7CiAgICAgIHZhciBUWVBFRE8gPSAxMzsKICAgICAgdmFyIFNUT1JFRCA9IDE0OwogICAgICB2YXIgQ09QWV8gPSAxNTsKICAgICAgdmFyIENPUFkgPSAxNjsKICAgICAgdmFyIFRBQkxFID0gMTc7CiAgICAgIHZhciBMRU5MRU5TID0gMTg7CiAgICAgIHZhciBDT0RFTEVOUyA9IDE5OwogICAgICB2YXIgTEVOXyA9IDIwOwogICAgICB2YXIgTEVOID0gMjE7CiAgICAgIHZhciBMRU5FWFQgPSAyMjsKICAgICAgdmFyIERJU1QgPSAyMzsKICAgICAgdmFyIERJU1RFWFQgPSAyNDsKICAgICAgdmFyIE1BVENIID0gMjU7CiAgICAgIHZhciBMSVQgPSAyNjsKICAgICAgdmFyIENIRUNLID0gMjc7CiAgICAgIHZhciBMRU5HVEggPSAyODsKICAgICAgdmFyIERPTkUgPSAyOTsKICAgICAgdmFyIEJBRCA9IDMwOwogICAgICB2YXIgTUVNID0gMzE7CiAgICAgIHZhciBTWU5DID0gMzI7CiAgICAgIHZhciBFTk9VR0hfTEVOUyA9IDg1MjsKICAgICAgdmFyIEVOT1VHSF9ESVNUUyA9IDU5MjsKICAgICAgdmFyIE1BWF9XQklUUyA9IDE1OwogICAgICB2YXIgREVGX1dCSVRTID0gTUFYX1dCSVRTOwogICAgICBmdW5jdGlvbiB6c3dhcDMyKHEpIHsKICAgICAgICByZXR1cm4gKHEgPj4+IDI0ICYgMjU1KSArIChxID4+PiA4ICYgNjUyODApICsgKChxICYgNjUyODApIDw8IDgpICsgKChxICYgMjU1KSA8PCAyNCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSW5mbGF0ZVN0YXRlKCkgewogICAgICAgIHRoaXMubW9kZSA9IDA7CiAgICAgICAgdGhpcy5sYXN0ID0gZmFsc2U7CiAgICAgICAgdGhpcy53cmFwID0gMDsKICAgICAgICB0aGlzLmhhdmVkaWN0ID0gZmFsc2U7CiAgICAgICAgdGhpcy5mbGFncyA9IDA7CiAgICAgICAgdGhpcy5kbWF4ID0gMDsKICAgICAgICB0aGlzLmNoZWNrID0gMDsKICAgICAgICB0aGlzLnRvdGFsID0gMDsKICAgICAgICB0aGlzLmhlYWQgPSBudWxsOwogICAgICAgIHRoaXMud2JpdHMgPSAwOwogICAgICAgIHRoaXMud3NpemUgPSAwOwogICAgICAgIHRoaXMud2hhdmUgPSAwOwogICAgICAgIHRoaXMud25leHQgPSAwOwogICAgICAgIHRoaXMud2luZG93ID0gbnVsbDsKICAgICAgICB0aGlzLmhvbGQgPSAwOwogICAgICAgIHRoaXMuYml0cyA9IDA7CiAgICAgICAgdGhpcy5sZW5ndGggPSAwOwogICAgICAgIHRoaXMub2Zmc2V0ID0gMDsKICAgICAgICB0aGlzLmV4dHJhID0gMDsKICAgICAgICB0aGlzLmxlbmNvZGUgPSBudWxsOwogICAgICAgIHRoaXMuZGlzdGNvZGUgPSBudWxsOwogICAgICAgIHRoaXMubGVuYml0cyA9IDA7CiAgICAgICAgdGhpcy5kaXN0Yml0cyA9IDA7CiAgICAgICAgdGhpcy5uY29kZSA9IDA7CiAgICAgICAgdGhpcy5ubGVuID0gMDsKICAgICAgICB0aGlzLm5kaXN0ID0gMDsKICAgICAgICB0aGlzLmhhdmUgPSAwOwogICAgICAgIHRoaXMubmV4dCA9IG51bGw7CiAgICAgICAgdGhpcy5sZW5zID0gbmV3IHV0aWxzLkJ1ZjE2KDMyMCk7CiAgICAgICAgdGhpcy53b3JrID0gbmV3IHV0aWxzLkJ1ZjE2KDI4OCk7CiAgICAgICAgdGhpcy5sZW5keW4gPSBudWxsOwogICAgICAgIHRoaXMuZGlzdGR5biA9IG51bGw7CiAgICAgICAgdGhpcy5zYW5lID0gMDsKICAgICAgICB0aGlzLmJhY2sgPSAwOwogICAgICAgIHRoaXMud2FzID0gMDsKICAgICAgfQogICAgICBmdW5jdGlvbiBpbmZsYXRlUmVzZXRLZWVwKHN0cm0pIHsKICAgICAgICB2YXIgc3RhdGU7CiAgICAgICAgaWYgKCFzdHJtIHx8ICFzdHJtLnN0YXRlKSB7CiAgICAgICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1I7CiAgICAgICAgfQogICAgICAgIHN0YXRlID0gc3RybS5zdGF0ZTsKICAgICAgICBzdHJtLnRvdGFsX2luID0gc3RybS50b3RhbF9vdXQgPSBzdGF0ZS50b3RhbCA9IDA7CiAgICAgICAgc3RybS5tc2cgPSAiIjsKICAgICAgICBpZiAoc3RhdGUud3JhcCkgewogICAgICAgICAgc3RybS5hZGxlciA9IHN0YXRlLndyYXAgJiAxOwogICAgICAgIH0KICAgICAgICBzdGF0ZS5tb2RlID0gSEVBRDsKICAgICAgICBzdGF0ZS5sYXN0ID0gMDsKICAgICAgICBzdGF0ZS5oYXZlZGljdCA9IDA7CiAgICAgICAgc3RhdGUuZG1heCA9IDMyNzY4OwogICAgICAgIHN0YXRlLmhlYWQgPSBudWxsOwogICAgICAgIHN0YXRlLmhvbGQgPSAwOwogICAgICAgIHN0YXRlLmJpdHMgPSAwOwogICAgICAgIHN0YXRlLmxlbmNvZGUgPSBzdGF0ZS5sZW5keW4gPSBuZXcgdXRpbHMuQnVmMzIoRU5PVUdIX0xFTlMpOwogICAgICAgIHN0YXRlLmRpc3Rjb2RlID0gc3RhdGUuZGlzdGR5biA9IG5ldyB1dGlscy5CdWYzMihFTk9VR0hfRElTVFMpOwogICAgICAgIHN0YXRlLnNhbmUgPSAxOwogICAgICAgIHN0YXRlLmJhY2sgPSAtMTsKICAgICAgICByZXR1cm4gWl9PSzsKICAgICAgfQogICAgICBmdW5jdGlvbiBpbmZsYXRlUmVzZXQoc3RybSkgewogICAgICAgIHZhciBzdGF0ZTsKICAgICAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsKICAgICAgICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUjsKICAgICAgICB9CiAgICAgICAgc3RhdGUgPSBzdHJtLnN0YXRlOwogICAgICAgIHN0YXRlLndzaXplID0gMDsKICAgICAgICBzdGF0ZS53aGF2ZSA9IDA7CiAgICAgICAgc3RhdGUud25leHQgPSAwOwogICAgICAgIHJldHVybiBpbmZsYXRlUmVzZXRLZWVwKHN0cm0pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGluZmxhdGVSZXNldDIoc3RybSwgd2luZG93Qml0cykgewogICAgICAgIHZhciB3cmFwOwogICAgICAgIHZhciBzdGF0ZTsKICAgICAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsKICAgICAgICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUjsKICAgICAgICB9CiAgICAgICAgc3RhdGUgPSBzdHJtLnN0YXRlOwogICAgICAgIGlmICh3aW5kb3dCaXRzIDwgMCkgewogICAgICAgICAgd3JhcCA9IDA7CiAgICAgICAgICB3aW5kb3dCaXRzID0gLXdpbmRvd0JpdHM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHdyYXAgPSAod2luZG93Qml0cyA+PiA0KSArIDE7CiAgICAgICAgICBpZiAod2luZG93Qml0cyA8IDQ4KSB7CiAgICAgICAgICAgIHdpbmRvd0JpdHMgJj0gMTU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh3aW5kb3dCaXRzICYmICh3aW5kb3dCaXRzIDwgOCB8fCB3aW5kb3dCaXRzID4gMTUpKSB7CiAgICAgICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1I7CiAgICAgICAgfQogICAgICAgIGlmIChzdGF0ZS53aW5kb3cgIT09IG51bGwgJiYgc3RhdGUud2JpdHMgIT09IHdpbmRvd0JpdHMpIHsKICAgICAgICAgIHN0YXRlLndpbmRvdyA9IG51bGw7CiAgICAgICAgfQogICAgICAgIHN0YXRlLndyYXAgPSB3cmFwOwogICAgICAgIHN0YXRlLndiaXRzID0gd2luZG93Qml0czsKICAgICAgICByZXR1cm4gaW5mbGF0ZVJlc2V0KHN0cm0pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGluZmxhdGVJbml0MihzdHJtLCB3aW5kb3dCaXRzKSB7CiAgICAgICAgdmFyIHJldDsKICAgICAgICB2YXIgc3RhdGU7CiAgICAgICAgaWYgKCFzdHJtKSB7CiAgICAgICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1I7CiAgICAgICAgfQogICAgICAgIHN0YXRlID0gbmV3IEluZmxhdGVTdGF0ZSgpOwogICAgICAgIHN0cm0uc3RhdGUgPSBzdGF0ZTsKICAgICAgICBzdGF0ZS53aW5kb3cgPSBudWxsOwogICAgICAgIHJldCA9IGluZmxhdGVSZXNldDIoc3RybSwgd2luZG93Qml0cyk7CiAgICAgICAgaWYgKHJldCAhPT0gWl9PSykgewogICAgICAgICAgc3RybS5zdGF0ZSA9IG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXQ7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gaW5mbGF0ZUluaXQoc3RybSkgewogICAgICAgIHJldHVybiBpbmZsYXRlSW5pdDIoc3RybSwgREVGX1dCSVRTKTsKICAgICAgfQogICAgICB2YXIgdmlyZ2luID0gdHJ1ZTsKICAgICAgdmFyIGxlbmZpeDsKICAgICAgdmFyIGRpc3RmaXg7CiAgICAgIGZ1bmN0aW9uIGZpeGVkdGFibGVzKHN0YXRlKSB7CiAgICAgICAgaWYgKHZpcmdpbikgewogICAgICAgICAgdmFyIHN5bTsKICAgICAgICAgIGxlbmZpeCA9IG5ldyB1dGlscy5CdWYzMig1MTIpOwogICAgICAgICAgZGlzdGZpeCA9IG5ldyB1dGlscy5CdWYzMigzMik7CiAgICAgICAgICBzeW0gPSAwOwogICAgICAgICAgd2hpbGUgKHN5bSA8IDE0NCkgewogICAgICAgICAgICBzdGF0ZS5sZW5zW3N5bSsrXSA9IDg7CiAgICAgICAgICB9CiAgICAgICAgICB3aGlsZSAoc3ltIDwgMjU2KSB7CiAgICAgICAgICAgIHN0YXRlLmxlbnNbc3ltKytdID0gOTsKICAgICAgICAgIH0KICAgICAgICAgIHdoaWxlIChzeW0gPCAyODApIHsKICAgICAgICAgICAgc3RhdGUubGVuc1tzeW0rK10gPSA3OwogICAgICAgICAgfQogICAgICAgICAgd2hpbGUgKHN5bSA8IDI4OCkgewogICAgICAgICAgICBzdGF0ZS5sZW5zW3N5bSsrXSA9IDg7CiAgICAgICAgICB9CiAgICAgICAgICBpbmZsYXRlX3RhYmxlKExFTlMsIHN0YXRlLmxlbnMsIDAsIDI4OCwgbGVuZml4LCAwLCBzdGF0ZS53b3JrLCB7IGJpdHM6IDkgfSk7CiAgICAgICAgICBzeW0gPSAwOwogICAgICAgICAgd2hpbGUgKHN5bSA8IDMyKSB7CiAgICAgICAgICAgIHN0YXRlLmxlbnNbc3ltKytdID0gNTsKICAgICAgICAgIH0KICAgICAgICAgIGluZmxhdGVfdGFibGUoRElTVFMsIHN0YXRlLmxlbnMsIDAsIDMyLCBkaXN0Zml4LCAwLCBzdGF0ZS53b3JrLCB7IGJpdHM6IDUgfSk7CiAgICAgICAgICB2aXJnaW4gPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgc3RhdGUubGVuY29kZSA9IGxlbmZpeDsKICAgICAgICBzdGF0ZS5sZW5iaXRzID0gOTsKICAgICAgICBzdGF0ZS5kaXN0Y29kZSA9IGRpc3RmaXg7CiAgICAgICAgc3RhdGUuZGlzdGJpdHMgPSA1OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHVwZGF0ZXdpbmRvdyhzdHJtLCBzcmMsIGVuZCwgY29weSkgewogICAgICAgIHZhciBkaXN0OwogICAgICAgIHZhciBzdGF0ZSA9IHN0cm0uc3RhdGU7CiAgICAgICAgaWYgKHN0YXRlLndpbmRvdyA9PT0gbnVsbCkgewogICAgICAgICAgc3RhdGUud3NpemUgPSAxIDw8IHN0YXRlLndiaXRzOwogICAgICAgICAgc3RhdGUud25leHQgPSAwOwogICAgICAgICAgc3RhdGUud2hhdmUgPSAwOwogICAgICAgICAgc3RhdGUud2luZG93ID0gbmV3IHV0aWxzLkJ1Zjgoc3RhdGUud3NpemUpOwogICAgICAgIH0KICAgICAgICBpZiAoY29weSA+PSBzdGF0ZS53c2l6ZSkgewogICAgICAgICAgdXRpbHMuYXJyYXlTZXQoc3RhdGUud2luZG93LCBzcmMsIGVuZCAtIHN0YXRlLndzaXplLCBzdGF0ZS53c2l6ZSwgMCk7CiAgICAgICAgICBzdGF0ZS53bmV4dCA9IDA7CiAgICAgICAgICBzdGF0ZS53aGF2ZSA9IHN0YXRlLndzaXplOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkaXN0ID0gc3RhdGUud3NpemUgLSBzdGF0ZS53bmV4dDsKICAgICAgICAgIGlmIChkaXN0ID4gY29weSkgewogICAgICAgICAgICBkaXN0ID0gY29weTsKICAgICAgICAgIH0KICAgICAgICAgIHV0aWxzLmFycmF5U2V0KHN0YXRlLndpbmRvdywgc3JjLCBlbmQgLSBjb3B5LCBkaXN0LCBzdGF0ZS53bmV4dCk7CiAgICAgICAgICBjb3B5IC09IGRpc3Q7CiAgICAgICAgICBpZiAoY29weSkgewogICAgICAgICAgICB1dGlscy5hcnJheVNldChzdGF0ZS53aW5kb3csIHNyYywgZW5kIC0gY29weSwgY29weSwgMCk7CiAgICAgICAgICAgIHN0YXRlLnduZXh0ID0gY29weTsKICAgICAgICAgICAgc3RhdGUud2hhdmUgPSBzdGF0ZS53c2l6ZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0YXRlLnduZXh0ICs9IGRpc3Q7CiAgICAgICAgICAgIGlmIChzdGF0ZS53bmV4dCA9PT0gc3RhdGUud3NpemUpIHsKICAgICAgICAgICAgICBzdGF0ZS53bmV4dCA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0YXRlLndoYXZlIDwgc3RhdGUud3NpemUpIHsKICAgICAgICAgICAgICBzdGF0ZS53aGF2ZSArPSBkaXN0OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAwOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGluZmxhdGUoc3RybSwgZmx1c2gpIHsKICAgICAgICB2YXIgc3RhdGU7CiAgICAgICAgdmFyIGlucHV0LCBvdXRwdXQ7CiAgICAgICAgdmFyIG5leHQ7CiAgICAgICAgdmFyIHB1dDsKICAgICAgICB2YXIgaGF2ZSwgbGVmdDsKICAgICAgICB2YXIgaG9sZDsKICAgICAgICB2YXIgYml0czsKICAgICAgICB2YXIgX2luLCBfb3V0OwogICAgICAgIHZhciBjb3B5OwogICAgICAgIHZhciBmcm9tOwogICAgICAgIHZhciBmcm9tX3NvdXJjZTsKICAgICAgICB2YXIgaGVyZSA9IDA7CiAgICAgICAgdmFyIGhlcmVfYml0cywgaGVyZV9vcCwgaGVyZV92YWw7CiAgICAgICAgdmFyIGxhc3RfYml0cywgbGFzdF9vcCwgbGFzdF92YWw7CiAgICAgICAgdmFyIGxlbjsKICAgICAgICB2YXIgcmV0OwogICAgICAgIHZhciBoYnVmID0gbmV3IHV0aWxzLkJ1ZjgoNCk7CiAgICAgICAgdmFyIG9wdHM7CiAgICAgICAgdmFyIG47CiAgICAgICAgdmFyIG9yZGVyID0gWzE2LCAxNywgMTgsIDAsIDgsIDcsIDksIDYsIDEwLCA1LCAxMSwgNCwgMTIsIDMsIDEzLCAyLCAxNCwgMSwgMTVdOwogICAgICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSB8fCAhc3RybS5vdXRwdXQgfHwgIXN0cm0uaW5wdXQgJiYgc3RybS5hdmFpbF9pbiAhPT0gMCkgewogICAgICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SOwogICAgICAgIH0KICAgICAgICBzdGF0ZSA9IHN0cm0uc3RhdGU7CiAgICAgICAgaWYgKHN0YXRlLm1vZGUgPT09IFRZUEUpIHsKICAgICAgICAgIHN0YXRlLm1vZGUgPSBUWVBFRE87CiAgICAgICAgfQogICAgICAgIHB1dCA9IHN0cm0ubmV4dF9vdXQ7CiAgICAgICAgb3V0cHV0ID0gc3RybS5vdXRwdXQ7CiAgICAgICAgbGVmdCA9IHN0cm0uYXZhaWxfb3V0OwogICAgICAgIG5leHQgPSBzdHJtLm5leHRfaW47CiAgICAgICAgaW5wdXQgPSBzdHJtLmlucHV0OwogICAgICAgIGhhdmUgPSBzdHJtLmF2YWlsX2luOwogICAgICAgIGhvbGQgPSBzdGF0ZS5ob2xkOwogICAgICAgIGJpdHMgPSBzdGF0ZS5iaXRzOwogICAgICAgIF9pbiA9IGhhdmU7CiAgICAgICAgX291dCA9IGxlZnQ7CiAgICAgICAgcmV0ID0gWl9PSzsKICAgICAgICBpbmZfbGVhdmU6CiAgICAgICAgICBmb3IgKDsgOyApIHsKICAgICAgICAgICAgc3dpdGNoIChzdGF0ZS5tb2RlKSB7CiAgICAgICAgICAgICAgY2FzZSBIRUFEOgogICAgICAgICAgICAgICAgaWYgKHN0YXRlLndyYXAgPT09IDApIHsKICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IFRZUEVETzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB3aGlsZSAoYml0cyA8IDE2KSB7CiAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzdGF0ZS53cmFwICYgMiAmJiBob2xkID09PSAzNTYxNSkgewogICAgICAgICAgICAgICAgICBzdGF0ZS5jaGVjayA9IDA7CiAgICAgICAgICAgICAgICAgIGhidWZbMF0gPSBob2xkICYgMjU1OwogICAgICAgICAgICAgICAgICBoYnVmWzFdID0gaG9sZCA+Pj4gOCAmIDI1NTsKICAgICAgICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMihzdGF0ZS5jaGVjaywgaGJ1ZiwgMiwgMCk7CiAgICAgICAgICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEZMQUdTOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN0YXRlLmZsYWdzID0gMDsKICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5oZWFkKSB7CiAgICAgICAgICAgICAgICAgIHN0YXRlLmhlYWQuZG9uZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCEoc3RhdGUud3JhcCAmIDEpIHx8ICgoKGhvbGQgJiAyNTUpIDw8IDgpICsgKGhvbGQgPj4gOCkpICUgMzEpIHsKICAgICAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW5jb3JyZWN0IGhlYWRlciBjaGVjayI7CiAgICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKChob2xkICYgMTUpICE9PSBaX0RFRkxBVEVEKSB7CiAgICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gInVua25vd24gY29tcHJlc3Npb24gbWV0aG9kIjsKICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBob2xkID4+Pj0gNDsKICAgICAgICAgICAgICAgIGJpdHMgLT0gNDsKICAgICAgICAgICAgICAgIGxlbiA9IChob2xkICYgMTUpICsgODsKICAgICAgICAgICAgICAgIGlmIChzdGF0ZS53Yml0cyA9PT0gMCkgewogICAgICAgICAgICAgICAgICBzdGF0ZS53Yml0cyA9IGxlbjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobGVuID4gc3RhdGUud2JpdHMpIHsKICAgICAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCB3aW5kb3cgc2l6ZSI7CiAgICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RhdGUuZG1heCA9IDEgPDwgbGVuOwogICAgICAgICAgICAgICAgc3RybS5hZGxlciA9IHN0YXRlLmNoZWNrID0gMTsKICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBob2xkICYgNTEyID8gRElDVElEIDogVFlQRTsKICAgICAgICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIEZMQUdTOgogICAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCAxNikgewogICAgICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGF0ZS5mbGFncyA9IGhvbGQ7CiAgICAgICAgICAgICAgICBpZiAoKHN0YXRlLmZsYWdzICYgMjU1KSAhPT0gWl9ERUZMQVRFRCkgewogICAgICAgICAgICAgICAgICBzdHJtLm1zZyA9ICJ1bmtub3duIGNvbXByZXNzaW9uIG1ldGhvZCI7CiAgICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgNTczNDQpIHsKICAgICAgICAgICAgICAgICAgc3RybS5tc2cgPSAidW5rbm93biBoZWFkZXIgZmxhZ3Mgc2V0IjsKICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICAgICAgICBzdGF0ZS5oZWFkLnRleHQgPSBob2xkID4+IDggJiAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgNTEyKSB7CiAgICAgICAgICAgICAgICAgIGhidWZbMF0gPSBob2xkICYgMjU1OwogICAgICAgICAgICAgICAgICBoYnVmWzFdID0gaG9sZCA+Pj4gOCAmIDI1NTsKICAgICAgICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMihzdGF0ZS5jaGVjaywgaGJ1ZiwgMiwgMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IFRJTUU7CiAgICAgICAgICAgICAgY2FzZSBUSU1FOgogICAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCAzMikgewogICAgICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICAgICAgICBzdGF0ZS5oZWFkLnRpbWUgPSBob2xkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgNTEyKSB7CiAgICAgICAgICAgICAgICAgIGhidWZbMF0gPSBob2xkICYgMjU1OwogICAgICAgICAgICAgICAgICBoYnVmWzFdID0gaG9sZCA+Pj4gOCAmIDI1NTsKICAgICAgICAgICAgICAgICAgaGJ1ZlsyXSA9IGhvbGQgPj4+IDE2ICYgMjU1OwogICAgICAgICAgICAgICAgICBoYnVmWzNdID0gaG9sZCA+Pj4gMjQgJiAyNTU7CiAgICAgICAgICAgICAgICAgIHN0YXRlLmNoZWNrID0gY3JjMzIoc3RhdGUuY2hlY2ssIGhidWYsIDQsIDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBPUzsKICAgICAgICAgICAgICBjYXNlIE9TOgogICAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCAxNikgewogICAgICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICAgICAgICBzdGF0ZS5oZWFkLnhmbGFncyA9IGhvbGQgJiAyNTU7CiAgICAgICAgICAgICAgICAgIHN0YXRlLmhlYWQub3MgPSBob2xkID4+IDg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiA1MTIpIHsKICAgICAgICAgICAgICAgICAgaGJ1ZlswXSA9IGhvbGQgJiAyNTU7CiAgICAgICAgICAgICAgICAgIGhidWZbMV0gPSBob2xkID4+PiA4ICYgMjU1OwogICAgICAgICAgICAgICAgICBzdGF0ZS5jaGVjayA9IGNyYzMyKHN0YXRlLmNoZWNrLCBoYnVmLCAyLCAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gRVhMRU47CiAgICAgICAgICAgICAgY2FzZSBFWExFTjoKICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDEwMjQpIHsKICAgICAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCAxNikgewogICAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgc3RhdGUubGVuZ3RoID0gaG9sZDsKICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5oZWFkLmV4dHJhX2xlbiA9IGhvbGQ7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgNTEyKSB7CiAgICAgICAgICAgICAgICAgICAgaGJ1ZlswXSA9IGhvbGQgJiAyNTU7CiAgICAgICAgICAgICAgICAgICAgaGJ1ZlsxXSA9IGhvbGQgPj4+IDggJiAyNTU7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMihzdGF0ZS5jaGVjaywgaGJ1ZiwgMiwgMCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0ZS5oZWFkKSB7CiAgICAgICAgICAgICAgICAgIHN0YXRlLmhlYWQuZXh0cmEgPSBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEVYVFJBOwogICAgICAgICAgICAgIGNhc2UgRVhUUkE6CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiAxMDI0KSB7CiAgICAgICAgICAgICAgICAgIGNvcHkgPSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgIGlmIChjb3B5ID4gaGF2ZSkgewogICAgICAgICAgICAgICAgICAgIGNvcHkgPSBoYXZlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChjb3B5KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgICAgICAgICAgIGxlbiA9IHN0YXRlLmhlYWQuZXh0cmFfbGVuIC0gc3RhdGUubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGF0ZS5oZWFkLmV4dHJhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmhlYWQuZXh0cmEgPSBuZXcgQXJyYXkoc3RhdGUuaGVhZC5leHRyYV9sZW4pOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgdXRpbHMuYXJyYXlTZXQoc3RhdGUuaGVhZC5leHRyYSwgaW5wdXQsIG5leHQsIGNvcHksIGxlbik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDUxMikgewogICAgICAgICAgICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMihzdGF0ZS5jaGVjaywgaW5wdXQsIGNvcHksIG5leHQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBoYXZlIC09IGNvcHk7CiAgICAgICAgICAgICAgICAgICAgbmV4dCArPSBjb3B5OwogICAgICAgICAgICAgICAgICAgIHN0YXRlLmxlbmd0aCAtPSBjb3B5OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN0YXRlLmxlbmd0aCA9IDA7CiAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gTkFNRTsKICAgICAgICAgICAgICBjYXNlIE5BTUU6CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiAyMDQ4KSB7CiAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGNvcHkgPSAwOwogICAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgICAgbGVuID0gaW5wdXRbbmV4dCArIGNvcHkrK107CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLmhlYWQgJiYgbGVuICYmIHN0YXRlLmxlbmd0aCA8IDY1NTM2KSB7CiAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5oZWFkLm5hbWUgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShsZW4pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSB3aGlsZSAobGVuICYmIGNvcHkgPCBoYXZlKTsKICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgNTEyKSB7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMihzdGF0ZS5jaGVjaywgaW5wdXQsIGNvcHksIG5leHQpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGhhdmUgLT0gY29weTsKICAgICAgICAgICAgICAgICAgbmV4dCArPSBjb3B5OwogICAgICAgICAgICAgICAgICBpZiAobGVuKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgICAgICAgc3RhdGUuaGVhZC5uYW1lID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN0YXRlLmxlbmd0aCA9IDA7CiAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQ09NTUVOVDsKICAgICAgICAgICAgICBjYXNlIENPTU1FTlQ6CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiA0MDk2KSB7CiAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGNvcHkgPSAwOwogICAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgICAgbGVuID0gaW5wdXRbbmV4dCArIGNvcHkrK107CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLmhlYWQgJiYgbGVuICYmIHN0YXRlLmxlbmd0aCA8IDY1NTM2KSB7CiAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5oZWFkLmNvbW1lbnQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShsZW4pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSB3aGlsZSAobGVuICYmIGNvcHkgPCBoYXZlKTsKICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgNTEyKSB7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMihzdGF0ZS5jaGVjaywgaW5wdXQsIGNvcHksIG5leHQpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGhhdmUgLT0gY29weTsKICAgICAgICAgICAgICAgICAgbmV4dCArPSBjb3B5OwogICAgICAgICAgICAgICAgICBpZiAobGVuKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgICAgICAgc3RhdGUuaGVhZC5jb21tZW50ID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBIQ1JDOwogICAgICAgICAgICAgIGNhc2UgSENSQzoKICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDUxMikgewogICAgICAgICAgICAgICAgICB3aGlsZSAoYml0cyA8IDE2KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoaG9sZCAhPT0gKHN0YXRlLmNoZWNrICYgNjU1MzUpKSB7CiAgICAgICAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaGVhZGVyIGNyYyBtaXNtYXRjaCI7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICAgICAgICBzdGF0ZS5oZWFkLmhjcmMgPSBzdGF0ZS5mbGFncyA+PiA5ICYgMTsKICAgICAgICAgICAgICAgICAgc3RhdGUuaGVhZC5kb25lID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBzdGF0ZS5jaGVjayA9IDA7CiAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gVFlQRTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgRElDVElEOgogICAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCAzMikgewogICAgICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdHJtLmFkbGVyID0gc3RhdGUuY2hlY2sgPSB6c3dhcDMyKGhvbGQpOwogICAgICAgICAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBESUNUOwogICAgICAgICAgICAgIGNhc2UgRElDVDoKICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5oYXZlZGljdCA9PT0gMCkgewogICAgICAgICAgICAgICAgICBzdHJtLm5leHRfb3V0ID0gcHV0OwogICAgICAgICAgICAgICAgICBzdHJtLmF2YWlsX291dCA9IGxlZnQ7CiAgICAgICAgICAgICAgICAgIHN0cm0ubmV4dF9pbiA9IG5leHQ7CiAgICAgICAgICAgICAgICAgIHN0cm0uYXZhaWxfaW4gPSBoYXZlOwogICAgICAgICAgICAgICAgICBzdGF0ZS5ob2xkID0gaG9sZDsKICAgICAgICAgICAgICAgICAgc3RhdGUuYml0cyA9IGJpdHM7CiAgICAgICAgICAgICAgICAgIHJldHVybiBaX05FRURfRElDVDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBzdGF0ZS5jaGVjayA9IDE7CiAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gVFlQRTsKICAgICAgICAgICAgICBjYXNlIFRZUEU6CiAgICAgICAgICAgICAgICBpZiAoZmx1c2ggPT09IFpfQkxPQ0sgfHwgZmx1c2ggPT09IFpfVFJFRVMpIHsKICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNhc2UgVFlQRURPOgogICAgICAgICAgICAgICAgaWYgKHN0YXRlLmxhc3QpIHsKICAgICAgICAgICAgICAgICAgaG9sZCA+Pj49IGJpdHMgJiA3OwogICAgICAgICAgICAgICAgICBiaXRzIC09IGJpdHMgJiA3OwogICAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQ0hFQ0s7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCAzKSB7CiAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN0YXRlLmxhc3QgPSBob2xkICYgMTsKICAgICAgICAgICAgICAgIGhvbGQgPj4+PSAxOwogICAgICAgICAgICAgICAgYml0cyAtPSAxOwogICAgICAgICAgICAgICAgc3dpdGNoIChob2xkICYgMykgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IFNUT1JFRDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgIGZpeGVkdGFibGVzKHN0YXRlKTsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gTEVOXzsKICAgICAgICAgICAgICAgICAgICBpZiAoZmx1c2ggPT09IFpfVFJFRVMpIHsKICAgICAgICAgICAgICAgICAgICAgIGhvbGQgPj4+PSAyOwogICAgICAgICAgICAgICAgICAgICAgYml0cyAtPSAyOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBUQUJMRTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gImludmFsaWQgYmxvY2sgdHlwZSI7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGhvbGQgPj4+PSAyOwogICAgICAgICAgICAgICAgYml0cyAtPSAyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSBTVE9SRUQ6CiAgICAgICAgICAgICAgICBob2xkID4+Pj0gYml0cyAmIDc7CiAgICAgICAgICAgICAgICBiaXRzIC09IGJpdHMgJiA3OwogICAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCAzMikgewogICAgICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoKGhvbGQgJiA2NTUzNSkgIT09IChob2xkID4+PiAxNiBeIDY1NTM1KSkgewogICAgICAgICAgICAgICAgICBzdHJtLm1zZyA9ICJpbnZhbGlkIHN0b3JlZCBibG9jayBsZW5ndGhzIjsKICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGF0ZS5sZW5ndGggPSBob2xkICYgNjU1MzU7CiAgICAgICAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IENPUFlfOwogICAgICAgICAgICAgICAgaWYgKGZsdXNoID09PSBaX1RSRUVTKSB7CiAgICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjYXNlIENPUFlfOgogICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IENPUFk7CiAgICAgICAgICAgICAgY2FzZSBDT1BZOgogICAgICAgICAgICAgICAgY29weSA9IHN0YXRlLmxlbmd0aDsKICAgICAgICAgICAgICAgIGlmIChjb3B5KSB7CiAgICAgICAgICAgICAgICAgIGlmIChjb3B5ID4gaGF2ZSkgewogICAgICAgICAgICAgICAgICAgIGNvcHkgPSBoYXZlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChjb3B5ID4gbGVmdCkgewogICAgICAgICAgICAgICAgICAgIGNvcHkgPSBsZWZ0OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChjb3B5ID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHV0aWxzLmFycmF5U2V0KG91dHB1dCwgaW5wdXQsIG5leHQsIGNvcHksIHB1dCk7CiAgICAgICAgICAgICAgICAgIGhhdmUgLT0gY29weTsKICAgICAgICAgICAgICAgICAgbmV4dCArPSBjb3B5OwogICAgICAgICAgICAgICAgICBsZWZ0IC09IGNvcHk7CiAgICAgICAgICAgICAgICAgIHB1dCArPSBjb3B5OwogICAgICAgICAgICAgICAgICBzdGF0ZS5sZW5ndGggLT0gY29weTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gVFlQRTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgVEFCTEU6CiAgICAgICAgICAgICAgICB3aGlsZSAoYml0cyA8IDE0KSB7CiAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN0YXRlLm5sZW4gPSAoaG9sZCAmIDMxKSArIDI1NzsKICAgICAgICAgICAgICAgIGhvbGQgPj4+PSA1OwogICAgICAgICAgICAgICAgYml0cyAtPSA1OwogICAgICAgICAgICAgICAgc3RhdGUubmRpc3QgPSAoaG9sZCAmIDMxKSArIDE7CiAgICAgICAgICAgICAgICBob2xkID4+Pj0gNTsKICAgICAgICAgICAgICAgIGJpdHMgLT0gNTsKICAgICAgICAgICAgICAgIHN0YXRlLm5jb2RlID0gKGhvbGQgJiAxNSkgKyA0OwogICAgICAgICAgICAgICAgaG9sZCA+Pj49IDQ7CiAgICAgICAgICAgICAgICBiaXRzIC09IDQ7CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUubmxlbiA+IDI4NiB8fCBzdGF0ZS5uZGlzdCA+IDMwKSB7CiAgICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gInRvbyBtYW55IGxlbmd0aCBvciBkaXN0YW5jZSBzeW1ib2xzIjsKICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGF0ZS5oYXZlID0gMDsKICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBMRU5MRU5TOwogICAgICAgICAgICAgIGNhc2UgTEVOTEVOUzoKICAgICAgICAgICAgICAgIHdoaWxlIChzdGF0ZS5oYXZlIDwgc3RhdGUubmNvZGUpIHsKICAgICAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCAzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBzdGF0ZS5sZW5zW29yZGVyW3N0YXRlLmhhdmUrK11dID0gaG9sZCAmIDc7CiAgICAgICAgICAgICAgICAgIGhvbGQgPj4+PSAzOwogICAgICAgICAgICAgICAgICBiaXRzIC09IDM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB3aGlsZSAoc3RhdGUuaGF2ZSA8IDE5KSB7CiAgICAgICAgICAgICAgICAgIHN0YXRlLmxlbnNbb3JkZXJbc3RhdGUuaGF2ZSsrXV0gPSAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RhdGUubGVuY29kZSA9IHN0YXRlLmxlbmR5bjsKICAgICAgICAgICAgICAgIHN0YXRlLmxlbmJpdHMgPSA3OwogICAgICAgICAgICAgICAgb3B0cyA9IHsgYml0czogc3RhdGUubGVuYml0cyB9OwogICAgICAgICAgICAgICAgcmV0ID0gaW5mbGF0ZV90YWJsZShDT0RFUywgc3RhdGUubGVucywgMCwgMTksIHN0YXRlLmxlbmNvZGUsIDAsIHN0YXRlLndvcmssIG9wdHMpOwogICAgICAgICAgICAgICAgc3RhdGUubGVuYml0cyA9IG9wdHMuYml0czsKICAgICAgICAgICAgICAgIGlmIChyZXQpIHsKICAgICAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBjb2RlIGxlbmd0aHMgc2V0IjsKICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGF0ZS5oYXZlID0gMDsKICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBDT0RFTEVOUzsKICAgICAgICAgICAgICBjYXNlIENPREVMRU5TOgogICAgICAgICAgICAgICAgd2hpbGUgKHN0YXRlLmhhdmUgPCBzdGF0ZS5ubGVuICsgc3RhdGUubmRpc3QpIHsKICAgICAgICAgICAgICAgICAgZm9yICg7IDsgKSB7CiAgICAgICAgICAgICAgICAgICAgaGVyZSA9IHN0YXRlLmxlbmNvZGVbaG9sZCAmICgxIDw8IHN0YXRlLmxlbmJpdHMpIC0gMV07CiAgICAgICAgICAgICAgICAgICAgaGVyZV9iaXRzID0gaGVyZSA+Pj4gMjQ7CiAgICAgICAgICAgICAgICAgICAgaGVyZV9vcCA9IGhlcmUgPj4+IDE2ICYgMjU1OwogICAgICAgICAgICAgICAgICAgIGhlcmVfdmFsID0gaGVyZSAmIDY1NTM1OwogICAgICAgICAgICAgICAgICAgIGlmIChoZXJlX2JpdHMgPD0gYml0cykgewogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaWYgKGhlcmVfdmFsIDwgMTYpIHsKICAgICAgICAgICAgICAgICAgICBob2xkID4+Pj0gaGVyZV9iaXRzOwogICAgICAgICAgICAgICAgICAgIGJpdHMgLT0gaGVyZV9iaXRzOwogICAgICAgICAgICAgICAgICAgIHN0YXRlLmxlbnNbc3RhdGUuaGF2ZSsrXSA9IGhlcmVfdmFsOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChoZXJlX3ZhbCA9PT0gMTYpIHsKICAgICAgICAgICAgICAgICAgICAgIG4gPSBoZXJlX2JpdHMgKyAyOwogICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCBuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGhvbGQgPj4+PSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgICAgICAgICBiaXRzIC09IGhlcmVfYml0czsKICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5oYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gImludmFsaWQgYml0IGxlbmd0aCByZXBlYXQiOwogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGxlbiA9IHN0YXRlLmxlbnNbc3RhdGUuaGF2ZSAtIDFdOwogICAgICAgICAgICAgICAgICAgICAgY29weSA9IDMgKyAoaG9sZCAmIDMpOwogICAgICAgICAgICAgICAgICAgICAgaG9sZCA+Pj49IDI7CiAgICAgICAgICAgICAgICAgICAgICBiaXRzIC09IDI7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoZXJlX3ZhbCA9PT0gMTcpIHsKICAgICAgICAgICAgICAgICAgICAgIG4gPSBoZXJlX2JpdHMgKyAzOwogICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCBuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGhvbGQgPj4+PSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgICAgICAgICBiaXRzIC09IGhlcmVfYml0czsKICAgICAgICAgICAgICAgICAgICAgIGxlbiA9IDA7CiAgICAgICAgICAgICAgICAgICAgICBjb3B5ID0gMyArIChob2xkICYgNyk7CiAgICAgICAgICAgICAgICAgICAgICBob2xkID4+Pj0gMzsKICAgICAgICAgICAgICAgICAgICAgIGJpdHMgLT0gMzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgbiA9IGhlcmVfYml0cyArIDc7CiAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYml0cyA8IG4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgaG9sZCA+Pj49IGhlcmVfYml0czsKICAgICAgICAgICAgICAgICAgICAgIGJpdHMgLT0gaGVyZV9iaXRzOwogICAgICAgICAgICAgICAgICAgICAgbGVuID0gMDsKICAgICAgICAgICAgICAgICAgICAgIGNvcHkgPSAxMSArIChob2xkICYgMTI3KTsKICAgICAgICAgICAgICAgICAgICAgIGhvbGQgPj4+PSA3OwogICAgICAgICAgICAgICAgICAgICAgYml0cyAtPSA3OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUuaGF2ZSArIGNvcHkgPiBzdGF0ZS5ubGVuICsgc3RhdGUubmRpc3QpIHsKICAgICAgICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gImludmFsaWQgYml0IGxlbmd0aCByZXBlYXQiOwogICAgICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB3aGlsZSAoY29weS0tKSB7CiAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5sZW5zW3N0YXRlLmhhdmUrK10gPSBsZW47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUubW9kZSA9PT0gQkFEKSB7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHN0YXRlLmxlbnNbMjU2XSA9PT0gMCkgewogICAgICAgICAgICAgICAgICBzdHJtLm1zZyA9ICJpbnZhbGlkIGNvZGUgLS0gbWlzc2luZyBlbmQtb2YtYmxvY2siOwogICAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN0YXRlLmxlbmJpdHMgPSA5OwogICAgICAgICAgICAgICAgb3B0cyA9IHsgYml0czogc3RhdGUubGVuYml0cyB9OwogICAgICAgICAgICAgICAgcmV0ID0gaW5mbGF0ZV90YWJsZShMRU5TLCBzdGF0ZS5sZW5zLCAwLCBzdGF0ZS5ubGVuLCBzdGF0ZS5sZW5jb2RlLCAwLCBzdGF0ZS53b3JrLCBvcHRzKTsKICAgICAgICAgICAgICAgIHN0YXRlLmxlbmJpdHMgPSBvcHRzLmJpdHM7CiAgICAgICAgICAgICAgICBpZiAocmV0KSB7CiAgICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gImludmFsaWQgbGl0ZXJhbC9sZW5ndGhzIHNldCI7CiAgICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RhdGUuZGlzdGJpdHMgPSA2OwogICAgICAgICAgICAgICAgc3RhdGUuZGlzdGNvZGUgPSBzdGF0ZS5kaXN0ZHluOwogICAgICAgICAgICAgICAgb3B0cyA9IHsgYml0czogc3RhdGUuZGlzdGJpdHMgfTsKICAgICAgICAgICAgICAgIHJldCA9IGluZmxhdGVfdGFibGUoRElTVFMsIHN0YXRlLmxlbnMsIHN0YXRlLm5sZW4sIHN0YXRlLm5kaXN0LCBzdGF0ZS5kaXN0Y29kZSwgMCwgc3RhdGUud29yaywgb3B0cyk7CiAgICAgICAgICAgICAgICBzdGF0ZS5kaXN0Yml0cyA9IG9wdHMuYml0czsKICAgICAgICAgICAgICAgIGlmIChyZXQpIHsKICAgICAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBkaXN0YW5jZXMgc2V0IjsKICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gTEVOXzsKICAgICAgICAgICAgICAgIGlmIChmbHVzaCA9PT0gWl9UUkVFUykgewogICAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY2FzZSBMRU5fOgogICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IExFTjsKICAgICAgICAgICAgICBjYXNlIExFTjoKICAgICAgICAgICAgICAgIGlmIChoYXZlID49IDYgJiYgbGVmdCA+PSAyNTgpIHsKICAgICAgICAgICAgICAgICAgc3RybS5uZXh0X291dCA9IHB1dDsKICAgICAgICAgICAgICAgICAgc3RybS5hdmFpbF9vdXQgPSBsZWZ0OwogICAgICAgICAgICAgICAgICBzdHJtLm5leHRfaW4gPSBuZXh0OwogICAgICAgICAgICAgICAgICBzdHJtLmF2YWlsX2luID0gaGF2ZTsKICAgICAgICAgICAgICAgICAgc3RhdGUuaG9sZCA9IGhvbGQ7CiAgICAgICAgICAgICAgICAgIHN0YXRlLmJpdHMgPSBiaXRzOwogICAgICAgICAgICAgICAgICBpbmZsYXRlX2Zhc3Qoc3RybSwgX291dCk7CiAgICAgICAgICAgICAgICAgIHB1dCA9IHN0cm0ubmV4dF9vdXQ7CiAgICAgICAgICAgICAgICAgIG91dHB1dCA9IHN0cm0ub3V0cHV0OwogICAgICAgICAgICAgICAgICBsZWZ0ID0gc3RybS5hdmFpbF9vdXQ7CiAgICAgICAgICAgICAgICAgIG5leHQgPSBzdHJtLm5leHRfaW47CiAgICAgICAgICAgICAgICAgIGlucHV0ID0gc3RybS5pbnB1dDsKICAgICAgICAgICAgICAgICAgaGF2ZSA9IHN0cm0uYXZhaWxfaW47CiAgICAgICAgICAgICAgICAgIGhvbGQgPSBzdGF0ZS5ob2xkOwogICAgICAgICAgICAgICAgICBiaXRzID0gc3RhdGUuYml0czsKICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLm1vZGUgPT09IFRZUEUpIHsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5iYWNrID0gLTE7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGF0ZS5iYWNrID0gMDsKICAgICAgICAgICAgICAgIGZvciAoOyA7ICkgewogICAgICAgICAgICAgICAgICBoZXJlID0gc3RhdGUubGVuY29kZVtob2xkICYgKDEgPDwgc3RhdGUubGVuYml0cykgLSAxXTsKICAgICAgICAgICAgICAgICAgaGVyZV9iaXRzID0gaGVyZSA+Pj4gMjQ7CiAgICAgICAgICAgICAgICAgIGhlcmVfb3AgPSBoZXJlID4+PiAxNiAmIDI1NTsKICAgICAgICAgICAgICAgICAgaGVyZV92YWwgPSBoZXJlICYgNjU1MzU7CiAgICAgICAgICAgICAgICAgIGlmIChoZXJlX2JpdHMgPD0gYml0cykgewogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChoZXJlX29wICYmIChoZXJlX29wICYgMjQwKSA9PT0gMCkgewogICAgICAgICAgICAgICAgICBsYXN0X2JpdHMgPSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgICAgIGxhc3Rfb3AgPSBoZXJlX29wOwogICAgICAgICAgICAgICAgICBsYXN0X3ZhbCA9IGhlcmVfdmFsOwogICAgICAgICAgICAgICAgICBmb3IgKDsgOyApIHsKICAgICAgICAgICAgICAgICAgICBoZXJlID0gc3RhdGUubGVuY29kZVtsYXN0X3ZhbCArICgoaG9sZCAmICgxIDw8IGxhc3RfYml0cyArIGxhc3Rfb3ApIC0gMSkgPj4gbGFzdF9iaXRzKV07CiAgICAgICAgICAgICAgICAgICAgaGVyZV9iaXRzID0gaGVyZSA+Pj4gMjQ7CiAgICAgICAgICAgICAgICAgICAgaGVyZV9vcCA9IGhlcmUgPj4+IDE2ICYgMjU1OwogICAgICAgICAgICAgICAgICAgIGhlcmVfdmFsID0gaGVyZSAmIDY1NTM1OwogICAgICAgICAgICAgICAgICAgIGlmIChsYXN0X2JpdHMgKyBoZXJlX2JpdHMgPD0gYml0cykgewogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaG9sZCA+Pj49IGxhc3RfYml0czsKICAgICAgICAgICAgICAgICAgYml0cyAtPSBsYXN0X2JpdHM7CiAgICAgICAgICAgICAgICAgIHN0YXRlLmJhY2sgKz0gbGFzdF9iaXRzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaG9sZCA+Pj49IGhlcmVfYml0czsKICAgICAgICAgICAgICAgIGJpdHMgLT0gaGVyZV9iaXRzOwogICAgICAgICAgICAgICAgc3RhdGUuYmFjayArPSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgICBzdGF0ZS5sZW5ndGggPSBoZXJlX3ZhbDsKICAgICAgICAgICAgICAgIGlmIChoZXJlX29wID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBMSVQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGhlcmVfb3AgJiAzMikgewogICAgICAgICAgICAgICAgICBzdGF0ZS5iYWNrID0gLTE7CiAgICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBUWVBFOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChoZXJlX29wICYgNjQpIHsKICAgICAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBsaXRlcmFsL2xlbmd0aCBjb2RlIjsKICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGF0ZS5leHRyYSA9IGhlcmVfb3AgJiAxNTsKICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBMRU5FWFQ7CiAgICAgICAgICAgICAgY2FzZSBMRU5FWFQ6CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUuZXh0cmEpIHsKICAgICAgICAgICAgICAgICAgbiA9IHN0YXRlLmV4dHJhOwogICAgICAgICAgICAgICAgICB3aGlsZSAoYml0cyA8IG4pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHN0YXRlLmxlbmd0aCArPSBob2xkICYgKDEgPDwgc3RhdGUuZXh0cmEpIC0gMTsKICAgICAgICAgICAgICAgICAgaG9sZCA+Pj49IHN0YXRlLmV4dHJhOwogICAgICAgICAgICAgICAgICBiaXRzIC09IHN0YXRlLmV4dHJhOwogICAgICAgICAgICAgICAgICBzdGF0ZS5iYWNrICs9IHN0YXRlLmV4dHJhOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RhdGUud2FzID0gc3RhdGUubGVuZ3RoOwogICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IERJU1Q7CiAgICAgICAgICAgICAgY2FzZSBESVNUOgogICAgICAgICAgICAgICAgZm9yICg7IDsgKSB7CiAgICAgICAgICAgICAgICAgIGhlcmUgPSBzdGF0ZS5kaXN0Y29kZVtob2xkICYgKDEgPDwgc3RhdGUuZGlzdGJpdHMpIC0gMV07CiAgICAgICAgICAgICAgICAgIGhlcmVfYml0cyA9IGhlcmUgPj4+IDI0OwogICAgICAgICAgICAgICAgICBoZXJlX29wID0gaGVyZSA+Pj4gMTYgJiAyNTU7CiAgICAgICAgICAgICAgICAgIGhlcmVfdmFsID0gaGVyZSAmIDY1NTM1OwogICAgICAgICAgICAgICAgICBpZiAoaGVyZV9iaXRzIDw9IGJpdHMpIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoKGhlcmVfb3AgJiAyNDApID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIGxhc3RfYml0cyA9IGhlcmVfYml0czsKICAgICAgICAgICAgICAgICAgbGFzdF9vcCA9IGhlcmVfb3A7CiAgICAgICAgICAgICAgICAgIGxhc3RfdmFsID0gaGVyZV92YWw7CiAgICAgICAgICAgICAgICAgIGZvciAoOyA7ICkgewogICAgICAgICAgICAgICAgICAgIGhlcmUgPSBzdGF0ZS5kaXN0Y29kZVtsYXN0X3ZhbCArICgoaG9sZCAmICgxIDw8IGxhc3RfYml0cyArIGxhc3Rfb3ApIC0gMSkgPj4gbGFzdF9iaXRzKV07CiAgICAgICAgICAgICAgICAgICAgaGVyZV9iaXRzID0gaGVyZSA+Pj4gMjQ7CiAgICAgICAgICAgICAgICAgICAgaGVyZV9vcCA9IGhlcmUgPj4+IDE2ICYgMjU1OwogICAgICAgICAgICAgICAgICAgIGhlcmVfdmFsID0gaGVyZSAmIDY1NTM1OwogICAgICAgICAgICAgICAgICAgIGlmIChsYXN0X2JpdHMgKyBoZXJlX2JpdHMgPD0gYml0cykgewogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaG9sZCA+Pj49IGxhc3RfYml0czsKICAgICAgICAgICAgICAgICAgYml0cyAtPSBsYXN0X2JpdHM7CiAgICAgICAgICAgICAgICAgIHN0YXRlLmJhY2sgKz0gbGFzdF9iaXRzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaG9sZCA+Pj49IGhlcmVfYml0czsKICAgICAgICAgICAgICAgIGJpdHMgLT0gaGVyZV9iaXRzOwogICAgICAgICAgICAgICAgc3RhdGUuYmFjayArPSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgICBpZiAoaGVyZV9vcCAmIDY0KSB7CiAgICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gImludmFsaWQgZGlzdGFuY2UgY29kZSI7CiAgICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RhdGUub2Zmc2V0ID0gaGVyZV92YWw7CiAgICAgICAgICAgICAgICBzdGF0ZS5leHRyYSA9IGhlcmVfb3AgJiAxNTsKICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBESVNURVhUOwogICAgICAgICAgICAgIGNhc2UgRElTVEVYVDoKICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5leHRyYSkgewogICAgICAgICAgICAgICAgICBuID0gc3RhdGUuZXh0cmE7CiAgICAgICAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgbikgewogICAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgc3RhdGUub2Zmc2V0ICs9IGhvbGQgJiAoMSA8PCBzdGF0ZS5leHRyYSkgLSAxOwogICAgICAgICAgICAgICAgICBob2xkID4+Pj0gc3RhdGUuZXh0cmE7CiAgICAgICAgICAgICAgICAgIGJpdHMgLT0gc3RhdGUuZXh0cmE7CiAgICAgICAgICAgICAgICAgIHN0YXRlLmJhY2sgKz0gc3RhdGUuZXh0cmE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUub2Zmc2V0ID4gc3RhdGUuZG1heCkgewogICAgICAgICAgICAgICAgICBzdHJtLm1zZyA9ICJpbnZhbGlkIGRpc3RhbmNlIHRvbyBmYXIgYmFjayI7CiAgICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IE1BVENIOwogICAgICAgICAgICAgIGNhc2UgTUFUQ0g6CiAgICAgICAgICAgICAgICBpZiAobGVmdCA9PT0gMCkgewogICAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb3B5ID0gX291dCAtIGxlZnQ7CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUub2Zmc2V0ID4gY29weSkgewogICAgICAgICAgICAgICAgICBjb3B5ID0gc3RhdGUub2Zmc2V0IC0gY29weTsKICAgICAgICAgICAgICAgICAgaWYgKGNvcHkgPiBzdGF0ZS53aGF2ZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5zYW5lKSB7CiAgICAgICAgICAgICAgICAgICAgICBzdHJtLm1zZyA9ICJpbnZhbGlkIGRpc3RhbmNlIHRvbyBmYXIgYmFjayI7CiAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChjb3B5ID4gc3RhdGUud25leHQpIHsKICAgICAgICAgICAgICAgICAgICBjb3B5IC09IHN0YXRlLnduZXh0OwogICAgICAgICAgICAgICAgICAgIGZyb20gPSBzdGF0ZS53c2l6ZSAtIGNvcHk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZnJvbSA9IHN0YXRlLnduZXh0IC0gY29weTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoY29weSA+IHN0YXRlLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIGNvcHkgPSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZnJvbV9zb3VyY2UgPSBzdGF0ZS53aW5kb3c7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBmcm9tX3NvdXJjZSA9IG91dHB1dDsKICAgICAgICAgICAgICAgICAgZnJvbSA9IHB1dCAtIHN0YXRlLm9mZnNldDsKICAgICAgICAgICAgICAgICAgY29weSA9IHN0YXRlLmxlbmd0aDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChjb3B5ID4gbGVmdCkgewogICAgICAgICAgICAgICAgICBjb3B5ID0gbGVmdDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxlZnQgLT0gY29weTsKICAgICAgICAgICAgICAgIHN0YXRlLmxlbmd0aCAtPSBjb3B5OwogICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICBvdXRwdXRbcHV0KytdID0gZnJvbV9zb3VyY2VbZnJvbSsrXTsKICAgICAgICAgICAgICAgIH0gd2hpbGUgKC0tY29weSk7CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBMRU47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIExJVDoKICAgICAgICAgICAgICAgIGlmIChsZWZ0ID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG91dHB1dFtwdXQrK10gPSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgICAgICAgICBsZWZ0LS07CiAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gTEVOOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSBDSEVDSzoKICAgICAgICAgICAgICAgIGlmIChzdGF0ZS53cmFwKSB7CiAgICAgICAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMzIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgICAgICAgaG9sZCB8PSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIF9vdXQgLT0gbGVmdDsKICAgICAgICAgICAgICAgICAgc3RybS50b3RhbF9vdXQgKz0gX291dDsKICAgICAgICAgICAgICAgICAgc3RhdGUudG90YWwgKz0gX291dDsKICAgICAgICAgICAgICAgICAgaWYgKF9vdXQpIHsKICAgICAgICAgICAgICAgICAgICBzdHJtLmFkbGVyID0gc3RhdGUuY2hlY2sgPSBzdGF0ZS5mbGFncyA/IGNyYzMyKHN0YXRlLmNoZWNrLCBvdXRwdXQsIF9vdXQsIHB1dCAtIF9vdXQpIDogYWRsZXIzMihzdGF0ZS5jaGVjaywgb3V0cHV0LCBfb3V0LCBwdXQgLSBfb3V0KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBfb3V0ID0gbGVmdDsKICAgICAgICAgICAgICAgICAgaWYgKChzdGF0ZS5mbGFncyA/IGhvbGQgOiB6c3dhcDMyKGhvbGQpKSAhPT0gc3RhdGUuY2hlY2spIHsKICAgICAgICAgICAgICAgICAgICBzdHJtLm1zZyA9ICJpbmNvcnJlY3QgZGF0YSBjaGVjayI7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gTEVOR1RIOwogICAgICAgICAgICAgIGNhc2UgTEVOR1RIOgogICAgICAgICAgICAgICAgaWYgKHN0YXRlLndyYXAgJiYgc3RhdGUuZmxhZ3MpIHsKICAgICAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCAzMikgewogICAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaWYgKGhvbGQgIT09IChzdGF0ZS50b3RhbCAmIDQyOTQ5NjcyOTUpKSB7CiAgICAgICAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW5jb3JyZWN0IGxlbmd0aCBjaGVjayI7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gRE9ORTsKICAgICAgICAgICAgICBjYXNlIERPTkU6CiAgICAgICAgICAgICAgICByZXQgPSBaX1NUUkVBTV9FTkQ7CiAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgY2FzZSBCQUQ6CiAgICAgICAgICAgICAgICByZXQgPSBaX0RBVEFfRVJST1I7CiAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgY2FzZSBNRU06CiAgICAgICAgICAgICAgICByZXR1cm4gWl9NRU1fRVJST1I7CiAgICAgICAgICAgICAgY2FzZSBTWU5DOgogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1I7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICBzdHJtLm5leHRfb3V0ID0gcHV0OwogICAgICAgIHN0cm0uYXZhaWxfb3V0ID0gbGVmdDsKICAgICAgICBzdHJtLm5leHRfaW4gPSBuZXh0OwogICAgICAgIHN0cm0uYXZhaWxfaW4gPSBoYXZlOwogICAgICAgIHN0YXRlLmhvbGQgPSBob2xkOwogICAgICAgIHN0YXRlLmJpdHMgPSBiaXRzOwogICAgICAgIGlmIChzdGF0ZS53c2l6ZSB8fCBfb3V0ICE9PSBzdHJtLmF2YWlsX291dCAmJiBzdGF0ZS5tb2RlIDwgQkFEICYmIChzdGF0ZS5tb2RlIDwgQ0hFQ0sgfHwgZmx1c2ggIT09IFpfRklOSVNIKSkgewogICAgICAgICAgaWYgKHVwZGF0ZXdpbmRvdyhzdHJtLCBzdHJtLm91dHB1dCwgc3RybS5uZXh0X291dCwgX291dCAtIHN0cm0uYXZhaWxfb3V0KSkgewogICAgICAgICAgICBzdGF0ZS5tb2RlID0gTUVNOwogICAgICAgICAgICByZXR1cm4gWl9NRU1fRVJST1I7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9pbiAtPSBzdHJtLmF2YWlsX2luOwogICAgICAgIF9vdXQgLT0gc3RybS5hdmFpbF9vdXQ7CiAgICAgICAgc3RybS50b3RhbF9pbiArPSBfaW47CiAgICAgICAgc3RybS50b3RhbF9vdXQgKz0gX291dDsKICAgICAgICBzdGF0ZS50b3RhbCArPSBfb3V0OwogICAgICAgIGlmIChzdGF0ZS53cmFwICYmIF9vdXQpIHsKICAgICAgICAgIHN0cm0uYWRsZXIgPSBzdGF0ZS5jaGVjayA9IHN0YXRlLmZsYWdzID8gY3JjMzIoc3RhdGUuY2hlY2ssIG91dHB1dCwgX291dCwgc3RybS5uZXh0X291dCAtIF9vdXQpIDogYWRsZXIzMihzdGF0ZS5jaGVjaywgb3V0cHV0LCBfb3V0LCBzdHJtLm5leHRfb3V0IC0gX291dCk7CiAgICAgICAgfQogICAgICAgIHN0cm0uZGF0YV90eXBlID0gc3RhdGUuYml0cyArIChzdGF0ZS5sYXN0ID8gNjQgOiAwKSArIChzdGF0ZS5tb2RlID09PSBUWVBFID8gMTI4IDogMCkgKyAoc3RhdGUubW9kZSA9PT0gTEVOXyB8fCBzdGF0ZS5tb2RlID09PSBDT1BZXyA/IDI1NiA6IDApOwogICAgICAgIGlmICgoX2luID09PSAwICYmIF9vdXQgPT09IDAgfHwgZmx1c2ggPT09IFpfRklOSVNIKSAmJiByZXQgPT09IFpfT0spIHsKICAgICAgICAgIHJldCA9IFpfQlVGX0VSUk9SOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmV0OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGluZmxhdGVFbmQoc3RybSkgewogICAgICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSkgewogICAgICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SOwogICAgICAgIH0KICAgICAgICB2YXIgc3RhdGUgPSBzdHJtLnN0YXRlOwogICAgICAgIGlmIChzdGF0ZS53aW5kb3cpIHsKICAgICAgICAgIHN0YXRlLndpbmRvdyA9IG51bGw7CiAgICAgICAgfQogICAgICAgIHN0cm0uc3RhdGUgPSBudWxsOwogICAgICAgIHJldHVybiBaX09LOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGluZmxhdGVHZXRIZWFkZXIoc3RybSwgaGVhZCkgewogICAgICAgIHZhciBzdGF0ZTsKICAgICAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsKICAgICAgICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUjsKICAgICAgICB9CiAgICAgICAgc3RhdGUgPSBzdHJtLnN0YXRlOwogICAgICAgIGlmICgoc3RhdGUud3JhcCAmIDIpID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1I7CiAgICAgICAgfQogICAgICAgIHN0YXRlLmhlYWQgPSBoZWFkOwogICAgICAgIGhlYWQuZG9uZSA9IGZhbHNlOwogICAgICAgIHJldHVybiBaX09LOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGluZmxhdGVTZXREaWN0aW9uYXJ5KHN0cm0sIGRpY3Rpb25hcnkpIHsKICAgICAgICB2YXIgZGljdExlbmd0aCA9IGRpY3Rpb25hcnkubGVuZ3RoOwogICAgICAgIHZhciBzdGF0ZTsKICAgICAgICB2YXIgZGljdGlkOwogICAgICAgIHZhciByZXQ7CiAgICAgICAgaWYgKCFzdHJtIHx8ICFzdHJtLnN0YXRlKSB7CiAgICAgICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1I7CiAgICAgICAgfQogICAgICAgIHN0YXRlID0gc3RybS5zdGF0ZTsKICAgICAgICBpZiAoc3RhdGUud3JhcCAhPT0gMCAmJiBzdGF0ZS5tb2RlICE9PSBESUNUKSB7CiAgICAgICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1I7CiAgICAgICAgfQogICAgICAgIGlmIChzdGF0ZS5tb2RlID09PSBESUNUKSB7CiAgICAgICAgICBkaWN0aWQgPSAxOwogICAgICAgICAgZGljdGlkID0gYWRsZXIzMihkaWN0aWQsIGRpY3Rpb25hcnksIGRpY3RMZW5ndGgsIDApOwogICAgICAgICAgaWYgKGRpY3RpZCAhPT0gc3RhdGUuY2hlY2spIHsKICAgICAgICAgICAgcmV0dXJuIFpfREFUQV9FUlJPUjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0ID0gdXBkYXRld2luZG93KHN0cm0sIGRpY3Rpb25hcnksIGRpY3RMZW5ndGgsIGRpY3RMZW5ndGgpOwogICAgICAgIGlmIChyZXQpIHsKICAgICAgICAgIHN0YXRlLm1vZGUgPSBNRU07CiAgICAgICAgICByZXR1cm4gWl9NRU1fRVJST1I7CiAgICAgICAgfQogICAgICAgIHN0YXRlLmhhdmVkaWN0ID0gMTsKICAgICAgICByZXR1cm4gWl9PSzsKICAgICAgfQogICAgICBleHBvcnRzLmluZmxhdGVSZXNldCA9IGluZmxhdGVSZXNldDsKICAgICAgZXhwb3J0cy5pbmZsYXRlUmVzZXQyID0gaW5mbGF0ZVJlc2V0MjsKICAgICAgZXhwb3J0cy5pbmZsYXRlUmVzZXRLZWVwID0gaW5mbGF0ZVJlc2V0S2VlcDsKICAgICAgZXhwb3J0cy5pbmZsYXRlSW5pdCA9IGluZmxhdGVJbml0OwogICAgICBleHBvcnRzLmluZmxhdGVJbml0MiA9IGluZmxhdGVJbml0MjsKICAgICAgZXhwb3J0cy5pbmZsYXRlID0gaW5mbGF0ZTsKICAgICAgZXhwb3J0cy5pbmZsYXRlRW5kID0gaW5mbGF0ZUVuZDsKICAgICAgZXhwb3J0cy5pbmZsYXRlR2V0SGVhZGVyID0gaW5mbGF0ZUdldEhlYWRlcjsKICAgICAgZXhwb3J0cy5pbmZsYXRlU2V0RGljdGlvbmFyeSA9IGluZmxhdGVTZXREaWN0aW9uYXJ5OwogICAgICBleHBvcnRzLmluZmxhdGVJbmZvID0gInBha28gaW5mbGF0ZSAoZnJvbSBOb2RlY2EgcHJvamVjdCkiOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvcGFrby9saWIvemxpYi9jb25zdGFudHMuanMKICB2YXIgcmVxdWlyZV9jb25zdGFudHMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvcGFrby9saWIvemxpYi9jb25zdGFudHMuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAgICAgWl9OT19GTFVTSDogMCwKICAgICAgICBaX1BBUlRJQUxfRkxVU0g6IDEsCiAgICAgICAgWl9TWU5DX0ZMVVNIOiAyLAogICAgICAgIFpfRlVMTF9GTFVTSDogMywKICAgICAgICBaX0ZJTklTSDogNCwKICAgICAgICBaX0JMT0NLOiA1LAogICAgICAgIFpfVFJFRVM6IDYsCiAgICAgICAgWl9PSzogMCwKICAgICAgICBaX1NUUkVBTV9FTkQ6IDEsCiAgICAgICAgWl9ORUVEX0RJQ1Q6IDIsCiAgICAgICAgWl9FUlJOTzogLTEsCiAgICAgICAgWl9TVFJFQU1fRVJST1I6IC0yLAogICAgICAgIFpfREFUQV9FUlJPUjogLTMsCiAgICAgICAgWl9CVUZfRVJST1I6IC01LAogICAgICAgIFpfTk9fQ09NUFJFU1NJT046IDAsCiAgICAgICAgWl9CRVNUX1NQRUVEOiAxLAogICAgICAgIFpfQkVTVF9DT01QUkVTU0lPTjogOSwKICAgICAgICBaX0RFRkFVTFRfQ09NUFJFU1NJT046IC0xLAogICAgICAgIFpfRklMVEVSRUQ6IDEsCiAgICAgICAgWl9IVUZGTUFOX09OTFk6IDIsCiAgICAgICAgWl9STEU6IDMsCiAgICAgICAgWl9GSVhFRDogNCwKICAgICAgICBaX0RFRkFVTFRfU1RSQVRFR1k6IDAsCiAgICAgICAgWl9CSU5BUlk6IDAsCiAgICAgICAgWl9URVhUOiAxLAogICAgICAgIFpfVU5LTk9XTjogMiwKICAgICAgICBaX0RFRkxBVEVEOiA4CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9wYWtvL2xpYi96bGliL2d6aGVhZGVyLmpzCiAgdmFyIHJlcXVpcmVfZ3poZWFkZXIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvcGFrby9saWIvemxpYi9nemhlYWRlci5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBmdW5jdGlvbiBHWmhlYWRlcigpIHsKICAgICAgICB0aGlzLnRleHQgPSAwOwogICAgICAgIHRoaXMudGltZSA9IDA7CiAgICAgICAgdGhpcy54ZmxhZ3MgPSAwOwogICAgICAgIHRoaXMub3MgPSAwOwogICAgICAgIHRoaXMuZXh0cmEgPSBudWxsOwogICAgICAgIHRoaXMuZXh0cmFfbGVuID0gMDsKICAgICAgICB0aGlzLm5hbWUgPSAiIjsKICAgICAgICB0aGlzLmNvbW1lbnQgPSAiIjsKICAgICAgICB0aGlzLmhjcmMgPSAwOwogICAgICAgIHRoaXMuZG9uZSA9IGZhbHNlOwogICAgICB9CiAgICAgIG1vZHVsZS5leHBvcnRzID0gR1poZWFkZXI7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9wYWtvL2xpYi9pbmZsYXRlLmpzCiAgdmFyIHJlcXVpcmVfaW5mbGF0ZTIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvcGFrby9saWIvaW5mbGF0ZS5qcyIoZXhwb3J0cykgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIHpsaWJfaW5mbGF0ZSA9IHJlcXVpcmVfaW5mbGF0ZSgpOwogICAgICB2YXIgdXRpbHMgPSByZXF1aXJlX2NvbW1vbjIoKTsKICAgICAgdmFyIHN0cmluZ3MgPSByZXF1aXJlX3N0cmluZ3MoKTsKICAgICAgdmFyIGMgPSByZXF1aXJlX2NvbnN0YW50cygpOwogICAgICB2YXIgbXNnID0gcmVxdWlyZV9tZXNzYWdlczIoKTsKICAgICAgdmFyIFpTdHJlYW0gPSByZXF1aXJlX3pzdHJlYW0oKTsKICAgICAgdmFyIEdaaGVhZGVyID0gcmVxdWlyZV9nemhlYWRlcigpOwogICAgICB2YXIgdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nOwogICAgICBmdW5jdGlvbiBJbmZsYXRlKG9wdGlvbnMpIHsKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgSW5mbGF0ZSkpCiAgICAgICAgICByZXR1cm4gbmV3IEluZmxhdGUob3B0aW9ucyk7CiAgICAgICAgdGhpcy5vcHRpb25zID0gdXRpbHMuYXNzaWduKHsKICAgICAgICAgIGNodW5rU2l6ZTogMTYzODQsCiAgICAgICAgICB3aW5kb3dCaXRzOiAwLAogICAgICAgICAgdG86ICIiCiAgICAgICAgfSwgb3B0aW9ucyB8fCB7fSk7CiAgICAgICAgdmFyIG9wdCA9IHRoaXMub3B0aW9uczsKICAgICAgICBpZiAob3B0LnJhdyAmJiBvcHQud2luZG93Qml0cyA+PSAwICYmIG9wdC53aW5kb3dCaXRzIDwgMTYpIHsKICAgICAgICAgIG9wdC53aW5kb3dCaXRzID0gLW9wdC53aW5kb3dCaXRzOwogICAgICAgICAgaWYgKG9wdC53aW5kb3dCaXRzID09PSAwKSB7CiAgICAgICAgICAgIG9wdC53aW5kb3dCaXRzID0gLTE1OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAob3B0LndpbmRvd0JpdHMgPj0gMCAmJiBvcHQud2luZG93Qml0cyA8IDE2ICYmICEob3B0aW9ucyAmJiBvcHRpb25zLndpbmRvd0JpdHMpKSB7CiAgICAgICAgICBvcHQud2luZG93Qml0cyArPSAzMjsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdC53aW5kb3dCaXRzID4gMTUgJiYgb3B0LndpbmRvd0JpdHMgPCA0OCkgewogICAgICAgICAgaWYgKChvcHQud2luZG93Qml0cyAmIDE1KSA9PT0gMCkgewogICAgICAgICAgICBvcHQud2luZG93Qml0cyB8PSAxNTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy5lcnIgPSAwOwogICAgICAgIHRoaXMubXNnID0gIiI7CiAgICAgICAgdGhpcy5lbmRlZCA9IGZhbHNlOwogICAgICAgIHRoaXMuY2h1bmtzID0gW107CiAgICAgICAgdGhpcy5zdHJtID0gbmV3IFpTdHJlYW0oKTsKICAgICAgICB0aGlzLnN0cm0uYXZhaWxfb3V0ID0gMDsKICAgICAgICB2YXIgc3RhdHVzID0gemxpYl9pbmZsYXRlLmluZmxhdGVJbml0Mih0aGlzLnN0cm0sIG9wdC53aW5kb3dCaXRzKTsKICAgICAgICBpZiAoc3RhdHVzICE9PSBjLlpfT0spIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtc2dbc3RhdHVzXSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuaGVhZGVyID0gbmV3IEdaaGVhZGVyKCk7CiAgICAgICAgemxpYl9pbmZsYXRlLmluZmxhdGVHZXRIZWFkZXIodGhpcy5zdHJtLCB0aGlzLmhlYWRlcik7CiAgICAgICAgaWYgKG9wdC5kaWN0aW9uYXJ5KSB7CiAgICAgICAgICBpZiAodHlwZW9mIG9wdC5kaWN0aW9uYXJ5ID09PSAic3RyaW5nIikgewogICAgICAgICAgICBvcHQuZGljdGlvbmFyeSA9IHN0cmluZ3Muc3RyaW5nMmJ1ZihvcHQuZGljdGlvbmFyeSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHRvU3RyaW5nLmNhbGwob3B0LmRpY3Rpb25hcnkpID09PSAiW29iamVjdCBBcnJheUJ1ZmZlcl0iKSB7CiAgICAgICAgICAgIG9wdC5kaWN0aW9uYXJ5ID0gbmV3IFVpbnQ4QXJyYXkob3B0LmRpY3Rpb25hcnkpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG9wdC5yYXcpIHsKICAgICAgICAgICAgc3RhdHVzID0gemxpYl9pbmZsYXRlLmluZmxhdGVTZXREaWN0aW9uYXJ5KHRoaXMuc3RybSwgb3B0LmRpY3Rpb25hcnkpOwogICAgICAgICAgICBpZiAoc3RhdHVzICE9PSBjLlpfT0spIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobXNnW3N0YXR1c10pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIEluZmxhdGUucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbihkYXRhLCBtb2RlKSB7CiAgICAgICAgdmFyIHN0cm0gPSB0aGlzLnN0cm07CiAgICAgICAgdmFyIGNodW5rU2l6ZSA9IHRoaXMub3B0aW9ucy5jaHVua1NpemU7CiAgICAgICAgdmFyIGRpY3Rpb25hcnkgPSB0aGlzLm9wdGlvbnMuZGljdGlvbmFyeTsKICAgICAgICB2YXIgc3RhdHVzLCBfbW9kZTsKICAgICAgICB2YXIgbmV4dF9vdXRfdXRmOCwgdGFpbCwgdXRmOHN0cjsKICAgICAgICB2YXIgYWxsb3dCdWZFcnJvciA9IGZhbHNlOwogICAgICAgIGlmICh0aGlzLmVuZGVkKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIF9tb2RlID0gbW9kZSA9PT0gfn5tb2RlID8gbW9kZSA6IG1vZGUgPT09IHRydWUgPyBjLlpfRklOSVNIIDogYy5aX05PX0ZMVVNIOwogICAgICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgIHN0cm0uaW5wdXQgPSBzdHJpbmdzLmJpbnN0cmluZzJidWYoZGF0YSk7CiAgICAgICAgfSBlbHNlIGlmICh0b1N0cmluZy5jYWxsKGRhdGEpID09PSAiW29iamVjdCBBcnJheUJ1ZmZlcl0iKSB7CiAgICAgICAgICBzdHJtLmlucHV0ID0gbmV3IFVpbnQ4QXJyYXkoZGF0YSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0cm0uaW5wdXQgPSBkYXRhOwogICAgICAgIH0KICAgICAgICBzdHJtLm5leHRfaW4gPSAwOwogICAgICAgIHN0cm0uYXZhaWxfaW4gPSBzdHJtLmlucHV0Lmxlbmd0aDsKICAgICAgICBkbyB7CiAgICAgICAgICBpZiAoc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICAgICAgc3RybS5vdXRwdXQgPSBuZXcgdXRpbHMuQnVmOChjaHVua1NpemUpOwogICAgICAgICAgICBzdHJtLm5leHRfb3V0ID0gMDsKICAgICAgICAgICAgc3RybS5hdmFpbF9vdXQgPSBjaHVua1NpemU7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0dXMgPSB6bGliX2luZmxhdGUuaW5mbGF0ZShzdHJtLCBjLlpfTk9fRkxVU0gpOwogICAgICAgICAgaWYgKHN0YXR1cyA9PT0gYy5aX05FRURfRElDVCAmJiBkaWN0aW9uYXJ5KSB7CiAgICAgICAgICAgIHN0YXR1cyA9IHpsaWJfaW5mbGF0ZS5pbmZsYXRlU2V0RGljdGlvbmFyeSh0aGlzLnN0cm0sIGRpY3Rpb25hcnkpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0YXR1cyA9PT0gYy5aX0JVRl9FUlJPUiAmJiBhbGxvd0J1ZkVycm9yID09PSB0cnVlKSB7CiAgICAgICAgICAgIHN0YXR1cyA9IGMuWl9PSzsKICAgICAgICAgICAgYWxsb3dCdWZFcnJvciA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0YXR1cyAhPT0gYy5aX1NUUkVBTV9FTkQgJiYgc3RhdHVzICE9PSBjLlpfT0spIHsKICAgICAgICAgICAgdGhpcy5vbkVuZChzdGF0dXMpOwogICAgICAgICAgICB0aGlzLmVuZGVkID0gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0cm0ubmV4dF9vdXQpIHsKICAgICAgICAgICAgaWYgKHN0cm0uYXZhaWxfb3V0ID09PSAwIHx8IHN0YXR1cyA9PT0gYy5aX1NUUkVBTV9FTkQgfHwgc3RybS5hdmFpbF9pbiA9PT0gMCAmJiAoX21vZGUgPT09IGMuWl9GSU5JU0ggfHwgX21vZGUgPT09IGMuWl9TWU5DX0ZMVVNIKSkgewogICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMudG8gPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICBuZXh0X291dF91dGY4ID0gc3RyaW5ncy51dGY4Ym9yZGVyKHN0cm0ub3V0cHV0LCBzdHJtLm5leHRfb3V0KTsKICAgICAgICAgICAgICAgIHRhaWwgPSBzdHJtLm5leHRfb3V0IC0gbmV4dF9vdXRfdXRmODsKICAgICAgICAgICAgICAgIHV0ZjhzdHIgPSBzdHJpbmdzLmJ1ZjJzdHJpbmcoc3RybS5vdXRwdXQsIG5leHRfb3V0X3V0ZjgpOwogICAgICAgICAgICAgICAgc3RybS5uZXh0X291dCA9IHRhaWw7CiAgICAgICAgICAgICAgICBzdHJtLmF2YWlsX291dCA9IGNodW5rU2l6ZSAtIHRhaWw7CiAgICAgICAgICAgICAgICBpZiAodGFpbCkgewogICAgICAgICAgICAgICAgICB1dGlscy5hcnJheVNldChzdHJtLm91dHB1dCwgc3RybS5vdXRwdXQsIG5leHRfb3V0X3V0ZjgsIHRhaWwsIDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5vbkRhdGEodXRmOHN0cik7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMub25EYXRhKHV0aWxzLnNocmlua0J1ZihzdHJtLm91dHB1dCwgc3RybS5uZXh0X291dCkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0cm0uYXZhaWxfaW4gPT09IDAgJiYgc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICAgICAgYWxsb3dCdWZFcnJvciA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSB3aGlsZSAoKHN0cm0uYXZhaWxfaW4gPiAwIHx8IHN0cm0uYXZhaWxfb3V0ID09PSAwKSAmJiBzdGF0dXMgIT09IGMuWl9TVFJFQU1fRU5EKTsKICAgICAgICBpZiAoc3RhdHVzID09PSBjLlpfU1RSRUFNX0VORCkgewogICAgICAgICAgX21vZGUgPSBjLlpfRklOSVNIOwogICAgICAgIH0KICAgICAgICBpZiAoX21vZGUgPT09IGMuWl9GSU5JU0gpIHsKICAgICAgICAgIHN0YXR1cyA9IHpsaWJfaW5mbGF0ZS5pbmZsYXRlRW5kKHRoaXMuc3RybSk7CiAgICAgICAgICB0aGlzLm9uRW5kKHN0YXR1cyk7CiAgICAgICAgICB0aGlzLmVuZGVkID0gdHJ1ZTsKICAgICAgICAgIHJldHVybiBzdGF0dXMgPT09IGMuWl9PSzsKICAgICAgICB9CiAgICAgICAgaWYgKF9tb2RlID09PSBjLlpfU1lOQ19GTFVTSCkgewogICAgICAgICAgdGhpcy5vbkVuZChjLlpfT0spOwogICAgICAgICAgc3RybS5hdmFpbF9vdXQgPSAwOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9OwogICAgICBJbmZsYXRlLnByb3RvdHlwZS5vbkRhdGEgPSBmdW5jdGlvbihjaHVuaykgewogICAgICAgIHRoaXMuY2h1bmtzLnB1c2goY2h1bmspOwogICAgICB9OwogICAgICBJbmZsYXRlLnByb3RvdHlwZS5vbkVuZCA9IGZ1bmN0aW9uKHN0YXR1cykgewogICAgICAgIGlmIChzdGF0dXMgPT09IGMuWl9PSykgewogICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy50byA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgdGhpcy5yZXN1bHQgPSB0aGlzLmNodW5rcy5qb2luKCIiKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucmVzdWx0ID0gdXRpbHMuZmxhdHRlbkNodW5rcyh0aGlzLmNodW5rcyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMuY2h1bmtzID0gW107CiAgICAgICAgdGhpcy5lcnIgPSBzdGF0dXM7CiAgICAgICAgdGhpcy5tc2cgPSB0aGlzLnN0cm0ubXNnOwogICAgICB9OwogICAgICBmdW5jdGlvbiBpbmZsYXRlKGlucHV0LCBvcHRpb25zKSB7CiAgICAgICAgdmFyIGluZmxhdG9yID0gbmV3IEluZmxhdGUob3B0aW9ucyk7CiAgICAgICAgaW5mbGF0b3IucHVzaChpbnB1dCwgdHJ1ZSk7CiAgICAgICAgaWYgKGluZmxhdG9yLmVycikgewogICAgICAgICAgdGhyb3cgaW5mbGF0b3IubXNnIHx8IG1zZ1tpbmZsYXRvci5lcnJdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaW5mbGF0b3IucmVzdWx0OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGluZmxhdGVSYXcoaW5wdXQsIG9wdGlvbnMpIHsKICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgICAgICBvcHRpb25zLnJhdyA9IHRydWU7CiAgICAgICAgcmV0dXJuIGluZmxhdGUoaW5wdXQsIG9wdGlvbnMpOwogICAgICB9CiAgICAgIGV4cG9ydHMuSW5mbGF0ZSA9IEluZmxhdGU7CiAgICAgIGV4cG9ydHMuaW5mbGF0ZSA9IGluZmxhdGU7CiAgICAgIGV4cG9ydHMuaW5mbGF0ZVJhdyA9IGluZmxhdGVSYXc7CiAgICAgIGV4cG9ydHMudW5nemlwID0gaW5mbGF0ZTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL3Bha28vaW5kZXguanMKICB2YXIgcmVxdWlyZV9wYWtvID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL3Bha28vaW5kZXguanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIGFzc2lnbiA9IHJlcXVpcmVfY29tbW9uMigpLmFzc2lnbjsKICAgICAgdmFyIGRlZmxhdGUgPSByZXF1aXJlX2RlZmxhdGUyKCk7CiAgICAgIHZhciBpbmZsYXRlID0gcmVxdWlyZV9pbmZsYXRlMigpOwogICAgICB2YXIgY29uc3RhbnRzID0gcmVxdWlyZV9jb25zdGFudHMoKTsKICAgICAgdmFyIHBha28gPSB7fTsKICAgICAgYXNzaWduKHBha28sIGRlZmxhdGUsIGluZmxhdGUsIGNvbnN0YW50cyk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGFrbzsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BnbW9kL2JnemYtZmlsZWhhbmRsZS9kaXN0L3VuemlwLXBha28uanMKICB2YXIgcmVxdWlyZV91bnppcF9wYWtvID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BnbW9kL2JnemYtZmlsZWhhbmRsZS9kaXN0L3VuemlwLXBha28uanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoKTsKICAgICAgdmFyIF9yZWdlbmVyYXRvciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9yZWdlbmVyYXRvcjIoKSk7CiAgICAgIHZhciBfYXN5bmNUb0dlbmVyYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfYXN5bmNUb0dlbmVyYXRvcjIoKSk7CiAgICAgIHZhciBfcmVxdWlyZSA9IHJlcXVpcmVfcGFrbygpOwogICAgICB2YXIgWl9TWU5DX0ZMVVNIID0gX3JlcXVpcmUuWl9TWU5DX0ZMVVNIOwogICAgICB2YXIgSW5mbGF0ZSA9IF9yZXF1aXJlLkluZmxhdGU7CiAgICAgIGZ1bmN0aW9uIHVuemlwKF94KSB7CiAgICAgICAgcmV0dXJuIF91bnppcC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIF91bnppcCgpIHsKICAgICAgICBfdW56aXAgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoaW5wdXREYXRhKSB7CiAgICAgICAgICB2YXIgc3RybSwgcG9zLCBpLCBjaHVua3MsIGluZmxhdG9yLCByZW1haW5pbmdJbnB1dCwgX2luZmxhdG9yLCByZXN1bHQ7CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDA7CiAgICAgICAgICAgICAgICAgIHBvcyA9IDA7CiAgICAgICAgICAgICAgICAgIGkgPSAwOwogICAgICAgICAgICAgICAgICBjaHVua3MgPSBbXTsKICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgcmVtYWluaW5nSW5wdXQgPSBpbnB1dERhdGEuc2xpY2UocG9zKTsKICAgICAgICAgICAgICAgICAgaW5mbGF0b3IgPSBuZXcgSW5mbGF0ZSgpOwogICAgICAgICAgICAgICAgICBfaW5mbGF0b3IgPSBpbmZsYXRvcjsKICAgICAgICAgICAgICAgICAgc3RybSA9IF9pbmZsYXRvci5zdHJtOwogICAgICAgICAgICAgICAgICBpbmZsYXRvci5wdXNoKHJlbWFpbmluZ0lucHV0LCBaX1NZTkNfRkxVU0gpOwogICAgICAgICAgICAgICAgICBpZiAoIWluZmxhdG9yLmVycikgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoaW5mbGF0b3IubXNnKTsKICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgIHBvcyArPSBzdHJtLm5leHRfaW47CiAgICAgICAgICAgICAgICAgIGNodW5rc1tpXSA9IGltcG9ydF9idWZmZXIuQnVmZmVyLmZyb20oaW5mbGF0b3IucmVzdWx0KTsKICAgICAgICAgICAgICAgICAgaSArPSAxOwogICAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgICAgaWYgKHN0cm0uYXZhaWxfaW4pIHsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gaW1wb3J0X2J1ZmZlci5CdWZmZXIuY29uY2F0KGNodW5rcyk7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIHJlc3VsdCk7CiAgICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMTk7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oMCk7CiAgICAgICAgICAgICAgICAgIGlmICghX2NvbnRleHQudDAubWVzc2FnZS5tYXRjaCgvaW5jb3JyZWN0IGhlYWRlciBjaGVjay8pKSB7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDIzOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigicHJvYmxlbSBkZWNvbXByZXNzaW5nIGJsb2NrOiBpbmNvcnJlY3QgZ3ppcCBoZWFkZXIgY2hlY2siKTsKICAgICAgICAgICAgICAgIGNhc2UgMjM6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwgX2NhbGxlZSwgbnVsbCwgW1swLCAxOV1dKTsKICAgICAgICB9KSk7CiAgICAgICAgcmV0dXJuIF91bnppcC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHVuemlwQ2h1bmsoX3gyKSB7CiAgICAgICAgcmV0dXJuIF91bnppcENodW5rLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gX3VuemlwQ2h1bmsoKSB7CiAgICAgICAgX3VuemlwQ2h1bmsgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKGlucHV0RGF0YSkgewogICAgICAgICAgdmFyIHN0cm0sIGNwb3MsIGRwb3MsIGJsb2NrcywgY3Bvc2l0aW9ucywgZHBvc2l0aW9ucywgcmVtYWluaW5nSW5wdXQsIGluZmxhdG9yLCBfYnVmZmVyLCBidWZmZXI7CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gMDsKICAgICAgICAgICAgICAgICAgY3BvcyA9IDA7CiAgICAgICAgICAgICAgICAgIGRwb3MgPSAwOwogICAgICAgICAgICAgICAgICBibG9ja3MgPSBbXTsKICAgICAgICAgICAgICAgICAgY3Bvc2l0aW9ucyA9IFtdOwogICAgICAgICAgICAgICAgICBkcG9zaXRpb25zID0gW107CiAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgIHJlbWFpbmluZ0lucHV0ID0gaW5wdXREYXRhLnNsaWNlKGNwb3MpOwogICAgICAgICAgICAgICAgICBpbmZsYXRvciA9IG5ldyBJbmZsYXRlKCk7CiAgICAgICAgICAgICAgICAgIHN0cm0gPSBpbmZsYXRvci5zdHJtOwogICAgICAgICAgICAgICAgICBpbmZsYXRvci5wdXNoKHJlbWFpbmluZ0lucHV0LCBaX1NZTkNfRkxVU0gpOwogICAgICAgICAgICAgICAgICBpZiAoIWluZmxhdG9yLmVycikgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGluZmxhdG9yLm1zZyk7CiAgICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgICBfYnVmZmVyID0gaW1wb3J0X2J1ZmZlci5CdWZmZXIuZnJvbShpbmZsYXRvci5yZXN1bHQpOwogICAgICAgICAgICAgICAgICBibG9ja3MucHVzaChfYnVmZmVyKTsKICAgICAgICAgICAgICAgICAgY3Bvc2l0aW9ucy5wdXNoKGNwb3MpOwogICAgICAgICAgICAgICAgICBkcG9zaXRpb25zLnB1c2goZHBvcyk7CiAgICAgICAgICAgICAgICAgIGNwb3MgKz0gc3RybS5uZXh0X2luOwogICAgICAgICAgICAgICAgICBkcG9zICs9IF9idWZmZXIubGVuZ3RoOwogICAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgICAgaWYgKHN0cm0uYXZhaWxfaW4pIHsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgICAgICAgIGJ1ZmZlciA9IGltcG9ydF9idWZmZXIuQnVmZmVyLmNvbmNhdChibG9ja3MpOwogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgeyBidWZmZXIsIGNwb3NpdGlvbnMsIGRwb3NpdGlvbnMgfSk7CiAgICAgICAgICAgICAgICBjYXNlIDIzOgogICAgICAgICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDIzOwogICAgICAgICAgICAgICAgICBfY29udGV4dDIudDAgPSBfY29udGV4dDJbImNhdGNoIl0oMCk7CiAgICAgICAgICAgICAgICAgIGlmICghX2NvbnRleHQyLnQwLm1lc3NhZ2UubWF0Y2goL2luY29ycmVjdCBoZWFkZXIgY2hlY2svKSkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjc7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJwcm9ibGVtIGRlY29tcHJlc3NpbmcgYmxvY2s6IGluY29ycmVjdCBnemlwIGhlYWRlciBjaGVjayIpOwogICAgICAgICAgICAgICAgY2FzZSAyNzoKICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwgX2NhbGxlZTIsIG51bGwsIFtbMCwgMjNdXSk7CiAgICAgICAgfSkpOwogICAgICAgIHJldHVybiBfdW56aXBDaHVuay5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHVuemlwQ2h1bmtTbGljZShfeDMsIF94NCkgewogICAgICAgIHJldHVybiBfdW56aXBDaHVua1NsaWNlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gX3VuemlwQ2h1bmtTbGljZSgpIHsKICAgICAgICBfdW56aXBDaHVua1NsaWNlID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlMyhpbnB1dERhdGEsIGNodW5rKSB7CiAgICAgICAgICB2YXIgc3RybSwgY3BvcywgZHBvcywgZGVjb21wcmVzc2VkQmxvY2tzLCBjcG9zaXRpb25zLCBkcG9zaXRpb25zLCByZW1haW5pbmdJbnB1dCwgaW5mbGF0b3IsIF9idWZmZXIyLCBsZW4sIG9yaWdDcG9zLCBidWZmZXI7CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5wcmV2ID0gMDsKICAgICAgICAgICAgICAgICAgY3BvcyA9IGNodW5rLm1pbnYuYmxvY2tQb3NpdGlvbjsKICAgICAgICAgICAgICAgICAgZHBvcyA9IGNodW5rLm1pbnYuZGF0YVBvc2l0aW9uOwogICAgICAgICAgICAgICAgICBkZWNvbXByZXNzZWRCbG9ja3MgPSBbXTsKICAgICAgICAgICAgICAgICAgY3Bvc2l0aW9ucyA9IFtdOwogICAgICAgICAgICAgICAgICBkcG9zaXRpb25zID0gW107CiAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgIHJlbWFpbmluZ0lucHV0ID0gaW5wdXREYXRhLnNsaWNlKGNwb3MgLSBjaHVuay5taW52LmJsb2NrUG9zaXRpb24pOwogICAgICAgICAgICAgICAgICBpbmZsYXRvciA9IG5ldyBJbmZsYXRlKCk7CiAgICAgICAgICAgICAgICAgIHN0cm0gPSBpbmZsYXRvci5zdHJtOwogICAgICAgICAgICAgICAgICBpbmZsYXRvci5wdXNoKHJlbWFpbmluZ0lucHV0LCBaX1NZTkNfRkxVU0gpOwogICAgICAgICAgICAgICAgICBpZiAoIWluZmxhdG9yLmVycikgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGluZmxhdG9yLm1zZyk7CiAgICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgICBfYnVmZmVyMiA9IGltcG9ydF9idWZmZXIuQnVmZmVyLmZyb20oaW5mbGF0b3IucmVzdWx0KTsKICAgICAgICAgICAgICAgICAgZGVjb21wcmVzc2VkQmxvY2tzLnB1c2goX2J1ZmZlcjIpOwogICAgICAgICAgICAgICAgICBsZW4gPSBfYnVmZmVyMi5sZW5ndGg7CiAgICAgICAgICAgICAgICAgIGNwb3NpdGlvbnMucHVzaChjcG9zKTsKICAgICAgICAgICAgICAgICAgZHBvc2l0aW9ucy5wdXNoKGRwb3MpOwogICAgICAgICAgICAgICAgICBpZiAoZGVjb21wcmVzc2VkQmxvY2tzLmxlbmd0aCA9PT0gMSAmJiBjaHVuay5taW52LmRhdGFQb3NpdGlvbikgewogICAgICAgICAgICAgICAgICAgIGRlY29tcHJlc3NlZEJsb2Nrc1swXSA9IGRlY29tcHJlc3NlZEJsb2Nrc1swXS5zbGljZShjaHVuay5taW52LmRhdGFQb3NpdGlvbik7CiAgICAgICAgICAgICAgICAgICAgbGVuID0gZGVjb21wcmVzc2VkQmxvY2tzWzBdLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBvcmlnQ3BvcyA9IGNwb3M7CiAgICAgICAgICAgICAgICAgIGNwb3MgKz0gc3RybS5uZXh0X2luOwogICAgICAgICAgICAgICAgICBkcG9zICs9IGxlbjsKICAgICAgICAgICAgICAgICAgaWYgKCEob3JpZ0Nwb3MgPj0gY2h1bmsubWF4di5ibG9ja1Bvc2l0aW9uKSkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjY7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZGVjb21wcmVzc2VkQmxvY2tzW2RlY29tcHJlc3NlZEJsb2Nrcy5sZW5ndGggLSAxXSA9IGRlY29tcHJlc3NlZEJsb2Nrc1tkZWNvbXByZXNzZWRCbG9ja3MubGVuZ3RoIC0gMV0uc2xpY2UoMCwgY2h1bmsubWF4di5ibG9ja1Bvc2l0aW9uID09PSBjaHVuay5taW52LmJsb2NrUG9zaXRpb24gPyBjaHVuay5tYXh2LmRhdGFQb3NpdGlvbiAtIGNodW5rLm1pbnYuZGF0YVBvc2l0aW9uICsgMSA6IGNodW5rLm1heHYuZGF0YVBvc2l0aW9uICsgMSk7CiAgICAgICAgICAgICAgICAgIGNwb3NpdGlvbnMucHVzaChjcG9zKTsKICAgICAgICAgICAgICAgICAgZHBvc2l0aW9ucy5wdXNoKGRwb3MpOwogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgiYnJlYWsiLCAyNyk7CiAgICAgICAgICAgICAgICBjYXNlIDI2OgogICAgICAgICAgICAgICAgICBpZiAoc3RybS5hdmFpbF9pbikgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FzZSAyNzoKICAgICAgICAgICAgICAgICAgYnVmZmVyID0gaW1wb3J0X2J1ZmZlci5CdWZmZXIuY29uY2F0KGRlY29tcHJlc3NlZEJsb2Nrcyk7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCB7IGJ1ZmZlciwgY3Bvc2l0aW9ucywgZHBvc2l0aW9ucyB9KTsKICAgICAgICAgICAgICAgIGNhc2UgMzE6CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5wcmV2ID0gMzE7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My50MCA9IF9jb250ZXh0M1siY2F0Y2giXSgwKTsKICAgICAgICAgICAgICAgICAgaWYgKCFfY29udGV4dDMudDAubWVzc2FnZS5tYXRjaCgvaW5jb3JyZWN0IGhlYWRlciBjaGVjay8pKSB7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAzNTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInByb2JsZW0gZGVjb21wcmVzc2luZyBibG9jazogaW5jb3JyZWN0IGd6aXAgaGVhZGVyIGNoZWNrIik7CiAgICAgICAgICAgICAgICBjYXNlIDM1OgogICAgICAgICAgICAgICAgICB0aHJvdyBfY29udGV4dDMudDA7CiAgICAgICAgICAgICAgICBjYXNlIDM2OgogICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlMywgbnVsbCwgW1swLCAzMV1dKTsKICAgICAgICB9KSk7CiAgICAgICAgcmV0dXJuIF91bnppcENodW5rU2xpY2UuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQogICAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgICB1bnppcCwKICAgICAgICB1bnppcENodW5rLAogICAgICAgIHVuemlwQ2h1bmtTbGljZSwKICAgICAgICBwYWtvVW56aXA6IHVuemlwLAogICAgICAgIG5vZGVVbnppcDogZnVuY3Rpb24gbm9kZVVuemlwKCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJub2RlVW56aXAgbm90IGltcGxlbWVudGVkLiIpOwogICAgICAgIH0KICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gKGRpc2FibGVkKTpub2RlX21vZHVsZXMvQGdtb2QvYmd6Zi1maWxlaGFuZGxlL25vZGVfbW9kdWxlcy9mcy1leHRyYS9saWIvaW5kZXguanMKICB2YXIgcmVxdWlyZV9saWIgPSBfX2NvbW1vbkpTKHsKICAgICIoZGlzYWJsZWQpOm5vZGVfbW9kdWxlcy9AZ21vZC9iZ3pmLWZpbGVoYW5kbGUvbm9kZV9tb2R1bGVzL2ZzLWV4dHJhL2xpYi9pbmRleC5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BnbW9kL2JnemYtZmlsZWhhbmRsZS9kaXN0L2xvY2FsRmlsZS5qcwogIHZhciByZXF1aXJlX2xvY2FsRmlsZSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AZ21vZC9iZ3pmLWZpbGVoYW5kbGUvZGlzdC9sb2NhbEZpbGUuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoKTsKICAgICAgdmFyIF9yZWdlbmVyYXRvciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9yZWdlbmVyYXRvcjIoKSk7CiAgICAgIHZhciBfYXN5bmNUb0dlbmVyYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfYXN5bmNUb0dlbmVyYXRvcjIoKSk7CiAgICAgIHZhciBfY2xhc3NDYWxsQ2hlY2syID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2NsYXNzQ2FsbENoZWNrMigpKTsKICAgICAgdmFyIF9jcmVhdGVDbGFzczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfY3JlYXRlQ2xhc3MyKCkpOwogICAgICB2YXIgZnMgPSByZXF1aXJlX2xpYigpOwogICAgICB2YXIgTG9jYWxGaWxlID0gLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKCkgewogICAgICAgIGZ1bmN0aW9uIExvY2FsRmlsZTIocGF0aCkgewogICAgICAgICAgKDAsIF9jbGFzc0NhbGxDaGVjazIuZGVmYXVsdCkodGhpcywgTG9jYWxGaWxlMik7CiAgICAgICAgICB0aGlzLmZkUHJvbWlzZSA9IGZzLm9wZW4ocGF0aCwgInIiKTsKICAgICAgICAgIHRoaXMucGF0aCA9IHBhdGg7CiAgICAgICAgfQogICAgICAgICgwLCBfY3JlYXRlQ2xhc3MyLmRlZmF1bHQpKExvY2FsRmlsZTIsIFt7IGtleTogInJlYWQiLCB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgX3JlYWQgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoYnVmLCBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24pIHsKICAgICAgICAgICAgdmFyIGZkLCByZXQ7CiAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZkUHJvbWlzZTsKICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIGZkID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnMucmVhZChmZCwgYnVmLCBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24pOwogICAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgICAgcmV0ID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCByZXQpOwogICAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICAgICAgfSkpOwogICAgICAgICAgZnVuY3Rpb24gcmVhZChfeCwgX3gyLCBfeDMsIF94NCkgewogICAgICAgICAgICByZXR1cm4gX3JlYWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZWFkOwogICAgICAgIH0oKSB9LCB7IGtleTogInN0YXQiLCB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgX3N0YXQgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgICAgICB2YXIgZmQ7CiAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmRQcm9taXNlOwogICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgZmQgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgZnMuZnN0YXQoZmQpKTsKICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMpOwogICAgICAgICAgfSkpOwogICAgICAgICAgZnVuY3Rpb24gc3RhdCgpIHsKICAgICAgICAgICAgcmV0dXJuIF9zdGF0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gc3RhdDsKICAgICAgICB9KCkgfV0pOwogICAgICAgIHJldHVybiBMb2NhbEZpbGUyOwogICAgICB9KCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gTG9jYWxGaWxlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGdtb2QvYmd6Zi1maWxlaGFuZGxlL2Rpc3QvZ3ppSW5kZXguanMKICB2YXIgcmVxdWlyZV9nemlJbmRleCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AZ21vZC9iZ3pmLWZpbGVoYW5kbGUvZGlzdC9nemlJbmRleC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IHJlcXVpcmVfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MigpOwogICAgICB2YXIgX3JlZ2VuZXJhdG9yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX3JlZ2VuZXJhdG9yMigpKTsKICAgICAgdmFyIF9hc3luY1RvR2VuZXJhdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9hc3luY1RvR2VuZXJhdG9yMigpKTsKICAgICAgdmFyIF9jbGFzc0NhbGxDaGVjazIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfY2xhc3NDYWxsQ2hlY2syKCkpOwogICAgICB2YXIgX2NyZWF0ZUNsYXNzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9jcmVhdGVDbGFzczIoKSk7CiAgICAgIHZhciBMb25nID0gcmVxdWlyZV9sb25nKCk7CiAgICAgIHZhciBMb2NhbEZpbGUgPSByZXF1aXJlX2xvY2FsRmlsZSgpOwogICAgICB2YXIgVU5DT01QUkVTU0VEX1BPU0lUSU9OID0gMTsKICAgICAgdmFyIEd6aUluZGV4ID0gLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKCkgewogICAgICAgIGZ1bmN0aW9uIEd6aUluZGV4MihfcmVmKSB7CiAgICAgICAgICB2YXIgZmlsZWhhbmRsZSA9IF9yZWYuZmlsZWhhbmRsZSwgcGF0aCA9IF9yZWYucGF0aDsKICAgICAgICAgICgwLCBfY2xhc3NDYWxsQ2hlY2syLmRlZmF1bHQpKHRoaXMsIEd6aUluZGV4Mik7CiAgICAgICAgICBpZiAoZmlsZWhhbmRsZSkKICAgICAgICAgICAgdGhpcy5maWxlaGFuZGxlID0gZmlsZWhhbmRsZTsKICAgICAgICAgIGVsc2UgaWYgKHBhdGgpCiAgICAgICAgICAgIHRoaXMuZmlsZWhhbmRsZSA9IG5ldyBMb2NhbEZpbGUocGF0aCk7CiAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoImVpdGhlciBmaWxlaGFuZGxlIG9yIHBhdGggbXVzdCBiZSBkZWZpbmVkIik7CiAgICAgICAgfQogICAgICAgICgwLCBfY3JlYXRlQ2xhc3MyLmRlZmF1bHQpKEd6aUluZGV4MiwgW3sga2V5OiAiX3JlYWRMb25nV2l0aE92ZXJmbG93IiwgdmFsdWU6IGZ1bmN0aW9uIF9yZWFkTG9uZ1dpdGhPdmVyZmxvdyhidWYpIHsKICAgICAgICAgIHZhciBvZmZzZXQgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1sxXSA6IDA7CiAgICAgICAgICB2YXIgdW5zaWduZWQgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1syXSA6IHRydWU7CiAgICAgICAgICB2YXIgbG9uZyA9IExvbmcuZnJvbUJ5dGVzTEUoYnVmLnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgOCksIHVuc2lnbmVkKTsKICAgICAgICAgIGlmIChsb25nLmdyZWF0ZXJUaGFuKE51bWJlci5NQVhfU0FGRV9JTlRFR0VSKSB8fCBsb25nLmxlc3NUaGFuKE51bWJlci5NSU5fU0FGRV9JTlRFR0VSKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiaW50ZWdlciBvdmVyZmxvdyIpOwogICAgICAgICAgcmV0dXJuIGxvbmcudG9OdW1iZXIoKTsKICAgICAgICB9IH0sIHsga2V5OiAiX2dldEluZGV4IiwgdmFsdWU6IGZ1bmN0aW9uIF9nZXRJbmRleCgpIHsKICAgICAgICAgIGlmICghdGhpcy5pbmRleCkKICAgICAgICAgICAgdGhpcy5pbmRleCA9IHRoaXMuX3JlYWRJbmRleCgpOwogICAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXg7CiAgICAgICAgfSB9LCB7CiAgICAgICAgICBrZXk6ICJfcmVhZEluZGV4IiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIF9yZWFkSW5kZXgyID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgICAgICAgIHZhciBidWYsIG51bUVudHJpZXMsIGVudHJpZXMsIGJ1ZlNpemUsIGVudHJ5TnVtYmVyLCBjb21wcmVzc2VkUG9zaXRpb24sIHVuY29tcHJlc3NlZFBvc2l0aW9uOwogICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgYnVmID0gaW1wb3J0X2J1ZmZlci5CdWZmZXIuYWxsb2NVbnNhZmUoOCk7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGVoYW5kbGUucmVhZChidWYsIDAsIDgsIDApOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgIG51bUVudHJpZXMgPSB0aGlzLl9yZWFkTG9uZ1dpdGhPdmVyZmxvdyhidWYsIDAsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgaWYgKG51bUVudHJpZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgW1swLCAwXV0pOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgICAgICAgIGVudHJpZXMgPSBuZXcgQXJyYXkobnVtRW50cmllcyArIDEpOwogICAgICAgICAgICAgICAgICAgICAgZW50cmllc1swXSA9IFswLCAwXTsKICAgICAgICAgICAgICAgICAgICAgIGJ1ZlNpemUgPSA4ICogMiAqIG51bUVudHJpZXM7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIShidWZTaXplID4gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJpbnRlZ2VyIG92ZXJmbG93Iik7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgIGJ1ZiA9IGltcG9ydF9idWZmZXIuQnVmZmVyLmFsbG9jVW5zYWZlKGJ1ZlNpemUpOwogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsZWhhbmRsZS5yZWFkKGJ1ZiwgMCwgYnVmU2l6ZSwgOCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgICAgICAgIGZvciAoZW50cnlOdW1iZXIgPSAwOyBlbnRyeU51bWJlciA8IG51bUVudHJpZXM7IGVudHJ5TnVtYmVyICs9IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29tcHJlc3NlZFBvc2l0aW9uID0gdGhpcy5fcmVhZExvbmdXaXRoT3ZlcmZsb3coYnVmLCBlbnRyeU51bWJlciAqIDE2KTsKICAgICAgICAgICAgICAgICAgICAgICAgdW5jb21wcmVzc2VkUG9zaXRpb24gPSB0aGlzLl9yZWFkTG9uZ1dpdGhPdmVyZmxvdyhidWYsIGVudHJ5TnVtYmVyICogMTYgKyA4KTsKICAgICAgICAgICAgICAgICAgICAgICAgZW50cmllc1tlbnRyeU51bWJlciArIDFdID0gW2NvbXByZXNzZWRQb3NpdGlvbiwgdW5jb21wcmVzc2VkUG9zaXRpb25dOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgZW50cmllcyk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIGZ1bmN0aW9uIF9yZWFkSW5kZXgoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF9yZWFkSW5kZXgyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIF9yZWFkSW5kZXg7CiAgICAgICAgICB9KCkKICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJnZXRMYXN0QmxvY2siLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgX2dldExhc3RCbG9jayA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvci5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgICAgICAgdmFyIGVudHJpZXM7CiAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvci5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldEluZGV4KCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgZW50cmllcyA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgICAgICAgaWYgKGVudHJpZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgdm9pZCAwKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgZW50cmllc1tlbnRyaWVzLmxlbmd0aCAtIDFdKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMpOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIGZ1bmN0aW9uIGdldExhc3RCbG9jaygpIHsKICAgICAgICAgICAgICByZXR1cm4gX2dldExhc3RCbG9jay5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBnZXRMYXN0QmxvY2s7CiAgICAgICAgICB9KCkKICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJnZXRSZWxldmFudEJsb2Nrc0ZvclJlYWQiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgX2dldFJlbGV2YW50QmxvY2tzRm9yUmVhZCA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvci5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMobGVuZ3RoLCBwb3NpdGlvbikgewogICAgICAgICAgICAgIHZhciBlbmRQb3NpdGlvbiwgZW50cmllcywgcmVsZXZhbnQsIGNvbXBhcmUsIGxvd2VyQm91bmQsIHVwcGVyQm91bmQsIHNlYXJjaFBvc2l0aW9uLCBjb21wYXJpc29uLCBpOwogICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIGVuZFBvc2l0aW9uID0gcG9zaXRpb24gKyBsZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIShsZW5ndGggPT09IDApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgW10pOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9nZXRJbmRleCgpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgICAgIGVudHJpZXMgPSBfY29udGV4dDMuc2VudDsKICAgICAgICAgICAgICAgICAgICAgIHJlbGV2YW50ID0gW107CiAgICAgICAgICAgICAgICAgICAgICBjb21wYXJlID0gZnVuY3Rpb24gY29tcGFyZTIoZW50cnksIG5leHRFbnRyeSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdW5jb21wcmVzc2VkUG9zaXRpb24gPSBlbnRyeVtVTkNPTVBSRVNTRURfUE9TSVRJT05dOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV4dFVuY29tcHJlc3NlZFBvc2l0aW9uID0gbmV4dEVudHJ5ID8gbmV4dEVudHJ5W1VOQ09NUFJFU1NFRF9QT1NJVElPTl0gOiBJbmZpbml0eTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVuY29tcHJlc3NlZFBvc2l0aW9uIDw9IHBvc2l0aW9uICYmIG5leHRVbmNvbXByZXNzZWRQb3NpdGlvbiA+IHBvc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVuY29tcHJlc3NlZFBvc2l0aW9uIDwgcG9zaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgbG93ZXJCb3VuZCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICB1cHBlckJvdW5kID0gZW50cmllcy5sZW5ndGggLSAxOwogICAgICAgICAgICAgICAgICAgICAgc2VhcmNoUG9zaXRpb24gPSBNYXRoLmZsb29yKGVudHJpZXMubGVuZ3RoIC8gMik7CiAgICAgICAgICAgICAgICAgICAgICBjb21wYXJpc29uID0gY29tcGFyZShlbnRyaWVzW3NlYXJjaFBvc2l0aW9uXSwgZW50cmllc1tzZWFyY2hQb3NpdGlvbiArIDFdKTsKICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChjb21wYXJpc29uICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb21wYXJpc29uID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHVwcGVyQm91bmQgPSBzZWFyY2hQb3NpdGlvbiAtIDE7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY29tcGFyaXNvbiA8IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBsb3dlckJvdW5kID0gc2VhcmNoUG9zaXRpb24gKyAxOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaFBvc2l0aW9uID0gTWF0aC5jZWlsKCh1cHBlckJvdW5kIC0gbG93ZXJCb3VuZCkgLyAyKSArIGxvd2VyQm91bmQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBhcmlzb24gPSBjb21wYXJlKGVudHJpZXNbc2VhcmNoUG9zaXRpb25dLCBlbnRyaWVzW3NlYXJjaFBvc2l0aW9uICsgMV0pOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcmVsZXZhbnQucHVzaChlbnRyaWVzW3NlYXJjaFBvc2l0aW9uXSk7CiAgICAgICAgICAgICAgICAgICAgICBpID0gc2VhcmNoUG9zaXRpb24gKyAxOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIShpIDwgZW50cmllcy5sZW5ndGgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcmVsZXZhbnQucHVzaChlbnRyaWVzW2ldKTsKICAgICAgICAgICAgICAgICAgICAgIGlmICghKGVudHJpZXNbaV1bVU5DT01QUkVTU0VEX1BPU0lUSU9OXSA+PSBlbmRQb3NpdGlvbikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxOTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgiYnJlYWsiLCAyMik7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgICAgICAgICAgIGkgKz0gMTsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICAgICAgICAgICAgaWYgKHJlbGV2YW50W3JlbGV2YW50Lmxlbmd0aCAtIDFdW1VOQ09NUFJFU1NFRF9QT1NJVElPTl0gPCBlbmRQb3NpdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICByZWxldmFudC5wdXNoKFtdKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCByZWxldmFudCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyNDoKICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCBfY2FsbGVlMywgdGhpcyk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgZnVuY3Rpb24gZ2V0UmVsZXZhbnRCbG9ja3NGb3JSZWFkKF94LCBfeDIpIHsKICAgICAgICAgICAgICByZXR1cm4gX2dldFJlbGV2YW50QmxvY2tzRm9yUmVhZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBnZXRSZWxldmFudEJsb2Nrc0ZvclJlYWQ7CiAgICAgICAgICB9KCkKICAgICAgICB9XSk7CiAgICAgICAgcmV0dXJuIEd6aUluZGV4MjsKICAgICAgfSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IEd6aUluZGV4OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGdtb2QvYmd6Zi1maWxlaGFuZGxlL2Rpc3QvYmd6RmlsZWhhbmRsZS5qcwogIHZhciByZXF1aXJlX2JnekZpbGVoYW5kbGUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGdtb2QvYmd6Zi1maWxlaGFuZGxlL2Rpc3QvYmd6RmlsZWhhbmRsZS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IHJlcXVpcmVfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MigpOwogICAgICB2YXIgX3NsaWNlZFRvQXJyYXkyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX3NsaWNlZFRvQXJyYXkyKCkpOwogICAgICB2YXIgX3JlZ2VuZXJhdG9yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX3JlZ2VuZXJhdG9yMigpKTsKICAgICAgdmFyIF9hc3luY1RvR2VuZXJhdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9hc3luY1RvR2VuZXJhdG9yMigpKTsKICAgICAgdmFyIF9jbGFzc0NhbGxDaGVjazIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfY2xhc3NDYWxsQ2hlY2syKCkpOwogICAgICB2YXIgX2NyZWF0ZUNsYXNzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9jcmVhdGVDbGFzczIoKSk7CiAgICAgIHZhciBfcmVxdWlyZSA9IHJlcXVpcmVfdW56aXBfcGFrbygpOwogICAgICB2YXIgdW56aXAgPSBfcmVxdWlyZS51bnppcDsKICAgICAgdmFyIExvY2FsRmlsZSA9IHJlcXVpcmVfbG9jYWxGaWxlKCk7CiAgICAgIHZhciBHemlJbmRleCA9IHJlcXVpcmVfZ3ppSW5kZXgoKTsKICAgICAgdmFyIEJnekZpbGVoYW5kbGUgPSAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24oKSB7CiAgICAgICAgZnVuY3Rpb24gQmd6RmlsZWhhbmRsZTIoX3JlZikgewogICAgICAgICAgdmFyIGZpbGVoYW5kbGUgPSBfcmVmLmZpbGVoYW5kbGUsIHBhdGggPSBfcmVmLnBhdGgsIGd6aUZpbGVoYW5kbGUgPSBfcmVmLmd6aUZpbGVoYW5kbGUsIGd6aVBhdGggPSBfcmVmLmd6aVBhdGg7CiAgICAgICAgICAoMCwgX2NsYXNzQ2FsbENoZWNrMi5kZWZhdWx0KSh0aGlzLCBCZ3pGaWxlaGFuZGxlMik7CiAgICAgICAgICBpZiAoZmlsZWhhbmRsZSkKICAgICAgICAgICAgdGhpcy5maWxlaGFuZGxlID0gZmlsZWhhbmRsZTsKICAgICAgICAgIGVsc2UgaWYgKHBhdGgpCiAgICAgICAgICAgIHRoaXMuZmlsZWhhbmRsZSA9IG5ldyBMb2NhbEZpbGUocGF0aCk7CiAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoImVpdGhlciBmaWxlaGFuZGxlIG9yIHBhdGggbXVzdCBiZSBkZWZpbmVkIik7CiAgICAgICAgICBpZiAoIWd6aUZpbGVoYW5kbGUgJiYgIWd6aVBhdGggJiYgIXBhdGgpCiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoImVpdGhlciBnemlGaWxlaGFuZGxlIG9yIGd6aVBhdGggbXVzdCBiZSBkZWZpbmVkIik7CiAgICAgICAgICB0aGlzLmd6aSA9IG5ldyBHemlJbmRleCh7CiAgICAgICAgICAgIGZpbGVoYW5kbGU6IGd6aUZpbGVoYW5kbGUsCiAgICAgICAgICAgIHBhdGg6ICFnemlGaWxlaGFuZGxlICYmICFnemlQYXRoICYmIHBhdGggPyBnemlQYXRoIDogIiIuY29uY2F0KHBhdGgsICIuZ3ppIikKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICAoMCwgX2NyZWF0ZUNsYXNzMi5kZWZhdWx0KShCZ3pGaWxlaGFuZGxlMiwgW3sga2V5OiAic3RhdCIsIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBfc3RhdCA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvci5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICAgICAgdmFyIGNvbXByZXNzZWRTdGF0OwogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxlaGFuZGxlLnN0YXQoKTsKICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIGNvbXByZXNzZWRTdGF0ID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dC50MCA9IE9iamVjdDsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dC50MSA9IGNvbXByZXNzZWRTdGF0OwogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFVuY29tcHJlc3NlZEZpbGVTaXplKCk7CiAgICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dC50MiA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQudDMgPSB2b2lkIDA7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQudDQgPSB2b2lkIDA7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQudDUgPSB7IHNpemU6IF9jb250ZXh0LnQyLCBibG9ja3M6IF9jb250ZXh0LnQzLCBibGtzaXplOiBfY29udGV4dC50NCB9OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIF9jb250ZXh0LnQwLmFzc2lnbi5jYWxsKF9jb250ZXh0LnQwLCBfY29udGV4dC50MSwgX2NvbnRleHQudDUpKTsKICAgICAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZSwgdGhpcyk7CiAgICAgICAgICB9KSk7CiAgICAgICAgICBmdW5jdGlvbiBzdGF0KCkgewogICAgICAgICAgICByZXR1cm4gX3N0YXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBzdGF0OwogICAgICAgIH0oKSB9LCB7IGtleTogImdldFVuY29tcHJlc3NlZEZpbGVTaXplIiwgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIF9nZXRVbmNvbXByZXNzZWRGaWxlU2l6ZSA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvci5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgICAgIHZhciBfcmVmMiwgX3JlZjMsIHVuY29tcHJlc3NlZFBvc2l0aW9uLCBfcmVmNCwgc2l6ZSwgYnVmLCBfcmVmNSwgYnl0ZXNSZWFkLCBsYXN0QmxvY2tVbmNvbXByZXNzZWRTaXplOwogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmd6aS5nZXRMYXN0QmxvY2soKTsKICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIF9yZWYyID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgX3JlZjMgPSAoMCwgX3NsaWNlZFRvQXJyYXkyLmRlZmF1bHQpKF9yZWYyLCAyKTsKICAgICAgICAgICAgICAgICAgICB1bmNvbXByZXNzZWRQb3NpdGlvbiA9IF9yZWYzWzFdOwogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxlaGFuZGxlLnN0YXQoKTsKICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgIF9yZWY0ID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgc2l6ZSA9IF9yZWY0LnNpemU7CiAgICAgICAgICAgICAgICAgICAgYnVmID0gaW1wb3J0X2J1ZmZlci5CdWZmZXIuYWxsb2NVbnNhZmUoNCk7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxMjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxlaGFuZGxlLnJlYWQoYnVmLCAwLCA0LCBzaXplIC0gMjggLSA0KTsKICAgICAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgICAgICBfcmVmNSA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgICAgIGJ5dGVzUmVhZCA9IF9yZWY1LmJ5dGVzUmVhZDsKICAgICAgICAgICAgICAgICAgICBpZiAoIShieXRlc1JlYWQgIT09IDQpKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE2OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigicmVhZCBlcnJvciIpOwogICAgICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgICAgIGxhc3RCbG9ja1VuY29tcHJlc3NlZFNpemUgPSBidWYucmVhZFVJbnQzMkxFKDApOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCB1bmNvbXByZXNzZWRQb3NpdGlvbiArIGxhc3RCbG9ja1VuY29tcHJlc3NlZFNpemUpOwogICAgICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMpOwogICAgICAgICAgfSkpOwogICAgICAgICAgZnVuY3Rpb24gZ2V0VW5jb21wcmVzc2VkRmlsZVNpemUoKSB7CiAgICAgICAgICAgIHJldHVybiBfZ2V0VW5jb21wcmVzc2VkRmlsZVNpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBnZXRVbmNvbXByZXNzZWRGaWxlU2l6ZTsKICAgICAgICB9KCkgfSwgeyBrZXk6ICJfcmVhZEFuZFVuY29tcHJlc3NCbG9jayIsIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBfcmVhZEFuZFVuY29tcHJlc3NCbG9jazIgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKGJsb2NrQnVmZmVyLCBfcmVmNiwgX3JlZjcpIHsKICAgICAgICAgICAgdmFyIF9yZWY4LCBjb21wcmVzc2VkUG9zaXRpb24sIF9yZWY5LCBuZXh0Q29tcHJlc3NlZFBvc2l0aW9uLCBuZXh0LCBibG9ja0NvbXByZXNzZWRMZW5ndGgsIHVuemlwcGVkQnVmZmVyOwogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgX3JlZjggPSAoMCwgX3NsaWNlZFRvQXJyYXkyLmRlZmF1bHQpKF9yZWY2LCAxKSwgY29tcHJlc3NlZFBvc2l0aW9uID0gX3JlZjhbMF07CiAgICAgICAgICAgICAgICAgICAgX3JlZjkgPSAoMCwgX3NsaWNlZFRvQXJyYXkyLmRlZmF1bHQpKF9yZWY3LCAxKSwgbmV4dENvbXByZXNzZWRQb3NpdGlvbiA9IF9yZWY5WzBdOwogICAgICAgICAgICAgICAgICAgIG5leHQgPSBuZXh0Q29tcHJlc3NlZFBvc2l0aW9uOwogICAgICAgICAgICAgICAgICAgIGlmIChuZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDc7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA2OwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGVoYW5kbGUuc3RhdCgpOwogICAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgICAgbmV4dCA9IF9jb250ZXh0My5zZW50LnNpemU7CiAgICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgICBibG9ja0NvbXByZXNzZWRMZW5ndGggPSBuZXh0IC0gY29tcHJlc3NlZFBvc2l0aW9uOwogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsZWhhbmRsZS5yZWFkKGJsb2NrQnVmZmVyLCAwLCBibG9ja0NvbXByZXNzZWRMZW5ndGgsIGNvbXByZXNzZWRQb3NpdGlvbik7CiAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxMjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW56aXAoYmxvY2tCdWZmZXIuc2xpY2UoMCwgYmxvY2tDb21wcmVzc2VkTGVuZ3RoKSk7CiAgICAgICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICAgICAgdW56aXBwZWRCdWZmZXIgPSBfY29udGV4dDMuc2VudDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgdW56aXBwZWRCdWZmZXIpOwogICAgICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZTMsIHRoaXMpOwogICAgICAgICAgfSkpOwogICAgICAgICAgZnVuY3Rpb24gX3JlYWRBbmRVbmNvbXByZXNzQmxvY2soX3gsIF94MiwgX3gzKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVhZEFuZFVuY29tcHJlc3NCbG9jazIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBfcmVhZEFuZFVuY29tcHJlc3NCbG9jazsKICAgICAgICB9KCkgfSwgeyBrZXk6ICJyZWFkIiwgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIF9yZWFkID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlNChidWYsIG9mZnNldCwgbGVuZ3RoLCBwb3NpdGlvbikgewogICAgICAgICAgICB2YXIgYmxvY2tQb3NpdGlvbnMsIGJsb2NrQnVmZmVyLCBkZXN0aW5hdGlvbk9mZnNldCwgYnl0ZXNSZWFkLCBibG9ja051bSwgdW5jb21wcmVzc2VkQnVmZmVyLCBfYmxvY2tQb3NpdGlvbnMkYmxvY2ssIHVuY29tcHJlc3NlZFBvc2l0aW9uLCBzb3VyY2VPZmZzZXQsIHNvdXJjZUVuZDsKICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvci5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nemkuZ2V0UmVsZXZhbnRCbG9ja3NGb3JSZWFkKGxlbmd0aCwgcG9zaXRpb24pOwogICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgYmxvY2tQb3NpdGlvbnMgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgICAgICBibG9ja0J1ZmZlciA9IGltcG9ydF9idWZmZXIuQnVmZmVyLmFsbG9jVW5zYWZlKDMyNzY4ICogMik7CiAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb25PZmZzZXQgPSBvZmZzZXQ7CiAgICAgICAgICAgICAgICAgICAgYnl0ZXNSZWFkID0gMDsKICAgICAgICAgICAgICAgICAgICBibG9ja051bSA9IDA7CiAgICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgICBpZiAoIShibG9ja051bSA8IGJsb2NrUG9zaXRpb25zLmxlbmd0aCAtIDEpKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDE4OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlYWRBbmRVbmNvbXByZXNzQmxvY2soYmxvY2tCdWZmZXIsIGJsb2NrUG9zaXRpb25zW2Jsb2NrTnVtXSwgYmxvY2tQb3NpdGlvbnNbYmxvY2tOdW0gKyAxXSk7CiAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgdW5jb21wcmVzc2VkQnVmZmVyID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgX2Jsb2NrUG9zaXRpb25zJGJsb2NrID0gKDAsIF9zbGljZWRUb0FycmF5Mi5kZWZhdWx0KShibG9ja1Bvc2l0aW9uc1tibG9ja051bV0sIDIpLCB1bmNvbXByZXNzZWRQb3NpdGlvbiA9IF9ibG9ja1Bvc2l0aW9ucyRibG9ja1sxXTsKICAgICAgICAgICAgICAgICAgICBzb3VyY2VPZmZzZXQgPSB1bmNvbXByZXNzZWRQb3NpdGlvbiA+PSBwb3NpdGlvbiA/IDAgOiBwb3NpdGlvbiAtIHVuY29tcHJlc3NlZFBvc2l0aW9uOwogICAgICAgICAgICAgICAgICAgIHNvdXJjZUVuZCA9IE1hdGgubWluKHBvc2l0aW9uICsgbGVuZ3RoLCB1bmNvbXByZXNzZWRQb3NpdGlvbiArIHVuY29tcHJlc3NlZEJ1ZmZlci5sZW5ndGgpIC0gdW5jb21wcmVzc2VkUG9zaXRpb247CiAgICAgICAgICAgICAgICAgICAgaWYgKHNvdXJjZU9mZnNldCA+PSAwICYmIHNvdXJjZU9mZnNldCA8IHVuY29tcHJlc3NlZEJ1ZmZlci5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgIHVuY29tcHJlc3NlZEJ1ZmZlci5jb3B5KGJ1ZiwgZGVzdGluYXRpb25PZmZzZXQsIHNvdXJjZU9mZnNldCwgc291cmNlRW5kKTsKICAgICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uT2Zmc2V0ICs9IHNvdXJjZUVuZCAtIHNvdXJjZU9mZnNldDsKICAgICAgICAgICAgICAgICAgICAgIGJ5dGVzUmVhZCArPSBzb3VyY2VFbmQgLSBzb3VyY2VPZmZzZXQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgICAgIGJsb2NrTnVtICs9IDE7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCB7IGJ5dGVzUmVhZCwgYnVmZmVyOiBidWYgfSk7CiAgICAgICAgICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBfY2FsbGVlNCwgdGhpcyk7CiAgICAgICAgICB9KSk7CiAgICAgICAgICBmdW5jdGlvbiByZWFkKF94NCwgX3g1LCBfeDYsIF94NykgewogICAgICAgICAgICByZXR1cm4gX3JlYWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZWFkOwogICAgICAgIH0oKSB9XSk7CiAgICAgICAgcmV0dXJuIEJnekZpbGVoYW5kbGUyOwogICAgICB9KCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gQmd6RmlsZWhhbmRsZTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BnbW9kL2JnemYtZmlsZWhhbmRsZS9kaXN0L2luZGV4LmpzCiAgdmFyIHJlcXVpcmVfZGlzdDIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGdtb2QvYmd6Zi1maWxlaGFuZGxlL2Rpc3QvaW5kZXguanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIEJnemZGaWxlaGFuZGxlID0gcmVxdWlyZV9iZ3pGaWxlaGFuZGxlKCk7CiAgICAgIHZhciBfcmVxdWlyZSA9IHJlcXVpcmVfdW56aXBfcGFrbygpOwogICAgICB2YXIgdW56aXAgPSBfcmVxdWlyZS51bnppcDsKICAgICAgdmFyIHVuemlwQ2h1bmsgPSBfcmVxdWlyZS51bnppcENodW5rOwogICAgICB2YXIgdW56aXBDaHVua1NsaWNlID0gX3JlcXVpcmUudW56aXBDaHVua1NsaWNlOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHsgQmd6ZkZpbGVoYW5kbGUsIHVuemlwLCB1bnppcENodW5rLCB1bnppcENodW5rU2xpY2UgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BnbW9kL2JhbS9kaXN0L2NzaS5qcwogIHZhciByZXF1aXJlX2NzaSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AZ21vZC9iYW0vZGlzdC9jc2kuanMiKGV4cG9ydHMpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCA9IHJlcXVpcmVfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCgpOwogICAgICB2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IHJlcXVpcmVfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KCk7CiAgICAgIHZhciBfT2JqZWN0JGRlZmluZVByb3BlcnR5ID0gcmVxdWlyZV9kZWZpbmVfcHJvcGVydHkzKCk7CiAgICAgIF9PYmplY3QkZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgICAgdmFsdWU6IHRydWUKICAgICAgfSk7CiAgICAgIGV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDsKICAgICAgdmFyIF9nZXRJdGVyYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfZ2V0X2l0ZXJhdG9yNSgpKTsKICAgICAgdmFyIF9pc0FycmF5ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2lzX2FycmF5NCgpKTsKICAgICAgdmFyIF9nZXRJdGVyYXRvck1ldGhvZDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfZ2V0X2l0ZXJhdG9yX21ldGhvZDUoKSk7CiAgICAgIHZhciBfc3ltYm9sID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX3N5bWJvbDMoKSk7CiAgICAgIHZhciBfZnJvbSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9mcm9tMygpKTsKICAgICAgdmFyIF9jb25zdHJ1Y3QgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfY29uc3RydWN0MygpKTsKICAgICAgdmFyIF9jb25jYXQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfY29uY2F0NCgpKTsKICAgICAgdmFyIF9zbGljZWRUb0FycmF5MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9zbGljZWRUb0FycmF5KCkpOwogICAgICB2YXIgX3NsaWNlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX3NsaWNlNigpKTsKICAgICAgdmFyIF9hc3NpZ24gPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfYXNzaWduMygpKTsKICAgICAgdmFyIF9yZWdlbmVyYXRvciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9yZWdlbmVyYXRvcigpKTsKICAgICAgdmFyIF9hc3luY1RvR2VuZXJhdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9hc3luY1RvR2VuZXJhdG9yKCkpOwogICAgICB2YXIgX2NsYXNzQ2FsbENoZWNrMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9jbGFzc0NhbGxDaGVjaygpKTsKICAgICAgdmFyIF9jcmVhdGVDbGFzczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfY3JlYXRlQ2xhc3MoKSk7CiAgICAgIHZhciBfYXNzZXJ0VGhpc0luaXRpYWxpemVkMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoKSk7CiAgICAgIHZhciBfaW5oZXJpdHMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2luaGVyaXRzKCkpOwogICAgICB2YXIgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oKSk7CiAgICAgIHZhciBfZ2V0UHJvdG90eXBlT2YyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2dldFByb3RvdHlwZU9mKCkpOwogICAgICB2YXIgX2RlZmluZVByb3BlcnR5MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9kZWZpbmVQcm9wZXJ0eSgpKTsKICAgICAgdmFyIF9sb25nID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2xvbmcoKSk7CiAgICAgIHZhciBfYmd6ZkZpbGVoYW5kbGUgPSByZXF1aXJlX2Rpc3QyKCk7CiAgICAgIHZhciBfdmlydHVhbE9mZnNldCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmVfdmlydHVhbE9mZnNldCgpKTsKICAgICAgdmFyIF9jaHVuayA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9jaHVuaygpKTsKICAgICAgdmFyIF91dGlsID0gcmVxdWlyZV91dGlsKCk7CiAgICAgIHZhciBfaW5kZXhGaWxlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2luZGV4RmlsZSgpKTsKICAgICAgZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIobywgYWxsb3dBcnJheUxpa2UpIHsKICAgICAgICB2YXIgaXQ7CiAgICAgICAgaWYgKHR5cGVvZiBfc3ltYm9sLmRlZmF1bHQgPT09ICJ1bmRlZmluZWQiIHx8ICgwLCBfZ2V0SXRlcmF0b3JNZXRob2QyLmRlZmF1bHQpKG8pID09IG51bGwpIHsKICAgICAgICAgIGlmICgoMCwgX2lzQXJyYXkuZGVmYXVsdCkobykgfHwgKGl0ID0gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8pKSB8fCBhbGxvd0FycmF5TGlrZSAmJiBvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgaWYgKGl0KQogICAgICAgICAgICAgIG8gPSBpdDsKICAgICAgICAgICAgdmFyIGkgPSAwOwogICAgICAgICAgICB2YXIgRiA9IGZ1bmN0aW9uIEYyKCkgewogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4geyBzOiBGLCBuOiBmdW5jdGlvbiBuKCkgewogICAgICAgICAgICAgIGlmIChpID49IG8ubGVuZ3RoKQogICAgICAgICAgICAgICAgcmV0dXJuIHsgZG9uZTogdHJ1ZSB9OwogICAgICAgICAgICAgIHJldHVybiB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogb1tpKytdIH07CiAgICAgICAgICAgIH0sIGU6IGZ1bmN0aW9uIGUoX2UpIHsKICAgICAgICAgICAgICB0aHJvdyBfZTsKICAgICAgICAgICAgfSwgZjogRiB9OwogICAgICAgICAgfQogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpOwogICAgICAgIH0KICAgICAgICB2YXIgbm9ybWFsQ29tcGxldGlvbiA9IHRydWUsIGRpZEVyciA9IGZhbHNlLCBlcnI7CiAgICAgICAgcmV0dXJuIHsgczogZnVuY3Rpb24gcygpIHsKICAgICAgICAgIGl0ID0gKDAsIF9nZXRJdGVyYXRvcjIuZGVmYXVsdCkobyk7CiAgICAgICAgfSwgbjogZnVuY3Rpb24gbigpIHsKICAgICAgICAgIHZhciBzdGVwID0gaXQubmV4dCgpOwogICAgICAgICAgbm9ybWFsQ29tcGxldGlvbiA9IHN0ZXAuZG9uZTsKICAgICAgICAgIHJldHVybiBzdGVwOwogICAgICAgIH0sIGU6IGZ1bmN0aW9uIGUoX2UyKSB7CiAgICAgICAgICBkaWRFcnIgPSB0cnVlOwogICAgICAgICAgZXJyID0gX2UyOwogICAgICAgIH0sIGY6IGZ1bmN0aW9uIGYoKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIW5vcm1hbENvbXBsZXRpb24gJiYgaXQucmV0dXJuICE9IG51bGwpCiAgICAgICAgICAgICAgaXQucmV0dXJuKCk7CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoZGlkRXJyKQogICAgICAgICAgICAgIHRocm93IGVycjsKICAgICAgICAgIH0KICAgICAgICB9IH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikgewogICAgICAgIHZhciBfY29udGV4dDg7CiAgICAgICAgaWYgKCFvKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpCiAgICAgICAgICByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTsKICAgICAgICB2YXIgbiA9ICgwLCBfc2xpY2UuZGVmYXVsdCkoX2NvbnRleHQ4ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pKS5jYWxsKF9jb250ZXh0OCwgOCwgLTEpOwogICAgICAgIGlmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKQogICAgICAgICAgbiA9IG8uY29uc3RydWN0b3IubmFtZTsKICAgICAgICBpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpCiAgICAgICAgICByZXR1cm4gKDAsIF9mcm9tLmRlZmF1bHQpKG8pOwogICAgICAgIGlmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkKICAgICAgICAgIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIF9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7CiAgICAgICAgaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpCiAgICAgICAgICBsZW4gPSBhcnIubGVuZ3RoOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgYXJyMltpXSA9IGFycltpXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFycjI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gX2NyZWF0ZVN1cGVyKERlcml2ZWQpIHsKICAgICAgICB2YXIgaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCA9IF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKTsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gX2NyZWF0ZVN1cGVySW50ZXJuYWwoKSB7CiAgICAgICAgICB2YXIgU3VwZXIgPSAoMCwgX2dldFByb3RvdHlwZU9mMi5kZWZhdWx0KShEZXJpdmVkKSwgcmVzdWx0OwogICAgICAgICAgaWYgKGhhc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QpIHsKICAgICAgICAgICAgdmFyIE5ld1RhcmdldCA9ICgwLCBfZ2V0UHJvdG90eXBlT2YyLmRlZmF1bHQpKHRoaXMpLmNvbnN0cnVjdG9yOwogICAgICAgICAgICByZXN1bHQgPSAoMCwgX2NvbnN0cnVjdC5kZWZhdWx0KShTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVzdWx0ID0gU3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiAoMCwgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4yLmRlZmF1bHQpKHRoaXMsIHJlc3VsdCk7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkgewogICAgICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gInVuZGVmaW5lZCIgfHwgIV9jb25zdHJ1Y3QuZGVmYXVsdCkKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoX2NvbnN0cnVjdC5kZWZhdWx0LnNoYW0pCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKHR5cGVvZiBQcm94eSA9PT0gImZ1bmN0aW9uIikKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHRyeSB7CiAgICAgICAgICBEYXRlLnByb3RvdHlwZS50b1N0cmluZy5jYWxsKCgwLCBfY29uc3RydWN0LmRlZmF1bHQpKERhdGUsIFtdLCBmdW5jdGlvbigpIHsKICAgICAgICAgIH0pKTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdmFyIENTSTFfTUFHSUMgPSAyMTU4MjY1OTsKICAgICAgdmFyIENTSTJfTUFHSUMgPSAzODM1OTg3NTsKICAgICAgZnVuY3Rpb24gbHNoaWZ0KG51bSwgYml0cykgewogICAgICAgIHJldHVybiBudW0gKiBNYXRoLnBvdygyLCBiaXRzKTsKICAgICAgfQogICAgICBmdW5jdGlvbiByc2hpZnQobnVtLCBiaXRzKSB7CiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IobnVtIC8gTWF0aC5wb3coMiwgYml0cykpOwogICAgICB9CiAgICAgIHZhciBDU0kgPSAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24oX0luZGV4RmlsZSkgewogICAgICAgICgwLCBfaW5oZXJpdHMyLmRlZmF1bHQpKENTSTIsIF9JbmRleEZpbGUpOwogICAgICAgIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoQ1NJMik7CiAgICAgICAgZnVuY3Rpb24gQ1NJMihhcmdzKSB7CiAgICAgICAgICB2YXIgX3RoaXM7CiAgICAgICAgICAoMCwgX2NsYXNzQ2FsbENoZWNrMi5kZWZhdWx0KSh0aGlzLCBDU0kyKTsKICAgICAgICAgIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgYXJncyk7CiAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5Mi5kZWZhdWx0KSgoMCwgX2Fzc2VydFRoaXNJbml0aWFsaXplZDIuZGVmYXVsdCkoX3RoaXMpLCAibWF4QmluTnVtYmVyIiwgdm9pZCAwKTsKICAgICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyLmRlZmF1bHQpKCgwLCBfYXNzZXJ0VGhpc0luaXRpYWxpemVkMi5kZWZhdWx0KShfdGhpcyksICJkZXB0aCIsIHZvaWQgMCk7CiAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5Mi5kZWZhdWx0KSgoMCwgX2Fzc2VydFRoaXNJbml0aWFsaXplZDIuZGVmYXVsdCkoX3RoaXMpLCAibWluU2hpZnQiLCB2b2lkIDApOwogICAgICAgICAgX3RoaXMubWF4QmluTnVtYmVyID0gMDsKICAgICAgICAgIF90aGlzLmRlcHRoID0gMDsKICAgICAgICAgIF90aGlzLm1pblNoaWZ0ID0gMDsKICAgICAgICAgIHJldHVybiBfdGhpczsKICAgICAgICB9CiAgICAgICAgKDAsIF9jcmVhdGVDbGFzczIuZGVmYXVsdCkoQ1NJMiwgW3sKICAgICAgICAgIGtleTogImxpbmVDb3VudCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBfbGluZUNvdW50ID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlKHJlZklkKSB7CiAgICAgICAgICAgICAgdmFyIGluZGV4RGF0YSwgaWR4LCBzdGF0czsKICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2UoKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICBpbmRleERhdGEgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4RGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCAtMSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgICAgaWR4ID0gaW5kZXhEYXRhLmluZGljZXNbcmVmSWRdOwogICAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCkgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gODsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCAtMSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgICAgICAgc3RhdHMgPSBpbmRleERhdGEuaW5kaWNlc1tyZWZJZF0uc3RhdHM7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0YXRzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBzdGF0cy5saW5lQ291bnQpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCAtMSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIGZ1bmN0aW9uIGxpbmVDb3VudChfeCkgewogICAgICAgICAgICAgIHJldHVybiBfbGluZUNvdW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGxpbmVDb3VudDsKICAgICAgICAgIH0oKQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImluZGV4Q292IiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIF9pbmRleENvdiA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvci5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvci5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIFtdKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgX2NhbGxlZTIpOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIGZ1bmN0aW9uIGluZGV4Q292KCkgewogICAgICAgICAgICAgIHJldHVybiBfaW5kZXhDb3YuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gaW5kZXhDb3Y7CiAgICAgICAgICB9KCkKICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJwYXJzZUF1eERhdGEiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHBhcnNlQXV4RGF0YShieXRlcywgb2Zmc2V0LCBhdXhMZW5ndGgpIHsKICAgICAgICAgICAgaWYgKGF1eExlbmd0aCA8IDMwKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHt9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBkYXRhID0ge307CiAgICAgICAgICAgIGRhdGEuZm9ybWF0RmxhZ3MgPSBieXRlcy5yZWFkSW50MzJMRShvZmZzZXQpOwogICAgICAgICAgICBkYXRhLmNvb3JkaW5hdGVUeXBlID0gZGF0YS5mb3JtYXRGbGFncyAmIDY1NTM2ID8gInplcm8tYmFzZWQtaGFsZi1vcGVuIiA6ICIxLWJhc2VkLWNsb3NlZCI7CiAgICAgICAgICAgIGRhdGEuZm9ybWF0ID0gewogICAgICAgICAgICAgIDA6ICJnZW5lcmljIiwKICAgICAgICAgICAgICAxOiAiU0FNIiwKICAgICAgICAgICAgICAyOiAiVkNGIgogICAgICAgICAgICB9W2RhdGEuZm9ybWF0RmxhZ3MgJiAxNV07CiAgICAgICAgICAgIGlmICghZGF0YS5mb3JtYXQpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgVGFiaXggcHJlc2V0IGZvcm1hdCBmbGFncyAiLmNvbmNhdChkYXRhLmZvcm1hdEZsYWdzKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGF0YS5jb2x1bW5OdW1iZXJzID0gewogICAgICAgICAgICAgIHJlZjogYnl0ZXMucmVhZEludDMyTEUob2Zmc2V0ICsgNCksCiAgICAgICAgICAgICAgc3RhcnQ6IGJ5dGVzLnJlYWRJbnQzMkxFKG9mZnNldCArIDgpLAogICAgICAgICAgICAgIGVuZDogYnl0ZXMucmVhZEludDMyTEUob2Zmc2V0ICsgMTIpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGRhdGEubWV0YVZhbHVlID0gYnl0ZXMucmVhZEludDMyTEUob2Zmc2V0ICsgMTYpOwogICAgICAgICAgICBkYXRhLm1ldGFDaGFyID0gZGF0YS5tZXRhVmFsdWUgPyBTdHJpbmcuZnJvbUNoYXJDb2RlKGRhdGEubWV0YVZhbHVlKSA6ICIiOwogICAgICAgICAgICBkYXRhLnNraXBMaW5lcyA9IGJ5dGVzLnJlYWRJbnQzMkxFKG9mZnNldCArIDIwKTsKICAgICAgICAgICAgdmFyIG5hbWVTZWN0aW9uTGVuZ3RoID0gYnl0ZXMucmVhZEludDMyTEUob2Zmc2V0ICsgMjQpOwogICAgICAgICAgICAoMCwgX2Fzc2lnbi5kZWZhdWx0KShkYXRhLCB0aGlzLl9wYXJzZU5hbWVCeXRlcygoMCwgX3NsaWNlLmRlZmF1bHQpKGJ5dGVzKS5jYWxsKGJ5dGVzLCBvZmZzZXQgKyAyOCwgb2Zmc2V0ICsgMjggKyBuYW1lU2VjdGlvbkxlbmd0aCkpKTsKICAgICAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiX3BhcnNlTmFtZUJ5dGVzIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfcGFyc2VOYW1lQnl0ZXMobmFtZXNCeXRlcykgewogICAgICAgICAgICB2YXIgY3VyclJlZklkID0gMDsKICAgICAgICAgICAgdmFyIGN1cnJOYW1lU3RhcnQgPSAwOwogICAgICAgICAgICB2YXIgcmVmSWRUb05hbWUgPSBbXTsKICAgICAgICAgICAgdmFyIHJlZk5hbWVUb0lkID0ge307CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbmFtZXNCeXRlcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgICAgIGlmICghbmFtZXNCeXRlc1tpXSkgewogICAgICAgICAgICAgICAgaWYgKGN1cnJOYW1lU3RhcnQgPCBpKSB7CiAgICAgICAgICAgICAgICAgIHZhciByZWZOYW1lID0gbmFtZXNCeXRlcy50b1N0cmluZygidXRmOCIsIGN1cnJOYW1lU3RhcnQsIGkpOwogICAgICAgICAgICAgICAgICByZWZOYW1lID0gdGhpcy5yZW5hbWVSZWZTZXEocmVmTmFtZSk7CiAgICAgICAgICAgICAgICAgIHJlZklkVG9OYW1lW2N1cnJSZWZJZF0gPSByZWZOYW1lOwogICAgICAgICAgICAgICAgICByZWZOYW1lVG9JZFtyZWZOYW1lXSA9IGN1cnJSZWZJZDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGN1cnJOYW1lU3RhcnQgPSBpICsgMTsKICAgICAgICAgICAgICAgIGN1cnJSZWZJZCArPSAxOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHJlZk5hbWVUb0lkLAogICAgICAgICAgICAgIHJlZklkVG9OYW1lCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiX3BhcnNlIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIF9wYXJzZTIgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKG9wdHMpIHsKICAgICAgICAgICAgICB2YXIgZGF0YSwgYnVmZmVyLCBieXRlcywgYXV4TGVuZ3RoLCBjdXJyT2Zmc2V0LCBpLCBiaW5Db3VudCwgYmluSW5kZXgsIHN0YXRzLCBqLCBiaW4sIGxvZmZzZXQsIGNodW5rQ291bnQsIGNodW5rcywgaywgdSwgdjsKICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICBjc2k6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIG1heEJsb2NrU2l6ZTogMSA8PCAxNgogICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGVoYW5kbGUucmVhZEZpbGUob3B0cyk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgYnVmZmVyID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKDAsIF9iZ3pmRmlsZWhhbmRsZS51bnppcCkoYnVmZmVyKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgICAgICBieXRlcyA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICAgICAgICAgICAgaWYgKCEoYnl0ZXMucmVhZFVJbnQzMkxFKDApID09PSBDU0kxX01BR0lDKSkgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGRhdGEuY3NpVmVyc2lvbiA9IDE7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDE2OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgIGlmICghKGJ5dGVzLnJlYWRVSW50MzJMRSgwKSA9PT0gQ1NJMl9NQUdJQykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxNTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBkYXRhLmNzaVZlcnNpb24gPSAyOwogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxNjsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vdCBhIENTSSBmaWxlIik7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWluU2hpZnQgPSBieXRlcy5yZWFkSW50MzJMRSg0KTsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGVwdGggPSBieXRlcy5yZWFkSW50MzJMRSg4KTsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWF4QmluTnVtYmVyID0gKCgxIDw8ICh0aGlzLmRlcHRoICsgMSkgKiAzKSAtIDEpIC8gNzsKICAgICAgICAgICAgICAgICAgICAgIGF1eExlbmd0aCA9IGJ5dGVzLnJlYWRJbnQzMkxFKDEyKTsKICAgICAgICAgICAgICAgICAgICAgIGlmIChhdXhMZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgKDAsIF9hc3NpZ24uZGVmYXVsdCkoZGF0YSwgdGhpcy5wYXJzZUF1eERhdGEoYnl0ZXMsIDE2LCBhdXhMZW5ndGgpKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGRhdGEucmVmQ291bnQgPSBieXRlcy5yZWFkSW50MzJMRSgxNiArIGF1eExlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgICBkYXRhLmluZGljZXMgPSBuZXcgQXJyYXkoZGF0YS5yZWZDb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICBjdXJyT2Zmc2V0ID0gMTYgKyBhdXhMZW5ndGggKyA0OwogICAgICAgICAgICAgICAgICAgICAgaSA9IDA7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyNToKICAgICAgICAgICAgICAgICAgICAgIGlmICghKGkgPCBkYXRhLnJlZkNvdW50KSkgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDM3OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjg7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLmFib3J0QnJlYWtQb2ludCkob3B0cy5zaWduYWwpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjg6CiAgICAgICAgICAgICAgICAgICAgICBiaW5Db3VudCA9IGJ5dGVzLnJlYWRJbnQzMkxFKGN1cnJPZmZzZXQpOwogICAgICAgICAgICAgICAgICAgICAgY3Vyck9mZnNldCArPSA0OwogICAgICAgICAgICAgICAgICAgICAgYmluSW5kZXggPSB7fTsKICAgICAgICAgICAgICAgICAgICAgIHN0YXRzID0gdm9pZCAwOwogICAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IGJpbkNvdW50OyBqICs9IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYmluID0gYnl0ZXMucmVhZFVJbnQzMkxFKGN1cnJPZmZzZXQpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmluID4gdGhpcy5tYXhCaW5OdW1iZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0cyA9IHRoaXMucGFyc2VQc2V1ZG9CaW4oYnl0ZXMsIGN1cnJPZmZzZXQgKyA0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyT2Zmc2V0ICs9IDQgKyA4ICsgNCArIDE2ICsgMTY7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbG9mZnNldCA9ICgwLCBfdmlydHVhbE9mZnNldC5mcm9tQnl0ZXMpKGJ5dGVzLCBjdXJyT2Zmc2V0ICsgNCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZmluZEZpcnN0RGF0YShkYXRhLCBsb2Zmc2V0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua0NvdW50ID0gYnl0ZXMucmVhZEludDMyTEUoY3Vyck9mZnNldCArIDEyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyT2Zmc2V0ICs9IDE2OwogICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rcyA9IG5ldyBBcnJheShjaHVua0NvdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgY2h1bmtDb3VudDsgayArPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1ID0gKDAsIF92aXJ0dWFsT2Zmc2V0LmZyb21CeXRlcykoYnl0ZXMsIGN1cnJPZmZzZXQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdiA9ICgwLCBfdmlydHVhbE9mZnNldC5mcm9tQnl0ZXMpKGJ5dGVzLCBjdXJyT2Zmc2V0ICsgOCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyT2Zmc2V0ICs9IDE2OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtzW2tdID0gbmV3IF9jaHVuay5kZWZhdWx0KHUsIHYsIGJpbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIGJpbkluZGV4W2Jpbl0gPSBjaHVua3M7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGRhdGEuaW5kaWNlc1tpXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgYmluSW5kZXgsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRzCiAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzQ6CiAgICAgICAgICAgICAgICAgICAgICBpICs9IDE7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDI1OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzNzoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCBkYXRhKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM4OgogICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIF9jYWxsZWUzLCB0aGlzKTsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICBmdW5jdGlvbiBfcGFyc2UoX3gyKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF9wYXJzZTIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gX3BhcnNlOwogICAgICAgICAgfSgpCiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAicGFyc2VQc2V1ZG9CaW4iLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHBhcnNlUHNldWRvQmluKGJ5dGVzLCBvZmZzZXQpIHsKICAgICAgICAgICAgdmFyIGxpbmVDb3VudCA9ICgwLCBfdXRpbC5sb25nVG9OdW1iZXIpKF9sb25nLmRlZmF1bHQuZnJvbUJ5dGVzTEUoKDAsIF9zbGljZS5kZWZhdWx0KShBcnJheS5wcm90b3R5cGUpLmNhbGwoYnl0ZXMsIG9mZnNldCArIDI4LCBvZmZzZXQgKyAzNiksIHRydWUpKTsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBsaW5lQ291bnQKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJibG9ja3NGb3JSYW5nZSIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBfYmxvY2tzRm9yUmFuZ2UgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KHJlZklkLCBtaW4sIG1heCkgewogICAgICAgICAgICAgIHZhciBvcHRzLCBpbmRleERhdGEsIGJhLCBvdmVybGFwcGluZ0JpbnMsIGNodW5rcywgX2l0ZXJhdG9yLCBfc3RlcCwgX3N0ZXAkdmFsdWUsIHN0YXJ0LCBlbmQsIGJpbiwgYmluQ2h1bmtzLCBjLCBfYXJnczQgPSBhcmd1bWVudHM7CiAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvci5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgb3B0cyA9IF9hcmdzNC5sZW5ndGggPiAzICYmIF9hcmdzNFszXSAhPT0gdm9pZCAwID8gX2FyZ3M0WzNdIDoge307CiAgICAgICAgICAgICAgICAgICAgICBpZiAobWluIDwgMCkgewogICAgICAgICAgICAgICAgICAgICAgICBtaW4gPSAwOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2Uob3B0cyk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgICAgaW5kZXhEYXRhID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXhEYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgW10pOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgICAgIGJhID0gaW5kZXhEYXRhLmluZGljZXNbcmVmSWRdOwogICAgICAgICAgICAgICAgICAgICAgaWYgKGJhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIFtdKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgICAgICAgb3ZlcmxhcHBpbmdCaW5zID0gdGhpcy5yZWcyYmlucyhtaW4sIG1heCk7CiAgICAgICAgICAgICAgICAgICAgICBjaHVua3MgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKG92ZXJsYXBwaW5nQmlucyk7CiAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKF9pdGVyYXRvci5zKCk7ICEoX3N0ZXAgPSBfaXRlcmF0b3IubigpKS5kb25lOyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBfc3RlcCR2YWx1ZSA9ICgwLCBfc2xpY2VkVG9BcnJheTIuZGVmYXVsdCkoX3N0ZXAudmFsdWUsIDIpLCBzdGFydCA9IF9zdGVwJHZhbHVlWzBdLCBlbmQgPSBfc3RlcCR2YWx1ZVsxXTsKICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGJpbiA9IHN0YXJ0OyBiaW4gPD0gZW5kOyBiaW4rKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJhLmJpbkluZGV4W2Jpbl0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmluQ2h1bmtzID0gYmEuYmluSW5kZXhbYmluXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjID0gMDsgYyA8IGJpbkNodW5rcy5sZW5ndGg7ICsrYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rcy5wdXNoKG5ldyBfY2h1bmsuZGVmYXVsdChiaW5DaHVua3NbY10ubWludiwgYmluQ2h1bmtzW2NdLm1heHYsIGJpbikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yLmUoZXJyKTsKICAgICAgICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9pdGVyYXRvci5mKCk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgKDAsIF91dGlsLm9wdGltaXplQ2h1bmtzKShjaHVua3MsIG5ldyBfdmlydHVhbE9mZnNldC5kZWZhdWx0KDAsIDApKSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCBfY2FsbGVlNCwgdGhpcyk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgZnVuY3Rpb24gYmxvY2tzRm9yUmFuZ2UoX3gzLCBfeDQsIF94NSkgewogICAgICAgICAgICAgIHJldHVybiBfYmxvY2tzRm9yUmFuZ2UuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gYmxvY2tzRm9yUmFuZ2U7CiAgICAgICAgICB9KCkKICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJyZWcyYmlucyIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcmVnMmJpbnMoYmVnLCBlbmQpIHsKICAgICAgICAgICAgYmVnIC09IDE7CiAgICAgICAgICAgIGlmIChiZWcgPCAxKSB7CiAgICAgICAgICAgICAgYmVnID0gMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZW5kID4gTWF0aC5wb3coMiwgNTApKSB7CiAgICAgICAgICAgICAgZW5kID0gTWF0aC5wb3coMiwgMzQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVuZCAtPSAxOwogICAgICAgICAgICB2YXIgbCA9IDA7CiAgICAgICAgICAgIHZhciB0ID0gMDsKICAgICAgICAgICAgdmFyIHMgPSB0aGlzLm1pblNoaWZ0ICsgdGhpcy5kZXB0aCAqIDM7CiAgICAgICAgICAgIHZhciBiaW5zID0gW107CiAgICAgICAgICAgIGZvciAoOyBsIDw9IHRoaXMuZGVwdGg7IHMgLT0gMywgdCArPSBsc2hpZnQoMSwgbCAqIDMpLCBsICs9IDEpIHsKICAgICAgICAgICAgICB2YXIgYiA9IHQgKyByc2hpZnQoYmVnLCBzKTsKICAgICAgICAgICAgICB2YXIgZSA9IHQgKyByc2hpZnQoZW5kLCBzKTsKICAgICAgICAgICAgICBpZiAoZSAtIGIgKyBiaW5zLmxlbmd0aCA+IHRoaXMubWF4QmluTnVtYmVyKSB7CiAgICAgICAgICAgICAgICB2YXIgX2NvbnRleHQ1LCBfY29udGV4dDYsIF9jb250ZXh0NzsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigoMCwgX2NvbmNhdC5kZWZhdWx0KShfY29udGV4dDUgPSAoMCwgX2NvbmNhdC5kZWZhdWx0KShfY29udGV4dDYgPSAoMCwgX2NvbmNhdC5kZWZhdWx0KShfY29udGV4dDcgPSAicXVlcnkgIi5jb25jYXQoYmVnLCAiLSIpKS5jYWxsKF9jb250ZXh0NywgZW5kLCAiIGlzIHRvbyBsYXJnZSBmb3IgY3VycmVudCBiaW5uaW5nIHNjaGVtZSAoc2hpZnQgIikpLmNhbGwoX2NvbnRleHQ2LCB0aGlzLm1pblNoaWZ0LCAiLCBkZXB0aCAiKSkuY2FsbChfY29udGV4dDUsIHRoaXMuZGVwdGgsICIpLCB0cnkgYSBzbWFsbGVyIHF1ZXJ5IG9yIGEgY29hcnNlciBpbmRleCBiaW5uaW5nIHNjaGVtZSIpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYmlucy5wdXNoKFtiLCBlXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGJpbnM7CiAgICAgICAgICB9CiAgICAgICAgfV0pOwogICAgICAgIHJldHVybiBDU0kyOwogICAgICB9KF9pbmRleEZpbGUuZGVmYXVsdCk7CiAgICAgIGV4cG9ydHMuZGVmYXVsdCA9IENTSTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLmRhdGUubm93LmpzCiAgdmFyIHJlcXVpcmVfZXNfZGF0ZV9ub3cgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMuZGF0ZS5ub3cuanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciAkID0gcmVxdWlyZV9leHBvcnQoKTsKICAgICAgJCh7IHRhcmdldDogIkRhdGUiLCBzdGF0OiB0cnVlIH0sIHsKICAgICAgICBub3c6IGZ1bmN0aW9uIG5vdygpIHsKICAgICAgICAgIHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL2RhdGUvbm93LmpzCiAgdmFyIHJlcXVpcmVfbm93ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9kYXRlL25vdy5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgcmVxdWlyZV9lc19kYXRlX25vdygpOwogICAgICB2YXIgcGF0aCA9IHJlcXVpcmVfcGF0aCgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhdGguRGF0ZS5ub3c7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL2RhdGUvbm93LmpzCiAgdmFyIHJlcXVpcmVfbm93MiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL2RhdGUvbm93LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgcGFyZW50ID0gcmVxdWlyZV9ub3coKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXJlbnQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMtc3RhYmxlL2RhdGUvbm93LmpzCiAgdmFyIHJlcXVpcmVfbm93MyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMtc3RhYmxlL2RhdGUvbm93LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmVfbm93MigpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9hcnJheS1yZWR1Y2UuanMKICB2YXIgcmVxdWlyZV9hcnJheV9yZWR1Y2UgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9hcnJheS1yZWR1Y2UuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBhQ2FsbGFibGUgPSByZXF1aXJlX2FfY2FsbGFibGUoKTsKICAgICAgdmFyIHRvT2JqZWN0ID0gcmVxdWlyZV90b19vYmplY3QoKTsKICAgICAgdmFyIEluZGV4ZWRPYmplY3QgPSByZXF1aXJlX2luZGV4ZWRfb2JqZWN0KCk7CiAgICAgIHZhciB0b0xlbmd0aCA9IHJlcXVpcmVfdG9fbGVuZ3RoKCk7CiAgICAgIHZhciBjcmVhdGVNZXRob2QgPSBmdW5jdGlvbihJU19SSUdIVCkgewogICAgICAgIHJldHVybiBmdW5jdGlvbih0aGF0LCBjYWxsYmFja2ZuLCBhcmd1bWVudHNMZW5ndGgsIG1lbW8pIHsKICAgICAgICAgIGFDYWxsYWJsZShjYWxsYmFja2ZuKTsKICAgICAgICAgIHZhciBPID0gdG9PYmplY3QodGhhdCk7CiAgICAgICAgICB2YXIgc2VsZjIgPSBJbmRleGVkT2JqZWN0KE8pOwogICAgICAgICAgdmFyIGxlbmd0aCA9IHRvTGVuZ3RoKE8ubGVuZ3RoKTsKICAgICAgICAgIHZhciBpbmRleCA9IElTX1JJR0hUID8gbGVuZ3RoIC0gMSA6IDA7CiAgICAgICAgICB2YXIgaSA9IElTX1JJR0hUID8gLTEgOiAxOwogICAgICAgICAgaWYgKGFyZ3VtZW50c0xlbmd0aCA8IDIpCiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAgaWYgKGluZGV4IGluIHNlbGYyKSB7CiAgICAgICAgICAgICAgICBtZW1vID0gc2VsZjJbaW5kZXhdOwogICAgICAgICAgICAgICAgaW5kZXggKz0gaTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpbmRleCArPSBpOwogICAgICAgICAgICAgIGlmIChJU19SSUdIVCA/IGluZGV4IDwgMCA6IGxlbmd0aCA8PSBpbmRleCkgewogICAgICAgICAgICAgICAgdGhyb3cgVHlwZUVycm9yKCJSZWR1Y2Ugb2YgZW1wdHkgYXJyYXkgd2l0aCBubyBpbml0aWFsIHZhbHVlIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICBmb3IgKDsgSVNfUklHSFQgPyBpbmRleCA+PSAwIDogbGVuZ3RoID4gaW5kZXg7IGluZGV4ICs9IGkpCiAgICAgICAgICAgIGlmIChpbmRleCBpbiBzZWxmMikgewogICAgICAgICAgICAgIG1lbW8gPSBjYWxsYmFja2ZuKG1lbW8sIHNlbGYyW2luZGV4XSwgaW5kZXgsIE8pOwogICAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbWVtbzsKICAgICAgICB9OwogICAgICB9OwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgICBsZWZ0OiBjcmVhdGVNZXRob2QoZmFsc2UpLAogICAgICAgIHJpZ2h0OiBjcmVhdGVNZXRob2QodHJ1ZSkKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLmFycmF5LnJlZHVjZS5qcwogIHZhciByZXF1aXJlX2VzX2FycmF5X3JlZHVjZSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5hcnJheS5yZWR1Y2UuanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyICQgPSByZXF1aXJlX2V4cG9ydCgpOwogICAgICB2YXIgJHJlZHVjZSA9IHJlcXVpcmVfYXJyYXlfcmVkdWNlKCkubGVmdDsKICAgICAgdmFyIGFycmF5TWV0aG9kSXNTdHJpY3QgPSByZXF1aXJlX2FycmF5X21ldGhvZF9pc19zdHJpY3QoKTsKICAgICAgdmFyIENIUk9NRV9WRVJTSU9OID0gcmVxdWlyZV9lbmdpbmVfdjhfdmVyc2lvbigpOwogICAgICB2YXIgSVNfTk9ERSA9IHJlcXVpcmVfZW5naW5lX2lzX25vZGUoKTsKICAgICAgdmFyIFNUUklDVF9NRVRIT0QgPSBhcnJheU1ldGhvZElzU3RyaWN0KCJyZWR1Y2UiKTsKICAgICAgdmFyIENIUk9NRV9CVUcgPSAhSVNfTk9ERSAmJiBDSFJPTUVfVkVSU0lPTiA+IDc5ICYmIENIUk9NRV9WRVJTSU9OIDwgODM7CiAgICAgICQoeyB0YXJnZXQ6ICJBcnJheSIsIHByb3RvOiB0cnVlLCBmb3JjZWQ6ICFTVFJJQ1RfTUVUSE9EIHx8IENIUk9NRV9CVUcgfSwgewogICAgICAgIHJlZHVjZTogZnVuY3Rpb24gcmVkdWNlKGNhbGxiYWNrZm4pIHsKICAgICAgICAgIHJldHVybiAkcmVkdWNlKHRoaXMsIGNhbGxiYWNrZm4sIGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdm9pZCAwKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL2FycmF5L3ZpcnR1YWwvcmVkdWNlLmpzCiAgdmFyIHJlcXVpcmVfcmVkdWNlID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9hcnJheS92aXJ0dWFsL3JlZHVjZS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgcmVxdWlyZV9lc19hcnJheV9yZWR1Y2UoKTsKICAgICAgdmFyIGVudHJ5VmlydHVhbCA9IHJlcXVpcmVfZW50cnlfdmlydHVhbCgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGVudHJ5VmlydHVhbCgiQXJyYXkiKS5yZWR1Y2U7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvaW5zdGFuY2UvcmVkdWNlLmpzCiAgdmFyIHJlcXVpcmVfcmVkdWNlMiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvaW5zdGFuY2UvcmVkdWNlLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgcmVkdWNlID0gcmVxdWlyZV9yZWR1Y2UoKTsKICAgICAgdmFyIEFycmF5UHJvdG90eXBlID0gQXJyYXkucHJvdG90eXBlOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KSB7CiAgICAgICAgdmFyIG93biA9IGl0LnJlZHVjZTsKICAgICAgICByZXR1cm4gaXQgPT09IEFycmF5UHJvdG90eXBlIHx8IGl0IGluc3RhbmNlb2YgQXJyYXkgJiYgb3duID09PSBBcnJheVByb3RvdHlwZS5yZWR1Y2UgPyByZWR1Y2UgOiBvd247CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL2luc3RhbmNlL3JlZHVjZS5qcwogIHZhciByZXF1aXJlX3JlZHVjZTMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9pbnN0YW5jZS9yZWR1Y2UuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX3JlZHVjZTIoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXJlbnQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMtc3RhYmxlL2luc3RhbmNlL3JlZHVjZS5qcwogIHZhciByZXF1aXJlX3JlZHVjZTQgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzLXN0YWJsZS9pbnN0YW5jZS9yZWR1Y2UuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZV9yZWR1Y2UzKCk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5mdW5jdGlvbi5iaW5kLmpzCiAgdmFyIHJlcXVpcmVfZXNfZnVuY3Rpb25fYmluZCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5mdW5jdGlvbi5iaW5kLmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgJCA9IHJlcXVpcmVfZXhwb3J0KCk7CiAgICAgIHZhciBiaW5kID0gcmVxdWlyZV9mdW5jdGlvbl9iaW5kKCk7CiAgICAgICQoeyB0YXJnZXQ6ICJGdW5jdGlvbiIsIHByb3RvOiB0cnVlIH0sIHsKICAgICAgICBiaW5kCiAgICAgIH0pOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL2Z1bmN0aW9uL3ZpcnR1YWwvYmluZC5qcwogIHZhciByZXF1aXJlX2JpbmQgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL2Z1bmN0aW9uL3ZpcnR1YWwvYmluZC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgcmVxdWlyZV9lc19mdW5jdGlvbl9iaW5kKCk7CiAgICAgIHZhciBlbnRyeVZpcnR1YWwgPSByZXF1aXJlX2VudHJ5X3ZpcnR1YWwoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBlbnRyeVZpcnR1YWwoIkZ1bmN0aW9uIikuYmluZDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9pbnN0YW5jZS9iaW5kLmpzCiAgdmFyIHJlcXVpcmVfYmluZDIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL2luc3RhbmNlL2JpbmQuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBiaW5kID0gcmVxdWlyZV9iaW5kKCk7CiAgICAgIHZhciBGdW5jdGlvblByb3RvdHlwZSA9IEZ1bmN0aW9uLnByb3RvdHlwZTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCkgewogICAgICAgIHZhciBvd24gPSBpdC5iaW5kOwogICAgICAgIHJldHVybiBpdCA9PT0gRnVuY3Rpb25Qcm90b3R5cGUgfHwgaXQgaW5zdGFuY2VvZiBGdW5jdGlvbiAmJiBvd24gPT09IEZ1bmN0aW9uUHJvdG90eXBlLmJpbmQgPyBiaW5kIDogb3duOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9pbnN0YW5jZS9iaW5kLmpzCiAgdmFyIHJlcXVpcmVfYmluZDMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9pbnN0YW5jZS9iaW5kLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgcGFyZW50ID0gcmVxdWlyZV9iaW5kMigpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhcmVudDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy1zdGFibGUvaW5zdGFuY2UvYmluZC5qcwogIHZhciByZXF1aXJlX2JpbmQ0ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy1zdGFibGUvaW5zdGFuY2UvYmluZC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlX2JpbmQzKCk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvc3ltYm9sL2FzeW5jLWl0ZXJhdG9yLmpzCiAgdmFyIHJlcXVpcmVfYXN5bmNfaXRlcmF0b3IgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL3N5bWJvbC9hc3luYy1pdGVyYXRvci5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgcmVxdWlyZV9lc19zeW1ib2xfYXN5bmNfaXRlcmF0b3IoKTsKICAgICAgdmFyIFdyYXBwZWRXZWxsS25vd25TeW1ib2xNb2R1bGUgPSByZXF1aXJlX3dlbGxfa25vd25fc3ltYm9sX3dyYXBwZWQoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBXcmFwcGVkV2VsbEtub3duU3ltYm9sTW9kdWxlLmYoImFzeW5jSXRlcmF0b3IiKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvc3ltYm9sL2FzeW5jLWl0ZXJhdG9yLmpzCiAgdmFyIHJlcXVpcmVfYXN5bmNfaXRlcmF0b3IyID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvc3ltYm9sL2FzeW5jLWl0ZXJhdG9yLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgcGFyZW50ID0gcmVxdWlyZV9hc3luY19pdGVyYXRvcigpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhcmVudDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9mZWF0dXJlcy9zeW1ib2wvYXN5bmMtaXRlcmF0b3IuanMKICB2YXIgcmVxdWlyZV9hc3luY19pdGVyYXRvcjMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ZlYXR1cmVzL3N5bWJvbC9hc3luYy1pdGVyYXRvci5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHBhcmVudCA9IHJlcXVpcmVfYXN5bmNfaXRlcmF0b3IyKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGFyZW50OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzL3N5bWJvbC9hc3luYy1pdGVyYXRvci5qcwogIHZhciByZXF1aXJlX2FzeW5jX2l0ZXJhdG9yNCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2NvcmUtanMvc3ltYm9sL2FzeW5jLWl0ZXJhdG9yLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmVfYXN5bmNfaXRlcmF0b3IzKCk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2hlbHBlcnMvQXdhaXRWYWx1ZS5qcwogIHZhciByZXF1aXJlX0F3YWl0VmFsdWUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9oZWxwZXJzL0F3YWl0VmFsdWUuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIGZ1bmN0aW9uIF9Bd2FpdFZhbHVlKHZhbHVlKSB7CiAgICAgICAgdGhpcy53cmFwcGVkID0gdmFsdWU7CiAgICAgIH0KICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfQXdhaXRWYWx1ZTsKICAgICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy9Bc3luY0dlbmVyYXRvci5qcwogIHZhciByZXF1aXJlX0FzeW5jR2VuZXJhdG9yID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy9Bc3luY0dlbmVyYXRvci5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIF9Qcm9taXNlID0gcmVxdWlyZV9wcm9taXNlNCgpOwogICAgICB2YXIgX1N5bWJvbCA9IHJlcXVpcmVfc3ltYm9sNSgpOwogICAgICB2YXIgX1N5bWJvbCRhc3luY0l0ZXJhdG9yID0gcmVxdWlyZV9hc3luY19pdGVyYXRvcjQoKTsKICAgICAgdmFyIEF3YWl0VmFsdWUgPSByZXF1aXJlX0F3YWl0VmFsdWUoKTsKICAgICAgZnVuY3Rpb24gQXN5bmNHZW5lcmF0b3IoZ2VuKSB7CiAgICAgICAgdmFyIGZyb250LCBiYWNrOwogICAgICAgIGZ1bmN0aW9uIHNlbmQoa2V5LCBhcmcpIHsKICAgICAgICAgIHJldHVybiBuZXcgX1Byb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gewogICAgICAgICAgICAgIGtleSwKICAgICAgICAgICAgICBhcmcsCiAgICAgICAgICAgICAgcmVzb2x2ZSwKICAgICAgICAgICAgICByZWplY3QsCiAgICAgICAgICAgICAgbmV4dDogbnVsbAogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAoYmFjaykgewogICAgICAgICAgICAgIGJhY2sgPSBiYWNrLm5leHQgPSByZXF1ZXN0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGZyb250ID0gYmFjayA9IHJlcXVlc3Q7CiAgICAgICAgICAgICAgcmVzdW1lKGtleSwgYXJnKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHJlc3VtZShrZXksIGFyZykgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGdlbltrZXldKGFyZyk7CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHJlc3VsdC52YWx1ZTsKICAgICAgICAgICAgdmFyIHdyYXBwZWRBd2FpdCA9IHZhbHVlIGluc3RhbmNlb2YgQXdhaXRWYWx1ZTsKICAgICAgICAgICAgX1Byb21pc2UucmVzb2x2ZSh3cmFwcGVkQXdhaXQgPyB2YWx1ZS53cmFwcGVkIDogdmFsdWUpLnRoZW4oZnVuY3Rpb24oYXJnMikgewogICAgICAgICAgICAgIGlmICh3cmFwcGVkQXdhaXQpIHsKICAgICAgICAgICAgICAgIHJlc3VtZShrZXkgPT09ICJyZXR1cm4iID8gInJldHVybiIgOiAibmV4dCIsIGFyZzIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBzZXR0bGUocmVzdWx0LmRvbmUgPyAicmV0dXJuIiA6ICJub3JtYWwiLCBhcmcyKTsKICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7CiAgICAgICAgICAgICAgcmVzdW1lKCJ0aHJvdyIsIGVycik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIHNldHRsZSgidGhyb3ciLCBlcnIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzZXR0bGUodHlwZSwgdmFsdWUpIHsKICAgICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICBjYXNlICJyZXR1cm4iOgogICAgICAgICAgICAgIGZyb250LnJlc29sdmUoewogICAgICAgICAgICAgICAgdmFsdWUsCiAgICAgICAgICAgICAgICBkb25lOiB0cnVlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgInRocm93IjoKICAgICAgICAgICAgICBmcm9udC5yZWplY3QodmFsdWUpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIGZyb250LnJlc29sdmUoewogICAgICAgICAgICAgICAgdmFsdWUsCiAgICAgICAgICAgICAgICBkb25lOiBmYWxzZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgZnJvbnQgPSBmcm9udC5uZXh0OwogICAgICAgICAgaWYgKGZyb250KSB7CiAgICAgICAgICAgIHJlc3VtZShmcm9udC5rZXksIGZyb250LmFyZyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBiYWNrID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy5faW52b2tlID0gc2VuZDsKICAgICAgICBpZiAodHlwZW9mIGdlblsicmV0dXJuIl0gIT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgIHRoaXNbInJldHVybiJdID0gdm9pZCAwOwogICAgICAgIH0KICAgICAgfQogICAgICBBc3luY0dlbmVyYXRvci5wcm90b3R5cGVbdHlwZW9mIF9TeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgX1N5bWJvbCRhc3luY0l0ZXJhdG9yIHx8ICJAQGFzeW5jSXRlcmF0b3IiXSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9OwogICAgICBBc3luY0dlbmVyYXRvci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uKGFyZykgewogICAgICAgIHJldHVybiB0aGlzLl9pbnZva2UoIm5leHQiLCBhcmcpOwogICAgICB9OwogICAgICBBc3luY0dlbmVyYXRvci5wcm90b3R5cGVbInRocm93Il0gPSBmdW5jdGlvbihhcmcpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW52b2tlKCJ0aHJvdyIsIGFyZyk7CiAgICAgIH07CiAgICAgIEFzeW5jR2VuZXJhdG9yLnByb3RvdHlwZVsicmV0dXJuIl0gPSBmdW5jdGlvbihhcmcpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW52b2tlKCJyZXR1cm4iLCBhcmcpOwogICAgICB9OwogICAgICBtb2R1bGUuZXhwb3J0cyA9IEFzeW5jR2VuZXJhdG9yOwogICAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9oZWxwZXJzL3dyYXBBc3luY0dlbmVyYXRvci5qcwogIHZhciByZXF1aXJlX3dyYXBBc3luY0dlbmVyYXRvciA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2hlbHBlcnMvd3JhcEFzeW5jR2VuZXJhdG9yLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgQXN5bmNHZW5lcmF0b3IgPSByZXF1aXJlX0FzeW5jR2VuZXJhdG9yKCk7CiAgICAgIGZ1bmN0aW9uIF93cmFwQXN5bmNHZW5lcmF0b3IoZm4pIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gbmV3IEFzeW5jR2VuZXJhdG9yKGZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOwogICAgICAgIH07CiAgICAgIH0KICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfd3JhcEFzeW5jR2VuZXJhdG9yOwogICAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9oZWxwZXJzL2F3YWl0QXN5bmNHZW5lcmF0b3IuanMKICB2YXIgcmVxdWlyZV9hd2FpdEFzeW5jR2VuZXJhdG9yID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy9hd2FpdEFzeW5jR2VuZXJhdG9yLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgQXdhaXRWYWx1ZSA9IHJlcXVpcmVfQXdhaXRWYWx1ZSgpOwogICAgICBmdW5jdGlvbiBfYXdhaXRBc3luY0dlbmVyYXRvcih2YWx1ZSkgewogICAgICAgIHJldHVybiBuZXcgQXdhaXRWYWx1ZSh2YWx1ZSk7CiAgICAgIH0KICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfYXdhaXRBc3luY0dlbmVyYXRvcjsKICAgICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy9hc3luY0dlbmVyYXRvckRlbGVnYXRlLmpzCiAgdmFyIHJlcXVpcmVfYXN5bmNHZW5lcmF0b3JEZWxlZ2F0ZSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2hlbHBlcnMvYXN5bmNHZW5lcmF0b3JEZWxlZ2F0ZS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIF9Qcm9taXNlID0gcmVxdWlyZV9wcm9taXNlNCgpOwogICAgICB2YXIgX1N5bWJvbCA9IHJlcXVpcmVfc3ltYm9sNSgpOwogICAgICB2YXIgX1N5bWJvbCRpdGVyYXRvciA9IHJlcXVpcmVfaXRlcmF0b3I0KCk7CiAgICAgIGZ1bmN0aW9uIF9hc3luY0dlbmVyYXRvckRlbGVnYXRlKGlubmVyLCBhd2FpdFdyYXApIHsKICAgICAgICB2YXIgaXRlciA9IHt9LCB3YWl0aW5nID0gZmFsc2U7CiAgICAgICAgZnVuY3Rpb24gcHVtcChrZXksIHZhbHVlKSB7CiAgICAgICAgICB3YWl0aW5nID0gdHJ1ZTsKICAgICAgICAgIHZhbHVlID0gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHsKICAgICAgICAgICAgcmVzb2x2ZShpbm5lcltrZXldKHZhbHVlKSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGRvbmU6IGZhbHNlLAogICAgICAgICAgICB2YWx1ZTogYXdhaXRXcmFwKHZhbHVlKQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgOwogICAgICAgIGl0ZXJbdHlwZW9mIF9TeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIF9TeW1ib2wkaXRlcmF0b3IgfHwgIkBAaXRlcmF0b3IiXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfTsKICAgICAgICBpdGVyLm5leHQgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgaWYgKHdhaXRpbmcpIHsKICAgICAgICAgICAgd2FpdGluZyA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcHVtcCgibmV4dCIsIHZhbHVlKTsKICAgICAgICB9OwogICAgICAgIGlmICh0eXBlb2YgaW5uZXJbInRocm93Il0gPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgIGl0ZXJbInRocm93Il0gPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICBpZiAod2FpdGluZykgewogICAgICAgICAgICAgIHdhaXRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICB0aHJvdyB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcHVtcCgidGhyb3ciLCB2YWx1ZSk7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBpZiAodHlwZW9mIGlubmVyWyJyZXR1cm4iXSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgaXRlclsicmV0dXJuIl0gPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICBpZiAod2FpdGluZykgewogICAgICAgICAgICAgIHdhaXRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHB1bXAoInJldHVybiIsIHZhbHVlKTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHJldHVybiBpdGVyOwogICAgICB9CiAgICAgIG1vZHVsZS5leHBvcnRzID0gX2FzeW5jR2VuZXJhdG9yRGVsZWdhdGU7CiAgICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2hlbHBlcnMvYXN5bmNJdGVyYXRvci5qcwogIHZhciByZXF1aXJlX2FzeW5jSXRlcmF0b3IgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9oZWxwZXJzL2FzeW5jSXRlcmF0b3IuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBfU3ltYm9sID0gcmVxdWlyZV9zeW1ib2w1KCk7CiAgICAgIHZhciBfU3ltYm9sJGFzeW5jSXRlcmF0b3IgPSByZXF1aXJlX2FzeW5jX2l0ZXJhdG9yNCgpOwogICAgICB2YXIgX1N5bWJvbCRpdGVyYXRvciA9IHJlcXVpcmVfaXRlcmF0b3I0KCk7CiAgICAgIHZhciBfZ2V0SXRlcmF0b3JNZXRob2QgPSByZXF1aXJlX2dldF9pdGVyYXRvcl9tZXRob2Q1KCk7CiAgICAgIGZ1bmN0aW9uIF9hc3luY0l0ZXJhdG9yKGl0ZXJhYmxlKSB7CiAgICAgICAgdmFyIG1ldGhvZDsKICAgICAgICBpZiAodHlwZW9mIF9TeW1ib2wgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICBpZiAoX1N5bWJvbCRhc3luY0l0ZXJhdG9yKQogICAgICAgICAgICBtZXRob2QgPSBpdGVyYWJsZVtfU3ltYm9sJGFzeW5jSXRlcmF0b3JdOwogICAgICAgICAgaWYgKG1ldGhvZCA9PSBudWxsICYmIF9TeW1ib2wkaXRlcmF0b3IpCiAgICAgICAgICAgIG1ldGhvZCA9IF9nZXRJdGVyYXRvck1ldGhvZChpdGVyYWJsZSk7CiAgICAgICAgfQogICAgICAgIGlmIChtZXRob2QgPT0gbnVsbCkKICAgICAgICAgIG1ldGhvZCA9IGl0ZXJhYmxlWyJAQGFzeW5jSXRlcmF0b3IiXTsKICAgICAgICBpZiAobWV0aG9kID09IG51bGwpCiAgICAgICAgICBtZXRob2QgPSBpdGVyYWJsZVsiQEBpdGVyYXRvciJdOwogICAgICAgIGlmIChtZXRob2QgPT0gbnVsbCkKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdCBpcyBub3QgYXN5bmMgaXRlcmFibGUiKTsKICAgICAgICByZXR1cm4gbWV0aG9kLmNhbGwoaXRlcmFibGUpOwogICAgICB9CiAgICAgIG1vZHVsZS5leHBvcnRzID0gX2FzeW5jSXRlcmF0b3I7CiAgICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9idWZmZXItY3JjMzIvaW5kZXguanMKICB2YXIgcmVxdWlyZV9idWZmZXJfY3JjMzIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvYnVmZmVyLWNyYzMyL2luZGV4LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgQnVmZmVyMyA9IHJlcXVpcmVfYnVmZmVyKCkuQnVmZmVyOwogICAgICB2YXIgQ1JDX1RBQkxFID0gWwogICAgICAgIDAsCiAgICAgICAgMTk5Njk1OTg5NCwKICAgICAgICAzOTkzOTE5Nzg4LAogICAgICAgIDI1Njc1MjQ3OTQsCiAgICAgICAgMTI0NjM0MTM3LAogICAgICAgIDE4ODYwNTc2MTUsCiAgICAgICAgMzkxNTYyMTY4NSwKICAgICAgICAyNjU3MzkyMDM1LAogICAgICAgIDI0OTI2ODI3NCwKICAgICAgICAyMDQ0NTA4MzI0LAogICAgICAgIDM3NzIxMTUyMzAsCiAgICAgICAgMjU0NzE3Nzg2NCwKICAgICAgICAxNjI5NDE5OTUsCiAgICAgICAgMjEyNTU2MTAyMSwKICAgICAgICAzODg3NjA3MDQ3LAogICAgICAgIDI0Mjg0NDQwNDksCiAgICAgICAgNDk4NTM2NTQ4LAogICAgICAgIDE3ODk5Mjc2NjYsCiAgICAgICAgNDA4OTAxNjY0OCwKICAgICAgICAyMjI3MDYxMjE0LAogICAgICAgIDQ1MDU0ODg2MSwKICAgICAgICAxODQzMjU4NjAzLAogICAgICAgIDQxMDc1ODA3NTMsCiAgICAgICAgMjIxMTY3NzYzOSwKICAgICAgICAzMjU4ODM5OTAsCiAgICAgICAgMTY4NDc3NzE1MiwKICAgICAgICA0MjUxMTIyMDQyLAogICAgICAgIDIzMjE5MjY2MzYsCiAgICAgICAgMzM1NjMzNDg3LAogICAgICAgIDE2NjEzNjU0NjUsCiAgICAgICAgNDE5NTMwMjc1NSwKICAgICAgICAyMzY2MTE1MzE3LAogICAgICAgIDk5NzA3MzA5NiwKICAgICAgICAxMjgxOTUzODg2LAogICAgICAgIDM1Nzk4NTUzMzIsCiAgICAgICAgMjcyNDY4ODI0MiwKICAgICAgICAxMDA2ODg4MTQ1LAogICAgICAgIDEyNTg2MDc2ODcsCiAgICAgICAgMzUyNDEwMTYyOSwKICAgICAgICAyNzY4OTQyNDQzLAogICAgICAgIDkwMTA5NzcyMiwKICAgICAgICAxMTE5MDAwNjg0LAogICAgICAgIDM2ODY1MTcyMDYsCiAgICAgICAgMjg5ODA2NTcyOCwKICAgICAgICA4NTMwNDQ0NTEsCiAgICAgICAgMTE3MjI2NjEwMSwKICAgICAgICAzNzA1MDE1NzU5LAogICAgICAgIDI4ODI2MTY2NjUsCiAgICAgICAgNjUxNzY3OTgwLAogICAgICAgIDEzNzM1MDM1NDYsCiAgICAgICAgMzM2OTU1NDMwNCwKICAgICAgICAzMjE4MTA0NTk4LAogICAgICAgIDU2NTUwNzI1MywKICAgICAgICAxNDU0NjIxNzMxLAogICAgICAgIDM0ODUxMTE3MDUsCiAgICAgICAgMzA5OTQzNjMwMywKICAgICAgICA2NzEyNjY5NzQsCiAgICAgICAgMTU5NDE5ODAyNCwKICAgICAgICAzMzIyNzMwOTMwLAogICAgICAgIDI5NzAzNDc4MTIsCiAgICAgICAgNzk1ODM1NTI3LAogICAgICAgIDE0ODMyMzAyMjUsCiAgICAgICAgMzI0NDM2NzI3NSwKICAgICAgICAzMDYwMTQ5NTY1LAogICAgICAgIDE5OTQxNDYxOTIsCiAgICAgICAgMzExNTg1MzQsCiAgICAgICAgMjU2MzkwNzc3MiwKICAgICAgICA0MDIzNzE3OTMwLAogICAgICAgIDE5MDc0NTk0NjUsCiAgICAgICAgMTEyNjM3MjE1LAogICAgICAgIDI2ODAxNTMyNTMsCiAgICAgICAgMzkwNDQyNzA1OSwKICAgICAgICAyMDEzNzc2MjkwLAogICAgICAgIDI1MTcyMjAzNiwKICAgICAgICAyNTE3MjE1Mzc0LAogICAgICAgIDM3NzU4MzAwNDAsCiAgICAgICAgMjEzNzY1Njc2MywKICAgICAgICAxNDEzNzY4MTMsCiAgICAgICAgMjQzOTI3NzcxOSwKICAgICAgICAzODY1MjcxMjk3LAogICAgICAgIDE4MDIxOTU0NDQsCiAgICAgICAgNDc2ODY0ODY2LAogICAgICAgIDIyMzgwMDEzNjgsCiAgICAgICAgNDA2NjUwODg3OCwKICAgICAgICAxODEyMzcwOTI1LAogICAgICAgIDQ1MzA5MjczMSwKICAgICAgICAyMTgxNjI1MDI1LAogICAgICAgIDQxMTE0NTEyMjMsCiAgICAgICAgMTcwNjA4ODkwMiwKICAgICAgICAzMTQwNDI3MDQsCiAgICAgICAgMjM0NDUzMjIwMiwKICAgICAgICA0MjQwMDE3NTMyLAogICAgICAgIDE2NTg2NTgyNzEsCiAgICAgICAgMzY2NjE5OTc3LAogICAgICAgIDIzNjI2NzAzMjMsCiAgICAgICAgNDIyNDk5NDQwNSwKICAgICAgICAxMzAzNTM1OTYwLAogICAgICAgIDk4NDk2MTQ4NiwKICAgICAgICAyNzQ3MDA3MDkyLAogICAgICAgIDM1NjkwMzc1MzgsCiAgICAgICAgMTI1NjE3MDgxNywKICAgICAgICAxMDM3NjA0MzExLAogICAgICAgIDI3NjUyMTA3MzMsCiAgICAgICAgMzU1NDA3OTk5NSwKICAgICAgICAxMTMxMDE0NTA2LAogICAgICAgIDg3OTY3OTk5NiwKICAgICAgICAyOTA5MjQzNDYyLAogICAgICAgIDM2NjM3NzE4NTYsCiAgICAgICAgMTE0MTEyNDQ2NywKICAgICAgICA4NTU4NDIyNzcsCiAgICAgICAgMjg1MjgwMTYzMSwKICAgICAgICAzNzA4NjQ4NjQ5LAogICAgICAgIDEzNDI1MzM5NDgsCiAgICAgICAgNjU0NDU5MzA2LAogICAgICAgIDMxODgzOTYwNDgsCiAgICAgICAgMzM3MzAxNTE3NCwKICAgICAgICAxNDY2NDc5OTA5LAogICAgICAgIDU0NDE3OTYzNSwKICAgICAgICAzMTEwNTIzOTEzLAogICAgICAgIDM0NjI1MjIwMTUsCiAgICAgICAgMTU5MTY3MTA1NCwKICAgICAgICA3MDIxMzg3NzYsCiAgICAgICAgMjk2NjQ2MDQ1MCwKICAgICAgICAzMzUyNzk5NDEyLAogICAgICAgIDE1MDQ5MTg4MDcsCiAgICAgICAgNzgzNTUxODczLAogICAgICAgIDMwODI2NDA0NDMsCiAgICAgICAgMzIzMzQ0Mjk4OSwKICAgICAgICAzOTg4MjkyMzg0LAogICAgICAgIDI1OTYyNTQ2NDYsCiAgICAgICAgNjIzMTcwNjgsCiAgICAgICAgMTk1NzgxMDg0MiwKICAgICAgICAzOTM5ODQ1OTQ1LAogICAgICAgIDI2NDc4MTYxMTEsCiAgICAgICAgODE0NzA5OTcsCiAgICAgICAgMTk0MzgwMzUyMywKICAgICAgICAzODE0OTE4OTMwLAogICAgICAgIDI0ODk1OTY4MDQsCiAgICAgICAgMjI1Mjc0NDMwLAogICAgICAgIDIwNTM3OTAzNzYsCiAgICAgICAgMzgyNjE3NTc1NSwKICAgICAgICAyNDY2OTA2MDEzLAogICAgICAgIDE2NzgxNjc0MywKICAgICAgICAyMDk3NjUxMzc3LAogICAgICAgIDQwMjc1NTI1ODAsCiAgICAgICAgMjI2NTQ5MDM4NiwKICAgICAgICA1MDM0NDQwNzIsCiAgICAgICAgMTc2MjA1MDgxNCwKICAgICAgICA0MTUwNDE3MjQ1LAogICAgICAgIDIxNTQxMjkzNTUsCiAgICAgICAgNDI2NTIyMjI1LAogICAgICAgIDE4NTI1MDc4NzksCiAgICAgICAgNDI3NTMxMzUyNiwKICAgICAgICAyMzEyMzE3OTIwLAogICAgICAgIDI4Mjc1MzYyNiwKICAgICAgICAxNzQyNTU1ODUyLAogICAgICAgIDQxODk3MDgxNDMsCiAgICAgICAgMjM5NDg3Nzk0NSwKICAgICAgICAzOTc5MTc3NjMsCiAgICAgICAgMTYyMjE4MzYzNywKICAgICAgICAzNjA0MzkwODg4LAogICAgICAgIDI3MTQ4NjY1NTgsCiAgICAgICAgOTUzNzI5NzMyLAogICAgICAgIDEzNDAwNzY2MjYsCiAgICAgICAgMzUxODcxOTk4NSwKICAgICAgICAyNzk3MzYwOTk5LAogICAgICAgIDEwNjg4MjgzODEsCiAgICAgICAgMTIxOTYzODg1OSwKICAgICAgICAzNjI0NzQxODUwLAogICAgICAgIDI5MzY2NzUxNDgsCiAgICAgICAgOTA2MTg1NDYyLAogICAgICAgIDEwOTA4MTI1MTIsCiAgICAgICAgMzc0NzY3MjAwMywKICAgICAgICAyODI1Mzc5NjY5LAogICAgICAgIDgyOTMyOTEzNSwKICAgICAgICAxMTgxMzM1MTYxLAogICAgICAgIDM0MTIxNzc4MDQsCiAgICAgICAgMzE2MDgzNDg0MiwKICAgICAgICA2MjgwODU0MDgsCiAgICAgICAgMTM4MjYwNTM2NiwKICAgICAgICAzNDIzMzY5MTA5LAogICAgICAgIDMxMzgwNzg0NjcsCiAgICAgICAgNTcwNTYyMjMzLAogICAgICAgIDE0MjY0MDA4MTUsCiAgICAgICAgMzMxNzMxNjU0MiwKICAgICAgICAyOTk4NzMzNjA4LAogICAgICAgIDczMzIzOTk1NCwKICAgICAgICAxNTU1MjYxOTU2LAogICAgICAgIDMyNjg5MzU1OTEsCiAgICAgICAgMzA1MDM2MDYyNSwKICAgICAgICA3NTI0NTk0MDMsCiAgICAgICAgMTU0MTMyMDIyMSwKICAgICAgICAyNjA3MDcxOTIwLAogICAgICAgIDM5NjU5NzMwMzAsCiAgICAgICAgMTk2OTkyMjk3MiwKICAgICAgICA0MDczNTQ5OCwKICAgICAgICAyNjE3ODM3MjI1LAogICAgICAgIDM5NDM1NzcxNTEsCiAgICAgICAgMTkxMzA4Nzg3NywKICAgICAgICA4MzkwODM3MSwKICAgICAgICAyNTEyMzQxNjM0LAogICAgICAgIDM4MDM3NDA2OTIsCiAgICAgICAgMjA3NTIwODYyMiwKICAgICAgICAyMTMyNjExMTIsCiAgICAgICAgMjQ2MzI3MjYwMywKICAgICAgICAzODU1OTkwMjg1LAogICAgICAgIDIwOTQ4NTQwNzEsCiAgICAgICAgMTk4OTU4ODgxLAogICAgICAgIDIyNjIwMjkwMTIsCiAgICAgICAgNDA1NzI2MDYxMCwKICAgICAgICAxNzU5MzU5OTkyLAogICAgICAgIDUzNDQxNDE5MCwKICAgICAgICAyMTc2NzE4NTQxLAogICAgICAgIDQxMzkzMjkxMTUsCiAgICAgICAgMTg3MzgzNjAwMSwKICAgICAgICA0MTQ2NjQ1NjcsCiAgICAgICAgMjI4MjI0ODkzNCwKICAgICAgICA0Mjc5MjAwMzY4LAogICAgICAgIDE3MTE2ODQ1NTQsCiAgICAgICAgMjg1MjgxMTE2LAogICAgICAgIDI0MDU4MDE3MjcsCiAgICAgICAgNDE2NzIxNjc0NSwKICAgICAgICAxNjM0NDY3Nzk1LAogICAgICAgIDM3NjIyOTcwMSwKICAgICAgICAyNjg1MDY3ODk2LAogICAgICAgIDM2MDgwMDc0MDYsCiAgICAgICAgMTMwODkxODYxMiwKICAgICAgICA5NTY1NDM5MzgsCiAgICAgICAgMjgwODU1NTEwNSwKICAgICAgICAzNDk1OTU4MjYzLAogICAgICAgIDEyMzE2MzYzMDEsCiAgICAgICAgMTA0NzQyNzAzNSwKICAgICAgICAyOTMyOTU5ODE4LAogICAgICAgIDM2NTQ3MDM4MzYsCiAgICAgICAgMTA4ODM1OTI3MCwKICAgICAgICA5MzY5MThlMywKICAgICAgICAyODQ3NzE0ODk5LAogICAgICAgIDM3MzY4Mzc4MjksCiAgICAgICAgMTIwMjkwMDg2MywKICAgICAgICA4MTcyMzM4OTcsCiAgICAgICAgMzE4MzM0MjEwOCwKICAgICAgICAzNDAxMjM3MTMwLAogICAgICAgIDE0MDQyNzc1NTIsCiAgICAgICAgNjE1ODE4MTUwLAogICAgICAgIDMxMzQyMDc0OTMsCiAgICAgICAgMzQ1MzQyMTIwMywKICAgICAgICAxNDIzODU3NDQ5LAogICAgICAgIDYwMTQ1MDQzMSwKICAgICAgICAzMDA5ODM3NjE0LAogICAgICAgIDMyOTQ3MTA0NTYsCiAgICAgICAgMTU2NzEwMzc0NiwKICAgICAgICA3MTE5Mjg3MjQsCiAgICAgICAgMzAyMDY2ODQ3MSwKICAgICAgICAzMjcyMzgwMDY1LAogICAgICAgIDE1MTAzMzQyMzUsCiAgICAgICAgNzU1MTY3MTE3CiAgICAgIF07CiAgICAgIGlmICh0eXBlb2YgSW50MzJBcnJheSAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICBDUkNfVEFCTEUgPSBuZXcgSW50MzJBcnJheShDUkNfVEFCTEUpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGVuc3VyZUJ1ZmZlcihpbnB1dCkgewogICAgICAgIGlmIChCdWZmZXIzLmlzQnVmZmVyKGlucHV0KSkgewogICAgICAgICAgcmV0dXJuIGlucHV0OwogICAgICAgIH0KICAgICAgICB2YXIgaGFzTmV3QnVmZmVyQVBJID0gdHlwZW9mIEJ1ZmZlcjMuYWxsb2MgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIEJ1ZmZlcjMuZnJvbSA9PT0gImZ1bmN0aW9uIjsKICAgICAgICBpZiAodHlwZW9mIGlucHV0ID09PSAibnVtYmVyIikgewogICAgICAgICAgcmV0dXJuIGhhc05ld0J1ZmZlckFQSSA/IEJ1ZmZlcjMuYWxsb2MoaW5wdXQpIDogbmV3IEJ1ZmZlcjMoaW5wdXQpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGlucHV0ID09PSAic3RyaW5nIikgewogICAgICAgICAgcmV0dXJuIGhhc05ld0J1ZmZlckFQSSA/IEJ1ZmZlcjMuZnJvbShpbnB1dCkgOiBuZXcgQnVmZmVyMyhpbnB1dCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaW5wdXQgbXVzdCBiZSBidWZmZXIsIG51bWJlciwgb3Igc3RyaW5nLCByZWNlaXZlZCAiICsgdHlwZW9mIGlucHV0KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYnVmZmVyaXplSW50KG51bSkgewogICAgICAgIHZhciB0bXAgPSBlbnN1cmVCdWZmZXIoNCk7CiAgICAgICAgdG1wLndyaXRlSW50MzJCRShudW0sIDApOwogICAgICAgIHJldHVybiB0bXA7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gX2NyYzMyKGJ1ZiwgcHJldmlvdXMpIHsKICAgICAgICBidWYgPSBlbnN1cmVCdWZmZXIoYnVmKTsKICAgICAgICBpZiAoQnVmZmVyMy5pc0J1ZmZlcihwcmV2aW91cykpIHsKICAgICAgICAgIHByZXZpb3VzID0gcHJldmlvdXMucmVhZFVJbnQzMkJFKDApOwogICAgICAgIH0KICAgICAgICB2YXIgY3JjID0gfn5wcmV2aW91cyBeIC0xOwogICAgICAgIGZvciAodmFyIG4gPSAwOyBuIDwgYnVmLmxlbmd0aDsgbisrKSB7CiAgICAgICAgICBjcmMgPSBDUkNfVEFCTEVbKGNyYyBeIGJ1ZltuXSkgJiAyNTVdIF4gY3JjID4+PiA4OwogICAgICAgIH0KICAgICAgICByZXR1cm4gY3JjIF4gLTE7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gY3JjMzIoKSB7CiAgICAgICAgcmV0dXJuIGJ1ZmZlcml6ZUludChfY3JjMzIuYXBwbHkobnVsbCwgYXJndW1lbnRzKSk7CiAgICAgIH0KICAgICAgY3JjMzIuc2lnbmVkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIF9jcmMzMi5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgICBjcmMzMi51bnNpZ25lZCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBfY3JjMzIuYXBwbHkobnVsbCwgYXJndW1lbnRzKSA+Pj4gMDsKICAgICAgfTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBjcmMzMjsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL29iamVjdC5lbnRyaWVzLXBvbnlmaWxsL2VudHJpZXMuanMKICB2YXIgcmVxdWlyZV9lbnRyaWVzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL29iamVjdC5lbnRyaWVzLXBvbnlmaWxsL2VudHJpZXMuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIGhhcyA9IGZ1bmN0aW9uKG9iaiwgcHJvcCkgewogICAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKTsKICAgICAgfTsKICAgICAgdmFyIGlzRW51bWVyYWJsZSA9IGZ1bmN0aW9uKG9iaiwgcHJvcCkgewogICAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwob2JqLCBwcm9wKTsKICAgICAgfTsKICAgICAgZnVuY3Rpb24gZW50cmllcyhvYmopIHsKICAgICAgICBpZiAob2JqID09IG51bGwpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjb252ZXJ0IHVuZGVmaW5lZCBvciBudWxsIHRvIG9iamVjdCIpOwogICAgICAgIH0KICAgICAgICB2YXIgcGFpcnMgPSBbXTsKICAgICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgICBpZiAoaGFzKG9iaiwga2V5KSAmJiBpc0VudW1lcmFibGUob2JqLCBrZXkpKSB7CiAgICAgICAgICAgIHBhaXJzLnB1c2goW2tleSwgb2JqW2tleV1dKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHBhaXJzOwogICAgICB9CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZW50cmllczsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL29iamVjdC5lbnRyaWVzLXBvbnlmaWxsL2luZGV4LmpzCiAgdmFyIHJlcXVpcmVfb2JqZWN0ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL29iamVjdC5lbnRyaWVzLXBvbnlmaWxsL2luZGV4LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHR5cGVvZiBPYmplY3QuZW50cmllcyA9PT0gImZ1bmN0aW9uIiA/IE9iamVjdC5lbnRyaWVzIDogcmVxdWlyZV9lbnRyaWVzKCk7CiAgICB9CiAgfSk7CgogIC8vIChkaXNhYmxlZCk6bm9kZV9tb2R1bGVzL0BnbW9kL2JhbS9ub2RlX21vZHVsZXMvZ2VuZXJpYy1maWxlaGFuZGxlL2Rpc3QvbG9jYWxGaWxlCiAgdmFyIHJlcXVpcmVfbG9jYWxGaWxlMiA9IF9fY29tbW9uSlMoewogICAgIihkaXNhYmxlZCk6bm9kZV9tb2R1bGVzL0BnbW9kL2JhbS9ub2RlX21vZHVsZXMvZ2VuZXJpYy1maWxlaGFuZGxlL2Rpc3QvbG9jYWxGaWxlIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgfQogIH0pOwoKICAvLyAoZGlzYWJsZWQpOm5vZGVfbW9kdWxlcy9maWxlLXVyaS10by1wYXRoL2Rpc3Qvc3JjL2luZGV4LmpzCiAgdmFyIHJlcXVpcmVfc3JjID0gX19jb21tb25KUyh7CiAgICAiKGRpc2FibGVkKTpub2RlX21vZHVsZXMvZmlsZS11cmktdG8tcGF0aC9kaXN0L3NyYy9pbmRleC5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BnbW9kL2JhbS9ub2RlX21vZHVsZXMvZ2VuZXJpYy1maWxlaGFuZGxlL2Rpc3QvcmVtb3RlRmlsZS5qcwogIHZhciByZXF1aXJlX3JlbW90ZUZpbGUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGdtb2QvYmFtL25vZGVfbW9kdWxlcy9nZW5lcmljLWZpbGVoYW5kbGUvZGlzdC9yZW1vdGVGaWxlLmpzIihleHBvcnRzKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IHJlcXVpcmVfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MigpOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgICAgdmFsdWU6IHRydWUKICAgICAgfSk7CiAgICAgIGV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDsKICAgICAgdmFyIF9yZWdlbmVyYXRvciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9yZWdlbmVyYXRvcjIoKSk7CiAgICAgIHZhciBfYXN5bmNUb0dlbmVyYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfYXN5bmNUb0dlbmVyYXRvcjIoKSk7CiAgICAgIHZhciBfY2xhc3NDYWxsQ2hlY2syID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2NsYXNzQ2FsbENoZWNrMigpKTsKICAgICAgdmFyIF9jcmVhdGVDbGFzczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfY3JlYXRlQ2xhc3MyKCkpOwogICAgICB2YXIgX2RlZmluZVByb3BlcnR5MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9kZWZpbmVQcm9wZXJ0eTIoKSk7CiAgICAgIHZhciBfZmlsZVVyaVRvUGF0aCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9zcmMoKSk7CiAgICAgIHZhciBfID0gcmVxdWlyZV9kaXN0MygpOwogICAgICBmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CiAgICAgICAgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsKICAgICAgICAgIHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOwogICAgICAgICAgaWYgKGVudW1lcmFibGVPbmx5KQogICAgICAgICAgICBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24oc3ltKSB7CiAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICAgICAgICAgIH0pOwogICAgICAgICAga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4ga2V5czsKICAgICAgfQogICAgICBmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKICAgICAgICAgIGlmIChpICUgMikgewogICAgICAgICAgICBvd25LZXlzKE9iamVjdChzb3VyY2UpLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyLmRlZmF1bHQpKHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHsKICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0YXJnZXQ7CiAgICAgIH0KICAgICAgdmFyIG15R2xvYmFsID0gdHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIgPyB3aW5kb3cgOiB0eXBlb2Ygc2VsZiAhPT0gInVuZGVmaW5lZCIgPyBzZWxmIDogewogICAgICAgIGZldGNoOiB2b2lkIDAKICAgICAgfTsKICAgICAgdmFyIFJlbW90ZUZpbGUgPSAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24oKSB7CiAgICAgICAgKDAsIF9jcmVhdGVDbGFzczIuZGVmYXVsdCkoUmVtb3RlRmlsZTIsIFt7CiAgICAgICAgICBrZXk6ICJnZXRCdWZmZXJGcm9tUmVzcG9uc2UiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgX2dldEJ1ZmZlckZyb21SZXNwb25zZSA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvci5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZShyZXNwb25zZSkgewogICAgICAgICAgICAgIHZhciByZXNwOwogICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgaWYgKCEodHlwZW9mIHJlc3BvbnNlLmJ1ZmZlciA9PT0gImZ1bmN0aW9uIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgcmVzcG9uc2UuYnVmZmVyKCkpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICAgIGlmICghKHR5cGVvZiByZXNwb25zZS5hcnJheUJ1ZmZlciA9PT0gImZ1bmN0aW9uIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmFycmF5QnVmZmVyKCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgICAgcmVzcCA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBpbXBvcnRfYnVmZmVyLkJ1ZmZlci5mcm9tKHJlc3ApKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiaW52YWxpZCBIVFRQIHJlc3BvbnNlIG9iamVjdCwgaGFzIG5vIGJ1ZmZlciBtZXRob2QsIGFuZCBubyBhcnJheUJ1ZmZlciBtZXRob2QiKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgZnVuY3Rpb24gZ2V0QnVmZmVyRnJvbVJlc3BvbnNlKF94KSB7CiAgICAgICAgICAgICAgcmV0dXJuIF9nZXRCdWZmZXJGcm9tUmVzcG9uc2UuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZ2V0QnVmZmVyRnJvbVJlc3BvbnNlOwogICAgICAgICAgfSgpCiAgICAgICAgfV0pOwogICAgICAgIGZ1bmN0aW9uIFJlbW90ZUZpbGUyKHNvdXJjZSkgewogICAgICAgICAgdmFyIG9wdHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgICAgICAgKDAsIF9jbGFzc0NhbGxDaGVjazIuZGVmYXVsdCkodGhpcywgUmVtb3RlRmlsZTIpOwogICAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIuZGVmYXVsdCkodGhpcywgInVybCIsIHZvaWQgMCk7CiAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5Mi5kZWZhdWx0KSh0aGlzLCAiX3N0YXQiLCB2b2lkIDApOwogICAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIuZGVmYXVsdCkodGhpcywgImZldGNoSW1wbGVtZW50YXRpb24iLCB2b2lkIDApOwogICAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIuZGVmYXVsdCkodGhpcywgImJhc2VPdmVycmlkZXMiLCB7fSk7CiAgICAgICAgICB0aGlzLnVybCA9IHNvdXJjZTsKICAgICAgICAgIGlmIChzb3VyY2Uuc3RhcnRzV2l0aCgiZmlsZTovLyIpKSB7CiAgICAgICAgICAgIHZhciBwYXRoID0gKDAsIF9maWxlVXJpVG9QYXRoLmRlZmF1bHQpKHNvdXJjZSk7CiAgICAgICAgICAgIGlmICghcGF0aCkgewogICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoImludmFsaWQgZmlsZSB1cmwiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgbG9jYWxGaWxlID0gbmV3IF8uTG9jYWxGaWxlKHBhdGgpOwogICAgICAgICAgICB0aGlzLnJlYWQgPSBsb2NhbEZpbGUucmVhZC5iaW5kKGxvY2FsRmlsZSk7CiAgICAgICAgICAgIHRoaXMucmVhZEZpbGUgPSBsb2NhbEZpbGUucmVhZEZpbGUuYmluZChsb2NhbEZpbGUpOwogICAgICAgICAgICB0aGlzLnN0YXQgPSBsb2NhbEZpbGUuc3RhdC5iaW5kKGxvY2FsRmlsZSk7CiAgICAgICAgICAgIHRoaXMuZmV0Y2hJbXBsZW1lbnRhdGlvbiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgZmV0Y2gyID0gb3B0cy5mZXRjaCB8fCBteUdsb2JhbC5mZXRjaCAmJiBteUdsb2JhbC5mZXRjaC5iaW5kKG15R2xvYmFsKTsKICAgICAgICAgIGlmICghZmV0Y2gyKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIm5vIGZldGNoIGZ1bmN0aW9uIHN1cHBsaWVkLCBhbmQgbm9uZSBmb3VuZCBpbiBnbG9iYWwgZW52aXJvbm1lbnQiKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChvcHRzLm92ZXJyaWRlcykgewogICAgICAgICAgICB0aGlzLmJhc2VPdmVycmlkZXMgPSBvcHRzLm92ZXJyaWRlczsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuZmV0Y2hJbXBsZW1lbnRhdGlvbiA9IGZldGNoMjsKICAgICAgICB9CiAgICAgICAgKDAsIF9jcmVhdGVDbGFzczIuZGVmYXVsdCkoUmVtb3RlRmlsZTIsIFt7CiAgICAgICAgICBrZXk6ICJmZXRjaCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBfZmV0Y2ggPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKGlucHV0LCBpbml0MikgewogICAgICAgICAgICAgIHZhciByZXNwb25zZTsKICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDA7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5mZXRjaEltcGxlbWVudGF0aW9uKGlucHV0LCBpbml0Mik7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDY7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIudDAgPSBfY29udGV4dDJbImNhdGNoIl0oMCk7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIShfY29udGV4dDIudDAubWVzc2FnZSA9PT0gIkZhaWxlZCB0byBmZXRjaCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJnZW5lcmljLWZpbGVoYW5kbGU6IHJlZmV0Y2hpbmcgIi5jb25jYXQoaW5wdXQsICIgdG8gYXR0ZW1wdCB0byB3b3JrIGFyb3VuZCBjaHJvbWUgQ09SUyBoZWFkZXIgY2FjaGluZyBidWciKSk7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmV0Y2hJbXBsZW1lbnRhdGlvbihpbnB1dCwgX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBpbml0MiksIHt9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlOiAicmVsb2FkIgogICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxNjsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBfY29udGV4dDIudDA7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCByZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCBfY2FsbGVlMiwgdGhpcywgW1swLCA2XV0pOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIGZ1bmN0aW9uIGZldGNoMihfeDIsIF94MykgewogICAgICAgICAgICAgIHJldHVybiBfZmV0Y2guYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmV0Y2gyOwogICAgICAgICAgfSgpCiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAicmVhZCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBfcmVhZCA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvci5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoYnVmZmVyKSB7CiAgICAgICAgICAgICAgdmFyIG9mZnNldCwgbGVuZ3RoLCBwb3NpdGlvbiwgb3B0cywgX29wdHMkaGVhZGVycywgaGVhZGVycywgc2lnbmFsLCBfb3B0cyRvdmVycmlkZXMsIG92ZXJyaWRlcywgYXJncywgcmVzcG9uc2UsIHJlc3BvbnNlRGF0YSwgYnl0ZXNDb3BpZWQsIHJlcywgc2l6ZU1hdGNoLCBfYXJnczMgPSBhcmd1bWVudHM7CiAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvci5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gX2FyZ3MzLmxlbmd0aCA+IDEgJiYgX2FyZ3MzWzFdICE9PSB2b2lkIDAgPyBfYXJnczNbMV0gOiAwOwogICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoID0gX2FyZ3MzLmxlbmd0aCA+IDIgPyBfYXJnczNbMl0gOiB2b2lkIDA7CiAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IF9hcmdzMy5sZW5ndGggPiAzICYmIF9hcmdzM1szXSAhPT0gdm9pZCAwID8gX2FyZ3MzWzNdIDogMDsKICAgICAgICAgICAgICAgICAgICAgIG9wdHMgPSBfYXJnczMubGVuZ3RoID4gNCAmJiBfYXJnczNbNF0gIT09IHZvaWQgMCA/IF9hcmdzM1s0XSA6IHt9OwogICAgICAgICAgICAgICAgICAgICAgX29wdHMkaGVhZGVycyA9IG9wdHMuaGVhZGVycywgaGVhZGVycyA9IF9vcHRzJGhlYWRlcnMgPT09IHZvaWQgMCA/IHt9IDogX29wdHMkaGVhZGVycywgc2lnbmFsID0gb3B0cy5zaWduYWwsIF9vcHRzJG92ZXJyaWRlcyA9IG9wdHMub3ZlcnJpZGVzLCBvdmVycmlkZXMgPSBfb3B0cyRvdmVycmlkZXMgPT09IHZvaWQgMCA/IHt9IDogX29wdHMkb3ZlcnJpZGVzOwogICAgICAgICAgICAgICAgICAgICAgaWYgKGxlbmd0aCA8IEluZmluaXR5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnMucmFuZ2UgPSAiYnl0ZXM9Ii5jb25jYXQocG9zaXRpb24sICItIikuY29uY2F0KHBvc2l0aW9uICsgbGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobGVuZ3RoID09PSBJbmZpbml0eSAmJiBwb3NpdGlvbiAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzLnJhbmdlID0gImJ5dGVzPSIuY29uY2F0KHBvc2l0aW9uLCAiLSIpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgYXJncyA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCB0aGlzLmJhc2VPdmVycmlkZXMpLCBvdmVycmlkZXMpLCB7fSwgewogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgaGVhZGVycyksIG92ZXJyaWRlcy5oZWFkZXJzKSwgdGhpcy5iYXNlT3ZlcnJpZGVzLmhlYWRlcnMpLAogICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICJHRVQiLAogICAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdDogImZvbGxvdyIsCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU6ICJjb3JzIiwKICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsCiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gOTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZldGNoKHRoaXMudXJsLCBhcmdzKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJIVFRQICIuY29uY2F0KHJlc3BvbnNlLnN0YXR1cywgIiAiKS5jb25jYXQocmVzcG9uc2Uuc3RhdHVzVGV4dCkpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIShyZXNwb25zZS5zdGF0dXMgPT09IDIwMCAmJiBwb3NpdGlvbiA9PT0gMCB8fCByZXNwb25zZS5zdGF0dXMgPT09IDIwNikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDE1OwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QnVmZmVyRnJvbVJlc3BvbnNlKHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VEYXRhID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICBieXRlc0NvcGllZCA9IHJlc3BvbnNlRGF0YS5jb3B5KGJ1ZmZlciwgb2Zmc2V0LCAwLCBNYXRoLm1pbihsZW5ndGgsIHJlc3BvbnNlRGF0YS5sZW5ndGgpKTsKICAgICAgICAgICAgICAgICAgICAgIHJlcyA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCJjb250ZW50LXJhbmdlIik7CiAgICAgICAgICAgICAgICAgICAgICBzaXplTWF0Y2ggPSAvXC8oXGQrKSQvLmV4ZWMocmVzIHx8ICIiKTsKICAgICAgICAgICAgICAgICAgICAgIGlmIChzaXplTWF0Y2ggJiYgc2l6ZU1hdGNoWzFdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3N0YXQgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogcGFyc2VJbnQoc2l6ZU1hdGNoWzFdLCAxMCkKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGVzUmVhZDogYnl0ZXNDb3BpZWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlcgogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgICAgICAgICAgIGlmICghKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSkgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDIzOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiJHt0aGlzLnVybH0gZmV0Y2ggcmV0dXJuZWQgc3RhdHVzIDIwMCwgZXhwZWN0ZWQgMjA2Iik7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMzoKICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSFRUUCAiLmNvbmNhdChyZXNwb25zZS5zdGF0dXMsICIgZmV0Y2hpbmcgIikuY29uY2F0KHRoaXMudXJsKSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyNDoKICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCBfY2FsbGVlMywgdGhpcyk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgZnVuY3Rpb24gcmVhZChfeDQpIHsKICAgICAgICAgICAgICByZXR1cm4gX3JlYWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVhZDsKICAgICAgICAgIH0oKQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInJlYWRGaWxlIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIF9yZWFkRmlsZSA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvci5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQoKSB7CiAgICAgICAgICAgICAgdmFyIG9wdGlvbnMsIGVuY29kaW5nLCBvcHRzLCBfb3B0cywgX29wdHMkaGVhZGVyczIsIGhlYWRlcnMsIHNpZ25hbCwgX29wdHMkb3ZlcnJpZGVzMiwgb3ZlcnJpZGVzLCBhcmdzLCByZXNwb25zZSwgX2FyZ3M0ID0gYXJndW1lbnRzOwogICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBfYXJnczQubGVuZ3RoID4gMCAmJiBfYXJnczRbMF0gIT09IHZvaWQgMCA/IF9hcmdzNFswXSA6IHt9OwogICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAic3RyaW5nIikgewogICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGluZyA9IG9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wdHMgPSB7fTsKICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kaW5nID0gb3B0aW9ucy5lbmNvZGluZzsKICAgICAgICAgICAgICAgICAgICAgICAgb3B0cyA9IG9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBvcHRzLmVuY29kaW5nOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgX29wdHMgPSBvcHRzLCBfb3B0cyRoZWFkZXJzMiA9IF9vcHRzLmhlYWRlcnMsIGhlYWRlcnMgPSBfb3B0cyRoZWFkZXJzMiA9PT0gdm9pZCAwID8ge30gOiBfb3B0cyRoZWFkZXJzMiwgc2lnbmFsID0gX29wdHMuc2lnbmFsLCBfb3B0cyRvdmVycmlkZXMyID0gX29wdHMub3ZlcnJpZGVzLCBvdmVycmlkZXMgPSBfb3B0cyRvdmVycmlkZXMyID09PSB2b2lkIDAgPyB7fSA6IF9vcHRzJG92ZXJyaWRlczI7CiAgICAgICAgICAgICAgICAgICAgICBhcmdzID0gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHsKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycywKICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAiR0VUIiwKICAgICAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3Q6ICJmb2xsb3ciLAogICAgICAgICAgICAgICAgICAgICAgICBtb2RlOiAiY29ycyIsCiAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbAogICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5iYXNlT3ZlcnJpZGVzKSwgb3ZlcnJpZGVzKTsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZldGNoKHRoaXMudXJsLCBhcmdzKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0NC5zZW50OwogICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gOTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImdlbmVyaWMtZmlsZWhhbmRsZSBmYWlsZWQgdG8gZmV0Y2giKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIShyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBPYmplY3QuYXNzaWduKG5ldyBFcnJvcigiSFRUUCAiLmNvbmNhdChyZXNwb25zZS5zdGF0dXMsICIgZmV0Y2hpbmcgIikuY29uY2F0KHRoaXMudXJsKSksIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIShlbmNvZGluZyA9PT0gInV0ZjgiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDEzOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCByZXNwb25zZS50ZXh0KCkpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVuY29kaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ1bnN1cHBvcnRlZCBlbmNvZGluZzogIi5jb25jYXQoZW5jb2RpbmcpKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIHRoaXMuZ2V0QnVmZmVyRnJvbVJlc3BvbnNlKHJlc3BvbnNlKSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCBfY2FsbGVlNCwgdGhpcyk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgZnVuY3Rpb24gcmVhZEZpbGUoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF9yZWFkRmlsZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZWFkRmlsZTsKICAgICAgICAgIH0oKQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInN0YXQiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgX3N0YXQgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1KCkgewogICAgICAgICAgICAgIHZhciBidWY7CiAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvci5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0NSkgewogICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGJ1ZiA9IGltcG9ydF9idWZmZXIuQnVmZmVyLmFsbG9jVW5zYWZlKDEwKTsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlYWQoYnVmLCAwLCAxMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidW5hYmxlIHRvIGRldGVybWluZSBzaXplIG9mIGZpbGUgYXQgIi5jb25jYXQodGhpcy51cmwpKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwgdGhpcy5fc3RhdCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIF9jYWxsZWU1LCB0aGlzKTsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICBmdW5jdGlvbiBzdGF0KCkgewogICAgICAgICAgICAgIHJldHVybiBfc3RhdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzdGF0OwogICAgICAgICAgfSgpCiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiY2xvc2UiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgX2Nsb3NlID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlNigpIHsKICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ2KSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIik7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIF9jYWxsZWU2KTsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICBmdW5jdGlvbiBjbG9zZSgpIHsKICAgICAgICAgICAgICByZXR1cm4gX2Nsb3NlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNsb3NlOwogICAgICAgICAgfSgpCiAgICAgICAgfV0pOwogICAgICAgIHJldHVybiBSZW1vdGVGaWxlMjsKICAgICAgfSgpOwogICAgICBleHBvcnRzLmRlZmF1bHQgPSBSZW1vdGVGaWxlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGdtb2QvYmFtL25vZGVfbW9kdWxlcy9nZW5lcmljLWZpbGVoYW5kbGUvZGlzdC9ibG9iRmlsZS5qcwogIHZhciByZXF1aXJlX2Jsb2JGaWxlID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BnbW9kL2JhbS9ub2RlX21vZHVsZXMvZ2VuZXJpYy1maWxlaGFuZGxlL2Rpc3QvYmxvYkZpbGUuanMiKGV4cG9ydHMpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0ID0gcmVxdWlyZV9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKCk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgICB2YWx1ZTogdHJ1ZQogICAgICB9KTsKICAgICAgZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwOwogICAgICB2YXIgX3JlZ2VuZXJhdG9yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX3JlZ2VuZXJhdG9yMigpKTsKICAgICAgdmFyIF9hc3luY1RvR2VuZXJhdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9hc3luY1RvR2VuZXJhdG9yMigpKTsKICAgICAgdmFyIF9jbGFzc0NhbGxDaGVjazIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfY2xhc3NDYWxsQ2hlY2syKCkpOwogICAgICB2YXIgX2NyZWF0ZUNsYXNzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9jcmVhdGVDbGFzczIoKSk7CiAgICAgIHZhciBfZGVmaW5lUHJvcGVydHkyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2RlZmluZVByb3BlcnR5MigpKTsKICAgICAgZnVuY3Rpb24gcmVhZEJsb2JBc0FycmF5QnVmZmVyKGJsb2IpIHsKICAgICAgICB2YXIgZmlsZVJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgZmlsZVJlYWRlci5vbmVycm9yID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGZpbGVSZWFkZXIuYWJvcnQoKTsKICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcigicHJvYmxlbSByZWFkaW5nIGJsb2IiKSk7CiAgICAgICAgICB9OwogICAgICAgICAgZmlsZVJlYWRlci5vbmFib3J0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoImJsb2IgcmVhZGluZyB3YXMgYWJvcnRlZCIpKTsKICAgICAgICAgIH07CiAgICAgICAgICBmaWxlUmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoZmlsZVJlYWRlci5yZXN1bHQgJiYgdHlwZW9mIGZpbGVSZWFkZXIucmVzdWx0ICE9PSAic3RyaW5nIikgewogICAgICAgICAgICAgIHJlc29sdmUoZmlsZVJlYWRlci5yZXN1bHQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoInVua25vd24gZXJyb3IgcmVhZGluZyBibG9iIikpOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgICAgZmlsZVJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihibG9iKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiByZWFkQmxvYkFzVGV4dChibG9iKSB7CiAgICAgICAgdmFyIGZpbGVSZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgIGZpbGVSZWFkZXIub25lcnJvciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBmaWxlUmVhZGVyLmFib3J0KCk7CiAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoInByb2JsZW0gcmVhZGluZyBibG9iIikpOwogICAgICAgICAgfTsKICAgICAgICAgIGZpbGVSZWFkZXIub25hYm9ydCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCJibG9iIHJlYWRpbmcgd2FzIGFib3J0ZWQiKSk7CiAgICAgICAgICB9OwogICAgICAgICAgZmlsZVJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKGZpbGVSZWFkZXIucmVzdWx0ICYmIHR5cGVvZiBmaWxlUmVhZGVyLnJlc3VsdCA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICByZXNvbHZlKGZpbGVSZWFkZXIucmVzdWx0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCJ1bmtub3duIGVycm9yIHJlYWRpbmcgYmxvYiIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICAgIGZpbGVSZWFkZXIucmVhZEFzVGV4dChibG9iKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICB2YXIgQmxvYkZpbGUgPSAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24oKSB7CiAgICAgICAgZnVuY3Rpb24gQmxvYkZpbGUyKGJsb2IpIHsKICAgICAgICAgICgwLCBfY2xhc3NDYWxsQ2hlY2syLmRlZmF1bHQpKHRoaXMsIEJsb2JGaWxlMik7CiAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5Mi5kZWZhdWx0KSh0aGlzLCAiYmxvYiIsIHZvaWQgMCk7CiAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5Mi5kZWZhdWx0KSh0aGlzLCAic2l6ZSIsIHZvaWQgMCk7CiAgICAgICAgICB0aGlzLmJsb2IgPSBibG9iOwogICAgICAgICAgdGhpcy5zaXplID0gYmxvYi5zaXplOwogICAgICAgIH0KICAgICAgICAoMCwgX2NyZWF0ZUNsYXNzMi5kZWZhdWx0KShCbG9iRmlsZTIsIFt7CiAgICAgICAgICBrZXk6ICJyZWFkIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIF9yZWFkID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlKGJ1ZmZlcikgewogICAgICAgICAgICAgIHZhciBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24sIHN0YXJ0LCBlbmQsIHJlc3VsdCwgcmVzdWx0QnVmZmVyLCBieXRlc0NvcGllZCwgX2FyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvci5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSBfYXJncy5sZW5ndGggPiAxICYmIF9hcmdzWzFdICE9PSB2b2lkIDAgPyBfYXJnc1sxXSA6IDA7CiAgICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSBfYXJncy5sZW5ndGggPiAyID8gX2FyZ3NbMl0gOiB2b2lkIDA7CiAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IF9hcmdzLmxlbmd0aCA+IDMgJiYgX2FyZ3NbM10gIT09IHZvaWQgMCA/IF9hcmdzWzNdIDogMDsKICAgICAgICAgICAgICAgICAgICAgIGlmIChsZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAgICAgICBieXRlc1JlYWQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlcgogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSBwb3NpdGlvbjsKICAgICAgICAgICAgICAgICAgICAgIGVuZCA9IHN0YXJ0ICsgbGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDk7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVhZEJsb2JBc0FycmF5QnVmZmVyKHRoaXMuYmxvYi5zbGljZShzdGFydCwgZW5kKSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdEJ1ZmZlciA9IGltcG9ydF9idWZmZXIuQnVmZmVyLmZyb20ocmVzdWx0KTsKICAgICAgICAgICAgICAgICAgICAgIGJ5dGVzQ29waWVkID0gcmVzdWx0QnVmZmVyLmNvcHkoYnVmZmVyLCBvZmZzZXQpOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAgICAgICBieXRlc1JlYWQ6IGJ5dGVzQ29waWVkLAogICAgICAgICAgICAgICAgICAgICAgICBidWZmZXI6IHJlc3VsdEJ1ZmZlcgogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIGZ1bmN0aW9uIHJlYWQoX3gpIHsKICAgICAgICAgICAgICByZXR1cm4gX3JlYWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVhZDsKICAgICAgICAgIH0oKQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInJlYWRGaWxlIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIF9yZWFkRmlsZSA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvci5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIob3B0aW9ucykgewogICAgICAgICAgICAgIHZhciBlbmNvZGluZywgcmVzdWx0OwogICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RpbmcgPSBvcHRpb25zOwogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2RpbmcgPSBvcHRpb25zICYmIG9wdGlvbnMuZW5jb2Rpbmc7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIShlbmNvZGluZyA9PT0gInV0ZjgiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIHJlYWRCbG9iQXNUZXh0KHRoaXMuYmxvYikpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgIGlmICghZW5jb2RpbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA1OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidW5zdXBwb3J0ZWQgZW5jb2Rpbmc6ICIuY29uY2F0KGVuY29kaW5nKSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA3OwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlYWRCbG9iQXNBcnJheUJ1ZmZlcih0aGlzLmJsb2IpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIGltcG9ydF9idWZmZXIuQnVmZmVyLmZyb20ocmVzdWx0KSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICBmdW5jdGlvbiByZWFkRmlsZShfeDIpIHsKICAgICAgICAgICAgICByZXR1cm4gX3JlYWRGaWxlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlYWRGaWxlOwogICAgICAgICAgfSgpCiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAic3RhdCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBfc3RhdCA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvci5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvci5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogdGhpcy5zaXplCiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgX2NhbGxlZTMsIHRoaXMpOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIGZ1bmN0aW9uIHN0YXQoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF9zdGF0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHN0YXQ7CiAgICAgICAgICB9KCkKICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJjbG9zZSIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBfY2xvc2UgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KCkgewogICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgX2NhbGxlZTQpOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIGZ1bmN0aW9uIGNsb3NlKCkgewogICAgICAgICAgICAgIHJldHVybiBfY2xvc2UuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gY2xvc2U7CiAgICAgICAgICB9KCkKICAgICAgICB9XSk7CiAgICAgICAgcmV0dXJuIEJsb2JGaWxlMjsKICAgICAgfSgpOwogICAgICBleHBvcnRzLmRlZmF1bHQgPSBCbG9iRmlsZTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BnbW9kL2JhbS9ub2RlX21vZHVsZXMvZ2VuZXJpYy1maWxlaGFuZGxlL2Rpc3QvZmlsZWhhbmRsZS5qcwogIHZhciByZXF1aXJlX2ZpbGVoYW5kbGUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGdtb2QvYmFtL25vZGVfbW9kdWxlcy9nZW5lcmljLWZpbGVoYW5kbGUvZGlzdC9maWxlaGFuZGxlLmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AZ21vZC9iYW0vbm9kZV9tb2R1bGVzL2dlbmVyaWMtZmlsZWhhbmRsZS9kaXN0L2luZGV4LmpzCiAgdmFyIHJlcXVpcmVfZGlzdDMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGdtb2QvYmFtL25vZGVfbW9kdWxlcy9nZW5lcmljLWZpbGVoYW5kbGUvZGlzdC9pbmRleC5qcyIoZXhwb3J0cykgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoKTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICAgIHZhbHVlOiB0cnVlCiAgICAgIH0pOwogICAgICB2YXIgX2V4cG9ydE5hbWVzID0gewogICAgICAgIG9wZW46IHRydWUsCiAgICAgICAgZnJvbVVybDogdHJ1ZSwKICAgICAgICBMb2NhbEZpbGU6IHRydWUsCiAgICAgICAgUmVtb3RlRmlsZTogdHJ1ZSwKICAgICAgICBCbG9iRmlsZTogdHJ1ZQogICAgICB9OwogICAgICBleHBvcnRzLm9wZW4gPSBvcGVuOwogICAgICBleHBvcnRzLmZyb21VcmwgPSBmcm9tVXJsOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIkxvY2FsRmlsZSIsIHsKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0MigpIHsKICAgICAgICAgIHJldHVybiBfbG9jYWxGaWxlLmRlZmF1bHQ7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJSZW1vdGVGaWxlIiwgewogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQyKCkgewogICAgICAgICAgcmV0dXJuIF9yZW1vdGVGaWxlLmRlZmF1bHQ7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJCbG9iRmlsZSIsIHsKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0MigpIHsKICAgICAgICAgIHJldHVybiBfYmxvYkZpbGUuZGVmYXVsdDsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB2YXIgX2xvY2FsRmlsZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9sb2NhbEZpbGUyKCkpOwogICAgICB2YXIgX3JlbW90ZUZpbGUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfcmVtb3RlRmlsZSgpKTsKICAgICAgdmFyIF9ibG9iRmlsZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9ibG9iRmlsZSgpKTsKICAgICAgdmFyIF9maWxlaGFuZGxlID0gcmVxdWlyZV9maWxlaGFuZGxlKCk7CiAgICAgIE9iamVjdC5rZXlzKF9maWxlaGFuZGxlKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgewogICAgICAgIGlmIChrZXkgPT09ICJkZWZhdWx0IiB8fCBrZXkgPT09ICJfX2VzTW9kdWxlIikKICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKF9leHBvcnROYW1lcywga2V5KSkKICAgICAgICAgIHJldHVybjsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7CiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQyKCkgewogICAgICAgICAgICByZXR1cm4gX2ZpbGVoYW5kbGVba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIGZ1bmN0aW9uIGZyb21Vcmwoc291cmNlKSB7CiAgICAgICAgdmFyIG9wdHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgICAgIHJldHVybiBuZXcgX3JlbW90ZUZpbGUuZGVmYXVsdChzb3VyY2UsIG9wdHMpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIG9wZW4obWF5YmVVcmwsIG1heWJlUGF0aCwgbWF5YmVGaWxlaGFuZGxlKSB7CiAgICAgICAgdmFyIG9wdHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1szXSA6IHt9OwogICAgICAgIGlmIChtYXliZUZpbGVoYW5kbGUgIT09IHZvaWQgMCkgewogICAgICAgICAgcmV0dXJuIG1heWJlRmlsZWhhbmRsZTsKICAgICAgICB9CiAgICAgICAgaWYgKG1heWJlVXJsICE9PSB2b2lkIDApIHsKICAgICAgICAgIHJldHVybiBmcm9tVXJsKG1heWJlVXJsLCBvcHRzKTsKICAgICAgICB9CiAgICAgICAgaWYgKG1heWJlUGF0aCAhPT0gdm9pZCAwKSB7CiAgICAgICAgICByZXR1cm4gbmV3IF9sb2NhbEZpbGUuZGVmYXVsdChtYXliZVBhdGgsIG9wdHMpOwogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIm5vIHVybCwgcGF0aCwgb3IgZmlsZWhhbmRsZSBwcm92aWRlZCwgY2Fubm90IG9wZW4iKTsKICAgICAgfQogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMucmVnZXhwLmZsYWdzLmpzCiAgdmFyIHJlcXVpcmVfZXNfcmVnZXhwX2ZsYWdzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLnJlZ2V4cC5mbGFncy5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvcmVnZXhwLWZsYWdzLmpzCiAgdmFyIHJlcXVpcmVfcmVnZXhwX2ZsYWdzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvcmVnZXhwLWZsYWdzLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBhbk9iamVjdCA9IHJlcXVpcmVfYW5fb2JqZWN0KCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHRoYXQgPSBhbk9iamVjdCh0aGlzKTsKICAgICAgICB2YXIgcmVzdWx0ID0gIiI7CiAgICAgICAgaWYgKHRoYXQuZ2xvYmFsKQogICAgICAgICAgcmVzdWx0ICs9ICJnIjsKICAgICAgICBpZiAodGhhdC5pZ25vcmVDYXNlKQogICAgICAgICAgcmVzdWx0ICs9ICJpIjsKICAgICAgICBpZiAodGhhdC5tdWx0aWxpbmUpCiAgICAgICAgICByZXN1bHQgKz0gIm0iOwogICAgICAgIGlmICh0aGF0LmRvdEFsbCkKICAgICAgICAgIHJlc3VsdCArPSAicyI7CiAgICAgICAgaWYgKHRoYXQudW5pY29kZSkKICAgICAgICAgIHJlc3VsdCArPSAidSI7CiAgICAgICAgaWYgKHRoYXQuc3RpY2t5KQogICAgICAgICAgcmVzdWx0ICs9ICJ5IjsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL3JlZ2V4cC9mbGFncy5qcwogIHZhciByZXF1aXJlX2ZsYWdzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9yZWdleHAvZmxhZ3MuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHJlcXVpcmVfZXNfcmVnZXhwX2ZsYWdzKCk7CiAgICAgIHZhciBmbGFncyA9IHJlcXVpcmVfcmVnZXhwX2ZsYWdzKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpIHsKICAgICAgICByZXR1cm4gZmxhZ3MuY2FsbChpdCk7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvaW5zdGFuY2UvZmxhZ3MuanMKICB2YXIgcmVxdWlyZV9mbGFnczIgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2VzL2luc3RhbmNlL2ZsYWdzLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgZmxhZ3MgPSByZXF1aXJlX2ZsYWdzKCk7CiAgICAgIHZhciBSZWdFeHBQcm90b3R5cGUgPSBSZWdFeHAucHJvdG90eXBlOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KSB7CiAgICAgICAgcmV0dXJuIChpdCA9PT0gUmVnRXhwUHJvdG90eXBlIHx8IGl0IGluc3RhbmNlb2YgUmVnRXhwKSAmJiAhKCJmbGFncyIgaW4gaXQpID8gZmxhZ3MoaXQpIDogaXQuZmxhZ3M7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL2luc3RhbmNlL2ZsYWdzLmpzCiAgdmFyIHJlcXVpcmVfZmxhZ3MzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvaW5zdGFuY2UvZmxhZ3MuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX2ZsYWdzMigpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhcmVudDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy1zdGFibGUvaW5zdGFuY2UvZmxhZ3MuanMKICB2YXIgcmVxdWlyZV9mbGFnczQgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzLXN0YWJsZS9pbnN0YW5jZS9mbGFncy5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlX2ZsYWdzMygpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy93aGl0ZXNwYWNlcy5qcwogIHZhciByZXF1aXJlX3doaXRlc3BhY2VzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvd2hpdGVzcGFjZXMuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gIglcblx2XGZcciBceEEwXHUxNjgwXHUyMDAwXHUyMDAxXHUyMDAyXHUyMDAzXHUyMDA0XHUyMDA1XHUyMDA2XHUyMDA3XHUyMDA4XHUyMDA5XHUyMDBBXHUyMDJGXHUyMDVGXHUzMDAwXHUyMDI4XHUyMDI5XHVGRUZGIjsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvc3RyaW5nLXRyaW0uanMKICB2YXIgcmVxdWlyZV9zdHJpbmdfdHJpbSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL3N0cmluZy10cmltLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgcmVxdWlyZU9iamVjdENvZXJjaWJsZSA9IHJlcXVpcmVfcmVxdWlyZV9vYmplY3RfY29lcmNpYmxlKCk7CiAgICAgIHZhciB0b1N0cmluZyA9IHJlcXVpcmVfdG9fc3RyaW5nKCk7CiAgICAgIHZhciB3aGl0ZXNwYWNlcyA9IHJlcXVpcmVfd2hpdGVzcGFjZXMoKTsKICAgICAgdmFyIHdoaXRlc3BhY2UgPSAiWyIgKyB3aGl0ZXNwYWNlcyArICJdIjsKICAgICAgdmFyIGx0cmltID0gUmVnRXhwKCJeIiArIHdoaXRlc3BhY2UgKyB3aGl0ZXNwYWNlICsgIioiKTsKICAgICAgdmFyIHJ0cmltID0gUmVnRXhwKHdoaXRlc3BhY2UgKyB3aGl0ZXNwYWNlICsgIiokIik7CiAgICAgIHZhciBjcmVhdGVNZXRob2QgPSBmdW5jdGlvbihUWVBFKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCR0aGlzKSB7CiAgICAgICAgICB2YXIgc3RyaW5nID0gdG9TdHJpbmcocmVxdWlyZU9iamVjdENvZXJjaWJsZSgkdGhpcykpOwogICAgICAgICAgaWYgKFRZUEUgJiAxKQogICAgICAgICAgICBzdHJpbmcgPSBzdHJpbmcucmVwbGFjZShsdHJpbSwgIiIpOwogICAgICAgICAgaWYgKFRZUEUgJiAyKQogICAgICAgICAgICBzdHJpbmcgPSBzdHJpbmcucmVwbGFjZShydHJpbSwgIiIpOwogICAgICAgICAgcmV0dXJuIHN0cmluZzsKICAgICAgICB9OwogICAgICB9OwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgICAgICBzdGFydDogY3JlYXRlTWV0aG9kKDEpLAogICAgICAgIGVuZDogY3JlYXRlTWV0aG9kKDIpLAogICAgICAgIHRyaW06IGNyZWF0ZU1ldGhvZCgzKQogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ludGVybmFscy9udW1iZXItcGFyc2UtaW50LmpzCiAgdmFyIHJlcXVpcmVfbnVtYmVyX3BhcnNlX2ludCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL251bWJlci1wYXJzZS1pbnQuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBnbG9iYWwyID0gcmVxdWlyZV9nbG9iYWwoKTsKICAgICAgdmFyIGZhaWxzID0gcmVxdWlyZV9mYWlscygpOwogICAgICB2YXIgdG9TdHJpbmcgPSByZXF1aXJlX3RvX3N0cmluZygpOwogICAgICB2YXIgdHJpbSA9IHJlcXVpcmVfc3RyaW5nX3RyaW0oKS50cmltOwogICAgICB2YXIgd2hpdGVzcGFjZXMgPSByZXF1aXJlX3doaXRlc3BhY2VzKCk7CiAgICAgIHZhciAkcGFyc2VJbnQgPSBnbG9iYWwyLnBhcnNlSW50OwogICAgICB2YXIgU3ltYm9sMiA9IGdsb2JhbDIuU3ltYm9sOwogICAgICB2YXIgSVRFUkFUT1IgPSBTeW1ib2wyICYmIFN5bWJvbDIuaXRlcmF0b3I7CiAgICAgIHZhciBoZXggPSAvXlsrLV0/MFtYeF0vOwogICAgICB2YXIgRk9SQ0VEID0gJHBhcnNlSW50KHdoaXRlc3BhY2VzICsgIjA4IikgIT09IDggfHwgJHBhcnNlSW50KHdoaXRlc3BhY2VzICsgIjB4MTYiKSAhPT0gMjIgfHwgSVRFUkFUT1IgJiYgIWZhaWxzKGZ1bmN0aW9uKCkgewogICAgICAgICRwYXJzZUludChPYmplY3QoSVRFUkFUT1IpKTsKICAgICAgfSk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gRk9SQ0VEID8gZnVuY3Rpb24gcGFyc2VJbnQyKHN0cmluZywgcmFkaXgpIHsKICAgICAgICB2YXIgUyA9IHRyaW0odG9TdHJpbmcoc3RyaW5nKSk7CiAgICAgICAgcmV0dXJuICRwYXJzZUludChTLCByYWRpeCA+Pj4gMCB8fCAoaGV4LnRlc3QoUykgPyAxNiA6IDEwKSk7CiAgICAgIH0gOiAkcGFyc2VJbnQ7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5wYXJzZS1pbnQuanMKICB2YXIgcmVxdWlyZV9lc19wYXJzZV9pbnQgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMucGFyc2UtaW50LmpzIigpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgJCA9IHJlcXVpcmVfZXhwb3J0KCk7CiAgICAgIHZhciAkcGFyc2VJbnQgPSByZXF1aXJlX251bWJlcl9wYXJzZV9pbnQoKTsKICAgICAgJCh7IGdsb2JhbDogdHJ1ZSwgZm9yY2VkOiBwYXJzZUludCAhPSAkcGFyc2VJbnQgfSwgewogICAgICAgIHBhcnNlSW50OiAkcGFyc2VJbnQKICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvcGFyc2UtaW50LmpzCiAgdmFyIHJlcXVpcmVfcGFyc2VfaW50ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9wYXJzZS1pbnQuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHJlcXVpcmVfZXNfcGFyc2VfaW50KCk7CiAgICAgIHZhciBwYXRoID0gcmVxdWlyZV9wYXRoKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGF0aC5wYXJzZUludDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvcGFyc2UtaW50LmpzCiAgdmFyIHJlcXVpcmVfcGFyc2VfaW50MiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL3BhcnNlLWludC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHBhcmVudCA9IHJlcXVpcmVfcGFyc2VfaW50KCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGFyZW50OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzLXN0YWJsZS9wYXJzZS1pbnQuanMKICB2YXIgcmVxdWlyZV9wYXJzZV9pbnQzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy1zdGFibGUvcGFyc2UtaW50LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmVfcGFyc2VfaW50MigpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGdtb2QvYmFtL2Rpc3QvY29uc3RhbnRzLmpzCiAgdmFyIHJlcXVpcmVfY29uc3RhbnRzMiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AZ21vZC9iYW0vZGlzdC9jb25zdGFudHMuanMiKGV4cG9ydHMpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBfT2JqZWN0JGRlZmluZVByb3BlcnR5ID0gcmVxdWlyZV9kZWZpbmVfcHJvcGVydHkzKCk7CiAgICAgIF9PYmplY3QkZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgICAgdmFsdWU6IHRydWUKICAgICAgfSk7CiAgICAgIGV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDsKICAgICAgdmFyIF9kZWZhdWx0ID0gewogICAgICAgIEJBTV9GUEFJUkVEOiAxLAogICAgICAgIEJBTV9GUFJPUEVSX1BBSVI6IDIsCiAgICAgICAgQkFNX0ZVTk1BUDogNCwKICAgICAgICBCQU1fRk1VTk1BUDogOCwKICAgICAgICBCQU1fRlJFVkVSU0U6IDE2LAogICAgICAgIEJBTV9GTVJFVkVSU0U6IDMyLAogICAgICAgIEJBTV9GUkVBRDE6IDY0LAogICAgICAgIEJBTV9GUkVBRDI6IDEyOCwKICAgICAgICBCQU1fRlNFQ09OREFSWTogMjU2LAogICAgICAgIEJBTV9GUUNGQUlMOiA1MTIsCiAgICAgICAgQkFNX0ZEVVA6IDEwMjQsCiAgICAgICAgQkFNX0ZTVVBQTEVNRU5UQVJZOiAyMDQ4CiAgICAgIH07CiAgICAgIGV4cG9ydHMuZGVmYXVsdCA9IF9kZWZhdWx0OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGdtb2QvYmFtL2Rpc3QvcmVjb3JkLmpzCiAgdmFyIHJlcXVpcmVfcmVjb3JkID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BnbW9kL2JhbS9kaXN0L3JlY29yZC5qcyIoZXhwb3J0cykgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlX2ludGVyb3BSZXF1aXJlRGVmYXVsdCgpOwogICAgICB2YXIgX09iamVjdCRkZWZpbmVQcm9wZXJ0eSA9IHJlcXVpcmVfZGVmaW5lX3Byb3BlcnR5MygpOwogICAgICBfT2JqZWN0JGRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICAgIHZhbHVlOiB0cnVlCiAgICAgIH0pOwogICAgICBleHBvcnRzLmRlZmF1bHQgPSB2b2lkIDA7CiAgICAgIHZhciBfZmxhZ3MyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2ZsYWdzNCgpKTsKICAgICAgdmFyIF9wYXJzZUludDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfcGFyc2VfaW50MygpKTsKICAgICAgdmFyIF9maWx0ZXIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfZmlsdGVyNCgpKTsKICAgICAgdmFyIF9rZXlzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2tleXMzKCkpOwogICAgICB2YXIgX2ZvckVhY2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfZm9yX2VhY2g0KCkpOwogICAgICB2YXIgX2NvbmNhdCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9jb25jYXQ0KCkpOwogICAgICB2YXIgX2NsYXNzQ2FsbENoZWNrMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9jbGFzc0NhbGxDaGVjaygpKTsKICAgICAgdmFyIF9jcmVhdGVDbGFzczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfY3JlYXRlQ2xhc3MoKSk7CiAgICAgIHZhciBfZGVmaW5lUHJvcGVydHkyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2RlZmluZVByb3BlcnR5KCkpOwogICAgICB2YXIgX21hcCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9tYXA0KCkpOwogICAgICB2YXIgX2NvbnN0YW50cyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9jb25zdGFudHMyKCkpOwogICAgICB2YXIgX2NvbnRleHQ7CiAgICAgIHZhciBTRVFSRVRfREVDT0RFUiA9ICgwLCBfbWFwLmRlZmF1bHQpKF9jb250ZXh0ID0gIj1BQ01HUlNWVFdZSEtEQk4iLnNwbGl0KCIiKSkuY2FsbChfY29udGV4dCwgZnVuY3Rpb24ocykgewogICAgICAgIHJldHVybiBzLmNoYXJDb2RlQXQoMCk7CiAgICAgIH0pOwogICAgICB2YXIgQ0lHQVJfREVDT0RFUiA9ICJNSUROU0hQPVg/Pz8/Pz8/Ii5zcGxpdCgiIik7CiAgICAgIHZhciBCYW1SZWNvcmQgPSAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24oKSB7CiAgICAgICAgZnVuY3Rpb24gQmFtUmVjb3JkMihhcmdzKSB7CiAgICAgICAgICAoMCwgX2NsYXNzQ2FsbENoZWNrMi5kZWZhdWx0KSh0aGlzLCBCYW1SZWNvcmQyKTsKICAgICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyLmRlZmF1bHQpKHRoaXMsICJkYXRhIiwgdm9pZCAwKTsKICAgICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyLmRlZmF1bHQpKHRoaXMsICJieXRlcyIsIHZvaWQgMCk7CiAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5Mi5kZWZhdWx0KSh0aGlzLCAiZmxhZ3MiLCB2b2lkIDApOwogICAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIuZGVmYXVsdCkodGhpcywgIl9pZCIsIHZvaWQgMCk7CiAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5Mi5kZWZhdWx0KSh0aGlzLCAiX3JlZklEIiwgdm9pZCAwKTsKICAgICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyLmRlZmF1bHQpKHRoaXMsICJfdGFnT2Zmc2V0Iiwgdm9pZCAwKTsKICAgICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyLmRlZmF1bHQpKHRoaXMsICJfdGFnTGlzdCIsIFtdKTsKICAgICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyLmRlZmF1bHQpKHRoaXMsICJfYWxsVGFnc1BhcnNlZCIsIGZhbHNlKTsKICAgICAgICAgIHRoaXMuZGF0YSA9IHt9OwogICAgICAgICAgdGhpcy5ieXRlcyA9IHsKICAgICAgICAgICAgc3RhcnQ6IGFyZ3MuYnl0ZXMuc3RhcnQsCiAgICAgICAgICAgIGVuZDogYXJncy5ieXRlcy5lbmQsCiAgICAgICAgICAgIGJ5dGVBcnJheTogYXJncy5ieXRlcy5ieXRlQXJyYXkKICAgICAgICAgIH07CiAgICAgICAgICB0aGlzLl9pZCA9IGFyZ3MuZmlsZU9mZnNldDsKICAgICAgICAgIHZhciBfdGhpcyRieXRlcyA9IHRoaXMuYnl0ZXMsIHN0YXJ0ID0gX3RoaXMkYnl0ZXMuc3RhcnQsIGJ5dGVBcnJheSA9IF90aGlzJGJ5dGVzLmJ5dGVBcnJheTsKICAgICAgICAgIHRoaXMuX3JlZklEID0gYnl0ZUFycmF5LnJlYWRJbnQzMkxFKHN0YXJ0ICsgNCk7CiAgICAgICAgICB0aGlzLmRhdGEuc3RhcnQgPSBieXRlQXJyYXkucmVhZEludDMyTEUoc3RhcnQgKyA4KTsKICAgICAgICAgIHRoaXMuZmxhZ3MgPSAoYnl0ZUFycmF5LnJlYWRJbnQzMkxFKHN0YXJ0ICsgMTYpICYgNDI5NDkwMTc2MCkgPj4gMTY7CiAgICAgICAgfQogICAgICAgICgwLCBfY3JlYXRlQ2xhc3MyLmRlZmF1bHQpKEJhbVJlY29yZDIsIFt7CiAgICAgICAgICBrZXk6ICJnZXQiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldDIoZmllbGQpIHsKICAgICAgICAgICAgaWYgKHRoaXNbZmllbGRdKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuZGF0YVtmaWVsZF0pIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRhdGFbZmllbGRdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLmRhdGFbZmllbGRdID0gdGhpc1tmaWVsZF0oKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRhW2ZpZWxkXTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0KGZpZWxkLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImVuZCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZW5kKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXQoInN0YXJ0IikgKyAodGhpcy5nZXQoImxlbmd0aF9vbl9yZWYiKSB8fCB0aGlzLmdldCgic2VxX2xlbmd0aCIpIHx8IHZvaWQgMCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAic2VxX2lkIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXFfaWQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZWZJRDsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJfZ2V0IiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0KGZpZWxkKSB7CiAgICAgICAgICAgIGlmIChmaWVsZCBpbiB0aGlzLmRhdGEpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRhW2ZpZWxkXTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmRhdGFbZmllbGRdID0gdGhpcy5fcGFyc2VUYWcoZmllbGQpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRhW2ZpZWxkXTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJfdGFncyIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX3RhZ3MoKSB7CiAgICAgICAgICAgIHZhciBfY29udGV4dDIsIF90aGlzID0gdGhpczsKICAgICAgICAgICAgdGhpcy5fcGFyc2VBbGxUYWdzKCk7CiAgICAgICAgICAgIHZhciB0YWdzID0gWyJzZXEiXTsKICAgICAgICAgICAgaWYgKCF0aGlzLmlzU2VnbWVudFVubWFwcGVkKCkpIHsKICAgICAgICAgICAgICB0YWdzLnB1c2goInN0YXJ0IiwgImVuZCIsICJzdHJhbmQiLCAic2NvcmUiLCAicXVhbCIsICJNUSIsICJDSUdBUiIsICJsZW5ndGhfb25fcmVmIiwgInRlbXBsYXRlX2xlbmd0aCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLmlzUGFpcmVkKCkpIHsKICAgICAgICAgICAgICB0YWdzLnB1c2goIm5leHRfc2VnbWVudF9wb3NpdGlvbiIsICJwYWlyX29yaWVudGF0aW9uIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGFncyA9ICgwLCBfY29uY2F0LmRlZmF1bHQpKHRhZ3MpLmNhbGwodGFncywgdGhpcy5fdGFnTGlzdCB8fCBbXSk7CiAgICAgICAgICAgICgwLCBfZm9yRWFjaC5kZWZhdWx0KShfY29udGV4dDIgPSAoMCwgX2tleXMuZGVmYXVsdCkodGhpcy5kYXRhKSkuY2FsbChfY29udGV4dDIsIGZ1bmN0aW9uKGspIHsKICAgICAgICAgICAgICBpZiAoa1swXSAhPT0gIl8iICYmIGsgIT09ICJuZXh0X3NlcV9pZCIpIHsKICAgICAgICAgICAgICAgIHRhZ3MucHVzaChrKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgc2VlbiA9IHt9OwogICAgICAgICAgICB0YWdzID0gKDAsIF9maWx0ZXIuZGVmYXVsdCkodGFncykuY2FsbCh0YWdzLCBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgaWYgKHQgaW4gX3RoaXMuZGF0YSAmJiBfdGhpcy5kYXRhW3RdID09PSB2b2lkIDAgfHwgdCA9PT0gIkNHIiB8fCB0ID09PSAiY2ciKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHZhciBsdCA9IHQudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICB2YXIgcyA9IHNlZW5bbHRdOwogICAgICAgICAgICAgIHNlZW5bbHRdID0gdHJ1ZTsKICAgICAgICAgICAgICByZXR1cm4gIXM7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gdGFnczsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJwYXJlbnQiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHBhcmVudCgpIHsKICAgICAgICAgICAgcmV0dXJuIHZvaWQgMDsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJjaGlsZHJlbiIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY2hpbGRyZW4oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldCgic3ViZmVhdHVyZXMiKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJpZCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaWQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pZDsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJtcSIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gbXEoKSB7CiAgICAgICAgICAgIHZhciBtcTIgPSAodGhpcy5nZXQoIl9iaW5fbXFfbmwiKSAmIDY1MjgwKSA+PiA4OwogICAgICAgICAgICByZXR1cm4gbXEyID09PSAyNTUgPyB2b2lkIDAgOiBtcTI7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAic2NvcmUiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNjb3JlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXQoIm1xIik7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAicXVhbCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcXVhbCgpIHsKICAgICAgICAgICAgdmFyIF90aGlzJHF1YWxSYXc7CiAgICAgICAgICAgIHJldHVybiAoX3RoaXMkcXVhbFJhdyA9IHRoaXMucXVhbFJhdygpKSA9PT0gbnVsbCB8fCBfdGhpcyRxdWFsUmF3ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyRxdWFsUmF3LmpvaW4oIiAiKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJxdWFsUmF3IiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBxdWFsUmF3KCkgewogICAgICAgICAgICBpZiAodGhpcy5pc1NlZ21lbnRVbm1hcHBlZCgpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgMDsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgYnl0ZUFycmF5ID0gdGhpcy5ieXRlcy5ieXRlQXJyYXk7CiAgICAgICAgICAgIHZhciBwID0gdGhpcy5ieXRlcy5zdGFydCArIDM2ICsgdGhpcy5nZXQoIl9sX3JlYWRfbmFtZSIpICsgdGhpcy5nZXQoIl9uX2NpZ2FyX29wIikgKiA0ICsgdGhpcy5nZXQoIl9zZXFfYnl0ZXMiKTsKICAgICAgICAgICAgdmFyIGxzZXEgPSB0aGlzLmdldCgic2VxX2xlbmd0aCIpOwogICAgICAgICAgICB2YXIgcXNlcSA9IGltcG9ydF9idWZmZXIuQnVmZmVyLmFsbG9jVW5zYWZlKGxzZXEpOwogICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGxzZXE7ICsraikgewogICAgICAgICAgICAgIHFzZXFbal0gPSBieXRlQXJyYXlbcCArIGpdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBxc2VxOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInN0cmFuZCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc3RyYW5kKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5pc1JldmVyc2VDb21wbGVtZW50ZWQoKSA/IC0xIDogMTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJtdWx0aV9zZWdtZW50X25leHRfc2VnbWVudF9zdHJhbmQiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG11bHRpX3NlZ21lbnRfbmV4dF9zZWdtZW50X3N0cmFuZCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuaXNNYXRlVW5tYXBwZWQoKSkgewogICAgICAgICAgICAgIHJldHVybiB2b2lkIDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNNYXRlUmV2ZXJzZUNvbXBsZW1lbnRlZCgpID8gLTEgOiAxOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogIm5hbWUiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG5hbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldCgiX3JlYWRfbmFtZSIpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogIl9yZWFkX25hbWUiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9yZWFkX25hbWUoKSB7CiAgICAgICAgICAgIHZhciBubCA9IHRoaXMuZ2V0KCJfbF9yZWFkX25hbWUiKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZXMuYnl0ZUFycmF5LnRvU3RyaW5nKCJhc2NpaSIsIHRoaXMuYnl0ZXMuc3RhcnQgKyAzNiwgdGhpcy5ieXRlcy5zdGFydCArIDM2ICsgbmwgLSAxKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJfcGFyc2VUYWciLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9wYXJzZVRhZyh0YWdOYW1lKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9hbGxUYWdzUGFyc2VkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgMDsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgYnl0ZUFycmF5ID0gdGhpcy5ieXRlcy5ieXRlQXJyYXk7CiAgICAgICAgICAgIHZhciBwID0gdGhpcy5fdGFnT2Zmc2V0IHx8IHRoaXMuYnl0ZXMuc3RhcnQgKyAzNiArIHRoaXMuZ2V0KCJfbF9yZWFkX25hbWUiKSArIHRoaXMuZ2V0KCJfbl9jaWdhcl9vcCIpICogNCArIHRoaXMuZ2V0KCJfc2VxX2J5dGVzIikgKyB0aGlzLmdldCgic2VxX2xlbmd0aCIpOwogICAgICAgICAgICB2YXIgYmxvY2tFbmQgPSB0aGlzLmJ5dGVzLmVuZDsKICAgICAgICAgICAgdmFyIGxjVGFnOwogICAgICAgICAgICB3aGlsZSAocCA8IGJsb2NrRW5kICYmIGxjVGFnICE9PSB0YWdOYW1lKSB7CiAgICAgICAgICAgICAgdmFyIHRhZyA9IFN0cmluZy5mcm9tQ2hhckNvZGUoYnl0ZUFycmF5W3BdLCBieXRlQXJyYXlbcCArIDFdKTsKICAgICAgICAgICAgICBsY1RhZyA9IHRhZy50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgIHZhciB0eXBlID0gU3RyaW5nLmZyb21DaGFyQ29kZShieXRlQXJyYXlbcCArIDJdKTsKICAgICAgICAgICAgICBwICs9IDM7CiAgICAgICAgICAgICAgdmFyIHZhbHVlID0gdm9pZCAwOwogICAgICAgICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSAiQSI6CiAgICAgICAgICAgICAgICAgIHZhbHVlID0gU3RyaW5nLmZyb21DaGFyQ29kZShieXRlQXJyYXlbcF0pOwogICAgICAgICAgICAgICAgICBwICs9IDE7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiaSI6CiAgICAgICAgICAgICAgICAgIHZhbHVlID0gYnl0ZUFycmF5LnJlYWRJbnQzMkxFKHApOwogICAgICAgICAgICAgICAgICBwICs9IDQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiSSI6CiAgICAgICAgICAgICAgICAgIHZhbHVlID0gYnl0ZUFycmF5LnJlYWRVSW50MzJMRShwKTsKICAgICAgICAgICAgICAgICAgcCArPSA0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgImMiOgogICAgICAgICAgICAgICAgICB2YWx1ZSA9IGJ5dGVBcnJheS5yZWFkSW50OChwKTsKICAgICAgICAgICAgICAgICAgcCArPSAxOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgIkMiOgogICAgICAgICAgICAgICAgICB2YWx1ZSA9IGJ5dGVBcnJheS5yZWFkVUludDgocCk7CiAgICAgICAgICAgICAgICAgIHAgKz0gMTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJzIjoKICAgICAgICAgICAgICAgICAgdmFsdWUgPSBieXRlQXJyYXkucmVhZEludDE2TEUocCk7CiAgICAgICAgICAgICAgICAgIHAgKz0gMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJTIjoKICAgICAgICAgICAgICAgICAgdmFsdWUgPSBieXRlQXJyYXkucmVhZFVJbnQxNkxFKHApOwogICAgICAgICAgICAgICAgICBwICs9IDI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiZiI6CiAgICAgICAgICAgICAgICAgIHZhbHVlID0gYnl0ZUFycmF5LnJlYWRGbG9hdExFKHApOwogICAgICAgICAgICAgICAgICBwICs9IDQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiWiI6CiAgICAgICAgICAgICAgICBjYXNlICJIIjoKICAgICAgICAgICAgICAgICAgdmFsdWUgPSAiIjsKICAgICAgICAgICAgICAgICAgd2hpbGUgKHAgPD0gYmxvY2tFbmQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY2MgPSBieXRlQXJyYXlbcCsrXTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2MgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNjKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJCIjogewogICAgICAgICAgICAgICAgICB2YWx1ZSA9ICIiOwogICAgICAgICAgICAgICAgICB2YXIgX2NjID0gYnl0ZUFycmF5W3ArK107CiAgICAgICAgICAgICAgICAgIHZhciBCdHlwZSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoX2NjKTsKICAgICAgICAgICAgICAgICAgdmFyIGxpbWl0ID0gYnl0ZUFycmF5LnJlYWRJbnQzMkxFKHApOwogICAgICAgICAgICAgICAgICBwICs9IDQ7CiAgICAgICAgICAgICAgICAgIGlmIChCdHlwZSA9PT0gImkiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRhZyA9PT0gIkNHIikgewogICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBsaW1pdDsgaysrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaWdvcCA9IGJ5dGVBcnJheS5yZWFkSW50MzJMRShwKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxvcCA9IGNpZ29wID4+IDQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvcCA9IENJR0FSX0RFQ09ERVJbY2lnb3AgJiAxNV07CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICs9IGxvcCArIG9wOwogICAgICAgICAgICAgICAgICAgICAgICBwICs9IDQ7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9rID0gMDsgX2sgPCBsaW1pdDsgX2srKykgewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSBieXRlQXJyYXkucmVhZEludDMyTEUocCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfayArIDEgPCBsaW1pdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICs9ICIsIjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBwICs9IDQ7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChCdHlwZSA9PT0gIkkiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRhZyA9PT0gIkNHIikgewogICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2syID0gMDsgX2syIDwgbGltaXQ7IF9rMisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfY2lnb3AgPSBieXRlQXJyYXkucmVhZFVJbnQzMkxFKHApOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgX2xvcCA9IF9jaWdvcCA+PiA0OwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgX29wID0gQ0lHQVJfREVDT0RFUltfY2lnb3AgJiAxNV07CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICs9IF9sb3AgKyBfb3A7CiAgICAgICAgICAgICAgICAgICAgICAgIHAgKz0gNDsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2szID0gMDsgX2szIDwgbGltaXQ7IF9rMysrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICs9IGJ5dGVBcnJheS5yZWFkVUludDMyTEUocCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfazMgKyAxIDwgbGltaXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSAiLCI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcCArPSA0OwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoQnR5cGUgPT09ICJzIikgewogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9rNCA9IDA7IF9rNCA8IGxpbWl0OyBfazQrKykgewogICAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gYnl0ZUFycmF5LnJlYWRJbnQxNkxFKHApOwogICAgICAgICAgICAgICAgICAgICAgaWYgKF9rNCArIDEgPCBsaW1pdCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSAiLCI7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBwICs9IDI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChCdHlwZSA9PT0gIlMiKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2s1ID0gMDsgX2s1IDwgbGltaXQ7IF9rNSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSBieXRlQXJyYXkucmVhZFVJbnQxNkxFKHApOwogICAgICAgICAgICAgICAgICAgICAgaWYgKF9rNSArIDEgPCBsaW1pdCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSAiLCI7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBwICs9IDI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChCdHlwZSA9PT0gImMiKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2s2ID0gMDsgX2s2IDwgbGltaXQ7IF9rNisrKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSBieXRlQXJyYXkucmVhZEludDgocCk7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoX2s2ICsgMSA8IGxpbWl0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICs9ICIsIjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHAgKz0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaWYgKEJ0eXBlID09PSAiQyIpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBfazcgPSAwOyBfazcgPCBsaW1pdDsgX2s3KyspIHsKICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICs9IGJ5dGVBcnJheS5yZWFkVUludDgocCk7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoX2s3ICsgMSA8IGxpbWl0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICs9ICIsIjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHAgKz0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaWYgKEJ0eXBlID09PSAiZiIpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBfazggPSAwOyBfazggPCBsaW1pdDsgX2s4KyspIHsKICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICs9IGJ5dGVBcnJheS5yZWFkRmxvYXRMRShwKTsKICAgICAgICAgICAgICAgICAgICAgIGlmIChfazggKyAxIDwgbGltaXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gIiwiOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcCArPSA0OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5rbm93biBCQU0gdGFnIHR5cGUgJyIuY29uY2F0KHR5cGUsICInLCB0YWdzIG1heSBiZSBpbmNvbXBsZXRlIikpOwogICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZvaWQgMDsKICAgICAgICAgICAgICAgICAgcCA9IGJsb2NrRW5kOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLl90YWdPZmZzZXQgPSBwOwogICAgICAgICAgICAgIHRoaXMuX3RhZ0xpc3QucHVzaCh0YWcpOwogICAgICAgICAgICAgIGlmIChsY1RhZyA9PT0gdGFnTmFtZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLmRhdGFbbGNUYWddID0gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fYWxsVGFnc1BhcnNlZCA9IHRydWU7CiAgICAgICAgICAgIHJldHVybiB2b2lkIDA7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiX3BhcnNlQWxsVGFncyIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX3BhcnNlQWxsVGFncygpIHsKICAgICAgICAgICAgdGhpcy5fcGFyc2VUYWcoIiIpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogIl9wYXJzZUNpZ2FyIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfcGFyc2VDaWdhcihjaWdhcikgewogICAgICAgICAgICB2YXIgX2NvbnRleHQzOwogICAgICAgICAgICByZXR1cm4gKDAsIF9tYXAuZGVmYXVsdCkoX2NvbnRleHQzID0gY2lnYXIubWF0Y2goL1xkK1xEL2cpKS5jYWxsKF9jb250ZXh0MywgZnVuY3Rpb24ob3ApIHsKICAgICAgICAgICAgICByZXR1cm4gW29wLm1hdGNoKC9cRC8pWzBdLnRvVXBwZXJDYXNlKCksICgwLCBfcGFyc2VJbnQyLmRlZmF1bHQpKG9wLCAxMCldOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJpc1BhaXJlZCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaXNQYWlyZWQoKSB7CiAgICAgICAgICAgIHJldHVybiAhISgoMCwgX2ZsYWdzMi5kZWZhdWx0KSh0aGlzKSAmIF9jb25zdGFudHMuZGVmYXVsdC5CQU1fRlBBSVJFRCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiaXNQcm9wZXJseVBhaXJlZCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaXNQcm9wZXJseVBhaXJlZCgpIHsKICAgICAgICAgICAgcmV0dXJuICEhKCgwLCBfZmxhZ3MyLmRlZmF1bHQpKHRoaXMpICYgX2NvbnN0YW50cy5kZWZhdWx0LkJBTV9GUFJPUEVSX1BBSVIpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImlzU2VnbWVudFVubWFwcGVkIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBpc1NlZ21lbnRVbm1hcHBlZCgpIHsKICAgICAgICAgICAgcmV0dXJuICEhKCgwLCBfZmxhZ3MyLmRlZmF1bHQpKHRoaXMpICYgX2NvbnN0YW50cy5kZWZhdWx0LkJBTV9GVU5NQVApOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImlzTWF0ZVVubWFwcGVkIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBpc01hdGVVbm1hcHBlZCgpIHsKICAgICAgICAgICAgcmV0dXJuICEhKCgwLCBfZmxhZ3MyLmRlZmF1bHQpKHRoaXMpICYgX2NvbnN0YW50cy5kZWZhdWx0LkJBTV9GTVVOTUFQKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJpc1JldmVyc2VDb21wbGVtZW50ZWQiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGlzUmV2ZXJzZUNvbXBsZW1lbnRlZCgpIHsKICAgICAgICAgICAgcmV0dXJuICEhKCgwLCBfZmxhZ3MyLmRlZmF1bHQpKHRoaXMpICYgX2NvbnN0YW50cy5kZWZhdWx0LkJBTV9GUkVWRVJTRSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiaXNNYXRlUmV2ZXJzZUNvbXBsZW1lbnRlZCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaXNNYXRlUmV2ZXJzZUNvbXBsZW1lbnRlZCgpIHsKICAgICAgICAgICAgcmV0dXJuICEhKCgwLCBfZmxhZ3MyLmRlZmF1bHQpKHRoaXMpICYgX2NvbnN0YW50cy5kZWZhdWx0LkJBTV9GTVJFVkVSU0UpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImlzUmVhZDEiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGlzUmVhZDEoKSB7CiAgICAgICAgICAgIHJldHVybiAhISgoMCwgX2ZsYWdzMi5kZWZhdWx0KSh0aGlzKSAmIF9jb25zdGFudHMuZGVmYXVsdC5CQU1fRlJFQUQxKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJpc1JlYWQyIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBpc1JlYWQyKCkgewogICAgICAgICAgICByZXR1cm4gISEoKDAsIF9mbGFnczIuZGVmYXVsdCkodGhpcykgJiBfY29uc3RhbnRzLmRlZmF1bHQuQkFNX0ZSRUFEMik7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiaXNTZWNvbmRhcnkiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGlzU2Vjb25kYXJ5KCkgewogICAgICAgICAgICByZXR1cm4gISEoKDAsIF9mbGFnczIuZGVmYXVsdCkodGhpcykgJiBfY29uc3RhbnRzLmRlZmF1bHQuQkFNX0ZTRUNPTkRBUlkpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImlzRmFpbGVkUWMiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGlzRmFpbGVkUWMoKSB7CiAgICAgICAgICAgIHJldHVybiAhISgoMCwgX2ZsYWdzMi5kZWZhdWx0KSh0aGlzKSAmIF9jb25zdGFudHMuZGVmYXVsdC5CQU1fRlFDRkFJTCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiaXNEdXBsaWNhdGUiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGlzRHVwbGljYXRlKCkgewogICAgICAgICAgICByZXR1cm4gISEoKDAsIF9mbGFnczIuZGVmYXVsdCkodGhpcykgJiBfY29uc3RhbnRzLmRlZmF1bHQuQkFNX0ZEVVApOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImlzU3VwcGxlbWVudGFyeSIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaXNTdXBwbGVtZW50YXJ5KCkgewogICAgICAgICAgICByZXR1cm4gISEoKDAsIF9mbGFnczIuZGVmYXVsdCkodGhpcykgJiBfY29uc3RhbnRzLmRlZmF1bHQuQkFNX0ZTVVBQTEVNRU5UQVJZKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJjaWdhciIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY2lnYXIoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmlzU2VnbWVudFVubWFwcGVkKCkpIHsKICAgICAgICAgICAgICByZXR1cm4gdm9pZCAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBfdGhpcyRieXRlczIgPSB0aGlzLmJ5dGVzLCBieXRlQXJyYXkgPSBfdGhpcyRieXRlczIuYnl0ZUFycmF5LCBzdGFydCA9IF90aGlzJGJ5dGVzMi5zdGFydDsKICAgICAgICAgICAgdmFyIG51bUNpZ2FyT3BzID0gdGhpcy5nZXQoIl9uX2NpZ2FyX29wIik7CiAgICAgICAgICAgIHZhciBwID0gc3RhcnQgKyAzNiArIHRoaXMuZ2V0KCJfbF9yZWFkX25hbWUiKTsKICAgICAgICAgICAgdmFyIHNlcUxlbiA9IHRoaXMuZ2V0KCJzZXFfbGVuZ3RoIik7CiAgICAgICAgICAgIHZhciBjaWdhcjIgPSAiIjsKICAgICAgICAgICAgdmFyIGxyZWYgPSAwOwogICAgICAgICAgICB2YXIgY2lnb3AgPSBieXRlQXJyYXkucmVhZEludDMyTEUocCk7CiAgICAgICAgICAgIHZhciBsb3AgPSBjaWdvcCA+PiA0OwogICAgICAgICAgICB2YXIgb3AgPSBDSUdBUl9ERUNPREVSW2NpZ29wICYgMTVdOwogICAgICAgICAgICBpZiAob3AgPT09ICJTIiAmJiBsb3AgPT09IHNlcUxlbikgewogICAgICAgICAgICAgIHAgKz0gNDsKICAgICAgICAgICAgICBjaWdvcCA9IGJ5dGVBcnJheS5yZWFkSW50MzJMRShwKTsKICAgICAgICAgICAgICBsb3AgPSBjaWdvcCA+PiA0OwogICAgICAgICAgICAgIG9wID0gQ0lHQVJfREVDT0RFUltjaWdvcCAmIDE1XTsKICAgICAgICAgICAgICBpZiAob3AgIT09ICJOIikgewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJDRyB0YWcgd2l0aCBubyBOIHRhZyIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLmRhdGEubGVuZ3RoX29uX3JlZiA9IGxvcDsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXQoIkNHIik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCBudW1DaWdhck9wczsgKytjKSB7CiAgICAgICAgICAgICAgICBjaWdvcCA9IGJ5dGVBcnJheS5yZWFkSW50MzJMRShwKTsKICAgICAgICAgICAgICAgIGxvcCA9IGNpZ29wID4+IDQ7CiAgICAgICAgICAgICAgICBvcCA9IENJR0FSX0RFQ09ERVJbY2lnb3AgJiAxNV07CiAgICAgICAgICAgICAgICBjaWdhcjIgKz0gbG9wICsgb3A7CiAgICAgICAgICAgICAgICBpZiAob3AgIT09ICJIIiAmJiBvcCAhPT0gIlMiICYmIG9wICE9PSAiSSIpIHsKICAgICAgICAgICAgICAgICAgbHJlZiArPSBsb3A7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwICs9IDQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMuZGF0YS5sZW5ndGhfb25fcmVmID0gbHJlZjsKICAgICAgICAgICAgICByZXR1cm4gY2lnYXIyOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiX2ZsYWdzIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZmxhZ3MoKSB7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAibGVuZ3RoX29uX3JlZiIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gbGVuZ3RoX29uX3JlZigpIHsKICAgICAgICAgICAgdGhpcy5nZXQoImNpZ2FyIik7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmRhdGEubGVuZ3RoX29uX3JlZjsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJfbl9jaWdhcl9vcCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX25fY2lnYXJfb3AoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldCgiX2ZsYWdfbmMiKSAmIDY1NTM1OwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogIl9sX3JlYWRfbmFtZSIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2xfcmVhZF9uYW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXQoIl9iaW5fbXFfbmwiKSAmIDI1NTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJfc2VxX2J5dGVzIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfc2VxX2J5dGVzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXQoInNlcV9sZW5ndGgiKSArIDEgPj4gMTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJnZXRSZWFkQmFzZXMiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFJlYWRCYXNlcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VxKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAic2VxIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXEoKSB7CiAgICAgICAgICAgIHZhciBieXRlQXJyYXkgPSB0aGlzLmJ5dGVzLmJ5dGVBcnJheTsKICAgICAgICAgICAgdmFyIHAgPSB0aGlzLmJ5dGVzLnN0YXJ0ICsgMzYgKyB0aGlzLmdldCgiX2xfcmVhZF9uYW1lIikgKyB0aGlzLmdldCgiX25fY2lnYXJfb3AiKSAqIDQ7CiAgICAgICAgICAgIHZhciBzZXFCeXRlcyA9IHRoaXMuZ2V0KCJfc2VxX2J5dGVzIik7CiAgICAgICAgICAgIHZhciBsZW4gPSB0aGlzLmdldCgic2VxX2xlbmd0aCIpOwogICAgICAgICAgICB2YXIgYnVmID0gIiI7CiAgICAgICAgICAgIHZhciBpID0gMDsKICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzZXFCeXRlczsgKytqKSB7CiAgICAgICAgICAgICAgdmFyIHNiID0gYnl0ZUFycmF5W3AgKyBqXTsKICAgICAgICAgICAgICBidWYgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShTRVFSRVRfREVDT0RFUlsoc2IgJiAyNDApID4+IDRdKTsKICAgICAgICAgICAgICBpKys7CiAgICAgICAgICAgICAgaWYgKGkgPCBsZW4pIHsKICAgICAgICAgICAgICAgIGJ1ZiArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKFNFUVJFVF9ERUNPREVSW3NiICYgMTVdKTsKICAgICAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGJ1ZjsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJnZXRQYWlyT3JpZW50YXRpb24iLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFBhaXJPcmllbnRhdGlvbigpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLmlzU2VnbWVudFVubWFwcGVkKCkgJiYgIXRoaXMuaXNNYXRlVW5tYXBwZWQoKSAmJiB0aGlzLl9yZWZJRCA9PT0gdGhpcy5fbmV4dF9yZWZpZCgpKSB7CiAgICAgICAgICAgICAgdmFyIHMxID0gdGhpcy5pc1JldmVyc2VDb21wbGVtZW50ZWQoKSA/ICJSIiA6ICJGIjsKICAgICAgICAgICAgICB2YXIgczIgPSB0aGlzLmlzTWF0ZVJldmVyc2VDb21wbGVtZW50ZWQoKSA/ICJSIiA6ICJGIjsKICAgICAgICAgICAgICB2YXIgbzEgPSAiICI7CiAgICAgICAgICAgICAgdmFyIG8yID0gIiAiOwogICAgICAgICAgICAgIGlmICh0aGlzLmlzUmVhZDEoKSkgewogICAgICAgICAgICAgICAgbzEgPSAiMSI7CiAgICAgICAgICAgICAgICBvMiA9ICIyIjsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaXNSZWFkMigpKSB7CiAgICAgICAgICAgICAgICBvMSA9ICIyIjsKICAgICAgICAgICAgICAgIG8yID0gIjEiOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB2YXIgdG1wID0gW107CiAgICAgICAgICAgICAgdmFyIGlzaXplID0gdGhpcy50ZW1wbGF0ZV9sZW5ndGgoKTsKICAgICAgICAgICAgICBpZiAoaXNpemUgPiAwKSB7CiAgICAgICAgICAgICAgICB0bXBbMF0gPSBzMTsKICAgICAgICAgICAgICAgIHRtcFsxXSA9IG8xOwogICAgICAgICAgICAgICAgdG1wWzJdID0gczI7CiAgICAgICAgICAgICAgICB0bXBbM10gPSBvMjsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdG1wWzJdID0gczE7CiAgICAgICAgICAgICAgICB0bXBbM10gPSBvMTsKICAgICAgICAgICAgICAgIHRtcFswXSA9IHMyOwogICAgICAgICAgICAgICAgdG1wWzFdID0gbzI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiB0bXAuam9pbigiIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiX2Jpbl9tcV9ubCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2Jpbl9tcV9ubCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZXMuYnl0ZUFycmF5LnJlYWRJbnQzMkxFKHRoaXMuYnl0ZXMuc3RhcnQgKyAxMik7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiX2ZsYWdfbmMiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9mbGFnX25jKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ieXRlcy5ieXRlQXJyYXkucmVhZEludDMyTEUodGhpcy5ieXRlcy5zdGFydCArIDE2KTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJzZXFfbGVuZ3RoIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXFfbGVuZ3RoKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ieXRlcy5ieXRlQXJyYXkucmVhZEludDMyTEUodGhpcy5ieXRlcy5zdGFydCArIDIwKTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJfbmV4dF9yZWZpZCIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX25leHRfcmVmaWQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmJ5dGVzLmJ5dGVBcnJheS5yZWFkSW50MzJMRSh0aGlzLmJ5dGVzLnN0YXJ0ICsgMjQpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogIl9uZXh0X3BvcyIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX25leHRfcG9zKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ieXRlcy5ieXRlQXJyYXkucmVhZEludDMyTEUodGhpcy5ieXRlcy5zdGFydCArIDI4KTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJ0ZW1wbGF0ZV9sZW5ndGgiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHRlbXBsYXRlX2xlbmd0aCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZXMuYnl0ZUFycmF5LnJlYWRJbnQzMkxFKHRoaXMuYnl0ZXMuc3RhcnQgKyAzMik7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAidG9KU09OIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiB0b0pTT04oKSB7CiAgICAgICAgICAgIHZhciBfY29udGV4dDQsIF90aGlzMiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBkYXRhID0ge307CiAgICAgICAgICAgICgwLCBfZm9yRWFjaC5kZWZhdWx0KShfY29udGV4dDQgPSAoMCwgX2tleXMuZGVmYXVsdCkodGhpcykpLmNhbGwoX2NvbnRleHQ0LCBmdW5jdGlvbihrKSB7CiAgICAgICAgICAgICAgaWYgKGsuY2hhckF0KDApID09PSAiXyIgfHwgayA9PT0gImJ5dGVzIikgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBkYXRhW2tdID0gX3RoaXMyW2tdOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgICAgICB9CiAgICAgICAgfV0pOwogICAgICAgIHJldHVybiBCYW1SZWNvcmQyOwogICAgICB9KCk7CiAgICAgIGV4cG9ydHMuZGVmYXVsdCA9IEJhbVJlY29yZDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy9pdGVyYWJsZVRvQXJyYXkuanMKICB2YXIgcmVxdWlyZV9pdGVyYWJsZVRvQXJyYXkgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9oZWxwZXJzL2l0ZXJhYmxlVG9BcnJheS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIF9TeW1ib2wgPSByZXF1aXJlX3N5bWJvbDUoKTsKICAgICAgdmFyIF9nZXRJdGVyYXRvck1ldGhvZCA9IHJlcXVpcmVfZ2V0X2l0ZXJhdG9yX21ldGhvZDUoKTsKICAgICAgdmFyIF9BcnJheSRmcm9tID0gcmVxdWlyZV9mcm9tNSgpOwogICAgICBmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHsKICAgICAgICBpZiAodHlwZW9mIF9TeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIF9nZXRJdGVyYXRvck1ldGhvZChpdGVyKSAhPSBudWxsIHx8IGl0ZXJbIkBAaXRlcmF0b3IiXSAhPSBudWxsKQogICAgICAgICAgcmV0dXJuIF9BcnJheSRmcm9tKGl0ZXIpOwogICAgICB9CiAgICAgIG1vZHVsZS5leHBvcnRzID0gX2l0ZXJhYmxlVG9BcnJheTsKICAgICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvaGVscGVycy90b0FycmF5LmpzCiAgdmFyIHJlcXVpcmVfdG9BcnJheSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2hlbHBlcnMvdG9BcnJheS5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGFycmF5V2l0aEhvbGVzID0gcmVxdWlyZV9hcnJheVdpdGhIb2xlcygpOwogICAgICB2YXIgaXRlcmFibGVUb0FycmF5ID0gcmVxdWlyZV9pdGVyYWJsZVRvQXJyYXkoKTsKICAgICAgdmFyIHVuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5ID0gcmVxdWlyZV91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheSgpOwogICAgICB2YXIgbm9uSXRlcmFibGVSZXN0ID0gcmVxdWlyZV9ub25JdGVyYWJsZVJlc3QoKTsKICAgICAgZnVuY3Rpb24gX3RvQXJyYXkoYXJyKSB7CiAgICAgICAgcmV0dXJuIGFycmF5V2l0aEhvbGVzKGFycikgfHwgaXRlcmFibGVUb0FycmF5KGFycikgfHwgdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBub25JdGVyYWJsZVJlc3QoKTsKICAgICAgfQogICAgICBtb2R1bGUuZXhwb3J0cyA9IF90b0FycmF5OwogICAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGdtb2QvYmFtL2Rpc3Qvc2FtLmpzCiAgdmFyIHJlcXVpcmVfc2FtID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BnbW9kL2JhbS9kaXN0L3NhbS5qcyIoZXhwb3J0cykgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlX2ludGVyb3BSZXF1aXJlRGVmYXVsdCgpOwogICAgICB2YXIgX09iamVjdCRkZWZpbmVQcm9wZXJ0eSA9IHJlcXVpcmVfZGVmaW5lX3Byb3BlcnR5MygpOwogICAgICBfT2JqZWN0JGRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICAgIHZhbHVlOiB0cnVlCiAgICAgIH0pOwogICAgICBleHBvcnRzLnBhcnNlSGVhZGVyVGV4dCA9IHBhcnNlSGVhZGVyVGV4dDsKICAgICAgdmFyIF9zbGljZWRUb0FycmF5MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9zbGljZWRUb0FycmF5KCkpOwogICAgICB2YXIgX21hcCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9tYXA0KCkpOwogICAgICB2YXIgX3NsaWNlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX3NsaWNlNigpKTsKICAgICAgdmFyIF90b0FycmF5MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV90b0FycmF5KCkpOwogICAgICB2YXIgX2ZvckVhY2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfZm9yX2VhY2g0KCkpOwogICAgICBmdW5jdGlvbiBwYXJzZUhlYWRlclRleHQodGV4dCkgewogICAgICAgIHZhciBsaW5lcyA9IHRleHQuc3BsaXQoL1xyP1xuLyk7CiAgICAgICAgdmFyIGRhdGEgPSBbXTsKICAgICAgICAoMCwgX2ZvckVhY2guZGVmYXVsdCkobGluZXMpLmNhbGwobGluZXMsIGZ1bmN0aW9uKGxpbmUpIHsKICAgICAgICAgIHZhciBfbGluZSRzcGxpdCA9IGxpbmUuc3BsaXQoL1x0LyksIF9saW5lJHNwbGl0MiA9ICgwLCBfdG9BcnJheTIuZGVmYXVsdCkoX2xpbmUkc3BsaXQpLCB0YWcgPSBfbGluZSRzcGxpdDJbMF0sIGZpZWxkcyA9ICgwLCBfc2xpY2UuZGVmYXVsdCkoX2xpbmUkc3BsaXQyKS5jYWxsKF9saW5lJHNwbGl0MiwgMSk7CiAgICAgICAgICB2YXIgcGFyc2VkRmllbGRzID0gKDAsIF9tYXAuZGVmYXVsdCkoZmllbGRzKS5jYWxsKGZpZWxkcywgZnVuY3Rpb24oZikgewogICAgICAgICAgICB2YXIgX2Ykc3BsaXQgPSBmLnNwbGl0KCI6IiwgMiksIF9mJHNwbGl0MiA9ICgwLCBfc2xpY2VkVG9BcnJheTIuZGVmYXVsdCkoX2Ykc3BsaXQsIDIpLCBmaWVsZFRhZyA9IF9mJHNwbGl0MlswXSwgdmFsdWUgPSBfZiRzcGxpdDJbMV07CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgdGFnOiBmaWVsZFRhZywKICAgICAgICAgICAgICB2YWx1ZQogICAgICAgICAgICB9OwogICAgICAgICAgfSk7CiAgICAgICAgICBpZiAodGFnKSB7CiAgICAgICAgICAgIGRhdGEucHVzaCh7CiAgICAgICAgICAgICAgdGFnOiB0YWcuc3Vic3RyKDEpLAogICAgICAgICAgICAgIGRhdGE6IHBhcnNlZEZpZWxkcwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgfQogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGdtb2QvYmFtL2Rpc3QvYmFtRmlsZS5qcwogIHZhciByZXF1aXJlX2JhbUZpbGUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGdtb2QvYmFtL2Rpc3QvYmFtRmlsZS5qcyIoZXhwb3J0cykgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlX2ludGVyb3BSZXF1aXJlRGVmYXVsdCgpOwogICAgICB2YXIgX09iamVjdCRkZWZpbmVQcm9wZXJ0eSA9IHJlcXVpcmVfZGVmaW5lX3Byb3BlcnR5MygpOwogICAgICBfT2JqZWN0JGRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICAgIHZhbHVlOiB0cnVlCiAgICAgIH0pOwogICAgICBleHBvcnRzLmRlZmF1bHQgPSBleHBvcnRzLkJBTV9NQUdJQyA9IHZvaWQgMDsKICAgICAgdmFyIF9ub3cgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfbm93MygpKTsKICAgICAgdmFyIF9zb3J0ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX3NvcnQ0KCkpOwogICAgICB2YXIgX2ZpbHRlciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9maWx0ZXI0KCkpOwogICAgICB2YXIgX3NsaWNlZFRvQXJyYXkyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX3NsaWNlZFRvQXJyYXkoKSk7CiAgICAgIHZhciBfZm9yRWFjaCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9mb3JfZWFjaDQoKSk7CiAgICAgIHZhciBfcHJvbWlzZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9wcm9taXNlNSgpKTsKICAgICAgdmFyIF9tYXAgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfbWFwNCgpKTsKICAgICAgdmFyIF9yZWR1Y2UgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfcmVkdWNlNCgpKTsKICAgICAgdmFyIF9jb25jYXQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfY29uY2F0NCgpKTsKICAgICAgdmFyIF9yZWdlbmVyYXRvciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9yZWdlbmVyYXRvcigpKTsKICAgICAgdmFyIF9zbGljZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9zbGljZTYoKSk7CiAgICAgIHZhciBfYXN5bmNUb0dlbmVyYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfYXN5bmNUb0dlbmVyYXRvcigpKTsKICAgICAgdmFyIF9iaW5kID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2JpbmQ0KCkpOwogICAgICB2YXIgX2NsYXNzQ2FsbENoZWNrMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9jbGFzc0NhbGxDaGVjaygpKTsKICAgICAgdmFyIF9jcmVhdGVDbGFzczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfY3JlYXRlQ2xhc3MoKSk7CiAgICAgIHZhciBfZGVmaW5lUHJvcGVydHkyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2RlZmluZVByb3BlcnR5KCkpOwogICAgICB2YXIgX3dyYXBBc3luY0dlbmVyYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfd3JhcEFzeW5jR2VuZXJhdG9yKCkpOwogICAgICB2YXIgX2F3YWl0QXN5bmNHZW5lcmF0b3IyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2F3YWl0QXN5bmNHZW5lcmF0b3IoKSk7CiAgICAgIHZhciBfYXN5bmNHZW5lcmF0b3JEZWxlZ2F0ZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfYXN5bmNHZW5lcmF0b3JEZWxlZ2F0ZSgpKTsKICAgICAgdmFyIF9hc3luY0l0ZXJhdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9hc3luY0l0ZXJhdG9yKCkpOwogICAgICB2YXIgX2Fib3J0YWJsZVByb21pc2VDYWNoZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9kaXN0KCkpOwogICAgICB2YXIgX2JhaSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9iYWkoKSk7CiAgICAgIHZhciBfY3NpID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2NzaSgpKTsKICAgICAgdmFyIF9idWZmZXJDcmMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfYnVmZmVyX2NyYzMyKCkpOwogICAgICB2YXIgX2JnemZGaWxlaGFuZGxlID0gcmVxdWlyZV9kaXN0MigpOwogICAgICB2YXIgX29iamVjdCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9vYmplY3QoKSk7CiAgICAgIHZhciBfcXVpY2tMcnUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfcXVpY2tfbHJ1KCkpOwogICAgICB2YXIgX2dlbmVyaWNGaWxlaGFuZGxlID0gcmVxdWlyZV9kaXN0MygpOwogICAgICB2YXIgX3JlY29yZCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9yZWNvcmQoKSk7CiAgICAgIHZhciBfc2FtID0gcmVxdWlyZV9zYW0oKTsKICAgICAgdmFyIF91dGlsID0gcmVxdWlyZV91dGlsKCk7CiAgICAgIHZhciBCQU1fTUFHSUMgPSAyMTg0MDE5NDsKICAgICAgZXhwb3J0cy5CQU1fTUFHSUMgPSBCQU1fTUFHSUM7CiAgICAgIHZhciBibG9ja0xlbiA9IDEgPDwgMTY7CiAgICAgIHZhciBCYW1GaWxlMiA9IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbigpIHsKICAgICAgICBmdW5jdGlvbiBCYW1GaWxlMyhfcmVmKSB7CiAgICAgICAgICB2YXIgX2NvbnRleHQ7CiAgICAgICAgICB2YXIgYmFtRmlsZWhhbmRsZSA9IF9yZWYuYmFtRmlsZWhhbmRsZSwgYmFtUGF0aCA9IF9yZWYuYmFtUGF0aCwgYmFtVXJsID0gX3JlZi5iYW1VcmwsIGJhaVBhdGggPSBfcmVmLmJhaVBhdGgsIGJhaUZpbGVoYW5kbGUgPSBfcmVmLmJhaUZpbGVoYW5kbGUsIGJhaVVybCA9IF9yZWYuYmFpVXJsLCBjc2lQYXRoID0gX3JlZi5jc2lQYXRoLCBjc2lGaWxlaGFuZGxlID0gX3JlZi5jc2lGaWxlaGFuZGxlLCBjc2lVcmwgPSBfcmVmLmNzaVVybCwgY2FjaGVTaXplID0gX3JlZi5jYWNoZVNpemUsIGZldGNoU2l6ZUxpbWl0ID0gX3JlZi5mZXRjaFNpemVMaW1pdCwgY2h1bmtTaXplTGltaXQgPSBfcmVmLmNodW5rU2l6ZUxpbWl0LCBfcmVmJHlpZWxkVGhyZWFkVGltZSA9IF9yZWYueWllbGRUaHJlYWRUaW1lLCB5aWVsZFRocmVhZFRpbWUgPSBfcmVmJHlpZWxkVGhyZWFkVGltZSA9PT0gdm9pZCAwID8gMTAwIDogX3JlZiR5aWVsZFRocmVhZFRpbWUsIF9yZWYkcmVuYW1lUmVmU2VxcyA9IF9yZWYucmVuYW1lUmVmU2VxcywgcmVuYW1lUmVmU2VxcyA9IF9yZWYkcmVuYW1lUmVmU2VxcyA9PT0gdm9pZCAwID8gZnVuY3Rpb24obikgewogICAgICAgICAgICByZXR1cm4gbjsKICAgICAgICAgIH0gOiBfcmVmJHJlbmFtZVJlZlNlcXM7CiAgICAgICAgICAoMCwgX2NsYXNzQ2FsbENoZWNrMi5kZWZhdWx0KSh0aGlzLCBCYW1GaWxlMyk7CiAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5Mi5kZWZhdWx0KSh0aGlzLCAicmVuYW1lUmVmU2VxIiwgdm9pZCAwKTsKICAgICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyLmRlZmF1bHQpKHRoaXMsICJiYW0iLCB2b2lkIDApOwogICAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIuZGVmYXVsdCkodGhpcywgImluZGV4Iiwgdm9pZCAwKTsKICAgICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyLmRlZmF1bHQpKHRoaXMsICJjaHVua1NpemVMaW1pdCIsIHZvaWQgMCk7CiAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5Mi5kZWZhdWx0KSh0aGlzLCAiZmV0Y2hTaXplTGltaXQiLCB2b2lkIDApOwogICAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIuZGVmYXVsdCkodGhpcywgImhlYWRlciIsIHZvaWQgMCk7CiAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5Mi5kZWZhdWx0KSh0aGlzLCAiZmVhdHVyZUNhY2hlIiwgdm9pZCAwKTsKICAgICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyLmRlZmF1bHQpKHRoaXMsICJjaHJUb0luZGV4Iiwgdm9pZCAwKTsKICAgICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyLmRlZmF1bHQpKHRoaXMsICJpbmRleFRvQ2hyIiwgdm9pZCAwKTsKICAgICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyLmRlZmF1bHQpKHRoaXMsICJ5aWVsZFRocmVhZFRpbWUiLCB2b2lkIDApOwogICAgICAgICAgdGhpcy5yZW5hbWVSZWZTZXEgPSByZW5hbWVSZWZTZXFzOwogICAgICAgICAgaWYgKGJhbUZpbGVoYW5kbGUpIHsKICAgICAgICAgICAgdGhpcy5iYW0gPSBiYW1GaWxlaGFuZGxlOwogICAgICAgICAgfSBlbHNlIGlmIChiYW1QYXRoKSB7CiAgICAgICAgICAgIHRoaXMuYmFtID0gbmV3IF9nZW5lcmljRmlsZWhhbmRsZS5Mb2NhbEZpbGUoYmFtUGF0aCk7CiAgICAgICAgICB9IGVsc2UgaWYgKGJhbVVybCkgewogICAgICAgICAgICB0aGlzLmJhbSA9IG5ldyBfZ2VuZXJpY0ZpbGVoYW5kbGUuUmVtb3RlRmlsZShiYW1VcmwpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ1bmFibGUgdG8gaW5pdGlhbGl6ZSBiYW0iKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChjc2lGaWxlaGFuZGxlKSB7CiAgICAgICAgICAgIHRoaXMuaW5kZXggPSBuZXcgX2NzaS5kZWZhdWx0KHsKICAgICAgICAgICAgICBmaWxlaGFuZGxlOiBjc2lGaWxlaGFuZGxlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChjc2lQYXRoKSB7CiAgICAgICAgICAgIHRoaXMuaW5kZXggPSBuZXcgX2NzaS5kZWZhdWx0KHsKICAgICAgICAgICAgICBmaWxlaGFuZGxlOiBuZXcgX2dlbmVyaWNGaWxlaGFuZGxlLkxvY2FsRmlsZShjc2lQYXRoKQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoY3NpVXJsKSB7CiAgICAgICAgICAgIHRoaXMuaW5kZXggPSBuZXcgX2NzaS5kZWZhdWx0KHsKICAgICAgICAgICAgICBmaWxlaGFuZGxlOiBuZXcgX2dlbmVyaWNGaWxlaGFuZGxlLlJlbW90ZUZpbGUoY3NpVXJsKQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoYmFpRmlsZWhhbmRsZSkgewogICAgICAgICAgICB0aGlzLmluZGV4ID0gbmV3IF9iYWkuZGVmYXVsdCh7CiAgICAgICAgICAgICAgZmlsZWhhbmRsZTogYmFpRmlsZWhhbmRsZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoYmFpUGF0aCkgewogICAgICAgICAgICB0aGlzLmluZGV4ID0gbmV3IF9iYWkuZGVmYXVsdCh7CiAgICAgICAgICAgICAgZmlsZWhhbmRsZTogbmV3IF9nZW5lcmljRmlsZWhhbmRsZS5Mb2NhbEZpbGUoYmFpUGF0aCkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKGJhaVVybCkgewogICAgICAgICAgICB0aGlzLmluZGV4ID0gbmV3IF9iYWkuZGVmYXVsdCh7CiAgICAgICAgICAgICAgZmlsZWhhbmRsZTogbmV3IF9nZW5lcmljRmlsZWhhbmRsZS5SZW1vdGVGaWxlKGJhaVVybCkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKGJhbVBhdGgpIHsKICAgICAgICAgICAgdGhpcy5pbmRleCA9IG5ldyBfYmFpLmRlZmF1bHQoewogICAgICAgICAgICAgIGZpbGVoYW5kbGU6IG5ldyBfZ2VuZXJpY0ZpbGVoYW5kbGUuTG9jYWxGaWxlKCIiLmNvbmNhdChiYW1QYXRoLCAiLmJhaSIpKQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoYmFtVXJsKSB7CiAgICAgICAgICAgIHRoaXMuaW5kZXggPSBuZXcgX2JhaS5kZWZhdWx0KHsKICAgICAgICAgICAgICBmaWxlaGFuZGxlOiBuZXcgX2dlbmVyaWNGaWxlaGFuZGxlLlJlbW90ZUZpbGUoIiIuY29uY2F0KGJhbVVybCwgIi5iYWkiKSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInVuYWJsZSB0byBpbmZlciBpbmRleCBmb3JtYXQiKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuZmVhdHVyZUNhY2hlID0gbmV3IF9hYm9ydGFibGVQcm9taXNlQ2FjaGUuZGVmYXVsdCh7CiAgICAgICAgICAgIGNhY2hlOiBuZXcgX3F1aWNrTHJ1LmRlZmF1bHQoewogICAgICAgICAgICAgIG1heFNpemU6IGNhY2hlU2l6ZSAhPT0gdm9pZCAwID8gY2FjaGVTaXplIDogNTAKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIGZpbGw6ICgwLCBfYmluZC5kZWZhdWx0KShfY29udGV4dCA9IHRoaXMuX3JlYWRDaHVuaykuY2FsbChfY29udGV4dCwgdGhpcykKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5mZXRjaFNpemVMaW1pdCA9IGZldGNoU2l6ZUxpbWl0IHx8IDVlODsKICAgICAgICAgIHRoaXMuY2h1bmtTaXplTGltaXQgPSBjaHVua1NpemVMaW1pdCB8fCAzZTg7CiAgICAgICAgICB0aGlzLnlpZWxkVGhyZWFkVGltZSA9IHlpZWxkVGhyZWFkVGltZTsKICAgICAgICB9CiAgICAgICAgKDAsIF9jcmVhdGVDbGFzczIuZGVmYXVsdCkoQmFtRmlsZTMsIFt7CiAgICAgICAgICBrZXk6ICJnZXRIZWFkZXIiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgX2dldEhlYWRlciA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvci5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICAgICAgICB2YXIgb3JpZ09wdHMsIG9wdHMsIGluZGV4RGF0YSwgcmV0LCBidWZmZXIsIHJlcywgYnl0ZXNSZWFkLCB1bmNiYSwgaGVhZExlbiwgX3lpZWxkJHRoaXMkX3JlYWRSZWZTLCBjaHJUb0luZGV4LCBpbmRleFRvQ2hyLCBfYXJncyA9IGFyZ3VtZW50czsKICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dDIpIHsKICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIG9yaWdPcHRzID0gX2FyZ3MubGVuZ3RoID4gMCAmJiBfYXJnc1swXSAhPT0gdm9pZCAwID8gX2FyZ3NbMF0gOiB7fTsKICAgICAgICAgICAgICAgICAgICAgIG9wdHMgPSAoMCwgX3V0aWwubWFrZU9wdHMpKG9yaWdPcHRzKTsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmluZGV4LnBhcnNlKG9wdHMpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICAgIGluZGV4RGF0YSA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgICAgICAgcmV0ID0gaW5kZXhEYXRhLmZpcnN0RGF0YUxpbmUgPyBpbmRleERhdGEuZmlyc3REYXRhTGluZS5ibG9ja1Bvc2l0aW9uICsgNjU1MzUgOiB2b2lkIDA7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJldCkgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE3OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gOTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJhbS5yZWFkKGltcG9ydF9idWZmZXIuQnVmZmVyLmFsbG9jKHJldCArIGJsb2NrTGVuKSwgMCwgcmV0ICsgYmxvY2tMZW4sIDAsIG9wdHMpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgICAgICAgIHJlcyA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgICAgICAgYnl0ZXNSZWFkID0gcmVzLmJ5dGVzUmVhZDsKICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlciA9IHJlcy5idWZmZXI7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoYnl0ZXNSZWFkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJFcnJvciByZWFkaW5nIGhlYWRlciIpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICAgICAgICBpZiAoYnl0ZXNSZWFkIDwgcmV0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlciA9ICgwLCBfc2xpY2UuZGVmYXVsdCkoYnVmZmVyKS5jYWxsKGJ1ZmZlciwgMCwgYnl0ZXNSZWFkKTsKICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlciA9ICgwLCBfc2xpY2UuZGVmYXVsdCkoYnVmZmVyKS5jYWxsKGJ1ZmZlciwgMCwgcmV0KTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjA7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxOTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJhbS5yZWFkRmlsZShvcHRzKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgICAgICAgYnVmZmVyID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjI7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKDAsIF9iZ3pmRmlsZWhhbmRsZS51bnppcCkoYnVmZmVyKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICAgICAgICAgICAgdW5jYmEgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgICAgICAgIGlmICghKHVuY2JhLnJlYWRJbnQzMkxFKDApICE9PSBCQU1fTUFHSUMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjU7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJOb3QgYSBCQU0gZmlsZSIpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjU6CiAgICAgICAgICAgICAgICAgICAgICBoZWFkTGVuID0gdW5jYmEucmVhZEludDMyTEUoNCk7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhlYWRlciA9IHVuY2JhLnRvU3RyaW5nKCJ1dGY4IiwgOCwgOCArIGhlYWRMZW4pOwogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyOTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZWFkUmVmU2VxcyhoZWFkTGVuICsgOCwgNjU1MzUsIG9wdHMpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjk6CiAgICAgICAgICAgICAgICAgICAgICBfeWllbGQkdGhpcyRfcmVhZFJlZlMgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgICAgICAgIGNoclRvSW5kZXggPSBfeWllbGQkdGhpcyRfcmVhZFJlZlMuY2hyVG9JbmRleDsKICAgICAgICAgICAgICAgICAgICAgIGluZGV4VG9DaHIgPSBfeWllbGQkdGhpcyRfcmVhZFJlZlMuaW5kZXhUb0NocjsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2hyVG9JbmRleCA9IGNoclRvSW5kZXg7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluZGV4VG9DaHIgPSBpbmRleFRvQ2hyOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsICgwLCBfc2FtLnBhcnNlSGVhZGVyVGV4dCkodGhpcy5oZWFkZXIpKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM1OgogICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEhlYWRlcigpIHsKICAgICAgICAgICAgICByZXR1cm4gX2dldEhlYWRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBnZXRIZWFkZXI7CiAgICAgICAgICB9KCkKICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJnZXRIZWFkZXJUZXh0IiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIF9nZXRIZWFkZXJUZXh0ID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICAgICAgICB2YXIgb3B0cywgX2FyZ3MyID0gYXJndW1lbnRzOwogICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDMpIHsKICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIG9wdHMgPSBfYXJnczIubGVuZ3RoID4gMCAmJiBfYXJnczJbMF0gIT09IHZvaWQgMCA/IF9hcmdzMlswXSA6IHt9OwogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAzOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SGVhZGVyKG9wdHMpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCB0aGlzLmhlYWRlcik7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICBmdW5jdGlvbiBnZXRIZWFkZXJUZXh0KCkgewogICAgICAgICAgICAgIHJldHVybiBfZ2V0SGVhZGVyVGV4dC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBnZXRIZWFkZXJUZXh0OwogICAgICAgICAgfSgpCiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiX3JlYWRSZWZTZXFzIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIF9yZWFkUmVmU2VxczIgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKHN0YXJ0LCByZWZTZXFCeXRlcykgewogICAgICAgICAgICAgIHZhciBvcHRzLCByZXMsIGJ5dGVzUmVhZCwgYnVmZmVyLCB1bmNiYSwgblJlZiwgcCwgY2hyVG9JbmRleCwgaW5kZXhUb0NociwgaSwgbE5hbWUsIHJlZk5hbWUsIGxSZWYsIF9hcmdzMyA9IGFyZ3VtZW50czsKICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQ0KSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBvcHRzID0gX2FyZ3MzLmxlbmd0aCA+IDIgJiYgX2FyZ3MzWzJdICE9PSB2b2lkIDAgPyBfYXJnczNbMl0gOiB7fTsKICAgICAgICAgICAgICAgICAgICAgIGlmICghKHN0YXJ0ID4gcmVmU2VxQnl0ZXMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgdGhpcy5fcmVhZFJlZlNlcXMoc3RhcnQsIHJlZlNlcUJ5dGVzICogMiwgb3B0cykpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJhbS5yZWFkKGltcG9ydF9idWZmZXIuQnVmZmVyLmFsbG9jKHJlZlNlcUJ5dGVzICsgYmxvY2tMZW4pLCAwLCByZWZTZXFCeXRlcywgMCwgb3B0cyk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgICAgcmVzID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICBieXRlc1JlYWQgPSByZXMuYnl0ZXNSZWFkOwogICAgICAgICAgICAgICAgICAgICAgYnVmZmVyID0gcmVzLmJ1ZmZlcjsKICAgICAgICAgICAgICAgICAgICAgIGlmIChieXRlc1JlYWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkVycm9yIHJlYWRpbmcgcmVmc2VxcyBmcm9tIGhlYWRlciIpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgICBpZiAoYnl0ZXNSZWFkIDwgcmVmU2VxQnl0ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYnVmZmVyID0gKDAsIF9zbGljZS5kZWZhdWx0KShidWZmZXIpLmNhbGwoYnVmZmVyLCAwLCBieXRlc1JlYWQpOwogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgYnVmZmVyID0gKDAsIF9zbGljZS5kZWZhdWx0KShidWZmZXIpLmNhbGwoYnVmZmVyLCAwLCByZWZTZXFCeXRlcyk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDEzOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfYmd6ZkZpbGVoYW5kbGUudW56aXApKGJ1ZmZlcik7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgICAgICAgIHVuY2JhID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICBuUmVmID0gdW5jYmEucmVhZEludDMyTEUoc3RhcnQpOwogICAgICAgICAgICAgICAgICAgICAgcCA9IHN0YXJ0ICsgNDsKICAgICAgICAgICAgICAgICAgICAgIGNoclRvSW5kZXggPSB7fTsKICAgICAgICAgICAgICAgICAgICAgIGluZGV4VG9DaHIgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgIGkgPSAwOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIShpIDwgblJlZikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAzNTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDIyOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfdXRpbC5hYm9ydEJyZWFrUG9pbnQpKG9wdHMuc2lnbmFsKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICAgICAgICAgICAgbE5hbWUgPSB1bmNiYS5yZWFkSW50MzJMRShwKTsKICAgICAgICAgICAgICAgICAgICAgIHJlZk5hbWUgPSB1bmNiYS50b1N0cmluZygidXRmOCIsIHAgKyA0LCBwICsgNCArIGxOYW1lIC0gMSk7CiAgICAgICAgICAgICAgICAgICAgICByZWZOYW1lID0gdGhpcy5yZW5hbWVSZWZTZXEocmVmTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICBsUmVmID0gdW5jYmEucmVhZEludDMyTEUocCArIGxOYW1lICsgNCk7CiAgICAgICAgICAgICAgICAgICAgICBjaHJUb0luZGV4W3JlZk5hbWVdID0gaTsKICAgICAgICAgICAgICAgICAgICAgIGluZGV4VG9DaHIucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlZk5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aDogbFJlZgogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICBwID0gcCArIDggKyBsTmFtZTsKICAgICAgICAgICAgICAgICAgICAgIGlmICghKHAgPiB1bmNiYS5sZW5ndGgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMzI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJCQU0gaGVhZGVyIGlzIHZlcnkgYmlnLiAgUmUtZmV0Y2hpbmcgIi5jb25jYXQocmVmU2VxQnl0ZXMsICIgYnl0ZXMuIikpOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIHRoaXMuX3JlYWRSZWZTZXFzKHN0YXJ0LCByZWZTZXFCeXRlcyAqIDIsIG9wdHMpKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMyOgogICAgICAgICAgICAgICAgICAgICAgaSArPSAxOwogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxOTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzU6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAgICAgICBjaHJUb0luZGV4LAogICAgICAgICAgICAgICAgICAgICAgICBpbmRleFRvQ2hyCiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM2OgogICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIF9jYWxsZWUzLCB0aGlzKTsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICBmdW5jdGlvbiBfcmVhZFJlZlNlcXMoX3gsIF94MikgewogICAgICAgICAgICAgIHJldHVybiBfcmVhZFJlZlNlcXMyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIF9yZWFkUmVmU2VxczsKICAgICAgICAgIH0oKQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImdldFJlY29yZHNGb3JSYW5nZSIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBfZ2V0UmVjb3Jkc0ZvclJhbmdlID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlNChjaHIsIG1pbiwgbWF4KSB7CiAgICAgICAgICAgICAgdmFyIG9wdHMsIHJlY29yZHMsIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24sIF9kaWRJdGVyYXRvckVycm9yLCBfaXRlcmF0b3JFcnJvciwgX2l0ZXJhdG9yLCBfc3RlcCwgX3ZhbHVlLCBjaHVuaywgX2FyZ3M0ID0gYXJndW1lbnRzOwogICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDUpIHsKICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIG9wdHMgPSBfYXJnczQubGVuZ3RoID4gMyAmJiBfYXJnczRbM10gIT09IHZvaWQgMCA/IF9hcmdzNFszXSA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgdmlld0FzUGFpcnM6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBwYWlyQWNyb3NzQ2hyOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgbWF4SW5zZXJ0U2l6ZTogMmU1CiAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgcmVjb3JkcyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1LnByZXYgPSA0OwogICAgICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yID0gKDAsIF9hc3luY0l0ZXJhdG9yMi5kZWZhdWx0KSh0aGlzLnN0cmVhbVJlY29yZHNGb3JSYW5nZShjaHIsIG1pbiwgbWF4LCBvcHRzKSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSA4OwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9pdGVyYXRvci5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgICAgICAgX3N0ZXAgPSBfY29udGV4dDUuc2VudDsKICAgICAgICAgICAgICAgICAgICAgIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSBfc3RlcC5kb25lOwogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAxMjsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfc3RlcC52YWx1ZTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgICAgICAgX3ZhbHVlID0gX2NvbnRleHQ1LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDE5OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGNodW5rID0gX3ZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgcmVjb3JkcyA9ICgwLCBfY29uY2F0LmRlZmF1bHQpKHJlY29yZHMpLmNhbGwocmVjb3JkcywgY2h1bmspOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgICAgICAgICBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDI1OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5wcmV2ID0gMjE7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDUudDAgPSBfY29udGV4dDVbImNhdGNoIl0oNCk7CiAgICAgICAgICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvciA9IF9jb250ZXh0NS50MDsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI1OgogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1LnByZXYgPSAyNTsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5wcmV2ID0gMjY7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoISghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiAmJiBfaXRlcmF0b3IucmV0dXJuICE9IG51bGwpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMzA7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAzMDsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfaXRlcmF0b3IucmV0dXJuKCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5wcmV2ID0gMzA7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIV9kaWRJdGVyYXRvckVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMzM7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3I7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMzoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuZmluaXNoKDMwKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM0OgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5maW5pc2goMjUpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzU6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwgcmVjb3Jkcyk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzNjoKICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCBfY2FsbGVlNCwgdGhpcywgW1s0LCAyMSwgMjUsIDM1XSwgWzI2LCAsIDMwLCAzNF1dKTsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICBmdW5jdGlvbiBnZXRSZWNvcmRzRm9yUmFuZ2UoX3gzLCBfeDQsIF94NSkgewogICAgICAgICAgICAgIHJldHVybiBfZ2V0UmVjb3Jkc0ZvclJhbmdlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGdldFJlY29yZHNGb3JSYW5nZTsKICAgICAgICAgIH0oKQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogInN0cmVhbVJlY29yZHNGb3JSYW5nZSIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc3RyZWFtUmVjb3Jkc0ZvclJhbmdlKGNociwgbWluLCBtYXgpIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICAgICAgdmFyIG9wdHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1szXSA6IHsKICAgICAgICAgICAgICB2aWV3QXNQYWlyczogZmFsc2UsCiAgICAgICAgICAgICAgcGFpckFjcm9zc0NocjogZmFsc2UsCiAgICAgICAgICAgICAgbWF4SW5zZXJ0U2l6ZTogMmU1CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiAoMCwgX3dyYXBBc3luY0dlbmVyYXRvcjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvci5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUoKSB7CiAgICAgICAgICAgICAgdmFyIF9jb250ZXh0NzsKICAgICAgICAgICAgICB2YXIgY2hySWQsIGNodW5rcywgaSwgc2l6ZSwgX2NvbnRleHQ2LCB0b3RhbFNpemUsIF9jb250ZXh0ODsKICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQ5KSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OS5wcmV2ID0gX2NvbnRleHQ5Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBvcHRzLnZpZXdBc1BhaXJzID0gb3B0cy52aWV3QXNQYWlycyB8fCBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgIG9wdHMucGFpckFjcm9zc0NociA9IG9wdHMucGFpckFjcm9zc0NociB8fCBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgIG9wdHMubWF4SW5zZXJ0U2l6ZSA9IG9wdHMubWF4SW5zZXJ0U2l6ZSAhPT0gdm9pZCAwID8gb3B0cy5tYXhJbnNlcnRTaXplIDogMmU1OwogICAgICAgICAgICAgICAgICAgICAgY2hySWQgPSBfdGhpcy5jaHJUb0luZGV4ICYmIF90aGlzLmNoclRvSW5kZXhbY2hyXTsKICAgICAgICAgICAgICAgICAgICAgIGlmIChjaHJJZCA+PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gODsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBjaHVua3MgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDEwOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfYXdhaXRBc3luY0dlbmVyYXRvcjIuZGVmYXVsdCkoX3RoaXMuaW5kZXguYmxvY2tzRm9yUmFuZ2UoY2hySWQsIG1pbiAtIDEsIG1heCwgb3B0cykpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgICBjaHVua3MgPSBfY29udGV4dDkuc2VudDsKICAgICAgICAgICAgICAgICAgICAgIGlmIChjaHVua3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAxMzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkVycm9yIGluIGluZGV4IGZldGNoIik7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgICAgICAgIGkgPSAwOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIShpIDwgY2h1bmtzLmxlbmd0aCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAyMzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDE3OwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfYXdhaXRBc3luY0dlbmVyYXRvcjIuZGVmYXVsdCkoKDAsIF91dGlsLmFib3J0QnJlYWtQb2ludCkob3B0cy5zaWduYWwpKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICAgICAgICAgICAgc2l6ZSA9IGNodW5rc1tpXS5mZXRjaGVkU2l6ZSgpOwogICAgICAgICAgICAgICAgICAgICAgaWYgKCEoc2l6ZSA+IF90aGlzLmNodW5rU2l6ZUxpbWl0KSkgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDIwOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigoMCwgX2NvbmNhdC5kZWZhdWx0KShfY29udGV4dDYgPSAiVG9vIG1hbnkgQkFNIGZlYXR1cmVzLiBCQU0gY2h1bmsgc2l6ZSAiLmNvbmNhdChzaXplLCAiIGJ5dGVzIGV4Y2VlZHMgY2h1bmtTaXplTGltaXQgb2YgIikpLmNhbGwoX2NvbnRleHQ2LCBfdGhpcy5jaHVua1NpemVMaW1pdCkpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICAgICAgICBpICs9IDE7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMzoKICAgICAgICAgICAgICAgICAgICAgIHRvdGFsU2l6ZSA9ICgwLCBfcmVkdWNlLmRlZmF1bHQpKF9jb250ZXh0NyA9ICgwLCBfbWFwLmRlZmF1bHQpKGNodW5rcykuY2FsbChjaHVua3MsIGZ1bmN0aW9uKHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHMuZmV0Y2hlZFNpemUoKTsKICAgICAgICAgICAgICAgICAgICAgIH0pKS5jYWxsKF9jb250ZXh0NywgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSArIGI7CiAgICAgICAgICAgICAgICAgICAgICB9LCAwKTsKICAgICAgICAgICAgICAgICAgICAgIGlmICghKHRvdGFsU2l6ZSA+IF90aGlzLmZldGNoU2l6ZUxpbWl0KSkgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDI2OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigoMCwgX2NvbmNhdC5kZWZhdWx0KShfY29udGV4dDggPSAiZGF0YSBzaXplIG9mICIuY29uY2F0KHRvdGFsU2l6ZS50b0xvY2FsZVN0cmluZygpLCAiIGJ5dGVzIGV4Y2VlZGVkIGZldGNoIHNpemUgbGltaXQgb2YgIikpLmNhbGwoX2NvbnRleHQ4LCBfdGhpcy5mZXRjaFNpemVMaW1pdC50b0xvY2FsZVN0cmluZygpLCAiIGJ5dGVzIikpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjY6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LmRlbGVnYXRlWWllbGQoKDAsIF9hc3luY0dlbmVyYXRvckRlbGVnYXRlMi5kZWZhdWx0KSgoMCwgX2FzeW5jSXRlcmF0b3IyLmRlZmF1bHQpKF90aGlzLl9mZXRjaENodW5rRmVhdHVyZXMoY2h1bmtzLCBjaHJJZCwgbWluLCBtYXgsIG9wdHMpKSwgX2F3YWl0QXN5bmNHZW5lcmF0b3IyLmRlZmF1bHQpLCAidDAiLCAyNyk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyNzoKICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCBfY2FsbGVlNSk7CiAgICAgICAgICAgIH0pKSgpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogIl9mZXRjaENodW5rRmVhdHVyZXMiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9mZXRjaENodW5rRmVhdHVyZXMoY2h1bmtzLCBjaHJJZCwgbWluLCBtYXgsIG9wdHMpIHsKICAgICAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CiAgICAgICAgICAgIHJldHVybiAoMCwgX3dyYXBBc3luY0dlbmVyYXRvcjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvci5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYoKSB7CiAgICAgICAgICAgICAgdmFyIGZlYXRQcm9taXNlcywgZG9uZSwgaSwgYywgX3lpZWxkJF9hd2FpdEFzeW5jR2VuLCBkYXRhLCBjcG9zaXRpb25zLCBkcG9zaXRpb25zLCBjaHVuaywgcHJvbWlzZSwgX2kyOwogICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDEwKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTAucHJldiA9IF9jb250ZXh0MTAubmV4dCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIGZlYXRQcm9taXNlcyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgZG9uZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgaSA9IDA7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgaWYgKCEoaSA8IGNodW5rcy5sZW5ndGgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDIxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGMgPSBjaHVua3NbaV07CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSA3OwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfYXdhaXRBc3luY0dlbmVyYXRvcjIuZGVmYXVsdCkoX3RoaXMyLmZlYXR1cmVDYWNoZS5nZXQoYy50b1N0cmluZygpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rOiBjLAogICAgICAgICAgICAgICAgICAgICAgICBvcHRzCiAgICAgICAgICAgICAgICAgICAgICB9LCBvcHRzLnNpZ25hbCkpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgICAgIF95aWVsZCRfYXdhaXRBc3luY0dlbiA9IF9jb250ZXh0MTAuc2VudDsKICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBfeWllbGQkX2F3YWl0QXN5bmNHZW4uZGF0YTsKICAgICAgICAgICAgICAgICAgICAgIGNwb3NpdGlvbnMgPSBfeWllbGQkX2F3YWl0QXN5bmNHZW4uY3Bvc2l0aW9uczsKICAgICAgICAgICAgICAgICAgICAgIGRwb3NpdGlvbnMgPSBfeWllbGQkX2F3YWl0QXN5bmNHZW4uZHBvc2l0aW9uczsKICAgICAgICAgICAgICAgICAgICAgIGNodW5rID0gX3lpZWxkJF9hd2FpdEFzeW5jR2VuLmNodW5rOwogICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZSA9IF90aGlzMi5yZWFkQmFtRmVhdHVyZXMoZGF0YSwgY3Bvc2l0aW9ucywgZHBvc2l0aW9ucywgY2h1bmspLnRoZW4oZnVuY3Rpb24ocmVjb3JkcykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVjcyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgcmVjb3Jkcy5sZW5ndGg7IF9pICs9IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmVhdHVyZSA9IHJlY29yZHNbX2ldOwogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmZWF0dXJlLnNlcV9pZCgpID09PSBjaHJJZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZlYXR1cmUuZ2V0KCJzdGFydCIpID49IG1heCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZlYXR1cmUuZ2V0KCJlbmQiKSA+PSBtaW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjcy5wdXNoKGZlYXR1cmUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVjczsKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgZmVhdFByb21pc2VzLnB1c2gocHJvbWlzZSk7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSAxNjsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoMCwgX2F3YWl0QXN5bmNHZW5lcmF0b3IyLmRlZmF1bHQpKHByb21pc2UpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRvbmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gMTg7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJicmVhayIsIDIxKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICAgICAgICAoMCwgX3V0aWwuY2hlY2tBYm9ydFNpZ25hbCkob3B0cy5zaWduYWwpOwogICAgICAgICAgICAgICAgICAgICAgX2kyID0gMDsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIzOgogICAgICAgICAgICAgICAgICAgICAgaWYgKCEoX2kyIDwgZmVhdFByb21pc2VzLmxlbmd0aCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gMjk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gMjY7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmVhdFByb21pc2VzW19pMl07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyNjoKICAgICAgICAgICAgICAgICAgICAgIF9pMisrOwogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gMjM7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI5OgogICAgICAgICAgICAgICAgICAgICAgKDAsIF91dGlsLmNoZWNrQWJvcnRTaWduYWwpKG9wdHMuc2lnbmFsKTsKICAgICAgICAgICAgICAgICAgICAgIGlmICghb3B0cy52aWV3QXNQYWlycykgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSAzMzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSAzMzsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczIuZmV0Y2hQYWlycyhjaHJJZCwgZmVhdFByb21pc2VzLCBvcHRzKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMzOgogICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCBfY2FsbGVlNik7CiAgICAgICAgICAgIH0pKSgpOwogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImZldGNoUGFpcnMiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgX2ZldGNoUGFpcnMgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMChjaHJJZCwgZmVhdFByb21pc2VzLCBvcHRzKSB7CiAgICAgICAgICAgICAgdmFyIF90aGlzMyA9IHRoaXMsIF9jb250ZXh0MTQsIF9jb250ZXh0MTU7CiAgICAgICAgICAgICAgdmFyIHVubWF0ZWRQYWlycywgcmVhZElkcywgbWF0ZVByb21pc2VzLCBtYXRlQmxvY2tzLCBtYXRlQ2h1bmtzLCBpLCBtYXRlVG90YWxTaXplLCBfY29udGV4dDE2LCBtYXRlRmVhdFByb21pc2VzLCBuZXdNYXRlRmVhdHMsIGZlYXR1cmVzUmV0LCBuZXdNYXRlczsKICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlMTAkKF9jb250ZXh0MTgpIHsKICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxOC5wcmV2ID0gX2NvbnRleHQxOC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgdW5tYXRlZFBhaXJzID0ge307CiAgICAgICAgICAgICAgICAgICAgICByZWFkSWRzID0ge307CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE4Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9wcm9taXNlLmRlZmF1bHQuYWxsKCgwLCBfbWFwLmRlZmF1bHQpKGZlYXRQcm9taXNlcykuY2FsbChmZWF0UHJvbWlzZXMsIC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9yZWYyID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlNyhmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9jb250ZXh0MTE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJldCwgcmVhZE5hbWVzLCBpMiwgbmFtZSwgaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvci5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTckKF9jb250ZXh0MTIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMi5wcmV2ID0gX2NvbnRleHQxMi5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMi5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IF9jb250ZXh0MTIuc2VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWROYW1lcyA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpMiA9IDA7IGkyIDwgcmV0Lmxlbmd0aDsgaTIrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gcmV0W2kyXS5uYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkID0gcmV0W2kyXS5pZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlYWROYW1lc1tuYW1lXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWROYW1lc1tuYW1lXSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZE5hbWVzW25hbWVdKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRJZHNbaWRdID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgwLCBfZm9yRWFjaC5kZWZhdWx0KShfY29udGV4dDExID0gKDAsIF9vYmplY3QuZGVmYXVsdCkocmVhZE5hbWVzKSkuY2FsbChfY29udGV4dDExLCBmdW5jdGlvbihfcmVmMykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX3JlZjQgPSAoMCwgX3NsaWNlZFRvQXJyYXkyLmRlZmF1bHQpKF9yZWYzLCAyKSwgayA9IF9yZWY0WzBdLCB2ID0gX3JlZjRbMV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2ID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5tYXRlZFBhaXJzW2tdID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMi5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlNyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKF94OSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgfSgpKSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgICAgbWF0ZVByb21pc2VzID0gW107CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE4Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9wcm9taXNlLmRlZmF1bHQuYWxsKCgwLCBfbWFwLmRlZmF1bHQpKGZlYXRQcm9taXNlcykuY2FsbChmZWF0UHJvbWlzZXMsIC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9yZWY1ID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlOChmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJldCwgaTIsIG5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvci5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0MTMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMy5wcmV2ID0gX2NvbnRleHQxMy5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMy5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IF9jb250ZXh0MTMuc2VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaTIgPSAwOyBpMiA8IHJldC5sZW5ndGg7IGkyKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSA9IHJldFtpMl0ubmFtZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodW5tYXRlZFBhaXJzW25hbWVdICYmIChvcHRzLnBhaXJBY3Jvc3NDaHIgfHwgcmV0W2kyXS5fbmV4dF9yZWZpZCgpID09PSBjaHJJZCAmJiBNYXRoLmFicyhyZXRbaTJdLmdldCgic3RhcnQiKSAtIHJldFtpMl0uX25leHRfcG9zKCkpIDwgKG9wdHMubWF4SW5zZXJ0U2l6ZSB8fCAyZTUpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGVQcm9taXNlcy5wdXNoKF90aGlzMy5pbmRleC5ibG9ja3NGb3JSYW5nZShyZXRbaTJdLl9uZXh0X3JlZmlkKCksIHJldFtpMl0uX25leHRfcG9zKCksIHJldFtpMl0uX25leHRfcG9zKCkgKyAxLCBvcHRzKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEzLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIH0sIF9jYWxsZWU4KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oX3gxMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmNS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgfSgpKSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxOC5uZXh0ID0gOTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfcHJvbWlzZS5kZWZhdWx0LmFsbChtYXRlUHJvbWlzZXMpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgICAgICAgIG1hdGVCbG9ja3MgPSBfY29udGV4dDE4LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICBtYXRlQ2h1bmtzID0gW107CiAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbWF0ZUJsb2Nrcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICBtYXRlQ2h1bmtzID0gKDAsIF9jb25jYXQuZGVmYXVsdCkobWF0ZUNodW5rcykuY2FsbChtYXRlQ2h1bmtzLCBtYXRlQmxvY2tzW2ldKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIG1hdGVDaHVua3MgPSAoMCwgX2ZpbHRlci5kZWZhdWx0KShfY29udGV4dDE0ID0gKDAsIF9zb3J0LmRlZmF1bHQpKG1hdGVDaHVua3MpLmNhbGwobWF0ZUNodW5rcykpLmNhbGwoX2NvbnRleHQxNCwgZnVuY3Rpb24oaXRlbSwgcG9zLCBhcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFwb3MgfHwgaXRlbS50b1N0cmluZygpICE9PSBhcnlbcG9zIC0gMV0udG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgbWF0ZVRvdGFsU2l6ZSA9ICgwLCBfcmVkdWNlLmRlZmF1bHQpKF9jb250ZXh0MTUgPSAoMCwgX21hcC5kZWZhdWx0KShtYXRlQ2h1bmtzKS5jYWxsKG1hdGVDaHVua3MsIGZ1bmN0aW9uKHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHMuZmV0Y2hlZFNpemUoKTsKICAgICAgICAgICAgICAgICAgICAgIH0pKS5jYWxsKF9jb250ZXh0MTUsIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEgKyBiOwogICAgICAgICAgICAgICAgICAgICAgfSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIShtYXRlVG90YWxTaXplID4gdGhpcy5mZXRjaFNpemVMaW1pdCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxOC5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCgwLCBfY29uY2F0LmRlZmF1bHQpKF9jb250ZXh0MTYgPSAiZGF0YSBzaXplIG9mICIuY29uY2F0KG1hdGVUb3RhbFNpemUudG9Mb2NhbGVTdHJpbmcoKSwgIiBieXRlcyBleGNlZWRlZCBmZXRjaCBzaXplIGxpbWl0IG9mICIpKS5jYWxsKF9jb250ZXh0MTYsIHRoaXMuZmV0Y2hTaXplTGltaXQudG9Mb2NhbGVTdHJpbmcoKSwgIiBieXRlcyIpKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgICAgICAgbWF0ZUZlYXRQcm9taXNlcyA9ICgwLCBfbWFwLmRlZmF1bHQpKG1hdGVDaHVua3MpLmNhbGwobWF0ZUNodW5rcywgLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgX3JlZjYgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX3lpZWxkJF90aGlzMyRmZWF0dXJlLCBkYXRhLCBjcG9zaXRpb25zLCBkcG9zaXRpb25zLCBjaHVuaywgZmVhdHMsIG1hdGVSZWNzLCBfaTMsIGZlYXR1cmU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvci5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTkkKF9jb250ZXh0MTcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxNy5wcmV2ID0gX2NvbnRleHQxNy5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxNy5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczMuZmVhdHVyZUNhY2hlLmdldChjLnRvU3RyaW5nKCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bms6IGMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIG9wdHMuc2lnbmFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfeWllbGQkX3RoaXMzJGZlYXR1cmUgPSBfY29udGV4dDE3LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gX3lpZWxkJF90aGlzMyRmZWF0dXJlLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcG9zaXRpb25zID0gX3lpZWxkJF90aGlzMyRmZWF0dXJlLmNwb3NpdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcG9zaXRpb25zID0gX3lpZWxkJF90aGlzMyRmZWF0dXJlLmRwb3NpdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVuayA9IF95aWVsZCRfdGhpczMkZmVhdHVyZS5jaHVuazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTcubmV4dCA9IDk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMzLnJlYWRCYW1GZWF0dXJlcyhkYXRhLCBjcG9zaXRpb25zLCBkcG9zaXRpb25zLCBjaHVuayk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmVhdHMgPSBfY29udGV4dDE3LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRlUmVjcyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChfaTMgPSAwOyBfaTMgPCBmZWF0cy5sZW5ndGg7IF9pMyArPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZlYXR1cmUgPSBmZWF0c1tfaTNdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodW5tYXRlZFBhaXJzW2ZlYXR1cmUuZ2V0KCJuYW1lIildICYmICFyZWFkSWRzW2ZlYXR1cmUuaWQoKV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRlUmVjcy5wdXNoKGZlYXR1cmUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNy5hYnJ1cHQoInJldHVybiIsIG1hdGVSZWNzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNy5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlOSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKF94MTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZjYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgIH0oKSk7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE4Lm5leHQgPSAxOTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfcHJvbWlzZS5kZWZhdWx0LmFsbChtYXRlRmVhdFByb21pc2VzKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgICAgICAgbmV3TWF0ZUZlYXRzID0gX2NvbnRleHQxOC5zZW50OwogICAgICAgICAgICAgICAgICAgICAgZmVhdHVyZXNSZXQgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdNYXRlRmVhdHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld01hdGVzID0gKDAsIF9yZWR1Y2UuZGVmYXVsdCkobmV3TWF0ZUZlYXRzKS5jYWxsKG5ld01hdGVGZWF0cywgZnVuY3Rpb24ocmVzdWx0LCBjdXJyZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfY29uY2F0LmRlZmF1bHQpKHJlc3VsdCkuY2FsbChyZXN1bHQsIGN1cnJlbnQpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgZmVhdHVyZXNSZXQgPSAoMCwgX2NvbmNhdC5kZWZhdWx0KShmZWF0dXJlc1JldCkuY2FsbChmZWF0dXJlc1JldCwgbmV3TWF0ZXMpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTguYWJydXB0KCJyZXR1cm4iLCBmZWF0dXJlc1JldCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMzoKICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTguc3RvcCgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgX2NhbGxlZTEwLCB0aGlzKTsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICBmdW5jdGlvbiBmZXRjaFBhaXJzKF94NiwgX3g3LCBfeDgpIHsKICAgICAgICAgICAgICByZXR1cm4gX2ZldGNoUGFpcnMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmV0Y2hQYWlyczsKICAgICAgICAgIH0oKQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogIl9yZWFkQ2h1bmsiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgX3JlYWRDaHVuazIgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMShfcmVmNywgYWJvcnRTaWduYWwpIHsKICAgICAgICAgICAgICB2YXIgY2h1bmssIG9wdHMsIGMsIGJ1ZnNpemUsIHJlcywgYnl0ZXNSZWFkLCBidWZmZXIsIF95aWVsZCR1bnppcENodW5rU2xpYywgZGF0YSwgY3Bvc2l0aW9ucywgZHBvc2l0aW9uczsKICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlMTEkKF9jb250ZXh0MTkpIHsKICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxOS5wcmV2ID0gX2NvbnRleHQxOS5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgY2h1bmsgPSBfcmVmNy5jaHVuaywgb3B0cyA9IF9yZWY3Lm9wdHM7CiAgICAgICAgICAgICAgICAgICAgICBjID0gY2h1bms7CiAgICAgICAgICAgICAgICAgICAgICBidWZzaXplID0gYy5mZXRjaGVkU2l6ZSgpOwogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxOS5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJhbS5yZWFkKGltcG9ydF9idWZmZXIuQnVmZmVyLmFsbG9jKGJ1ZnNpemUpLCAwLCBidWZzaXplLCBjLm1pbnYuYmxvY2tQb3NpdGlvbiwgb3B0cyk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgICAgcmVzID0gX2NvbnRleHQxOS5zZW50OwogICAgICAgICAgICAgICAgICAgICAgYnl0ZXNSZWFkID0gcmVzLmJ5dGVzUmVhZDsKICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlciA9IHJlcy5idWZmZXI7CiAgICAgICAgICAgICAgICAgICAgICAoMCwgX3V0aWwuY2hlY2tBYm9ydFNpZ25hbCkoYWJvcnRTaWduYWwpOwogICAgICAgICAgICAgICAgICAgICAgaWYgKGJ5dGVzUmVhZCkgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE5Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxOS5hYnJ1cHQoInJldHVybiIsIFtdKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICAgICAgaWYgKGJ5dGVzUmVhZCA8IGJ1ZnNpemUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYnVmZmVyID0gKDAsIF9zbGljZS5kZWZhdWx0KShidWZmZXIpLmNhbGwoYnVmZmVyLCAwLCBieXRlc1JlYWQpOwogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgYnVmZmVyID0gKDAsIF9zbGljZS5kZWZhdWx0KShidWZmZXIpLmNhbGwoYnVmZmVyLCAwLCBidWZzaXplKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTkubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfYmd6ZkZpbGVoYW5kbGUudW56aXBDaHVua1NsaWNlKShidWZmZXIsIGNodW5rKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgICAgICAgICAgX3lpZWxkJHVuemlwQ2h1bmtTbGljID0gX2NvbnRleHQxOS5zZW50OwogICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IF95aWVsZCR1bnppcENodW5rU2xpYy5idWZmZXI7CiAgICAgICAgICAgICAgICAgICAgICBjcG9zaXRpb25zID0gX3lpZWxkJHVuemlwQ2h1bmtTbGljLmNwb3NpdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgICBkcG9zaXRpb25zID0gX3lpZWxkJHVuemlwQ2h1bmtTbGljLmRwb3NpdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgICAoMCwgX3V0aWwuY2hlY2tBYm9ydFNpZ25hbCkoYWJvcnRTaWduYWwpOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTkuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIGNwb3NpdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgIGRwb3NpdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rCiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxOS5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCBfY2FsbGVlMTEsIHRoaXMpOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIGZ1bmN0aW9uIF9yZWFkQ2h1bmsoX3gxMiwgX3gxMykgewogICAgICAgICAgICAgIHJldHVybiBfcmVhZENodW5rMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBfcmVhZENodW5rOwogICAgICAgICAgfSgpCiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAicmVhZEJhbUZlYXR1cmVzIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIF9yZWFkQmFtRmVhdHVyZXMgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMihiYSwgY3Bvc2l0aW9ucywgZHBvc2l0aW9ucywgY2h1bmspIHsKICAgICAgICAgICAgICB2YXIgYmxvY2tTdGFydCwgc2luaywgcG9zLCBsYXN0LCBibG9ja1NpemUsIGJsb2NrRW5kLCBmZWF0dXJlOwogICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMiQoX2NvbnRleHQyMCkgewogICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIwLnByZXYgPSBfY29udGV4dDIwLm5leHQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBibG9ja1N0YXJ0ID0gMDsKICAgICAgICAgICAgICAgICAgICAgIHNpbmsgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IDA7CiAgICAgICAgICAgICAgICAgICAgICBsYXN0ID0gKygwLCBfbm93LmRlZmF1bHQpKCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgICAgaWYgKCEoYmxvY2tTdGFydCArIDQgPCBiYS5sZW5ndGgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MjAubmV4dCA9IDE4OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGJsb2NrU2l6ZSA9IGJhLnJlYWRJbnQzMkxFKGJsb2NrU3RhcnQpOwogICAgICAgICAgICAgICAgICAgICAgYmxvY2tFbmQgPSBibG9ja1N0YXJ0ICsgNCArIGJsb2NrU2l6ZSAtIDE7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoZHBvc2l0aW9ucykgewogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYmxvY2tTdGFydCArIGNodW5rLm1pbnYuZGF0YVBvc2l0aW9uID49IGRwb3NpdGlvbnNbcG9zKytdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcG9zLS07CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIShibG9ja0VuZCA8IGJhLmxlbmd0aCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyMC5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgZmVhdHVyZSA9IG5ldyBfcmVjb3JkLmRlZmF1bHQoewogICAgICAgICAgICAgICAgICAgICAgICBieXRlczogewogICAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGVBcnJheTogYmEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IGJsb2NrU3RhcnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kOiBibG9ja0VuZAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBmaWxlT2Zmc2V0OiBjcG9zaXRpb25zID8gY3Bvc2l0aW9uc1twb3NdICogKDEgPDwgOCkgKyAoYmxvY2tTdGFydCAtIGRwb3NpdGlvbnNbcG9zXSkgKyBjaHVuay5taW52LmRhdGFQb3NpdGlvbiArIDEgOiBfYnVmZmVyQ3JjLmRlZmF1bHQuc2lnbmVkKCgwLCBfc2xpY2UuZGVmYXVsdCkoYmEpLmNhbGwoYmEsIGJsb2NrU3RhcnQsIGJsb2NrRW5kKSkKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgc2luay5wdXNoKGZlYXR1cmUpOwogICAgICAgICAgICAgICAgICAgICAgaWYgKCEodGhpcy55aWVsZFRocmVhZFRpbWUgJiYgKygwLCBfbm93LmRlZmF1bHQpKCkgLSBsYXN0ID4gdGhpcy55aWVsZFRocmVhZFRpbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MjAubmV4dCA9IDE1OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MjAubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfdXRpbC50aW1lb3V0KSgxKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgICAgICAgICAgbGFzdCA9ICsoMCwgX25vdy5kZWZhdWx0KSgpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgICAgICAgICBibG9ja1N0YXJ0ID0gYmxvY2tFbmQgKyAxOwogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyMC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyMC5hYnJ1cHQoInJldHVybiIsIHNpbmspOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIwLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIF9jYWxsZWUxMiwgdGhpcyk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgZnVuY3Rpb24gcmVhZEJhbUZlYXR1cmVzKF94MTQsIF94MTUsIF94MTYsIF94MTcpIHsKICAgICAgICAgICAgICByZXR1cm4gX3JlYWRCYW1GZWF0dXJlcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZWFkQmFtRmVhdHVyZXM7CiAgICAgICAgICB9KCkKICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJoYXNSZWZTZXEiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgX2hhc1JlZlNlcSA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvci5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEzKHNlcU5hbWUpIHsKICAgICAgICAgICAgICB2YXIgcmVmSWQ7CiAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvci5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTEzJChfY29udGV4dDIxKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MjEucHJldiA9IF9jb250ZXh0MjEubmV4dCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIHJlZklkID0gdGhpcy5jaHJUb0luZGV4ICYmIHRoaXMuY2hyVG9JbmRleFtzZXFOYW1lXTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIxLmFicnVwdCgicmV0dXJuIiwgdGhpcy5pbmRleC5oYXNSZWZTZXEocmVmSWQpKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIxLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIF9jYWxsZWUxMywgdGhpcyk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgZnVuY3Rpb24gaGFzUmVmU2VxKF94MTgpIHsKICAgICAgICAgICAgICByZXR1cm4gX2hhc1JlZlNlcS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBoYXNSZWZTZXE7CiAgICAgICAgICB9KCkKICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJsaW5lQ291bnQiLAogICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgX2xpbmVDb3VudCA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvci5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE0KHNlcU5hbWUpIHsKICAgICAgICAgICAgICB2YXIgcmVmSWQ7CiAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvci5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTE0JChfY29udGV4dDIyKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MjIucHJldiA9IF9jb250ZXh0MjIubmV4dCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIHJlZklkID0gdGhpcy5jaHJUb0luZGV4ICYmIHRoaXMuY2hyVG9JbmRleFtzZXFOYW1lXTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIyLmFicnVwdCgicmV0dXJuIiwgdGhpcy5pbmRleC5saW5lQ291bnQocmVmSWQpKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIyLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIF9jYWxsZWUxNCwgdGhpcyk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgZnVuY3Rpb24gbGluZUNvdW50KF94MTkpIHsKICAgICAgICAgICAgICByZXR1cm4gX2xpbmVDb3VudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBsaW5lQ291bnQ7CiAgICAgICAgICB9KCkKICAgICAgICB9LCB7CiAgICAgICAgICBrZXk6ICJpbmRleENvdiIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBfaW5kZXhDb3YgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNShzZXFOYW1lLCBzdGFydCwgZW5kKSB7CiAgICAgICAgICAgICAgdmFyIHNlcUlkOwogICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNSQoX2NvbnRleHQyMykgewogICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIzLnByZXYgPSBfY29udGV4dDIzLm5leHQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIzLm5leHQgPSAyOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXgucGFyc2UoKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICBzZXFJZCA9IHRoaXMuY2hyVG9JbmRleCAmJiB0aGlzLmNoclRvSW5kZXhbc2VxTmFtZV07CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyMy5hYnJ1cHQoInJldHVybiIsIHRoaXMuaW5kZXguaW5kZXhDb3Yoc2VxSWQsIHN0YXJ0LCBlbmQpKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIzLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIF9jYWxsZWUxNSwgdGhpcyk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgZnVuY3Rpb24gaW5kZXhDb3YoX3gyMCwgX3gyMSwgX3gyMikgewogICAgICAgICAgICAgIHJldHVybiBfaW5kZXhDb3YuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gaW5kZXhDb3Y7CiAgICAgICAgICB9KCkKICAgICAgICB9XSk7CiAgICAgICAgcmV0dXJuIEJhbUZpbGUzOwogICAgICB9KCk7CiAgICAgIGV4cG9ydHMuZGVmYXVsdCA9IEJhbUZpbGUyOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ZlYXR1cmVzL29iamVjdC9nZXQtb3duLXByb3BlcnR5LXN5bWJvbHMuanMKICB2YXIgcmVxdWlyZV9nZXRfb3duX3Byb3BlcnR5X3N5bWJvbHM0ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9mZWF0dXJlcy9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1zeW1ib2xzLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgcGFyZW50ID0gcmVxdWlyZV9nZXRfb3duX3Byb3BlcnR5X3N5bWJvbHMyKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGFyZW50OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzL29iamVjdC9nZXQtb3duLXByb3BlcnR5LXN5bWJvbHMuanMKICB2YXIgcmVxdWlyZV9nZXRfb3duX3Byb3BlcnR5X3N5bWJvbHM1ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1zeW1ib2xzLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmVfZ2V0X293bl9wcm9wZXJ0eV9zeW1ib2xzNCgpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YuanMKICB2YXIgcmVxdWlyZV9lc19hcnJheV9pbmRleF9vZiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZi5qcyIoKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgJCA9IHJlcXVpcmVfZXhwb3J0KCk7CiAgICAgIHZhciAkaW5kZXhPZiA9IHJlcXVpcmVfYXJyYXlfaW5jbHVkZXMoKS5pbmRleE9mOwogICAgICB2YXIgYXJyYXlNZXRob2RJc1N0cmljdCA9IHJlcXVpcmVfYXJyYXlfbWV0aG9kX2lzX3N0cmljdCgpOwogICAgICB2YXIgbmF0aXZlSW5kZXhPZiA9IFtdLmluZGV4T2Y7CiAgICAgIHZhciBORUdBVElWRV9aRVJPID0gISFuYXRpdmVJbmRleE9mICYmIDEgLyBbMV0uaW5kZXhPZigxLCAtMCkgPCAwOwogICAgICB2YXIgU1RSSUNUX01FVEhPRCA9IGFycmF5TWV0aG9kSXNTdHJpY3QoImluZGV4T2YiKTsKICAgICAgJCh7IHRhcmdldDogIkFycmF5IiwgcHJvdG86IHRydWUsIGZvcmNlZDogTkVHQVRJVkVfWkVSTyB8fCAhU1RSSUNUX01FVEhPRCB9LCB7CiAgICAgICAgaW5kZXhPZjogZnVuY3Rpb24gaW5kZXhPZihzZWFyY2hFbGVtZW50KSB7CiAgICAgICAgICByZXR1cm4gTkVHQVRJVkVfWkVSTyA/IG5hdGl2ZUluZGV4T2YuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCAwIDogJGluZGV4T2YodGhpcywgc2VhcmNoRWxlbWVudCwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB2b2lkIDApOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvYXJyYXkvdmlydHVhbC9pbmRleC1vZi5qcwogIHZhciByZXF1aXJlX2luZGV4X29mID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9hcnJheS92aXJ0dWFsL2luZGV4LW9mLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICByZXF1aXJlX2VzX2FycmF5X2luZGV4X29mKCk7CiAgICAgIHZhciBlbnRyeVZpcnR1YWwgPSByZXF1aXJlX2VudHJ5X3ZpcnR1YWwoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBlbnRyeVZpcnR1YWwoIkFycmF5IikuaW5kZXhPZjsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9pbnN0YW5jZS9pbmRleC1vZi5qcwogIHZhciByZXF1aXJlX2luZGV4X29mMiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvaW5zdGFuY2UvaW5kZXgtb2YuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBpbmRleE9mID0gcmVxdWlyZV9pbmRleF9vZigpOwogICAgICB2YXIgQXJyYXlQcm90b3R5cGUgPSBBcnJheS5wcm90b3R5cGU7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpIHsKICAgICAgICB2YXIgb3duID0gaXQuaW5kZXhPZjsKICAgICAgICByZXR1cm4gaXQgPT09IEFycmF5UHJvdG90eXBlIHx8IGl0IGluc3RhbmNlb2YgQXJyYXkgJiYgb3duID09PSBBcnJheVByb3RvdHlwZS5pbmRleE9mID8gaW5kZXhPZiA6IG93bjsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvaW5zdGFuY2UvaW5kZXgtb2YuanMKICB2YXIgcmVxdWlyZV9pbmRleF9vZjMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL3N0YWJsZS9pbnN0YW5jZS9pbmRleC1vZi5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHBhcmVudCA9IHJlcXVpcmVfaW5kZXhfb2YyKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGFyZW50OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ZlYXR1cmVzL2luc3RhbmNlL2luZGV4LW9mLmpzCiAgdmFyIHJlcXVpcmVfaW5kZXhfb2Y0ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9mZWF0dXJlcy9pbnN0YW5jZS9pbmRleC1vZi5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIHBhcmVudCA9IHJlcXVpcmVfaW5kZXhfb2YzKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGFyZW50OwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzL2luc3RhbmNlL2luZGV4LW9mLmpzCiAgdmFyIHJlcXVpcmVfaW5kZXhfb2Y1ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy9pbnN0YW5jZS9pbmRleC1vZi5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlX2luZGV4X29mNCgpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ZlYXR1cmVzL29iamVjdC9rZXlzLmpzCiAgdmFyIHJlcXVpcmVfa2V5czQgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvY29yZS1qcy1wdXJlL2ZlYXR1cmVzL29iamVjdC9rZXlzLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgcGFyZW50ID0gcmVxdWlyZV9rZXlzMigpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhcmVudDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy9vYmplY3Qva2V5cy5qcwogIHZhciByZXF1aXJlX2tleXM1ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy9vYmplY3Qva2V5cy5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlX2tleXM0KCk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS1jb3JlanMzL2hlbHBlcnMvb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZS5qcwogIHZhciByZXF1aXJlX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9oZWxwZXJzL29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBfT2JqZWN0JGtleXMgPSByZXF1aXJlX2tleXM1KCk7CiAgICAgIHZhciBfaW5kZXhPZkluc3RhbmNlUHJvcGVydHkgPSByZXF1aXJlX2luZGV4X29mNSgpOwogICAgICBmdW5jdGlvbiBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShzb3VyY2UsIGV4Y2x1ZGVkKSB7CiAgICAgICAgaWYgKHNvdXJjZSA9PSBudWxsKQogICAgICAgICAgcmV0dXJuIHt9OwogICAgICAgIHZhciB0YXJnZXQgPSB7fTsKICAgICAgICB2YXIgc291cmNlS2V5cyA9IF9PYmplY3Qka2V5cyhzb3VyY2UpOwogICAgICAgIHZhciBrZXksIGk7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHNvdXJjZUtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGtleSA9IHNvdXJjZUtleXNbaV07CiAgICAgICAgICBpZiAoX2luZGV4T2ZJbnN0YW5jZVByb3BlcnR5KGV4Y2x1ZGVkKS5jYWxsKGV4Y2x1ZGVkLCBrZXkpID49IDApCiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRhcmdldDsKICAgICAgfQogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlOwogICAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9oZWxwZXJzL29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzLmpzCiAgdmFyIHJlcXVpcmVfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9oZWxwZXJzL29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgX09iamVjdCRnZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPSByZXF1aXJlX2dldF9vd25fcHJvcGVydHlfc3ltYm9sczUoKTsKICAgICAgdmFyIF9pbmRleE9mSW5zdGFuY2VQcm9wZXJ0eSA9IHJlcXVpcmVfaW5kZXhfb2Y1KCk7CiAgICAgIHZhciBvYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlID0gcmVxdWlyZV9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKCk7CiAgICAgIGZ1bmN0aW9uIF9vYmplY3RXaXRob3V0UHJvcGVydGllcyhzb3VyY2UsIGV4Y2x1ZGVkKSB7CiAgICAgICAgaWYgKHNvdXJjZSA9PSBudWxsKQogICAgICAgICAgcmV0dXJuIHt9OwogICAgICAgIHZhciB0YXJnZXQgPSBvYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKHNvdXJjZSwgZXhjbHVkZWQpOwogICAgICAgIHZhciBrZXksIGk7CiAgICAgICAgaWYgKF9PYmplY3QkZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICAgICAgICB2YXIgc291cmNlU3ltYm9sS2V5cyA9IF9PYmplY3QkZ2V0T3duUHJvcGVydHlTeW1ib2xzKHNvdXJjZSk7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc291cmNlU3ltYm9sS2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBrZXkgPSBzb3VyY2VTeW1ib2xLZXlzW2ldOwogICAgICAgICAgICBpZiAoX2luZGV4T2ZJbnN0YW5jZVByb3BlcnR5KGV4Y2x1ZGVkKS5jYWxsKGV4Y2x1ZGVkLCBrZXkpID49IDApCiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGlmICghT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHNvdXJjZSwga2V5KSkKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRhcmdldDsKICAgICAgfQogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllczsKICAgICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvaXMtcmVnZXhwLmpzCiAgdmFyIHJlcXVpcmVfaXNfcmVnZXhwID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvaXMtcmVnZXhwLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgaXNPYmplY3QgPSByZXF1aXJlX2lzX29iamVjdCgpOwogICAgICB2YXIgY2xhc3NvZiA9IHJlcXVpcmVfY2xhc3NvZl9yYXcoKTsKICAgICAgdmFyIHdlbGxLbm93blN5bWJvbCA9IHJlcXVpcmVfd2VsbF9rbm93bl9zeW1ib2woKTsKICAgICAgdmFyIE1BVENIID0gd2VsbEtub3duU3ltYm9sKCJtYXRjaCIpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KSB7CiAgICAgICAgdmFyIGlzUmVnRXhwOwogICAgICAgIHJldHVybiBpc09iamVjdChpdCkgJiYgKChpc1JlZ0V4cCA9IGl0W01BVENIXSkgIT09IHZvaWQgMCA/ICEhaXNSZWdFeHAgOiBjbGFzc29mKGl0KSA9PSAiUmVnRXhwIik7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL25vdC1hLXJlZ2V4cC5qcwogIHZhciByZXF1aXJlX25vdF9hX3JlZ2V4cCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL25vdC1hLXJlZ2V4cC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgdmFyIGlzUmVnRXhwID0gcmVxdWlyZV9pc19yZWdleHAoKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCkgewogICAgICAgIGlmIChpc1JlZ0V4cChpdCkpIHsKICAgICAgICAgIHRocm93IFR5cGVFcnJvcigiVGhlIG1ldGhvZCBkb2Vzbid0IGFjY2VwdCByZWd1bGFyIGV4cHJlc3Npb25zIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpdDsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9pbnRlcm5hbHMvY29ycmVjdC1pcy1yZWdleHAtbG9naWMuanMKICB2YXIgcmVxdWlyZV9jb3JyZWN0X2lzX3JlZ2V4cF9sb2dpYyA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvaW50ZXJuYWxzL2NvcnJlY3QtaXMtcmVnZXhwLWxvZ2ljLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICB2YXIgd2VsbEtub3duU3ltYm9sID0gcmVxdWlyZV93ZWxsX2tub3duX3N5bWJvbCgpOwogICAgICB2YXIgTUFUQ0ggPSB3ZWxsS25vd25TeW1ib2woIm1hdGNoIik7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oTUVUSE9EX05BTUUpIHsKICAgICAgICB2YXIgcmVnZXhwID0gLy4vOwogICAgICAgIHRyeSB7CiAgICAgICAgICAiLy4vIltNRVRIT0RfTkFNRV0ocmVnZXhwKTsKICAgICAgICB9IGNhdGNoIChlcnJvcjEpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJlZ2V4cFtNQVRDSF0gPSBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuICIvLi8iW01FVEhPRF9OQU1FXShyZWdleHApOwogICAgICAgICAgfSBjYXRjaCAoZXJyb3IyKSB7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9tb2R1bGVzL2VzLnN0cmluZy5zdGFydHMtd2l0aC5qcwogIHZhciByZXF1aXJlX2VzX3N0cmluZ19zdGFydHNfd2l0aCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvbW9kdWxlcy9lcy5zdHJpbmcuc3RhcnRzLXdpdGguanMiKCkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyICQgPSByZXF1aXJlX2V4cG9ydCgpOwogICAgICB2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gcmVxdWlyZV9vYmplY3RfZ2V0X293bl9wcm9wZXJ0eV9kZXNjcmlwdG9yKCkuZjsKICAgICAgdmFyIHRvTGVuZ3RoID0gcmVxdWlyZV90b19sZW5ndGgoKTsKICAgICAgdmFyIHRvU3RyaW5nID0gcmVxdWlyZV90b19zdHJpbmcoKTsKICAgICAgdmFyIG5vdEFSZWdFeHAgPSByZXF1aXJlX25vdF9hX3JlZ2V4cCgpOwogICAgICB2YXIgcmVxdWlyZU9iamVjdENvZXJjaWJsZSA9IHJlcXVpcmVfcmVxdWlyZV9vYmplY3RfY29lcmNpYmxlKCk7CiAgICAgIHZhciBjb3JyZWN0SXNSZWdFeHBMb2dpYyA9IHJlcXVpcmVfY29ycmVjdF9pc19yZWdleHBfbG9naWMoKTsKICAgICAgdmFyIElTX1BVUkUgPSByZXF1aXJlX2lzX3B1cmUoKTsKICAgICAgdmFyICRzdGFydHNXaXRoID0gIiIuc3RhcnRzV2l0aDsKICAgICAgdmFyIG1pbiA9IE1hdGgubWluOwogICAgICB2YXIgQ09SUkVDVF9JU19SRUdFWFBfTE9HSUMgPSBjb3JyZWN0SXNSZWdFeHBMb2dpYygic3RhcnRzV2l0aCIpOwogICAgICB2YXIgTUROX1BPTFlGSUxMX0JVRyA9ICFJU19QVVJFICYmICFDT1JSRUNUX0lTX1JFR0VYUF9MT0dJQyAmJiAhIWZ1bmN0aW9uKCkgewogICAgICAgIHZhciBkZXNjcmlwdG9yID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKFN0cmluZy5wcm90b3R5cGUsICJzdGFydHNXaXRoIik7CiAgICAgICAgcmV0dXJuIGRlc2NyaXB0b3IgJiYgIWRlc2NyaXB0b3Iud3JpdGFibGU7CiAgICAgIH0oKTsKICAgICAgJCh7IHRhcmdldDogIlN0cmluZyIsIHByb3RvOiB0cnVlLCBmb3JjZWQ6ICFNRE5fUE9MWUZJTExfQlVHICYmICFDT1JSRUNUX0lTX1JFR0VYUF9MT0dJQyB9LCB7CiAgICAgICAgc3RhcnRzV2l0aDogZnVuY3Rpb24gc3RhcnRzV2l0aChzZWFyY2hTdHJpbmcpIHsKICAgICAgICAgIHZhciB0aGF0ID0gdG9TdHJpbmcocmVxdWlyZU9iamVjdENvZXJjaWJsZSh0aGlzKSk7CiAgICAgICAgICBub3RBUmVnRXhwKHNlYXJjaFN0cmluZyk7CiAgICAgICAgICB2YXIgaW5kZXggPSB0b0xlbmd0aChtaW4oYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB2b2lkIDAsIHRoYXQubGVuZ3RoKSk7CiAgICAgICAgICB2YXIgc2VhcmNoID0gdG9TdHJpbmcoc2VhcmNoU3RyaW5nKTsKICAgICAgICAgIHJldHVybiAkc3RhcnRzV2l0aCA/ICRzdGFydHNXaXRoLmNhbGwodGhhdCwgc2VhcmNoLCBpbmRleCkgOiB0aGF0LnNsaWNlKGluZGV4LCBpbmRleCArIHNlYXJjaC5sZW5ndGgpID09PSBzZWFyY2g7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9zdHJpbmcvdmlydHVhbC9zdGFydHMtd2l0aC5qcwogIHZhciByZXF1aXJlX3N0YXJ0c193aXRoID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9zdHJpbmcvdmlydHVhbC9zdGFydHMtd2l0aC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgcmVxdWlyZV9lc19zdHJpbmdfc3RhcnRzX3dpdGgoKTsKICAgICAgdmFyIGVudHJ5VmlydHVhbCA9IHJlcXVpcmVfZW50cnlfdmlydHVhbCgpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGVudHJ5VmlydHVhbCgiU3RyaW5nIikuc3RhcnRzV2l0aDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9lcy9pbnN0YW5jZS9zdGFydHMtd2l0aC5qcwogIHZhciByZXF1aXJlX3N0YXJ0c193aXRoMiA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvZXMvaW5zdGFuY2Uvc3RhcnRzLXdpdGguanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBzdGFydHNXaXRoID0gcmVxdWlyZV9zdGFydHNfd2l0aCgpOwogICAgICB2YXIgU3RyaW5nUHJvdG90eXBlID0gU3RyaW5nLnByb3RvdHlwZTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCkgewogICAgICAgIHZhciBvd24gPSBpdC5zdGFydHNXaXRoOwogICAgICAgIHJldHVybiB0eXBlb2YgaXQgPT09ICJzdHJpbmciIHx8IGl0ID09PSBTdHJpbmdQcm90b3R5cGUgfHwgaXQgaW5zdGFuY2VvZiBTdHJpbmcgJiYgb3duID09PSBTdHJpbmdQcm90b3R5cGUuc3RhcnRzV2l0aCA/IHN0YXJ0c1dpdGggOiBvd247CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9jb3JlLWpzLXB1cmUvc3RhYmxlL2luc3RhbmNlL3N0YXJ0cy13aXRoLmpzCiAgdmFyIHJlcXVpcmVfc3RhcnRzX3dpdGgzID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL2NvcmUtanMtcHVyZS9zdGFibGUvaW5zdGFuY2Uvc3RhcnRzLXdpdGguanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgIHZhciBwYXJlbnQgPSByZXF1aXJlX3N0YXJ0c193aXRoMigpOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhcmVudDsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczMvY29yZS1qcy1zdGFibGUvaW5zdGFuY2Uvc3RhcnRzLXdpdGguanMKICB2YXIgcmVxdWlyZV9zdGFydHNfd2l0aDQgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUtY29yZWpzMy9jb3JlLWpzLXN0YWJsZS9pbnN0YW5jZS9zdGFydHMtd2l0aC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlX3N0YXJ0c193aXRoMygpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvY3Jvc3MtZmV0Y2gvZGlzdC9icm93c2VyLXBvbHlmaWxsLmpzCiAgdmFyIHJlcXVpcmVfYnJvd3Nlcl9wb2x5ZmlsbCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9jcm9zcy1mZXRjaC9kaXN0L2Jyb3dzZXItcG9seWZpbGwuanMiKGV4cG9ydHMpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAoZnVuY3Rpb24oc2VsZjIpIHsKICAgICAgICB2YXIgaXJyZWxldmFudCA9IGZ1bmN0aW9uKGV4cG9ydHMyKSB7CiAgICAgICAgICB2YXIgc3VwcG9ydCA9IHsKICAgICAgICAgICAgc2VhcmNoUGFyYW1zOiAiVVJMU2VhcmNoUGFyYW1zIiBpbiBzZWxmMiwKICAgICAgICAgICAgaXRlcmFibGU6ICJTeW1ib2wiIGluIHNlbGYyICYmICJpdGVyYXRvciIgaW4gU3ltYm9sLAogICAgICAgICAgICBibG9iOiAiRmlsZVJlYWRlciIgaW4gc2VsZjIgJiYgIkJsb2IiIGluIHNlbGYyICYmIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBuZXcgQmxvYigpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSgpLAogICAgICAgICAgICBmb3JtRGF0YTogIkZvcm1EYXRhIiBpbiBzZWxmMiwKICAgICAgICAgICAgYXJyYXlCdWZmZXI6ICJBcnJheUJ1ZmZlciIgaW4gc2VsZjIKICAgICAgICAgIH07CiAgICAgICAgICBmdW5jdGlvbiBpc0RhdGFWaWV3KG9iaikgewogICAgICAgICAgICByZXR1cm4gb2JqICYmIERhdGFWaWV3LnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKG9iaik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc3VwcG9ydC5hcnJheUJ1ZmZlcikgewogICAgICAgICAgICB2YXIgdmlld0NsYXNzZXMgPSBbCiAgICAgICAgICAgICAgIltvYmplY3QgSW50OEFycmF5XSIsCiAgICAgICAgICAgICAgIltvYmplY3QgVWludDhBcnJheV0iLAogICAgICAgICAgICAgICJbb2JqZWN0IFVpbnQ4Q2xhbXBlZEFycmF5XSIsCiAgICAgICAgICAgICAgIltvYmplY3QgSW50MTZBcnJheV0iLAogICAgICAgICAgICAgICJbb2JqZWN0IFVpbnQxNkFycmF5XSIsCiAgICAgICAgICAgICAgIltvYmplY3QgSW50MzJBcnJheV0iLAogICAgICAgICAgICAgICJbb2JqZWN0IFVpbnQzMkFycmF5XSIsCiAgICAgICAgICAgICAgIltvYmplY3QgRmxvYXQzMkFycmF5XSIsCiAgICAgICAgICAgICAgIltvYmplY3QgRmxvYXQ2NEFycmF5XSIKICAgICAgICAgICAgXTsKICAgICAgICAgICAgdmFyIGlzQXJyYXlCdWZmZXJWaWV3ID0gQXJyYXlCdWZmZXIuaXNWaWV3IHx8IGZ1bmN0aW9uKG9iaikgewogICAgICAgICAgICAgIHJldHVybiBvYmogJiYgdmlld0NsYXNzZXMuaW5kZXhPZihPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqKSkgPiAtMTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZU5hbWUobmFtZSkgewogICAgICAgICAgICBpZiAodHlwZW9mIG5hbWUgIT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgbmFtZSA9IFN0cmluZyhuYW1lKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoL1teYS16MC05XC0jJCUmJyorLl5fYHx+XS9pLnRlc3QobmFtZSkpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGNoYXJhY3RlciBpbiBoZWFkZXIgZmllbGQgbmFtZSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBuYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBub3JtYWxpemVWYWx1ZSh2YWx1ZSkgewogICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAic3RyaW5nIikgewogICAgICAgICAgICAgIHZhbHVlID0gU3RyaW5nKHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBpdGVyYXRvckZvcihpdGVtcykgewogICAgICAgICAgICB2YXIgaXRlcmF0b3IgPSB7CiAgICAgICAgICAgICAgbmV4dDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBpdGVtcy5zaGlmdCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHsgZG9uZTogdmFsdWUgPT09IHZvaWQgMCwgdmFsdWUgfTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmIChzdXBwb3J0Lml0ZXJhYmxlKSB7CiAgICAgICAgICAgICAgaXRlcmF0b3JbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGl0ZXJhdG9yOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGl0ZXJhdG9yOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gSGVhZGVycyhoZWFkZXJzKSB7CiAgICAgICAgICAgIHRoaXMubWFwID0ge307CiAgICAgICAgICAgIGlmIChoZWFkZXJzIGluc3RhbmNlb2YgSGVhZGVycykgewogICAgICAgICAgICAgIGhlYWRlcnMuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSwgbmFtZSkgewogICAgICAgICAgICAgICAgdGhpcy5hcHBlbmQobmFtZSwgdmFsdWUpOwogICAgICAgICAgICAgIH0sIHRoaXMpOwogICAgICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoaGVhZGVycykpIHsKICAgICAgICAgICAgICBoZWFkZXJzLmZvckVhY2goZnVuY3Rpb24oaGVhZGVyKSB7CiAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZChoZWFkZXJbMF0sIGhlYWRlclsxXSk7CiAgICAgICAgICAgICAgfSwgdGhpcyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZGVycykgewogICAgICAgICAgICAgIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGhlYWRlcnMpLmZvckVhY2goZnVuY3Rpb24obmFtZSkgewogICAgICAgICAgICAgICAgdGhpcy5hcHBlbmQobmFtZSwgaGVhZGVyc1tuYW1lXSk7CiAgICAgICAgICAgICAgfSwgdGhpcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIEhlYWRlcnMucHJvdG90eXBlLmFwcGVuZCA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CiAgICAgICAgICAgIG5hbWUgPSBub3JtYWxpemVOYW1lKG5hbWUpOwogICAgICAgICAgICB2YWx1ZSA9IG5vcm1hbGl6ZVZhbHVlKHZhbHVlKTsKICAgICAgICAgICAgdmFyIG9sZFZhbHVlID0gdGhpcy5tYXBbbmFtZV07CiAgICAgICAgICAgIHRoaXMubWFwW25hbWVdID0gb2xkVmFsdWUgPyBvbGRWYWx1ZSArICIsICIgKyB2YWx1ZSA6IHZhbHVlOwogICAgICAgICAgfTsKICAgICAgICAgIEhlYWRlcnMucHJvdG90eXBlWyJkZWxldGUiXSA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgICAgICAgZGVsZXRlIHRoaXMubWFwW25vcm1hbGl6ZU5hbWUobmFtZSldOwogICAgICAgICAgfTsKICAgICAgICAgIEhlYWRlcnMucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgICAgICAgbmFtZSA9IG5vcm1hbGl6ZU5hbWUobmFtZSk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmhhcyhuYW1lKSA/IHRoaXMubWFwW25hbWVdIDogbnVsbDsKICAgICAgICAgIH07CiAgICAgICAgICBIZWFkZXJzLnByb3RvdHlwZS5oYXMgPSBmdW5jdGlvbihuYW1lKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm1hcC5oYXNPd25Qcm9wZXJ0eShub3JtYWxpemVOYW1lKG5hbWUpKTsKICAgICAgICAgIH07CiAgICAgICAgICBIZWFkZXJzLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbihuYW1lLCB2YWx1ZSkgewogICAgICAgICAgICB0aGlzLm1hcFtub3JtYWxpemVOYW1lKG5hbWUpXSA9IG5vcm1hbGl6ZVZhbHVlKHZhbHVlKTsKICAgICAgICAgIH07CiAgICAgICAgICBIZWFkZXJzLnByb3RvdHlwZS5mb3JFYWNoID0gZnVuY3Rpb24oY2FsbGJhY2ssIHRoaXNBcmcpIHsKICAgICAgICAgICAgZm9yICh2YXIgbmFtZSBpbiB0aGlzLm1hcCkgewogICAgICAgICAgICAgIGlmICh0aGlzLm1hcC5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICAgICAgICAgICAgY2FsbGJhY2suY2FsbCh0aGlzQXJnLCB0aGlzLm1hcFtuYW1lXSwgbmFtZSwgdGhpcyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgICAgSGVhZGVycy5wcm90b3R5cGUua2V5cyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgaXRlbXMgPSBbXTsKICAgICAgICAgICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlLCBuYW1lKSB7CiAgICAgICAgICAgICAgaXRlbXMucHVzaChuYW1lKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBpdGVyYXRvckZvcihpdGVtcyk7CiAgICAgICAgICB9OwogICAgICAgICAgSGVhZGVycy5wcm90b3R5cGUudmFsdWVzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBpdGVtcyA9IFtdOwogICAgICAgICAgICB0aGlzLmZvckVhY2goZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgICAgICBpdGVtcy5wdXNoKHZhbHVlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBpdGVyYXRvckZvcihpdGVtcyk7CiAgICAgICAgICB9OwogICAgICAgICAgSGVhZGVycy5wcm90b3R5cGUuZW50cmllcyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgaXRlbXMgPSBbXTsKICAgICAgICAgICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlLCBuYW1lKSB7CiAgICAgICAgICAgICAgaXRlbXMucHVzaChbbmFtZSwgdmFsdWVdKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBpdGVyYXRvckZvcihpdGVtcyk7CiAgICAgICAgICB9OwogICAgICAgICAgaWYgKHN1cHBvcnQuaXRlcmFibGUpIHsKICAgICAgICAgICAgSGVhZGVycy5wcm90b3R5cGVbU3ltYm9sLml0ZXJhdG9yXSA9IEhlYWRlcnMucHJvdG90eXBlLmVudHJpZXM7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBjb25zdW1lZChib2R5KSB7CiAgICAgICAgICAgIGlmIChib2R5LmJvZHlVc2VkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBUeXBlRXJyb3IoIkFscmVhZHkgcmVhZCIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBib2R5LmJvZHlVc2VkID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGZpbGVSZWFkZXJSZWFkeShyZWFkZXIpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJlc29sdmUocmVhZGVyLnJlc3VsdCk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICByZWFkZXIub25lcnJvciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmVqZWN0KHJlYWRlci5lcnJvcik7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiByZWFkQmxvYkFzQXJyYXlCdWZmZXIoYmxvYikgewogICAgICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgICAgICAgdmFyIHByb21pc2UgPSBmaWxlUmVhZGVyUmVhZHkocmVhZGVyKTsKICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGJsb2IpOwogICAgICAgICAgICByZXR1cm4gcHJvbWlzZTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIHJlYWRCbG9iQXNUZXh0KGJsb2IpIHsKICAgICAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgICAgIHZhciBwcm9taXNlID0gZmlsZVJlYWRlclJlYWR5KHJlYWRlcik7CiAgICAgICAgICAgIHJlYWRlci5yZWFkQXNUZXh0KGJsb2IpOwogICAgICAgICAgICByZXR1cm4gcHJvbWlzZTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIHJlYWRBcnJheUJ1ZmZlckFzVGV4dChidWYpIHsKICAgICAgICAgICAgdmFyIHZpZXcgPSBuZXcgVWludDhBcnJheShidWYpOwogICAgICAgICAgICB2YXIgY2hhcnMgPSBuZXcgQXJyYXkodmlldy5sZW5ndGgpOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZpZXcubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBjaGFyc1tpXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUodmlld1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNoYXJzLmpvaW4oIiIpOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gYnVmZmVyQ2xvbmUoYnVmKSB7CiAgICAgICAgICAgIGlmIChidWYuc2xpY2UpIHsKICAgICAgICAgICAgICByZXR1cm4gYnVmLnNsaWNlKDApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciB2aWV3ID0gbmV3IFVpbnQ4QXJyYXkoYnVmLmJ5dGVMZW5ndGgpOwogICAgICAgICAgICAgIHZpZXcuc2V0KG5ldyBVaW50OEFycmF5KGJ1ZikpOwogICAgICAgICAgICAgIHJldHVybiB2aWV3LmJ1ZmZlcjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gQm9keSgpIHsKICAgICAgICAgICAgdGhpcy5ib2R5VXNlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9pbml0Qm9keSA9IGZ1bmN0aW9uKGJvZHkpIHsKICAgICAgICAgICAgICB0aGlzLl9ib2R5SW5pdCA9IGJvZHk7CiAgICAgICAgICAgICAgaWYgKCFib2R5KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9ib2R5VGV4dCA9ICIiOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGJvZHkgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9ib2R5VGV4dCA9IGJvZHk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdXBwb3J0LmJsb2IgJiYgQmxvYi5wcm90b3R5cGUuaXNQcm90b3R5cGVPZihib2R5KSkgewogICAgICAgICAgICAgICAgdGhpcy5fYm9keUJsb2IgPSBib2R5OwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3VwcG9ydC5mb3JtRGF0YSAmJiBGb3JtRGF0YS5wcm90b3R5cGUuaXNQcm90b3R5cGVPZihib2R5KSkgewogICAgICAgICAgICAgICAgdGhpcy5fYm9keUZvcm1EYXRhID0gYm9keTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN1cHBvcnQuc2VhcmNoUGFyYW1zICYmIFVSTFNlYXJjaFBhcmFtcy5wcm90b3R5cGUuaXNQcm90b3R5cGVPZihib2R5KSkgewogICAgICAgICAgICAgICAgdGhpcy5fYm9keVRleHQgPSBib2R5LnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdXBwb3J0LmFycmF5QnVmZmVyICYmIHN1cHBvcnQuYmxvYiAmJiBpc0RhdGFWaWV3KGJvZHkpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9ib2R5QXJyYXlCdWZmZXIgPSBidWZmZXJDbG9uZShib2R5LmJ1ZmZlcik7CiAgICAgICAgICAgICAgICB0aGlzLl9ib2R5SW5pdCA9IG5ldyBCbG9iKFt0aGlzLl9ib2R5QXJyYXlCdWZmZXJdKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN1cHBvcnQuYXJyYXlCdWZmZXIgJiYgKEFycmF5QnVmZmVyLnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKGJvZHkpIHx8IGlzQXJyYXlCdWZmZXJWaWV3KGJvZHkpKSkgewogICAgICAgICAgICAgICAgdGhpcy5fYm9keUFycmF5QnVmZmVyID0gYnVmZmVyQ2xvbmUoYm9keSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuX2JvZHlUZXh0ID0gYm9keSA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChib2R5KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKCF0aGlzLmhlYWRlcnMuZ2V0KCJjb250ZW50LXR5cGUiKSkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBib2R5ID09PSAic3RyaW5nIikgewogICAgICAgICAgICAgICAgICB0aGlzLmhlYWRlcnMuc2V0KCJjb250ZW50LXR5cGUiLCAidGV4dC9wbGFpbjtjaGFyc2V0PVVURi04Iik7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2JvZHlCbG9iICYmIHRoaXMuX2JvZHlCbG9iLnR5cGUpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5oZWFkZXJzLnNldCgiY29udGVudC10eXBlIiwgdGhpcy5fYm9keUJsb2IudHlwZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN1cHBvcnQuc2VhcmNoUGFyYW1zICYmIFVSTFNlYXJjaFBhcmFtcy5wcm90b3R5cGUuaXNQcm90b3R5cGVPZihib2R5KSkgewogICAgICAgICAgICAgICAgICB0aGlzLmhlYWRlcnMuc2V0KCJjb250ZW50LXR5cGUiLCAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkO2NoYXJzZXQ9VVRGLTgiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmIChzdXBwb3J0LmJsb2IpIHsKICAgICAgICAgICAgICB0aGlzLmJsb2IgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciByZWplY3RlZCA9IGNvbnN1bWVkKHRoaXMpOwogICAgICAgICAgICAgICAgaWYgKHJlamVjdGVkKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiByZWplY3RlZDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ib2R5QmxvYikgewogICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMuX2JvZHlCbG9iKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fYm9keUFycmF5QnVmZmVyKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobmV3IEJsb2IoW3RoaXMuX2JvZHlBcnJheUJ1ZmZlcl0pKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fYm9keUZvcm1EYXRhKSB7CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiY291bGQgbm90IHJlYWQgRm9ybURhdGEgYm9keSBhcyBibG9iIik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG5ldyBCbG9iKFt0aGlzLl9ib2R5VGV4dF0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHRoaXMuYXJyYXlCdWZmZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ib2R5QXJyYXlCdWZmZXIpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnN1bWVkKHRoaXMpIHx8IFByb21pc2UucmVzb2x2ZSh0aGlzLl9ib2R5QXJyYXlCdWZmZXIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYmxvYigpLnRoZW4ocmVhZEJsb2JBc0FycmF5QnVmZmVyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMudGV4dCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHZhciByZWplY3RlZCA9IGNvbnN1bWVkKHRoaXMpOwogICAgICAgICAgICAgIGlmIChyZWplY3RlZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdGVkOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAodGhpcy5fYm9keUJsb2IpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZWFkQmxvYkFzVGV4dCh0aGlzLl9ib2R5QmxvYik7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9ib2R5QXJyYXlCdWZmZXIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVhZEFycmF5QnVmZmVyQXNUZXh0KHRoaXMuX2JvZHlBcnJheUJ1ZmZlcikpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fYm9keUZvcm1EYXRhKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImNvdWxkIG5vdCByZWFkIEZvcm1EYXRhIGJvZHkgYXMgdGV4dCIpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMuX2JvZHlUZXh0KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmIChzdXBwb3J0LmZvcm1EYXRhKSB7CiAgICAgICAgICAgICAgdGhpcy5mb3JtRGF0YSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudGV4dCgpLnRoZW4oZGVjb2RlKTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuanNvbiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLnRleHQoKS50aGVuKEpTT04ucGFyc2UpOwogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBtZXRob2RzID0gWyJERUxFVEUiLCAiR0VUIiwgIkhFQUQiLCAiT1BUSU9OUyIsICJQT1NUIiwgIlBVVCJdOwogICAgICAgICAgZnVuY3Rpb24gbm9ybWFsaXplTWV0aG9kKG1ldGhvZCkgewogICAgICAgICAgICB2YXIgdXBjYXNlZCA9IG1ldGhvZC50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICByZXR1cm4gbWV0aG9kcy5pbmRleE9mKHVwY2FzZWQpID4gLTEgPyB1cGNhc2VkIDogbWV0aG9kOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gUmVxdWVzdChpbnB1dCwgb3B0aW9ucykgewogICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgICAgICAgICAgdmFyIGJvZHkgPSBvcHRpb25zLmJvZHk7CiAgICAgICAgICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIFJlcXVlc3QpIHsKICAgICAgICAgICAgICBpZiAoaW5wdXQuYm9keVVzZWQpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkFscmVhZHkgcmVhZCIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLnVybCA9IGlucHV0LnVybDsKICAgICAgICAgICAgICB0aGlzLmNyZWRlbnRpYWxzID0gaW5wdXQuY3JlZGVudGlhbHM7CiAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLmhlYWRlcnMpIHsKICAgICAgICAgICAgICAgIHRoaXMuaGVhZGVycyA9IG5ldyBIZWFkZXJzKGlucHV0LmhlYWRlcnMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLm1ldGhvZCA9IGlucHV0Lm1ldGhvZDsKICAgICAgICAgICAgICB0aGlzLm1vZGUgPSBpbnB1dC5tb2RlOwogICAgICAgICAgICAgIHRoaXMuc2lnbmFsID0gaW5wdXQuc2lnbmFsOwogICAgICAgICAgICAgIGlmICghYm9keSAmJiBpbnB1dC5fYm9keUluaXQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgYm9keSA9IGlucHV0Ll9ib2R5SW5pdDsKICAgICAgICAgICAgICAgIGlucHV0LmJvZHlVc2VkID0gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy51cmwgPSBTdHJpbmcoaW5wdXQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuY3JlZGVudGlhbHMgPSBvcHRpb25zLmNyZWRlbnRpYWxzIHx8IHRoaXMuY3JlZGVudGlhbHMgfHwgInNhbWUtb3JpZ2luIjsKICAgICAgICAgICAgaWYgKG9wdGlvbnMuaGVhZGVycyB8fCAhdGhpcy5oZWFkZXJzKSB7CiAgICAgICAgICAgICAgdGhpcy5oZWFkZXJzID0gbmV3IEhlYWRlcnMob3B0aW9ucy5oZWFkZXJzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLm1ldGhvZCA9IG5vcm1hbGl6ZU1ldGhvZChvcHRpb25zLm1ldGhvZCB8fCB0aGlzLm1ldGhvZCB8fCAiR0VUIik7CiAgICAgICAgICAgIHRoaXMubW9kZSA9IG9wdGlvbnMubW9kZSB8fCB0aGlzLm1vZGUgfHwgbnVsbDsKICAgICAgICAgICAgdGhpcy5zaWduYWwgPSBvcHRpb25zLnNpZ25hbCB8fCB0aGlzLnNpZ25hbDsKICAgICAgICAgICAgdGhpcy5yZWZlcnJlciA9IG51bGw7CiAgICAgICAgICAgIGlmICgodGhpcy5tZXRob2QgPT09ICJHRVQiIHx8IHRoaXMubWV0aG9kID09PSAiSEVBRCIpICYmIGJvZHkpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJCb2R5IG5vdCBhbGxvd2VkIGZvciBHRVQgb3IgSEVBRCByZXF1ZXN0cyIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2luaXRCb2R5KGJvZHkpOwogICAgICAgICAgfQogICAgICAgICAgUmVxdWVzdC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXF1ZXN0KHRoaXMsIHsgYm9keTogdGhpcy5fYm9keUluaXQgfSk7CiAgICAgICAgICB9OwogICAgICAgICAgZnVuY3Rpb24gZGVjb2RlKGJvZHkpIHsKICAgICAgICAgICAgdmFyIGZvcm0gPSBuZXcgRm9ybURhdGEoKTsKICAgICAgICAgICAgYm9keS50cmltKCkuc3BsaXQoIiYiKS5mb3JFYWNoKGZ1bmN0aW9uKGJ5dGVzKSB7CiAgICAgICAgICAgICAgaWYgKGJ5dGVzKSB7CiAgICAgICAgICAgICAgICB2YXIgc3BsaXQgPSBieXRlcy5zcGxpdCgiPSIpOwogICAgICAgICAgICAgICAgdmFyIG5hbWUgPSBzcGxpdC5zaGlmdCgpLnJlcGxhY2UoL1wrL2csICIgIik7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBzcGxpdC5qb2luKCI9IikucmVwbGFjZSgvXCsvZywgIiAiKTsKICAgICAgICAgICAgICAgIGZvcm0uYXBwZW5kKGRlY29kZVVSSUNvbXBvbmVudChuYW1lKSwgZGVjb2RlVVJJQ29tcG9uZW50KHZhbHVlKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIGZvcm07CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBwYXJzZUhlYWRlcnMocmF3SGVhZGVycykgewogICAgICAgICAgICB2YXIgaGVhZGVycyA9IG5ldyBIZWFkZXJzKCk7CiAgICAgICAgICAgIHZhciBwcmVQcm9jZXNzZWRIZWFkZXJzID0gcmF3SGVhZGVycy5yZXBsYWNlKC9ccj9cbltcdCBdKy9nLCAiICIpOwogICAgICAgICAgICBwcmVQcm9jZXNzZWRIZWFkZXJzLnNwbGl0KC9ccj9cbi8pLmZvckVhY2goZnVuY3Rpb24obGluZSkgewogICAgICAgICAgICAgIHZhciBwYXJ0cyA9IGxpbmUuc3BsaXQoIjoiKTsKICAgICAgICAgICAgICB2YXIga2V5ID0gcGFydHMuc2hpZnQoKS50cmltKCk7CiAgICAgICAgICAgICAgaWYgKGtleSkgewogICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gcGFydHMuam9pbigiOiIpLnRyaW0oKTsKICAgICAgICAgICAgICAgIGhlYWRlcnMuYXBwZW5kKGtleSwgdmFsdWUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBoZWFkZXJzOwogICAgICAgICAgfQogICAgICAgICAgQm9keS5jYWxsKFJlcXVlc3QucHJvdG90eXBlKTsKICAgICAgICAgIGZ1bmN0aW9uIFJlc3BvbnNlKGJvZHlJbml0LCBvcHRpb25zKSB7CiAgICAgICAgICAgIGlmICghb3B0aW9ucykgewogICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnR5cGUgPSAiZGVmYXVsdCI7CiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gb3B0aW9ucy5zdGF0dXMgPT09IHZvaWQgMCA/IDIwMCA6IG9wdGlvbnMuc3RhdHVzOwogICAgICAgICAgICB0aGlzLm9rID0gdGhpcy5zdGF0dXMgPj0gMjAwICYmIHRoaXMuc3RhdHVzIDwgMzAwOwogICAgICAgICAgICB0aGlzLnN0YXR1c1RleHQgPSAic3RhdHVzVGV4dCIgaW4gb3B0aW9ucyA/IG9wdGlvbnMuc3RhdHVzVGV4dCA6ICJPSyI7CiAgICAgICAgICAgIHRoaXMuaGVhZGVycyA9IG5ldyBIZWFkZXJzKG9wdGlvbnMuaGVhZGVycyk7CiAgICAgICAgICAgIHRoaXMudXJsID0gb3B0aW9ucy51cmwgfHwgIiI7CiAgICAgICAgICAgIHRoaXMuX2luaXRCb2R5KGJvZHlJbml0KTsKICAgICAgICAgIH0KICAgICAgICAgIEJvZHkuY2FsbChSZXNwb25zZS5wcm90b3R5cGUpOwogICAgICAgICAgUmVzcG9uc2UucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UodGhpcy5fYm9keUluaXQsIHsKICAgICAgICAgICAgICBzdGF0dXM6IHRoaXMuc3RhdHVzLAogICAgICAgICAgICAgIHN0YXR1c1RleHQ6IHRoaXMuc3RhdHVzVGV4dCwKICAgICAgICAgICAgICBoZWFkZXJzOiBuZXcgSGVhZGVycyh0aGlzLmhlYWRlcnMpLAogICAgICAgICAgICAgIHVybDogdGhpcy51cmwKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9OwogICAgICAgICAgUmVzcG9uc2UuZXJyb3IgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gbmV3IFJlc3BvbnNlKG51bGwsIHsgc3RhdHVzOiAwLCBzdGF0dXNUZXh0OiAiIiB9KTsKICAgICAgICAgICAgcmVzcG9uc2UudHlwZSA9ICJlcnJvciI7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZTsKICAgICAgICAgIH07CiAgICAgICAgICB2YXIgcmVkaXJlY3RTdGF0dXNlcyA9IFszMDEsIDMwMiwgMzAzLCAzMDcsIDMwOF07CiAgICAgICAgICBSZXNwb25zZS5yZWRpcmVjdCA9IGZ1bmN0aW9uKHVybCwgc3RhdHVzKSB7CiAgICAgICAgICAgIGlmIChyZWRpcmVjdFN0YXR1c2VzLmluZGV4T2Yoc3RhdHVzKSA9PT0gLTEpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiSW52YWxpZCBzdGF0dXMgY29kZSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UobnVsbCwgeyBzdGF0dXMsIGhlYWRlcnM6IHsgbG9jYXRpb246IHVybCB9IH0pOwogICAgICAgICAgfTsKICAgICAgICAgIGV4cG9ydHMyLkRPTUV4Y2VwdGlvbiA9IHNlbGYyLkRPTUV4Y2VwdGlvbjsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIG5ldyBleHBvcnRzMi5ET01FeGNlcHRpb24oKTsKICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBleHBvcnRzMi5ET01FeGNlcHRpb24gPSBmdW5jdGlvbihtZXNzYWdlLCBuYW1lKSB7CiAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKICAgICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICAgICAgICAgIHZhciBlcnJvciA9IEVycm9yKG1lc3NhZ2UpOwogICAgICAgICAgICAgIHRoaXMuc3RhY2sgPSBlcnJvci5zdGFjazsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgZXhwb3J0czIuRE9NRXhjZXB0aW9uLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoRXJyb3IucHJvdG90eXBlKTsKICAgICAgICAgICAgZXhwb3J0czIuRE9NRXhjZXB0aW9uLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IGV4cG9ydHMyLkRPTUV4Y2VwdGlvbjsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGZldGNoMihpbnB1dCwgaW5pdDIpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gbmV3IFJlcXVlc3QoaW5wdXQsIGluaXQyKTsKICAgICAgICAgICAgICBpZiAocmVxdWVzdC5zaWduYWwgJiYgcmVxdWVzdC5zaWduYWwuYWJvcnRlZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdChuZXcgZXhwb3J0czIuRE9NRXhjZXB0aW9uKCJBYm9ydGVkIiwgIkFib3J0RXJyb3IiKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICAgICAgICBmdW5jdGlvbiBhYm9ydFhocigpIHsKICAgICAgICAgICAgICAgIHhoci5hYm9ydCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB4aHIub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHsKICAgICAgICAgICAgICAgICAgc3RhdHVzOiB4aHIuc3RhdHVzLAogICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0OiB4aHIuc3RhdHVzVGV4dCwKICAgICAgICAgICAgICAgICAgaGVhZGVyczogcGFyc2VIZWFkZXJzKHhoci5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKSB8fCAiIikKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBvcHRpb25zLnVybCA9ICJyZXNwb25zZVVSTCIgaW4geGhyID8geGhyLnJlc3BvbnNlVVJMIDogb3B0aW9ucy5oZWFkZXJzLmdldCgiWC1SZXF1ZXN0LVVSTCIpOwogICAgICAgICAgICAgICAgdmFyIGJvZHkgPSAicmVzcG9uc2UiIGluIHhociA/IHhoci5yZXNwb25zZSA6IHhoci5yZXNwb25zZVRleHQ7CiAgICAgICAgICAgICAgICByZXNvbHZlKG5ldyBSZXNwb25zZShib2R5LCBvcHRpb25zKSk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB4aHIub25lcnJvciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBUeXBlRXJyb3IoIk5ldHdvcmsgcmVxdWVzdCBmYWlsZWQiKSk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB4aHIub250aW1lb3V0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZWplY3QobmV3IFR5cGVFcnJvcigiTmV0d29yayByZXF1ZXN0IGZhaWxlZCIpKTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHhoci5vbmFib3J0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZWplY3QobmV3IGV4cG9ydHMyLkRPTUV4Y2VwdGlvbigiQWJvcnRlZCIsICJBYm9ydEVycm9yIikpOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgeGhyLm9wZW4ocmVxdWVzdC5tZXRob2QsIHJlcXVlc3QudXJsLCB0cnVlKTsKICAgICAgICAgICAgICBpZiAocmVxdWVzdC5jcmVkZW50aWFscyA9PT0gImluY2x1ZGUiKSB7CiAgICAgICAgICAgICAgICB4aHIud2l0aENyZWRlbnRpYWxzID0gdHJ1ZTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlcXVlc3QuY3JlZGVudGlhbHMgPT09ICJvbWl0IikgewogICAgICAgICAgICAgICAgeGhyLndpdGhDcmVkZW50aWFscyA9IGZhbHNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoInJlc3BvbnNlVHlwZSIgaW4geGhyICYmIHN1cHBvcnQuYmxvYikgewogICAgICAgICAgICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9ICJibG9iIjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmVxdWVzdC5oZWFkZXJzLmZvckVhY2goZnVuY3Rpb24odmFsdWUsIG5hbWUpIHsKICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKG5hbWUsIHZhbHVlKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBpZiAocmVxdWVzdC5zaWduYWwpIHsKICAgICAgICAgICAgICAgIHJlcXVlc3Quc2lnbmFsLmFkZEV2ZW50TGlzdGVuZXIoImFib3J0IiwgYWJvcnRYaHIpOwogICAgICAgICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT09IDQpIHsKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNpZ25hbC5yZW1vdmVFdmVudExpc3RlbmVyKCJhYm9ydCIsIGFib3J0WGhyKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgeGhyLnNlbmQodHlwZW9mIHJlcXVlc3QuX2JvZHlJbml0ID09PSAidW5kZWZpbmVkIiA/IG51bGwgOiByZXF1ZXN0Ll9ib2R5SW5pdCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgZmV0Y2gyLnBvbHlmaWxsID0gdHJ1ZTsKICAgICAgICAgIGlmICghc2VsZjIuZmV0Y2gpIHsKICAgICAgICAgICAgc2VsZjIuZmV0Y2ggPSBmZXRjaDI7CiAgICAgICAgICAgIHNlbGYyLkhlYWRlcnMgPSBIZWFkZXJzOwogICAgICAgICAgICBzZWxmMi5SZXF1ZXN0ID0gUmVxdWVzdDsKICAgICAgICAgICAgc2VsZjIuUmVzcG9uc2UgPSBSZXNwb25zZTsKICAgICAgICAgIH0KICAgICAgICAgIGV4cG9ydHMyLkhlYWRlcnMgPSBIZWFkZXJzOwogICAgICAgICAgZXhwb3J0czIuUmVxdWVzdCA9IFJlcXVlc3Q7CiAgICAgICAgICBleHBvcnRzMi5SZXNwb25zZSA9IFJlc3BvbnNlOwogICAgICAgICAgZXhwb3J0czIuZmV0Y2ggPSBmZXRjaDI7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0czIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICAgICAgICAgIHJldHVybiBleHBvcnRzMjsKICAgICAgICB9KHt9KTsKICAgICAgfSkodHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiID8gc2VsZiA6IGV4cG9ydHMpOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGdtb2QvYmFtL2Rpc3QvaHRzZ2V0LmpzCiAgdmFyIHJlcXVpcmVfaHRzZ2V0ID0gX19jb21tb25KUyh7CiAgICAibm9kZV9tb2R1bGVzL0BnbW9kL2JhbS9kaXN0L2h0c2dldC5qcyIoZXhwb3J0cykgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkID0gcmVxdWlyZV9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKCk7CiAgICAgIHZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0ID0gcmVxdWlyZV9pbnRlcm9wUmVxdWlyZURlZmF1bHQoKTsKICAgICAgdmFyIF9PYmplY3QkZGVmaW5lUHJvcGVydHkyID0gcmVxdWlyZV9kZWZpbmVfcHJvcGVydHkzKCk7CiAgICAgIF9PYmplY3QkZGVmaW5lUHJvcGVydHkyKGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICAgIHZhbHVlOiB0cnVlCiAgICAgIH0pOwogICAgICBleHBvcnRzLmRlZmF1bHQgPSB2b2lkIDA7CiAgICAgIHZhciBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKCkpOwogICAgICB2YXIgX3N0YXJ0c1dpdGggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfc3RhcnRzX3dpdGg0KCkpOwogICAgICB2YXIgX21hcCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9tYXA0KCkpOwogICAgICB2YXIgX3Byb21pc2UgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfcHJvbWlzZTUoKSk7CiAgICAgIHZhciBfZGVmaW5lUHJvcGVydHkyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2RlZmluZV9wcm9wZXJ0eTMoKSk7CiAgICAgIHZhciBfZGVmaW5lUHJvcGVydGllcyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9kZWZpbmVfcHJvcGVydGllczMoKSk7CiAgICAgIHZhciBfZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9nZXRfb3duX3Byb3BlcnR5X2Rlc2NyaXB0b3JzMygpKTsKICAgICAgdmFyIF9nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfZ2V0X293bl9wcm9wZXJ0eV9kZXNjcmlwdG9yMygpKTsKICAgICAgdmFyIF9nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfZ2V0X293bl9wcm9wZXJ0eV9zeW1ib2xzMygpKTsKICAgICAgdmFyIF9rZXlzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2tleXMzKCkpOwogICAgICB2YXIgX2NvbnN0cnVjdCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9jb25zdHJ1Y3QzKCkpOwogICAgICB2YXIgX2ZvckVhY2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfZm9yX2VhY2g0KCkpOwogICAgICB2YXIgX2ZpbHRlciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9maWx0ZXI0KCkpOwogICAgICB2YXIgX3JlZ2VuZXJhdG9yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX3JlZ2VuZXJhdG9yKCkpOwogICAgICB2YXIgX3NsaWNlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX3NsaWNlNigpKTsKICAgICAgdmFyIF9jb25jYXQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2NvbmNhdDQoKSk7CiAgICAgIHZhciBfY2xhc3NDYWxsQ2hlY2syID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2NsYXNzQ2FsbENoZWNrKCkpOwogICAgICB2YXIgX2NyZWF0ZUNsYXNzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9jcmVhdGVDbGFzcygpKTsKICAgICAgdmFyIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2Fzc2VydFRoaXNJbml0aWFsaXplZCgpKTsKICAgICAgdmFyIF9pbmhlcml0czIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfaW5oZXJpdHMoKSk7CiAgICAgIHZhciBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybigpKTsKICAgICAgdmFyIF9nZXRQcm90b3R5cGVPZjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfZ2V0UHJvdG90eXBlT2YoKSk7CiAgICAgIHZhciBfZGVmaW5lUHJvcGVydHkzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2RlZmluZVByb3BlcnR5KCkpOwogICAgICB2YXIgX2FzeW5jVG9HZW5lcmF0b3IyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2FzeW5jVG9HZW5lcmF0b3IoKSk7CiAgICAgIHZhciBfd3JhcEFzeW5jR2VuZXJhdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV93cmFwQXN5bmNHZW5lcmF0b3IoKSk7CiAgICAgIHZhciBfYXdhaXRBc3luY0dlbmVyYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfYXdhaXRBc3luY0dlbmVyYXRvcigpKTsKICAgICAgdmFyIF9hc3luY0l0ZXJhdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9hc3luY0l0ZXJhdG9yKCkpOwogICAgICB2YXIgX2FzeW5jR2VuZXJhdG9yRGVsZWdhdGUyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX2FzeW5jR2VuZXJhdG9yRGVsZWdhdGUoKSk7CiAgICAgIHZhciBfYmFtRmlsZSA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmVfYmFtRmlsZSgpKTsKICAgICAgcmVxdWlyZV9icm93c2VyX3BvbHlmaWxsKCk7CiAgICAgIHZhciBfYmd6ZkZpbGVoYW5kbGUgPSByZXF1aXJlX2Rpc3QyKCk7CiAgICAgIHZhciBfc2FtID0gcmVxdWlyZV9zYW0oKTsKICAgICAgZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7CiAgICAgICAgdmFyIGtleXMgPSAoMCwgX2tleXMuZGVmYXVsdCkob2JqZWN0KTsKICAgICAgICBpZiAoX2dldE93blByb3BlcnR5U3ltYm9scy5kZWZhdWx0KSB7CiAgICAgICAgICB2YXIgc3ltYm9scyA9ICgwLCBfZ2V0T3duUHJvcGVydHlTeW1ib2xzLmRlZmF1bHQpKG9iamVjdCk7CiAgICAgICAgICBpZiAoZW51bWVyYWJsZU9ubHkpCiAgICAgICAgICAgIHN5bWJvbHMgPSAoMCwgX2ZpbHRlci5kZWZhdWx0KShzeW1ib2xzKS5jYWxsKHN5bWJvbHMsIGZ1bmN0aW9uKHN5bSkgewogICAgICAgICAgICAgIHJldHVybiAoMCwgX2dldE93blByb3BlcnR5RGVzY3JpcHRvci5kZWZhdWx0KShvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBrZXlzOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OwogICAgICAgICAgaWYgKGkgJSAyKSB7CiAgICAgICAgICAgIHZhciBfY29udGV4dDEzOwogICAgICAgICAgICAoMCwgX2ZvckVhY2guZGVmYXVsdCkoX2NvbnRleHQxMyA9IG93bktleXMoT2JqZWN0KHNvdXJjZSksIHRydWUpKS5jYWxsKF9jb250ZXh0MTMsIGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkzLmRlZmF1bHQpKHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChfZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycy5kZWZhdWx0KSB7CiAgICAgICAgICAgICgwLCBfZGVmaW5lUHJvcGVydGllcy5kZWZhdWx0KSh0YXJnZXQsICgwLCBfZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycy5kZWZhdWx0KShzb3VyY2UpKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBfY29udGV4dDE0OwogICAgICAgICAgICAoMCwgX2ZvckVhY2guZGVmYXVsdCkoX2NvbnRleHQxNCA9IG93bktleXMoT2JqZWN0KHNvdXJjZSkpKS5jYWxsKF9jb250ZXh0MTQsIGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyLmRlZmF1bHQpKHRhcmdldCwga2V5LCAoMCwgX2dldE93blByb3BlcnR5RGVzY3JpcHRvci5kZWZhdWx0KShzb3VyY2UsIGtleSkpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRhcmdldDsKICAgICAgfQogICAgICBmdW5jdGlvbiBfY3JlYXRlU3VwZXIoRGVyaXZlZCkgewogICAgICAgIHZhciBoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0ID0gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpOwogICAgICAgIHJldHVybiBmdW5jdGlvbiBfY3JlYXRlU3VwZXJJbnRlcm5hbCgpIHsKICAgICAgICAgIHZhciBTdXBlciA9ICgwLCBfZ2V0UHJvdG90eXBlT2YyLmRlZmF1bHQpKERlcml2ZWQpLCByZXN1bHQ7CiAgICAgICAgICBpZiAoaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCkgewogICAgICAgICAgICB2YXIgTmV3VGFyZ2V0ID0gKDAsIF9nZXRQcm90b3R5cGVPZjIuZGVmYXVsdCkodGhpcykuY29uc3RydWN0b3I7CiAgICAgICAgICAgIHJlc3VsdCA9ICgwLCBfY29uc3RydWN0LmRlZmF1bHQpKFN1cGVyLCBhcmd1bWVudHMsIE5ld1RhcmdldCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHQgPSBTdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuICgwLCBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybjIuZGVmYXVsdCkodGhpcywgcmVzdWx0KTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7CiAgICAgICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSAidW5kZWZpbmVkIiB8fCAhX2NvbnN0cnVjdC5kZWZhdWx0KQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChfY29uc3RydWN0LmRlZmF1bHQuc2hhbSkKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAodHlwZW9mIFByb3h5ID09PSAiZnVuY3Rpb24iKQogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIERhdGUucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoKDAsIF9jb25zdHJ1Y3QuZGVmYXVsdCkoRGF0ZSwgW10sIGZ1bmN0aW9uKCkgewogICAgICAgICAgfSkpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBjb25jYXQoX3gsIF94MikgewogICAgICAgIHJldHVybiBfY29uY2F0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gX2NvbmNhdCgpIHsKICAgICAgICBfY29uY2F0ID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlNShhcnIsIG9wdHMpIHsKICAgICAgICAgIHZhciByZXM7CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQxNikgewogICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxNi5wcmV2ID0gX2NvbnRleHQxNi5uZXh0KSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTYubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfcHJvbWlzZS5kZWZhdWx0LmFsbCgoMCwgX21hcC5kZWZhdWx0KShhcnIpLmNhbGwoYXJyLCAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIF9yZWYgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KGNodW5rKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgdXJsLCBoZWFkZXJzLCByZWZlcmVyLCByZXN0LCBfcmVzOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvci5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0MTUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTUucHJldiA9IF9jb250ZXh0MTUubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSBjaHVuay51cmwsIGhlYWRlcnMgPSBjaHVuay5oZWFkZXJzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoISgwLCBfc3RhcnRzV2l0aC5kZWZhdWx0KSh1cmwpLmNhbGwodXJsLCAiZGF0YToiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTUubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTUuYWJydXB0KCJyZXR1cm4iLCBpbXBvcnRfYnVmZmVyLkJ1ZmZlci5mcm9tKHVybC5zcGxpdCgiLCIpWzFdLCAiYmFzZTY0IikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVyID0gaGVhZGVycy5yZWZlcmVyLCByZXN0ID0gKDAsIF9vYmplY3RXaXRob3V0UHJvcGVydGllczIuZGVmYXVsdCkoaGVhZGVycywgWyJyZWZlcmVyIl0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE1Lm5leHQgPSA4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmV0Y2godXJsLCBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIG9wdHMpLCB7fSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgb3B0cy5oZWFkZXJzKSwgcmVzdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcmVzID0gX2NvbnRleHQxNS5zZW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX3Jlcy5vaykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTUubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiRmFpbGVkIHRvIGZldGNoICIuY29uY2F0KF9yZXMuc3RhdHVzVGV4dCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxNS50MCA9IGltcG9ydF9idWZmZXIuQnVmZmVyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE1Lm5leHQgPSAxNDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZXMuYXJyYXlCdWZmZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTUudDEgPSBfY29udGV4dDE1LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE1LmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQxNS50MC5mcm9tLmNhbGwoX2NvbnRleHQxNS50MCwgX2NvbnRleHQxNS50MSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE1LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0sIF9jYWxsZWU0KTsKICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKF94NCkgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICB9KCkpKTsKICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgcmVzID0gX2NvbnRleHQxNi5zZW50OwogICAgICAgICAgICAgICAgICBfY29udGV4dDE2LnQwID0gKDAsIF9jb25jYXQyLmRlZmF1bHQpKGltcG9ydF9idWZmZXIuQnVmZmVyKTsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQxNi50MSA9IGltcG9ydF9idWZmZXIuQnVmZmVyOwogICAgICAgICAgICAgICAgICBfY29udGV4dDE2Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgICByZXR1cm4gX3Byb21pc2UuZGVmYXVsdC5hbGwoKDAsIF9tYXAuZGVmYXVsdCkocmVzKS5jYWxsKHJlcywgZnVuY3Rpb24oZWx0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfYmd6ZkZpbGVoYW5kbGUudW56aXApKGVsdCk7CiAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgX2NvbnRleHQxNi50MiA9IF9jb250ZXh0MTYuc2VudDsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTYuYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dDE2LnQwLmNhbGwuY2FsbChfY29udGV4dDE2LnQwLCBfY29udGV4dDE2LnQxLCBfY29udGV4dDE2LnQyKSk7CiAgICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNi5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlNSk7CiAgICAgICAgfSkpOwogICAgICAgIHJldHVybiBfY29uY2F0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgICAgdmFyIEh0c2dldEZpbGUgPSAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24oX0JhbUZpbGUpIHsKICAgICAgICAoMCwgX2luaGVyaXRzMi5kZWZhdWx0KShIdHNnZXRGaWxlMiwgX0JhbUZpbGUpOwogICAgICAgIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoSHRzZ2V0RmlsZTIpOwogICAgICAgIGZ1bmN0aW9uIEh0c2dldEZpbGUyKGFyZ3MpIHsKICAgICAgICAgIHZhciBfdGhpczI7CiAgICAgICAgICAoMCwgX2NsYXNzQ2FsbENoZWNrMi5kZWZhdWx0KSh0aGlzLCBIdHNnZXRGaWxlMik7CiAgICAgICAgICBfdGhpczIgPSBfc3VwZXIuY2FsbCh0aGlzLCB7CiAgICAgICAgICAgIGJhbUZpbGVoYW5kbGU6ICI/IiwKICAgICAgICAgICAgYmFpRmlsZWhhbmRsZTogIj8iCiAgICAgICAgICB9KTsKICAgICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkzLmRlZmF1bHQpKCgwLCBfYXNzZXJ0VGhpc0luaXRpYWxpemVkMi5kZWZhdWx0KShfdGhpczIpLCAiYmFzZVVybCIsIHZvaWQgMCk7CiAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5My5kZWZhdWx0KSgoMCwgX2Fzc2VydFRoaXNJbml0aWFsaXplZDIuZGVmYXVsdCkoX3RoaXMyKSwgInRyYWNrSWQiLCB2b2lkIDApOwogICAgICAgICAgX3RoaXMyLmJhc2VVcmwgPSBhcmdzLmJhc2VVcmw7CiAgICAgICAgICBfdGhpczIudHJhY2tJZCA9IGFyZ3MudHJhY2tJZDsKICAgICAgICAgIHJldHVybiBfdGhpczI7CiAgICAgICAgfQogICAgICAgICgwLCBfY3JlYXRlQ2xhc3MyLmRlZmF1bHQpKEh0c2dldEZpbGUyLCBbewogICAgICAgICAga2V5OiAic3RyZWFtUmVjb3Jkc0ZvclJhbmdlIiwKICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzdHJlYW1SZWNvcmRzRm9yUmFuZ2UoY2hyLCBtaW4sIG1heCkgewogICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgICAgICB2YXIgb3B0cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzNdIDogewogICAgICAgICAgICAgIHZpZXdBc1BhaXJzOiBmYWxzZSwKICAgICAgICAgICAgICBwYWlyQWNyb3NzQ2hyOiBmYWxzZSwKICAgICAgICAgICAgICBtYXhJbnNlcnRTaXplOiAyZTUKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuICgwLCBfd3JhcEFzeW5jR2VuZXJhdG9yMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgICAgICAgIHZhciBfY29udGV4dCwgX2NvbnRleHQyLCBfY29udGV4dDMsIF9jb250ZXh0NCwgX2NvbnRleHQ1OwogICAgICAgICAgICAgIHZhciBiYXNlLCB1cmwsIGNocklkLCByZXN1bHQsIGRhdGEsIHVuY2JhLCBjaHVuazsKICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dDgpIHsKICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ4LnByZXYgPSBfY29udGV4dDgubmV4dCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIGJhc2UgPSAoMCwgX2NvbmNhdDIuZGVmYXVsdCkoX2NvbnRleHQgPSAiIi5jb25jYXQoX3RoaXMuYmFzZVVybCwgIi8iKSkuY2FsbChfY29udGV4dCwgX3RoaXMudHJhY2tJZCk7CiAgICAgICAgICAgICAgICAgICAgICB1cmwgPSAoMCwgX2NvbmNhdDIuZGVmYXVsdCkoX2NvbnRleHQyID0gKDAsIF9jb25jYXQyLmRlZmF1bHQpKF9jb250ZXh0MyA9ICgwLCBfY29uY2F0Mi5kZWZhdWx0KShfY29udGV4dDQgPSAiIi5jb25jYXQoYmFzZSwgIj9yZWZlcmVuY2VOYW1lPSIpKS5jYWxsKF9jb250ZXh0NCwgY2hyLCAiJnN0YXJ0PSIpKS5jYWxsKF9jb250ZXh0MywgbWluLCAiJmVuZD0iKSkuY2FsbChfY29udGV4dDIsIG1heCwgIiZmb3JtYXQ9QkFNIik7CiAgICAgICAgICAgICAgICAgICAgICBjaHJJZCA9IF90aGlzLmNoclRvSW5kZXggJiYgX3RoaXMuY2hyVG9JbmRleFtjaHJdOwogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfYXdhaXRBc3luY0dlbmVyYXRvcjIuZGVmYXVsdCkoZmV0Y2godXJsLCBfb2JqZWN0U3ByZWFkKHt9LCBvcHRzKSkpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IF9jb250ZXh0OC5zZW50OwogICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5vaykgewogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDg7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlc3VsdC5zdGF0dXNUZXh0KTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDEwOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfYXdhaXRBc3luY0dlbmVyYXRvcjIuZGVmYXVsdCkocmVzdWx0Lmpzb24oKSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBfY29udGV4dDguc2VudDsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKDAsIF9hd2FpdEFzeW5jR2VuZXJhdG9yMi5kZWZhdWx0KShjb25jYXQoKDAsIF9zbGljZS5kZWZhdWx0KShfY29udGV4dDUgPSBkYXRhLmh0c2dldC51cmxzKS5jYWxsKF9jb250ZXh0NSwgMSksIG9wdHMpKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgICAgICAgdW5jYmEgPSBfY29udGV4dDguc2VudDsKICAgICAgICAgICAgICAgICAgICAgIGNodW5rID0gewogICAgICAgICAgICAgICAgICAgICAgICBidWZmZXI6IHVuY2JhLAogICAgICAgICAgICAgICAgICAgICAgICBjaHVuazogewogICAgICAgICAgICAgICAgICAgICAgICAgIG1pbnY6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFQb3NpdGlvbjogMAogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uIHRvU3RyaW5nKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfY29udGV4dDYsIF9jb250ZXh0NzsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKDAsIF9jb25jYXQyLmRlZmF1bHQpKF9jb250ZXh0NiA9ICgwLCBfY29uY2F0Mi5kZWZhdWx0KShfY29udGV4dDcgPSAiIi5jb25jYXQoY2hyLCAiXyIpKS5jYWxsKF9jb250ZXh0NywgbWluLCAiXyIpKS5jYWxsKF9jb250ZXh0NiwgbWF4KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguZGVsZWdhdGVZaWVsZCgoMCwgX2FzeW5jR2VuZXJhdG9yRGVsZWdhdGUyLmRlZmF1bHQpKCgwLCBfYXN5bmNJdGVyYXRvcjIuZGVmYXVsdCkoX3RoaXMuX2ZldGNoQ2h1bmtGZWF0dXJlcyhbY2h1bmtdLCBjaHJJZCwgbWluLCBtYXgsIG9wdHMpKSwgX2F3YWl0QXN5bmNHZW5lcmF0b3IyLmRlZmF1bHQpLCAidDAiLCAxNik7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgICAgICAgfSkpKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAga2V5OiAiX3JlYWRDaHVuayIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBfcmVhZENodW5rMiA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvci5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIocGFyYW1zKSB7CiAgICAgICAgICAgICAgdmFyIGNodW5rLCBidWZmZXIsIGMyOwogICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDkpIHsKICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ5LnByZXYgPSBfY29udGV4dDkubmV4dCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIGNodW5rID0gcGFyYW1zLmNodW5rOwogICAgICAgICAgICAgICAgICAgICAgYnVmZmVyID0gY2h1bmsuYnVmZmVyLCBjMiA9IGNodW5rLmNodW5rOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogYnVmZmVyLAogICAgICAgICAgICAgICAgICAgICAgICBjcG9zaXRpb25zOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBkcG9zaXRpb25zOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBjaHVuazogYzIKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCBfY2FsbGVlMik7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgZnVuY3Rpb24gX3JlYWRDaHVuayhfeDMpIHsKICAgICAgICAgICAgICByZXR1cm4gX3JlYWRDaHVuazIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gX3JlYWRDaHVuazsKICAgICAgICAgIH0oKQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogImdldEhlYWRlciIsCiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBfZ2V0SGVhZGVyID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlMygpIHsKICAgICAgICAgICAgICB2YXIgX2NvbnRleHQxMDsKICAgICAgICAgICAgICB2YXIgb3B0cywgdXJsLCByZXN1bHQsIGRhdGEsIHVuY2JhLCBoZWFkTGVuLCBoZWFkZXJUZXh0LCBzYW1IZWFkZXIsIGlkVG9OYW1lLCBuYW1lVG9JZCwgc3FMaW5lcywgX2FyZ3MzID0gYXJndW1lbnRzOwogICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDEyKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTIucHJldiA9IF9jb250ZXh0MTIubmV4dCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIG9wdHMgPSBfYXJnczMubGVuZ3RoID4gMCAmJiBfYXJnczNbMF0gIT09IHZvaWQgMCA/IF9hcmdzM1swXSA6IHt9OwogICAgICAgICAgICAgICAgICAgICAgdXJsID0gKDAsIF9jb25jYXQyLmRlZmF1bHQpKF9jb250ZXh0MTAgPSAiIi5jb25jYXQodGhpcy5iYXNlVXJsLCAiLyIpKS5jYWxsKF9jb250ZXh0MTAsIHRoaXMudHJhY2tJZCwgIj9yZWZlcmVuY2VOYW1lPW5hJmNsYXNzPWhlYWRlciIpOwogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMi5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmZXRjaCh1cmwsIG9wdHMpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IF9jb250ZXh0MTIuc2VudDsKICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQub2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMi5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkZhaWxlZCB0byBmZXRjaCAiLmNvbmNhdChyZXN1bHQuc3RhdHVzVGV4dCkpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTIubmV4dCA9IDk7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Lmpzb24oKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gX2NvbnRleHQxMi5zZW50OwogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMi5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uY2F0KGRhdGEuaHRzZ2V0LnVybHMsIG9wdHMpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICAgICAgICB1bmNiYSA9IF9jb250ZXh0MTIuc2VudDsKICAgICAgICAgICAgICAgICAgICAgIGlmICghKHVuY2JhLnJlYWRJbnQzMkxFKDApICE9PSBfYmFtRmlsZS5CQU1fTUFHSUMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTIubmV4dCA9IDE1OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTm90IGEgQkFNIGZpbGUiKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgICAgICAgaGVhZExlbiA9IHVuY2JhLnJlYWRJbnQzMkxFKDQpOwogICAgICAgICAgICAgICAgICAgICAgaGVhZGVyVGV4dCA9IHVuY2JhLnRvU3RyaW5nKCJ1dGY4IiwgOCwgOCArIGhlYWRMZW4pOwogICAgICAgICAgICAgICAgICAgICAgc2FtSGVhZGVyID0gKDAsIF9zYW0ucGFyc2VIZWFkZXJUZXh0KShoZWFkZXJUZXh0KTsKICAgICAgICAgICAgICAgICAgICAgIGlkVG9OYW1lID0gW107CiAgICAgICAgICAgICAgICAgICAgICBuYW1lVG9JZCA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgc3FMaW5lcyA9ICgwLCBfZmlsdGVyLmRlZmF1bHQpKHNhbUhlYWRlcikuY2FsbChzYW1IZWFkZXIsIGZ1bmN0aW9uKGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGwudGFnID09PSAiU1EiOwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAoMCwgX2ZvckVhY2guZGVmYXVsdCkoc3FMaW5lcykuY2FsbChzcUxpbmVzLCBmdW5jdGlvbihzcUxpbmUsIHJlZklkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfY29udGV4dDExOwogICAgICAgICAgICAgICAgICAgICAgICAoMCwgX2ZvckVhY2guZGVmYXVsdCkoX2NvbnRleHQxMSA9IHNxTGluZS5kYXRhKS5jYWxsKF9jb250ZXh0MTEsIGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS50YWcgPT09ICJTTiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZWZOYW1lID0gaXRlbS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVUb0lkW3JlZk5hbWVdID0gcmVmSWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZFRvTmFtZVtyZWZJZF0gPSByZWZOYW1lOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2hyVG9JbmRleCA9IG5hbWVUb0lkOwogICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbmRleFRvQ2hyID0gaWRUb05hbWU7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMi5hYnJ1cHQoInJldHVybiIsIHNhbUhlYWRlcik7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyNToKICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTIuc3RvcCgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgX2NhbGxlZTMsIHRoaXMpOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEhlYWRlcigpIHsKICAgICAgICAgICAgICByZXR1cm4gX2dldEhlYWRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBnZXRIZWFkZXI7CiAgICAgICAgICB9KCkKICAgICAgICB9XSk7CiAgICAgICAgcmV0dXJuIEh0c2dldEZpbGUyOwogICAgICB9KF9iYW1GaWxlLmRlZmF1bHQpOwogICAgICBleHBvcnRzLmRlZmF1bHQgPSBIdHNnZXRGaWxlOwogICAgfQogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvQGdtb2QvYmFtL2Rpc3QvaW5kZXguanMKICB2YXIgcmVxdWlyZV9kaXN0NCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9AZ21vZC9iYW0vZGlzdC9pbmRleC5qcyIoZXhwb3J0cykgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlX2ludGVyb3BSZXF1aXJlRGVmYXVsdCgpOwogICAgICB2YXIgX09iamVjdCRkZWZpbmVQcm9wZXJ0eSA9IHJlcXVpcmVfZGVmaW5lX3Byb3BlcnR5MygpOwogICAgICBfT2JqZWN0JGRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICAgIHZhbHVlOiB0cnVlCiAgICAgIH0pOwogICAgICBfT2JqZWN0JGRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJCQUkiLCB7CiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldDIoKSB7CiAgICAgICAgICByZXR1cm4gX2JhaS5kZWZhdWx0OwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIF9PYmplY3QkZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIkNTSSIsIHsKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0MigpIHsKICAgICAgICAgIHJldHVybiBfY3NpLmRlZmF1bHQ7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgX09iamVjdCRkZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiQmFtRmlsZSIsIHsKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0MigpIHsKICAgICAgICAgIHJldHVybiBfYmFtRmlsZS5kZWZhdWx0OwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIF9PYmplY3QkZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIkh0c2dldEZpbGUiLCB7CiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldDIoKSB7CiAgICAgICAgICByZXR1cm4gX2h0c2dldC5kZWZhdWx0OwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIF9PYmplY3QkZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIkJhbVJlY29yZCIsIHsKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0MigpIHsKICAgICAgICAgIHJldHVybiBfcmVjb3JkLmRlZmF1bHQ7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdmFyIF9iYWkgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmVfYmFpKCkpOwogICAgICB2YXIgX2NzaSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9jc2koKSk7CiAgICAgIHZhciBfYmFtRmlsZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9iYW1GaWxlKCkpOwogICAgICB2YXIgX2h0c2dldCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZV9odHNnZXQoKSk7CiAgICAgIHZhciBfcmVjb3JkID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlX3JlY29yZCgpKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL3lhbGxpc3QvaXRlcmF0b3IuanMKICB2YXIgcmVxdWlyZV9pdGVyYXRvcjUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMveWFsbGlzdC9pdGVyYXRvci5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIGluaXRfYnVmZmVyX3NoaW0oKTsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKFlhbGxpc3QpIHsKICAgICAgICBZYWxsaXN0LnByb3RvdHlwZVtTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24qICgpIHsKICAgICAgICAgIGZvciAobGV0IHdhbGtlciA9IHRoaXMuaGVhZDsgd2Fsa2VyOyB3YWxrZXIgPSB3YWxrZXIubmV4dCkgewogICAgICAgICAgICB5aWVsZCB3YWxrZXIudmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL3lhbGxpc3QveWFsbGlzdC5qcwogIHZhciByZXF1aXJlX3lhbGxpc3QgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMveWFsbGlzdC95YWxsaXN0LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgaW5pdF9idWZmZXJfc2hpbSgpOwogICAgICAidXNlIHN0cmljdCI7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gWWFsbGlzdDsKICAgICAgWWFsbGlzdC5Ob2RlID0gTm9kZTsKICAgICAgWWFsbGlzdC5jcmVhdGUgPSBZYWxsaXN0OwogICAgICBmdW5jdGlvbiBZYWxsaXN0KGxpc3QpIHsKICAgICAgICB2YXIgc2VsZjIgPSB0aGlzOwogICAgICAgIGlmICghKHNlbGYyIGluc3RhbmNlb2YgWWFsbGlzdCkpIHsKICAgICAgICAgIHNlbGYyID0gbmV3IFlhbGxpc3QoKTsKICAgICAgICB9CiAgICAgICAgc2VsZjIudGFpbCA9IG51bGw7CiAgICAgICAgc2VsZjIuaGVhZCA9IG51bGw7CiAgICAgICAgc2VsZjIubGVuZ3RoID0gMDsKICAgICAgICBpZiAobGlzdCAmJiB0eXBlb2YgbGlzdC5mb3JFYWNoID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICBsaXN0LmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgICBzZWxmMi5wdXNoKGl0ZW0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMCkgewogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgIHNlbGYyLnB1c2goYXJndW1lbnRzW2ldKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGYyOwogICAgICB9CiAgICAgIFlhbGxpc3QucHJvdG90eXBlLnJlbW92ZU5vZGUgPSBmdW5jdGlvbihub2RlKSB7CiAgICAgICAgaWYgKG5vZGUubGlzdCAhPT0gdGhpcykgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJyZW1vdmluZyBub2RlIHdoaWNoIGRvZXMgbm90IGJlbG9uZyB0byB0aGlzIGxpc3QiKTsKICAgICAgICB9CiAgICAgICAgdmFyIG5leHQgPSBub2RlLm5leHQ7CiAgICAgICAgdmFyIHByZXYgPSBub2RlLnByZXY7CiAgICAgICAgaWYgKG5leHQpIHsKICAgICAgICAgIG5leHQucHJldiA9IHByZXY7CiAgICAgICAgfQogICAgICAgIGlmIChwcmV2KSB7CiAgICAgICAgICBwcmV2Lm5leHQgPSBuZXh0OwogICAgICAgIH0KICAgICAgICBpZiAobm9kZSA9PT0gdGhpcy5oZWFkKSB7CiAgICAgICAgICB0aGlzLmhlYWQgPSBuZXh0OwogICAgICAgIH0KICAgICAgICBpZiAobm9kZSA9PT0gdGhpcy50YWlsKSB7CiAgICAgICAgICB0aGlzLnRhaWwgPSBwcmV2OwogICAgICAgIH0KICAgICAgICBub2RlLmxpc3QubGVuZ3RoLS07CiAgICAgICAgbm9kZS5uZXh0ID0gbnVsbDsKICAgICAgICBub2RlLnByZXYgPSBudWxsOwogICAgICAgIG5vZGUubGlzdCA9IG51bGw7CiAgICAgICAgcmV0dXJuIG5leHQ7CiAgICAgIH07CiAgICAgIFlhbGxpc3QucHJvdG90eXBlLnVuc2hpZnROb2RlID0gZnVuY3Rpb24obm9kZSkgewogICAgICAgIGlmIChub2RlID09PSB0aGlzLmhlYWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKG5vZGUubGlzdCkgewogICAgICAgICAgbm9kZS5saXN0LnJlbW92ZU5vZGUobm9kZSk7CiAgICAgICAgfQogICAgICAgIHZhciBoZWFkID0gdGhpcy5oZWFkOwogICAgICAgIG5vZGUubGlzdCA9IHRoaXM7CiAgICAgICAgbm9kZS5uZXh0ID0gaGVhZDsKICAgICAgICBpZiAoaGVhZCkgewogICAgICAgICAgaGVhZC5wcmV2ID0gbm9kZTsKICAgICAgICB9CiAgICAgICAgdGhpcy5oZWFkID0gbm9kZTsKICAgICAgICBpZiAoIXRoaXMudGFpbCkgewogICAgICAgICAgdGhpcy50YWlsID0gbm9kZTsKICAgICAgICB9CiAgICAgICAgdGhpcy5sZW5ndGgrKzsKICAgICAgfTsKICAgICAgWWFsbGlzdC5wcm90b3R5cGUucHVzaE5vZGUgPSBmdW5jdGlvbihub2RlKSB7CiAgICAgICAgaWYgKG5vZGUgPT09IHRoaXMudGFpbCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAobm9kZS5saXN0KSB7CiAgICAgICAgICBub2RlLmxpc3QucmVtb3ZlTm9kZShub2RlKTsKICAgICAgICB9CiAgICAgICAgdmFyIHRhaWwgPSB0aGlzLnRhaWw7CiAgICAgICAgbm9kZS5saXN0ID0gdGhpczsKICAgICAgICBub2RlLnByZXYgPSB0YWlsOwogICAgICAgIGlmICh0YWlsKSB7CiAgICAgICAgICB0YWlsLm5leHQgPSBub2RlOwogICAgICAgIH0KICAgICAgICB0aGlzLnRhaWwgPSBub2RlOwogICAgICAgIGlmICghdGhpcy5oZWFkKSB7CiAgICAgICAgICB0aGlzLmhlYWQgPSBub2RlOwogICAgICAgIH0KICAgICAgICB0aGlzLmxlbmd0aCsrOwogICAgICB9OwogICAgICBZYWxsaXN0LnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24oKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBwdXNoKHRoaXMsIGFyZ3VtZW50c1tpXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmxlbmd0aDsKICAgICAgfTsKICAgICAgWWFsbGlzdC5wcm90b3R5cGUudW5zaGlmdCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgdW5zaGlmdCh0aGlzLCBhcmd1bWVudHNbaV0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5sZW5ndGg7CiAgICAgIH07CiAgICAgIFlhbGxpc3QucHJvdG90eXBlLnBvcCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICghdGhpcy50YWlsKSB7CiAgICAgICAgICByZXR1cm4gdm9pZCAwOwogICAgICAgIH0KICAgICAgICB2YXIgcmVzID0gdGhpcy50YWlsLnZhbHVlOwogICAgICAgIHRoaXMudGFpbCA9IHRoaXMudGFpbC5wcmV2OwogICAgICAgIGlmICh0aGlzLnRhaWwpIHsKICAgICAgICAgIHRoaXMudGFpbC5uZXh0ID0gbnVsbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5oZWFkID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgdGhpcy5sZW5ndGgtLTsKICAgICAgICByZXR1cm4gcmVzOwogICAgICB9OwogICAgICBZYWxsaXN0LnByb3RvdHlwZS5zaGlmdCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICghdGhpcy5oZWFkKSB7CiAgICAgICAgICByZXR1cm4gdm9pZCAwOwogICAgICAgIH0KICAgICAgICB2YXIgcmVzID0gdGhpcy5oZWFkLnZhbHVlOwogICAgICAgIHRoaXMuaGVhZCA9IHRoaXMuaGVhZC5uZXh0OwogICAgICAgIGlmICh0aGlzLmhlYWQpIHsKICAgICAgICAgIHRoaXMuaGVhZC5wcmV2ID0gbnVsbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy50YWlsID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgdGhpcy5sZW5ndGgtLTsKICAgICAgICByZXR1cm4gcmVzOwogICAgICB9OwogICAgICBZYWxsaXN0LnByb3RvdHlwZS5mb3JFYWNoID0gZnVuY3Rpb24oZm4sIHRoaXNwKSB7CiAgICAgICAgdGhpc3AgPSB0aGlzcCB8fCB0aGlzOwogICAgICAgIGZvciAodmFyIHdhbGtlciA9IHRoaXMuaGVhZCwgaSA9IDA7IHdhbGtlciAhPT0gbnVsbDsgaSsrKSB7CiAgICAgICAgICBmbi5jYWxsKHRoaXNwLCB3YWxrZXIudmFsdWUsIGksIHRoaXMpOwogICAgICAgICAgd2Fsa2VyID0gd2Fsa2VyLm5leHQ7CiAgICAgICAgfQogICAgICB9OwogICAgICBZYWxsaXN0LnByb3RvdHlwZS5mb3JFYWNoUmV2ZXJzZSA9IGZ1bmN0aW9uKGZuLCB0aGlzcCkgewogICAgICAgIHRoaXNwID0gdGhpc3AgfHwgdGhpczsKICAgICAgICBmb3IgKHZhciB3YWxrZXIgPSB0aGlzLnRhaWwsIGkgPSB0aGlzLmxlbmd0aCAtIDE7IHdhbGtlciAhPT0gbnVsbDsgaS0tKSB7CiAgICAgICAgICBmbi5jYWxsKHRoaXNwLCB3YWxrZXIudmFsdWUsIGksIHRoaXMpOwogICAgICAgICAgd2Fsa2VyID0gd2Fsa2VyLnByZXY7CiAgICAgICAgfQogICAgICB9OwogICAgICBZYWxsaXN0LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbihuKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIHdhbGtlciA9IHRoaXMuaGVhZDsgd2Fsa2VyICE9PSBudWxsICYmIGkgPCBuOyBpKyspIHsKICAgICAgICAgIHdhbGtlciA9IHdhbGtlci5uZXh0OwogICAgICAgIH0KICAgICAgICBpZiAoaSA9PT0gbiAmJiB3YWxrZXIgIT09IG51bGwpIHsKICAgICAgICAgIHJldHVybiB3YWxrZXIudmFsdWU7CiAgICAgICAgfQogICAgICB9OwogICAgICBZYWxsaXN0LnByb3RvdHlwZS5nZXRSZXZlcnNlID0gZnVuY3Rpb24obikgewogICAgICAgIGZvciAodmFyIGkgPSAwLCB3YWxrZXIgPSB0aGlzLnRhaWw7IHdhbGtlciAhPT0gbnVsbCAmJiBpIDwgbjsgaSsrKSB7CiAgICAgICAgICB3YWxrZXIgPSB3YWxrZXIucHJldjsKICAgICAgICB9CiAgICAgICAgaWYgKGkgPT09IG4gJiYgd2Fsa2VyICE9PSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gd2Fsa2VyLnZhbHVlOwogICAgICAgIH0KICAgICAgfTsKICAgICAgWWFsbGlzdC5wcm90b3R5cGUubWFwID0gZnVuY3Rpb24oZm4sIHRoaXNwKSB7CiAgICAgICAgdGhpc3AgPSB0aGlzcCB8fCB0aGlzOwogICAgICAgIHZhciByZXMgPSBuZXcgWWFsbGlzdCgpOwogICAgICAgIGZvciAodmFyIHdhbGtlciA9IHRoaXMuaGVhZDsgd2Fsa2VyICE9PSBudWxsOyApIHsKICAgICAgICAgIHJlcy5wdXNoKGZuLmNhbGwodGhpc3AsIHdhbGtlci52YWx1ZSwgdGhpcykpOwogICAgICAgICAgd2Fsa2VyID0gd2Fsa2VyLm5leHQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXM7CiAgICAgIH07CiAgICAgIFlhbGxpc3QucHJvdG90eXBlLm1hcFJldmVyc2UgPSBmdW5jdGlvbihmbiwgdGhpc3ApIHsKICAgICAgICB0aGlzcCA9IHRoaXNwIHx8IHRoaXM7CiAgICAgICAgdmFyIHJlcyA9IG5ldyBZYWxsaXN0KCk7CiAgICAgICAgZm9yICh2YXIgd2Fsa2VyID0gdGhpcy50YWlsOyB3YWxrZXIgIT09IG51bGw7ICkgewogICAgICAgICAgcmVzLnB1c2goZm4uY2FsbCh0aGlzcCwgd2Fsa2VyLnZhbHVlLCB0aGlzKSk7CiAgICAgICAgICB3YWxrZXIgPSB3YWxrZXIucHJldjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlczsKICAgICAgfTsKICAgICAgWWFsbGlzdC5wcm90b3R5cGUucmVkdWNlID0gZnVuY3Rpb24oZm4sIGluaXRpYWwpIHsKICAgICAgICB2YXIgYWNjOwogICAgICAgIHZhciB3YWxrZXIgPSB0aGlzLmhlYWQ7CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7CiAgICAgICAgICBhY2MgPSBpbml0aWFsOwogICAgICAgIH0gZWxzZSBpZiAodGhpcy5oZWFkKSB7CiAgICAgICAgICB3YWxrZXIgPSB0aGlzLmhlYWQubmV4dDsKICAgICAgICAgIGFjYyA9IHRoaXMuaGVhZC52YWx1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiUmVkdWNlIG9mIGVtcHR5IGxpc3Qgd2l0aCBubyBpbml0aWFsIHZhbHVlIik7CiAgICAgICAgfQogICAgICAgIGZvciAodmFyIGkgPSAwOyB3YWxrZXIgIT09IG51bGw7IGkrKykgewogICAgICAgICAgYWNjID0gZm4oYWNjLCB3YWxrZXIudmFsdWUsIGkpOwogICAgICAgICAgd2Fsa2VyID0gd2Fsa2VyLm5leHQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhY2M7CiAgICAgIH07CiAgICAgIFlhbGxpc3QucHJvdG90eXBlLnJlZHVjZVJldmVyc2UgPSBmdW5jdGlvbihmbiwgaW5pdGlhbCkgewogICAgICAgIHZhciBhY2M7CiAgICAgICAgdmFyIHdhbGtlciA9IHRoaXMudGFpbDsKICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgIGFjYyA9IGluaXRpYWw7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnRhaWwpIHsKICAgICAgICAgIHdhbGtlciA9IHRoaXMudGFpbC5wcmV2OwogICAgICAgICAgYWNjID0gdGhpcy50YWlsLnZhbHVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJSZWR1Y2Ugb2YgZW1wdHkgbGlzdCB3aXRoIG5vIGluaXRpYWwgdmFsdWUiKTsKICAgICAgICB9CiAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMubGVuZ3RoIC0gMTsgd2Fsa2VyICE9PSBudWxsOyBpLS0pIHsKICAgICAgICAgIGFjYyA9IGZuKGFjYywgd2Fsa2VyLnZhbHVlLCBpKTsKICAgICAgICAgIHdhbGtlciA9IHdhbGtlci5wcmV2OwogICAgICAgIH0KICAgICAgICByZXR1cm4gYWNjOwogICAgICB9OwogICAgICBZYWxsaXN0LnByb3RvdHlwZS50b0FycmF5ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGFyciA9IG5ldyBBcnJheSh0aGlzLmxlbmd0aCk7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIHdhbGtlciA9IHRoaXMuaGVhZDsgd2Fsa2VyICE9PSBudWxsOyBpKyspIHsKICAgICAgICAgIGFycltpXSA9IHdhbGtlci52YWx1ZTsKICAgICAgICAgIHdhbGtlciA9IHdhbGtlci5uZXh0OwogICAgICAgIH0KICAgICAgICByZXR1cm4gYXJyOwogICAgICB9OwogICAgICBZYWxsaXN0LnByb3RvdHlwZS50b0FycmF5UmV2ZXJzZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBhcnIgPSBuZXcgQXJyYXkodGhpcy5sZW5ndGgpOwogICAgICAgIGZvciAodmFyIGkgPSAwLCB3YWxrZXIgPSB0aGlzLnRhaWw7IHdhbGtlciAhPT0gbnVsbDsgaSsrKSB7CiAgICAgICAgICBhcnJbaV0gPSB3YWxrZXIudmFsdWU7CiAgICAgICAgICB3YWxrZXIgPSB3YWxrZXIucHJldjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFycjsKICAgICAgfTsKICAgICAgWWFsbGlzdC5wcm90b3R5cGUuc2xpY2UgPSBmdW5jdGlvbihmcm9tLCB0bykgewogICAgICAgIHRvID0gdG8gfHwgdGhpcy5sZW5ndGg7CiAgICAgICAgaWYgKHRvIDwgMCkgewogICAgICAgICAgdG8gKz0gdGhpcy5sZW5ndGg7CiAgICAgICAgfQogICAgICAgIGZyb20gPSBmcm9tIHx8IDA7CiAgICAgICAgaWYgKGZyb20gPCAwKSB7CiAgICAgICAgICBmcm9tICs9IHRoaXMubGVuZ3RoOwogICAgICAgIH0KICAgICAgICB2YXIgcmV0ID0gbmV3IFlhbGxpc3QoKTsKICAgICAgICBpZiAodG8gPCBmcm9tIHx8IHRvIDwgMCkgewogICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICB9CiAgICAgICAgaWYgKGZyb20gPCAwKSB7CiAgICAgICAgICBmcm9tID0gMDsKICAgICAgICB9CiAgICAgICAgaWYgKHRvID4gdGhpcy5sZW5ndGgpIHsKICAgICAgICAgIHRvID0gdGhpcy5sZW5ndGg7CiAgICAgICAgfQogICAgICAgIGZvciAodmFyIGkgPSAwLCB3YWxrZXIgPSB0aGlzLmhlYWQ7IHdhbGtlciAhPT0gbnVsbCAmJiBpIDwgZnJvbTsgaSsrKSB7CiAgICAgICAgICB3YWxrZXIgPSB3YWxrZXIubmV4dDsKICAgICAgICB9CiAgICAgICAgZm9yICg7IHdhbGtlciAhPT0gbnVsbCAmJiBpIDwgdG87IGkrKywgd2Fsa2VyID0gd2Fsa2VyLm5leHQpIHsKICAgICAgICAgIHJldC5wdXNoKHdhbGtlci52YWx1ZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXQ7CiAgICAgIH07CiAgICAgIFlhbGxpc3QucHJvdG90eXBlLnNsaWNlUmV2ZXJzZSA9IGZ1bmN0aW9uKGZyb20sIHRvKSB7CiAgICAgICAgdG8gPSB0byB8fCB0aGlzLmxlbmd0aDsKICAgICAgICBpZiAodG8gPCAwKSB7CiAgICAgICAgICB0byArPSB0aGlzLmxlbmd0aDsKICAgICAgICB9CiAgICAgICAgZnJvbSA9IGZyb20gfHwgMDsKICAgICAgICBpZiAoZnJvbSA8IDApIHsKICAgICAgICAgIGZyb20gKz0gdGhpcy5sZW5ndGg7CiAgICAgICAgfQogICAgICAgIHZhciByZXQgPSBuZXcgWWFsbGlzdCgpOwogICAgICAgIGlmICh0byA8IGZyb20gfHwgdG8gPCAwKSB7CiAgICAgICAgICByZXR1cm4gcmV0OwogICAgICAgIH0KICAgICAgICBpZiAoZnJvbSA8IDApIHsKICAgICAgICAgIGZyb20gPSAwOwogICAgICAgIH0KICAgICAgICBpZiAodG8gPiB0aGlzLmxlbmd0aCkgewogICAgICAgICAgdG8gPSB0aGlzLmxlbmd0aDsKICAgICAgICB9CiAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMubGVuZ3RoLCB3YWxrZXIgPSB0aGlzLnRhaWw7IHdhbGtlciAhPT0gbnVsbCAmJiBpID4gdG87IGktLSkgewogICAgICAgICAgd2Fsa2VyID0gd2Fsa2VyLnByZXY7CiAgICAgICAgfQogICAgICAgIGZvciAoOyB3YWxrZXIgIT09IG51bGwgJiYgaSA+IGZyb207IGktLSwgd2Fsa2VyID0gd2Fsa2VyLnByZXYpIHsKICAgICAgICAgIHJldC5wdXNoKHdhbGtlci52YWx1ZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXQ7CiAgICAgIH07CiAgICAgIFlhbGxpc3QucHJvdG90eXBlLnNwbGljZSA9IGZ1bmN0aW9uKHN0YXJ0LCBkZWxldGVDb3VudCwgLi4ubm9kZXMpIHsKICAgICAgICBpZiAoc3RhcnQgPiB0aGlzLmxlbmd0aCkgewogICAgICAgICAgc3RhcnQgPSB0aGlzLmxlbmd0aCAtIDE7CiAgICAgICAgfQogICAgICAgIGlmIChzdGFydCA8IDApIHsKICAgICAgICAgIHN0YXJ0ID0gdGhpcy5sZW5ndGggKyBzdGFydDsKICAgICAgICB9CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIHdhbGtlciA9IHRoaXMuaGVhZDsgd2Fsa2VyICE9PSBudWxsICYmIGkgPCBzdGFydDsgaSsrKSB7CiAgICAgICAgICB3YWxrZXIgPSB3YWxrZXIubmV4dDsKICAgICAgICB9CiAgICAgICAgdmFyIHJldCA9IFtdOwogICAgICAgIGZvciAodmFyIGkgPSAwOyB3YWxrZXIgJiYgaSA8IGRlbGV0ZUNvdW50OyBpKyspIHsKICAgICAgICAgIHJldC5wdXNoKHdhbGtlci52YWx1ZSk7CiAgICAgICAgICB3YWxrZXIgPSB0aGlzLnJlbW92ZU5vZGUod2Fsa2VyKTsKICAgICAgICB9CiAgICAgICAgaWYgKHdhbGtlciA9PT0gbnVsbCkgewogICAgICAgICAgd2Fsa2VyID0gdGhpcy50YWlsOwogICAgICAgIH0KICAgICAgICBpZiAod2Fsa2VyICE9PSB0aGlzLmhlYWQgJiYgd2Fsa2VyICE9PSB0aGlzLnRhaWwpIHsKICAgICAgICAgIHdhbGtlciA9IHdhbGtlci5wcmV2OwogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB3YWxrZXIgPSBpbnNlcnQodGhpcywgd2Fsa2VyLCBub2Rlc1tpXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXQ7CiAgICAgIH07CiAgICAgIFlhbGxpc3QucHJvdG90eXBlLnJldmVyc2UgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgaGVhZCA9IHRoaXMuaGVhZDsKICAgICAgICB2YXIgdGFpbCA9IHRoaXMudGFpbDsKICAgICAgICBmb3IgKHZhciB3YWxrZXIgPSBoZWFkOyB3YWxrZXIgIT09IG51bGw7IHdhbGtlciA9IHdhbGtlci5wcmV2KSB7CiAgICAgICAgICB2YXIgcCA9IHdhbGtlci5wcmV2OwogICAgICAgICAgd2Fsa2VyLnByZXYgPSB3YWxrZXIubmV4dDsKICAgICAgICAgIHdhbGtlci5uZXh0ID0gcDsKICAgICAgICB9CiAgICAgICAgdGhpcy5oZWFkID0gdGFpbDsKICAgICAgICB0aGlzLnRhaWwgPSBoZWFkOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9OwogICAgICBmdW5jdGlvbiBpbnNlcnQoc2VsZjIsIG5vZGUsIHZhbHVlKSB7CiAgICAgICAgdmFyIGluc2VydGVkID0gbm9kZSA9PT0gc2VsZjIuaGVhZCA/IG5ldyBOb2RlKHZhbHVlLCBudWxsLCBub2RlLCBzZWxmMikgOiBuZXcgTm9kZSh2YWx1ZSwgbm9kZSwgbm9kZS5uZXh0LCBzZWxmMik7CiAgICAgICAgaWYgKGluc2VydGVkLm5leHQgPT09IG51bGwpIHsKICAgICAgICAgIHNlbGYyLnRhaWwgPSBpbnNlcnRlZDsKICAgICAgICB9CiAgICAgICAgaWYgKGluc2VydGVkLnByZXYgPT09IG51bGwpIHsKICAgICAgICAgIHNlbGYyLmhlYWQgPSBpbnNlcnRlZDsKICAgICAgICB9CiAgICAgICAgc2VsZjIubGVuZ3RoKys7CiAgICAgICAgcmV0dXJuIGluc2VydGVkOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHB1c2goc2VsZjIsIGl0ZW0pIHsKICAgICAgICBzZWxmMi50YWlsID0gbmV3IE5vZGUoaXRlbSwgc2VsZjIudGFpbCwgbnVsbCwgc2VsZjIpOwogICAgICAgIGlmICghc2VsZjIuaGVhZCkgewogICAgICAgICAgc2VsZjIuaGVhZCA9IHNlbGYyLnRhaWw7CiAgICAgICAgfQogICAgICAgIHNlbGYyLmxlbmd0aCsrOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHVuc2hpZnQoc2VsZjIsIGl0ZW0pIHsKICAgICAgICBzZWxmMi5oZWFkID0gbmV3IE5vZGUoaXRlbSwgbnVsbCwgc2VsZjIuaGVhZCwgc2VsZjIpOwogICAgICAgIGlmICghc2VsZjIudGFpbCkgewogICAgICAgICAgc2VsZjIudGFpbCA9IHNlbGYyLmhlYWQ7CiAgICAgICAgfQogICAgICAgIHNlbGYyLmxlbmd0aCsrOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIE5vZGUodmFsdWUsIHByZXYsIG5leHQsIGxpc3QpIHsKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgTm9kZSkpIHsKICAgICAgICAgIHJldHVybiBuZXcgTm9kZSh2YWx1ZSwgcHJldiwgbmV4dCwgbGlzdCk7CiAgICAgICAgfQogICAgICAgIHRoaXMubGlzdCA9IGxpc3Q7CiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogICAgICAgIGlmIChwcmV2KSB7CiAgICAgICAgICBwcmV2Lm5leHQgPSB0aGlzOwogICAgICAgICAgdGhpcy5wcmV2ID0gcHJldjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5wcmV2ID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKG5leHQpIHsKICAgICAgICAgIG5leHQucHJldiA9IHRoaXM7CiAgICAgICAgICB0aGlzLm5leHQgPSBuZXh0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLm5leHQgPSBudWxsOwogICAgICAgIH0KICAgICAgfQogICAgICB0cnkgewogICAgICAgIHJlcXVpcmVfaXRlcmF0b3I1KCkoWWFsbGlzdCk7CiAgICAgIH0gY2F0Y2ggKGVyKSB7CiAgICAgIH0KICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2xydS1jYWNoZS9pbmRleC5qcwogIHZhciByZXF1aXJlX2xydV9jYWNoZSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9scnUtY2FjaGUvaW5kZXguanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIFlhbGxpc3QgPSByZXF1aXJlX3lhbGxpc3QoKTsKICAgICAgdmFyIE1BWCA9IFN5bWJvbCgibWF4Iik7CiAgICAgIHZhciBMRU5HVEggPSBTeW1ib2woImxlbmd0aCIpOwogICAgICB2YXIgTEVOR1RIX0NBTENVTEFUT1IgPSBTeW1ib2woImxlbmd0aENhbGN1bGF0b3IiKTsKICAgICAgdmFyIEFMTE9XX1NUQUxFID0gU3ltYm9sKCJhbGxvd1N0YWxlIik7CiAgICAgIHZhciBNQVhfQUdFID0gU3ltYm9sKCJtYXhBZ2UiKTsKICAgICAgdmFyIERJU1BPU0UgPSBTeW1ib2woImRpc3Bvc2UiKTsKICAgICAgdmFyIE5PX0RJU1BPU0VfT05fU0VUID0gU3ltYm9sKCJub0Rpc3Bvc2VPblNldCIpOwogICAgICB2YXIgTFJVX0xJU1QgPSBTeW1ib2woImxydUxpc3QiKTsKICAgICAgdmFyIENBQ0hFID0gU3ltYm9sKCJjYWNoZSIpOwogICAgICB2YXIgVVBEQVRFX0FHRV9PTl9HRVQgPSBTeW1ib2woInVwZGF0ZUFnZU9uR2V0Iik7CiAgICAgIHZhciBuYWl2ZUxlbmd0aCA9ICgpID0+IDE7CiAgICAgIHZhciBMUlVDYWNoZSA9IGNsYXNzIHsKICAgICAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICJudW1iZXIiKQogICAgICAgICAgICBvcHRpb25zID0geyBtYXg6IG9wdGlvbnMgfTsKICAgICAgICAgIGlmICghb3B0aW9ucykKICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgaWYgKG9wdGlvbnMubWF4ICYmICh0eXBlb2Ygb3B0aW9ucy5tYXggIT09ICJudW1iZXIiIHx8IG9wdGlvbnMubWF4IDwgMCkpCiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIm1heCBtdXN0IGJlIGEgbm9uLW5lZ2F0aXZlIG51bWJlciIpOwogICAgICAgICAgY29uc3QgbWF4ID0gdGhpc1tNQVhdID0gb3B0aW9ucy5tYXggfHwgSW5maW5pdHk7CiAgICAgICAgICBjb25zdCBsYyA9IG9wdGlvbnMubGVuZ3RoIHx8IG5haXZlTGVuZ3RoOwogICAgICAgICAgdGhpc1tMRU5HVEhfQ0FMQ1VMQVRPUl0gPSB0eXBlb2YgbGMgIT09ICJmdW5jdGlvbiIgPyBuYWl2ZUxlbmd0aCA6IGxjOwogICAgICAgICAgdGhpc1tBTExPV19TVEFMRV0gPSBvcHRpb25zLnN0YWxlIHx8IGZhbHNlOwogICAgICAgICAgaWYgKG9wdGlvbnMubWF4QWdlICYmIHR5cGVvZiBvcHRpb25zLm1heEFnZSAhPT0gIm51bWJlciIpCiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIm1heEFnZSBtdXN0IGJlIGEgbnVtYmVyIik7CiAgICAgICAgICB0aGlzW01BWF9BR0VdID0gb3B0aW9ucy5tYXhBZ2UgfHwgMDsKICAgICAgICAgIHRoaXNbRElTUE9TRV0gPSBvcHRpb25zLmRpc3Bvc2U7CiAgICAgICAgICB0aGlzW05PX0RJU1BPU0VfT05fU0VUXSA9IG9wdGlvbnMubm9EaXNwb3NlT25TZXQgfHwgZmFsc2U7CiAgICAgICAgICB0aGlzW1VQREFURV9BR0VfT05fR0VUXSA9IG9wdGlvbnMudXBkYXRlQWdlT25HZXQgfHwgZmFsc2U7CiAgICAgICAgICB0aGlzLnJlc2V0KCk7CiAgICAgICAgfQogICAgICAgIHNldCBtYXgobUwpIHsKICAgICAgICAgIGlmICh0eXBlb2YgbUwgIT09ICJudW1iZXIiIHx8IG1MIDwgMCkKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigibWF4IG11c3QgYmUgYSBub24tbmVnYXRpdmUgbnVtYmVyIik7CiAgICAgICAgICB0aGlzW01BWF0gPSBtTCB8fCBJbmZpbml0eTsKICAgICAgICAgIHRyaW0odGhpcyk7CiAgICAgICAgfQogICAgICAgIGdldCBtYXgoKSB7CiAgICAgICAgICByZXR1cm4gdGhpc1tNQVhdOwogICAgICAgIH0KICAgICAgICBzZXQgYWxsb3dTdGFsZShhbGxvd1N0YWxlKSB7CiAgICAgICAgICB0aGlzW0FMTE9XX1NUQUxFXSA9ICEhYWxsb3dTdGFsZTsKICAgICAgICB9CiAgICAgICAgZ2V0IGFsbG93U3RhbGUoKSB7CiAgICAgICAgICByZXR1cm4gdGhpc1tBTExPV19TVEFMRV07CiAgICAgICAgfQogICAgICAgIHNldCBtYXhBZ2UobUEpIHsKICAgICAgICAgIGlmICh0eXBlb2YgbUEgIT09ICJudW1iZXIiKQogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJtYXhBZ2UgbXVzdCBiZSBhIG5vbi1uZWdhdGl2ZSBudW1iZXIiKTsKICAgICAgICAgIHRoaXNbTUFYX0FHRV0gPSBtQTsKICAgICAgICAgIHRyaW0odGhpcyk7CiAgICAgICAgfQogICAgICAgIGdldCBtYXhBZ2UoKSB7CiAgICAgICAgICByZXR1cm4gdGhpc1tNQVhfQUdFXTsKICAgICAgICB9CiAgICAgICAgc2V0IGxlbmd0aENhbGN1bGF0b3IobEMpIHsKICAgICAgICAgIGlmICh0eXBlb2YgbEMgIT09ICJmdW5jdGlvbiIpCiAgICAgICAgICAgIGxDID0gbmFpdmVMZW5ndGg7CiAgICAgICAgICBpZiAobEMgIT09IHRoaXNbTEVOR1RIX0NBTENVTEFUT1JdKSB7CiAgICAgICAgICAgIHRoaXNbTEVOR1RIX0NBTENVTEFUT1JdID0gbEM7CiAgICAgICAgICAgIHRoaXNbTEVOR1RIXSA9IDA7CiAgICAgICAgICAgIHRoaXNbTFJVX0xJU1RdLmZvckVhY2goKGhpdCkgPT4gewogICAgICAgICAgICAgIGhpdC5sZW5ndGggPSB0aGlzW0xFTkdUSF9DQUxDVUxBVE9SXShoaXQudmFsdWUsIGhpdC5rZXkpOwogICAgICAgICAgICAgIHRoaXNbTEVOR1RIXSArPSBoaXQubGVuZ3RoOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHRyaW0odGhpcyk7CiAgICAgICAgfQogICAgICAgIGdldCBsZW5ndGhDYWxjdWxhdG9yKCkgewogICAgICAgICAgcmV0dXJuIHRoaXNbTEVOR1RIX0NBTENVTEFUT1JdOwogICAgICAgIH0KICAgICAgICBnZXQgbGVuZ3RoKCkgewogICAgICAgICAgcmV0dXJuIHRoaXNbTEVOR1RIXTsKICAgICAgICB9CiAgICAgICAgZ2V0IGl0ZW1Db3VudCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzW0xSVV9MSVNUXS5sZW5ndGg7CiAgICAgICAgfQogICAgICAgIHJmb3JFYWNoKGZuLCB0aGlzcCkgewogICAgICAgICAgdGhpc3AgPSB0aGlzcCB8fCB0aGlzOwogICAgICAgICAgZm9yIChsZXQgd2Fsa2VyID0gdGhpc1tMUlVfTElTVF0udGFpbDsgd2Fsa2VyICE9PSBudWxsOyApIHsKICAgICAgICAgICAgY29uc3QgcHJldiA9IHdhbGtlci5wcmV2OwogICAgICAgICAgICBmb3JFYWNoU3RlcCh0aGlzLCBmbiwgd2Fsa2VyLCB0aGlzcCk7CiAgICAgICAgICAgIHdhbGtlciA9IHByZXY7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZvckVhY2goZm4sIHRoaXNwKSB7CiAgICAgICAgICB0aGlzcCA9IHRoaXNwIHx8IHRoaXM7CiAgICAgICAgICBmb3IgKGxldCB3YWxrZXIgPSB0aGlzW0xSVV9MSVNUXS5oZWFkOyB3YWxrZXIgIT09IG51bGw7ICkgewogICAgICAgICAgICBjb25zdCBuZXh0ID0gd2Fsa2VyLm5leHQ7CiAgICAgICAgICAgIGZvckVhY2hTdGVwKHRoaXMsIGZuLCB3YWxrZXIsIHRoaXNwKTsKICAgICAgICAgICAgd2Fsa2VyID0gbmV4dDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAga2V5cygpIHsKICAgICAgICAgIHJldHVybiB0aGlzW0xSVV9MSVNUXS50b0FycmF5KCkubWFwKChrKSA9PiBrLmtleSk7CiAgICAgICAgfQogICAgICAgIHZhbHVlcygpIHsKICAgICAgICAgIHJldHVybiB0aGlzW0xSVV9MSVNUXS50b0FycmF5KCkubWFwKChrKSA9PiBrLnZhbHVlKTsKICAgICAgICB9CiAgICAgICAgcmVzZXQoKSB7CiAgICAgICAgICBpZiAodGhpc1tESVNQT1NFXSAmJiB0aGlzW0xSVV9MSVNUXSAmJiB0aGlzW0xSVV9MSVNUXS5sZW5ndGgpIHsKICAgICAgICAgICAgdGhpc1tMUlVfTElTVF0uZm9yRWFjaCgoaGl0KSA9PiB0aGlzW0RJU1BPU0VdKGhpdC5rZXksIGhpdC52YWx1ZSkpOwogICAgICAgICAgfQogICAgICAgICAgdGhpc1tDQUNIRV0gPSBuZXcgTWFwKCk7CiAgICAgICAgICB0aGlzW0xSVV9MSVNUXSA9IG5ldyBZYWxsaXN0KCk7CiAgICAgICAgICB0aGlzW0xFTkdUSF0gPSAwOwogICAgICAgIH0KICAgICAgICBkdW1wKCkgewogICAgICAgICAgcmV0dXJuIHRoaXNbTFJVX0xJU1RdLm1hcCgoaGl0KSA9PiBpc1N0YWxlKHRoaXMsIGhpdCkgPyBmYWxzZSA6IHsKICAgICAgICAgICAgazogaGl0LmtleSwKICAgICAgICAgICAgdjogaGl0LnZhbHVlLAogICAgICAgICAgICBlOiBoaXQubm93ICsgKGhpdC5tYXhBZ2UgfHwgMCkKICAgICAgICAgIH0pLnRvQXJyYXkoKS5maWx0ZXIoKGgpID0+IGgpOwogICAgICAgIH0KICAgICAgICBkdW1wTHJ1KCkgewogICAgICAgICAgcmV0dXJuIHRoaXNbTFJVX0xJU1RdOwogICAgICAgIH0KICAgICAgICBzZXQoa2V5LCB2YWx1ZSwgbWF4QWdlKSB7CiAgICAgICAgICBtYXhBZ2UgPSBtYXhBZ2UgfHwgdGhpc1tNQVhfQUdFXTsKICAgICAgICAgIGlmIChtYXhBZ2UgJiYgdHlwZW9mIG1heEFnZSAhPT0gIm51bWJlciIpCiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIm1heEFnZSBtdXN0IGJlIGEgbnVtYmVyIik7CiAgICAgICAgICBjb25zdCBub3cgPSBtYXhBZ2UgPyBEYXRlLm5vdygpIDogMDsKICAgICAgICAgIGNvbnN0IGxlbiA9IHRoaXNbTEVOR1RIX0NBTENVTEFUT1JdKHZhbHVlLCBrZXkpOwogICAgICAgICAgaWYgKHRoaXNbQ0FDSEVdLmhhcyhrZXkpKSB7CiAgICAgICAgICAgIGlmIChsZW4gPiB0aGlzW01BWF0pIHsKICAgICAgICAgICAgICBkZWwodGhpcywgdGhpc1tDQUNIRV0uZ2V0KGtleSkpOwogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBub2RlID0gdGhpc1tDQUNIRV0uZ2V0KGtleSk7CiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBub2RlLnZhbHVlOwogICAgICAgICAgICBpZiAodGhpc1tESVNQT1NFXSkgewogICAgICAgICAgICAgIGlmICghdGhpc1tOT19ESVNQT1NFX09OX1NFVF0pCiAgICAgICAgICAgICAgICB0aGlzW0RJU1BPU0VdKGtleSwgaXRlbS52YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaXRlbS5ub3cgPSBub3c7CiAgICAgICAgICAgIGl0ZW0ubWF4QWdlID0gbWF4QWdlOwogICAgICAgICAgICBpdGVtLnZhbHVlID0gdmFsdWU7CiAgICAgICAgICAgIHRoaXNbTEVOR1RIXSArPSBsZW4gLSBpdGVtLmxlbmd0aDsKICAgICAgICAgICAgaXRlbS5sZW5ndGggPSBsZW47CiAgICAgICAgICAgIHRoaXMuZ2V0KGtleSk7CiAgICAgICAgICAgIHRyaW0odGhpcyk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgaGl0ID0gbmV3IEVudHJ5KGtleSwgdmFsdWUsIGxlbiwgbm93LCBtYXhBZ2UpOwogICAgICAgICAgaWYgKGhpdC5sZW5ndGggPiB0aGlzW01BWF0pIHsKICAgICAgICAgICAgaWYgKHRoaXNbRElTUE9TRV0pCiAgICAgICAgICAgICAgdGhpc1tESVNQT1NFXShrZXksIHZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgdGhpc1tMRU5HVEhdICs9IGhpdC5sZW5ndGg7CiAgICAgICAgICB0aGlzW0xSVV9MSVNUXS51bnNoaWZ0KGhpdCk7CiAgICAgICAgICB0aGlzW0NBQ0hFXS5zZXQoa2V5LCB0aGlzW0xSVV9MSVNUXS5oZWFkKTsKICAgICAgICAgIHRyaW0odGhpcyk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaGFzKGtleSkgewogICAgICAgICAgaWYgKCF0aGlzW0NBQ0hFXS5oYXMoa2V5KSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgY29uc3QgaGl0ID0gdGhpc1tDQUNIRV0uZ2V0KGtleSkudmFsdWU7CiAgICAgICAgICByZXR1cm4gIWlzU3RhbGUodGhpcywgaGl0KTsKICAgICAgICB9CiAgICAgICAgZ2V0KGtleSkgewogICAgICAgICAgcmV0dXJuIGdldDIodGhpcywga2V5LCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgcGVlayhrZXkpIHsKICAgICAgICAgIHJldHVybiBnZXQyKHRoaXMsIGtleSwgZmFsc2UpOwogICAgICAgIH0KICAgICAgICBwb3AoKSB7CiAgICAgICAgICBjb25zdCBub2RlID0gdGhpc1tMUlVfTElTVF0udGFpbDsKICAgICAgICAgIGlmICghbm9kZSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICBkZWwodGhpcywgbm9kZSk7CiAgICAgICAgICByZXR1cm4gbm9kZS52YWx1ZTsKICAgICAgICB9CiAgICAgICAgZGVsKGtleSkgewogICAgICAgICAgZGVsKHRoaXMsIHRoaXNbQ0FDSEVdLmdldChrZXkpKTsKICAgICAgICB9CiAgICAgICAgbG9hZChhcnIpIHsKICAgICAgICAgIHRoaXMucmVzZXQoKTsKICAgICAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7CiAgICAgICAgICBmb3IgKGxldCBsID0gYXJyLmxlbmd0aCAtIDE7IGwgPj0gMDsgbC0tKSB7CiAgICAgICAgICAgIGNvbnN0IGhpdCA9IGFycltsXTsKICAgICAgICAgICAgY29uc3QgZXhwaXJlc0F0ID0gaGl0LmUgfHwgMDsKICAgICAgICAgICAgaWYgKGV4cGlyZXNBdCA9PT0gMCkKICAgICAgICAgICAgICB0aGlzLnNldChoaXQuaywgaGl0LnYpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICBjb25zdCBtYXhBZ2UgPSBleHBpcmVzQXQgLSBub3c7CiAgICAgICAgICAgICAgaWYgKG1heEFnZSA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0KGhpdC5rLCBoaXQudiwgbWF4QWdlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcHJ1bmUoKSB7CiAgICAgICAgICB0aGlzW0NBQ0hFXS5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiBnZXQyKHRoaXMsIGtleSwgZmFsc2UpKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHZhciBnZXQyID0gKHNlbGYyLCBrZXksIGRvVXNlKSA9PiB7CiAgICAgICAgY29uc3Qgbm9kZSA9IHNlbGYyW0NBQ0hFXS5nZXQoa2V5KTsKICAgICAgICBpZiAobm9kZSkgewogICAgICAgICAgY29uc3QgaGl0ID0gbm9kZS52YWx1ZTsKICAgICAgICAgIGlmIChpc1N0YWxlKHNlbGYyLCBoaXQpKSB7CiAgICAgICAgICAgIGRlbChzZWxmMiwgbm9kZSk7CiAgICAgICAgICAgIGlmICghc2VsZjJbQUxMT1dfU1RBTEVdKQogICAgICAgICAgICAgIHJldHVybiB2b2lkIDA7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoZG9Vc2UpIHsKICAgICAgICAgICAgICBpZiAoc2VsZjJbVVBEQVRFX0FHRV9PTl9HRVRdKQogICAgICAgICAgICAgICAgbm9kZS52YWx1ZS5ub3cgPSBEYXRlLm5vdygpOwogICAgICAgICAgICAgIHNlbGYyW0xSVV9MSVNUXS51bnNoaWZ0Tm9kZShub2RlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGhpdC52YWx1ZTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHZhciBpc1N0YWxlID0gKHNlbGYyLCBoaXQpID0+IHsKICAgICAgICBpZiAoIWhpdCB8fCAhaGl0Lm1heEFnZSAmJiAhc2VsZjJbTUFYX0FHRV0pCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgY29uc3QgZGlmZiA9IERhdGUubm93KCkgLSBoaXQubm93OwogICAgICAgIHJldHVybiBoaXQubWF4QWdlID8gZGlmZiA+IGhpdC5tYXhBZ2UgOiBzZWxmMltNQVhfQUdFXSAmJiBkaWZmID4gc2VsZjJbTUFYX0FHRV07CiAgICAgIH07CiAgICAgIHZhciB0cmltID0gKHNlbGYyKSA9PiB7CiAgICAgICAgaWYgKHNlbGYyW0xFTkdUSF0gPiBzZWxmMltNQVhdKSB7CiAgICAgICAgICBmb3IgKGxldCB3YWxrZXIgPSBzZWxmMltMUlVfTElTVF0udGFpbDsgc2VsZjJbTEVOR1RIXSA+IHNlbGYyW01BWF0gJiYgd2Fsa2VyICE9PSBudWxsOyApIHsKICAgICAgICAgICAgY29uc3QgcHJldiA9IHdhbGtlci5wcmV2OwogICAgICAgICAgICBkZWwoc2VsZjIsIHdhbGtlcik7CiAgICAgICAgICAgIHdhbGtlciA9IHByZXY7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgICB2YXIgZGVsID0gKHNlbGYyLCBub2RlKSA9PiB7CiAgICAgICAgaWYgKG5vZGUpIHsKICAgICAgICAgIGNvbnN0IGhpdCA9IG5vZGUudmFsdWU7CiAgICAgICAgICBpZiAoc2VsZjJbRElTUE9TRV0pCiAgICAgICAgICAgIHNlbGYyW0RJU1BPU0VdKGhpdC5rZXksIGhpdC52YWx1ZSk7CiAgICAgICAgICBzZWxmMltMRU5HVEhdIC09IGhpdC5sZW5ndGg7CiAgICAgICAgICBzZWxmMltDQUNIRV0uZGVsZXRlKGhpdC5rZXkpOwogICAgICAgICAgc2VsZjJbTFJVX0xJU1RdLnJlbW92ZU5vZGUobm9kZSk7CiAgICAgICAgfQogICAgICB9OwogICAgICB2YXIgRW50cnkgPSBjbGFzcyB7CiAgICAgICAgY29uc3RydWN0b3Ioa2V5LCB2YWx1ZSwgbGVuZ3RoLCBub3csIG1heEFnZSkgewogICAgICAgICAgdGhpcy5rZXkgPSBrZXk7CiAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAgICAgICAgICB0aGlzLmxlbmd0aCA9IGxlbmd0aDsKICAgICAgICAgIHRoaXMubm93ID0gbm93OwogICAgICAgICAgdGhpcy5tYXhBZ2UgPSBtYXhBZ2UgfHwgMDsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHZhciBmb3JFYWNoU3RlcCA9IChzZWxmMiwgZm4sIG5vZGUsIHRoaXNwKSA9PiB7CiAgICAgICAgbGV0IGhpdCA9IG5vZGUudmFsdWU7CiAgICAgICAgaWYgKGlzU3RhbGUoc2VsZjIsIGhpdCkpIHsKICAgICAgICAgIGRlbChzZWxmMiwgbm9kZSk7CiAgICAgICAgICBpZiAoIXNlbGYyW0FMTE9XX1NUQUxFXSkKICAgICAgICAgICAgaGl0ID0gdm9pZCAwOwogICAgICAgIH0KICAgICAgICBpZiAoaGl0KQogICAgICAgICAgZm4uY2FsbCh0aGlzcCwgaGl0LnZhbHVlLCBoaXQua2V5LCBzZWxmMik7CiAgICAgIH07CiAgICAgIG1vZHVsZS5leHBvcnRzID0gTFJVQ2FjaGU7CiAgICB9CiAgfSk7CgogIC8vIHNyYy9kYXRhLWZldGNoZXIvYmFtL2JhbS13b3JrZXIuanM/d29ya2VyJmlubGluZT93b3JrZXJfZmlsZQogIGluaXRfYnVmZmVyX3NoaW0oKTsKCiAgLy8gbm9kZV9tb2R1bGVzL2QzLXJlcXVlc3QvaW5kZXguanMKICBpbml0X2J1ZmZlcl9zaGltKCk7CgogIC8vIG5vZGVfbW9kdWxlcy9kMy1yZXF1ZXN0L3NyYy9yZXF1ZXN0LmpzCiAgaW5pdF9idWZmZXJfc2hpbSgpOwoKICAvLyBub2RlX21vZHVsZXMvZDMtY29sbGVjdGlvbi9zcmMvaW5kZXguanMKICBpbml0X2J1ZmZlcl9zaGltKCk7CgogIC8vIG5vZGVfbW9kdWxlcy9kMy1jb2xsZWN0aW9uL3NyYy9uZXN0LmpzCiAgaW5pdF9idWZmZXJfc2hpbSgpOwoKICAvLyBub2RlX21vZHVsZXMvZDMtY29sbGVjdGlvbi9zcmMvbWFwLmpzCiAgaW5pdF9idWZmZXJfc2hpbSgpOwogIHZhciBwcmVmaXggPSAiJCI7CiAgZnVuY3Rpb24gTWFwMigpIHsKICB9CiAgTWFwMi5wcm90b3R5cGUgPSBtYXAucHJvdG90eXBlID0gewogICAgY29uc3RydWN0b3I6IE1hcDIsCiAgICBoYXM6IGZ1bmN0aW9uKGtleSkgewogICAgICByZXR1cm4gcHJlZml4ICsga2V5IGluIHRoaXM7CiAgICB9LAogICAgZ2V0OiBmdW5jdGlvbihrZXkpIHsKICAgICAgcmV0dXJuIHRoaXNbcHJlZml4ICsga2V5XTsKICAgIH0sCiAgICBzZXQ6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgICAgdGhpc1twcmVmaXggKyBrZXldID0gdmFsdWU7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIHJlbW92ZTogZnVuY3Rpb24oa2V5KSB7CiAgICAgIHZhciBwcm9wZXJ0eSA9IHByZWZpeCArIGtleTsKICAgICAgcmV0dXJuIHByb3BlcnR5IGluIHRoaXMgJiYgZGVsZXRlIHRoaXNbcHJvcGVydHldOwogICAgfSwKICAgIGNsZWFyOiBmdW5jdGlvbigpIHsKICAgICAgZm9yICh2YXIgcHJvcGVydHkgaW4gdGhpcykKICAgICAgICBpZiAocHJvcGVydHlbMF0gPT09IHByZWZpeCkKICAgICAgICAgIGRlbGV0ZSB0aGlzW3Byb3BlcnR5XTsKICAgIH0sCiAgICBrZXlzOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGtleXMgPSBbXTsKICAgICAgZm9yICh2YXIgcHJvcGVydHkgaW4gdGhpcykKICAgICAgICBpZiAocHJvcGVydHlbMF0gPT09IHByZWZpeCkKICAgICAgICAgIGtleXMucHVzaChwcm9wZXJ0eS5zbGljZSgxKSk7CiAgICAgIHJldHVybiBrZXlzOwogICAgfSwKICAgIHZhbHVlczogZnVuY3Rpb24oKSB7CiAgICAgIHZhciB2YWx1ZXMgPSBbXTsKICAgICAgZm9yICh2YXIgcHJvcGVydHkgaW4gdGhpcykKICAgICAgICBpZiAocHJvcGVydHlbMF0gPT09IHByZWZpeCkKICAgICAgICAgIHZhbHVlcy5wdXNoKHRoaXNbcHJvcGVydHldKTsKICAgICAgcmV0dXJuIHZhbHVlczsKICAgIH0sCiAgICBlbnRyaWVzOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGVudHJpZXMgPSBbXTsKICAgICAgZm9yICh2YXIgcHJvcGVydHkgaW4gdGhpcykKICAgICAgICBpZiAocHJvcGVydHlbMF0gPT09IHByZWZpeCkKICAgICAgICAgIGVudHJpZXMucHVzaCh7IGtleTogcHJvcGVydHkuc2xpY2UoMSksIHZhbHVlOiB0aGlzW3Byb3BlcnR5XSB9KTsKICAgICAgcmV0dXJuIGVudHJpZXM7CiAgICB9LAogICAgc2l6ZTogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzaXplID0gMDsKICAgICAgZm9yICh2YXIgcHJvcGVydHkgaW4gdGhpcykKICAgICAgICBpZiAocHJvcGVydHlbMF0gPT09IHByZWZpeCkKICAgICAgICAgICsrc2l6ZTsKICAgICAgcmV0dXJuIHNpemU7CiAgICB9LAogICAgZW1wdHk6IGZ1bmN0aW9uKCkgewogICAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiB0aGlzKQogICAgICAgIGlmIChwcm9wZXJ0eVswXSA9PT0gcHJlZml4KQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCiAgICBlYWNoOiBmdW5jdGlvbihmKSB7CiAgICAgIGZvciAodmFyIHByb3BlcnR5IGluIHRoaXMpCiAgICAgICAgaWYgKHByb3BlcnR5WzBdID09PSBwcmVmaXgpCiAgICAgICAgICBmKHRoaXNbcHJvcGVydHldLCBwcm9wZXJ0eS5zbGljZSgxKSwgdGhpcyk7CiAgICB9CiAgfTsKICBmdW5jdGlvbiBtYXAob2JqZWN0LCBmKSB7CiAgICB2YXIgbWFwMiA9IG5ldyBNYXAyKCk7CiAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgTWFwMikKICAgICAgb2JqZWN0LmVhY2goZnVuY3Rpb24odmFsdWUsIGtleTIpIHsKICAgICAgICBtYXAyLnNldChrZXkyLCB2YWx1ZSk7CiAgICAgIH0pOwogICAgZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmplY3QpKSB7CiAgICAgIHZhciBpID0gLTEsIG4gPSBvYmplY3QubGVuZ3RoLCBvOwogICAgICBpZiAoZiA9PSBudWxsKQogICAgICAgIHdoaWxlICgrK2kgPCBuKQogICAgICAgICAgbWFwMi5zZXQoaSwgb2JqZWN0W2ldKTsKICAgICAgZWxzZQogICAgICAgIHdoaWxlICgrK2kgPCBuKQogICAgICAgICAgbWFwMi5zZXQoZihvID0gb2JqZWN0W2ldLCBpLCBvYmplY3QpLCBvKTsKICAgIH0gZWxzZSBpZiAob2JqZWN0KQogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqZWN0KQogICAgICAgIG1hcDIuc2V0KGtleSwgb2JqZWN0W2tleV0pOwogICAgcmV0dXJuIG1hcDI7CiAgfQogIHZhciBtYXBfZGVmYXVsdCA9IG1hcDsKCiAgLy8gbm9kZV9tb2R1bGVzL2QzLWNvbGxlY3Rpb24vc3JjL3NldC5qcwogIGluaXRfYnVmZmVyX3NoaW0oKTsKICBmdW5jdGlvbiBTZXQyKCkgewogIH0KICB2YXIgcHJvdG8gPSBtYXBfZGVmYXVsdC5wcm90b3R5cGU7CiAgU2V0Mi5wcm90b3R5cGUgPSBzZXQucHJvdG90eXBlID0gewogICAgY29uc3RydWN0b3I6IFNldDIsCiAgICBoYXM6IHByb3RvLmhhcywKICAgIGFkZDogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgdmFsdWUgKz0gIiI7CiAgICAgIHRoaXNbcHJlZml4ICsgdmFsdWVdID0gdmFsdWU7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIHJlbW92ZTogcHJvdG8ucmVtb3ZlLAogICAgY2xlYXI6IHByb3RvLmNsZWFyLAogICAgdmFsdWVzOiBwcm90by5rZXlzLAogICAgc2l6ZTogcHJvdG8uc2l6ZSwKICAgIGVtcHR5OiBwcm90by5lbXB0eSwKICAgIGVhY2g6IHByb3RvLmVhY2gKICB9OwogIGZ1bmN0aW9uIHNldChvYmplY3QsIGYpIHsKICAgIHZhciBzZXQzID0gbmV3IFNldDIoKTsKICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBTZXQyKQogICAgICBvYmplY3QuZWFjaChmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIHNldDMuYWRkKHZhbHVlKTsKICAgICAgfSk7CiAgICBlbHNlIGlmIChvYmplY3QpIHsKICAgICAgdmFyIGkgPSAtMSwgbiA9IG9iamVjdC5sZW5ndGg7CiAgICAgIGlmIChmID09IG51bGwpCiAgICAgICAgd2hpbGUgKCsraSA8IG4pCiAgICAgICAgICBzZXQzLmFkZChvYmplY3RbaV0pOwogICAgICBlbHNlCiAgICAgICAgd2hpbGUgKCsraSA8IG4pCiAgICAgICAgICBzZXQzLmFkZChmKG9iamVjdFtpXSwgaSwgb2JqZWN0KSk7CiAgICB9CiAgICByZXR1cm4gc2V0MzsKICB9CgogIC8vIG5vZGVfbW9kdWxlcy9kMy1jb2xsZWN0aW9uL3NyYy9rZXlzLmpzCiAgaW5pdF9idWZmZXJfc2hpbSgpOwoKICAvLyBub2RlX21vZHVsZXMvZDMtY29sbGVjdGlvbi9zcmMvdmFsdWVzLmpzCiAgaW5pdF9idWZmZXJfc2hpbSgpOwoKICAvLyBub2RlX21vZHVsZXMvZDMtY29sbGVjdGlvbi9zcmMvZW50cmllcy5qcwogIGluaXRfYnVmZmVyX3NoaW0oKTsKCiAgLy8gbm9kZV9tb2R1bGVzL2QzLWRpc3BhdGNoL3NyYy9pbmRleC5qcwogIGluaXRfYnVmZmVyX3NoaW0oKTsKCiAgLy8gbm9kZV9tb2R1bGVzL2QzLWRpc3BhdGNoL3NyYy9kaXNwYXRjaC5qcwogIGluaXRfYnVmZmVyX3NoaW0oKTsKICB2YXIgbm9vcCA9IHsgdmFsdWU6IGZ1bmN0aW9uKCkgewogIH0gfTsKICBmdW5jdGlvbiBkaXNwYXRjaCgpIHsKICAgIGZvciAodmFyIGkgPSAwLCBuID0gYXJndW1lbnRzLmxlbmd0aCwgXyA9IHt9LCB0OyBpIDwgbjsgKytpKSB7CiAgICAgIGlmICghKHQgPSBhcmd1bWVudHNbaV0gKyAiIikgfHwgdCBpbiBfIHx8IC9bXHMuXS8udGVzdCh0KSkKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImlsbGVnYWwgdHlwZTogIiArIHQpOwogICAgICBfW3RdID0gW107CiAgICB9CiAgICByZXR1cm4gbmV3IERpc3BhdGNoKF8pOwogIH0KICBmdW5jdGlvbiBEaXNwYXRjaChfKSB7CiAgICB0aGlzLl8gPSBfOwogIH0KICBmdW5jdGlvbiBwYXJzZVR5cGVuYW1lcyh0eXBlbmFtZXMsIHR5cGVzKSB7CiAgICByZXR1cm4gdHlwZW5hbWVzLnRyaW0oKS5zcGxpdCgvXnxccysvKS5tYXAoZnVuY3Rpb24odCkgewogICAgICB2YXIgbmFtZSA9ICIiLCBpID0gdC5pbmRleE9mKCIuIik7CiAgICAgIGlmIChpID49IDApCiAgICAgICAgbmFtZSA9IHQuc2xpY2UoaSArIDEpLCB0ID0gdC5zbGljZSgwLCBpKTsKICAgICAgaWYgKHQgJiYgIXR5cGVzLmhhc093blByb3BlcnR5KHQpKQogICAgICAgIHRocm93IG5ldyBFcnJvcigidW5rbm93biB0eXBlOiAiICsgdCk7CiAgICAgIHJldHVybiB7IHR5cGU6IHQsIG5hbWUgfTsKICAgIH0pOwogIH0KICBEaXNwYXRjaC5wcm90b3R5cGUgPSBkaXNwYXRjaC5wcm90b3R5cGUgPSB7CiAgICBjb25zdHJ1Y3RvcjogRGlzcGF0Y2gsCiAgICBvbjogZnVuY3Rpb24odHlwZW5hbWUsIGNhbGxiYWNrKSB7CiAgICAgIHZhciBfID0gdGhpcy5fLCBUID0gcGFyc2VUeXBlbmFtZXModHlwZW5hbWUgKyAiIiwgXyksIHQsIGkgPSAtMSwgbiA9IFQubGVuZ3RoOwogICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHsKICAgICAgICB3aGlsZSAoKytpIDwgbikKICAgICAgICAgIGlmICgodCA9ICh0eXBlbmFtZSA9IFRbaV0pLnR5cGUpICYmICh0ID0gZ2V0KF9bdF0sIHR5cGVuYW1lLm5hbWUpKSkKICAgICAgICAgICAgcmV0dXJuIHQ7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChjYWxsYmFjayAhPSBudWxsICYmIHR5cGVvZiBjYWxsYmFjayAhPT0gImZ1bmN0aW9uIikKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgY2FsbGJhY2s6ICIgKyBjYWxsYmFjayk7CiAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgaWYgKHQgPSAodHlwZW5hbWUgPSBUW2ldKS50eXBlKQogICAgICAgICAgX1t0XSA9IHNldDIoX1t0XSwgdHlwZW5hbWUubmFtZSwgY2FsbGJhY2spOwogICAgICAgIGVsc2UgaWYgKGNhbGxiYWNrID09IG51bGwpCiAgICAgICAgICBmb3IgKHQgaW4gXykKICAgICAgICAgICAgX1t0XSA9IHNldDIoX1t0XSwgdHlwZW5hbWUubmFtZSwgbnVsbCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAogICAgY29weTogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBjb3B5ID0ge30sIF8gPSB0aGlzLl87CiAgICAgIGZvciAodmFyIHQgaW4gXykKICAgICAgICBjb3B5W3RdID0gX1t0XS5zbGljZSgpOwogICAgICByZXR1cm4gbmV3IERpc3BhdGNoKGNvcHkpOwogICAgfSwKICAgIGNhbGw6IGZ1bmN0aW9uKHR5cGUsIHRoYXQpIHsKICAgICAgaWYgKChuID0gYXJndW1lbnRzLmxlbmd0aCAtIDIpID4gMCkKICAgICAgICBmb3IgKHZhciBhcmdzID0gbmV3IEFycmF5KG4pLCBpID0gMCwgbiwgdDsgaSA8IG47ICsraSkKICAgICAgICAgIGFyZ3NbaV0gPSBhcmd1bWVudHNbaSArIDJdOwogICAgICBpZiAoIXRoaXMuXy5oYXNPd25Qcm9wZXJ0eSh0eXBlKSkKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInVua25vd24gdHlwZTogIiArIHR5cGUpOwogICAgICBmb3IgKHQgPSB0aGlzLl9bdHlwZV0sIGkgPSAwLCBuID0gdC5sZW5ndGg7IGkgPCBuOyArK2kpCiAgICAgICAgdFtpXS52YWx1ZS5hcHBseSh0aGF0LCBhcmdzKTsKICAgIH0sCiAgICBhcHBseTogZnVuY3Rpb24odHlwZSwgdGhhdCwgYXJncykgewogICAgICBpZiAoIXRoaXMuXy5oYXNPd25Qcm9wZXJ0eSh0eXBlKSkKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInVua25vd24gdHlwZTogIiArIHR5cGUpOwogICAgICBmb3IgKHZhciB0ID0gdGhpcy5fW3R5cGVdLCBpID0gMCwgbiA9IHQubGVuZ3RoOyBpIDwgbjsgKytpKQogICAgICAgIHRbaV0udmFsdWUuYXBwbHkodGhhdCwgYXJncyk7CiAgICB9CiAgfTsKICBmdW5jdGlvbiBnZXQodHlwZSwgbmFtZSkgewogICAgZm9yICh2YXIgaSA9IDAsIG4gPSB0eXBlLmxlbmd0aCwgYzsgaSA8IG47ICsraSkgewogICAgICBpZiAoKGMgPSB0eXBlW2ldKS5uYW1lID09PSBuYW1lKSB7CiAgICAgICAgcmV0dXJuIGMudmFsdWU7CiAgICAgIH0KICAgIH0KICB9CiAgZnVuY3Rpb24gc2V0Mih0eXBlLCBuYW1lLCBjYWxsYmFjaykgewogICAgZm9yICh2YXIgaSA9IDAsIG4gPSB0eXBlLmxlbmd0aDsgaSA8IG47ICsraSkgewogICAgICBpZiAodHlwZVtpXS5uYW1lID09PSBuYW1lKSB7CiAgICAgICAgdHlwZVtpXSA9IG5vb3AsIHR5cGUgPSB0eXBlLnNsaWNlKDAsIGkpLmNvbmNhdCh0eXBlLnNsaWNlKGkgKyAxKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGlmIChjYWxsYmFjayAhPSBudWxsKQogICAgICB0eXBlLnB1c2goeyBuYW1lLCB2YWx1ZTogY2FsbGJhY2sgfSk7CiAgICByZXR1cm4gdHlwZTsKICB9CiAgdmFyIGRpc3BhdGNoX2RlZmF1bHQgPSBkaXNwYXRjaDsKCiAgLy8gbm9kZV9tb2R1bGVzL2QzLXJlcXVlc3Qvc3JjL3JlcXVlc3QuanMKICBmdW5jdGlvbiByZXF1ZXN0X2RlZmF1bHQodXJsLCBjYWxsYmFjaykgewogICAgdmFyIHJlcXVlc3QsIGV2ZW50ID0gZGlzcGF0Y2hfZGVmYXVsdCgiYmVmb3Jlc2VuZCIsICJwcm9ncmVzcyIsICJsb2FkIiwgImVycm9yIiksIG1pbWVUeXBlLCBoZWFkZXJzID0gbWFwX2RlZmF1bHQoKSwgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCksIHVzZXIgPSBudWxsLCBwYXNzd29yZCA9IG51bGwsIHJlc3BvbnNlLCByZXNwb25zZVR5cGUsIHRpbWVvdXQgPSAwOwogICAgaWYgKHR5cGVvZiBYRG9tYWluUmVxdWVzdCAhPT0gInVuZGVmaW5lZCIgJiYgISgid2l0aENyZWRlbnRpYWxzIiBpbiB4aHIpICYmIC9eKGh0dHAocyk/Oik/XC9cLy8udGVzdCh1cmwpKQogICAgICB4aHIgPSBuZXcgWERvbWFpblJlcXVlc3QoKTsKICAgICJvbmxvYWQiIGluIHhociA/IHhoci5vbmxvYWQgPSB4aHIub25lcnJvciA9IHhoci5vbnRpbWVvdXQgPSByZXNwb25kIDogeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKG8pIHsKICAgICAgeGhyLnJlYWR5U3RhdGUgPiAzICYmIHJlc3BvbmQobyk7CiAgICB9OwogICAgZnVuY3Rpb24gcmVzcG9uZChvKSB7CiAgICAgIHZhciBzdGF0dXMgPSB4aHIuc3RhdHVzLCByZXN1bHQ7CiAgICAgIGlmICghc3RhdHVzICYmIGhhc1Jlc3BvbnNlKHhocikgfHwgc3RhdHVzID49IDIwMCAmJiBzdGF0dXMgPCAzMDAgfHwgc3RhdHVzID09PSAzMDQpIHsKICAgICAgICBpZiAocmVzcG9uc2UpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3BvbnNlLmNhbGwocmVxdWVzdCwgeGhyKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgZXZlbnQuY2FsbCgiZXJyb3IiLCByZXF1ZXN0LCBlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXN1bHQgPSB4aHI7CiAgICAgICAgfQogICAgICAgIGV2ZW50LmNhbGwoImxvYWQiLCByZXF1ZXN0LCByZXN1bHQpOwogICAgICB9IGVsc2UgewogICAgICAgIGV2ZW50LmNhbGwoImVycm9yIiwgcmVxdWVzdCwgbyk7CiAgICAgIH0KICAgIH0KICAgIHhoci5vbnByb2dyZXNzID0gZnVuY3Rpb24oZSkgewogICAgICBldmVudC5jYWxsKCJwcm9ncmVzcyIsIHJlcXVlc3QsIGUpOwogICAgfTsKICAgIHJlcXVlc3QgPSB7CiAgICAgIGhlYWRlcjogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHsKICAgICAgICBuYW1lID0gKG5hbWUgKyAiIikudG9Mb3dlckNhc2UoKTsKICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpCiAgICAgICAgICByZXR1cm4gaGVhZGVycy5nZXQobmFtZSk7CiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpCiAgICAgICAgICBoZWFkZXJzLnJlbW92ZShuYW1lKTsKICAgICAgICBlbHNlCiAgICAgICAgICBoZWFkZXJzLnNldChuYW1lLCB2YWx1ZSArICIiKTsKICAgICAgICByZXR1cm4gcmVxdWVzdDsKICAgICAgfSwKICAgICAgbWltZVR5cGU6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKQogICAgICAgICAgcmV0dXJuIG1pbWVUeXBlOwogICAgICAgIG1pbWVUeXBlID0gdmFsdWUgPT0gbnVsbCA/IG51bGwgOiB2YWx1ZSArICIiOwogICAgICAgIHJldHVybiByZXF1ZXN0OwogICAgICB9LAogICAgICByZXNwb25zZVR5cGU6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKQogICAgICAgICAgcmV0dXJuIHJlc3BvbnNlVHlwZTsKICAgICAgICByZXNwb25zZVR5cGUgPSB2YWx1ZTsKICAgICAgICByZXR1cm4gcmVxdWVzdDsKICAgICAgfSwKICAgICAgdGltZW91dDogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpCiAgICAgICAgICByZXR1cm4gdGltZW91dDsKICAgICAgICB0aW1lb3V0ID0gK3ZhbHVlOwogICAgICAgIHJldHVybiByZXF1ZXN0OwogICAgICB9LAogICAgICB1c2VyOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoIDwgMSA/IHVzZXIgOiAodXNlciA9IHZhbHVlID09IG51bGwgPyBudWxsIDogdmFsdWUgKyAiIiwgcmVxdWVzdCk7CiAgICAgIH0sCiAgICAgIHBhc3N3b3JkOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoIDwgMSA/IHBhc3N3b3JkIDogKHBhc3N3b3JkID0gdmFsdWUgPT0gbnVsbCA/IG51bGwgOiB2YWx1ZSArICIiLCByZXF1ZXN0KTsKICAgICAgfSwKICAgICAgcmVzcG9uc2U6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgcmVzcG9uc2UgPSB2YWx1ZTsKICAgICAgICByZXR1cm4gcmVxdWVzdDsKICAgICAgfSwKICAgICAgZ2V0OiBmdW5jdGlvbihkYXRhLCBjYWxsYmFjazIpIHsKICAgICAgICByZXR1cm4gcmVxdWVzdC5zZW5kKCJHRVQiLCBkYXRhLCBjYWxsYmFjazIpOwogICAgICB9LAogICAgICBwb3N0OiBmdW5jdGlvbihkYXRhLCBjYWxsYmFjazIpIHsKICAgICAgICByZXR1cm4gcmVxdWVzdC5zZW5kKCJQT1NUIiwgZGF0YSwgY2FsbGJhY2syKTsKICAgICAgfSwKICAgICAgc2VuZDogZnVuY3Rpb24obWV0aG9kLCBkYXRhLCBjYWxsYmFjazIpIHsKICAgICAgICB4aHIub3BlbihtZXRob2QsIHVybCwgdHJ1ZSwgdXNlciwgcGFzc3dvcmQpOwogICAgICAgIGlmIChtaW1lVHlwZSAhPSBudWxsICYmICFoZWFkZXJzLmhhcygiYWNjZXB0IikpCiAgICAgICAgICBoZWFkZXJzLnNldCgiYWNjZXB0IiwgbWltZVR5cGUgKyAiLCovKiIpOwogICAgICAgIGlmICh4aHIuc2V0UmVxdWVzdEhlYWRlcikKICAgICAgICAgIGhlYWRlcnMuZWFjaChmdW5jdGlvbih2YWx1ZSwgbmFtZSkgewogICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihuYW1lLCB2YWx1ZSk7CiAgICAgICAgICB9KTsKICAgICAgICBpZiAobWltZVR5cGUgIT0gbnVsbCAmJiB4aHIub3ZlcnJpZGVNaW1lVHlwZSkKICAgICAgICAgIHhoci5vdmVycmlkZU1pbWVUeXBlKG1pbWVUeXBlKTsKICAgICAgICBpZiAocmVzcG9uc2VUeXBlICE9IG51bGwpCiAgICAgICAgICB4aHIucmVzcG9uc2VUeXBlID0gcmVzcG9uc2VUeXBlOwogICAgICAgIGlmICh0aW1lb3V0ID4gMCkKICAgICAgICAgIHhoci50aW1lb3V0ID0gdGltZW91dDsKICAgICAgICBpZiAoY2FsbGJhY2syID09IG51bGwgJiYgdHlwZW9mIGRhdGEgPT09ICJmdW5jdGlvbiIpCiAgICAgICAgICBjYWxsYmFjazIgPSBkYXRhLCBkYXRhID0gbnVsbDsKICAgICAgICBpZiAoY2FsbGJhY2syICE9IG51bGwgJiYgY2FsbGJhY2syLmxlbmd0aCA9PT0gMSkKICAgICAgICAgIGNhbGxiYWNrMiA9IGZpeENhbGxiYWNrKGNhbGxiYWNrMik7CiAgICAgICAgaWYgKGNhbGxiYWNrMiAhPSBudWxsKQogICAgICAgICAgcmVxdWVzdC5vbigiZXJyb3IiLCBjYWxsYmFjazIpLm9uKCJsb2FkIiwgZnVuY3Rpb24oeGhyMikgewogICAgICAgICAgICBjYWxsYmFjazIobnVsbCwgeGhyMik7CiAgICAgICAgICB9KTsKICAgICAgICBldmVudC5jYWxsKCJiZWZvcmVzZW5kIiwgcmVxdWVzdCwgeGhyKTsKICAgICAgICB4aHIuc2VuZChkYXRhID09IG51bGwgPyBudWxsIDogZGF0YSk7CiAgICAgICAgcmV0dXJuIHJlcXVlc3Q7CiAgICAgIH0sCiAgICAgIGFib3J0OiBmdW5jdGlvbigpIHsKICAgICAgICB4aHIuYWJvcnQoKTsKICAgICAgICByZXR1cm4gcmVxdWVzdDsKICAgICAgfSwKICAgICAgb246IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciB2YWx1ZSA9IGV2ZW50Lm9uLmFwcGx5KGV2ZW50LCBhcmd1bWVudHMpOwogICAgICAgIHJldHVybiB2YWx1ZSA9PT0gZXZlbnQgPyByZXF1ZXN0IDogdmFsdWU7CiAgICAgIH0KICAgIH07CiAgICBpZiAoY2FsbGJhY2sgIT0gbnVsbCkgewogICAgICBpZiAodHlwZW9mIGNhbGxiYWNrICE9PSAiZnVuY3Rpb24iKQogICAgICAgIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBjYWxsYmFjazogIiArIGNhbGxiYWNrKTsKICAgICAgcmV0dXJuIHJlcXVlc3QuZ2V0KGNhbGxiYWNrKTsKICAgIH0KICAgIHJldHVybiByZXF1ZXN0OwogIH0KICBmdW5jdGlvbiBmaXhDYWxsYmFjayhjYWxsYmFjaykgewogICAgcmV0dXJuIGZ1bmN0aW9uKGVycm9yLCB4aHIpIHsKICAgICAgY2FsbGJhY2soZXJyb3IgPT0gbnVsbCA/IHhociA6IG51bGwpOwogICAgfTsKICB9CiAgZnVuY3Rpb24gaGFzUmVzcG9uc2UoeGhyKSB7CiAgICB2YXIgdHlwZSA9IHhoci5yZXNwb25zZVR5cGU7CiAgICByZXR1cm4gdHlwZSAmJiB0eXBlICE9PSAidGV4dCIgPyB4aHIucmVzcG9uc2UgOiB4aHIucmVzcG9uc2VUZXh0OwogIH0KCiAgLy8gbm9kZV9tb2R1bGVzL2QzLXJlcXVlc3Qvc3JjL2h0bWwuanMKICBpbml0X2J1ZmZlcl9zaGltKCk7CgogIC8vIG5vZGVfbW9kdWxlcy9kMy1yZXF1ZXN0L3NyYy90eXBlLmpzCiAgaW5pdF9idWZmZXJfc2hpbSgpOwogIGZ1bmN0aW9uIHR5cGVfZGVmYXVsdChkZWZhdWx0TWltZVR5cGUsIHJlc3BvbnNlKSB7CiAgICByZXR1cm4gZnVuY3Rpb24odXJsLCBjYWxsYmFjaykgewogICAgICB2YXIgciA9IHJlcXVlc3RfZGVmYXVsdCh1cmwpLm1pbWVUeXBlKGRlZmF1bHRNaW1lVHlwZSkucmVzcG9uc2UocmVzcG9uc2UpOwogICAgICBpZiAoY2FsbGJhY2sgIT0gbnVsbCkgewogICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgIT09ICJmdW5jdGlvbiIpCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgY2FsbGJhY2s6ICIgKyBjYWxsYmFjayk7CiAgICAgICAgcmV0dXJuIHIuZ2V0KGNhbGxiYWNrKTsKICAgICAgfQogICAgICByZXR1cm4gcjsKICAgIH07CiAgfQoKICAvLyBub2RlX21vZHVsZXMvZDMtcmVxdWVzdC9zcmMvaHRtbC5qcwogIHZhciBodG1sX2RlZmF1bHQgPSB0eXBlX2RlZmF1bHQoInRleHQvaHRtbCIsIGZ1bmN0aW9uKHhocikgewogICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZVJhbmdlKCkuY3JlYXRlQ29udGV4dHVhbEZyYWdtZW50KHhoci5yZXNwb25zZVRleHQpOwogIH0pOwoKICAvLyBub2RlX21vZHVsZXMvZDMtcmVxdWVzdC9zcmMvanNvbi5qcwogIGluaXRfYnVmZmVyX3NoaW0oKTsKICB2YXIganNvbl9kZWZhdWx0ID0gdHlwZV9kZWZhdWx0KCJhcHBsaWNhdGlvbi9qc29uIiwgZnVuY3Rpb24oeGhyKSB7CiAgICByZXR1cm4gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KTsKICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2QzLXJlcXVlc3Qvc3JjL3RleHQuanMKICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgdmFyIHRleHRfZGVmYXVsdCA9IHR5cGVfZGVmYXVsdCgidGV4dC9wbGFpbiIsIGZ1bmN0aW9uKHhocikgewogICAgcmV0dXJuIHhoci5yZXNwb25zZVRleHQ7CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9kMy1yZXF1ZXN0L3NyYy94bWwuanMKICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgdmFyIHhtbF9kZWZhdWx0ID0gdHlwZV9kZWZhdWx0KCJhcHBsaWNhdGlvbi94bWwiLCBmdW5jdGlvbih4aHIpIHsKICAgIHZhciB4bWwgPSB4aHIucmVzcG9uc2VYTUw7CiAgICBpZiAoIXhtbCkKICAgICAgdGhyb3cgbmV3IEVycm9yKCJwYXJzZSBlcnJvciIpOwogICAgcmV0dXJuIHhtbDsKICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL2QzLXJlcXVlc3Qvc3JjL2Nzdi5qcwogIGluaXRfYnVmZmVyX3NoaW0oKTsKCiAgLy8gbm9kZV9tb2R1bGVzL2QzLXJlcXVlc3Qvbm9kZV9tb2R1bGVzL2QzLWRzdi9zcmMvaW5kZXguanMKICBpbml0X2J1ZmZlcl9zaGltKCk7CgogIC8vIG5vZGVfbW9kdWxlcy9kMy1yZXF1ZXN0L25vZGVfbW9kdWxlcy9kMy1kc3Yvc3JjL2Rzdi5qcwogIGluaXRfYnVmZmVyX3NoaW0oKTsKICB2YXIgRU9MID0ge307CiAgdmFyIEVPRiA9IHt9OwogIHZhciBRVU9URSA9IDM0OwogIHZhciBORVdMSU5FID0gMTA7CiAgdmFyIFJFVFVSTiA9IDEzOwogIGZ1bmN0aW9uIG9iamVjdENvbnZlcnRlcihjb2x1bW5zKSB7CiAgICByZXR1cm4gbmV3IEZ1bmN0aW9uKCJkIiwgInJldHVybiB7IiArIGNvbHVtbnMubWFwKGZ1bmN0aW9uKG5hbWUsIGkpIHsKICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG5hbWUpICsgIjogZFsiICsgaSArICddIHx8ICIiJzsKICAgIH0pLmpvaW4oIiwiKSArICJ9Iik7CiAgfQogIGZ1bmN0aW9uIGN1c3RvbUNvbnZlcnRlcihjb2x1bW5zLCBmKSB7CiAgICB2YXIgb2JqZWN0ID0gb2JqZWN0Q29udmVydGVyKGNvbHVtbnMpOwogICAgcmV0dXJuIGZ1bmN0aW9uKHJvdywgaSkgewogICAgICByZXR1cm4gZihvYmplY3Qocm93KSwgaSwgY29sdW1ucyk7CiAgICB9OwogIH0KICBmdW5jdGlvbiBpbmZlckNvbHVtbnMocm93cykgewogICAgdmFyIGNvbHVtblNldCA9IE9iamVjdC5jcmVhdGUobnVsbCksIGNvbHVtbnMgPSBbXTsKICAgIHJvd3MuZm9yRWFjaChmdW5jdGlvbihyb3cpIHsKICAgICAgZm9yICh2YXIgY29sdW1uIGluIHJvdykgewogICAgICAgIGlmICghKGNvbHVtbiBpbiBjb2x1bW5TZXQpKSB7CiAgICAgICAgICBjb2x1bW5zLnB1c2goY29sdW1uU2V0W2NvbHVtbl0gPSBjb2x1bW4pOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gY29sdW1uczsKICB9CiAgZnVuY3Rpb24gcGFkKHZhbHVlLCB3aWR0aCkgewogICAgdmFyIHMgPSB2YWx1ZSArICIiLCBsZW5ndGggPSBzLmxlbmd0aDsKICAgIHJldHVybiBsZW5ndGggPCB3aWR0aCA/IG5ldyBBcnJheSh3aWR0aCAtIGxlbmd0aCArIDEpLmpvaW4oMCkgKyBzIDogczsKICB9CiAgZnVuY3Rpb24gZm9ybWF0WWVhcih5ZWFyKSB7CiAgICByZXR1cm4geWVhciA8IDAgPyAiLSIgKyBwYWQoLXllYXIsIDYpIDogeWVhciA+IDk5OTkgPyAiKyIgKyBwYWQoeWVhciwgNikgOiBwYWQoeWVhciwgNCk7CiAgfQogIGZ1bmN0aW9uIGZvcm1hdERhdGUoZGF0ZSkgewogICAgdmFyIGhvdXJzID0gZGF0ZS5nZXRVVENIb3VycygpLCBtaW51dGVzID0gZGF0ZS5nZXRVVENNaW51dGVzKCksIHNlY29uZHMgPSBkYXRlLmdldFVUQ1NlY29uZHMoKSwgbWlsbGlzZWNvbmRzID0gZGF0ZS5nZXRVVENNaWxsaXNlY29uZHMoKTsKICAgIHJldHVybiBpc05hTihkYXRlKSA/ICJJbnZhbGlkIERhdGUiIDogZm9ybWF0WWVhcihkYXRlLmdldFVUQ0Z1bGxZZWFyKCksIDQpICsgIi0iICsgcGFkKGRhdGUuZ2V0VVRDTW9udGgoKSArIDEsIDIpICsgIi0iICsgcGFkKGRhdGUuZ2V0VVRDRGF0ZSgpLCAyKSArIChtaWxsaXNlY29uZHMgPyAiVCIgKyBwYWQoaG91cnMsIDIpICsgIjoiICsgcGFkKG1pbnV0ZXMsIDIpICsgIjoiICsgcGFkKHNlY29uZHMsIDIpICsgIi4iICsgcGFkKG1pbGxpc2Vjb25kcywgMykgKyAiWiIgOiBzZWNvbmRzID8gIlQiICsgcGFkKGhvdXJzLCAyKSArICI6IiArIHBhZChtaW51dGVzLCAyKSArICI6IiArIHBhZChzZWNvbmRzLCAyKSArICJaIiA6IG1pbnV0ZXMgfHwgaG91cnMgPyAiVCIgKyBwYWQoaG91cnMsIDIpICsgIjoiICsgcGFkKG1pbnV0ZXMsIDIpICsgIloiIDogIiIpOwogIH0KICBmdW5jdGlvbiBkc3ZfZGVmYXVsdChkZWxpbWl0ZXIpIHsKICAgIHZhciByZUZvcm1hdCA9IG5ldyBSZWdFeHAoJ1siJyArIGRlbGltaXRlciArICJcblxyXSIpLCBERUxJTUlURVIgPSBkZWxpbWl0ZXIuY2hhckNvZGVBdCgwKTsKICAgIGZ1bmN0aW9uIHBhcnNlKHRleHQsIGYpIHsKICAgICAgdmFyIGNvbnZlcnQsIGNvbHVtbnMsIHJvd3MgPSBwYXJzZVJvd3ModGV4dCwgZnVuY3Rpb24ocm93LCBpKSB7CiAgICAgICAgaWYgKGNvbnZlcnQpCiAgICAgICAgICByZXR1cm4gY29udmVydChyb3csIGkgLSAxKTsKICAgICAgICBjb2x1bW5zID0gcm93LCBjb252ZXJ0ID0gZiA/IGN1c3RvbUNvbnZlcnRlcihyb3csIGYpIDogb2JqZWN0Q29udmVydGVyKHJvdyk7CiAgICAgIH0pOwogICAgICByb3dzLmNvbHVtbnMgPSBjb2x1bW5zIHx8IFtdOwogICAgICByZXR1cm4gcm93czsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlUm93cyh0ZXh0LCBmKSB7CiAgICAgIHZhciByb3dzID0gW10sIE4gPSB0ZXh0Lmxlbmd0aCwgSSA9IDAsIG4gPSAwLCB0LCBlb2YgPSBOIDw9IDAsIGVvbCA9IGZhbHNlOwogICAgICBpZiAodGV4dC5jaGFyQ29kZUF0KE4gLSAxKSA9PT0gTkVXTElORSkKICAgICAgICAtLU47CiAgICAgIGlmICh0ZXh0LmNoYXJDb2RlQXQoTiAtIDEpID09PSBSRVRVUk4pCiAgICAgICAgLS1OOwogICAgICBmdW5jdGlvbiB0b2tlbigpIHsKICAgICAgICBpZiAoZW9mKQogICAgICAgICAgcmV0dXJuIEVPRjsKICAgICAgICBpZiAoZW9sKQogICAgICAgICAgcmV0dXJuIGVvbCA9IGZhbHNlLCBFT0w7CiAgICAgICAgdmFyIGksIGogPSBJLCBjOwogICAgICAgIGlmICh0ZXh0LmNoYXJDb2RlQXQoaikgPT09IFFVT1RFKSB7CiAgICAgICAgICB3aGlsZSAoSSsrIDwgTiAmJiB0ZXh0LmNoYXJDb2RlQXQoSSkgIT09IFFVT1RFIHx8IHRleHQuY2hhckNvZGVBdCgrK0kpID09PSBRVU9URSkKICAgICAgICAgICAgOwogICAgICAgICAgaWYgKChpID0gSSkgPj0gTikKICAgICAgICAgICAgZW9mID0gdHJ1ZTsKICAgICAgICAgIGVsc2UgaWYgKChjID0gdGV4dC5jaGFyQ29kZUF0KEkrKykpID09PSBORVdMSU5FKQogICAgICAgICAgICBlb2wgPSB0cnVlOwogICAgICAgICAgZWxzZSBpZiAoYyA9PT0gUkVUVVJOKSB7CiAgICAgICAgICAgIGVvbCA9IHRydWU7CiAgICAgICAgICAgIGlmICh0ZXh0LmNoYXJDb2RlQXQoSSkgPT09IE5FV0xJTkUpCiAgICAgICAgICAgICAgKytJOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRleHQuc2xpY2UoaiArIDEsIGkgLSAxKS5yZXBsYWNlKC8iIi9nLCAnIicpOwogICAgICAgIH0KICAgICAgICB3aGlsZSAoSSA8IE4pIHsKICAgICAgICAgIGlmICgoYyA9IHRleHQuY2hhckNvZGVBdChpID0gSSsrKSkgPT09IE5FV0xJTkUpCiAgICAgICAgICAgIGVvbCA9IHRydWU7CiAgICAgICAgICBlbHNlIGlmIChjID09PSBSRVRVUk4pIHsKICAgICAgICAgICAgZW9sID0gdHJ1ZTsKICAgICAgICAgICAgaWYgKHRleHQuY2hhckNvZGVBdChJKSA9PT0gTkVXTElORSkKICAgICAgICAgICAgICArK0k7CiAgICAgICAgICB9IGVsc2UgaWYgKGMgIT09IERFTElNSVRFUikKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICByZXR1cm4gdGV4dC5zbGljZShqLCBpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVvZiA9IHRydWUsIHRleHQuc2xpY2UoaiwgTik7CiAgICAgIH0KICAgICAgd2hpbGUgKCh0ID0gdG9rZW4oKSkgIT09IEVPRikgewogICAgICAgIHZhciByb3cgPSBbXTsKICAgICAgICB3aGlsZSAodCAhPT0gRU9MICYmIHQgIT09IEVPRikKICAgICAgICAgIHJvdy5wdXNoKHQpLCB0ID0gdG9rZW4oKTsKICAgICAgICBpZiAoZiAmJiAocm93ID0gZihyb3csIG4rKykpID09IG51bGwpCiAgICAgICAgICBjb250aW51ZTsKICAgICAgICByb3dzLnB1c2gocm93KTsKICAgICAgfQogICAgICByZXR1cm4gcm93czsKICAgIH0KICAgIGZ1bmN0aW9uIHByZWZvcm1hdEJvZHkocm93cywgY29sdW1ucykgewogICAgICByZXR1cm4gcm93cy5tYXAoZnVuY3Rpb24ocm93KSB7CiAgICAgICAgcmV0dXJuIGNvbHVtbnMubWFwKGZ1bmN0aW9uKGNvbHVtbikgewogICAgICAgICAgcmV0dXJuIGZvcm1hdFZhbHVlKHJvd1tjb2x1bW5dKTsKICAgICAgICB9KS5qb2luKGRlbGltaXRlcik7CiAgICAgIH0pOwogICAgfQogICAgZnVuY3Rpb24gZm9ybWF0KHJvd3MsIGNvbHVtbnMpIHsKICAgICAgaWYgKGNvbHVtbnMgPT0gbnVsbCkKICAgICAgICBjb2x1bW5zID0gaW5mZXJDb2x1bW5zKHJvd3MpOwogICAgICByZXR1cm4gW2NvbHVtbnMubWFwKGZvcm1hdFZhbHVlKS5qb2luKGRlbGltaXRlcildLmNvbmNhdChwcmVmb3JtYXRCb2R5KHJvd3MsIGNvbHVtbnMpKS5qb2luKCJcbiIpOwogICAgfQogICAgZnVuY3Rpb24gZm9ybWF0Qm9keShyb3dzLCBjb2x1bW5zKSB7CiAgICAgIGlmIChjb2x1bW5zID09IG51bGwpCiAgICAgICAgY29sdW1ucyA9IGluZmVyQ29sdW1ucyhyb3dzKTsKICAgICAgcmV0dXJuIHByZWZvcm1hdEJvZHkocm93cywgY29sdW1ucykuam9pbigiXG4iKTsKICAgIH0KICAgIGZ1bmN0aW9uIGZvcm1hdFJvd3Mocm93cykgewogICAgICByZXR1cm4gcm93cy5tYXAoZm9ybWF0Um93KS5qb2luKCJcbiIpOwogICAgfQogICAgZnVuY3Rpb24gZm9ybWF0Um93KHJvdykgewogICAgICByZXR1cm4gcm93Lm1hcChmb3JtYXRWYWx1ZSkuam9pbihkZWxpbWl0ZXIpOwogICAgfQogICAgZnVuY3Rpb24gZm9ybWF0VmFsdWUodmFsdWUpIHsKICAgICAgcmV0dXJuIHZhbHVlID09IG51bGwgPyAiIiA6IHZhbHVlIGluc3RhbmNlb2YgRGF0ZSA/IGZvcm1hdERhdGUodmFsdWUpIDogcmVGb3JtYXQudGVzdCh2YWx1ZSArPSAiIikgPyAnIicgKyB2YWx1ZS5yZXBsYWNlKC8iL2csICciIicpICsgJyInIDogdmFsdWU7CiAgICB9CiAgICByZXR1cm4gewogICAgICBwYXJzZSwKICAgICAgcGFyc2VSb3dzLAogICAgICBmb3JtYXQsCiAgICAgIGZvcm1hdEJvZHksCiAgICAgIGZvcm1hdFJvd3MsCiAgICAgIGZvcm1hdFJvdywKICAgICAgZm9ybWF0VmFsdWUKICAgIH07CiAgfQoKICAvLyBub2RlX21vZHVsZXMvZDMtcmVxdWVzdC9ub2RlX21vZHVsZXMvZDMtZHN2L3NyYy9jc3YuanMKICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgdmFyIGNzdiA9IGRzdl9kZWZhdWx0KCIsIik7CiAgdmFyIGNzdlBhcnNlID0gY3N2LnBhcnNlOwogIHZhciBjc3ZQYXJzZVJvd3MgPSBjc3YucGFyc2VSb3dzOwogIHZhciBjc3ZGb3JtYXQgPSBjc3YuZm9ybWF0OwogIHZhciBjc3ZGb3JtYXRCb2R5ID0gY3N2LmZvcm1hdEJvZHk7CiAgdmFyIGNzdkZvcm1hdFJvd3MgPSBjc3YuZm9ybWF0Um93czsKICB2YXIgY3N2Rm9ybWF0Um93ID0gY3N2LmZvcm1hdFJvdzsKICB2YXIgY3N2Rm9ybWF0VmFsdWUgPSBjc3YuZm9ybWF0VmFsdWU7CgogIC8vIG5vZGVfbW9kdWxlcy9kMy1yZXF1ZXN0L25vZGVfbW9kdWxlcy9kMy1kc3Yvc3JjL3Rzdi5qcwogIGluaXRfYnVmZmVyX3NoaW0oKTsKICB2YXIgdHN2ID0gZHN2X2RlZmF1bHQoIgkiKTsKICB2YXIgdHN2UGFyc2UgPSB0c3YucGFyc2U7CiAgdmFyIHRzdlBhcnNlUm93cyA9IHRzdi5wYXJzZVJvd3M7CiAgdmFyIHRzdkZvcm1hdCA9IHRzdi5mb3JtYXQ7CiAgdmFyIHRzdkZvcm1hdEJvZHkgPSB0c3YuZm9ybWF0Qm9keTsKICB2YXIgdHN2Rm9ybWF0Um93cyA9IHRzdi5mb3JtYXRSb3dzOwogIHZhciB0c3ZGb3JtYXRSb3cgPSB0c3YuZm9ybWF0Um93OwogIHZhciB0c3ZGb3JtYXRWYWx1ZSA9IHRzdi5mb3JtYXRWYWx1ZTsKCiAgLy8gbm9kZV9tb2R1bGVzL2QzLXJlcXVlc3Qvc3JjL2Rzdi5qcwogIGluaXRfYnVmZmVyX3NoaW0oKTsKICBmdW5jdGlvbiBkc3ZfZGVmYXVsdDIoZGVmYXVsdE1pbWVUeXBlLCBwYXJzZSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKHVybCwgcm93LCBjYWxsYmFjaykgewogICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDMpCiAgICAgICAgY2FsbGJhY2sgPSByb3csIHJvdyA9IG51bGw7CiAgICAgIHZhciByID0gcmVxdWVzdF9kZWZhdWx0KHVybCkubWltZVR5cGUoZGVmYXVsdE1pbWVUeXBlKTsKICAgICAgci5yb3cgPSBmdW5jdGlvbihfKSB7CiAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyByLnJlc3BvbnNlKHJlc3BvbnNlT2YocGFyc2UsIHJvdyA9IF8pKSA6IHJvdzsKICAgICAgfTsKICAgICAgci5yb3cocm93KTsKICAgICAgcmV0dXJuIGNhbGxiYWNrID8gci5nZXQoY2FsbGJhY2spIDogcjsKICAgIH07CiAgfQogIGZ1bmN0aW9uIHJlc3BvbnNlT2YocGFyc2UsIHJvdykgewogICAgcmV0dXJuIGZ1bmN0aW9uKHJlcXVlc3QpIHsKICAgICAgcmV0dXJuIHBhcnNlKHJlcXVlc3QucmVzcG9uc2VUZXh0LCByb3cpOwogICAgfTsKICB9CgogIC8vIG5vZGVfbW9kdWxlcy9kMy1yZXF1ZXN0L3NyYy9jc3YuanMKICB2YXIgY3N2X2RlZmF1bHQgPSBkc3ZfZGVmYXVsdDIoInRleHQvY3N2IiwgY3N2UGFyc2UpOwoKICAvLyBub2RlX21vZHVsZXMvZDMtcmVxdWVzdC9zcmMvdHN2LmpzCiAgaW5pdF9idWZmZXJfc2hpbSgpOwogIHZhciB0c3ZfZGVmYXVsdCA9IGRzdl9kZWZhdWx0MigidGV4dC90YWItc2VwYXJhdGVkLXZhbHVlcyIsIHRzdlBhcnNlKTsKCiAgLy8gbm9kZV9tb2R1bGVzL2QzLWFycmF5L3NyYy9pbmRleC5qcwogIGluaXRfYnVmZmVyX3NoaW0oKTsKCiAgLy8gbm9kZV9tb2R1bGVzL2QzLWFycmF5L3NyYy9hc2NlbmRpbmcuanMKICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgZnVuY3Rpb24gYXNjZW5kaW5nX2RlZmF1bHQoYSwgYikgewogICAgcmV0dXJuIGEgPCBiID8gLTEgOiBhID4gYiA/IDEgOiBhID49IGIgPyAwIDogTmFOOwogIH0KCiAgLy8gbm9kZV9tb2R1bGVzL2QzLWFycmF5L3NyYy9iaXNlY3Rvci5qcwogIGluaXRfYnVmZmVyX3NoaW0oKTsKICBmdW5jdGlvbiBiaXNlY3Rvcl9kZWZhdWx0KGYpIHsKICAgIGxldCBkZWx0YSA9IGY7CiAgICBsZXQgY29tcGFyZSA9IGY7CiAgICBpZiAoZi5sZW5ndGggPT09IDEpIHsKICAgICAgZGVsdGEgPSAoZCwgeCkgPT4gZihkKSAtIHg7CiAgICAgIGNvbXBhcmUgPSBhc2NlbmRpbmdDb21wYXJhdG9yKGYpOwogICAgfQogICAgZnVuY3Rpb24gbGVmdChhLCB4LCBsbywgaGkpIHsKICAgICAgaWYgKGxvID09IG51bGwpCiAgICAgICAgbG8gPSAwOwogICAgICBpZiAoaGkgPT0gbnVsbCkKICAgICAgICBoaSA9IGEubGVuZ3RoOwogICAgICB3aGlsZSAobG8gPCBoaSkgewogICAgICAgIGNvbnN0IG1pZCA9IGxvICsgaGkgPj4+IDE7CiAgICAgICAgaWYgKGNvbXBhcmUoYVttaWRdLCB4KSA8IDApCiAgICAgICAgICBsbyA9IG1pZCArIDE7CiAgICAgICAgZWxzZQogICAgICAgICAgaGkgPSBtaWQ7CiAgICAgIH0KICAgICAgcmV0dXJuIGxvOwogICAgfQogICAgZnVuY3Rpb24gcmlnaHQoYSwgeCwgbG8sIGhpKSB7CiAgICAgIGlmIChsbyA9PSBudWxsKQogICAgICAgIGxvID0gMDsKICAgICAgaWYgKGhpID09IG51bGwpCiAgICAgICAgaGkgPSBhLmxlbmd0aDsKICAgICAgd2hpbGUgKGxvIDwgaGkpIHsKICAgICAgICBjb25zdCBtaWQgPSBsbyArIGhpID4+PiAxOwogICAgICAgIGlmIChjb21wYXJlKGFbbWlkXSwgeCkgPiAwKQogICAgICAgICAgaGkgPSBtaWQ7CiAgICAgICAgZWxzZQogICAgICAgICAgbG8gPSBtaWQgKyAxOwogICAgICB9CiAgICAgIHJldHVybiBsbzsKICAgIH0KICAgIGZ1bmN0aW9uIGNlbnRlcihhLCB4LCBsbywgaGkpIHsKICAgICAgaWYgKGxvID09IG51bGwpCiAgICAgICAgbG8gPSAwOwogICAgICBpZiAoaGkgPT0gbnVsbCkKICAgICAgICBoaSA9IGEubGVuZ3RoOwogICAgICBjb25zdCBpID0gbGVmdChhLCB4LCBsbywgaGkgLSAxKTsKICAgICAgcmV0dXJuIGkgPiBsbyAmJiBkZWx0YShhW2kgLSAxXSwgeCkgPiAtZGVsdGEoYVtpXSwgeCkgPyBpIC0gMSA6IGk7CiAgICB9CiAgICByZXR1cm4geyBsZWZ0LCBjZW50ZXIsIHJpZ2h0IH07CiAgfQogIGZ1bmN0aW9uIGFzY2VuZGluZ0NvbXBhcmF0b3IoZikgewogICAgcmV0dXJuIChkLCB4KSA9PiBhc2NlbmRpbmdfZGVmYXVsdChmKGQpLCB4KTsKICB9CgogIC8vIG5vZGVfbW9kdWxlcy9kMy1kc3Yvc3JjL2luZGV4LmpzCiAgaW5pdF9idWZmZXJfc2hpbSgpOwoKICAvLyBub2RlX21vZHVsZXMvZDMtZHN2L3NyYy9kc3YuanMKICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgdmFyIEVPTDIgPSB7fTsKICB2YXIgRU9GMiA9IHt9OwogIHZhciBRVU9URTIgPSAzNDsKICB2YXIgTkVXTElORTIgPSAxMDsKICB2YXIgUkVUVVJOMiA9IDEzOwogIGZ1bmN0aW9uIG9iamVjdENvbnZlcnRlcjIoY29sdW1ucykgewogICAgcmV0dXJuIG5ldyBGdW5jdGlvbigiZCIsICJyZXR1cm4geyIgKyBjb2x1bW5zLm1hcChmdW5jdGlvbihuYW1lLCBpKSB7CiAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShuYW1lKSArICI6IGRbIiArIGkgKyAnXSB8fCAiIic7CiAgICB9KS5qb2luKCIsIikgKyAifSIpOwogIH0KICBmdW5jdGlvbiBjdXN0b21Db252ZXJ0ZXIyKGNvbHVtbnMsIGYpIHsKICAgIHZhciBvYmplY3QgPSBvYmplY3RDb252ZXJ0ZXIyKGNvbHVtbnMpOwogICAgcmV0dXJuIGZ1bmN0aW9uKHJvdywgaSkgewogICAgICByZXR1cm4gZihvYmplY3Qocm93KSwgaSwgY29sdW1ucyk7CiAgICB9OwogIH0KICBmdW5jdGlvbiBpbmZlckNvbHVtbnMyKHJvd3MpIHsKICAgIHZhciBjb2x1bW5TZXQgPSBPYmplY3QuY3JlYXRlKG51bGwpLCBjb2x1bW5zID0gW107CiAgICByb3dzLmZvckVhY2goZnVuY3Rpb24ocm93KSB7CiAgICAgIGZvciAodmFyIGNvbHVtbiBpbiByb3cpIHsKICAgICAgICBpZiAoIShjb2x1bW4gaW4gY29sdW1uU2V0KSkgewogICAgICAgICAgY29sdW1ucy5wdXNoKGNvbHVtblNldFtjb2x1bW5dID0gY29sdW1uKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIGNvbHVtbnM7CiAgfQogIGZ1bmN0aW9uIHBhZDIodmFsdWUsIHdpZHRoKSB7CiAgICB2YXIgcyA9IHZhbHVlICsgIiIsIGxlbmd0aCA9IHMubGVuZ3RoOwogICAgcmV0dXJuIGxlbmd0aCA8IHdpZHRoID8gbmV3IEFycmF5KHdpZHRoIC0gbGVuZ3RoICsgMSkuam9pbigwKSArIHMgOiBzOwogIH0KICBmdW5jdGlvbiBmb3JtYXRZZWFyMih5ZWFyKSB7CiAgICByZXR1cm4geWVhciA8IDAgPyAiLSIgKyBwYWQyKC15ZWFyLCA2KSA6IHllYXIgPiA5OTk5ID8gIisiICsgcGFkMih5ZWFyLCA2KSA6IHBhZDIoeWVhciwgNCk7CiAgfQogIGZ1bmN0aW9uIGZvcm1hdERhdGUyKGRhdGUpIHsKICAgIHZhciBob3VycyA9IGRhdGUuZ2V0VVRDSG91cnMoKSwgbWludXRlcyA9IGRhdGUuZ2V0VVRDTWludXRlcygpLCBzZWNvbmRzID0gZGF0ZS5nZXRVVENTZWNvbmRzKCksIG1pbGxpc2Vjb25kcyA9IGRhdGUuZ2V0VVRDTWlsbGlzZWNvbmRzKCk7CiAgICByZXR1cm4gaXNOYU4oZGF0ZSkgPyAiSW52YWxpZCBEYXRlIiA6IGZvcm1hdFllYXIyKGRhdGUuZ2V0VVRDRnVsbFllYXIoKSwgNCkgKyAiLSIgKyBwYWQyKGRhdGUuZ2V0VVRDTW9udGgoKSArIDEsIDIpICsgIi0iICsgcGFkMihkYXRlLmdldFVUQ0RhdGUoKSwgMikgKyAobWlsbGlzZWNvbmRzID8gIlQiICsgcGFkMihob3VycywgMikgKyAiOiIgKyBwYWQyKG1pbnV0ZXMsIDIpICsgIjoiICsgcGFkMihzZWNvbmRzLCAyKSArICIuIiArIHBhZDIobWlsbGlzZWNvbmRzLCAzKSArICJaIiA6IHNlY29uZHMgPyAiVCIgKyBwYWQyKGhvdXJzLCAyKSArICI6IiArIHBhZDIobWludXRlcywgMikgKyAiOiIgKyBwYWQyKHNlY29uZHMsIDIpICsgIloiIDogbWludXRlcyB8fCBob3VycyA/ICJUIiArIHBhZDIoaG91cnMsIDIpICsgIjoiICsgcGFkMihtaW51dGVzLCAyKSArICJaIiA6ICIiKTsKICB9CiAgZnVuY3Rpb24gZHN2X2RlZmF1bHQzKGRlbGltaXRlcikgewogICAgdmFyIHJlRm9ybWF0ID0gbmV3IFJlZ0V4cCgnWyInICsgZGVsaW1pdGVyICsgIlxuXHJdIiksIERFTElNSVRFUiA9IGRlbGltaXRlci5jaGFyQ29kZUF0KDApOwogICAgZnVuY3Rpb24gcGFyc2UodGV4dCwgZikgewogICAgICB2YXIgY29udmVydCwgY29sdW1ucywgcm93cyA9IHBhcnNlUm93cyh0ZXh0LCBmdW5jdGlvbihyb3csIGkpIHsKICAgICAgICBpZiAoY29udmVydCkKICAgICAgICAgIHJldHVybiBjb252ZXJ0KHJvdywgaSAtIDEpOwogICAgICAgIGNvbHVtbnMgPSByb3csIGNvbnZlcnQgPSBmID8gY3VzdG9tQ29udmVydGVyMihyb3csIGYpIDogb2JqZWN0Q29udmVydGVyMihyb3cpOwogICAgICB9KTsKICAgICAgcm93cy5jb2x1bW5zID0gY29sdW1ucyB8fCBbXTsKICAgICAgcmV0dXJuIHJvd3M7CiAgICB9CiAgICBmdW5jdGlvbiBwYXJzZVJvd3ModGV4dCwgZikgewogICAgICB2YXIgcm93cyA9IFtdLCBOID0gdGV4dC5sZW5ndGgsIEkgPSAwLCBuID0gMCwgdCwgZW9mID0gTiA8PSAwLCBlb2wgPSBmYWxzZTsKICAgICAgaWYgKHRleHQuY2hhckNvZGVBdChOIC0gMSkgPT09IE5FV0xJTkUyKQogICAgICAgIC0tTjsKICAgICAgaWYgKHRleHQuY2hhckNvZGVBdChOIC0gMSkgPT09IFJFVFVSTjIpCiAgICAgICAgLS1OOwogICAgICBmdW5jdGlvbiB0b2tlbigpIHsKICAgICAgICBpZiAoZW9mKQogICAgICAgICAgcmV0dXJuIEVPRjI7CiAgICAgICAgaWYgKGVvbCkKICAgICAgICAgIHJldHVybiBlb2wgPSBmYWxzZSwgRU9MMjsKICAgICAgICB2YXIgaSwgaiA9IEksIGM7CiAgICAgICAgaWYgKHRleHQuY2hhckNvZGVBdChqKSA9PT0gUVVPVEUyKSB7CiAgICAgICAgICB3aGlsZSAoSSsrIDwgTiAmJiB0ZXh0LmNoYXJDb2RlQXQoSSkgIT09IFFVT1RFMiB8fCB0ZXh0LmNoYXJDb2RlQXQoKytJKSA9PT0gUVVPVEUyKQogICAgICAgICAgICA7CiAgICAgICAgICBpZiAoKGkgPSBJKSA+PSBOKQogICAgICAgICAgICBlb2YgPSB0cnVlOwogICAgICAgICAgZWxzZSBpZiAoKGMgPSB0ZXh0LmNoYXJDb2RlQXQoSSsrKSkgPT09IE5FV0xJTkUyKQogICAgICAgICAgICBlb2wgPSB0cnVlOwogICAgICAgICAgZWxzZSBpZiAoYyA9PT0gUkVUVVJOMikgewogICAgICAgICAgICBlb2wgPSB0cnVlOwogICAgICAgICAgICBpZiAodGV4dC5jaGFyQ29kZUF0KEkpID09PSBORVdMSU5FMikKICAgICAgICAgICAgICArK0k7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdGV4dC5zbGljZShqICsgMSwgaSAtIDEpLnJlcGxhY2UoLyIiL2csICciJyk7CiAgICAgICAgfQogICAgICAgIHdoaWxlIChJIDwgTikgewogICAgICAgICAgaWYgKChjID0gdGV4dC5jaGFyQ29kZUF0KGkgPSBJKyspKSA9PT0gTkVXTElORTIpCiAgICAgICAgICAgIGVvbCA9IHRydWU7CiAgICAgICAgICBlbHNlIGlmIChjID09PSBSRVRVUk4yKSB7CiAgICAgICAgICAgIGVvbCA9IHRydWU7CiAgICAgICAgICAgIGlmICh0ZXh0LmNoYXJDb2RlQXQoSSkgPT09IE5FV0xJTkUyKQogICAgICAgICAgICAgICsrSTsKICAgICAgICAgIH0gZWxzZSBpZiAoYyAhPT0gREVMSU1JVEVSKQogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIHJldHVybiB0ZXh0LnNsaWNlKGosIGkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZW9mID0gdHJ1ZSwgdGV4dC5zbGljZShqLCBOKTsKICAgICAgfQogICAgICB3aGlsZSAoKHQgPSB0b2tlbigpKSAhPT0gRU9GMikgewogICAgICAgIHZhciByb3cgPSBbXTsKICAgICAgICB3aGlsZSAodCAhPT0gRU9MMiAmJiB0ICE9PSBFT0YyKQogICAgICAgICAgcm93LnB1c2godCksIHQgPSB0b2tlbigpOwogICAgICAgIGlmIChmICYmIChyb3cgPSBmKHJvdywgbisrKSkgPT0gbnVsbCkKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIHJvd3MucHVzaChyb3cpOwogICAgICB9CiAgICAgIHJldHVybiByb3dzOwogICAgfQogICAgZnVuY3Rpb24gcHJlZm9ybWF0Qm9keShyb3dzLCBjb2x1bW5zKSB7CiAgICAgIHJldHVybiByb3dzLm1hcChmdW5jdGlvbihyb3cpIHsKICAgICAgICByZXR1cm4gY29sdW1ucy5tYXAoZnVuY3Rpb24oY29sdW1uKSB7CiAgICAgICAgICByZXR1cm4gZm9ybWF0VmFsdWUocm93W2NvbHVtbl0pOwogICAgICAgIH0pLmpvaW4oZGVsaW1pdGVyKTsKICAgICAgfSk7CiAgICB9CiAgICBmdW5jdGlvbiBmb3JtYXQocm93cywgY29sdW1ucykgewogICAgICBpZiAoY29sdW1ucyA9PSBudWxsKQogICAgICAgIGNvbHVtbnMgPSBpbmZlckNvbHVtbnMyKHJvd3MpOwogICAgICByZXR1cm4gW2NvbHVtbnMubWFwKGZvcm1hdFZhbHVlKS5qb2luKGRlbGltaXRlcildLmNvbmNhdChwcmVmb3JtYXRCb2R5KHJvd3MsIGNvbHVtbnMpKS5qb2luKCJcbiIpOwogICAgfQogICAgZnVuY3Rpb24gZm9ybWF0Qm9keShyb3dzLCBjb2x1bW5zKSB7CiAgICAgIGlmIChjb2x1bW5zID09IG51bGwpCiAgICAgICAgY29sdW1ucyA9IGluZmVyQ29sdW1uczIocm93cyk7CiAgICAgIHJldHVybiBwcmVmb3JtYXRCb2R5KHJvd3MsIGNvbHVtbnMpLmpvaW4oIlxuIik7CiAgICB9CiAgICBmdW5jdGlvbiBmb3JtYXRSb3dzKHJvd3MpIHsKICAgICAgcmV0dXJuIHJvd3MubWFwKGZvcm1hdFJvdykuam9pbigiXG4iKTsKICAgIH0KICAgIGZ1bmN0aW9uIGZvcm1hdFJvdyhyb3cpIHsKICAgICAgcmV0dXJuIHJvdy5tYXAoZm9ybWF0VmFsdWUpLmpvaW4oZGVsaW1pdGVyKTsKICAgIH0KICAgIGZ1bmN0aW9uIGZvcm1hdFZhbHVlKHZhbHVlKSB7CiAgICAgIHJldHVybiB2YWx1ZSA9PSBudWxsID8gIiIgOiB2YWx1ZSBpbnN0YW5jZW9mIERhdGUgPyBmb3JtYXREYXRlMih2YWx1ZSkgOiByZUZvcm1hdC50ZXN0KHZhbHVlICs9ICIiKSA/ICciJyArIHZhbHVlLnJlcGxhY2UoLyIvZywgJyIiJykgKyAnIicgOiB2YWx1ZTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIHBhcnNlLAogICAgICBwYXJzZVJvd3MsCiAgICAgIGZvcm1hdCwKICAgICAgZm9ybWF0Qm9keSwKICAgICAgZm9ybWF0Um93cywKICAgICAgZm9ybWF0Um93LAogICAgICBmb3JtYXRWYWx1ZQogICAgfTsKICB9CgogIC8vIG5vZGVfbW9kdWxlcy9kMy1kc3Yvc3JjL3Rzdi5qcwogIGluaXRfYnVmZmVyX3NoaW0oKTsKICB2YXIgdHN2MiA9IGRzdl9kZWZhdWx0MygiCSIpOwogIHZhciB0c3ZQYXJzZTIgPSB0c3YyLnBhcnNlOwogIHZhciB0c3ZQYXJzZVJvd3MyID0gdHN2Mi5wYXJzZVJvd3M7CiAgdmFyIHRzdkZvcm1hdDIgPSB0c3YyLmZvcm1hdDsKICB2YXIgdHN2Rm9ybWF0Qm9keTIgPSB0c3YyLmZvcm1hdEJvZHk7CiAgdmFyIHRzdkZvcm1hdFJvd3MyID0gdHN2Mi5mb3JtYXRSb3dzOwogIHZhciB0c3ZGb3JtYXRSb3cyID0gdHN2Mi5mb3JtYXRSb3c7CiAgdmFyIHRzdkZvcm1hdFZhbHVlMiA9IHRzdjIuZm9ybWF0VmFsdWU7CgogIC8vIG5vZGVfbW9kdWxlcy90aHJlYWRzL3dvcmtlci5tanMKICBpbml0X2J1ZmZlcl9zaGltKCk7CiAgdmFyIGltcG9ydF93b3JrZXIgPSBfX3RvTW9kdWxlKHJlcXVpcmVfd29ya2VyKCkpOwogIHZhciBleHBvc2UgPSBpbXBvcnRfd29ya2VyLmRlZmF1bHQuZXhwb3NlOwogIHZhciByZWdpc3RlclNlcmlhbGl6ZXIgPSBpbXBvcnRfd29ya2VyLmRlZmF1bHQucmVnaXN0ZXJTZXJpYWxpemVyOwogIHZhciBUcmFuc2ZlciA9IGltcG9ydF93b3JrZXIuZGVmYXVsdC5UcmFuc2ZlcjsKCiAgLy8gc3JjL2RhdGEtZmV0Y2hlci9iYW0vYmFtLXdvcmtlci5qcz93b3JrZXImaW5saW5lP3dvcmtlcl9maWxlCiAgdmFyIGltcG9ydF9iYW0gPSBfX3RvTW9kdWxlKHJlcXVpcmVfZGlzdDQoKSk7CiAgdmFyIGltcG9ydF9scnVfY2FjaGUgPSBfX3RvTW9kdWxlKHJlcXVpcmVfbHJ1X2NhY2hlKCkpOwogIHZhciBjaWdhclR5cGVUb1RleHQgPSAodHlwZSkgPT4gewogICAgaWYgKHR5cGUgPT09ICJEIikgewogICAgICByZXR1cm4gIkRlbGV0aW9uIjsKICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gIlMiKSB7CiAgICAgIHJldHVybiAiU29mdCBjbGlwcGluZyI7CiAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICJIIikgewogICAgICByZXR1cm4gIkhhcmQgY2xpcHBpbmciOwogICAgfSBlbHNlIGlmICh0eXBlID09PSAiSSIpIHsKICAgICAgcmV0dXJuICJJbnNlcnRpb24iOwogICAgfSBlbHNlIGlmICh0eXBlID09PSAiTiIpIHsKICAgICAgcmV0dXJuICJTa2lwcGVkIHJlZ2lvbiI7CiAgICB9CiAgICByZXR1cm4gdHlwZTsKICB9OwogIHZhciBwYXJzZU1EID0gKG1kU3RyaW5nLCB1c2VDb3VudHMpID0+IHsKICAgIGxldCBjdXJyUG9zID0gMDsKICAgIGxldCBjdXJyTnVtID0gMDsKICAgIGxldCBkZWxldGlvbkVuY291bnRlcmVkID0gZmFsc2U7CiAgICBsZXQgYmFtU2VxU2hpZnQgPSAwOwogICAgY29uc3Qgc3Vic3RpdHV0aW9ucyA9IFtdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtZFN0cmluZy5sZW5ndGg7IGkrKykgewogICAgICBpZiAobWRTdHJpbmdbaV0ubWF0Y2goL1swLTldL2cpKSB7CiAgICAgICAgY3Vyck51bSA9IGN1cnJOdW0gKiAxMCArICttZFN0cmluZ1tpXTsKICAgICAgICBkZWxldGlvbkVuY291bnRlcmVkID0gZmFsc2U7CiAgICAgIH0gZWxzZSBpZiAobWRTdHJpbmdbaV0gPT09ICJeIikgewogICAgICAgIGRlbGV0aW9uRW5jb3VudGVyZWQgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIGN1cnJQb3MgKz0gY3Vyck51bTsKICAgICAgICBpZiAodXNlQ291bnRzKSB7CiAgICAgICAgICBzdWJzdGl0dXRpb25zLnB1c2goewogICAgICAgICAgICBsZW5ndGg6IGN1cnJOdW0sCiAgICAgICAgICAgIHR5cGU6IG1kU3RyaW5nW2ldCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKGRlbGV0aW9uRW5jb3VudGVyZWQpIHsKICAgICAgICAgIGJhbVNlcVNoaWZ0IC09IDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN1YnN0aXR1dGlvbnMucHVzaCh7CiAgICAgICAgICAgIHBvczogY3VyclBvcywKICAgICAgICAgICAgYmFzZTogbWRTdHJpbmdbaV0sCiAgICAgICAgICAgIGxlbmd0aDogMSwKICAgICAgICAgICAgYmFtU2VxU2hpZnQKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBjdXJyTnVtID0gMDsKICAgICAgICBjdXJyUG9zICs9IDE7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzdWJzdGl0dXRpb25zOwogIH07CiAgdmFyIGdldFN1YnN0aXR1dGlvbnMgPSAoc2VnbWVudCwgc2VxKSA9PiB7CiAgICBsZXQgc3Vic3RpdHV0aW9ucyA9IFtdOwogICAgbGV0IHNvZnRDbGlwcGluZ0F0UmVhZFN0YXJ0ID0gbnVsbDsKICAgIGlmIChzZWdtZW50LmNpZ2FyKSB7CiAgICAgIGNvbnN0IGNpZ2FyU3VicyA9IHBhcnNlTUQoc2VnbWVudC5jaWdhciwgdHJ1ZSk7CiAgICAgIGxldCBjdXJyUG9zID0gMDsKICAgICAgZm9yIChjb25zdCBzdWIgb2YgY2lnYXJTdWJzKSB7CiAgICAgICAgaWYgKHN1Yi50eXBlID09PSAiWCIpIHsKICAgICAgICAgIHN1YnN0aXR1dGlvbnMucHVzaCh7CiAgICAgICAgICAgIHBvczogY3VyclBvcywKICAgICAgICAgICAgbGVuZ3RoOiBzdWIubGVuZ3RoLAogICAgICAgICAgICB0eXBlOiAiWCIKICAgICAgICAgIH0pOwogICAgICAgICAgY3VyclBvcyArPSBzdWIubGVuZ3RoOwogICAgICAgIH0gZWxzZSBpZiAoc3ViLnR5cGUgPT09ICJJIikgewogICAgICAgICAgc3Vic3RpdHV0aW9ucy5wdXNoKHsKICAgICAgICAgICAgcG9zOiBjdXJyUG9zLAogICAgICAgICAgICBsZW5ndGg6IHN1Yi5sZW5ndGgsCiAgICAgICAgICAgIHR5cGU6ICJJIgogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChzdWIudHlwZSA9PT0gIkQiKSB7CiAgICAgICAgICBzdWJzdGl0dXRpb25zLnB1c2goewogICAgICAgICAgICBwb3M6IGN1cnJQb3MsCiAgICAgICAgICAgIGxlbmd0aDogc3ViLmxlbmd0aCwKICAgICAgICAgICAgdHlwZTogIkQiCiAgICAgICAgICB9KTsKICAgICAgICAgIGN1cnJQb3MgKz0gc3ViLmxlbmd0aDsKICAgICAgICB9IGVsc2UgaWYgKHN1Yi50eXBlID09PSAiTiIpIHsKICAgICAgICAgIHN1YnN0aXR1dGlvbnMucHVzaCh7CiAgICAgICAgICAgIHBvczogY3VyclBvcywKICAgICAgICAgICAgbGVuZ3RoOiBzdWIubGVuZ3RoLAogICAgICAgICAgICB0eXBlOiAiTiIKICAgICAgICAgIH0pOwogICAgICAgICAgY3VyclBvcyArPSBzdWIubGVuZ3RoOwogICAgICAgIH0gZWxzZSBpZiAoc3ViLnR5cGUgPT09ICI9IiB8fCBzdWIudHlwZSA9PT0gIk0iKSB7CiAgICAgICAgICBjdXJyUG9zICs9IHN1Yi5sZW5ndGg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgZmlyc3RTdWIgPSBjaWdhclN1YnNbMF07CiAgICAgIGNvbnN0IGxhc3RTdWIgPSBjaWdhclN1YnNbY2lnYXJTdWJzLmxlbmd0aCAtIDFdOwogICAgICBpZiAoZmlyc3RTdWIudHlwZSA9PT0gIlMiKSB7CiAgICAgICAgc29mdENsaXBwaW5nQXRSZWFkU3RhcnQgPSBmaXJzdFN1YjsKICAgICAgICBzdWJzdGl0dXRpb25zLnB1c2goewogICAgICAgICAgcG9zOiAtZmlyc3RTdWIubGVuZ3RoLAogICAgICAgICAgdHlwZTogIlMiLAogICAgICAgICAgbGVuZ3RoOiBmaXJzdFN1Yi5sZW5ndGgKICAgICAgICB9KTsKICAgICAgfQogICAgICBpZiAobGFzdFN1Yi50eXBlID09PSAiUyIpIHsKICAgICAgICBzdWJzdGl0dXRpb25zLnB1c2goewogICAgICAgICAgcG9zOiBzZWdtZW50LmVuZCAtIHNlZ21lbnQuc3RhcnQsCiAgICAgICAgICBsZW5ndGg6IGxhc3RTdWIubGVuZ3RoLAogICAgICAgICAgdHlwZTogIlMiCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgaWYgKGZpcnN0U3ViLnR5cGUgPT09ICJIIikgewogICAgICAgIHN1YnN0aXR1dGlvbnMucHVzaCh7CiAgICAgICAgICBwb3M6IC1maXJzdFN1Yi5sZW5ndGgsCiAgICAgICAgICB0eXBlOiAiSCIsCiAgICAgICAgICBsZW5ndGg6IGZpcnN0U3ViLmxlbmd0aAogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmIChsYXN0U3ViLnR5cGUgPT09ICJIIikgewogICAgICAgIHN1YnN0aXR1dGlvbnMucHVzaCh7CiAgICAgICAgICBwb3M6IHNlZ21lbnQuZW5kIC0gc2VnbWVudC5zdGFydCwKICAgICAgICAgIGxlbmd0aDogbGFzdFN1Yi5sZW5ndGgsCiAgICAgICAgICB0eXBlOiAiSCIKICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgaWYgKHNlZ21lbnQubWQpIHsKICAgICAgY29uc3QgbWRTdWJzdGl0dXRpb25zID0gcGFyc2VNRChzZWdtZW50Lm1kLCBmYWxzZSk7CiAgICAgIG1kU3Vic3RpdHV0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKHN1YnN0aXR1dGlvbikgewogICAgICAgIGxldCBwb3NTdGFydCA9IHN1YnN0aXR1dGlvblsicG9zIl0gKyBzdWJzdGl0dXRpb25bImJhbVNlcVNoaWZ0Il07CiAgICAgICAgbGV0IHBvc0VuZCA9IHBvc1N0YXJ0ICsgc3Vic3RpdHV0aW9uWyJsZW5ndGgiXTsKICAgICAgICBpZiAoc29mdENsaXBwaW5nQXRSZWFkU3RhcnQgIT09IG51bGwpIHsKICAgICAgICAgIHBvc1N0YXJ0ICs9IHNvZnRDbGlwcGluZ0F0UmVhZFN0YXJ0Lmxlbmd0aDsKICAgICAgICAgIHBvc0VuZCArPSBzb2Z0Q2xpcHBpbmdBdFJlYWRTdGFydC5sZW5ndGg7CiAgICAgICAgfQogICAgICAgIHN1YnN0aXR1dGlvblsidmFyaWFudCJdID0gc2VxLnN1YnN0cmluZyhwb3NTdGFydCwgcG9zRW5kKTsKICAgICAgICBkZWxldGUgc3Vic3RpdHV0aW9uWyJiYW1TZXFTaGlmdCJdOwogICAgICB9KTsKICAgICAgc3Vic3RpdHV0aW9ucyA9IG1kU3Vic3RpdHV0aW9ucy5jb25jYXQoc3Vic3RpdHV0aW9ucyk7CiAgICB9CiAgICByZXR1cm4gc3Vic3RpdHV0aW9uczsKICB9OwogIHZhciBjaHJvbUluZm9CaXNlY3RvciA9IGJpc2VjdG9yX2RlZmF1bHQoKGQpID0+IGQucG9zKS5sZWZ0OwogIHZhciBjaHJUb0FicyA9IChjaHJvbSwgY2hyb21Qb3MsIGNocm9tSW5mbykgPT4gY2hyb21JbmZvLmNoclBvc2l0aW9uc1tjaHJvbV0ucG9zICsgY2hyb21Qb3M7CiAgdmFyIGFic1RvQ2hyID0gKGFic1Bvc2l0aW9uLCBjaHJvbUluZm8pID0+IHsKICAgIGlmICghY2hyb21JbmZvIHx8ICFjaHJvbUluZm8uY3VtUG9zaXRpb25zIHx8ICFjaHJvbUluZm8uY3VtUG9zaXRpb25zLmxlbmd0aCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGxldCBpbnNlcnRQb2ludCA9IGNocm9tSW5mb0Jpc2VjdG9yKGNocm9tSW5mby5jdW1Qb3NpdGlvbnMsIGFic1Bvc2l0aW9uKTsKICAgIGNvbnN0IGxhc3RDaHIgPSBjaHJvbUluZm8uY3VtUG9zaXRpb25zW2Nocm9tSW5mby5jdW1Qb3NpdGlvbnMubGVuZ3RoIC0gMV0uY2hyOwogICAgY29uc3QgbGFzdExlbmd0aCA9IGNocm9tSW5mby5jaHJvbUxlbmd0aHNbbGFzdENocl07CiAgICBpbnNlcnRQb2ludCAtPSBpbnNlcnRQb2ludCA+IDAgJiYgMTsKICAgIGxldCBjaHJQb3NpdGlvbiA9IE1hdGguZmxvb3IoYWJzUG9zaXRpb24gLSBjaHJvbUluZm8uY3VtUG9zaXRpb25zW2luc2VydFBvaW50XS5wb3MpOwogICAgbGV0IG9mZnNldCA9IDA7CiAgICBpZiAoY2hyUG9zaXRpb24gPCAwKSB7CiAgICAgIG9mZnNldCA9IGNoclBvc2l0aW9uIC0gMTsKICAgICAgY2hyUG9zaXRpb24gPSAxOwogICAgfQogICAgaWYgKGluc2VydFBvaW50ID09PSBjaHJvbUluZm8uY3VtUG9zaXRpb25zLmxlbmd0aCAtIDEgJiYgY2hyUG9zaXRpb24gPiBsYXN0TGVuZ3RoKSB7CiAgICAgIG9mZnNldCA9IGNoclBvc2l0aW9uIC0gbGFzdExlbmd0aDsKICAgICAgY2hyUG9zaXRpb24gPSBsYXN0TGVuZ3RoOwogICAgfQogICAgcmV0dXJuIFtjaHJvbUluZm8uY3VtUG9zaXRpb25zW2luc2VydFBvaW50XS5jaHIsIGNoclBvc2l0aW9uLCBvZmZzZXQsIGluc2VydFBvaW50XTsKICB9OwogIGZ1bmN0aW9uIG5hdGNtcCh4Um93LCB5Um93KSB7CiAgICBjb25zdCB4ID0geFJvd1swXTsKICAgIGNvbnN0IHkgPSB5Um93WzBdOwogICAgaWYgKHguaW5kZXhPZigiXyIpID49IDApIHsKICAgICAgY29uc3QgeFBhcnRzMiA9IHguc3BsaXQoIl8iKTsKICAgICAgaWYgKHkuaW5kZXhPZigiXyIpID49IDApIHsKICAgICAgICBjb25zdCB5UGFydHMyID0geS5zcGxpdCgiXyIpOwogICAgICAgIHJldHVybiBuYXRjbXAoeFBhcnRzMlsxXSwgeVBhcnRzMlsxXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIDE7CiAgICB9CiAgICBpZiAoeS5pbmRleE9mKCJfIikgPj0gMCkgewogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICBjb25zdCB4UGFydHMgPSBbXTsKICAgIGNvbnN0IHlQYXJ0cyA9IFtdOwogICAgZm9yIChjb25zdCBwYXJ0IG9mIHgubWF0Y2goLyhcZCt8W15cZF0rKS9nKSkgewogICAgICB4UGFydHMucHVzaChOdW1iZXIuaXNOYU4ocGFydCkgPyBwYXJ0LnRvTG93ZXJDYXNlKCkgOiArcGFydCk7CiAgICB9CiAgICBmb3IgKGNvbnN0IHBhcnQgb2YgeS5tYXRjaCgvKFxkK3xbXlxkXSspL2cpKSB7CiAgICAgIHhQYXJ0cy5wdXNoKE51bWJlci5pc05hTihwYXJ0KSA/IHBhcnQudG9Mb3dlckNhc2UoKSA6ICtwYXJ0KTsKICAgIH0KICAgIGZvciAoY29uc3Qga2V5IG9mIFsibSIsICJ5IiwgIngiXSkgewogICAgICBpZiAoeS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGtleSkpCiAgICAgICAgcmV0dXJuIC0xOwogICAgICBpZiAoeC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGtleSkpCiAgICAgICAgcmV0dXJuIDE7CiAgICB9CiAgICBpZiAoeFBhcnRzIDwgeVBhcnRzKSB7CiAgICAgIHJldHVybiAtMTsKICAgIH0gZWxzZSBpZiAoeVBhcnRzID4geFBhcnRzKSB7CiAgICAgIHJldHVybiAxOwogICAgfQogICAgcmV0dXJuIDA7CiAgfQogIGZ1bmN0aW9uIHBhcnNlQ2hyb21zaXplc1Jvd3MoZGF0YSkgewogICAgY29uc3QgY3VtVmFsdWVzID0gW107CiAgICBjb25zdCBjaHJvbUxlbmd0aHMgPSB7fTsKICAgIGNvbnN0IGNoclBvc2l0aW9ucyA9IHt9OwogICAgbGV0IHRvdGFsTGVuZ3RoID0gMDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCBsZW5ndGggPSBOdW1iZXIoZGF0YVtpXVsxXSk7CiAgICAgIHRvdGFsTGVuZ3RoICs9IGxlbmd0aDsKICAgICAgY29uc3QgbmV3VmFsdWUgPSB7CiAgICAgICAgaWQ6IGksCiAgICAgICAgY2hyOiBkYXRhW2ldWzBdLAogICAgICAgIHBvczogdG90YWxMZW5ndGggLSBsZW5ndGgKICAgICAgfTsKICAgICAgY3VtVmFsdWVzLnB1c2gobmV3VmFsdWUpOwogICAgICBjaHJQb3NpdGlvbnNbbmV3VmFsdWUuY2hyXSA9IG5ld1ZhbHVlOwogICAgICBjaHJvbUxlbmd0aHNbZGF0YVtpXVswXV0gPSBsZW5ndGg7CiAgICB9CiAgICByZXR1cm4gewogICAgICBjdW1Qb3NpdGlvbnM6IGN1bVZhbHVlcywKICAgICAgY2hyUG9zaXRpb25zLAogICAgICB0b3RhbExlbmd0aCwKICAgICAgY2hyb21MZW5ndGhzCiAgICB9OwogIH0KICBmdW5jdGlvbiBDaHJvbW9zb21lSW5mbyhmaWxlcGF0aCwgc3VjY2VzcykgewogICAgY29uc3QgcmV0ID0ge307CiAgICByZXQuYWJzVG9DaHIgPSAoYWJzUG9zKSA9PiByZXQuY2hyUG9zaXRpb25zID8gYWJzVG9DaHIoYWJzUG9zLCByZXQpIDogbnVsbDsKICAgIHJldC5jaHJUb0FicyA9IChbY2hyTmFtZSwgY2hyUG9zXSA9IFtdKSA9PiByZXQuY2hyUG9zaXRpb25zID8gY2hyVG9BYnMoY2hyTmFtZSwgY2hyUG9zLCByZXQpIDogbnVsbDsKICAgIHJldHVybiB0ZXh0X2RlZmF1bHQoZmlsZXBhdGgsIChlcnJvciwgY2hySW5mb1RleHQpID0+IHsKICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgaWYgKHN1Y2Nlc3MpCiAgICAgICAgICBzdWNjZXNzKG51bGwpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGRhdGEgPSB0c3ZQYXJzZVJvd3MyKGNockluZm9UZXh0KTsKICAgICAgICBjb25zdCBjaHJvbUluZm8gPSBwYXJzZUNocm9tc2l6ZXNSb3dzKGRhdGEpOwogICAgICAgIE9iamVjdC5rZXlzKGNocm9tSW5mbykuZm9yRWFjaCgoa2V5KSA9PiB7CiAgICAgICAgICByZXRba2V5XSA9IGNocm9tSW5mb1trZXldOwogICAgICAgIH0pOwogICAgICAgIGlmIChzdWNjZXNzKQogICAgICAgICAgc3VjY2VzcyhyZXQpOwogICAgICB9CiAgICB9KTsKICB9CiAgdmFyIGJhbVJlY29yZFRvSnNvbiA9IChiYW1SZWNvcmQsIGNock5hbWUsIGNock9mZnNldCkgPT4gewogICAgY29uc3Qgc2VxID0gYmFtUmVjb3JkLmdldCgic2VxIik7CiAgICBjb25zdCBzZWdtZW50ID0gewogICAgICBpZDogYmFtUmVjb3JkLl9pZCwKICAgICAgbmFtZTogYmFtUmVjb3JkLmdldCgibmFtZSIpLAogICAgICBzdGFydDogK2JhbVJlY29yZC5kYXRhLnN0YXJ0ICsgMSArIGNock9mZnNldCwKICAgICAgZW5kOiArYmFtUmVjb3JkLmRhdGEuZW5kICsgMSArIGNock9mZnNldCwKICAgICAgbWQ6IGJhbVJlY29yZC5nZXQoIk1EIiksCiAgICAgIGNock5hbWUsCiAgICAgIGNock9mZnNldCwKICAgICAgY2lnYXI6IGJhbVJlY29yZC5nZXQoImNpZ2FyIiksCiAgICAgIG1hcHE6IGJhbVJlY29yZC5nZXQoIm1xIiksCiAgICAgIHN0cmFuZDogYmFtUmVjb3JkLmdldCgic3RyYW5kIikgPT09IDEgPyAiKyIgOiAiLSIsCiAgICAgIHN1YnN0aXR1dGlvbnM6IFtdCiAgICB9OwogICAgc2VnbWVudC5zdWJzdGl0dXRpb25zID0gZ2V0U3Vic3RpdHV0aW9ucyhzZWdtZW50LCBzZXEpOwogICAgcmV0dXJuIHNlZ21lbnQ7CiAgfTsKICB2YXIgYmFtRmlsZXMgPSB7fTsKICB2YXIgYmFtSGVhZGVycyA9IHt9OwogIHZhciBNQVhfVElMRVMgPSAyMDsKICB2YXIgY2hyb21TaXplcyA9IHt9OwogIHZhciBjaHJvbUluZm9zID0ge307CiAgdmFyIHRpbGVWYWx1ZXMgPSBuZXcgaW1wb3J0X2xydV9jYWNoZS5kZWZhdWx0KHsgbWF4OiBNQVhfVElMRVMgfSk7CiAgdmFyIHRpbGVzZXRJbmZvcyA9IHt9OwogIHZhciBkYXRhQ29uZnMgPSB7fTsKICB2YXIgaW5pdCA9ICh1aWQsIHsgYmFtVXJsLCBiYWlVcmwsIGNocm9tU2l6ZXNVcmwsIGxvYWRNYXRlcyA9IGZhbHNlLCBtYXhJbnNlcnRTaXplID0gNWUzLCBleHRyYWN0SnVuY3Rpb24gPSBmYWxzZSwganVuY3Rpb25NaW5Db3ZlcmFnZSA9IDEgfSkgPT4gewogICAgaWYgKCFiYW1GaWxlc1tiYW1VcmxdKSB7CiAgICAgIGJhbUZpbGVzW2JhbVVybF0gPSBuZXcgaW1wb3J0X2JhbS5CYW1GaWxlKHsKICAgICAgICBiYW1VcmwsCiAgICAgICAgYmFpVXJsCiAgICAgIH0pOwogICAgICBiYW1IZWFkZXJzW2JhbVVybF0gPSBiYW1GaWxlc1tiYW1VcmxdLmdldEhlYWRlcigpOwogICAgfQogICAgY2hyb21TaXplc1tjaHJvbVNpemVzVXJsXSA9IGNocm9tU2l6ZXNbY2hyb21TaXplc1VybF0gfHwgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgQ2hyb21vc29tZUluZm8oY2hyb21TaXplc1VybCwgcmVzb2x2ZSk7CiAgICB9KTsKICAgIGRhdGFDb25mc1t1aWRdID0geyBiYW1VcmwsIGNocm9tU2l6ZXNVcmwsIGxvYWRNYXRlcywgbWF4SW5zZXJ0U2l6ZSwgZXh0cmFjdEp1bmN0aW9uLCBqdW5jdGlvbk1pbkNvdmVyYWdlIH07CiAgfTsKICB2YXIgdGlsZXNldEluZm8gPSAodWlkKSA9PiB7CiAgICBjb25zdCB7IGNocm9tU2l6ZXNVcmwsIGJhbVVybCB9ID0gZGF0YUNvbmZzW3VpZF07CiAgICBjb25zdCBwcm9taXNlcyA9IGNocm9tU2l6ZXNVcmwgPyBbYmFtSGVhZGVyc1tiYW1VcmxdLCBjaHJvbVNpemVzW2Nocm9tU2l6ZXNVcmxdXSA6IFtiYW1IZWFkZXJzW2JhbVVybF1dOwogICAgcmV0dXJuIFByb21pc2UuYWxsKHByb21pc2VzKS50aGVuKCh2YWx1ZXMpID0+IHsKICAgICAgY29uc3QgVElMRV9TSVpFID0gMTAyNDsKICAgICAgbGV0IGNocm9tSW5mbyA9IG51bGw7CiAgICAgIGlmICh2YWx1ZXMubGVuZ3RoID4gMSkgewogICAgICAgIGNocm9tSW5mbyA9IHZhbHVlc1sxXTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBjaHJvbXMgPSBbXTsKICAgICAgICBmb3IgKGNvbnN0IHsgcmVmTmFtZTogY2hyTmFtZSwgbGVuZ3RoIH0gb2YgYmFtRmlsZXNbYmFtVXJsXS5pbmRleFRvQ2hyKSB7CiAgICAgICAgICBjaHJvbXMucHVzaChbY2hyTmFtZSwgbGVuZ3RoXSk7CiAgICAgICAgfQogICAgICAgIGNocm9tcy5zb3J0KG5hdGNtcCk7CiAgICAgICAgY2hyb21JbmZvID0gcGFyc2VDaHJvbXNpemVzUm93cyhjaHJvbXMpOwogICAgICB9CiAgICAgIGNocm9tSW5mb3NbY2hyb21TaXplc1VybF0gPSBjaHJvbUluZm87CiAgICAgIHRpbGVzZXRJbmZvc1t1aWRdID0gewogICAgICAgIHRpbGVfc2l6ZTogVElMRV9TSVpFLAogICAgICAgIGJpbnNfcGVyX2RpbWVuc2lvbjogVElMRV9TSVpFLAogICAgICAgIG1heF96b29tOiBNYXRoLmNlaWwoTWF0aC5sb2coY2hyb21JbmZvLnRvdGFsTGVuZ3RoIC8gVElMRV9TSVpFKSAvIE1hdGgubG9nKDIpKSwKICAgICAgICBtYXhfd2lkdGg6IGNocm9tSW5mby50b3RhbExlbmd0aCwKICAgICAgICBtaW5fcG9zOiBbMF0sCiAgICAgICAgbWF4X3BvczogW2Nocm9tSW5mby50b3RhbExlbmd0aF0KICAgICAgfTsKICAgICAgcmV0dXJuIHRpbGVzZXRJbmZvc1t1aWRdOwogICAgfSk7CiAgfTsKICB2YXIgdGlsZSA9ICh1aWQsIHosIHgpID0+IF9fYXN5bmModm9pZCAwLCBudWxsLCBmdW5jdGlvbiogKCkgewogICAgY29uc3QgTUFYX1RJTEVfV0lEVEggPSAyZTU7CiAgICBjb25zdCB7IGJhbVVybCwgY2hyb21TaXplc1VybCwgbG9hZE1hdGVzLCBtYXhJbnNlcnRTaXplIH0gPSBkYXRhQ29uZnNbdWlkXTsKICAgIGNvbnN0IGJhbUZpbGUgPSBiYW1GaWxlc1tiYW1VcmxdOwogICAgcmV0dXJuIHRpbGVzZXRJbmZvKHVpZCkudGhlbigodGlsZXNldEluZm8yKSA9PiB7CiAgICAgIGNvbnN0IHRpbGVXaWR0aCA9ICt0aWxlc2V0SW5mbzIubWF4X3dpZHRoIC8gX19wb3coMiwgK3opOwogICAgICBjb25zdCByZWNvcmRQcm9taXNlcyA9IFtdOwogICAgICBpZiAodGlsZVdpZHRoID4gTUFYX1RJTEVfV0lEVEgpIHsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHJlc29sdmUoW10pKTsKICAgICAgfQogICAgICBsZXQgbWluWCA9IHRpbGVzZXRJbmZvMi5taW5fcG9zWzBdICsgeCAqIHRpbGVXaWR0aDsKICAgICAgY29uc3QgbWF4WCA9IHRpbGVzZXRJbmZvMi5taW5fcG9zWzBdICsgKHggKyAxKSAqIHRpbGVXaWR0aDsKICAgICAgY29uc3QgY2hyb21JbmZvID0gY2hyb21JbmZvc1tjaHJvbVNpemVzVXJsXTsKICAgICAgY29uc3QgeyBjaHJvbUxlbmd0aHMsIGN1bVBvc2l0aW9ucyB9ID0gY2hyb21JbmZvOwogICAgICBjb25zdCBvcHQgPSB7CiAgICAgICAgdmlld0FzUGFpcnM6IGxvYWRNYXRlcwogICAgICB9OwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGN1bVBvc2l0aW9ucy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGNocm9tTmFtZSA9IGN1bVBvc2l0aW9uc1tpXS5jaHI7CiAgICAgICAgY29uc3QgY2hyb21TdGFydCA9IGN1bVBvc2l0aW9uc1tpXS5wb3M7CiAgICAgICAgY29uc3QgY2hyb21FbmQgPSBjdW1Qb3NpdGlvbnNbaV0ucG9zICsgY2hyb21MZW5ndGhzW2Nocm9tTmFtZV07CiAgICAgICAgdGlsZVZhbHVlcy5zZXQoYCR7dWlkfS4ke3p9LiR7eH1gLCBbXSk7CiAgICAgICAgaWYgKGNocm9tU3RhcnQgPD0gbWluWCAmJiBtaW5YIDwgY2hyb21FbmQpIHsKICAgICAgICAgIGlmIChtYXhYID4gY2hyb21FbmQpIHsKICAgICAgICAgICAgcmVjb3JkUHJvbWlzZXMucHVzaChiYW1GaWxlLmdldFJlY29yZHNGb3JSYW5nZShjaHJvbU5hbWUsIG1pblggLSBjaHJvbVN0YXJ0LCBjaHJvbUVuZCAtIGNocm9tU3RhcnQsIG9wdCkudGhlbigocmVjb3JkcykgPT4gewogICAgICAgICAgICAgIGNvbnN0IG1hcHBlZFJlY29yZHMgPSByZWNvcmRzLm1hcCgocmVjKSA9PiBiYW1SZWNvcmRUb0pzb24ocmVjLCBjaHJvbU5hbWUsIGN1bVBvc2l0aW9uc1tpXS5wb3MpKTsKICAgICAgICAgICAgICB0aWxlVmFsdWVzLnNldChgJHt1aWR9LiR7en0uJHt4fWAsIHRpbGVWYWx1ZXMuZ2V0KGAke3VpZH0uJHt6fS4ke3h9YCkuY29uY2F0KG1hcHBlZFJlY29yZHMpKTsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICBtaW5YID0gY2hyb21FbmQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBzdGFydFBvcyA9IE1hdGguZmxvb3IobWluWCAtIGNocm9tU3RhcnQpOwogICAgICAgICAgICBjb25zdCBlbmRQb3MgPSBNYXRoLmNlaWwobWF4WCAtIGNocm9tU3RhcnQpOwogICAgICAgICAgICByZWNvcmRQcm9taXNlcy5wdXNoKGJhbUZpbGUuZ2V0UmVjb3Jkc0ZvclJhbmdlKGNocm9tTmFtZSwgc3RhcnRQb3MsIGVuZFBvcywgb3B0KS50aGVuKChyZWNvcmRzKSA9PiB7CiAgICAgICAgICAgICAgY29uc3QgbWFwcGVkUmVjb3JkcyA9IHJlY29yZHMubWFwKChyZWMpID0+IGJhbVJlY29yZFRvSnNvbihyZWMsIGNocm9tTmFtZSwgY3VtUG9zaXRpb25zW2ldLnBvcykpOwogICAgICAgICAgICAgIHRpbGVWYWx1ZXMuc2V0KGAke3VpZH0uJHt6fS4ke3h9YCwgdGlsZVZhbHVlcy5nZXQoYCR7dWlkfS4ke3p9LiR7eH1gKS5jb25jYXQobWFwcGVkUmVjb3JkcykpOwogICAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIFByb21pc2UuYWxsKHJlY29yZFByb21pc2VzKS50aGVuKCh2YWx1ZXMpID0+IHsKICAgICAgICByZXR1cm4gdmFsdWVzLmZsYXQoKTsKICAgICAgfSk7CiAgICB9KTsKICB9KTsKICB2YXIgZmV0Y2hUaWxlc0RlYm91bmNlZCA9ICh1aWQsIHRpbGVJZHMpID0+IF9fYXN5bmModm9pZCAwLCBudWxsLCBmdW5jdGlvbiogKCkgewogICAgY29uc3QgdGlsZXMgPSB7fTsKICAgIGNvbnN0IHZhbGlkVGlsZUlkcyA9IFtdOwogICAgY29uc3QgdGlsZVByb21pc2VzID0gW107CiAgICBmb3IgKGNvbnN0IHRpbGVJZCBvZiB0aWxlSWRzKSB7CiAgICAgIGNvbnN0IHBhcnRzID0gdGlsZUlkLnNwbGl0KCIuIik7CiAgICAgIGNvbnN0IHogPSBwYXJzZUludChwYXJ0c1swXSwgMTApOwogICAgICBjb25zdCB4ID0gcGFyc2VJbnQocGFydHNbMV0sIDEwKTsKICAgICAgaWYgKE51bWJlci5pc05hTih4KSB8fCBOdW1iZXIuaXNOYU4oeikpIHsKICAgICAgICBjb25zb2xlLndhcm4oIkludmFsaWQgdGlsZSB6b29tIG9yIHBvc2l0aW9uOiIsIHosIHgpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHZhbGlkVGlsZUlkcy5wdXNoKHRpbGVJZCk7CiAgICAgIHRpbGVQcm9taXNlcy5wdXNoKHRpbGUodWlkLCB6LCB4KSk7CiAgICB9CiAgICByZXR1cm4gUHJvbWlzZS5hbGwodGlsZVByb21pc2VzKS50aGVuKCh2YWx1ZXMpID0+IHsKICAgICAgdmFsdWVzLmZvckVhY2goKGQsIGkpID0+IHsKICAgICAgICBjb25zdCB2YWxpZFRpbGVJZCA9IHZhbGlkVGlsZUlkc1tpXTsKICAgICAgICB0aWxlc1t2YWxpZFRpbGVJZF0gPSBkOwogICAgICAgIHRpbGVzW3ZhbGlkVGlsZUlkXS50aWxlUG9zaXRpb25JZCA9IHZhbGlkVGlsZUlkOwogICAgICB9KTsKICAgICAgcmV0dXJuIHRpbGVzOwogICAgfSk7CiAgfSk7CiAgdmFyIGdldFRhYnVsYXJEYXRhID0gKHVpZCwgdGlsZUlkcykgPT4gewogICAgY29uc3QgeyBsb2FkTWF0ZXMsIGV4dHJhY3RKdW5jdGlvbiB9ID0gZGF0YUNvbmZzW3VpZF07CiAgICBjb25zdCBhbGxTZWdtZW50cyA9IHt9OwogICAgZm9yIChjb25zdCB0aWxlSWQgb2YgdGlsZUlkcykgewogICAgICBjb25zdCB0aWxlVmFsdWUgPSB0aWxlVmFsdWVzLmdldChgJHt1aWR9LiR7dGlsZUlkfWApOwogICAgICBpZiAodGlsZVZhbHVlLmVycm9yKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKHRpbGVWYWx1ZS5lcnJvcik7CiAgICAgIH0KICAgICAgZm9yIChjb25zdCBzZWdtZW50IG9mIHRpbGVWYWx1ZSkgewogICAgICAgIGFsbFNlZ21lbnRzW3NlZ21lbnQuaWRdID0gX19zcHJlYWRQcm9wcyhfX3NwcmVhZFZhbHVlcyh7fSwgc2VnbWVudCksIHsKICAgICAgICAgIHN1YnN0aXR1dGlvbnM6IEpTT04uc3RyaW5naWZ5KHNlZ21lbnQuc3Vic3RpdHV0aW9ucykKICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgbGV0IG91dHB1dCA9IE9iamVjdC52YWx1ZXMoYWxsU2VnbWVudHMpOwogICAgaWYgKGxvYWRNYXRlcykgewogICAgICBmaW5kTWF0ZXModWlkLCBvdXRwdXQpOwogICAgfQogICAgaWYgKGV4dHJhY3RKdW5jdGlvbikgewogICAgICBvdXRwdXQgPSBmaW5kSnVuY3Rpb25zKHVpZCwgb3V0cHV0KTsKICAgIH0KICAgIGNvbnN0IGJ1ZmZlciA9IGltcG9ydF9idWZmZXIuQnVmZmVyLmZyb20oSlNPTi5zdHJpbmdpZnkob3V0cHV0KSkuYnVmZmVyOwogICAgcmV0dXJuIFRyYW5zZmVyKGJ1ZmZlciwgW2J1ZmZlcl0pOwogIH07CiAgdmFyIGdyb3VwQnkgPSAoeHMsIGtleSkgPT4geHMucmVkdWNlKChydiwgeCkgPT4gewogICAgKHJ2W3hba2V5XV0gPSBydlt4W2tleV1dIHx8IFtdKS5wdXNoKHgpOwogICAgcmV0dXJuIHJ2OwogIH0sIHt9KTsKICB2YXIgZmluZE1hdGVzID0gKHVpZCwgc2VnbWVudHMpID0+IHsKICAgIGNvbnN0IHsgbWF4SW5zZXJ0U2l6ZSB9ID0gZGF0YUNvbmZzW3VpZF07CiAgICBjb25zdCBzZWdtZW50c0J5UmVhZE5hbWUgPSBncm91cEJ5KHNlZ21lbnRzLCAibmFtZSIpOwogICAgT2JqZWN0LmVudHJpZXMoc2VnbWVudHNCeVJlYWROYW1lKS5mb3JFYWNoKChbbmFtZSwgc2VnbWVudEdyb3VwXSkgPT4gewogICAgICBpZiAoc2VnbWVudEdyb3VwLmxlbmd0aCA9PT0gMikgewogICAgICAgIGNvbnN0IHJlYWQgPSBzZWdtZW50R3JvdXBbMF07CiAgICAgICAgY29uc3QgbWF0ZSA9IHNlZ21lbnRHcm91cFsxXTsKICAgICAgICByZWFkLm1hdGVJZHMgPSBbbWF0ZS5pZF07CiAgICAgICAgbWF0ZS5tYXRlSWRzID0gW3JlYWQuaWRdOwogICAgICAgIGNvbnN0IFtsLCByXSA9IFtyZWFkLCBtYXRlXS5zb3J0KChhLCBiKSA9PiArYS5zdGFydCAtICtiLnN0YXJ0KTsKICAgICAgICBjb25zdCBpbnNlcnRTaXplID0gTWF0aC5tYXgoMCwgK3Iuc3RhcnQgLSArbC5lbmQpOwogICAgICAgIGNvbnN0IGxhcmdlSW5zZXJ0U2l6ZSA9IGluc2VydFNpemUgPj0gbWF4SW5zZXJ0U2l6ZTsKICAgICAgICBsZXQgc3ZUeXBlOwogICAgICAgIGlmICghbGFyZ2VJbnNlcnRTaXplKSB7CiAgICAgICAgICBzdlR5cGUgPSAibm9ybWFsIHJlYWQiOwogICAgICAgIH0gZWxzZSBpZiAobC5zdHJhbmQgPT09ICIrIiAmJiByLnN0cmFuZCA9PT0gIi0iKSB7CiAgICAgICAgICBzdlR5cGUgPSAiZGVsZXRpb24gKCstKSI7CiAgICAgICAgfSBlbHNlIGlmIChsLnN0cmFuZCA9PT0gIisiICYmIHIuc3RyYW5kID09PSAiKyIpIHsKICAgICAgICAgIHN2VHlwZSA9ICJpbnZlcnNpb24gKCsrKSI7CiAgICAgICAgfSBlbHNlIGlmIChsLnN0cmFuZCA9PT0gIi0iICYmIHIuc3RyYW5kID09PSAiLSIpIHsKICAgICAgICAgIHN2VHlwZSA9ICJpbnZlcnNpb24gKC0tKSI7CiAgICAgICAgfSBlbHNlIGlmIChsLnN0cmFuZCA9PT0gIi0iICYmIHIuc3RyYW5kID09PSAiKyIpIHsKICAgICAgICAgIHN2VHlwZSA9ICJkdXBsaWNhdGlvbiAoLSspIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3ZUeXBlID0gYCgke2wuc3RyYW5kfSR7ci5zdHJhbmR9KWA7CiAgICAgICAgfQogICAgICAgIFtyZWFkLCBtYXRlXS5mb3JFYWNoKChkKSA9PiB7CiAgICAgICAgICBkLmZvdW5kTWF0ZSA9IHRydWU7CiAgICAgICAgICBkLmluc2VydFNpemUgPSBpbnNlcnRTaXplOwogICAgICAgICAgZC5sYXJnZUluc2VydFNpemUgPSBsYXJnZUluc2VydFNpemU7CiAgICAgICAgICBkLnN2VHlwZSA9IHN2VHlwZTsKICAgICAgICAgIGQubnVtTWF0ZXMgPSAyOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHNlZ21lbnRHcm91cC5mb3JFYWNoKChkKSA9PiB7CiAgICAgICAgICBkLm1hdGVJZHMgPSBzZWdtZW50R3JvdXAuZmlsdGVyKChtYXRlKSA9PiBtYXRlLmlkICE9PSBkLmlkKS5tYXAoKG1hdGUpID0+IG1hdGUuaWQpOwogICAgICAgICAgZC5mb3VuZE1hdGUgPSBmYWxzZTsKICAgICAgICAgIGQuaW5zZXJ0U2l6ZSA9IC0xOwogICAgICAgICAgZC5sYXJnSW5zZXJ0U2l6ZSA9IGZhbHNlOwogICAgICAgICAgZC5zdlR5cGUgPSBzZWdtZW50R3JvdXAubGVuZ3RoID09PSAxID8gIm1hdGVzIG5vdCBmb3VuZCB3aXRoaW4gY2hyb21vc29tZSIgOiAibW9yZSB0aGFuIHR3byBtYXRlcyI7CiAgICAgICAgICBkLm51bU1hdGVzID0gc2VnbWVudEdyb3VwLmxlbmd0aDsKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gc2VnbWVudHNCeVJlYWROYW1lOwogIH07CiAgdmFyIGZpbmRKdW5jdGlvbnMgPSAodWlkLCBzZWdtZW50cykgPT4gewogICAgY29uc3QgeyBqdW5jdGlvbk1pbkNvdmVyYWdlIH0gPSBkYXRhQ29uZnNbdWlkXTsKICAgIGNvbnN0IGp1bmN0aW9ucyA9IFtdOwogICAgc2VnbWVudHMuZm9yRWFjaCgoc2VnbWVudCkgPT4gewogICAgICBjb25zdCBzdWJzdGl0dXRpb25zID0gSlNPTi5wYXJzZShzZWdtZW50LnN1YnN0aXR1dGlvbnMpOwogICAgICBzdWJzdGl0dXRpb25zLmZvckVhY2goKHN1YikgPT4gewogICAgICAgIGNvbnN0IGRvbiA9IHNlZ21lbnQuc3RhcnQgKyBzdWIucG9zOwogICAgICAgIGNvbnN0IGFjYyA9IHNlZ21lbnQuc3RhcnQgKyBzdWIucG9zICsgc3ViLmxlbmd0aDsKICAgICAgICBpZiAoc2VnbWVudC5zdGFydCA8IGRvbiAmJiBhY2MgPCBzZWdtZW50LmVuZCkgewogICAgICAgICAgY29uc3QgaiA9IGp1bmN0aW9ucy5maW5kKChkKSA9PiBkLnN0YXJ0ID09PSBkb24gJiYgZC5lbmQgPT09IGFjYyk7CiAgICAgICAgICBpZiAoaikgewogICAgICAgICAgICBqLnNjb3JlICs9IDE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBqdW5jdGlvbnMucHVzaCh7IHN0YXJ0OiBkb24sIGVuZDogYWNjLCBzY29yZTogMSB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgICByZXR1cm4ganVuY3Rpb25zLmZpbHRlcigoZCkgPT4gZC5zY29yZSA+PSBqdW5jdGlvbk1pbkNvdmVyYWdlKTsKICB9OwogIHZhciB0aWxlRnVuY3Rpb25zID0gewogICAgaW5pdCwKICAgIHRpbGVzZXRJbmZvLAogICAgZmV0Y2hUaWxlc0RlYm91bmNlZCwKICAgIHRpbGUsCiAgICBnZXRUYWJ1bGFyRGF0YQogIH07CiAgZXhwb3NlKHRpbGVGdW5jdGlvbnMpOwp9KSgpOwovKiEKICogVGhlIGJ1ZmZlciBtb2R1bGUgZnJvbSBub2RlLmpzLCBmb3IgdGhlIGJyb3dzZXIuCiAqCiAqIEBhdXRob3IgICBGZXJvc3MgQWJvdWtoYWRpamVoIDxodHRwczovL2Zlcm9zcy5vcmc+CiAqIEBsaWNlbnNlICBNSVQKICovCi8qISBpZWVlNzU0LiBCU0QtMy1DbGF1c2UgTGljZW5zZS4gRmVyb3NzIEFib3VraGFkaWplaCA8aHR0cHM6Ly9mZXJvc3Mub3JnL29wZW5zb3VyY2U+ICovCg==",QI="undefined"!=typeof window&&window.Blob&&new Blob([atob(DI)],{type:"text/javascript;charset=utf-8"});function OI(){const g=QI&&(window.URL||window.webkitURL).createObjectURL(QI);try{return g?new Worker(g):new Worker("data:application/javascript;base64,"+DI,{type:"module"})}finally{g&&(window.URL||window.webkitURL).revokeObjectURL(g)}}function PI(g){var I;return"bam"===(null==(I=g.data)?void 0:I.type)}function jI(g,...I){if(!new.target)throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');const{tileProxy:C}=g.services,{showMousePosition:A}=g.utils;class l extends g.tracks.BarTrack{constructor(I){var C,l,i,c,d;const[m,o]=I;let b;if(PI(o.spec))try{b=D(new OI),m.dataFetcher=new TI(g,m.dataConfig,b)}catch(t){console.warn("Error loading worker",t)}super(m,o),this.worker=b,m.dataFetcher.track=this,this.context=m,"overlay"in this.options.spec?this.options.spec.overlay=this.options.spec.overlay.map((g=>e(Z({},g),{_renderingId:w()}))):this.options.spec._renderingId=w(),this.tileSize=null!=(l=null==(C=this.tilesetInfo)?void 0:C.tile_size)?l:1024,this.drawnAtScale=g.libraries.d3Scale.scaleLinear(),this.scalableGraphics={};const{valid:a,errorMessages:s}=KI(this.options.spec);a||console.warn("The specification of the following track is invalid",s,this.options.spec),this.extent={min:Number.MAX_SAFE_INTEGER,max:Number.MIN_SAFE_INTEGER},this.mouseOverGraphics=new g.libraries.PIXI.Graphics,this.pMain.addChild(this.mouseOverGraphics),this.pMask.interactive=!0,this.pMask.mousedown=g=>this.onMouseDown(g.data.getLocalPosition(this.pMain).x,g.data.getLocalPosition(this.pMain).y),this.pMask.mouseup=g=>this.onClick(g.data.getLocalPosition(this.pMain).x,g.data.getLocalPosition(this.pMain).y),this.pMask.mousemove=()=>this.onMouseOut(),this.flipText="vertical"===this.options.spec.orientation,this.hideMousePosition&&(this.hideMousePosition(),this.hideMousePosition=void 0),(null==(i=this.options)?void 0:i.showMousePosition)&&!this.hideMousePosition&&(this.hideMousePosition=A(this,Mg(qg(this.options.spec)[0]),this.isShowGlobalMousePosition())),this.loadingText=new g.libraries.PIXI.Text("",{fontSize:"18px",fontFamily:"Arial",fill:"gray",fontWeight:"bold"}),this.loadingText.anchor.x=.5,this.loadingText.anchor.y=.5,this.pLabel.addChild(this.loadingText),this.tooltips=[],this.svgData=[],this.textGraphics=[],this.textsBeingUsed=0,g.libraries.PIXI.GRAPHICS_CURVES.adaptive=null!=(d=null==(c=this.options.spec.style)?void 0:c.enableSmoothPath)&&d,g.libraries.PIXI.GRAPHICS_CURVES.adaptive&&(g.libraries.PIXI.GRAPHICS_CURVES.maxLength=1,g.libraries.PIXI.GRAPHICS_CURVES.maxSegments=20480)}draw(){var g;this.tooltips=[],this.svgData=[],this.textsBeingUsed=0,null==(g=this.mouseOverGraphics)||g.clear();const I=()=>{this.preprocessAllTiles(),super.draw(),this.prevVisibleAndFetchedTiles=this.visibleAndFetchedTiles(),this.drawLoading(!1)};PI(this.options.spec)&&!Q(this.visibleAndFetchedTiles(),this.prevVisibleAndFetchedTiles)?this.updateTileAsync(I):I()}initTile(g){this.drawTile(g)}updateTile(){}renderTile(){}drawTile(I){if(I.drawnAtScale=this._xScale.copy(),I.goslingModels){if(I.graphics.clear(),I.graphics.removeChildren(),I.goslingModels&&I.goslingModels[0]){const C=I.goslingModels[0],A=this.dimensions[1],l=this._xScale.invert(A)-this._xScale.invert(0);if(!C.trackVisibility({zoomLevel:l}))return;Fg(g,this,I,C,this.options.theme)}if(I.goslingModels.forEach((C=>{const A=this.dimensions[1],l=this._xScale.invert(A)-this._xScale.invert(0);C.trackVisibility({zoomLevel:l})&&Sg(g,this,I,C)})),I.goslingModels&&I.goslingModels[0]){const C=I.goslingModels[0],A=this.dimensions[1],l=this._xScale.invert(A)-this._xScale.invert(0);if(!C.trackVisibility({zoomLevel:l}))return;kg(g,this,I,C,this.options.theme)}this.forceDraw()}}rerender(g){this.options=g,this.tooltips=[],this.svgData=[],this.textsBeingUsed=0,this.preprocessAllTiles(!0),this.draw(),this.forceDraw()}setDimensions(g){this.oldDimensions=this.dimensions,super.setDimensions(g)}setPosition(g){super.setPosition(g),[this.pMain.position.x,this.pMain.position.y]=this.position}forceDraw(){this.animate()}zoomed(g,I){this.xScale(g),this.yScale(I),this.refreshTiles(),this.draw(),this.forceDraw()}updateTileAsync(I){this.xDomain=this._xScale.domain(),this.xRange=this._xScale.range(),this.drawLoading(),this.trackNotFoundText.text="",this.worker.then((C=>{C.getTabularData(this.dataFetcher.uid,Object.values(this.fetchedTiles).map((g=>g.remoteId))).then((C=>{const A=this.visibleAndFetchedTiles(),l=JSON.parse(Buffer.from(C).toString());if(null==A?void 0:A[0]){const I=A[0];I.tileData.tabularData=l;const[C]=g.utils.trackUtils.calculate1DVisibleTiles(this.tilesetInfo,this._xScale);I.tileData.zoomLevel=C[0],I.tileData.tilePos=[C[1]]}I()}))}))}scaleScalableGraphics(g,I,C){const A=(C.domain()[1]-C.domain()[0])/(I.domain()[1]-I.domain()[0]),l=I.domain().map(C)[0];g.forEach((g=>{g.scale.x=A,g.position.x=-l*A}))}visibleAndFetchedIds(){return Object.keys(this.fetchedTiles).filter((g=>this.visibleTileIds.has(g)))}visibleAndFetchedTiles(){return this.visibleAndFetchedIds().map((g=>this.fetchedTiles[g]))}calculateVisibleTiles(){if(PI(this.options.spec)){const I=g.utils.trackUtils.calculate1DVisibleTiles(this.tilesetInfo,this._xScale);for(const g of I){const{tileWidth:I}=this.getTilePosAndDimensions(g[0],[g[1]],this.tilesetInfo.tile_size),C=2e4;if(I>(this.tilesetInfo.max_tile_width||C))return void this.forceDraw();this.forceDraw()}this.setVisibleTiles(I)}else{if(!this.tilesetInfo)return;if(this.zoomLevel=this.calculateZoomLevel(),this.tilesetInfo.resolutions){const g=this.tilesetInfo.resolutions.map((g=>+g)).sort(((g,I)=>I-g));this.xTiles=C.calculateTilesFromResolution(g[this.zoomLevel],this._xScale,this.tilesetInfo.min_pos[0],this.tilesetInfo.max_pos[0]),Mg(qg(this.options.spec)[0])&&C.calculateTilesFromResolution(g[this.zoomLevel],this._yScale,this.tilesetInfo.min_pos[0],this.tilesetInfo.max_pos[0]);const I=this.tilesToId(this.xTiles,this.yTiles,this.zoomLevel);this.setVisibleTiles(I)}else{this.xTiles=C.calculateTiles(this.zoomLevel,this.relevantScale(),this.tilesetInfo.min_pos[0],this.tilesetInfo.max_pos[0],this.tilesetInfo.max_zoom,this.tilesetInfo.max_width),Mg(qg(this.options.spec)[0])&&(this.yTiles=C.calculateTiles(this.zoomLevel,this._yScale,this.tilesetInfo.min_pos[1],this.tilesetInfo.max_pos[1],this.tilesetInfo.max_zoom,this.tilesetInfo.max_width1||this.tilesetInfo.max_width));const g=this.tilesToId(this.xTiles,this.yTiles,this.zoomLevel);this.setVisibleTiles(g)}}}getTilePosAndDimensions(g,I,C){const A=C||this.tilesetInfo.bins_per_dimension||256;if(this.tilesetInfo.resolutions){const C=this.tilesetInfo.resolutions.map((g=>+g)).sort(((g,I)=>I-g))[g],l=C*A,i=l;return{tileX:C*A*I[0],tileY:C*A*I[1],tileWidth:l,tileHeight:i}}{const C=I[0],A=I[1],l=this.tilesetInfo.min_pos[0],i=this.options.reverseYAxis?-this.tilesetInfo.max_pos[1]:this.tilesetInfo.min_pos[1],c=this.tilesetInfo.max_width/2**g,d=this.tilesetInfo.max_width/2**g;return{tileX:l+C*c,tileY:i+A*d,tileWidth:c,tileHeight:d}}}tilesToId(g,I,C){if(g&&!I)return g.map((g=>[C,g]));{const A=[];return g.forEach((g=>I.forEach((I=>A.push([C,g,I]))))),A}}drawLoading(g=!0){}reorganizeTileInfo(){var g,I;const C=this.visibleAndFetchedTiles();this.tileSize=null!=(I=null==(g=this.tilesetInfo)?void 0:g.tile_size)?I:1024,C.forEach((g=>{g.gos={};Object.keys(g.tileData).filter((g=>!+g&&"0"!==g)).forEach((I=>{g.gos[I]=g.tileData[I]})),g.gos.raw=Array.from(g.tileData)}))}shouldCombineTiles(){var g,I,C,A,l,i;return(null==(g=this.options.spec.dataTransform)?void 0:g.find((g=>"displace"===g.type)))&&(null==(C=null==(I=this.visibleAndFetchedTiles())?void 0:I[0])?void 0:C.tileData)&&!(null==(l=null==(A=this.visibleAndFetchedTiles())?void 0:A[0])?void 0:l.tileData.dense)||"bam"===(null==(i=this.options.spec.data)?void 0:i.type)}combineAllTilesIfNeeded(){var g,I,C;if(!this.shouldCombineTiles())return;const A=this.visibleAndFetchedTiles();if(!A||0===A.length)return;this.tileSize=(null!=(I=null==(g=this.tilesetInfo)?void 0:g.tile_size)?I:1024)*A.length;let l=[];A.forEach(((g,I)=>{l=[...l,...g.tileData],g.mergedToAnotherTile=0!==I})),A[0].gos.raw=l,(null==(C=A[0].gos.raw[0])?void 0:C.uid)&&(A[0].gos.raw=O(A[0].gos.raw,"uid"))}preprocessAllTiles(g=!1){const I=[];this.reorganizeTileInfo(),this.combineAllTilesIfNeeded(),this.visibleAndFetchedTiles().forEach((C=>{g&&(C.goslingModels=[]);const A=this.preprocessTile(C);null==A||A.forEach((g=>{I.push(g)}))})),function(g,I){const C={},A=wg;g.forEach((g=>{A.forEach((I=>{const A=g.spec()[I];if(!Dg(A)||void 0===A.domain)return;const{domain:l,type:i}=A;if("quantitative"===i){const g=Array.from(l);C[I]?(C[I][0]>g[0]&&(C[I][0]=g[0]),C[I][1]<g[1]&&(C[I][1]=g[1])):C[I]=g}else if("nominal"===i){const g=Array.from(l);C[I]?C[I]=Array.from(new Set([...C[I],...g])):C[I]=g}}))})),g.forEach((g=>{A.forEach((A=>{const l=g.spec()[A];Dg(l)&&"genomic"===l.type||(g.setChannelDomain(A,C[A],I),g.generateScales())})),g.updateChannelValue()}))}(I);const C=[].concat(...I.map((g=>g.data())));0!==C.length&&P.publish("rawdata",{id:this.options.spec.id,data:C})}preprocessTile(g){if(g.mergedToAnotherTile)return void(g.goslingModels=[]);if(g.goslingModels&&0!==g.goslingModels.length)return g.goslingModels;g.goslingModels=[];return qg(JSON.parse(JSON.stringify(this.options.spec))).forEach((I=>{if("brush"===I.mark)return;if("matrix"===I.data.type)return;if(!g.gos.tabularData){const{tileX:C,tileWidth:A}=this.getTilePosAndDimensions(g.gos.zoomLevel,g.gos.tilePos,this.tileSize);g.gos.tabularData=function(g,I){var C,A,l,i,c,d,m;const o=[];if(Tg(g.data)){if("vector"===g.data.type||"bigwig"===g.data.type){if(!g.data.column||!g.data.value)return void console.warn("Proper data configuration is not provided. Please specify the name of data fields.");if(!I.dense)return;const i=null!=(C=g.data.binSize)?C:1,c=I.dense,d=I.tileSize,Z=I.tileWidth/I.tileSize,e=g.data.value,m=g.data.column,b=null!=(A=g.data.start)?A:"start",a=null!=(l=g.data.end)?l:"end",s=`${e}_min`,t=`${e}_max`;let n=0,V=Number.MAX_SAFE_INTEGER,y=Number.MIN_SAFE_INTEGER,X=Number.MIN_SAFE_INTEGER,G=Number.MAX_SAFE_INTEGER;Array.from(Array(d).keys()).forEach(((g,C)=>{if(1===i){const g=c[C]/Z;o.push({[e]:g,[m]:I.tileX+(C+.5)*Z,[b]:I.tileX+C*Z,[a]:I.tileX+(C+1)*Z,[s]:g,[t]:g})}else if(C%i==0)n=V=y=c[C],X=C,G=C+i;else if(C%i==i-1)o.push({[e]:n/i/Z,[m]:I.tileX+(X+i/2)*Z,[b]:I.tileX+X*Z,[a]:I.tileX+G*Z,[s]:V,[t]:y});else if(C===d-1){const g=d%i,C=X+g;o.push({[e]:n/g/Z,[m]:I.tileX+(X+g/2)*Z,[b]:I.tileX+X*Z,[a]:I.tileX+C*Z,[s]:V,[t]:y})}else n+=c[C],V>c[C]&&(V=c[C]),y<c[C]&&(y=c[C])}))}else if("multivec"===g.data.type){if(!g.data.row||!g.data.column||!g.data.value)return void console.warn("Proper data configuration is not provided. Please specify the name of data fields.");if(!I.dense||void 0===I.shape)return;const C=null!=(i=g.data.binSize)?i:1,A=I.shape[0],l=null!=(c=g.data.categories)?c:[...Array(A).keys()],Z=I.dense,e=I.shape[1],b=I.tileWidth/I.tileSize,a=g.data.row,s=g.data.value,t=g.data.column,n=null!=(d=g.data.start)?d:"start",V=null!=(m=g.data.end)?m:"end",y=`${s}_min`,X=`${s}_max`;l.forEach(((g,A)=>{let l=0,i=Number.MIN_SAFE_INTEGER,c=Number.MAX_SAFE_INTEGER,d=Number.MAX_SAFE_INTEGER,m=Number.MIN_SAFE_INTEGER;Array.from(Array(e).keys()).forEach(((G,B)=>{if(1===C){const C=Z[e*A+B]/b;o.push({[a]:g,[s]:C,[t]:I.tileX+(B+.5)*b,[n]:I.tileX+B*b,[V]:I.tileX+(B+1)*b,[y]:C,[X]:C})}else if(B%C==0)l=d=m=Z[e*A+B],i=B,c=B+C;else if(B%C==C-1)o.push({[a]:g,[s]:l/C/b,[t]:I.tileX+(i+C/2)*b,[n]:I.tileX+i*b,[V]:I.tileX+c*b,[y]:d,[X]:m});else if(B===e-1){const A=e%C,c=i+A;o.push({[a]:g,[s]:l/A/b,[t]:I.tileX+(i+A/2)*b,[n]:I.tileX+i*b,[V]:I.tileX+c*b,[y]:d,[X]:m})}else{const g=Z[e*A+B];l+=g,d>g&&(d=g),m<g&&(m=g)}}))}))}else if("beddb"===g.data.type){if(!I.raw)return;const{genomicFields:C,exonIntervalFields:A,valueFields:l}=g.data;I.raw.forEach((g=>{const{chrOffset:I,fields:i}=g,c={};if(C.forEach((g=>{c[g.name]=+i[g.index]+I})),null==l||l.forEach((g=>{c[g.name]="quantitative"===g.type?+i[g.index]:i[g.index]})),o.push(e(Z({},c),{type:"gene"})),A){const[g,C]=A,l=i[g.index].split(","),d=i[C.index].split(",");l.forEach(((A,i)=>{const m=d[i];if(o.push(e(Z({},c),{[g.name]:+A+I,[C.name]:+m+I,type:"exon"})),i+1<l.length){const A=l[i+1];o.push(e(Z({},c),{[g.name]:+m+I,[C.name]:+A+I,type:"intron"}))}}))}}))}else g.data.type;return o}console.warn("No data is specified")}(I,e(Z({},g.gos),{tileX:C,tileWidth:A,tileSize:this.tileSize}))}g.gos.tabularDataFiltered=Array.from(g.gos.tabularData),I.dataTransform&&I.dataTransform.forEach((C=>{switch(C.type){case"filter":g.gos.tabularDataFiltered=BI(C,g.gos.tabularDataFiltered);break;case"concat":g.gos.tabularDataFiltered=function(g,I){const{fields:C,separator:A,newField:l}=g;let i=Array.from(I);return i=i.map((g=>{const I=C.map((I=>g[I]));return g[l]=I.join(A),g})),i}(C,g.gos.tabularDataFiltered);break;case"replace":g.gos.tabularDataFiltered=function(g,I){const{field:C,replace:A,newField:l}=g;let i=Array.from(I);return i=i.map((g=>(g[l]=g[C],A.forEach((I=>{const{from:C,to:A}=I;g[l]=g[l].toString().replaceAll(C,A)})),g))),i}(C,g.gos.tabularDataFiltered);break;case"log":g.gos.tabularDataFiltered=function(g,I){const{field:C,base:A,newField:l}=g;let i=Array.from(I);return i=i.map((g=>(+g[C]&&(g[null!=l?l:C]="e"===A?Math.log(+g[C]):Math.log(+g[C])/Math.log(null!=A?A:10)),g))),i}(C,g.gos.tabularDataFiltered);break;case"exonSplit":g.gos.tabularDataFiltered=function(g,I,C="hg38"){const{separator:A,fields:l,flag:i}=g;let c=Array.from(I);return c=c.map((g=>{const I=[];return l.forEach((l=>{const{field:c,type:d,newField:Z,chrField:e}=l;g[c].toString().split(A).forEach(((A,l)=>{let c=A;"genomic"===d&&(c=sI(C).interval[g[e]][0]+ +A),I[l]?I[l][Z]=c:I[l]=u(JSON.parse(JSON.stringify(g)),{[Z]:c,[i.field]:i.value})}))})),[g,...I]})).reduce(((g,I)=>g.concat(I)),[]),c}(C,g.gos.tabularDataFiltered,I.assembly);break;case"genomicLength":g.gos.tabularDataFiltered=function(g,I){const{startField:C,endField:A,newField:l}=g,i=Array.from(I);return i.forEach((g=>{const I=g[C],i=g[A];I&&i&&(g[l]=Math.abs(+i-+I))})),i}(C,g.gos.tabularDataFiltered);break;case"coverage":g.gos.tabularDataFiltered=function(g,I,C){const{startField:A,endField:l,newField:i,groupField:c}=g,d={};return I.forEach((g=>{const I=C(g[A]),i=C(g[l]),Z=c?g[c]:"__NO_GROUP__";for(let C=Math.floor(I);C<i;C+=1)d[Z]||(d[Z]={}),d[Z][C]||(d[Z][C]=0),d[Z][C]++})),Object.entries(d).flatMap((g=>{const[I,d]=g;return Object.entries(d).map((g=>{const[d,Z]=g;return{[A]:C.invert(+d),[l]:C.invert(+d+1),[null!=i?i:"coverage"]:Z,[null!=c?c:"group"]:I}}))}))}(C,g.gos.tabularDataFiltered,this._xScale.copy());break;case"subjson":g.gos.tabularDataFiltered=function(g,I){const{field:C,genomicField:A,baseGenomicField:l,genomicLengthField:i}=g;let c=Array.from(I);return c=c.map((g=>{let I=JSON.parse(g[C]);return I=I.map((I=>{var C,c;return I[A]&&g[l]&&(I[`${A}_start`]=+I[A]+ +g[l],I[`${A}_end`]=+I[A]+ +g[l]+ +I[i]),u(JSON.parse(JSON.stringify(g)),e(Z({},I),{[`${A}_start`]:I[`${A}_start`],[`${A}_end`]:I[`${A}_end`],type:null!=(c=null!=(C=I.type)?C:I.variant)?c:null,isParsedRow:"yes"}))})),[g,...I]})).reduce(((g,I)=>g.concat(I)),[]),c}(C,g.gos.tabularDataFiltered);break;case"displace":g.gos.tabularDataFiltered=function(g,I,C){const{boundingBox:A,method:l,newField:i}=g,{startField:c,endField:d,groupField:Z}=A;let e=0;A.padding&&C&&!A.isPaddingBP?e=Math.abs(C.invert(A.padding)-C.invert(0)):A.padding&&A.isPaddingBP&&(e=A.padding);const m=Array.from(I);if(m&&m.length>0&&(!Object.keys(m[0]).find((g=>g===c))||!Object.keys(m[0]).find((g=>g===d))))return m;if("pile"===l){const{maxRows:I}=g,C={};m.sort(((g,I)=>g[c]-I[c])).forEach((g=>{const A=g[c]-e,l=g[d]+e,m=Z?g[Z]:"__NO_GROUP__";C[m]||(C[m]=[]);let o=C[m].findIndex((g=>l<g.start?(g.start=A,!0):g.end<A&&(g.end=l,!0)));-1===o&&(C[m].push({start:A,end:l}),o=C[m].length-1),g[i]=`${I&&I<=o?I-1:o}`}))}else if("spread"===l){const g=[];m.sort(((g,I)=>g[c]-I[c])).forEach((I=>{let C=I[c]-e,A=I[d]+e,l=g.filter((g=>g.start===C&&A===g.end||g.start<C&&C<g.end||g.start<A&&A<g.end||C<g.start&&g.end<A));if(l.length>0){let I=0;do{l=g.filter((g=>g.start===C&&A===g.end||g.start<C&&C<g.end||g.start<A&&A<g.end||C<g.start&&g.end<A)),l.length>0&&(I%2==0?(C+=e*I,A+=e*I):(C-=e*I,A-=e*I)),I++}while(l.length>0&&I<1e3)}I[`${i}Start`]=`${C+e}`,I[`${i}Etart`]=""+(A-e),g.push({start:C,end:A})}))}return m}(C,g.gos.tabularDataFiltered,this._xScale.copy())}}));try{if(P){const C=100,A=g.gos.tabularDataFiltered.length;P.publish("data-preview",{id:this.context.id,dataConfig:JSON.stringify({data:I.data}),data:C>A?g.gos.tabularDataFiltered:k(g.gos.tabularDataFiltered,C)})}}catch(A){}const C=new LI(I,g.gos.tabularDataFiltered,this.options.theme);g.goslingModels.push(C)})),g.goslingModels}getIndicesOfVisibleDataInTile(g){var I,C,A;const l=this._xScale.range();if(!this.tilesetInfo)return[null,null];const{tileX:i,tileWidth:c}=this.getTilePosAndDimensions(g.gos.zoomLevel,g.gos.tilePos,this.tilesetInfo.bins_per_dimension||(null==(I=this.tilesetInfo)?void 0:I.tile_size)),d=n().domain([0,(null==(C=this.tilesetInfo)?void 0:C.tile_size)||(null==(A=this.tilesetInfo)?void 0:A.bins_per_dimension)]).range([i,i+c]);return[Math.max(0,Math.round(d.invert(this._xScale.invert(l[0])))),Math.min(g.gos.dense.length,Math.round(d.invert(this._xScale.invert(l[1]))))]}minVisibleValue(){}maxVisibleValue(){}exportSVG(){}onMouseOut(){document.body.style.cursor="default"}onMouseDown(g,I){this.mouseDownX=g,this.mouseDownY=I}onClick(g,I){if(!this.tilesetInfo||!this.tooltips)return;if(Math.sqrt((this.mouseDownX-g)**2+(this.mouseDownY-I)**2)>1)return;const C=this.tooltips.find((C=>C.isMouseOver(g,I)));C&&P.publish("click",{data:Z({},C.datum),genomicPosition:aI(Math.floor(this._xScale.invert(g)))})}getMouseOverHtml(g,I){if(!this.tilesetInfo||!this.tooltips)return;this.mouseOverGraphics.clear(),this.pMain.removeChild(this.mouseOverGraphics),this.pMain.addChild(this.mouseOverGraphics);const C=this.tooltips.find((C=>C.isMouseOver(g,I)));if(document.body.style.cursor=C?"pointer":"default",C&&P.publish("mouseover",{data:Z({},C.datum),genomicPosition:aI(Math.floor(this._xScale.invert(g)))}),C&&(C.markInfo.type,this.options.spec.tooltip)){return`<table style='text-align: left; margin-top: 12px'>${this.options.spec.tooltip.map((g=>{var I;const A=C.datum[g.field];let l=A;return"quantitative"===g.type&&g.format?l=K(g.format)(+A):"genomic"===g.type&&(l=aI(+A)),`<tr><td style='padding: 4px 8px'>${null!=(I=g.alt)?I:g.field}</td><td style='padding: 4px 8px'><b>${l}</b></td></tr>`})).join("")}</table>`}}}return new l(I)}jI.config={type:"gosling-track",datatype:["multivec","epilogos"],rotatable:!0,local:!1,orientation:"1d-horizontal",thumbnail:(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400" width={30} height={30}>\n    <rect style={{ fill: \'none\' }} width="400" height="400" />\n    <circle cx="110.62" cy="129.64" r="41.69" />\n    <circle style={{ fill: \'#fff\' }} cx="124.14" cy="114.12" r="10.76" />\n    <circle cx="288.56" cy="129.64" r="41.69" />\n    <circle style={{ fill: \'#fff\' }} cx="302.07" cy="114.12" r="10.76" />\n    <path\n        style={{ fill: \'#e18241\' }}\n        d="M313.1,241.64l8.61-22.09a430.11,430.11,0,0,0-88-15.87L224,225.63A384.54,384.54,0,0,1,313.1,241.64Z"\n    />\n    <path\n        style={{ fill: \'#e18241\' }}\n        d="M208.63,260.53a299.77,299.77,0,0,1,90.56,16.79L308,254.79a371.68,371.68,0,0,0-90-15.47Z"\n    />\n    <path\n        style={{ fill: \'#e18241\' }}\n        d="M174.4,225.56l-9-22a431.34,431.34,0,0,0-88,15.43l8.9,22A385.08,385.08,0,0,1,174.4,225.56Z"\n    />\n    <path\n        style={{ fill: \'#e18241\' }}\n        d="M100.71,276.35a300.51,300.51,0,0,1,87.91-15.82L180,239.29a372.51,372.51,0,0,0-88.3,14.76Z"\n    />\n    <path\n        style={{ fill: \'#e18241\' }}\n        d="M106.52,290.71c27.53,13.92,59.05,21.34,92.05,21.34h0c33.68,0,65.83-7.72,93.75-22.2a291.31,291.31,0,0,0-186.33-.4Z"\n    />\n</svg>',"text/xml").documentElement,availableOptions:["labelPosition","labelColor","labelTextOpacity","labelBackgroundOpacity","trackBorderWidth","trackBorderColor","trackType","scaledHeight","backgroundColor","barBorder","sortLargestOnTop","theme","axisPositionHorizontal"],defaultOptions:{labelPosition:"none",labelColor:"black",labelTextOpacity:.4,trackBorderWidth:0,trackBorderColor:"black",backgroundColor:"white",barBorder:!1,sortLargestOnTop:!0,axisPositionHorizontal:"left",theme:"light"}};let EI=!1;function qI(g){let I=0,C=0;return g.forEach((g=>{const A=g.boundingBox.x+g.boundingBox.width,l=g.boundingBox.y+g.boundingBox.height;C<l&&(C=l),I<A&&(I=A)})),{width:I,height:C}}function _I(g,I){var C,A;let l=[];$I(g,l);const i=qI(l);if(g.title||g.subtitle){const c=(g.title?(null!=(C=I.root.titleFontSize)?C:18)+6:0)+(g.subtitle?(null!=(A=I.root.subtitleFontSize)?A:14)+6:0),d=4;i.height+=c+d,i.height=i.height+(8-i.height%8),l.forEach((g=>{g.boundingBox.y+=c+d})),l=[{track:IC({width:i.width,height:c},g.title,g.subtitle),boundingBox:{x:0,y:0,width:i.width,height:c},layout:{x:0,y:0,w:12,h:c/i.height*12}},...l]}else i.height=i.height+(8-i.height%8);return l.forEach((g=>{g.layout.x=g.boundingBox.x/i.width*12,g.layout.w=g.boundingBox.width/i.width*12,g.layout.y=g.boundingBox.y,g.layout.h=g.boundingBox.height})),l}function $I(g,I,C=0,A=0,l=!0){let i=0,c=0,d=!0,Z=!1;II(g,(g=>{Z=!0,"circular"!==g.layout&&(d=!1)}));let e=!0;CI(g,(g=>{"vertical"!==g.arrangement&&"horizontal"!==g.arrangement||(e=!1)}));const m=l&&d&&Z&&e&&("views"in g&&("parallel"===g.arrangement||"serial"===g.arrangement)||"tracks"in g),o=I.length;if("tracks"in g){const l=g.tracks;"vertical"===g.orientation?(c=Math.max(...l.map((g=>g.height))),l.forEach(((l,d,Z)=>{1===gC([l])&&(l.width+=30),l.height=c,I.push({track:l,boundingBox:{x:C+i,y:A,width:l.width,height:c},layout:{x:0,y:0,w:0,h:0}}),Z[d+1]&&Z[d+1].overlayOnPreviousTrack||(i+=l.width,d!==Z.length-1&&(i+=void 0!==g.spacing?g.spacing:0))}))):(i=Math.max(...l.map((g=>g.width))),l.forEach(((l,d,Z)=>{1===gC([l])&&(l.height+=30),l.width=i,I.push({track:l,boundingBox:{x:C,y:A+c,width:i,height:l.height},layout:{x:0,y:0,w:0,h:0}}),Z[d+1]&&Z[d+1].overlayOnPreviousTrack||(c+=l.height,d!==Z.length-1&&(c+=void 0!==g.spacing?g.spacing:0))})))}else if("parallel"===g.arrangement||"vertical"===g.arrangement){const d=void 0!==g.spacing?g.spacing:10;g.views.forEach(((g,Z,e)=>{var o,b,a,s,t;const n=$I(g,I,C+(null!=(o=g.xOffset)?o:0),A+(null!=(b=g.yOffset)?b:0)+c,!m&&l);i<(null!=(a=g.xOffset)?a:0)+n.width&&(i=(null!=(s=g.xOffset)?s:0)+n.width),Z!==e.length-1&&(c+=d),c+=(null!=(t=g.yOffset)?t:0)+n.height}))}else"serial"!==g.arrangement&&"horizontal"!==g.arrangement||g.views.forEach(((d,Z,e)=>{var o,b,a,s,t;const n=void 0!==g.spacing?g.spacing:10,V=$I(d,I,C+(null!=(o=d.xOffset)?o:0)+i,A+(null!=(b=d.yOffset)?b:0),!m&&l);c<(null!=(a=d.xOffset)?a:0)+V.height&&(c=(null!=(s=d.xOffset)?s:0)+V.height),Z!==e.length-1&&(i+=n),i+=(null!=(t=d.xOffset)?t:0)+V.width}));if(m){const l=I.slice(o),d="views"in g&&("parallel"===g.arrangement||"serial"===g.arrangement)&&g.views.length>1,Z=void 0!==g.spacing?g.spacing:10,e=0,m=void 0!==g.centerRadius?g.centerRadius:.3,b=i/2+e,a=b*(1-m);l.forEach(((g,I)=>{var l,m;g.track.layout="circular",g.track.outerRadius=b-e-(g.boundingBox.y-A)/c*a,g.track.innerRadius=b-e-(g.boundingBox.y+g.boundingBox.height-A)/c*a;const o=Z/i*360;g.track.startAngle=o+(g.boundingBox.x-C)/i*(i-Z)/i*360,g.track.endAngle=(g.boundingBox.x+g.boundingBox.width-C)/i*(i-Z)/i*360,g.boundingBox.x=C+(null!=(l=g.track.xOffset)?l:0),g.boundingBox.y=A+(null!=(m=g.track.yOffset)?m:0),g.boundingBox.height=g.track.height=g.boundingBox.width=g.track.width=2*b,0!==I&&(g.track.overlayOnPreviousTrack=!0),d&&Ug(g.track)&&(g.track.overlay=g.track.overlay.filter((g=>"brush"!==g.mark)))})),c=2*b}return{x:C,y:A,width:i,height:c}}function gC(g){return g.filter((g=>Eg(g))).length}const IC=(g,I,C)=>JSON.parse(JSON.stringify({mark:"header",width:g.width,height:g.height,title:I,subtitle:C}));const CC=["rgba(68,1,84,1)","rgba(68,2,85,1)","rgba(69,3,87,1)","rgba(69,5,88,1)","rgba(69,6,90,1)","rgba(70,8,91,1)","rgba(70,9,93,1)","rgba(70,11,94,1)","rgba(70,12,96,1)","rgba(71,14,97,1)","rgba(71,15,98,1)","rgba(71,17,100,1)","rgba(71,18,101,1)","rgba(71,20,102,1)","rgba(72,21,104,1)","rgba(72,22,105,1)","rgba(72,24,106,1)","rgba(72,25,108,1)","rgba(72,26,109,1)","rgba(72,28,110,1)","rgba(72,29,111,1)","rgba(72,30,112,1)","rgba(72,32,113,1)","rgba(72,33,115,1)","rgba(72,34,116,1)","rgba(72,36,117,1)","rgba(72,37,118,1)","rgba(72,38,119,1)","rgba(72,39,120,1)","rgba(71,41,121,1)","rgba(71,42,121,1)","rgba(71,43,122,1)","rgba(71,44,123,1)","rgba(71,46,124,1)","rgba(70,47,125,1)","rgba(70,48,126,1)","rgba(70,49,126,1)","rgba(70,51,127,1)","rgba(69,52,128,1)","rgba(69,53,129,1)","rgba(69,54,129,1)","rgba(68,56,130,1)","rgba(68,57,131,1)","rgba(68,58,131,1)","rgba(67,59,132,1)","rgba(67,60,132,1)","rgba(67,62,133,1)","rgba(66,63,133,1)","rgba(66,64,134,1)","rgba(65,65,134,1)","rgba(65,66,135,1)","rgba(65,67,135,1)","rgba(64,69,136,1)","rgba(64,70,136,1)","rgba(63,71,136,1)","rgba(63,72,137,1)","rgba(62,73,137,1)","rgba(62,74,137,1)","rgba(61,75,138,1)","rgba(61,77,138,1)","rgba(60,78,138,1)","rgba(60,79,138,1)","rgba(59,80,139,1)","rgba(59,81,139,1)","rgba(58,82,139,1)","rgba(58,83,139,1)","rgba(57,84,140,1)","rgba(57,85,140,1)","rgba(56,86,140,1)","rgba(56,87,140,1)","rgba(55,88,140,1)","rgba(55,89,140,1)","rgba(54,91,141,1)","rgba(54,92,141,1)","rgba(53,93,141,1)","rgba(53,94,141,1)","rgba(52,95,141,1)","rgba(52,96,141,1)","rgba(51,97,141,1)","rgba(51,98,141,1)","rgba(51,99,141,1)","rgba(50,100,142,1)","rgba(50,101,142,1)","rgba(49,102,142,1)","rgba(49,103,142,1)","rgba(48,104,142,1)","rgba(48,105,142,1)","rgba(47,106,142,1)","rgba(47,107,142,1)","rgba(47,108,142,1)","rgba(46,109,142,1)","rgba(46,110,142,1)","rgba(45,111,142,1)","rgba(45,112,142,1)","rgba(45,112,142,1)","rgba(44,113,142,1)","rgba(44,114,142,1)","rgba(43,115,142,1)","rgba(43,116,142,1)","rgba(43,117,142,1)","rgba(42,118,142,1)","rgba(42,119,142,1)","rgba(41,120,142,1)","rgba(41,121,142,1)","rgba(41,122,142,1)","rgba(40,123,142,1)","rgba(40,124,142,1)","rgba(40,125,142,1)","rgba(39,126,142,1)","rgba(39,127,142,1)","rgba(38,128,142,1)","rgba(38,129,142,1)","rgba(38,130,142,1)","rgba(37,131,142,1)","rgba(37,131,142,1)","rgba(37,132,142,1)","rgba(36,133,142,1)","rgba(36,134,142,1)","rgba(35,135,142,1)","rgba(35,136,142,1)","rgba(35,137,142,1)","rgba(34,138,141,1)","rgba(34,139,141,1)","rgba(34,140,141,1)","rgba(33,141,141,1)","rgba(33,142,141,1)","rgba(33,143,141,1)","rgba(32,144,141,1)","rgba(32,145,140,1)","rgba(32,146,140,1)","rgba(32,147,140,1)","rgba(31,147,140,1)","rgba(31,148,140,1)","rgba(31,149,139,1)","rgba(31,150,139,1)","rgba(31,151,139,1)","rgba(30,152,139,1)","rgba(30,153,138,1)","rgba(30,154,138,1)","rgba(30,155,138,1)","rgba(30,156,137,1)","rgba(30,157,137,1)","rgba(30,158,137,1)","rgba(30,159,136,1)","rgba(30,160,136,1)","rgba(31,161,136,1)","rgba(31,162,135,1)","rgba(31,163,135,1)","rgba(31,163,134,1)","rgba(32,164,134,1)","rgba(32,165,134,1)","rgba(33,166,133,1)","rgba(33,167,133,1)","rgba(34,168,132,1)","rgba(35,169,131,1)","rgba(35,170,131,1)","rgba(36,171,130,1)","rgba(37,172,130,1)","rgba(38,173,129,1)","rgba(39,174,129,1)","rgba(40,175,128,1)","rgba(41,175,127,1)","rgba(42,176,127,1)","rgba(43,177,126,1)","rgba(44,178,125,1)","rgba(46,179,124,1)","rgba(47,180,124,1)","rgba(48,181,123,1)","rgba(50,182,122,1)","rgba(51,183,121,1)","rgba(53,183,121,1)","rgba(54,184,120,1)","rgba(56,185,119,1)","rgba(57,186,118,1)","rgba(59,187,117,1)","rgba(61,188,116,1)","rgba(62,189,115,1)","rgba(64,190,114,1)","rgba(66,190,113,1)","rgba(68,191,112,1)","rgba(70,192,111,1)","rgba(72,193,110,1)","rgba(73,194,109,1)","rgba(75,194,108,1)","rgba(77,195,107,1)","rgba(79,196,106,1)","rgba(81,197,105,1)","rgba(83,198,104,1)","rgba(85,198,102,1)","rgba(88,199,101,1)","rgba(90,200,100,1)","rgba(92,201,99,1)","rgba(94,201,98,1)","rgba(96,202,96,1)","rgba(98,203,95,1)","rgba(101,204,94,1)","rgba(103,204,92,1)","rgba(105,205,91,1)","rgba(108,206,90,1)","rgba(110,206,88,1)","rgba(112,207,87,1)","rgba(115,208,85,1)","rgba(117,208,84,1)","rgba(119,209,82,1)","rgba(122,210,81,1)","rgba(124,210,79,1)","rgba(127,211,78,1)","rgba(129,212,76,1)","rgba(132,212,75,1)","rgba(134,213,73,1)","rgba(137,213,72,1)","rgba(139,214,70,1)","rgba(142,215,68,1)","rgba(144,215,67,1)","rgba(147,216,65,1)","rgba(149,216,63,1)","rgba(152,217,62,1)","rgba(155,217,60,1)","rgba(157,218,58,1)","rgba(160,218,57,1)","rgba(163,219,55,1)","rgba(165,219,53,1)","rgba(168,220,51,1)","rgba(171,220,50,1)","rgba(173,221,48,1)","rgba(176,221,46,1)","rgba(179,221,45,1)","rgba(181,222,43,1)","rgba(184,222,41,1)","rgba(187,223,39,1)","rgba(189,223,38,1)","rgba(192,223,36,1)","rgba(195,224,35,1)","rgba(197,224,33,1)","rgba(200,225,32,1)","rgba(203,225,30,1)","rgba(205,225,29,1)","rgba(208,226,28,1)","rgba(211,226,27,1)","rgba(213,226,26,1)","rgba(216,227,25,1)","rgba(219,227,24,1)","rgba(221,227,24,1)","rgba(224,228,24,1)","rgba(226,228,24,1)","rgba(229,228,24,1)","rgba(232,229,25,1)","rgba(234,229,25,1)","rgba(237,229,26,1)","rgba(239,230,27,1)","rgba(242,230,28,1)","rgba(244,230,30,1)","rgba(247,230,31,1)","rgba(249,231,33,1)","rgba(251,231,35,1)","rgba(254,231,36,1)"];function AC(g,I,C,A,l){var i,c,d,m,o,b,a,s,t;const n=qg(I)[0];I.id||(I.id=Y());const V=n.assembly;if(zg(n.data)){let m,o;if(Tg(n.data)){const g=(y=n.data.url).includes("tileset_info/?d=")&&(y.includes("https:")||y.includes("http:"))?{server:y.split("tileset_info/?d=")[0],tilesetUid:y.split("tileset_info/?d=")[1]}:(console.warn(`Data url format is incorrect:${y}`),{server:void 0,tilesetUid:void 0});m=g.server,o=g.tilesetUid}const b=RI(n),a=rI(n),s=("x"===a||"xe"===a)&&Dg(b)?b.domain:void 0,t=Mg(n)&&Dg(n.y)?n.y.domain:void 0,X=C.width-("circular"!==n.layout&&"vertical"===n.orientation&&Eg(n)?30:0),G=C.height-("circular"!==n.layout&&"horizontal"===n.orientation&&Eg(n)?30:0),B={uid:`${I.id}-track`,type:Mg(n)?"gosling-2d-track":"gosling-track",server:m,tilesetUid:o,width:X,height:G,options:{showMousePosition:"circular"!==n.layout&&l.root.showMousePosition,mousePositionColor:l.root.mousePositionColor,name:"linear"===n.layout?n.title:" ",labelPosition:n.title?"left"===l.track.titleAlign?"topLeft":"topRight":"none",labelShowResolution:!1,labelColor:l.track.titleColor,labelBackgroundColor:l.track.titleBackground,labelBackgroundOpacity:.5,labelTextOpacity:1,labelLeftMargin:1,labelTopMargin:1,labelRightMargin:0,labelBottomMargin:0,backgroundColor:"transparent",spec:Z({},I),theme:l}};n.data&&zg(n.data)&&("csv"===n.data.type||"json"===n.data.type||"bigwig"===n.data.type||"bam"===n.data.type)&&(B.data=e(Z({},n.data),{assembly:V}));"matrix"===(null==(i=n.data)?void 0:i.type)&&(B.type="heatmap",B.options.colorRange="warm"===(null==n?void 0:n.color.range)?["white","rgba(245,166,35,1.0)","rgba(208,2,27,1.0)","black"]:CC,B.options.trackBorderWidth=1,B.options.trackBorderColor="black",B.options.colorbarPosition=(null==(c=n.color)?void 0:c.legend)?"topRight":"hidden"),n.overlayOnPreviousTrack?g.setViewOrientation(n.orientation).addTrackToCombined(B):g.setViewOrientation(n.orientation).setAssembly(V).addDefaultView(I.id,V).setDomain(s,Mg(n)?t:s).adjustDomain(n.orientation,X,G).setMainTrack(B).addTrackSourceServers(m).setZoomFixed(!0===n.static).setZoomLimits(null!=(d=n.zoomLimits)?d:[1,null]).setLayout(A);const W=(g,I="horizontal",C,A)=>{const l=400,i=200;return"horizontal"===I?"x"===g&&C<=i||"y"===g&&A<=i?"narrower":"x"===g&&C<=l||"y"===g&&A<=l?"narrow":"regular":"x"===g&&A<=i||"y"===g&&C<=i?"narrower":"x"===g&&A<=l||"y"===g&&C<=l?"narrow":"regular"};["x","y"].forEach((A=>{const i=n[A];if(Dg(i)&&"axis"in i&&i.axis&&"none"!==i.axis&&"genomic"===i.type){const c=W(A,I.orientation,C.width,C.height);g.setAxisTrack(i.axis,c,{id:`${I.id}-axis`,layout:n.layout,innerRadius:"top"===i.axis?n.outerRadius-30:n.innerRadius,outerRadius:"top"===i.axis?n.outerRadius:n.innerRadius+30,width:n.width,height:n.height,startAngle:n.startAngle,endAngle:n.endAngle,theme:l})}})),g.validateSpec(!0)}else"header"===n.mark&&(g.addDefaultView(`${I.id}-title`).setLayout(A),"string"==typeof n.title&&g.setTextTrack(C.width,(null!=(m=l.root.titleFontSize)?m:18)+6,n.title,l.root.titleColor,null!=(o=l.root.titleFontSize)?o:18,l.root.titleFontWeight,l.root.titleAlign,l.root.titleBackgroundColor,null!=(b=l.root.titleFontFamily)?b:Rg.fontFamily),"string"==typeof n.subtitle&&g.setTextTrack(C.width,(null!=(a=l.root.subtitleFontSize)?a:14)+6,n.subtitle,l.root.subtitleColor,null!=(s=l.root.subtitleFontSize)?s:14,l.root.subtitleFontWeight,l.root.subtitleAlign,l.root.subtitleBackgroundColor,null!=(t=l.root.subtitleFontFamily)?t:Rg.fontFamily));var y;return g}function lC(g,I,C,A){if(0===I.length)return;const l=new FI;I.forEach((g=>{const{track:I,boundingBox:C,layout:i}=g;AC(l,I,C,i,A)}));const i=function(g){const I=[];return g.spec().views.forEach((g=>{var C,A,l,i,c,d,Z,e,m,o,b,a,s,t,n;const V=g.uid;let y=null==(c=null==(i=null==(l=null==(A=null==(C=g.tracks.center)?void 0:C[0])?void 0:A.contents)?void 0:l[0])?void 0:i.options)?void 0:c.spec;y||(y=null==(o=null==(m=null==(e=null==(Z=null==(d=g.tracks.left)?void 0:d[0])?void 0:Z.contents)?void 0:e[0])?void 0:m.options)?void 0:o.spec,y||(y=null==(n=null==(t=null==(s=null==(a=null==(b=g.tracks.left)?void 0:b[1])?void 0:a.contents)?void 0:s[0])?void 0:t.options)?void 0:n.spec)),V&&y&&qg(y).forEach((g=>{wg.forEach((C=>{var A,l,i,c;const d=g[C];Dg(d)&&"linkingId"in d&&d.linkingId&&I.push({layout:"circular"===g.layout?"circular":"linear",viewId:V,linkId:d.linkingId,isBrush:"brush"===g.mark,style:{color:null==(A=g.color)?void 0:A.value,stroke:null==(l=g.stroke)?void 0:l.value,strokeWidth:null==(i=g.strokeWidth)?void 0:i.value,opacity:null==(c=g.opacity)?void 0:c.value,startAngle:g.startAngle,endAngle:g.endAngle,innerRadius:g.innerRadius,outerRadius:g.outerRadius}})}))}))})),I}(l);i.filter((g=>g.isBrush)).forEach((g=>{var I;l.addBrush(g.layout,g.viewId,A,null==(I=i.find((I=>!I.isBrush&&I.linkId===g.linkId)))?void 0:I.viewId,g.style)})),i.filter((g=>!g.isBrush)).forEach((g=>{l.spec().zoomLocks.locksByViewUid[g.viewId]=g.linkId,l.spec().locationLocks.locksByViewUid[g.viewId]=g.linkId}));Array.from(new Set(i.map((g=>g.linkId)))).forEach((g=>{l.spec().zoomLocks.locksDict[g]={uid:g},l.spec().locationLocks.locksDict[g]={uid:g},i.filter((g=>!g.isBrush)).filter((I=>I.linkId===g)).forEach((I=>{l.spec().zoomLocks.locksDict[g][I.viewId]=[124625310.5,124625310.5,249250.621],l.spec().locationLocks.locksDict[g][I.viewId]=[124625310.5,124625310.5,249250.621]}))})),C(l.spec(),qI(I))}function iC(g,I,C,A){const l=JSON.parse(JSON.stringify(g));!function(g){gI(g,((g,I,C)=>{var A,l,i;if(g.data&&Tg(g.data)&&!("alignment"in g)&&"data"in(A=g)&&"overrideTemplate"in A&&A.overrideTemplate)switch(g.data.type){case"vector":case"bigwig":C[I]=u({data:{type:"vector",url:"",column:l=g.data.column,value:i=g.data.value},mark:"bar",x:{field:l,type:"genomic",axis:"top"},y:{field:i,type:"quantitative"},width:400,height:100},g);break;case"multivec":C[I]=u(function(g,I,C,A){return A&&A.length<10?{data:{type:"multivec",url:"",row:g,column:I,value:C,categories:A},mark:"bar",x:{field:I,type:"genomic",axis:"top"},y:{field:C,type:"quantitative"},row:{field:g,type:"nominal",legend:!0},color:{field:g,type:"nominal"},width:400,height:100}:{data:{type:"multivec",url:"",row:g,column:I,value:C,categories:A},mark:"rect",x:{field:I,type:"genomic",axis:"top"},row:{field:g,type:"nominal",legend:!0},color:{field:C,type:"quantitative"},width:400,height:100}}(g.data.row,g.data.column,g.data.value,g.data.categories),g)}}))}(l),function(g,I){gI(g,((g,C,A)=>{var l,i;if(!("template"in g))return;const{template:c}=g,d=I.find((g=>g.name===c));if(!d)return g._invalidTrack=!0,void console.warn(`There is no track template named '${c}'`);let m=!0;if(d.channels.forEach((I=>{!I.required||g.encoding&&I.name in g.encoding||(m=!1,console.warn(`A template spec ('${c}') does not contain a required channel, ${I.name}`))})),!m)return void(g._invalidTrack=!0);const o=JSON.parse(JSON.stringify(g));"encoding"in o&&delete o.encoding;const b=e(Z({},o),{alignment:"overlay",tracks:[],width:null!=(l=g.width)?l:100,height:null!=(i=g.height)?i:100});d.mapping.forEach((I=>{const C={data:g.data,mark:I.mark},{dataTransform:A}=I;A&&A.map((I=>{const C=I.base;C&&g.encoding&&C in g.encoding&&"field"in g.encoding[C]&&(delete I.base,I.field=g.encoding[C].field)}));const l=g.encoding;l?Object.keys(I).filter((g=>"mark"!==g)).forEach((g=>{const A=JSON.parse(JSON.stringify(I[g]));if("base"in A){const I=A.base;if(I in l){const i=JSON.parse(JSON.stringify(l[I]));delete A.base;const c=u(A,JSON.parse(JSON.stringify(i)));C[g]=c}else delete A.base,C[g]=A}else C[g]=A})):Object.keys(I).filter((g=>"mark"!==g)).forEach((g=>{const A=JSON.parse(JSON.stringify(I[g]));"base"in A&&delete A.base,C[g]=A})),b.tracks.push(C)})),A[C]=b}))}(l,C),lI(l),function(g,I,C){lC(0,_I(g,C),I,C)}(l,I,A)}EI||(j({name:"GoslingTrack",track:jI,config:jI.config}),j({name:"Gosling2DTrack",track:jI,config:e(Z({},jI.config),{type:"gosling-2d-track",orientation:"2d"})}),j({name:"AxisTrack",track:XI,config:XI.config}),j({name:"TextTrack",track:E,config:E.config}),j({name:"BrushTrack",track:GI,config:GI.config}),j({dataFetcher:hI,config:hI.config},{pluginType:"dataFetcher"}),j({dataFetcher:pI,config:pI.config},{pluginType:"dataFetcher"}),j({dataFetcher:HI,config:HI.config},{pluginType:"dataFetcher"}),EI=!0);const cC=q.exports.forwardRef(((g,I)=>{var C;const[A,l]=q.exports.useState(null!=(C=g.id)?C:Y());q.exports.useEffect((()=>{var I;l(null!=(I=g.id)?I:Y())}),[g.id]);const i=g.viewConfig||{},c=q.exports.useMemo((()=>_.createElement($.exports.HiGlassComponent,{ref:I,options:{pixelPreciseMarginPadding:!0,containerPaddingX:0,containerPaddingY:0,viewMarginTop:0,viewMarginBottom:0,viewMarginLeft:0,viewMarginRight:0,viewPaddingTop:0,viewPaddingBottom:0,viewPaddingLeft:0,viewPaddingRight:0,sizeMode:"bounded",rangeSelectionOnAlt:!0},viewConfig:i})),[i]),{padding:d=60,margin:Z=0,border:e="none",background:m}=g.options||{};return _.createElement(_.Fragment,null,_.createElement("div",{id:A,className:`gosling-component ${g.className||""}`,style:{position:"relative",padding:d,margin:Z,border:e,background:m,width:g.size.width,height:g.size.height,textAlign:"left"}},_.createElement("div",{key:JSON.stringify(i),id:"higlass-wrapper",className:"higlass-wrapper",style:{position:"relative",display:"block",background:m,margin:0,padding:0,width:g.size.width,height:g.size.height}},c)))}));cC.displayName="HiGlassComponentWrapper";const dC={};function ZC(g,I,C){const A=()=>{if("api"in g)return g;if(g.current)return g.current;throw new Error("HiGlass ref not initalized")},l=g=>{var I,l;const i=A(),c=null!=(I=null==g?void 0:g.resolution)?I:4,d=null!=(l=null==g?void 0:g.transparentBackground)&&l,Z=i.pixiRenderer,e=gg.create({width:Z.width/2,height:Z.height/2,resolution:c});Z.render(i.pixiStage,e);const m=Z.plugins.extract.canvas(e),o=document.createElement("canvas");o.width=m.width,o.height=m.height;const b=o.getContext("2d");return d||(b.fillStyle=C.root.background,b.fillRect(0,0,o.width,o.height)),b.drawImage(m,0,0),{canvas:o,resolution:c,canvasWidth:m.width,canvasHeight:m.height}};return{subscribe:(g,I)=>{switch(g){case"mouseover":case"click":case"rawdata":return PubSub.subscribe(g,I);default:return void console.error(`Event type not recognized, got ${JSON.stringify(g)}.`)}},unsubscribe:g=>PubSub.unsubscribe(g),zoomTo:(g,I,C=0,l=1e3)=>{var i,c,d,Z;if(!I.includes("chr"))return void console.warn("Genomic interval you entered is not in a correct form.");const e=I.split(":")[0],m=null==(c=null==(i=sI().interval)?void 0:i[e])?void 0:c[0];if(!e||void 0===typeof m)return void console.warn("Chromosome name is not valid",e);const[o,b]=null!=(Z=null==(d=I.split(":")[1])?void 0:d.split("-"))?Z:[0,sI().size[e]],a=+o+m-C,s=+b+m+C;A().api.zoomTo(g,a,s,a,s,l)},zoomToExtent:(g,I=1e3)=>{const[C,l]=[0,sI().total];A().api.zoomTo(g,C,l,C,l,I)},zoomToGene:(g,I,C=0,l=1e3)=>{A().api.zoomToGene(g,I,C,l)},suggestGene:(g,I,C)=>{A().api.suggestGene(g,I,C)},getViewIds:()=>{if(!I)return[];const g=[];var C,A;return A=I=>{I.uid&&g.push(I.uid)},(C=I)&&C.views&&Array.isArray(C.views)&&C.views.forEach((g=>{g&&g.uid&&A(g)})),g},getCanvas:l,exportPng:g=>{const{canvas:I}=l({resolution:4,transparentBackground:g});I.toBlob((g=>{const I=document.createElement("a");document.body.append(I),I.download="gosling-visualization",I.href=URL.createObjectURL(g),I.click(),I.remove()}),"image/png")},exportPdf:async g=>{const{jsPDF:I}=await(C=()=>import("./jspdf.es.min.da8dac2f.js"),A=[],A&&0!==A.length?Promise.all(A.map((g=>{if((g=`/${g}`)in dC)return;dC[g]=!0;const I=g.endsWith(".css"),C=I?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${C}`))return;const A=document.createElement("link");return A.rel=I?"stylesheet":"modulepreload",I||(A.as="script",A.crossOrigin=""),A.href=g,document.head.appendChild(A),I?new Promise(((g,I)=>{A.addEventListener("load",g),A.addEventListener("error",I)})):void 0}))).then((()=>C())):C());var C,A;const{canvas:i}=l({resolution:4,transparentBackground:g}),c=i.toDataURL("image/jpeg",1),d=new I({orientation:i.width<i.height?"p":"l",unit:"pt",format:[i.width,i.height]});d.addImage(c,"JPEG",0,0,i.width,i.height),d.save("gosling-visualization.pdf")}}}const eC=q.exports.forwardRef(((g,I)=>{const[C,A]=q.exports.useState(),[l,i]=q.exports.useState({width:200,height:200}),c=q.exports.useRef(),d=zI(g.theme||"light");q.exports.useEffect((()=>{if(!I)return;const g=ZC(c,C,d);"function"==typeof I?I({hgRef:c,api:g}):I.current={hgRef:c,api:g}}),[I,c,C,d]),q.exports.useEffect((()=>{if(g.spec){if("error"===uI(g.spec).state)return void console.warn("Gosling spec is not valid. Please refer to the console message.");iC(g.spec,((I,l)=>{var d,Z,e;null==(d=g.compiled)||d.call(g,g.spec,I),i(l);const m=void 0!==C;(null==(Z=g.experimental)?void 0:Z.reactive)&&m?null==(e=c.current)||e.api.setViewConfig(I):A(I)}),[...iI],d)}}),[g.spec,d]);return q.exports.useMemo((()=>_.createElement(cC,{ref:c,viewConfig:C,size:l,id:g.id,className:g.className,options:{padding:g.padding,border:g.border,margin:g.margin,background:d.root.background}})),[C,l,d])}));function mC(g){const{code:I,readOnly:C,openFindBox:A,fontZoomIn:l,fontZoomOut:i,isDarkTheme:c}=g,d=q.exports.useRef(null),[Z,e]=q.exports.useState(I);function m(){Cg.defineTheme("gosling",c?{base:"vs-dark",inherit:!0,rules:[{token:"string.key.json",foreground:"#eeeeee",fontStyle:"bold"},{token:"string.value.json",foreground:"#8BE9FD",fontStyle:"bold"},{token:"number",foreground:"#FF79C6",fontStyle:"bold"},{token:"keyword.json",foreground:"#FF79C6",fontStyle:"bold"}],colors:{}}:{base:"vs",inherit:!0,rules:[{token:"string.key.json",foreground:"#222222"},{token:"string.value.json",foreground:"#035CC5"},{token:"number",foreground:"#E32A4F"},{token:"keyword.json",foreground:"#E32A4F"}],colors:{}})}return q.exports.useEffect((()=>{m()}),[c]),q.exports.useEffect((()=>{e(I)}),[I]),q.exports.useEffect((()=>{d.current&&void 0!==A&&d.current.getAction("actions.find").run()}),[A]),q.exports.useEffect((()=>{d.current&&void 0!==l&&d.current.getAction("editor.action.fontZoomIn").run()}),[l]),q.exports.useEffect((()=>{d.current&&void 0!==i&&d.current.getAction("editor.action.fontZoomOut").run()}),[i]),_.createElement(_.Fragment,null,_.createElement(Ag,{handleWidth:!0,handleHeight:!0,onResize:(g,I)=>{var C;null==(C=null==d?void 0:d.current)||C.layout({width:g,height:I})}}),_.createElement(lg,{language:"json",value:Z,theme:"gosling",options:{autoClosingBrackets:"beforeWhitespace",autoClosingQuotes:"beforeWhitespace",cursorBlinking:"smooth",folding:!0,lineNumbersMinChars:4,minimap:{enabled:!0},scrollBeyondLastLine:!1,wordWrap:"on",lineNumbers:"on",renderLineHighlight:"line",renderIndentGuides:!0,fontSize:14,readOnly:C},onChange:function(I){e(I),g.onChange&&g.onChange(I)},editorDidMount:function(g){d.current=g,g.focus(),g.createContextKey("editorIsOpen",!0)},editorWillMount:function(){m(),ig.json.jsonDefaults.setDiagnosticsOptions({allowComments:!0,enableSchemaRequest:!0,validate:!0,schemas:[{uri:"https://raw.githubusercontent.com/gosling-lang/gosling.js/master/schema/gosling.schema.json",fileMatch:["*"],schema:Wg}]}),ig.json.jsonDefaults.setModeConfiguration({diagnostics:!0,documentFormattingEdits:!1,documentRangeFormattingEdits:!1,documentSymbols:!0,completionItems:!0,hovers:!0,tokens:!0,colors:!0,foldingRanges:!0,selectionRanges:!1})}}))}self.MonacoEnvironment={getWorker:()=>new Ig};class oC extends _.Component{constructor(g){super(g),this.state={hasError:!1}}componentDidCatch(){this.setState({hasError:!0})}render(){return this.state.hasError?_.createElement("div",{style:{margin:"10px 40px"}},_.createElement("h3",null,"Something Went Wrong..."),_.createElement("h4",null,"• Refresh the webpage to restart the editor."),_.createElement("h4",null,"• Please help us fix this issue by submitting a"," ",_.createElement("a",{href:"https://github.com/gosling-lang/gosling.js/issues/new",target:"_blank",rel:"noopener noreferrer"},"GitHub issue")," ","with the spec on the left side.")):this.props.children}}const bC="https://server.gosling-lang.org/api/v1/tileset_info/?d=cistrome-multivec",aC="https://server.gosling-lang.org/api/v1/tileset_info/?d=epilogos-hg38",sC="https://server.gosling-lang.org/api/v1/tileset_info/?d=sequence-multivec",tC="https://server.gosling-lang.org/api/v1/tileset_info/?d=gene-annotation",nC="https://server.gosling-lang.org/api/v1/tileset_info/?d=clinvar-beddb",VC="https://server.gosling-lang.org/api/v1/tileset_info/?d=clinvar-multivec",yC="https://server.gosling-lang.org/api/v1/tileset_info/?d=hffc6-microc-hg38",XC="https://server.gosling-lang.org/api/v1/tileset_info/?d=hffc6-hic-hg38",GC="https://server.gosling-lang.org/api/v1/tileset_info/?d=transcript-hg38-beddb",BC=["#D45E00","#029F73","#0072B2","#CB7AA7","#E79F00"],WC=(g,I,C,A,l)=>({tracks:Array(1).fill({data:{type:"multivec",url:bC,value:"y",row:"_",column:"x",categories:["_"],binSize:32},mark:"rect",x:{field:"start",type:"genomic",axis:"none"},xe:{field:"end",type:"genomic"},row:{field:"_",type:"nominal"},color:{value:"lightgray"},style:{outline:g,outlineWidth:7},width:I+10*A,height:C+10*l})}),hC={title:"Layout and Arrangement",subtitle:"Try yourself with different arrangements and layouts",static:!0,layout:"linear",arrangement:"parallel",centerRadius:.5,views:[Z({},WC(BC[0],400,30,1,0)),{arrangement:"serial",views:[Z({},WC(BC[1],200,30,0,0)),Z({},WC(BC[2],200,30,0,0))]}]},pC={static:!0,layout:"linear",arrangement:"serial",centerRadius:.5,views:[{arrangement:"serial",views:[{arrangement:"parallel",views:[Z({},WC(BC[0],300,60,1,0)),Z({},WC(BC[1],300,30,1,0))]},{arrangement:"parallel",views:[Z({},WC(BC[2],50,60,1,0)),Z({},WC(BC[3],50,30,1,0))]}]},Z({},WC(BC[4],50,90,0,1))]},HC={title:"Visual Encoding",subtitle:"Gosling provides diverse visual encoding methods",layout:"linear",arrangement:"vertical",centerRadius:.8,xDomain:{chromosome:"1",interval:[1,3000500]},views:[{tracks:[{id:"track-1",data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"],binSize:4},mark:"rect",x:{field:"start",type:"genomic",axis:"top"},xe:{field:"end",type:"genomic"},row:{field:"sample",type:"nominal",legend:!0},color:{field:"peak",type:"quantitative",legend:!0},tooltip:[{field:"start",type:"genomic",alt:"Start Position"},{field:"end",type:"genomic",alt:"End Position"},{field:"peak",type:"quantitative",alt:"Value",format:".2"},{field:"sample",type:"nominal",alt:"Sample"}],width:600,height:130}]},{tracks:[{id:"track-2",data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"]},mark:"bar",x:{field:"position",type:"genomic",axis:"top"},y:{field:"peak",type:"quantitative"},row:{field:"sample",type:"nominal"},color:{field:"sample",type:"nominal",legend:!0},tooltip:[{field:"position",type:"genomic",alt:"Position"},{field:"peak",type:"quantitative",alt:"Value",format:".2"},{field:"sample",type:"nominal",alt:"Sample"}],width:600,height:130}]},{tracks:[{id:"track-3",data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"]},mark:"bar",x:{field:"position",type:"genomic",axis:"top"},y:{field:"peak",type:"quantitative",grid:!0},color:{field:"sample",type:"nominal",legend:!0},tooltip:[{field:"position",type:"genomic",alt:"Position"},{field:"peak",type:"quantitative",alt:"Value",format:".2"},{field:"sample",type:"nominal",alt:"Sample"}],width:600,height:130}]},{id:"track-4",alignment:"overlay",data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"]},x:{field:"position",type:"genomic",axis:"top"},y:{field:"peak",type:"quantitative"},row:{field:"sample",type:"nominal"},color:{field:"sample",type:"nominal",legend:!0},tracks:[{mark:"line"},{mark:"point",size:{field:"peak",type:"quantitative",range:[0,2]}}],tooltip:[{field:"position",type:"genomic",alt:"Position"},{field:"peak",type:"quantitative",alt:"Value",format:".2"},{field:"sample",type:"nominal",alt:"Sample"}],width:600,height:130},{tracks:[{id:"track-5",data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"]},mark:"point",x:{field:"position",type:"genomic",axis:"top"},y:{field:"peak",type:"quantitative"},row:{field:"sample",type:"nominal"},size:{field:"peak",type:"quantitative"},color:{field:"sample",type:"nominal",legend:!0},opacity:{value:.5},tooltip:[{field:"position",type:"genomic",alt:"Position"},{field:"peak",type:"quantitative",alt:"Value",format:".2"},{field:"sample",type:"nominal",alt:"Sample"}],width:600,height:130}]},{tracks:[{id:"track-6",data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"]},mark:"point",x:{field:"position",type:"genomic",axis:"top"},y:{field:"peak",type:"quantitative",grid:!0},size:{field:"peak",type:"quantitative"},color:{field:"sample",type:"nominal",legend:!0},opacity:{value:.5},tooltip:[{field:"position",type:"genomic",alt:"Position"},{field:"peak",type:"quantitative",alt:"Value",format:".2"},{field:"sample",type:"nominal",alt:"Sample"}],width:600,height:130}]},{tracks:[{id:"track-7",data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"]},mark:"area",x:{field:"position",type:"genomic",axis:"top"},y:{field:"peak",type:"quantitative"},row:{field:"sample",type:"nominal"},color:{field:"sample",type:"nominal",legend:!0},stroke:{value:"white"},strokeWidth:{value:.5},tooltip:[{field:"position",type:"genomic",alt:"Position"},{field:"peak",type:"quantitative",alt:"Value",format:".2"},{field:"sample",type:"nominal",alt:"Sample"}],width:600,height:130}]},{tracks:[{id:"track-8",data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"],binSize:4},mark:"bar",x:{field:"start",type:"genomic",axis:"top"},xe:{field:"end",type:"genomic",axis:"top"},y:{field:"peak_min",type:"quantitative"},ye:{field:"peak_max",type:"quantitative"},row:{field:"sample",type:"nominal"},color:{field:"sample",type:"nominal",legend:!0},stroke:{value:"black"},strokeWidth:{value:.2},tooltip:[{field:"position",type:"genomic",alt:"Position"},{field:"peak_min",type:"quantitative",alt:"min(Value)",format:".2"},{field:"peak_max",type:"quantitative",alt:"max(Value)",format:".2"},{field:"sample",type:"nominal",alt:"Sample"}],width:600,height:130}]},{tracks:[{id:"track-9",data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/circos-segdup-edited.txt",type:"csv",chromosomeField:"c2",genomicFields:["s1","e1","s2","e2"]},mark:"withinLink",x:{field:"s1",type:"genomic",domain:{chromosome:"1",interval:[1039e5,1041e5]}},xe:{field:"e1",type:"genomic"},x1:{field:"s2",type:"genomic",domain:{chromosome:"1"}},x1e:{field:"e2",type:"genomic"},color:{field:"s1",type:"nominal"},stroke:{value:"black"},strokeWidth:{value:.5},opacity:{value:.2},width:600,height:130}]}]},uC={title:"Visual Encoding in Circular Layouts",subtitle:"Gosling provides diverse visual encoding methods in circular layouts",layout:"circular",arrangement:"vertical",centerRadius:.5,static:!0,xDomain:{chromosome:"1",interval:[1,3000500]},views:[{arrangement:"horizontal",views:[{spacing:2,tracks:[{data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"],binSize:4},mark:"rect",x:{field:"start",type:"genomic",axis:"top"},xe:{field:"end",type:"genomic"},row:{field:"sample",type:"nominal",legend:!0},color:{field:"peak",type:"quantitative",legend:!0},width:350,height:130}]},{spacing:2,tracks:[{data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"]},mark:"bar",x:{field:"position",type:"genomic",axis:"top"},y:{field:"peak",type:"quantitative"},row:{field:"sample",type:"nominal"},color:{field:"sample",type:"nominal",legend:!0},width:350,height:130}]}]},{arrangement:"horizontal",views:[{spacing:2,tracks:[{data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"]},mark:"bar",x:{field:"position",type:"genomic",axis:"top"},y:{field:"peak",type:"quantitative",grid:!0},color:{field:"sample",type:"nominal",legend:!0},width:350,height:130}]},{spacing:2,alignment:"overlay",data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"]},x:{field:"position",type:"genomic",axis:"top"},y:{field:"peak",type:"quantitative"},row:{field:"sample",type:"nominal"},color:{field:"sample",type:"nominal",legend:!0},tracks:[{mark:"line"},{mark:"point",size:{field:"peak",type:"quantitative",range:[0,2]}}],width:350,height:130}]},{arrangement:"horizontal",views:[{spacing:2,tracks:[{data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"]},mark:"point",x:{field:"position",type:"genomic",axis:"top"},y:{field:"peak",type:"quantitative"},row:{field:"sample",type:"nominal"},size:{field:"peak",type:"quantitative"},color:{field:"sample",type:"nominal",legend:!0},opacity:{value:.5},width:350,height:130}]},{spacing:2,tracks:[{data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"]},mark:"point",x:{field:"position",type:"genomic",axis:"top"},y:{field:"peak",type:"quantitative",grid:!0},size:{field:"peak",type:"quantitative"},color:{field:"sample",type:"nominal",legend:!0},opacity:{value:.5},width:350,height:130}]}]},{arrangement:"horizontal",views:[{spacing:2,tracks:[{data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"]},mark:"area",x:{field:"position",type:"genomic",axis:"top"},y:{field:"peak",type:"quantitative"},row:{field:"sample",type:"nominal"},color:{field:"sample",type:"nominal",legend:!0},stroke:{value:"white"},strokeWidth:{value:.5},width:350,height:130}]},{spacing:2,tracks:[{data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/circos-segdup-edited.txt",type:"csv",chromosomeField:"c2",genomicFields:["s1","e1","s2","e2"]},mark:"withinLink",x:{field:"s1",type:"genomic",domain:{chromosome:"1",interval:[1039e5,1041e5]}},xe:{field:"e1",type:"genomic"},x1:{field:"s2",type:"genomic",domain:{chromosome:"1"}},x1e:{field:"e2",type:"genomic"},color:{field:"s1",type:"nominal"},stroke:{value:"black"},strokeWidth:{value:.5},opacity:{value:.4},width:350,height:130}]}]},{tracks:[{data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2"],binSize:4},mark:"bar",x:{field:"start",type:"genomic",axis:"top"},xe:{field:"end",type:"genomic",axis:"top"},y:{field:"peak_min",type:"quantitative"},ye:{field:"peak_max",type:"quantitative"},row:{field:"sample",type:"nominal"},color:{field:"sample",type:"nominal",legend:!0},stroke:{value:"black"},strokeWidth:{value:.2},tooltip:[{field:"position",type:"genomic",alt:"Position"},{field:"peak_min",type:"quantitative",alt:"min(Value)",format:".2"},{field:"peak_max",type:"quantitative",alt:"max(Value)",format:".2"},{field:"sample",type:"nominal",alt:"Sample"}],width:350,height:130}]}]};function YC(g,I,C,A){return{static:!1,layout:"linear",centerRadius:.05,xDomain:A,spacing:.01,tracks:[{alignment:"overlay",title:"example_higlass.bam",data:{type:"bam",url:"https://s3.amazonaws.com/gosling-lang.org/data/example_higlass.bam",indexUrl:"https://s3.amazonaws.com/gosling-lang.org/data/example_higlass.bam.bai",loadMates:!0},mark:"bar",tracks:[{dataTransform:[{type:"coverage",startField:"start",endField:"end"}],x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{field:"coverage",type:"quantitative",axis:"right"},color:{value:"#C6C6C6"}}],style:{outlineWidth:.5},width:I,height:80},{alignment:"overlay",title:"example_higlass.bam",data:{type:"bam",url:"https://s3.amazonaws.com/gosling-lang.org/data/example_higlass.bam",indexUrl:"https://s3.amazonaws.com/gosling-lang.org/data/example_higlass.bam.bai",loadMates:!0,maxInsertSize:300},mark:"rect",tracks:[{dataTransform:[{type:"displace",method:"pile",boundingBox:{startField:"start",endField:"end",padding:5,isPaddingBP:!0},newField:"pileup-row"}],x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},color:{field:"svType",type:"nominal",legend:!0,domain:["normal read","deletion (+-)","inversion (++)","inversion (--)","duplication (-+)","more than two mates","mates not found within chromosome","clipping"],range:["#C8C8C8","#E79F00","#029F73","#0072B2","#CB7AA7","#57B4E9","#D61E2E","#414141"]}},{dataTransform:[{type:"displace",method:"pile",boundingBox:{startField:"start",endField:"end",padding:5,isPaddingBP:!0},newField:"pileup-row"},{type:"subjson",field:"substitutions",genomicField:"pos",baseGenomicField:"start",genomicLengthField:"length"},{type:"filter",field:"type",oneOf:["S","H"]}],x:{field:"pos_start",type:"genomic"},xe:{field:"pos_end",type:"genomic"},color:{value:"#414141"}}],tooltip:[{field:"start",type:"genomic"},{field:"end",type:"genomic"},{field:"insertSize",type:"quantitative"},{field:"svType",type:"nominal"},{field:"strand",type:"nominal"},{field:"numMates",type:"quantitative"},{field:"mateIds",type:"nominal"}],row:{field:"pileup-row",type:"nominal",padding:.2},style:{outlineWidth:.5,legendTitle:"Insert Size = 300bp"},width:I,height:C}]}}const KC=Z({title:"Pileup Track Using BAM Data",subtitle:""},YC(0,1250,600,{chromosome:"1",interval:[136750,139450]})),RC={title:"Breast Cancer Variant (Staaf et al. 2019)",subtitle:"Genetic characteristics of RAD51C- and PALB2-altered TNBCs",layout:"linear",arrangement:"vertical",centerRadius:.5,assembly:"hg19",spacing:40,style:{outlineWidth:1,outline:"lightgray",enableSmoothPath:!1},views:[{arrangement:"vertical",views:[{xOffset:190,layout:"circular",spacing:1,tracks:[{title:"Patient Overview (PD35930a)",alignment:"overlay",data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/UCSC.HG38.Human.CytoBandIdeogram.csv",type:"csv",chromosomeField:"Chromosome",genomicFields:["chromStart","chromEnd"]},tracks:[{mark:"rect"},{mark:"brush",x:{linkingId:"mid-scale"},strokeWidth:{value:1.5},stroke:{value:"#0070DC"},color:{value:"#AFD8FF"},opacity:{value:.5}}],color:{field:"Stain",type:"nominal",domain:["gneg","gpos25","gpos50","gpos75","gpos100","gvar","acen"],range:["white","lightgray","gray","gray","black","#7B9CC8","#DC4542"]},size:{value:18},x:{field:"chromStart",type:"genomic"},xe:{field:"chromEnd",type:"genomic"},stroke:{value:"gray"},strokeWidth:{value:.3},width:500,height:100},{title:"Putative Driver",alignment:"overlay",data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/SV/driver.df.scanb.complete.csv",type:"csv",chromosomeField:"Chr",genomicFields:["ChrStart","ChrEnd"]},dataTransform:[{type:"filter",field:"Sample",oneOf:["PD35930a"]}],tracks:[{mark:"text"},{mark:"triangleBottom",size:{value:5}}],x:{field:"ChrStart",type:"genomic"},xe:{field:"ChrEnd",type:"genomic"},text:{field:"Gene",type:"nominal"},color:{value:"black"},style:{textFontWeight:"normal",dx:-10,outlineWidth:0},width:500,height:40},{title:"LOH",style:{background:"lightgray",backgroundOpacity:.2},alignment:"overlay",data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/cancer/cnv.PD35930a.csv",headerNames:["id","chr","start","end","total_cn_normal","minor_cp_normal","total_cn_tumor","minor_cn_tumor"],type:"csv",chromosomeField:"chr",genomicFields:["start","end"]},dataTransform:[{type:"filter",field:"minor_cn_tumor",oneOf:["0"]}],tracks:[{mark:"rect"},{mark:"brush",x:{linkingId:"mid-scale"},strokeWidth:{value:1},stroke:{value:"#94C2EF"},color:{value:"#AFD8FF"}}],x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},color:{value:"#FB6A4B"},width:620,height:40},{title:"Gain",style:{background:"lightgray",backgroundOpacity:.2},alignment:"overlay",data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/cancer/cnv.PD35930a.csv",headerNames:["id","chr","start","end","total_cn_normal","minor_cp_normal","total_cn_tumor","minor_cn_tumor"],type:"csv",chromosomeField:"chr",genomicFields:["start","end"]},dataTransform:[{type:"filter",field:"total_cn_tumor",inRange:[4.5,900]}],tracks:[{mark:"rect"},{mark:"brush",x:{linkingId:"mid-scale"},strokeWidth:{value:0}}],x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},color:{value:"#73C475"},width:500,height:40},{title:"Structural Variant",data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/cancer/rearrangement.PD35930a.csv",type:"csv",genomicFieldsToConvert:[{chromosomeField:"chr1",genomicFields:["start1","end1"]},{chromosomeField:"chr2",genomicFields:["start2","end2"]}]},mark:"withinLink",x:{field:"start1",type:"genomic"},xe:{field:"end2",type:"genomic"},color:{field:"svclass",type:"nominal",legend:!0,domain:["tandem-duplication","translocation","delection","inversion"],range:["#569C4D","#4C75A2","#DA5456","#EA8A2A"]},stroke:{field:"svclass",type:"nominal",domain:["tandem-duplication","translocation","delection","inversion"],range:["#569C4D","#4C75A2","#DA5456","#EA8A2A"]},strokeWidth:{value:1},opacity:{value:.6},style:{legendTitle:"SV Class"},width:500,height:80}]},{linkingId:"mid-scale",xDomain:{chromosome:"1"},layout:"linear",tracks:[{style:{background:"#D7EBFF",outline:"#8DC1F2",outlineWidth:5},title:"Ideogram",alignment:"overlay",data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/UCSC.HG38.Human.CytoBandIdeogram.csv",type:"csv",chromosomeField:"Chromosome",genomicFields:["chromStart","chromEnd"]},tracks:[{mark:"rect",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen"],not:!0}]},{mark:"triangleRight",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen"]},{type:"filter",field:"Name",include:"q"}]},{mark:"triangleLeft",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen"]},{type:"filter",field:"Name",include:"p"}]},{mark:"text",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen"],not:!0}],size:{value:12},color:{field:"Stain",type:"nominal",domain:["gneg","gpos25","gpos50","gpos75","gpos100","gvar"],range:["black","black","black","black","white","black"]},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}]}],color:{field:"Stain",type:"nominal",domain:["gneg","gpos25","gpos50","gpos75","gpos100","gvar","acen"],range:["white","lightgray","gray","gray","black","#7B9CC8","#DC4542"]},size:{value:18},x:{field:"chromStart",type:"genomic"},xe:{field:"chromEnd",type:"genomic"},text:{field:"Name",type:"nominal"},stroke:{value:"gray"},strokeWidth:{value:.3},width:500,height:30},{title:"Putative Driver",data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/SV/driver.df.scanb.complete.csv",type:"csv",chromosomeField:"Chr",genomicFields:["ChrStart","ChrEnd"]},dataTransform:[{type:"filter",field:"Sample",oneOf:["PD35930a"]}],mark:"text",x:{field:"ChrStart",type:"genomic"},xe:{field:"ChrEnd",type:"genomic"},text:{field:"Gene",type:"nominal"},color:{value:"black"},style:{textFontWeight:"normal",dx:-10},width:500,height:20},{alignment:"overlay",title:"hg38 | Genes",data:{url:"https://server.gosling-lang.org/api/v1/tileset_info/?d=gene-annotation",type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:5,name:"strand",type:"nominal"},{index:3,name:"name",type:"nominal"}],exonIntervalFields:[{index:12,name:"start"},{index:13,name:"end"}]},tracks:[{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["+"]}],mark:"triangleRight",x:{field:"end",type:"genomic"},size:{value:15}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]}],mark:"text",text:{field:"name",type:"nominal"},x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},style:{dy:-15,outline:"black",outlineWidth:0}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["-"]}],mark:"triangleLeft",x:{field:"start",type:"genomic"},size:{value:15},style:{align:"right",outline:"black",outlineWidth:0}},{dataTransform:[{type:"filter",field:"type",oneOf:["exon"]}],mark:"rect",x:{field:"start",type:"genomic"},size:{value:15},xe:{field:"end",type:"genomic"}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["+"]}],mark:"rule",x:{field:"start",type:"genomic"},strokeWidth:{value:2},xe:{field:"end",type:"genomic"},style:{linePattern:{type:"triangleRight",size:3.5},outline:"black",outlineWidth:0}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["-"]}],mark:"rule",x:{field:"start",type:"genomic"},strokeWidth:{value:2},xe:{field:"end",type:"genomic"},style:{linePattern:{type:"triangleLeft",size:3.5},outline:"black",outlineWidth:0}},{mark:"brush",x:{linkingId:"detail-1"},strokeWidth:{value:0},color:{value:"gray"},opacity:{value:.3}},{mark:"brush",x:{linkingId:"detail-2"},strokeWidth:{value:0},color:{value:"gray"},opacity:{value:.3}}],row:{field:"strand",type:"nominal",domain:["+","-"]},color:{field:"strand",type:"nominal",domain:["+","-"],range:["#97A8B2","#D4C6BA"]},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}],width:400,height:100},{title:"LOH",style:{background:"lightgray",backgroundOpacity:.2},data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/cancer/cnv.PD35930a.csv",headerNames:["id","chr","start","end","total_cn_normal","minor_cp_normal","total_cn_tumor","minor_cn_tumor"],type:"csv",chromosomeField:"chr",genomicFields:["start","end"]},dataTransform:[{type:"filter",field:"minor_cn_tumor",oneOf:["0"]}],mark:"rect",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},color:{value:"#FB6A4B"},width:620,height:20},{title:"Gain",style:{background:"lightgray",backgroundOpacity:.2},data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/cancer/cnv.PD35930a.csv",headerNames:["id","chr","start","end","total_cn_normal","minor_cp_normal","total_cn_tumor","minor_cn_tumor"],type:"csv",chromosomeField:"chr",genomicFields:["start","end"]},dataTransform:[{type:"filter",field:"total_cn_tumor",inRange:[4.5,900]}],mark:"rect",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},color:{value:"#73C475"},width:500,height:20},{title:"Structural Variant",data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/cancer/rearrangement.PD35930a.csv",type:"csv",genomicFieldsToConvert:[{chromosomeField:"chr1",genomicFields:["start1","end1"]},{chromosomeField:"chr2",genomicFields:["start2","end2"]}]},alignment:"overlay",tracks:[{mark:"withinLink",x:{field:"start1",type:"genomic"},xe:{field:"end2",type:"genomic"}},{mark:"point",x:{field:"start1",type:"genomic"},y:{value:400}},{mark:"point",x:{field:"end2",type:"genomic"},y:{value:400}}],color:{field:"svclass",type:"nominal",domain:["tandem-duplication","translocation","delection","inversion"],range:["#569C4D","#4C75A2","#DA5456","#EA8A2A"],legend:!0},stroke:{field:"svclass",type:"nominal",domain:["tandem-duplication","translocation","delection","inversion"],range:["#569C4D","#4C75A2","#DA5456","#EA8A2A"]},strokeWidth:{value:1},opacity:{value:.6},size:{value:4},tooltip:[{field:"start1",type:"genomic"},{field:"end2",type:"genomic"},{field:"svclass",type:"nominal"}],style:{legendTitle:"SV Class",bazierLink:!0},width:1e3,height:200}]}]},{arrangement:"horizontal",spacing:100,views:[Z({},YC(0,450,310,{chromosome:"1",interval:[205e3,207e3]})),Z({},YC(0,450,310,{chromosome:"1",interval:[49e4,496e3]}))]}]},rC={title:"Matrix Visualization",subtitle:"Comparison of Micro-C and Hi-C for HFFc6 Cells",arrangement:"horizontal",xDomain:{chromosome:"7",interval:[777e5,81e6]},spacing:1,linkingId:"-",views:[{orientation:"vertical",yOffset:75,views:[{tracks:[{data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/HFFc6_H3K4me3.bigWig",type:"bigwig",column:"position",value:"peak",binSize:8},title:"HFFc6_H3K4me3",mark:"bar",x:{field:"start",type:"genomic",axis:"top"},xe:{field:"end",type:"genomic"},y:{field:"peak",type:"quantitative",axis:"none"},color:{value:"darkgreen"},height:600,width:40},{data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/HFFc6_Atacseq.mRp.clN.bigWig",type:"bigwig",column:"position",value:"peak",binSize:8},title:"HFFc6_ATAC",mark:"bar",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{field:"peak",type:"quantitative",axis:"none"},color:{value:"#E79F00"},height:600,width:40},{alignment:"overlay",tracks:[{data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/HFFC6_CTCF.mRp.clN.bigWig",type:"bigwig",column:"position",value:"peak",binSize:8},mark:"bar",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{field:"peak",type:"quantitative",axis:"none"},color:{value:"#0072B2"}},{style:{backgroundOpacity:0},data:{url:tC,type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:5,name:"strand",type:"nominal"},{index:3,name:"name",type:"nominal"}]},dataTransform:[{type:"filter",field:"strand",oneOf:["+"]}],mark:"triangleRight",x:{field:"start",type:"genomic"},size:{value:13},stroke:{value:"white"},strokeWidth:{value:1},row:{field:"strand",type:"nominal",domain:["+","-"]},color:{value:"#CB7AA7"}},{style:{backgroundOpacity:0},title:"HFFC6_CTCF",data:{url:tC,type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:5,name:"strand",type:"nominal"},{index:3,name:"name",type:"nominal"}]},dataTransform:[{type:"filter",field:"strand",oneOf:["-"]}],mark:"triangleLeft",x:{field:"start",type:"genomic"},size:{value:13},stroke:{value:"white"},strokeWidth:{value:1},row:{field:"strand",type:"nominal",domain:["+","-"]},color:{value:"#029F73"}}],height:600,width:40}]}]},{spacing:30,views:[{spacing:0,arrangement:"vertical",views:[{tracks:[{data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/HFFc6_H3K4me3.bigWig",type:"bigwig",column:"position",value:"peak",binSize:8},title:"HFFc6_H3K4me3",mark:"bar",x:{field:"start",type:"genomic",axis:"top"},xe:{field:"end",type:"genomic"},y:{field:"peak",type:"quantitative",axis:"none"},color:{value:"darkgreen"},width:570,height:40},{data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/HFFc6_Atacseq.mRp.clN.bigWig",type:"bigwig",column:"position",value:"peak",binSize:8},title:"HFFc6_ATAC",mark:"bar",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{field:"peak",type:"quantitative",axis:"none"},color:{value:"#E79F00"},width:600,height:40},{alignment:"overlay",tracks:[{data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/HFFC6_CTCF.mRp.clN.bigWig",type:"bigwig",column:"position",value:"peak",binSize:8},mark:"bar",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{field:"peak",type:"quantitative",axis:"none"},color:{value:"#0072B2"}},{style:{backgroundOpacity:0},data:{url:tC,type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:5,name:"strand",type:"nominal"},{index:3,name:"name",type:"nominal"}]},dataTransform:[{type:"filter",field:"strand",oneOf:["+"]}],mark:"triangleRight",x:{field:"start",type:"genomic"},size:{value:13},stroke:{value:"white"},strokeWidth:{value:1},row:{field:"strand",type:"nominal",domain:["+","-"]},color:{value:"#CB7AA7"}},{style:{backgroundOpacity:0},title:"HFFC6_CTCF",data:{url:tC,type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:5,name:"strand",type:"nominal"},{index:3,name:"name",type:"nominal"}]},dataTransform:[{type:"filter",field:"strand",oneOf:["-"]}],mark:"triangleLeft",x:{field:"start",type:"genomic"},stroke:{value:"white"},strokeWidth:{value:1},size:{value:13},row:{field:"strand",type:"nominal",domain:["+","-"]},color:{value:"#029F73"}}],width:600,height:40}]},{tracks:[{title:"HFFc6_Micro-C",data:{url:yC,type:"matrix"},mark:"rect",x:{field:"position1",type:"genomic",axis:"none"},y:{field:"position2",type:"genomic",axis:"none"},color:{field:"value",type:"quantitative",range:"warm"},width:600,height:600}]},{tracks:[{title:"Epilogos (hg38)",data:{url:aC,type:"multivec",row:"category",column:"position",value:"value",categories:["Active TSS","Flanking Active TSS","Transcr at gene 5\\' and 3\\'","Strong transcription","Weak transcription","Genic enhancers","Enhancers","ZNF genes & repeats","Heterochromatin","Bivalent/Poised TSS","Flanking Bivalent TSS/Enh","Bivalent Enhancer","Repressed PolyComb","Weak Repressed PolyComb","Quiescent/Low"],binSize:8},dataTransform:[{type:"filter",field:"value",inRange:[0,999999]}],mark:"bar",x:{field:"start",type:"genomic",axis:"none"},xe:{field:"end",type:"genomic"},y:{field:"value",type:"quantitative",axis:"none"},color:{field:"category",type:"nominal",range:["#FF0000","#FF4500","#32CD32","#008000","#006400","#C2E105","#FFFF00","#66CDAA","#8A91D0","#CD5C5C","#E9967A","#BDB76B","#808080","#C0C0C0","gray"]},width:600,height:40}]}]},{arrangement:"vertical",spacing:0,views:[{tracks:[{data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/HFFc6_H3K4me3.bigWig",type:"bigwig",column:"position",value:"peak",binSize:8},title:"HFFc6_H3K4me3",mark:"bar",x:{field:"start",type:"genomic",axis:"top"},xe:{field:"end",type:"genomic"},y:{field:"peak",type:"quantitative",axis:"none"},color:{value:"darkgreen"},width:600,height:40},{data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/HFFc6_Atacseq.mRp.clN.bigWig",type:"bigwig",column:"position",value:"peak",binSize:8},title:"HFFc6_ATAC",mark:"bar",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{field:"peak",type:"quantitative",axis:"none"},color:{value:"#E79F00"},width:600,height:40},{alignment:"overlay",tracks:[{data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/HFFC6_CTCF.mRp.clN.bigWig",type:"bigwig",column:"position",value:"peak",binSize:8},mark:"bar",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{field:"peak",type:"quantitative",axis:"none"},color:{value:"#0072B2"}},{style:{backgroundOpacity:0},data:{url:tC,type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:5,name:"strand",type:"nominal"},{index:3,name:"name",type:"nominal"}]},dataTransform:[{type:"filter",field:"strand",oneOf:["+"]}],mark:"triangleRight",x:{field:"start",type:"genomic"},size:{value:13},stroke:{value:"white"},strokeWidth:{value:1},row:{field:"strand",type:"nominal",domain:["+","-"]},color:{value:"#CB7AA7"}},{style:{backgroundOpacity:0},title:"HFFC6_CTCF",data:{url:tC,type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:5,name:"strand",type:"nominal"},{index:3,name:"name",type:"nominal"}]},dataTransform:[{type:"filter",field:"strand",oneOf:["-"]}],mark:"triangleLeft",x:{field:"start",type:"genomic"},size:{value:13},stroke:{value:"white"},strokeWidth:{value:1},row:{field:"strand",type:"nominal",domain:["+","-"]},color:{value:"#029F73"}}],width:600,height:40}]},{tracks:[{title:"HFFc6_Hi-C",data:{url:XC,type:"matrix"},mark:"rect",x:{field:"position1",type:"genomic",axis:"none"},y:{field:"position2",type:"genomic",axis:"none"},color:{field:"value",type:"quantitative",range:"warm"},width:600,height:600}]},{tracks:[{title:"Epilogos (hg38)",data:{url:aC,type:"multivec",row:"category",column:"position",value:"value",categories:["Active TSS","Flanking Active TSS","Transcr at gene 5\\' and 3\\'","Strong transcription","Weak transcription","Genic enhancers","Enhancers","ZNF genes & repeats","Heterochromatin","Bivalent/Poised TSS","Flanking Bivalent TSS/Enh","Bivalent Enhancer","Repressed PolyComb","Weak Repressed PolyComb","Quiescent/Low"],binSize:8},dataTransform:[{type:"filter",field:"value",inRange:[0,999999]}],mark:"bar",x:{field:"start",type:"genomic",axis:"none"},xe:{field:"end",type:"genomic"},y:{field:"value",type:"quantitative",axis:"none"},color:{field:"category",type:"nominal",range:["#FF0000","#FF4500","#32CD32","#008000","#006400","#C2E105","#FFFF00","#66CDAA","#8A91D0","#CD5C5C","#E9967A","#BDB76B","#808080","#C0C0C0","gray"]},width:600,height:40}]}]}]}],style:{outlineWidth:0,background:"#F6F6F6"}},JC={title:"Visual Linking",subtitle:"Change the position and range of brushes to update the detail view on the bottom",arrangement:"vertical",centerRadius:.4,views:[{spacing:40,arrangement:"horizontal",views:[{spacing:5,static:!0,layout:"circular",xDomain:{chromosome:"1"},alignment:"overlay",tracks:[{mark:"bar"},{mark:"brush",x:{linkingId:"detail"}}],data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"]},x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{field:"peak",type:"quantitative"},row:{field:"sample",type:"nominal"},color:{field:"sample",type:"nominal"},width:250,height:130},{layout:"linear",xDomain:{chromosome:"1"},alignment:"overlay",tracks:[{mark:"bar"},{mark:"brush",x:{linkingId:"detail"}}],data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"]},x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{field:"peak",type:"quantitative"},row:{field:"sample",type:"nominal"},color:{field:"sample",type:"nominal"},width:400,height:200}]},{layout:"linear",xDomain:{chromosome:"1",interval:[16e7,2e8]},linkingId:"detail",tracks:[{data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"]},mark:"bar",x:{field:"position",type:"genomic",axis:"top"},y:{field:"peak",type:"quantitative"},row:{field:"sample",type:"nominal"},color:{field:"sample",type:"nominal"},width:690,height:200}]}]},wC={title:"Basic Idea of Semantic Zoom",subtitle:"Zoom in and out to see how different visual encoding (here, color) can be applied depending on the zoom level.",layout:"linear",centerRadius:.5,alignment:"overlay",data:{type:"multivec",url:bC,value:"y",row:"_",column:"x",categories:["_"],binSize:12},mark:"rect",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},style:{outline:"black",outlineWidth:1},width:720,height:130,tracks:[{color:{value:"#E79F00"},visibility:[{operation:"GT",target:"mark",threshold:1e8,measure:"zoomLevel"}]},{color:{value:"#57B4E9"},visibility:[{operation:"GT",target:"mark",threshold:1e7,measure:"zoomLevel"},{operation:"LT",target:"mark",threshold:1e8,measure:"zoomLevel"}]},{color:{value:"#029F73"},visibility:[{operation:"GT",target:"mark",threshold:1e6,measure:"zoomLevel"},{operation:"LT",target:"mark",threshold:1e7,measure:"zoomLevel"}]},{color:{value:"#0072B2"},visibility:[{operation:"GT",target:"mark",threshold:1e5,measure:"zoomLevel"},{operation:"LT",target:"mark",threshold:1e6,measure:"zoomLevel"}]},{color:{value:"#D45E00"},visibility:[{operation:"GT",target:"mark",threshold:1e4,measure:"zoomLevel"},{operation:"LT",target:"mark",threshold:1e5,measure:"zoomLevel"}]},{color:{value:"#CB7AA7"},visibility:[{operation:"GT",target:"mark",threshold:1e3,measure:"zoomLevel"},{operation:"LT",target:"mark",threshold:1e4,measure:"zoomLevel"}]}]},SC={title:"Mark Displacement",subtitle:"Reposition marks to address visual overlaps using `displacement` options",spacing:1,centerRadius:.8,xDomain:{chromosome:"17",interval:[4308e4,4312e4]},views:[{alignment:"overlay",xDomain:{chromosome:"3",interval:[1425e5,143e6]},data:{url:GC,type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:0,name:"chr",type:"nominal"},{index:5,name:"strand",type:"nominal"},{index:3,name:"name",type:"nominal"},{index:9,name:"exon_start",type:"nominal"},{index:10,name:"exon_end",type:"nominal"}]},dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"displace",method:"pile",boundingBox:{startField:"start",endField:"end"},newField:"row",maxRows:15}],title:"hg38 | Transcript (Max. 15 Rows)",tracks:[{dataTransform:[{type:"displace",method:"pile",boundingBox:{startField:"start",endField:"end"},newField:"row",maxRows:15},{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["+"]}],mark:"triangleRight",x:{field:"end",type:"genomic",axis:"top"},xe:void 0,size:{value:15}},{dataTransform:[{type:"displace",method:"pile",boundingBox:{startField:"start",endField:"end"},newField:"row",maxRows:15},{type:"filter",field:"type",oneOf:["gene"]}],mark:"text",text:{field:"name",type:"nominal"},x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},style:{dy:-10}},{dataTransform:[{type:"displace",method:"pile",boundingBox:{startField:"start",endField:"end"},newField:"row",maxRows:15},{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["-"]}],mark:"triangleLeft",x:{field:"start",type:"genomic"},size:{value:15},style:{align:"right"}},{dataTransform:[{type:"displace",method:"pile",boundingBox:{startField:"start",endField:"end"},newField:"row",maxRows:15},{type:"exonSplit",separator:",",flag:{field:"type",value:"exon"},fields:[{field:"exon_start",type:"genomic",newField:"start",chrField:"chr"},{field:"exon_end",type:"genomic",newField:"end",chrField:"chr"}]},{type:"filter",field:"type",oneOf:["exon"]}],mark:"rect",size:{value:10},x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"}},{dataTransform:[{type:"displace",method:"pile",boundingBox:{startField:"start",endField:"end"},newField:"row",maxRows:15},{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["+"]}],mark:"rule",x:{field:"start",type:"genomic"},strokeWidth:{value:3},xe:{field:"end",type:"genomic"},style:{linePattern:{type:"triangleRight",size:5}}},{dataTransform:[{type:"displace",method:"pile",boundingBox:{startField:"start",endField:"end"},newField:"row",maxRows:15},{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["-"]}],mark:"rule",x:{field:"start",type:"genomic"},strokeWidth:{value:3},xe:{field:"end",type:"genomic"},style:{linePattern:{type:"triangleRight",size:5}}}],row:{field:"row",type:"nominal"},color:{field:"strand",type:"nominal",domain:["+","-"],range:["#0072B2","#D45E00"]},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}],opacity:{value:.8},style:{outline:"black"},width:700,height:500},{xDomain:{chromosome:"2",interval:[1268e5,1277e5]},tracks:[{alignment:"overlay",title:"Likely Benign",data:{url:"https://server.gosling-lang.org/api/v1/tileset_info/?d=clinvar-beddb",type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:7,name:"significance",type:"nominal"},{type:"nominal",index:3,name:"3"},{type:"nominal",index:4,name:"4"}]},dataTransform:[{type:"filter",field:"significance",oneOf:["Likely_benign"]},{type:"displace",boundingBox:{startField:"start",endField:"end",padding:5},method:"spread",newField:"a"}],tracks:[{mark:"point",size:{value:4},color:{value:"#029F73"},stroke:{value:"black"},strokeWidth:{value:1}},{mark:"text",color:{field:"3",type:"nominal",domain:["A","T","G","C"],legend:!0},text:{field:"3",type:"nominal"},y:{value:48}},{mark:"text",color:{field:"4",type:"nominal",domain:["A","T","G","C"]},text:{field:"4",type:"nominal"},y:{value:18}},{mark:"text",color:{value:"gray"},text:{value:"↓"},y:{value:33}}],x:{field:"aStart",type:"genomic"},xe:{field:"aEnd",type:"genomic"},y:{value:5},opacity:{value:.8},style:{inlineLegend:!0},width:700,height:60},{data:{url:"https://server.gosling-lang.org/api/v1/tileset_info/?d=clinvar-beddb",type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:7,name:"significance",type:"nominal"}]},dataTransform:[{type:"filter",field:"significance",oneOf:["Likely_benign"]},{type:"displace",boundingBox:{startField:"start",endField:"end",padding:5},method:"spread",newField:"a"}],mark:"betweenLink",xe:{field:"start",type:"genomic"},x:{field:"aStart",type:"genomic"},color:{value:"#029F73"},stroke:{value:"lightgrey"},strokeWidth:{value:.5},opacity:{value:.8},width:700,height:60},{alignment:"overlay",tracks:[{data:{url:"https://server.gosling-lang.org/api/v1/tileset_info/?d=clinvar-beddb",type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:7,name:"significance",type:"nominal"}]},dataTransform:[{type:"filter",field:"significance",oneOf:["Likely_benign"]}],mark:"rect",color:{value:"lightgray"},stroke:{value:"lightgray"},strokeWidth:{value:.5},x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},opacity:{value:.8}},{data:{url:tC,type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:5,name:"strand",type:"nominal"},{index:3,name:"name",type:"nominal"}],exonIntervalFields:[{index:12,name:"start"},{index:13,name:"end"}]},row:{field:"strand",type:"nominal",domain:["+","-"]},color:{field:"strand",type:"nominal",domain:["+","-"],range:["#7585FF","#FF8A85"]},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}],opacity:{value:.8},dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["+"]}],mark:"triangleRight",x:{field:"end",type:"genomic",axis:"none"},size:{value:15}},{data:{url:tC,type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:5,name:"strand",type:"nominal"},{index:3,name:"name",type:"nominal"}],exonIntervalFields:[{index:12,name:"start"},{index:13,name:"end"}]},row:{field:"strand",type:"nominal",domain:["+","-"]},color:{field:"strand",type:"nominal",domain:["+","-"],range:["#7585FF","#FF8A85"]},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}],opacity:{value:.8},dataTransform:[{type:"filter",field:"type",oneOf:["gene"]}],mark:"text",text:{field:"name",type:"nominal"},x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},style:{dy:-15}},{data:{url:tC,type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:5,name:"strand",type:"nominal"},{index:3,name:"name",type:"nominal"}],exonIntervalFields:[{index:12,name:"start"},{index:13,name:"end"}]},row:{field:"strand",type:"nominal",domain:["+","-"]},color:{field:"strand",type:"nominal",domain:["+","-"],range:["#7585FF","#FF8A85"]},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}],opacity:{value:.8},dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["-"]}],mark:"triangleLeft",x:{field:"start",type:"genomic"},size:{value:15},style:{align:"right"}},{data:{url:tC,type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:5,name:"strand",type:"nominal"},{index:3,name:"name",type:"nominal"}],exonIntervalFields:[{index:12,name:"start"},{index:13,name:"end"}]},row:{field:"strand",type:"nominal",domain:["+","-"]},color:{field:"strand",type:"nominal",domain:["+","-"],range:["#7585FF","#FF8A85"]},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}],opacity:{value:.8},dataTransform:[{type:"filter",field:"type",oneOf:["exon"]}],mark:"rect",x:{field:"start",type:"genomic"},size:{value:15},xe:{field:"end",type:"genomic"}},{data:{url:tC,type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:5,name:"strand",type:"nominal"},{index:3,name:"name",type:"nominal"}],exonIntervalFields:[{index:12,name:"start"},{index:13,name:"end"}]},row:{field:"strand",type:"nominal",domain:["+","-"]},color:{field:"strand",type:"nominal",domain:["+","-"],range:["#7585FF","#FF8A85"]},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}],opacity:{value:.8},dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["+"]}],mark:"rule",x:{field:"start",type:"genomic"},strokeWidth:{value:3},xe:{field:"end",type:"genomic"},style:{linePattern:{type:"triangleRight",size:5}}},{data:{url:tC,type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:5,name:"strand",type:"nominal"},{index:3,name:"name",type:"nominal"}],exonIntervalFields:[{index:12,name:"start"},{index:13,name:"end"}]},row:{field:"strand",type:"nominal",domain:["+","-"]},color:{field:"strand",type:"nominal",domain:["+","-"],range:["#7585FF","#FF8A85"]},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}],opacity:{value:.8},dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["-"]}],mark:"rule",x:{field:"start",type:"genomic"},strokeWidth:{value:3},xe:{field:"end",type:"genomic"},style:{linePattern:{type:"triangleLeft",size:5}}}],width:700,height:100}]},{tracks:[{data:{url:"https://server.gosling-lang.org/api/v1/tileset_info/?d=clinvar-beddb",type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:7,name:"significance",type:"nominal"}]},displacement:{type:"pile",padding:3.5},mark:"point",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},size:{value:3},color:{field:"significance",type:"nominal",domain:["Pathogenic","Pathogenic/Likely_pathogenic","Likely_pathogenic","Uncertain_significance","Likely_benign","Benign/Likely_benign","Benign"],range:["#CB3B8C","#CB71A3","#CB96B3","gray","#029F73","#5A9F8C","#5A9F8C"],legend:!0},width:700,height:260}]}],style:{outlineWidth:0}},FC={arrangement:"vertical",views:[{static:!0,layout:"circular",alignment:"stack",tracks:[{alignment:"overlay",data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"],binSize:4},x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{field:"peak",type:"quantitative"},row:{field:"sample",type:"nominal"},color:{field:"sample",type:"nominal"},stroke:{value:"black"},strokeWidth:{value:.3},tracks:[{mark:"bar"},{mark:"brush",x:{linkingId:"detail-1"},color:{value:"blue"}},{mark:"brush",x:{linkingId:"detail-2"},color:{value:"red"}}],style:{outlineWidth:0},width:500,height:100},{data:{type:"csv",url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/rearrangements.bulk.1639.simple.filtered.pub",headerNames:["chr1","p1s","p1e","chr2","p2s","p2e","type","id","f1","f2","f3","f4","f5","f6"],separator:"\t",genomicFieldsToConvert:[{chromosomeField:"chr1",genomicFields:["p1s","p1e"]},{chromosomeField:"chr2",genomicFields:["p2s","p2e"]}]},dataTransform:[{type:"filter",field:"chr1",oneOf:["1","16","14","9","6","5","3"]},{type:"filter",field:"chr2",oneOf:["1","16","14","9","6","5","3"]}],mark:"withinLink",x:{field:"p1s",type:"genomic"},xe:{field:"p1e",type:"genomic"},x1:{field:"p2s",type:"genomic"},x1e:{field:"p2e",type:"genomic"},stroke:{field:"type",type:"nominal",domain:["deletion","inversion","translocation","tandem-duplication"]},strokeWidth:{value:.8},opacity:{value:.15},width:500,height:100}]},{spacing:10,arrangement:"horizontal",views:[{tracks:[{data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"],binSize:4},mark:"bar",x:{field:"start",type:"genomic",linkingId:"detail-1",domain:{chromosome:"5"}},xe:{field:"end",type:"genomic"},y:{field:"peak",type:"quantitative"},row:{field:"sample",type:"nominal"},color:{field:"sample",type:"nominal"},stroke:{value:"black"},strokeWidth:{value:.3},style:{background:"blue"},width:245,height:150}]},{tracks:[{data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"],binSize:4},mark:"bar",x:{field:"start",type:"genomic",domain:{chromosome:"16"},linkingId:"detail-2"},xe:{field:"end",type:"genomic"},y:{field:"peak",type:"quantitative"},row:{field:"sample",type:"nominal"},color:{field:"sample",type:"nominal",legend:!0},stroke:{value:"black"},strokeWidth:{value:.3},style:{background:"red"},width:245,height:150}]}],style:{backgroundOpacity:.1}}]},kC={url:tC,type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:5,name:"strand",type:"nominal"},{index:3,name:"name",type:"nominal"}],exonIntervalFields:[{index:12,name:"start"},{index:13,name:"end"}]},vC={alignment:"overlay",title:"HiGlass",data:kC,tracks:[{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["+"]}],mark:"triangleRight",x:{field:"end",type:"genomic",domain:undefined,axis:"top"},size:{value:15}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]}],mark:"text",text:{field:"name",type:"nominal"},x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},style:{dy:-15}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["-"]}],mark:"triangleLeft",x:{field:"start",type:"genomic"},size:{value:15},style:{align:"right"}},{dataTransform:[{type:"filter",field:"type",oneOf:["exon"]}],mark:"rect",x:{field:"start",type:"genomic"},size:{value:15},xe:{field:"end",type:"genomic"}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["+"]}],mark:"rule",x:{field:"start",type:"genomic"},strokeWidth:{value:3},xe:{field:"end",type:"genomic"},style:{linePattern:{type:"triangleRight",size:5}}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["-"]}],mark:"rule",x:{field:"start",type:"genomic"},strokeWidth:{value:3},xe:{field:"end",type:"genomic"},style:{linePattern:{type:"triangleLeft",size:5}}}],row:{field:"strand",type:"nominal",domain:["+","-"]},color:{field:"strand",type:"nominal",domain:["+","-"],range:["#7585FF","#FF8A85"]},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}],opacity:{value:.8},width:350,height:100},NC={higlass:vC,igv:{alignment:"overlay",title:"IGV",data:kC,tracks:[{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]}],mark:"text",text:{field:"name",type:"nominal"},x:{field:"start",type:"genomic",domain:undefined,axis:"top"},xe:{field:"end",type:"genomic"}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]}],mark:"rect",x:{field:"start",type:"genomic",axis:"top"},size:{value:15},xe:{field:"end",type:"genomic"}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["-"]}],mark:"rule",x:{field:"start",type:"genomic",axis:"top"},strokeWidth:{value:0},xe:{field:"end",type:"genomic"},color:{value:"white"},opacity:{value:.6},style:{linePattern:{type:"triangleLeft",size:10}}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["+"]}],mark:"rule",x:{field:"start",type:"genomic",axis:"top"},strokeWidth:{value:0},xe:{field:"end",type:"genomic"},color:{value:"white"},opacity:{value:.6},style:{linePattern:{type:"triangleRight",size:10}}}],row:{field:"strand",type:"nominal",domain:["+","-"]},color:{value:"#0900B1"},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}],width:350,height:100},cyverse:{alignment:"overlay",title:"Cyverse-QUBES",data:kC,tracks:[{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]}],mark:"text",text:{field:"name",type:"nominal"},x:{field:"start",type:"genomic",domain:undefined},xe:{field:"end",type:"genomic"},color:{value:"black"}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["+"]}],mark:"triangleRight",x:{field:"end",type:"genomic",axis:"top"},color:{value:"#999999"}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["-"]}],mark:"triangleLeft",x:{field:"start",type:"genomic",axis:"top"},color:{value:"#999999"},style:{align:"right"}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]}],mark:"rect",x:{field:"start",type:"genomic",axis:"top"},xe:{field:"end",type:"genomic"},color:{value:"lightgray"}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]}],mark:"rule",x:{field:"start",type:"genomic",axis:"top"},strokeWidth:{value:5},xe:{field:"end",type:"genomic"},color:{value:"gray"}},{dataTransform:[{type:"filter",field:"type",oneOf:["exon"]}],mark:"rect",x:{field:"start",type:"genomic",axis:"top"},xe:{field:"end",type:"genomic"},color:{value:"#E2A6F5"},stroke:{value:"#BB57C9"},strokeWidth:{value:1}}],row:{field:"strand",type:"nominal",domain:["+","-"]},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}],size:{value:15},width:350,height:100},gmgdb:{alignment:"overlay",title:"GmGDV",data:kC,tracks:[{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]}],mark:"text",text:{field:"name",type:"nominal"},x:{field:"start",type:"genomic",domain:undefined,axis:"top"},xe:{field:"end",type:"genomic"},style:{dy:-14}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["+"]}],mark:"triangleRight",x:{field:"end",type:"genomic",axis:"top"},size:{value:15}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["-"]}],mark:"triangleLeft",x:{field:"start",type:"genomic",axis:"top"},size:{value:15},style:{align:"right"}},{dataTransform:[{type:"filter",field:"type",oneOf:["exon"]}],mark:"rect",x:{field:"start",type:"genomic",axis:"top"},size:{value:10},xe:{field:"end",type:"genomic"}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]}],mark:"rule",x:{field:"start",type:"genomic",axis:"top"},strokeWidth:{value:3},xe:{field:"end",type:"genomic"}}],row:{field:"strand",type:"nominal",domain:["+","-"]},color:{field:"strand",type:"nominal",domain:["+","-"],range:["blue","red"]},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}],width:350,height:100},give:{alignment:"overlay",title:"GIVE",data:kC,tracks:[{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["+"]}],mark:"rect",x:{field:"end",type:"genomic",axis:"top"},size:{value:7}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["-"]}],mark:"rect",x:{field:"start",type:"genomic"},size:{value:7}},{dataTransform:[{type:"filter",field:"type",oneOf:["exon"]}],mark:"rect",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},size:{value:14}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]}],mark:"rule",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},strokeWidth:{value:3}}],row:{field:"strand",type:"nominal",domain:["+","-"]},color:{value:"#4050B4"},width:350,height:100},corces:{alignment:"overlay",title:"Corces et al.",data:kC,tracks:[{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["+"]}],mark:"text",text:{field:"name",type:"nominal"},x:{field:"start",type:"genomic",domain:undefined},xe:{field:"end",type:"genomic"},size:{value:8},style:{textFontSize:8,dy:-12}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["-"]}],mark:"text",text:{field:"name",type:"nominal"},x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},size:{value:8},style:{textFontSize:8,dy:10}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["+"]}],mark:"rect",x:{field:"end",type:"genomic"},size:{value:7}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["-"]}],mark:"rect",x:{field:"start",type:"genomic"},size:{value:7}},{dataTransform:[{type:"filter",field:"type",oneOf:["exon"]}],mark:"rect",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},size:{value:14}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]}],mark:"rule",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},strokeWidth:{value:3}}],row:{field:"strand",type:"nominal",domain:["+","-"]},color:{field:"strand",type:"nominal",domain:["+","-"],range:["#012DB8","#BE1E2C"]},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}],width:350,height:100},g6:{alignment:"overlay",data:kC,tracks:[{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]}],mark:"text",text:{field:"name",type:"nominal"},x:{field:"start",type:"genomic",domain:undefined,axis:"top"},xe:{field:"end",type:"genomic"},style:{dy:-14}},{dataTransform:[{type:"filter",field:"type",oneOf:["exon"]}],mark:"rect",x:{field:"start",type:"genomic",axis:"top"},size:{value:10},xe:{field:"end",type:"genomic"}},{dataTransform:[{type:"filter",field:"type",oneOf:["intron"]}],mark:"rule",x:{field:"start",type:"genomic",axis:"top"},strokeWidth:{value:2},xe:{field:"end",type:"genomic"},style:{curve:"top"}}],row:{field:"strand",type:"nominal",domain:["+","-"]},color:{value:"#B54F4A"},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}],width:350,height:100},g7:{alignment:"overlay",data:kC,tracks:[{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]}],mark:"text",text:{field:"name",type:"nominal"},x:{field:"start",type:"genomic",domain:undefined,axis:"top"},color:{value:"black"},xe:{field:"end",type:"genomic"}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]}],mark:"rect",x:{field:"start",type:"genomic",axis:"top"},xe:{field:"end",type:"genomic"},color:{value:"#666666"}},{dataTransform:[{type:"filter",field:"type",oneOf:["exon"]}],mark:"rect",x:{field:"start",type:"genomic",axis:"top"},xe:{field:"end",type:"genomic"},color:{value:"#FF6666"}},{dataTransform:[{type:"filter",field:"type",oneOf:["intron"]}],mark:"rect",x:{field:"start",type:"genomic",axis:"top"},xe:{field:"end",type:"genomic"},color:{value:"#99FEFF"}}],size:{value:30},row:{field:"strand",type:"nominal",domain:["+","-"]},stroke:{value:"#777777"},strokeWidth:{value:1},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}],width:350,height:100}},fC={layout:"linear",xDomain:{chromosome:"3",interval:[52168e3,5289e4]},arrangement:"horizontal",views:[{arrangement:"vertical",views:[NC.higlass,NC.corces,NC.igv]},{arrangement:"vertical",views:[NC.cyverse,NC.gmgdb,NC.g7]}]},zC={xDomain:{chromosome:"3",interval:[1014e4,1016e4]},centerRadius:.1,layout:"linear",spacing:0,alignment:"stack",tracks:[NC.higlass,{alignment:"overlay",data:{url:nC,type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:7,name:"significance",type:"nominal"}]},tracks:[{mark:"bar",x:{field:"start",type:"genomic"},y:{field:"significance",type:"nominal",domain:["Pathogenic","Pathogenic/Likely_pathogenic","Likely_pathogenic","Uncertain_significance","Likely_benign","Benign/Likely_benign","Benign"],baseline:"Uncertain_significance",range:[150,20]},size:{value:1},color:{value:"lightgray"},stroke:{value:"lightgray"},strokeWidth:{value:1},opacity:{value:.3},visibility:[{measure:"zoomLevel",target:"mark",threshold:1e5,operation:"LT",transitionPadding:1e5}]},{mark:"point",x:{field:"start",type:"genomic"},row:{field:"significance",type:"nominal",domain:["Pathogenic","Pathogenic/Likely_pathogenic","Likely_pathogenic","Uncertain_significance","Likely_benign","Benign/Likely_benign","Benign"]},size:{value:7},opacity:{value:.8},visibility:[{measure:"zoomLevel",target:"mark",threshold:1e6,operation:"LT",transitionPadding:1e6}]},{data:{url:VC,type:"multivec",row:"significance",column:"position",value:"count",categories:["Benign","Benign/Likely_benign","Likely_benign","Uncertain_significance","Likely_pathogenic","Pathogenic/Likely_pathogenic","Pathogenic"],binSize:4},mark:"bar",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{field:"count",type:"quantitative",axis:"none"},color:{field:"significance",type:"nominal",domain:["Pathogenic","Pathogenic/Likely_pathogenic","Likely_pathogenic","Uncertain_significance","Likely_benign","Benign/Likely_benign","Benign"],range:["#CB3B8C","#CB71A3","#CB96B3","gray","#029F73","#5A9F8C","#5A9F8C"],legend:!0},visibility:[{measure:"zoomLevel",target:"mark",threshold:5e5,operation:"GT",transitionPadding:5e5}]}],color:{field:"significance",type:"nominal",domain:["Pathogenic","Pathogenic/Likely_pathogenic","Likely_pathogenic","Uncertain_significance","Likely_benign","Benign/Likely_benign","Benign"],range:["#CB3B8C","#CB71A3","#CB96B3","gray","#029F73","#5A9F8C","#5A9F8C"]},width:800,height:150}]},xC={sequence:{alignment:"overlay",data:{url:sC,type:"multivec",row:"base",column:"position",value:"count",categories:["A","T","G","C"],start:"start",end:"end"},tracks:[{mark:"bar",y:{field:"count",type:"quantitative",axis:"none"}},{dataTransform:[{type:"filter",field:"count",oneOf:[0],not:!0}],mark:"text",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},size:{value:24},color:{value:"white"},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:30,target:"mark"},{operation:"LT",measure:"zoomLevel",threshold:10,target:"track"}]}],x:{field:"position",type:"genomic"},color:{field:"base",type:"nominal",domain:["A","T","G","C"],legend:!0},text:{field:"base",type:"nominal"},style:{textFontWeight:"bold"},width:400,height:80},cytoband:{alignment:"overlay",data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/UCSC.HG38.Human.CytoBandIdeogram.csv",type:"csv",chromosomeField:"Chromosome",genomicFields:["chromStart","chromEnd"]},tracks:[{mark:"rect",color:{field:"Chromosome",type:"nominal",domain:["chr1","chr2","chr3","chr4","chr5","chr6","chr7","chr8","chr9","chr10","chr11","chr12","chr13","chr14","chr15","chr16","chr17","chr18","chr19","chr20","chr21","chr22","chrX","chrY"],range:["#F6F6F6","gray"]},x:{field:"chromStart",type:"genomic",aggregate:"min"},xe:{field:"chromEnd",aggregate:"max",type:"genomic"},strokeWidth:{value:2},stroke:{value:"gray"},visibility:[{operation:"greater-than",measure:"zoomLevel",threshold:1e8,target:"mark",transitionPadding:1e8}]},{mark:"text",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen"],not:!0}],text:{field:"Name",type:"nominal"},color:{field:"Stain",type:"nominal",domain:["gneg","gpos25","gpos50","gpos75","gpos100","gvar"],range:["black","black","black","black","white","black"]},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}]},{mark:"rect",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen"],not:!0}],color:{field:"Stain",type:"nominal",domain:["gneg","gpos25","gpos50","gpos75","gpos100","gvar"],range:["white","#D9D9D9","#979797","#636363","black","#A0A0F2"]}},{mark:"triangleRight",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen"]},{type:"filter",field:"Name",include:"q"}],color:{value:"#B40101"}},{mark:"triangleLeft",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen"]},{type:"filter",field:"Name",include:"p"}],color:{value:"#B40101"}}],x:{field:"chromStart",type:"genomic"},xe:{field:"chromEnd",type:"genomic"},size:{value:20},stroke:{value:"gray"},strokeWidth:{value:.5},visibility:[{operation:"greater-than",measure:"width",threshold:3,transitionPadding:5,target:"mark"}],style:{outline:"white"},width:400,height:25}},UC={arrangement:"vertical",views:[e(Z({layout:"linear",xDomain:{chromosome:"1",interval:[3e6,3000010]}},xC.sequence),{width:800,height:100})]},MC={arrangement:"vertical",views:[e(Z({},zC),{xDomain:{chromosome:"13",interval:[315e5,3315e4]}}),e(Z({},zC),{xDomain:{chromosome:"13",interval:[32e6,327e5]}}),e(Z({},zC),{xDomain:{chromosome:"13",interval:[32314e3,32402500]}})]},LC={alignment:"overlay",title:"NC_045512.2 Genes",data:{type:"csv",url:"https://s3.amazonaws.com/gosling-lang.org/data/COVID/NC_045512.2-Genes.csv",genomicFields:["Start","Stop"]},tracks:[{mark:"rect",color:{value:"#0072B2"},stroke:{value:"white"},strokeWidth:{value:2}},{mark:"rule",color:{value:"white"},opacity:{value:.6},strokeWidth:{value:0},style:{linePattern:{type:"triangleRight",size:10}}},{mark:"text",text:{field:"Gene symbol",type:"nominal"},color:{value:"black"},stroke:{value:"white"},strokeWidth:{value:3},visibility:[{target:"mark",measure:"width",threshold:"|xe-x|",operation:"LTET",transitionPadding:30}]}],x:{field:"Start",type:"genomic"},xe:{field:"Stop",type:"genomic"},width:800,height:30},TC={title:"SARS-CoV-2",subtitle:"Data Source: WashU Virus Genome Browser, NCBI, GISAID",assembly:"unknown",layout:"linear",spacing:50,views:[e(Z({},LC),{static:!0,layout:"linear",xDomain:{interval:[1,29903]},tracks:[...LC.tracks,{mark:"brush",x:{linkingId:"detail"}}]}),{centerRadius:0,xDomain:{interval:[1,29903]},linkingId:"detail",alignment:"stack",tracks:[{alignment:"overlay",title:"S Protein Annotation",data:{type:"csv",url:"https://s3.amazonaws.com/gosling-lang.org/data/COVID/sars-cov-2_Sprot_annot_sorted.bed",genomicFields:["Start","Stop"]},tracks:[{mark:"rect",color:{field:"Protein",type:"nominal",domain:["receptor-binding domain (RBD)","receptor-binding motif (RBM)","S1/S2 cleavage site","heptad repeat 1 (HR1)","heptad repeat 2 (HR2)"]},xe:{field:"Stop",type:"genomic"}},{mark:"text",text:{field:"Protein",type:"nominal"},color:{value:"#333"},stroke:{value:"white"},strokeWidth:{value:3},style:{textAnchor:"end"}}],x:{field:"Start",type:"genomic"},row:{field:"Protein",type:"nominal",domain:["receptor-binding domain (RBD)","receptor-binding motif (RBM)","S1/S2 cleavage site","heptad repeat 1 (HR1)","heptad repeat 2 (HR2)"]},width:800,height:80},LC,e(Z({title:"NC_045512.2 Sequence"},xC.sequence),{data:e(Z({},xC.sequence.data),{url:"https://server.gosling-lang.org/api/v1/tileset_info/?d=NC_045512_2-multivec"}),style:{inlineLegend:!0},width:800,height:40}),{title:"TRS-L-Dependent Recombination Events",data:{type:"csv",url:"https://s3.amazonaws.com/gosling-lang.org/data/COVID/TRS-L-dependent_recombinationEvents_sorted.bed",genomicFields:["Start1","Stop1","Start2","Stop2"],sampleLength:100},mark:"withinLink",x:{field:"Start1",type:"genomic"},xe:{field:"Stop1",type:"genomic"},x1:{field:"Start2",type:"genomic"},x1e:{field:"Stop2",type:"genomic"},stroke:{value:"#0072B2"},color:{value:"#0072B2"},opacity:{value:.1},width:800,height:400}]}]},DC={title:"Between Links in Circular Layouts with Parallel Arrangements",layout:"circular",static:!0,spacing:.01,centerRadius:.3,alignment:"stack",tracks:[{data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1"],binSize:1},mark:"bar",x:{field:"start",type:"genomic",axis:"top"},xe:{field:"end",type:"genomic",axis:"top"},y:{field:"peak",type:"quantitative",axis:"right"},color:{value:"lightgray"},width:700,height:60},{data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/UCSC.HG38.Human.CytoBandIdeogram.csv",type:"csv",chromosomeField:"Chromosome",genomicFields:["chromStart","chromEnd"]},mark:"rect",color:{field:"Stain",type:"nominal",domain:["gneg","gpos25","gpos50","gpos75","gpos100","gvar","acen"],range:["white","#D9D9D9","#979797","#636363","black","#F0F0F0","#8D8D8D"]},x:{field:"chromStart",type:"genomic"},xe:{field:"chromEnd",type:"genomic"},stroke:{value:"black"},strokeWidth:{value:.5},width:700,height:30},{alignment:"overlay",data:{url:"https://raw.githubusercontent.com/vigsterkr/circos/master/data/5/segdup.txt",type:"csv",headerNames:["id","chr","p1","p2"],chromosomePrefix:"hs",chromosomeField:"chr",genomicFields:["p1","p2"],separator:" ",longToWideId:"id",sampleLength:5e3},opacity:{value:.1},tracks:[{dataTransform:[{type:"filter",field:"chr",oneOf:["hs1"],not:!0}],mark:"betweenLink",x:{field:"p2_2",type:"genomic"},xe:{field:"p1",type:"genomic"},stroke:{value:"lightgray"},strokeWidth:{value:1}},{dataTransform:[{type:"filter",field:"chr",oneOf:["hs1"]}],mark:"betweenLink",x:{field:"p2_2",type:"genomic"},xe:{field:"p1",type:"genomic"},stroke:{value:"black"},strokeWidth:{value:1}}],width:1e3,height:300},{data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/UCSC.HG38.Human.CytoBandIdeogram.csv",type:"csv",chromosomeField:"Chromosome",genomicFields:["chromStart","chromEnd"]},mark:"rect",color:{field:"Stain",type:"nominal",domain:["gneg","gpos25","gpos50","gpos75","gpos100","gvar","acen"],range:["white","#D9D9D9","#979797","#636363","black","#F0F0F0","#8D8D8D"]},x:{field:"chromStart",type:"genomic"},xe:{field:"chromEnd",type:"genomic"},stroke:{value:"black"},strokeWidth:{value:.5},width:700,height:30}]},QC={title:"Single-cell Epigenomic Analysis",subtitle:"Corces et al. 2020",static:!0,layout:"linear",arrangement:"vertical",views:[{layout:"linear",xDomain:{chromosome:"3"},centerRadius:.8,tracks:[{alignment:"overlay",title:"chr3",data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/cytogenetic_band.csv",type:"csv",chromosomeField:"Chr.",genomicFields:["ISCN_start","ISCN_stop","Basepair_start","Basepair_stop"],quantitativeFields:["Band","Density"]},tracks:[{mark:"rect",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen-1","acen-2"],not:!0}],color:{field:"Density",type:"nominal",domain:["","25","50","75","100"],range:["white","#D9D9D9","#979797","#636363","black"]},size:{value:20}},{mark:"rect",dataTransform:[{type:"filter",field:"Stain",oneOf:["gvar"]}],color:{value:"#A0A0F2"},size:{value:20}},{mark:"triangleRight",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen-1"]}],color:{value:"#B40101"},size:{value:20}},{mark:"triangleLeft",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen-2"]}],color:{value:"#B40101"},size:{value:20}},{mark:"brush",x:{linkingId:"detail"},color:{value:"red"},opacity:{value:1},strokeWidth:{value:1},stroke:{value:"red"}}],x:{field:"Basepair_start",type:"genomic",axis:"none"},xe:{field:"Basepair_stop",type:"genomic"},stroke:{value:"black"},strokeWidth:{value:1},style:{outlineWidth:0},width:400,height:25}]},{xDomain:{chromosome:"3",interval:[52168e3,5289e4]},linkingId:"detail",mark:"bar",x:{field:"position",type:"genomic"},y:{field:"peak",type:"quantitative",axis:"right"},style:{outline:"#20102F"},width:400,height:40,tracks:[{data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/ExcitatoryNeurons-insertions_bin100_RIPnorm.bw",type:"bigwig",column:"position",value:"peak"},title:"Excitatory neurons",color:{value:"#F29B67"}},{data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/InhibitoryNeurons-insertions_bin100_RIPnorm.bw",type:"bigwig",column:"position",value:"peak"},title:"Inhibitory neurons",color:{value:"#3DC491"}},{data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/DopaNeurons_Cluster10_AllFrags_projSUNI2_insertions_bin100_RIPnorm.bw",type:"bigwig",column:"position",value:"peak"},title:"Dopaminergic neurons",mark:"bar",color:{value:"#565C8B"}},{data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/Microglia-insertions_bin100_RIPnorm.bw",type:"bigwig",column:"position",value:"peak"},title:"Microglia",color:{value:"#77C0FA"}},{data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/Oligodendrocytes-insertions_bin100_RIPnorm.bw",type:"bigwig",column:"position",value:"peak"},title:"Oligodendrocytes",mark:"bar",color:{value:"#9B46E5"}},{data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/Astrocytes-insertions_bin100_RIPnorm.bw",type:"bigwig",column:"position",value:"peak"},title:"Astrocytes",mark:"bar",color:{value:"#D73636"}},{data:{url:"https://s3.amazonaws.com/gosling-lang.org/data/OPCs-insertions_bin100_RIPnorm.bw",type:"bigwig",column:"position",value:"peak"},title:"OPCs",mark:"bar",color:{value:"#E38ADC"}},{alignment:"overlay",title:"Genes",data:{url:tC,type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:5,name:"strand",type:"nominal"},{index:3,name:"name",type:"nominal"}],exonIntervalFields:[{index:12,name:"start"},{index:13,name:"end"}]},style:{outline:"#20102F"},tracks:[{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["+"]}],mark:"text",text:{field:"name",type:"nominal"},x:{field:"start",type:"genomic"},size:{value:8},xe:{field:"end",type:"genomic"},style:{textFontSize:8,dy:-12}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["-"]}],mark:"text",text:{field:"name",type:"nominal"},x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},size:{value:8},style:{textFontSize:8,dy:10}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["+"]}],mark:"rect",x:{field:"end",type:"genomic"},size:{value:7}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["-"]}],mark:"rect",x:{field:"start",type:"genomic"},size:{value:7}},{dataTransform:[{type:"filter",field:"type",oneOf:["exon"]}],mark:"rect",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},size:{value:14}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]}],mark:"rule",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},strokeWidth:{value:3}}],row:{field:"strand",type:"nominal",domain:["+","-"]},color:{field:"strand",type:"nominal",domain:["+","-"],range:["#012DB8","#BE1E2C"]},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}],width:400,height:80},{data:{url:"https://server.gosling-lang.org/api/v1/tileset_info/?d=oligodendrocyte-plac-seq-bedpe",type:"beddb",genomicFields:[{name:"start",index:1},{name:"end",index:2}]},mark:"withinLink",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{flip:!0},strokeWidth:{value:1},color:{value:"none"},stroke:{value:"#F97E2A"},opacity:{value:.1},width:400,height:60},{data:{url:"https://server.gosling-lang.org/api/v1/tileset_info/?d=microglia-plac-seq-bedpe",type:"beddb",genomicFields:[{name:"start",index:1},{name:"end",index:2}]},mark:"withinLink",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{flip:!0},strokeWidth:{value:1},color:{value:"none"},stroke:{value:"#50ADF9"},opacity:{value:.1},overlayOnPreviousTrack:!0,width:400,height:60},{title:"PLAC-seq (H3K4me3) Nott et al.",data:{url:"https://server.gosling-lang.org/api/v1/tileset_info/?d=neuron-plac-seq-bedpe",type:"beddb",genomicFields:[{name:"start",index:1},{name:"end",index:2}]},mark:"withinLink",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{flip:!0},strokeWidth:{value:1},color:{value:"none"},stroke:{value:"#7B0EDC"},opacity:{value:.1},overlayOnPreviousTrack:!0,width:400,height:60}]}]},OC={alignment:"overlay",data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/cytogenetic_band.csv",type:"csv",chromosomeField:"Chr.",genomicFields:["ISCN_start","ISCN_stop","Basepair_start","Basepair_stop"],quantitativeFields:["Band","Density"]},tracks:[{mark:"text",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen-1","acen-2"],not:!0}],text:{field:"Band",type:"nominal"},color:{value:"black"},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}]},{mark:"rect",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen-1","acen-2"],not:!0}],color:{field:"Density",type:"nominal",domain:["","25","50","75","100"],range:["white","#D9D9D9","#979797","#636363","black"]}},{mark:"rect",dataTransform:[{type:"filter",field:"Stain",oneOf:["gvar"]}],color:{value:"#A0A0F2"}},{mark:"triangleRight",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen-1"]}],color:{value:"#B40101"}},{mark:"triangleLeft",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen-2"]}],color:{value:"#B40101"}}],x:{field:"Basepair_start",type:"genomic"},xe:{field:"Basepair_stop",type:"genomic"},stroke:{value:"gray"},strokeWidth:{value:.5},width:600,height:20},PC={data:{url:bC,type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"]},mark:"area",x:{field:"position",type:"genomic"},y:{field:"peak",type:"quantitative"},color:{field:"sample",type:"nominal"},width:600,height:30},jC={static:!0,layout:"linear",centerRadius:.2,arrangement:"parallel",views:[{xDomain:{chromosome:"1"},tracks:[e(Z({},PC),{width:1e3}),e(Z({},OC),{width:1e3})]},{xDomain:{chromosome:"2"},tracks:[e(Z({},PC),{width:970}),e(Z({},OC),{width:970})]},{xDomain:{chromosome:"3"},tracks:[e(Z({},PC),{width:800}),e(Z({},OC),{width:800})]},{xDomain:{chromosome:"4"},tracks:[e(Z({},PC),{width:770}),e(Z({},OC),{width:770})]},{xDomain:{chromosome:"5"},tracks:[e(Z({},PC),{width:740}),e(Z({},OC),{width:740})]}]},EC={title:"Track Template In Gosling.js",subtitle:"Gosling.js enables track templates! This allows to create complex visualization more easily.",spacing:0,layout:"linear",centerRadius:.5,style:{enableSmoothPath:!0},views:[{xDomain:{chromosome:"3",interval:[52168e3,5289e4]},tracks:[{template:"gene",data:{url:tC,type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:5,name:"strand",type:"nominal"},{index:3,name:"name",type:"nominal"}],exonIntervalFields:[{index:12,name:"start"},{index:13,name:"end"}]},encoding:{startPosition:{field:"start"},endPosition:{field:"end"},strandColor:{field:"strand",range:["gray"]},strandRow:{field:"strand"},opacity:{value:.4},geneHeight:{value:30},geneLabel:{field:"name"},geneLabelFontSize:{value:30},geneLabelColor:{field:"strand",range:["gray"]},geneLabelStroke:{value:"white"},geneLabelStrokeThickness:{value:4},geneLabelOpacity:{value:1},type:{field:"type"}},width:800,height:300}]},{xDomain:{chromosome:"1",interval:[77925299,77925320]},tracks:[{template:"sequence",data:{url:sC,type:"multivec",row:"base",column:"position",value:"count",categories:["A","T","G","C"],start:"start",end:"end"},encoding:{barLength:{field:"count",type:"quantitative"},baseBackground:{field:"base",type:"nominal"},baseLabelColor:{field:"base",type:"nominal"},position:{field:"position",type:"genomic"},startPosition:{field:"start",type:"genomic"},endPosition:{field:"end",type:"genomic"}},width:800,height:100}]},{xDomain:{chromosome:"1"},tracks:[{template:"ideogram",data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/UCSC.HG38.Human.CytoBandIdeogram.csv",type:"csv",chromosomeField:"Chromosome",genomicFields:["chromStart","chromEnd"]},encoding:{startPosition:{field:"chromStart"},endPosition:{field:"chromEnd"},stainBackgroundColor:{field:"Stain"},stainLabelColor:{field:"Stain"},name:{field:"Name"},stainStroke:{value:"black"}},width:800,height:60}]}]},qC={url:"https://resgen.io/api/v1/tileset_info/?d=UvVPeLHuRDiYA3qwFlm7xQ",type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1"]},_C=(g,I,C=0,A=!0)=>({title:`Basic Marks: ${g}`,subtitle:"Tutorial Examples",tracks:[e(Z({layout:"linear",width:800,height:180,data:I,mark:g},A?{x:{field:"position",type:"genomic",axis:"bottom"}}:{x:{field:"start",type:"genomic",axis:"bottom"},xe:{field:"end",type:"genomic"}}),{y:{field:"peak",type:"quantitative",axis:"right"},size:C>0?{value:C}:{field:"peak",type:"quantitative"}})]}),$C=_C("area",qC,2),gA=_C("line",qC,2),IA=_C("point",qC,0),CA=_C("bar",e(Z({},qC),{binSize:5}),5,!1),AA={title:"Example: Brushing and Linking",layout:"linear",tracks:[{width:800,height:200,data:qC,mark:"line",x:{field:"position",type:"genomic",domain:{chromosome:"1"},axis:"top"},y:{field:"peak",type:"quantitative"},alignment:"overlay",tracks:[{},{mark:"brush",x:{linkingId:"linking-with-brush"},color:{value:"steelBlue"}}]},{width:800,height:200,data:qC,mark:"line",x:{field:"position",type:"genomic",domain:{chromosome:"1",interval:[2e8,22e7]},axis:"top",linkingId:"linking-with-brush"},y:{field:"peak",type:"quantitative"},opacity:{value:1},style:{background:"steelBlue",backgroundOpacity:.1}}]},lA={title:"Example: Semantic Zooming",subtitle:"Text marks that indicate base pairs will appear when zooming in",tracks:[e(Z({},xC.sequence),{width:800})]},iA={title:"Example: Semantic Zooming",subtitle:"Text and triangle marks will show when zooming in to provide more details",tracks:[e(Z({},xC.cytoband),{width:800})]},cA={DEBUG:{name:"DEBUG",spec:{title:"Between-Connectivity In 2D Tracks",subtitle:"Between-link examples with three types, i.e., straight, corner, and curve",xDomain:{interval:[0,1e9]},style:{outlineWidth:.5},spacing:10,views:[{arrangement:"horizontal",views:[{yOffset:250,spacing:10,orientation:"vertical",tracks:[{data:{url:"https://server.gosling-lang.org/api/v1/tileset_info/?d=cistrome-multivec",type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"],binSize:4},mark:"rect",x:{field:"start",type:"genomic",axis:"left"},xe:{field:"end",type:"genomic"},row:{field:"sample",type:"nominal",legend:!1},color:{field:"peak",type:"quantitative",legend:!1,range:"grey"},width:100,height:500},{data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/circos-segdup-edited.txt",type:"csv",chromosomeField:"c2",genomicFields:["s1","e1","s2","e2"]},style:{linkConnectionType:"corner"},mark:"withinLink",x:{field:"s1",type:"genomic",axis:"none"},xe:{field:"s2",type:"genomic"},flipY:!1,color:{value:"#3275B4"},size:{value:2},stroke:{value:"#3275B4"},opacity:{value:.2},width:100,height:500}]},{arrangement:"vertical",views:[{spacing:10,tracks:[{data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/circos-segdup-edited.txt",type:"csv",chromosomeField:"c2",genomicFields:["s1","e1","s2","e2"]},style:{linkConnectionType:"corner"},mark:"withinLink",x:{field:"s1",type:"genomic"},xe:{field:"s2",type:"genomic"},flipY:!1,color:{value:"#3275B4"},size:{value:2},stroke:{value:"#3275B4"},opacity:{value:.2},width:500,height:100},{data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/circos-segdup-edited.txt",type:"csv",chromosomeField:"c2",genomicFields:["s1","e1","s2","e2"]},style:{linkConnectionType:"corner"},mark:"withinLink",x:{field:"s1",type:"genomic"},xe:{field:"s2",type:"genomic"},flipY:!1,color:{value:"#3275B4"},size:{value:2},stroke:{value:"#3275B4"},opacity:{value:.2},width:500,height:100}]},{tracks:[{title:"Curved Connection",alignment:"overlay",data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/circos-segdup-edited.txt",type:"csv",chromosomeField:"c2",genomicFields:["s1","e1","s2","e2"]},style:{linkConnectionType:"corner"},tracks:[{mark:"betweenLink",x:{field:"s1",type:"genomic",axis:"none"},y:{field:"s2",type:"genomic",axis:"none"}},{mark:"betweenLink",y:{field:"s1",type:"genomic",axis:"none"},x:{field:"s2",type:"genomic",axis:"none"}},{mark:"point",x:{field:"s1",type:"genomic",axis:"none"},y:{field:"s2",type:"genomic",axis:"none"},opacity:{value:1}},{mark:"point",y:{field:"s1",type:"genomic",axis:"none"},x:{field:"s2",type:"genomic",axis:"none"},opacity:{value:1}}],color:{value:"#3275B4"},size:{value:1},stroke:{value:"#3275B4"},opacity:{value:.2},width:500,height:500}]}]},{xDomain:{interval:[0,1e9]},yOffset:250,spacing:10,orientation:"vertical",tracks:[{data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/circos-segdup-edited.txt",type:"csv",chromosomeField:"c2",genomicFields:["s1","e1","s2","e2"]},style:{linkConnectionType:"corner"},mark:"withinLink",x:{field:"s1",type:"genomic",axis:"none"},xe:{field:"s2",type:"genomic"},flipY:!0,color:{value:"#3275B4"},size:{value:2},stroke:{value:"#3275B4"},opacity:{value:.2},width:100,height:500},{data:{url:"https://server.gosling-lang.org/api/v1/tileset_info/?d=cistrome-multivec",type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"],binSize:4},mark:"rect",x:{field:"start",type:"genomic",axis:"right"},xe:{field:"end",type:"genomic"},row:{field:"sample",type:"nominal",legend:!1},color:{field:"peak",type:"quantitative",legend:!1,range:"rdbu"},width:100,height:500}]}]},{views:[{xOffset:250,spacing:10,tracks:[{data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/circos-segdup-edited.txt",type:"csv",chromosomeField:"c2",genomicFields:["s1","e1","s2","e2"]},style:{linkConnectionType:"corner"},mark:"withinLink",x:{field:"s1",type:"genomic",axis:"none"},xe:{field:"s2",type:"genomic"},flipY:!0,color:{value:"#3275B4"},size:{value:2},stroke:{value:"#3275B4"},opacity:{value:.2},width:500,height:100},{data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/circos-segdup-edited.txt",type:"csv",chromosomeField:"c2",genomicFields:["s1","e1","s2","e2"]},style:{linkConnectionType:"corner"},mark:"withinLink",x:{field:"s1",type:"genomic",axis:"bottom"},xe:{field:"s2",type:"genomic"},flipY:!0,color:{value:"#3275B4"},size:{value:2},stroke:{value:"#3275B4"},opacity:{value:.2},width:500,height:100}]}]}]},hidden:!0},VISUAL_ENCODING:{name:"Basic Example: Visual Encoding",spec:HC},VISUAL_ENCODING_CIRCULAR:{name:"Basic Example: Circular Visual Encoding",spec:uC},BAND:{name:"Basic Example: Band Connection",spec:{layout:"linear",xDomain:{chromosome:"1",interval:[1039e5,1041e5]},spacing:0,tracks:[{data:{type:"csv",url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/circos-segdup-edited.txt",chromosomeField:"c2",genomicFields:["s1","e1","s2","e2"]},mark:"rect",x:{field:"s1",type:"genomic"},xe:{field:"e1",type:"genomic"},stroke:{value:"#4C6629"},strokeWidth:{value:.8},tooltip:[{field:"s1",type:"genomic",alt:'<b style="color:green">Start Position</b>'},{field:"e1",type:"genomic",alt:'<b style="color:green">End Position</b>'}],opacity:{value:.15},color:{value:"#85B348"},width:500,height:16},{data:{type:"csv",url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/circos-segdup-edited.txt",chromosomeField:"c2",genomicFields:["s1","e1","s2","e2"]},mark:"betweenLink",x:{field:"s1",type:"genomic"},xe:{field:"e1",type:"genomic"},x1:{field:"s2",type:"genomic"},x1e:{field:"e2",type:"genomic"},stroke:{value:"#4C6629"},strokeWidth:{value:.8},opacity:{value:.15},color:{value:"#85B348"},style:{outlineWidth:0},width:500,height:100},{data:{type:"csv",url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/circos-segdup-edited.txt",chromosomeField:"c2",genomicFields:["s1","e1","s2","e2"]},mark:"rect",x:{field:"s2",type:"genomic"},xe:{field:"e2",type:"genomic"},stroke:{value:"#4C6629"},strokeWidth:{value:.8},tooltip:[{field:"s2",type:"genomic",alt:'<b style="color:green">Start Position</b>'},{field:"e2",type:"genomic",alt:'<b style="color:green">End Position</b>'}],opacity:{value:.15},color:{value:"#85B348"},width:500,height:16},{data:{type:"csv",url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/circos-segdup-edited.txt",chromosomeField:"c2",genomicFields:["s1","e1","s2","e2"]},mark:"betweenLink",x1:{field:"s1",type:"genomic"},x1e:{field:"e1",type:"genomic"},x:{field:"s2",type:"genomic"},xe:{field:"e2",type:"genomic"},stroke:{value:"#4C6629"},strokeWidth:{value:.8},opacity:{value:.15},color:{value:"#85B348"},style:{outlineWidth:0},width:500,height:100},{data:{type:"csv",url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/circos-segdup-edited.txt",chromosomeField:"c2",genomicFields:["s1","e1","s2","e2"]},mark:"rect",x:{field:"s1",type:"genomic"},xe:{field:"e1",type:"genomic"},stroke:{value:"#4C6629"},strokeWidth:{value:.8},tooltip:[{field:"s1",type:"genomic",alt:'<b style="color:green">Start Position</b>'},{field:"e1",type:"genomic",alt:'<b style="color:green">End Position</b>'}],opacity:{value:.15},color:{value:"#85B348"},width:500,height:16},{data:{type:"csv",url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/circos-segdup-edited.txt",chromosomeField:"c2",genomicFields:["s1","e1","s2","e2"]},mark:"betweenLink",x:{field:"s1",type:"genomic"},xe:{field:"e1",type:"genomic"},x1:{field:"s2",type:"genomic"},x1e:{field:"e2",type:"genomic"},stroke:{value:"#4C6629"},strokeWidth:{value:.8},opacity:{value:.15},color:{value:"#85B348"},style:{outlineWidth:0},width:500,height:100},{data:{type:"csv",url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/circos-segdup-edited.txt",chromosomeField:"c2",genomicFields:["s1","e1","s2","e2"]},mark:"rect",x:{field:"s2",type:"genomic"},xe:{field:"e2",type:"genomic"},stroke:{value:"#4C6629"},strokeWidth:{value:.8},tooltip:[{field:"s2",type:"genomic",alt:'<b style="color:green">Start Position</b>'},{field:"e2",type:"genomic",alt:'<b style="color:green">End Position</b>'}],opacity:{value:.15},color:{value:"#85B348"},width:500,height:16}]}},LINKING:{name:"Basic Example: Visual Linking",spec:JC},LAYOUT_AND_ARRANGEMENT_1:{name:"Basic Example: Layouts and Arrangements",spec:hC,hidden:!0},LAYOUT_AND_ARRANGEMENT_2:{name:"Layouts and Arrangements 2",spec:pC,hidden:!0},BASIC_SEMANTIC_ZOOM:{name:"Basic Example: Basic Idea of Semantic Zoom",spec:wC,hidden:!0},MARK_DISPLACEMENT:{name:"Basic Example: Mark Displacement",spec:SC},CIRCULAR_OVERVIEW_LINEAR_DETAIL:{name:"Basic Example: Circular Overview + Linear Detail Views",spec:FC},SEQUENCE:{name:"Multi-Scale Sequence Track",spec:UC},SEMANTIC_ZOOM:{name:"Multi-Scale Clinvar Lollipop Plot",spec:MC},CYTOBANDS:{name:"Ideograms",spec:jC},GENE_ANNOTATION:{name:"Custom Gene Annotation",spec:fC},MATRIX_HFFC6:{name:"Comparative Matrices (Micro-C vs. Hi-C)",spec:rC},CIRCOS:{name:"Circos",spec:{title:"Circos",description:"http://circos.ca/intro/genomic_data/",layout:"circular",static:!0,spacing:1,centerRadius:.3,alignment:"stack",tracks:[{data:{type:"vector",url:"https://resgen.io/api/v1/tileset_info/?d=VLFaiSVjTjW6mkbjRjWREA",column:"position",value:"peak"},mark:"bar",x:{field:"position",type:"genomic",axis:"top"},y:{field:"peak",type:"quantitative",axis:"right"},color:{value:"#EEEDA1"},width:700,height:60},{data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/UCSC.HG38.Human.CytoBandIdeogram.csv",type:"csv",chromosomeField:"Chromosome",genomicFields:["chromStart","chromEnd"]},mark:"rect",color:{field:"Stain",type:"nominal",domain:["gneg","gpos25","gpos50","gpos75","gpos100","gvar","acen"],range:["white","#D9D9D9","#979797","#636363","black","#F0F0F0","#8D8D8D"]},x:{field:"chromStart",type:"genomic"},xe:{field:"chromEnd",type:"genomic"},stroke:{value:"lightgray"},strokeWidth:{value:.5},width:700,height:30},{alignment:"overlay",data:{url:"https://raw.githubusercontent.com/vigsterkr/circos/master/data/5/segdup.txt",type:"csv",headerNames:["id","chr","p1","p2"],chromosomePrefix:"hs",chromosomeField:"chr",genomicFields:["p1","p2"],separator:" ",longToWideId:"id"},opacity:{value:.4},tracks:[{dataTransform:[{type:"filter",field:"chr",oneOf:["hs1"],not:!0}],mark:"withinLink",x:{field:"p1",type:"genomic"},xe:{field:"p1_2",type:"genomic"},x1:{field:"p2",type:"genomic"},x1e:{field:"P2_2",type:"genomic"},stroke:{value:"lightgray"},strokeWidth:{value:1}},{dataTransform:[{type:"filter",field:"chr",oneOf:["hs1"]}],mark:"withinLink",x:{field:"p1",type:"genomic"},xe:{field:"p1_2",type:"genomic"},x1:{field:"p2",type:"genomic"},x1e:{field:"P2_2",type:"genomic"},stroke:{field:"chr_2",type:"nominal",range:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"]},strokeWidth:{value:1.5}}],width:700,height:300}]}},"Circular Range":{name:"Circular Range (Inspired By Weather Radials)",spec:{layout:"circular",static:!0,spacing:1,centerRadius:.3,alignment:"stack",tracks:[{data:{type:"vector",url:"https://resgen.io/api/v1/tileset_info/?d=VLFaiSVjTjW6mkbjRjWREA",column:"position",value:"peak"},mark:"bar",x:{field:"position",type:"genomic",axis:"top"},y:{field:"peak",type:"quantitative"},color:{value:"#EEEDA1"},width:700,height:60}]},hidden:!0},SARS_COV_2:{name:"SARS-CoV-2",spec:TC},CORCES_ET_AL:{name:"Corces et al. 2020",spec:QC},SASHIMI_PLOT:{name:"Sashimi Plot",spec:{title:"Sashimi Plot",subtitle:"Junction extraction from a BAM file",description:"https://github.com/guigolab/ggsashimi/blob/master/examples/sashimi.pdf",style:{outlineWidth:0},spacing:0,static:!0,views:[{xDomain:{interval:[1707413670,1707421219]},tracks:[{data:{type:"bam",url:"https://s3.amazonaws.com/gosling-lang.org/data/sashimi/ENCFF088HTJ.chr10_27035000_27050000.bam",indexUrl:"https://s3.amazonaws.com/gosling-lang.org/data/sashimi/ENCFF088HTJ.chr10_27035000_27050000.bam.bai",extractJunction:!0,junctionMinCoverage:100},alignment:"overlay",tracks:[{mark:"withinLink"},{mark:"text",text:{field:"score",type:"nominal"},color:{value:"black"},stroke:{value:"white"},strokeWidth:{value:3},visibility:[{target:"mark",measure:"width",threshold:"|xe-x|",transitionPadding:10,operation:"LT"}]}],x:{field:"start",type:"genomic",axis:"none"},xe:{field:"end",type:"genomic"},y:{field:"score",type:"quantitative"},stroke:{value:"#FFC153"},strokeWidth:{field:"score",type:"quantitative",range:[1,4]},opacity:{value:.8},style:{flatWithinLink:!0},width:800,height:80},{data:{type:"bam",url:"https://s3.amazonaws.com/gosling-lang.org/data/sashimi/ENCFF088HTJ.chr10_27035000_27050000.bam",indexUrl:"https://s3.amazonaws.com/gosling-lang.org/data/sashimi/ENCFF088HTJ.chr10_27035000_27050000.bam.bai"},dataTransform:[{type:"coverage",startField:"start",endField:"end"}],mark:"bar",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{field:"coverage",type:"quantitative"},color:{value:"#FFC153"},width:800,height:80}]},{xDomain:{chromosome:"10",interval:[27040527,27048076]},tracks:[{data:{type:"csv",url:"https://s3.amazonaws.com/gosling-lang.org/data/sashimi/ggsashimi-annotation.gtf",headerNames:["chrom","name","type","start","end"],separator:"\t",chromosomeField:"chrom",genomicFields:["start","end"]},alignment:"overlay",mark:"rect",tracks:[{dataTransform:[{type:"filter",field:"type",oneOf:["exon"]}]},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]}],size:{value:6}}],x:{field:"start",type:"genomic",axis:"bottom"},xe:{field:"end",type:"genomic"},color:{value:"gray"},width:800,height:30}]},{xDomain:{interval:[1707413670,1707421219]},tracks:[{data:{type:"bam",url:"https://s3.amazonaws.com/gosling-lang.org/data/sashimi/ENCFF088HTJ.chr10_27035000_27050000.bam",indexUrl:"https://s3.amazonaws.com/gosling-lang.org/data/sashimi/ENCFF088HTJ.chr10_27035000_27050000.bam.bai"},dataTransform:[{type:"displace",method:"pile",boundingBox:{startField:"start",endField:"end",padding:4,isPaddingBP:!0},newField:"pileup-row"}],mark:"bar",x:{field:"start",type:"genomic",axis:"none"},xe:{field:"end",type:"genomic"},row:{field:"pileup-row",type:"nominal",padding:.05},color:{value:"grey"},width:800,height:400}]}]},underDevelopment:!0},CIRCULAR_BETWEEN_BANDS:{name:"Circular Between Bands",spec:DC,underDevelopment:!0},GREMLIN:{name:"Gremlin (O'Brien et al. 2010)",spec:{title:"Gremlin (O'Brien et al. 2010)",views:[{linkingId:"view1",xDomain:{chromosome:"5",interval:[0,8e7]},tracks:[{alignment:"overlay",title:"Chromosome 5",data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/UCSC.HG38.Human.CytoBandIdeogram.csv",type:"csv",chromosomeField:"Chromosome",genomicFields:["chromStart","chromEnd"]},tracks:[{mark:"rect",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen"],not:!0}],color:{field:"Stain",type:"nominal",domain:["gneg","gpos25","gpos50","gpos75","gpos100","gvar"],range:["#C0C0C0","#808080","#404040","black","black","black"]},size:{value:20}},{mark:"rect",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen"]}],size:{value:10},color:{value:"#B74780"}},{mark:"text",dataTransform:[{type:"filter",field:"Stain",oneOf:["gpos25","gpos50","gpos100"]}],text:{field:"Name",type:"nominal"},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}],size:{value:6},style:{dy:16,outline:"white"}},{mark:"text",dataTransform:[{type:"filter",field:"Stain",oneOf:["gneg","gpos75","gvar"]}],text:{field:"Name",type:"nominal"},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}],size:{value:6},style:{dy:-16,outline:"white"}},{mark:"brush",x:{linkingId:"view2"},strokeWidth:{value:0}}],x:{field:"chromStart",type:"genomic"},xe:{field:"chromEnd",type:"genomic"},color:{value:"black"},stroke:{value:"white"},strokeWidth:{value:1},style:{outline:"white"},width:800,height:60},{alignment:"overlay",data:{url:"https://raw.githubusercontent.com/vigsterkr/circos/master/data/5/segdup.txt",type:"csv",headerNames:["id","chr","p1","p2"],chromosomePrefix:"hs",chromosomeField:"chr",genomicFields:["p1","p2"],separator:" ",longToWideId:"id",sampleLength:2e3},dataTransform:[{type:"filter",field:"chr",oneOf:["hs5","hs4","hs6"]},{type:"filter",field:"chr_2",oneOf:["hs5","hs4","hs6"]}],tracks:[{mark:"rect"},{mark:"brush",x:{linkingId:"view2"},strokeWidth:{value:0}}],x:{field:"p1",type:"genomic"},xe:{field:"p2",type:"genomic"},row:{field:"chr_2",type:"nominal",domain:["hs5","hs4","hs6"]},color:{field:"chr_2",type:"nominal",domain:["hs5","hs4","hs6"],range:["#62AAD7","#D1A74F","#6CB74C"]},stroke:{field:"chr_2",type:"nominal",domain:["hs5","hs4","hs6"],range:["#62AAD7","#D1A74F","#6CB74C"]},strokeWidth:{value:2},opacity:{value:.4},style:{outline:"black",outlineWidth:1},width:800,height:80},{alignment:"overlay",data:{url:"https://raw.githubusercontent.com/vigsterkr/circos/master/data/5/segdup.txt",type:"csv",headerNames:["id","chr","p1","p2"],chromosomePrefix:"hs",chromosomeField:"chr",genomicFields:["p1","p2"],separator:" ",longToWideId:"id",sampleLength:1e3},dataTransform:[{type:"filter",field:"chr",oneOf:["hs5"]},{type:"filter",field:"chr_2",oneOf:["hs5"]}],tracks:[{mark:"withinLink"},{mark:"brush",x:{linkingId:"view2"},strokeWidth:{value:0}}],x:{field:"p1",type:"genomic",linkingId:"view1"},xe:{field:"p1_2",type:"genomic"},x1:{field:"p2",type:"genomic"},x1e:{field:"P2_2",type:"genomic"},stroke:{value:"#6CB74C"},strokeWidth:{value:1},opacity:{value:.4},style:{outline:"white"},width:800,height:220}]},{views:[{tracks:[{title:"Region of Interest",data:{url:"https://raw.githubusercontent.com/vigsterkr/circos/master/data/5/segdup.txt",type:"csv",headerNames:["id","chr","p1","p2"],chromosomePrefix:"hs",chromosomeField:"chr",genomicFields:["p1","p2"],separator:" ",longToWideId:"id",sampleLength:1e3},dataTransform:[{type:"filter",field:"chr",oneOf:["hs5","hs4","hs6"]},{type:"filter",field:"chr_2",oneOf:["hs5","hs4","hs6"]}],mark:"withinLink",x:{field:"p1",type:"genomic",linkingId:"view2",axis:"bottom",domain:{chromosome:"5",interval:[68e6,71e6]}},xe:{field:"p2",type:"genomic"},row:{field:"chr_2",type:"nominal",domain:["hs5","hs4","hs6","empty"]},color:{value:"none"},stroke:{field:"chr_2",type:"nominal",domain:["hs5","hs4","hs6"],range:["#62AAD7","#D1A74F","#6CB74C"]},strokeWidth:{value:6},opacity:{value:.4},style:{outline:"lightgray",outlineWidth:3,background:"#F8F8F8"},width:800,height:200}]},{views:[{tracks:[{title:"Rearrangement View",data:{url:"https://raw.githubusercontent.com/vigsterkr/circos/master/data/5/segdup.txt",type:"csv",headerNames:["id","chr","p1","p2"],chromosomePrefix:"hs",chromosomeField:"chr",genomicFields:["p1","p2"],separator:" ",longToWideId:"id",sampleLength:1e3},dataTransform:[{type:"filter",field:"chr",oneOf:["hs5"]}],mark:"withinLink",x:{field:"p1",type:"genomic",axis:"bottom",domain:{chromosome:"5",interval:[69276e3,69282e3]}},xe:{field:"p2",type:"genomic"},color:{value:"none"},stroke:{value:"#62AAD7"},strokeWidth:{value:6},opacity:{value:.4},style:{outline:"lightgray",outlineWidth:3},width:600,height:200}]}]}]}]},underDevelopment:!0},GIVE:{name:"GIVE (Cao et al. 2018)",spec:{title:"GIVE",subtitle:"Reimplementation of GenoCAT examples",spacing:60,arrangement:"vertical",views:[{layout:"linear",tracks:[{alignment:"overlay",title:"Genes",data:{url:"https://resgen.io/api/v1/tileset_info/?d=M9A9klpwTci5Vf4bHZ864g",type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:5,name:"strand",type:"nominal"},{index:3,name:"name",type:"nominal"}],exonIntervalFields:[{index:12,name:"start"},{index:13,name:"end"}]},tracks:[{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["+"]}],mark:"rect",x:{field:"end",type:"genomic",domain:{chromosome:"17",interval:[2e5,8e5]},axis:"top"},size:{value:7}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["-"]}],mark:"rect",x:{field:"start",type:"genomic"},size:{value:7}},{dataTransform:[{type:"filter",field:"type",oneOf:["exon"]}],mark:"rect",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},size:{value:14}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]}],mark:"rule",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},strokeWidth:{value:3}}],row:{field:"strand",type:"nominal",domain:["+","-"]},color:{value:"#4050B4"},width:700,height:50},{data:{url:"https://resgen.io/api/v1/tileset_info/?d=Zz3CBDSqQ3ySrOSe2yj1eg",type:"vector",column:"position",value:"peak",binSize:4},mark:"bar",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{field:"peak",type:"quantitative"},color:{value:"#8A96D5"},stroke:{value:"#3C4DB4"},strokeWidth:{value:.5},width:700,height:40},{data:{url:"https://resgen.io/api/v1/tileset_info/?d=dc_SOjdCRgq_8PYf6W--7w",type:"vector",column:"position",value:"peak",binSize:4},mark:"bar",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{field:"peak",type:"quantitative"},color:{value:"#8A96D5"},stroke:{value:"#3C4DB4"},strokeWidth:{value:.5},width:700,height:40},{data:{url:"https://resgen.io/api/v1/tileset_info/?d=Nolbrk9kS3CE0jJL_7OW1g",type:"vector",column:"position",value:"peak",binSize:4},mark:"bar",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{field:"peak",type:"quantitative"},color:{value:"#8A96D5"},stroke:{value:"#3C4DB4"},strokeWidth:{value:.5},width:700,height:40},{alignment:"overlay",data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/UCSC.HG38.Human.CytoBandIdeogram.csv",type:"csv",chromosomeField:"Chromosome",genomicFields:["chromStart","chromEnd"]},tracks:[{mark:"rect",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen"],not:!0}]},{mark:"triangleRight",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen"]},{type:"filter",field:"Name",include:"q"}]},{mark:"triangleLeft",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen"]},{type:"filter",field:"Name",include:"p"}]}],x:{field:"chromStart",type:"genomic",domain:{chromosome:"17",interval:[2e7,5e7]}},xe:{field:"chromEnd",type:"genomic"},color:{value:"white"},size:{value:14},stroke:{value:"black"},strokeWidth:{value:.5},width:700,height:40},{data:{url:"https://raw.githubusercontent.com/vigsterkr/circos/master/data/5/segdup.txt",type:"csv",headerNames:["id","chr","p1","p2"],chromosomePrefix:"hs",chromosomeField:"chr",genomicFields:["p1","p2"],separator:" ",longToWideId:"id"},dataTransform:[{type:"filter",field:"chr",oneOf:["hs17"]}],mark:"rect",x:{field:"p1",type:"genomic"},xe:{field:"p2",type:"genomic"},color:{field:"chr_2",type:"nominal",domain:["chr1","chr2","chr3","chr4","chr5","chr6","chr7","chr8","chr9","chr10","chr11","chr12","chr13","chr14","chr15","chr16","chr17","chr18","chr19","chr20","chr21","chr22","chrX","chrY"]},opacity:{value:.5},size:{value:14},overlayOnPreviousTrack:!0,width:700,height:40}]},{layout:"linear",tracks:[{alignment:"overlay",data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/UCSC.HG38.Human.CytoBandIdeogram.csv",type:"csv",chromosomeField:"Chromosome",genomicFields:["chromStart","chromEnd"]},tracks:[{mark:"rect",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen"],not:!0}]},{mark:"triangleRight",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen"]},{type:"filter",field:"Name",include:"q"}]},{mark:"triangleLeft",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen"]},{type:"filter",field:"Name",include:"p"}]}],x:{field:"chromStart",type:"genomic",axis:"none"},xe:{field:"chromEnd",type:"genomic"},color:{value:"white"},size:{value:14},stroke:{value:"black"},strokeWidth:{value:.5},width:700,height:40},{data:{url:"https://raw.githubusercontent.com/vigsterkr/circos/master/data/5/segdup.txt",type:"csv",headerNames:["id","chr","p1","p2"],chromosomePrefix:"hs",chromosomeField:"chr",genomicFields:["p1","p2"],separator:" ",longToWideId:"id"},dataTransform:[{type:"filter",field:"chr_2",oneOf:["hs1"]}],mark:"rect",x:{field:"p1_2",type:"genomic"},xe:{field:"p2_2",type:"genomic"},color:{field:"chr",type:"nominal",domain:["chr1","chr2","chr3","chr4","chr5","chr6","chr7","chr8","chr9","chr10","chr11","chr12","chr13","chr14","chr15","chr16","chr17","chr18","chr19","chr20","chr21","chr22","chrX","chrY"]},opacity:{value:.5},size:{value:14},overlayOnPreviousTrack:!0,width:700,height:40},{data:{url:"https://resgen.io/api/v1/tileset_info/?d=Zz3CBDSqQ3ySrOSe2yj1eg",type:"vector",column:"position",value:"peak",binSize:4},mark:"bar",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{field:"peak",type:"quantitative"},color:{value:"#8A96D5"},stroke:{value:"#3C4DB4"},strokeWidth:{value:.5},width:700,height:40},{data:{url:"https://resgen.io/api/v1/tileset_info/?d=dc_SOjdCRgq_8PYf6W--7w",type:"vector",column:"position",value:"peak",binSize:4},mark:"bar",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{field:"peak",type:"quantitative"},color:{value:"#8A96D5"},stroke:{value:"#3C4DB4"},strokeWidth:{value:.5},width:700,height:40},{data:{url:"https://resgen.io/api/v1/tileset_info/?d=Nolbrk9kS3CE0jJL_7OW1g",type:"vector",column:"position",value:"peak",binSize:4},mark:"bar",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{field:"peak",type:"quantitative"},color:{value:"#8A96D5"},stroke:{value:"#3C4DB4"},strokeWidth:{value:.5},width:700,height:40},{alignment:"overlay",title:"Genes",data:{url:"https://resgen.io/api/v1/tileset_info/?d=M9A9klpwTci5Vf4bHZ864g",type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:5,name:"strand",type:"nominal"},{index:3,name:"name",type:"nominal"}],exonIntervalFields:[{index:12,name:"start"},{index:13,name:"end"}]},tracks:[{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["+"]}],mark:"rect",x:{field:"end",type:"genomic",domain:{chromosome:"1",interval:[109e6,112e6]},axis:"bottom"},size:{value:7}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]},{type:"filter",field:"strand",oneOf:["-"]}],mark:"rect",x:{field:"start",type:"genomic"},size:{value:7}},{dataTransform:[{type:"filter",field:"type",oneOf:["exon"]}],mark:"rect",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},size:{value:14}},{dataTransform:[{type:"filter",field:"type",oneOf:["gene"]}],mark:"rule",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},strokeWidth:{value:3}}],row:{field:"strand",type:"nominal",domain:["+","-"]},color:{value:"#4050B4"},width:700,height:50}]}],style:{outlineWidth:0}},underDevelopment:!0},CANCER_VARIANT:{name:"Breast Cancer Variant (Staaf et al. 2019)",spec:RC},BAM_PILEUP:{name:"BAM file pileup tracks",spec:KC},TEMPLATE:{name:"Track Template",spec:EC,underDevelopment:!0},doc_area:{name:"Basic Example: Area Mark",spec:$C,hidden:!0},doc_bar:{name:"Basic Example: Bar Mark",spec:CA,hidden:!0},doc_brush:{name:"Basic Example: Brush Mark",spec:AA,hidden:!0},doc_line:{name:"Basic Example: Line Mark",spec:gA,hidden:!0},doc_link:{name:"Basic Example: Link Mark",spec:{title:"Basic Marks: Link",subtitle:"Tutorial Examples",tracks:[{layout:"linear",width:800,height:180,data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/circos-segdup-edited.txt",type:"csv",chromosomeField:"c2",genomicFields:["s1","e1","s2","e2"]},mark:"withinLink",x:{field:"s1",type:"genomic",domain:{chromosome:"1"},axis:"top"},xe:{field:"e1",type:"genomic"},x1:{field:"s2",type:"genomic",domain:{chromosome:"1"},axis:"top"},x1e:{field:"e2",type:"genomic"},stroke:{value:"steelblue"}}]},hidden:!0},doc_linking_tracks:{name:"Basic Example: Linking Tracks",spec:{tracks:[{layout:"linear",height:100,width:800,data:{url:"https://resgen.io/api/v1/tileset_info/?d=UvVPeLHuRDiYA3qwFlm7xQ",type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 3","sample 4"]},mark:"line",x:{field:"position",type:"genomic",domain:{chromosome:"2"},axis:"top",linkingId:"link1"},y:{field:"peak",type:"quantitative"},row:{field:"sample",type:"nominal"},color:{field:"sample",type:"nominal",legend:!0},stroke:{value:"white"},strokeWidth:{value:.5}},{height:100,width:800,data:{url:"https://resgen.io/api/v1/tileset_info/?d=UvVPeLHuRDiYA3qwFlm7xQ",type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2"]},mark:"area",x:{field:"position",type:"genomic",domain:{chromosome:"2"},axis:"top",linkingId:"link1"},y:{field:"peak",type:"quantitative"},row:{field:"sample",type:"nominal"},color:{field:"sample",type:"nominal",legend:!0},stroke:{value:"white"},strokeWidth:{value:.5}}]},hidden:!0},doc_point:{name:"Basic Example: Point Mark",spec:IA,hidden:!0},doc_rect:{name:"Basic Example: React Mark",spec:{title:"Basic Marks: Rect",subtitle:"Tutorial Examples",tracks:[{width:800,height:40,data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/UCSC.HG38.Human.CytoBandIdeogram.csv",type:"csv",chromosomeField:"Chromosome",genomicFields:["chromStart","chromEnd"]},mark:"rect",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen"],not:!0}],color:{field:"Stain",type:"nominal",domain:["gneg","gpos25","gpos50","gpos75","gpos100","gvar"],range:["white","#D9D9D9","#979797","#636363","black","#A0A0F2"]},x:{field:"chromStart",type:"genomic",domain:{chromosome:"1"},axis:"top"},xe:{field:"chromEnd",type:"genomic"},size:{value:20},stroke:{value:"gray"},strokeWidth:{value:.5},style:{outline:"white"}}]},hidden:!0},doc_text:{name:"Basic Example: Text Mark",spec:{title:"Basic Marks: Text",subtitle:"Tutorial Examples",tracks:[{width:800,height:180,data:{url:"https://resgen.io/api/v1/tileset_info/?d=UvVPeLHuRDiYA3qwFlm7xQ",type:"multivec",row:"base",column:"position",value:"count",categories:["A","T","G","C"],start:"start",end:"end",binSize:16},mark:"text",y:{field:"count",type:"quantitative"},style:{textStrokeWidth:0},stretch:!0,x:{field:"start",type:"genomic",axis:"top"},xe:{field:"end",type:"genomic"},color:{field:"base",type:"nominal",domain:["A","T","G","C"]},text:{field:"base",type:"nominal"}}]},hidden:!0},doc_triangle:{name:"Basic Example: Triangle Mark",spec:e(Z({},vC),{tracks:vC.tracks.filter((g=>g.mark.includes("triangle"))),title:"Basic Marks: Triangles",subtitle:"Tutorial Examples",width:800,visibility:void 0}),hidden:!0},doc_overlay_bar_point:{name:"Overlay Tracks: Bar + Point",spec:{title:"Example: Overlay Tracks",tracks:[{layout:"linear",width:800,height:200,data:{url:"https://cgap-higlass.com/api/v1/tileset_info/?d=clinvar_20200824_hg38",type:"beddb",genomicFields:[{index:1,name:"start"},{index:2,name:"end"}],valueFields:[{index:7,name:"significance",type:"nominal"}]},alignment:"overlay",tracks:[{mark:"bar",stroke:{field:"significance",type:"nominal",domain:["Pathogenic","Pathogenic/Likely_pathogenic","Likely_pathogenic","Uncertain_significance","Likely_benign","Benign/Likely_benign","Benign"],range:["#D45E00","#D45E00","#D45E00","black","#029F73","#029F73","#029F73"]},strokeWidth:{value:.5},size:{value:1}},{mark:"point",size:{value:5},color:{field:"significance",type:"nominal",domain:["Pathogenic","Pathogenic/Likely_pathogenic","Likely_pathogenic","Uncertain_significance","Likely_benign","Benign/Likely_benign","Benign"],range:["#D45E00","#D45E00","#D45E00","black","#029F73","#029F73","#029F73"],legend:!0}}],x:{field:"start",type:"genomic",domain:{chromosome:"3"},axis:"top"},xe:{field:"end",type:"genomic"},y:{field:"significance",type:"nominal",domain:["Pathogenic","Pathogenic/Likely_pathogenic","Likely_pathogenic","Uncertain_significance","Likely_benign","Benign/Likely_benign","Benign"],baseline:"Uncertain_significance",range:[150,20],grid:!0},color:{field:"significance",type:"nominal",domain:["Pathogenic","Pathogenic/Likely_pathogenic","Likely_pathogenic","Uncertain_significance","Likely_benign","Benign/Likely_benign","Benign"],range:["#D45E00","#D45E00","#D45E00","black","#029F73","#029F73","#029F73"]},opacity:{value:.6}}]},hidden:!0},doc_overlay_rect_text:{name:"Overlay Tracks: Rect + Text",spec:{title:"Example: Overlay Tracks",views:[{width:800,height:80,layout:"linear",data:{url:"https://raw.githubusercontent.com/sehilyi/gemini-datasets/master/data/UCSC.HG38.Human.CytoBandIdeogram.csv",type:"csv",chromosomeField:"Chromosome",genomicFields:["chromStart","chromEnd"]},alignment:"overlay",tracks:[{mark:"text",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen"],not:!0}],text:{field:"Name",type:"nominal"},color:{field:"Stain",type:"nominal",domain:["gneg","gpos25","gpos50","gpos75","gpos100","gvar"],range:["black","black","black","black","white","black"]},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}],style:{textStrokeWidth:0}},{mark:"rect",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen"],not:!0}],color:{field:"Stain",type:"nominal",domain:["gneg","gpos25","gpos50","gpos75","gpos100","gvar"],range:["white","#D9D9D9","#979797","#636363","black","#A0A0F2"]}},{mark:"triangleRight",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen"],not:!1},{type:"filter",field:"Name",include:"q",not:!1}],color:{value:"#B40101"}},{mark:"triangleLeft",dataTransform:[{type:"filter",field:"Stain",oneOf:["acen"],not:!1},{type:"filter",field:"Name",include:"p",not:!1}],color:{value:"#B40101"}}],x:{field:"chromStart",type:"genomic",domain:{chromosome:"1"},axis:"top"},xe:{field:"chromEnd",type:"genomic"},size:{value:20},stroke:{value:"gray"},strokeWidth:{value:.5},style:{outline:"white"}}]},hidden:!0},doc_overlay_line_point:{name:"Overlay Tracks: Line + Point",spec:{title:"Example: Overlayed Tracks",tracks:[{height:200,width:1e3,layout:"linear",data:{url:"https://resgen.io/api/v1/tileset_info/?d=UvVPeLHuRDiYA3qwFlm7xQ",type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"]},alignment:"overlay",tracks:[{mark:"line"},{mark:"point",size:{field:"peak",type:"quantitative",range:[0,6]}}],x:{field:"position",type:"genomic",domain:{chromosome:"1",interval:[1,3000500]},axis:"top"},y:{field:"peak",type:"quantitative"},row:{field:"sample",type:"nominal"},color:{field:"sample",type:"nominal"}}]},hidden:!0},doc_semantic_zoom_sequence:{name:"Semantic Zoom: A Sequence Example",spec:lA,hidden:!0},doc_semantic_zoom_cyto:{name:"Semantic Zoom: Cyto",spec:iA,hidden:!0}};const dA={width:20,height:20,viewBox:"0 0 16 16",path:["M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"],stroke:"none",fill:"currentColor"},ZA={width:20,height:20,viewBox:"0 0 16 16",path:["M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z","M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"],stroke:"none",fill:"currentColor"},eA={width:20,height:20,viewBox:"0 0 16 16",path:["M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z","M1.5 2A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13zm13 1a.5.5 0 0 1 .5.5v6l-3.775-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12v.54A.505.505 0 0 1 1 12.5v-9a.5.5 0 0 1 .5-.5h13z"],stroke:"none",fill:"currentColor"},mA={width:20,height:20,viewBox:"0 0 16 16",path:["M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm8.93 4.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"],stroke:"none",fill:"currentColor"},oA={width:20,height:20,viewBox:"0 0 16 16",path:["M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z","M8.93 6.588l-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"],stroke:"none",fill:"currentColor"},bA={width:20,height:20,viewBox:"0 0 16 16",path:["M12.258 3H3.747l-.082 2.46h.478c.26-1.544.76-1.783 2.694-1.845l.424-.013v7.827c0 .663-.144.82-1.3.923v.52h4.082v-.52c-1.162-.103-1.306-.26-1.306-.923V3.602l.43.013c1.935.062 2.434.301 2.694 1.846h.479L12.258 3z"],stroke:"none",fill:"currentColor"},aA={width:20,height:20,viewBox:"0 0 15.011423110961914 21.098501205444336",path:["M15.006 10.57c0-1.948-.618-3.397-2.066-4.844a1 1 0 0 0-1.414 1.415c1.079 1.078 1.48 2.007 1.48 3.43a5.46 5.46 0 0 1-1.611 3.887c-1.004 1.003-2.078 1.502-3.428 1.593l1.246-1.247a1 1 0 1 0-1.414-1.414l-3.707 3.707 3.707 3.707a.997.997 0 0 0 1.414 0 .999.999 0 0 0 0-1.414l-1.337-1.336c1.923-.082 3.542-.792 4.933-2.18a7.447 7.447 0 0 0 2.197-5.304zm-13 .027c0-1.469.572-2.85 1.61-3.889C4.627 5.7 5.71 5.2 7.075 5.114L5.799 6.39a.999.999 0 0 0 .707 1.708.997.997 0 0 0 .707-.293l3.707-3.707L7.213.39a1 1 0 1 0-1.414 1.414l1.31 1.311c-1.913.086-3.524.796-4.906 2.18a7.447 7.447 0 0 0-2.197 5.302c0 1.948.618 3.397 2.066 4.844a.997.997 0 0 0 1.414 0 1 1 0 0 0 0-1.416c-1.08-1.077-1.48-2.006-1.48-3.428z"],stroke:"none",fill:"currentColor"},sA={width:20,height:20,viewBox:"0 0 16 16",path:["M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm15 2h-4v3h4V4zm0 4h-4v3h4V8zm0 4h-4v3h3a1 1 0 0 0 1-1v-2zm-5 3v-3H6v3h4zm-5 0v-3H1v2a1 1 0 0 0 1 1h3zm-4-4h4V8H1v3zm0-4h4V4H1v3zm5-3v3h4V4H6zm4 4H6v3h4V8z"],stroke:"none",fill:"currentColor"},tA={width:20,height:20,viewBox:"0 0 16 16",path:["M8.646 5.646a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1 0 .708l-2 2a.5.5 0 0 1-.708-.708L10.293 8 8.646 6.354a.5.5 0 0 1 0-.708zm-1.292 0a.5.5 0 0 0-.708 0l-2 2a.5.5 0 0 0 0 .708l2 2a.5.5 0 0 0 .708-.708L5.707 8l1.647-1.646a.5.5 0 0 0 0-.708z","M3 0h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1h1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v1H1V2a2 2 0 0 1 2-2z","M1 5v-.5a.5.5 0 0 1 1 0V5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0V8h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1z"],stroke:"none",fill:"currentColor"},nA={width:20,height:20,viewBox:"0 0 16 16",path:["M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"],stroke:"none",fill:"currentColor"},VA={width:20,height:20,viewBox:"0 0 16 16",path:["M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"],stroke:"none",fill:"currentColor"},yA={width:20,height:20,viewBox:"0 0 16 16",path:["M0 3a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3zm5-1v12h9a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H5zM4 2H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h2V2z"],stroke:"none",fill:"currentColor"},XA={width:22,height:22,viewBox:"0 0 2048 1792",path:["M0 896q0-130 51-248.5t136.5-204 204-136.5 248.5-51h768q130 0 248.5 51t204 136.5 136.5 204 51 248.5-51 248.5-136.5 204-204 136.5-248.5 51h-768q-130 0-248.5-51t-204-136.5-136.5-204-51-248.5zm1408 512q104 0 198.5-40.5t163.5-109.5 109.5-163.5 40.5-198.5-40.5-198.5-109.5-163.5-163.5-109.5-198.5-40.5-198.5 40.5-163.5 109.5-109.5 163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5z"],stroke:"none",fill:"currentColor"},GA={width:22,height:22,viewBox:"0 0 2048 1792",path:["M1152 896q0-104-40.5-198.5t-109.5-163.5-163.5-109.5-198.5-40.5-198.5 40.5-163.5 109.5-109.5 163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5 198.5-40.5 163.5-109.5 109.5-163.5 40.5-198.5zm768 0q0-104-40.5-198.5t-109.5-163.5-163.5-109.5-198.5-40.5h-386q119 90 188.5 224t69.5 288-69.5 288-188.5 224h386q104 0 198.5-40.5t163.5-109.5 109.5-163.5 40.5-198.5zm128 0q0 130-51 248.5t-136.5 204-204 136.5-248.5 51h-768q-130 0-248.5-51t-204-136.5-136.5-204-51-248.5 51-248.5 136.5-204 204-136.5 248.5-51h768q130 0 248.5 51t204 136.5 136.5 204 51 248.5z"],stroke:"none",fill:"currentColor"},BA={width:20,height:20,viewBox:"0 0 16 16",path:["M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z","M4.603 14.087a.81.81 0 0 1-.438-.42c-.195-.388-.13-.776.08-1.102.198-.307.526-.568.897-.787a7.68 7.68 0 0 1 1.482-.645 19.697 19.697 0 0 0 1.062-2.227 7.269 7.269 0 0 1-.43-1.295c-.086-.4-.119-.796-.046-1.136.075-.354.274-.672.65-.823.192-.077.4-.12.602-.077a.7.7 0 0 1 .477.365c.088.164.12.356.127.538.007.188-.012.396-.047.614-.084.51-.27 1.134-.52 1.794a10.954 10.954 0 0 0 .98 1.686 5.753 5.753 0 0 1 1.334.05c.364.066.734.195.96.465.12.144.193.32.2.518.007.192-.047.382-.138.563a1.04 1.04 0 0 1-.354.416.856.856 0 0 1-.51.138c-.331-.014-.654-.196-.933-.417a5.712 5.712 0 0 1-.911-.95 11.651 11.651 0 0 0-1.997.406 11.307 11.307 0 0 1-1.02 1.51c-.292.35-.609.656-.927.787a.793.793 0 0 1-.58.029zm1.379-1.901c-.166.076-.32.156-.459.238-.328.194-.541.383-.647.547-.094.145-.096.25-.04.361.01.022.02.036.026.044a.266.266 0 0 0 .035-.012c.137-.056.355-.235.635-.572a8.18 8.18 0 0 0 .45-.606zm1.64-1.33a12.71 12.71 0 0 1 1.01-.193 11.744 11.744 0 0 1-.51-.858 20.801 20.801 0 0 1-.5 1.05zm2.446.45c.15.163.296.3.435.41.24.19.407.253.498.256a.107.107 0 0 0 .07-.015.307.307 0 0 0 .094-.125.436.436 0 0 0 .059-.2.095.095 0 0 0-.026-.063c-.052-.062-.2-.152-.518-.209a3.876 3.876 0 0 0-.612-.053zM8.078 7.8a6.7 6.7 0 0 0 .2-.828c.031-.188.043-.343.038-.465a.613.613 0 0 0-.032-.198.517.517 0 0 0-.145.04c-.087.035-.158.106-.196.283-.04.192-.03.469.046.822.024.111.054.227.09.346z"],stroke:"none",fill:"currentColor"},WA={width:18,height:18,viewBox:"0 0 24 24",path:["M7 4v16l13 -8z"],stroke:"none",fill:"currentColor"},hA={width:18,height:18,viewBox:"0 0 24 24",path:["M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5","M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5"],stroke:"currentColor",fill:"none"},pA=Object.entries(cA).map((([g,I])=>Z({id:g},I))).filter((g=>!g.hidden)),HA=null!=(g=pA.find((g=>g.forceShow)))?g:pA[0],uA=(g,I)=>_.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 400 400",width:g,height:I},_.createElement("rect",{style:{fill:"none"},width:"400",height:"400"}),_.createElement("circle",{cx:"110.62",cy:"129.64",r:"41.69"}),_.createElement("circle",{style:{fill:"#fff"},cx:"124.14",cy:"114.12",r:"10.76"}),_.createElement("circle",{cx:"288.56",cy:"129.64",r:"41.69"}),_.createElement("circle",{style:{fill:"#fff"},cx:"302.07",cy:"114.12",r:"10.76"}),_.createElement("path",{style:{fill:"#e18241"},d:"M313.1,241.64l8.61-22.09a430.11,430.11,0,0,0-88-15.87L224,225.63A384.54,384.54,0,0,1,313.1,241.64Z"}),_.createElement("path",{style:{fill:"#e18241"},d:"M208.63,260.53a299.77,299.77,0,0,1,90.56,16.79L308,254.79a371.68,371.68,0,0,0-90-15.47Z"}),_.createElement("path",{style:{fill:"#e18241"},d:"M174.4,225.56l-9-22a431.34,431.34,0,0,0-88,15.43l8.9,22A385.08,385.08,0,0,1,174.4,225.56Z"}),_.createElement("path",{style:{fill:"#e18241"},d:"M100.71,276.35a300.51,300.51,0,0,1,87.91-15.82L180,239.29a372.51,372.51,0,0,0-88.3,14.76Z"}),_.createElement("path",{style:{fill:"#e18241"},d:"M106.52,290.71c27.53,13.92,59.05,21.34,92.05,21.34h0c33.68,0,65.83-7.72,93.75-22.2a291.31,291.31,0,0,0-186.33-.4Z"})),YA=(g,I,C,A)=>_.createElement("svg",{key:Zg(g),xmlns:"http://www.w3.org/2000/svg",width:null!=I?I:g.width,height:null!=C?C:g.height,viewBox:g.viewBox,strokeWidth:"2",stroke:g.stroke,fill:null!=A?A:g.fill,strokeLinecap:"round",strokeLinejoin:"round"},g.path.map((g=>_.createElement("path",{key:g,d:g})))),KA=g=>void 0!==g?`{\n\t// ${g}\n}`:"{}",RA=()=>Math.min(500,window.innerWidth);const rA=async g=>{let I=null;try{const C=await yg(`https://gist.github.com/${g}.json`);I=await(C.ok?C.json():null)}catch(d){return Promise.reject(new Error("Gist not found"))}if(!I)return Promise.reject(new Error("Gist not found"));const C=I.files.find((g=>g.toLowerCase().startsWith("gosling.js"))),A=I.files.find((g=>g.toLowerCase().startsWith("readme.md")));if(!C)return Promise.reject(new Error("Gist does not contain a Gosling spec."));const l=new URL(`https://gist.githubusercontent.com/${g}/raw/${C}`),i=fetch(l.href).then((async g=>200===g.status?function(g,I){const C=JSON.parse(g),A=/^[.\/]|^\.[.\/]|^\.\.[^\/]/;return II(C,(g=>{g.data&&"csv"===g.data.type&&A.test(g.data.url)&&(g.data.url=new URL(g.data.url,I).href)})),Zg(C)}(await g.text(),l):null)),c=fetch(`https://gist.githubusercontent.com/${g}/raw/${A}`).then((g=>200===g.status?g.text():null));return Promise.all([i,c]).then((([g,C])=>({code:g,description:C,title:I.description})))};Xg.render(_.createElement(Gg,null,_.createElement(Bg,{component:function(g){var I,C;const A=window.innerWidth<=500,l=cg.parse(g.location.search,{ignoreQueryPrefix:!0}),i=(null==l?void 0:l.spec)?dg.uncrush(l.spec):null,c=null!=(I=null==l?void 0:l.gist)?I:null,d=null!=(C=null==l?void 0:l.example)?C:"",m=c?KA():Zg(null!=i?i:HA.spec),o=q.exports.useRef([]),[b,a]=q.exports.useState(!1),[s,t]=q.exports.useState(cA[d]?Z({id:d},cA[d]):HA),[n,V]=q.exports.useState("light"),[y,X]=q.exports.useState(),[G,B]=q.exports.useState(m),[W,h]=q.exports.useState(),[p,H]=q.exports.useState({message:"",state:"success"}),[u,Y]=q.exports.useState(!0),[K,R]=q.exports.useState(0),[r,J]=q.exports.useState(),[w,S]=q.exports.useState(),[F,k]=q.exports.useState(!1),[v,N]=q.exports.useState(A||!1),[f,z]=q.exports.useState(RA()),[x,U]=q.exports.useState(!1),[M,L]=q.exports.useState(!!c),[T,D]=q.exports.useState(A||"true"===(null==l?void 0:l.full)||!1),[O,j]=q.exports.useState(!1),[E,$]=q.exports.useState(void 0),[gg,Ig]=q.exports.useState(void 0),[Cg,Ag]=q.exports.useState(void 0),[lg,ig]=q.exports.useState(!1),[yg,Xg]=q.exports.useState(!1),Gg=q.exports.useRef(),Bg=q.exports.useRef(),Wg=q.exports.useRef(),hg=q.exports.useRef(eg((g=>{B(g)}),1500));q.exports.useEffect((()=>{}),[Wg.current]),q.exports.useEffect((()=>{var g;o.current=[],R(0),d&&!cA[d]?B(KA(`Example id "${d}" does not exist.`)):B(null!=i?i:c?KA():"string"==typeof(g=s.spec)?g:Zg(g)),X(void 0)}),[s]),q.exports.useEffect((()=>{let g=!0;if(c&&"string"==typeof c)return rA(c).then((({code:I,description:C,title:A})=>{g&&I&&(L(!1),B(I),J(A),S(C))})).catch((I=>{g&&(L(!1),B(KA(I)),S(void 0),J("Error loading gist! See code for details."))})),()=>{L(!1),g=!1}}),[c]);const pg=q.exports.useCallback((g=>{if(Q(KA(),G))return;let I,C;try{I=JSON.parse(mg(G)),C=uI(I),H(C)}catch(A){const g="✘ Cannnot parse the code.";console.warn(g),H({message:g,state:"error"})}I&&"success"===(null==C?void 0:C.state)&&(u||g)&&h(I)}),[G,u,M]);q.exports.useEffect((()=>{const g=P.subscribe("data-preview",((g,I)=>{const C=`${I.dataConfig}`,A=o.current.filter((g=>g.id!==C));o.current=[...A,e(Z({},I),{id:C})]}));return()=>{P.unsubscribe(g)}})),q.exports.useEffect((()=>{o.current=[],R(0),pg()}),[G,u,n]);const Hg=q.exports.useCallback((()=>{v||(Bg.current=og.sourceEvent.clientX,ig(!0))}),[Bg,f]),ug=q.exports.useCallback((()=>{if(Bg.current){const g=og.sourceEvent.clientX-Bg.current;z(f-g)}}),[Bg,f]),Yg=q.exports.useCallback((()=>{Bg.current=null,ig(!1)}),[Bg,f]);return q.exports.useEffect((()=>{const g=Gg.current,I=bg().on("start",Hg).on("drag",ug).on("end",Yg);return ag(g).call(I),()=>{ag(g).on(".drag",null)}}),[Gg,Hg,ug,Yg]),_.createElement(_.Fragment,null,_.createElement("div",{className:"demo-navbar "+("dark"===n?"dark":""),onClick:()=>{Wg.current}},_.createElement("span",{style:{cursor:"pointer",lineHeight:"40px"},onClick:()=>window.open("https://gosling.js.org","_blank")},_.createElement("span",{className:"logo"},uA(20,20)),"Gosling.js Editor"),i&&_.createElement("small",null," Displaying a custom spec contained in URL"),r&&!A&&_.createElement(_.Fragment,null,_.createElement("span",{className:"gist-title"},r),_.createElement("span",{title:"Open GitHub Gist",style:{marginLeft:10},className:"description-github-button",onClick:()=>window.open(`https://gist.github.com/${c}`,"_blank")},YA(ZA,14,14))),_.createElement("span",{className:"demo-dropdown",hidden:null!==i||null!==c||""!==d},_.createElement("select",{style:{maxWidth:A?window.innerWidth-180:"none"},onChange:g=>{t(Z({id:g.target.value},cA[g.target.value]))},value:s.id},pA.map((g=>_.createElement("option",{key:g.id,value:g.id},g.name+(g.underDevelopment?" (under development)":"")))))),F?_.createElement("select",{style:{maxWidth:A?window.innerWidth-180:"none"},onChange:g=>{-1!==Object.keys(sg).indexOf(g.target.value)&&V(g.target.value)},defaultValue:n},Object.keys(sg).map((g=>_.createElement("option",{key:g,value:g},g)))):null,s.underDevelopment?_.createElement("span",{style:{paddingLeft:12,fontStyle:"normal",fontSize:13}},"🚧 This example is under development 🚧"):null,_.createElement("input",{type:"hidden",id:"spec-url-exporter"}),w?_.createElement("span",{title:"Open Textual Description",className:"description-button",onClick:function(){z(RA()),N(!1)}},YA(oA,23,23)):null),_.createElement("div",{className:"editor "+("dark"===n?"dark":"")},_.createElement(tg,{className:"side-panel-spliter",split:"vertical",defaultSize:"50px",allowResize:!1},_.createElement("div",{className:"side-panel "+("dark"===n?"dark":"")},_.createElement("span",{title:"Automatically update visualization upon editing code",className:"side-panel-button",onClick:()=>Y(!u)},u?YA(XA,23,23,"#E18343"):YA(GA),_.createElement("br",null),"AUTO",_.createElement("br",null),"RUN"),_.createElement("span",{title:"Run Code",className:"side-panel-button",onClick:()=>pg(!0)},YA(WA,23,23),_.createElement("br",null),"RUN"),_.createElement("span",{title:"Find",className:"side-panel-button",onClick:()=>{$(!E)}},YA(VA,23,23),_.createElement("br",null),"FIND"),_.createElement("span",{title:"Use Larger Font",className:"side-panel-button",onClick:()=>{Ig(!gg)}},YA(bA,23,23),"+",_.createElement("br",null),"LARGER"),_.createElement("span",{title:"Use Larger Font",className:"side-panel-button",onClick:()=>{Ag(!Cg)}},YA(bA,15,15),"-",_.createElement("br",null),"SMALLER"),_.createElement("span",{title:"Show or hide a code panel",className:"side-panel-button",onClick:()=>D(!T)},YA(yA,23,23),_.createElement("br",null),"LAYOUT"),_.createElement("span",{title:"Show or hide a data preview",className:"side-panel-button",onClick:()=>j(!O)},YA(sA,23,23),_.createElement("br",null),"DATA",_.createElement("br",null),"PREVIEW"),_.createElement("span",{title:"Save PNG file",className:"side-panel-button",onClick:()=>{Wg.current.api.exportPng()}},YA(eA,23,23),_.createElement("br",null),"PNG"),_.createElement("span",{title:"Save PDF file",className:"side-panel-button",onClick:()=>{Wg.current.api.exportPdf()}},YA(BA,23,23),_.createElement("br",null),"PDF"),_.createElement("span",{title:G.length<=4096?"Copy unique URL of current view to clipboard (limit: 4096 characters)":"The current code contains characters more than 4096",className:G.length<=4096?"side-panel-button":"side-panel-button side-panel-button-not-active",onClick:()=>{if(G.length<=4096){const g=encodeURIComponent(dg.crush(G)),I=`https://gosling-lang.github.io/gosling.js/?full=${T}&spec=${g}`,C=document.getElementById("spec-url-exporter");C.type="text",C.value=I,C.select(),document.execCommand("copy"),C.type="hidden"}}},YA(hA,23,23),_.createElement("br",null),"SAVE",_.createElement("br",null),"URL"),_.createElement("span",{title:"Expert mode that turns on additional features, such as theme selection",className:"side-panel-button",onClick:()=>k(!F)},F?YA(XA,23,23,"#E18343"):YA(GA),_.createElement("br",null),"EXPERT",_.createElement("br",null),"MODE"),_.createElement("span",{title:"Open GitHub repository",className:"side-panel-button",onClick:()=>window.open("https://github.com/gosling-lang/gosling.js","_blank")},YA(nA,23,23),_.createElement("br",null),"GITHUB"),_.createElement("span",{title:"Open Docs",className:"side-panel-button",onClick:()=>window.open("http://gosling-lang.org/docs/","_blank")},YA(tA,23,23),_.createElement("br",null),"DOCS"),_.createElement("span",{title:"About",className:"side-panel-button",onClick:()=>Xg(!yg)},YA(mA,23,23),_.createElement("br",null),"ABOUT")),_.createElement(tg,{split:"vertical",defaultSize:"calc(40%)",size:T?"0px":"calc(40%)",minSize:"0px"},_.createElement(tg,{split:"horizontal",defaultSize:"calc(100% - 30px)",maxSize:window.innerHeight-40-30,onChange:g=>{const I=window.innerHeight-40-g;I>30&&!x?U(!0):I<=30&&x&&U(!1)}},_.createElement(_.Fragment,null,_.createElement(mC,{code:G,readOnly:M,openFindBox:E,fontZoomIn:gg,fontZoomOut:Cg,onChange:hg.current,isDarkTheme:"dark"===n}),_.createElement("div",{className:`compile-message compile-message-${p.state}`},p.message)),_.createElement(tg,{split:"vertical",defaultSize:"100%"},_.createElement(_.Fragment,null,_.createElement("div",{className:"editor-header "+("dark"===n?"dark":"")},"Compiled HiGlass ViewConfig (Read Only)"),_.createElement("div",{style:{height:"100%",visibility:x?"visible":"hidden"}},_.createElement(mC,{code:Zg(y),readOnly:!0,isDarkTheme:"dark"===n}))),_.createElement(_.Fragment,null))),_.createElement(oC,null,_.createElement(tg,{split:"horizontal",defaultSize:"calc(100% - 30px)",size:O?"40%":"calc(100% - 30px)",maxSize:window.innerHeight-40-30},_.createElement("div",{id:"preview-container",className:"preview-container "+("dark"===n?"dark":"")},_.createElement(eC,{ref:Wg,spec:W,theme:n,padding:60,margin:0,border:"none",id:"goslig-component-root",className:"goslig-component",experimental:{reactive:!1},compiled:(g,I)=>{X(I)}})),_.createElement(tg,{split:"vertical",defaultSize:"100%"},_.createElement(_.Fragment,null,_.createElement("div",{className:"editor-header "+("dark"===n?"dark":""),style:{cursor:"pointer"},onClick:()=>j(!O)},"Data Preview (~100 Rows, Data Before Transformation)"),_.createElement("div",{className:"editor-data-preview-panel"},_.createElement("div",{title:"Refresh preview data",className:"data-preview-refresh-button",onClick:()=>a(!b)},YA(aA,23,23),_.createElement("br",null),"REFRESH DATA"),o.current.length>K&&o.current[K]&&o.current[K].data.length>0?_.createElement(_.Fragment,null,_.createElement("div",{className:"editor-data-preview-tab"},o.current.map(((g,I)=>_.createElement("button",{className:I===K?"selected-tab":"unselected-tab",key:JSON.stringify(g),onClick:()=>R(I)},`${JSON.parse(g.dataConfig).data.type.toLocaleLowerCase()} `,_.createElement("small",null,I))))),_.createElement("div",{className:"editor-data-preview-tab-info"},function(g){var I;const C=JSON.parse(g);if(!(null==(I=C.data)?void 0:I.type))return"";let A="";return C.data&&Object.keys(C.data).forEach((g=>{"object"==typeof C.data[g]?A+=`${JSON.stringify(C.data[g])} | `:A+=`${C.data[g]} | `})),A.slice(0,A.length-2)}(o.current[K].dataConfig)),_.createElement("div",{className:"editor-data-preview-table"},_.createElement("table",null,_.createElement("tbody",null,_.createElement("tr",null,Object.keys(o.current[K].data[0]).map(((g,I)=>_.createElement("th",{key:I},g)))),o.current[K].data.map(((g,I)=>_.createElement("tr",{key:I},Object.keys(g).map(((I,C)=>{var A;return _.createElement("td",{key:C},null==(A=g[I])?void 0:A.toString())}))))))))):null)),_.createElement(_.Fragment,null)))))),_.createElement("div",{className:`description ${v?"":"description-shadow "}${lg?"":"description-transition"} ${"dark"===n?"dark":""}`,style:{width:!w||v?0:f}},_.createElement("div",{className:v?"description-resizer-disabled":"description-resizer",ref:Gg}),_.createElement("div",{className:"description-wrapper"},_.createElement("header",null,_.createElement("button",{className:"hide-description-button",onClick:function(){N(!0)}},"Close"),_.createElement("br",null),_.createElement("br",null),_.createElement("span",{title:"Open GitHub Gist",className:"description-github-button",onClick:()=>window.open(`https://gist.github.com/${c}`,"_blank")},YA(ZA,14,14)," Open GitHub Gist to see raw files.")),w&&_.createElement(ng,{plugins:[Vg],source:w}))),_.createElement("div",{className:yg?"about-modal-container":"about-modal-container-hidden",onClick:()=>Xg(!1)}),_.createElement("div",{className:yg?"about-modal":"about-modal-container-hidden"},_.createElement("span",{className:"about-model-close-button",onClick:()=>{Xg(!1)}},YA(dA,30,30)),_.createElement("div",null,_.createElement("span",{className:"logo"},uA(80,80))),_.createElement("h3",null,"Gosling.js Editor"),"Gosling.js v0.9.9",_.createElement("br",null),_.createElement("br",null),_.createElement("a",{href:"https://github.com/gosling-lang/gosling.js/blob/master/CHANGELOG.md",target:"_blank",rel:"noopener noreferrer"},"Change Log"),_.createElement("br",null),_.createElement("br",null),_.createElement("a",{href:"https://github.com/gosling-lang/gosling.js/blob/master/LICENSE.md",target:"_blank",rel:"noopener noreferrer"},"MIT License"),_.createElement("br",null),_.createElement("br",null),_.createElement("h4",null,"Team"),_.createElement("span",null,"Sehi L'Yi (",_.createElement("a",{href:"https://twitter.com/sehi_lyi",target:"_blank",rel:"noopener noreferrer"},"@sehi_lyi"),")",_.createElement("br",null),"Qianwen Wang (",_.createElement("a",{href:"https://twitter.com/WangQianwenToo",target:"_blank",rel:"noopener noreferrer"},"@WangQianwenToo"),")",_.createElement("br",null),"Fritz Lekschas (",_.createElement("a",{href:"https://twitter.com/flekschas",target:"_blank",rel:"noopener noreferrer"},"@flekschas"),")",_.createElement("br",null),"Nils Gehlenborg (",_.createElement("a",{href:"https://twitter.com/gehlenborg",target:"_blank",rel:"noopener noreferrer"},"@gehlenborg"),")"),_.createElement("br",null),_.createElement("br",null),_.createElement("a",{href:"http://gehlenborglab.org/",target:"_blank",rel:"noopener noreferrer"},"Gehlenborg Lab"),", Harvard Medical School")))}})),document.getElementById("root"));
